[{"id": "apps/coherence-engine/webui/src/CoherenceEngineRemote.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/CoherenceEngineRemote.jsx", "sourceCode": "export default function CoherenceEngineRemote({\n  projectId,\n  schema,\n  eras = [],\n  onErasChange,\n  pressures = [],\n  onPressuresChange,\n  generators = [],\n  onGeneratorsChange,\n  actions = [],\n  onActionsChange,\n  systems = [],\n  onSystemsChange,\n  activeSection,\n  onSectionChange,\n}) {\n  // Use passed-in section or default to 'validation'\n  const activeTab = activeSection || \"validation\";\n  const setActiveTab = onSectionChange || (() => {});\n\n  const currentSection = SECTION_INFO[activeTab] || SECTION_INFO.validation;\n\n  // Compute usage map for cross-reference tracking and validation (must be before validationStatus)\n  const usageMap = useMemo(\n    () => computeUsageMap(schema, pressures, eras, generators, systems, actions),\n    [schema, pressures, eras, generators, systems, actions]\n  );\n\n  // Calculate validation status for the nav indicator (uses usageMap)\n  const validationStatus = useMemo(\n    () => getValidationStatus(usageMap, schema, eras, pressures, generators, systems),\n    [usageMap, schema, eras, pressures, generators, systems]\n  );\n\n  // Navigate to generators tab and optionally select a specific generator\n  const handleNavigateToGenerator = (_generatorId) => {\n    setActiveTab(\"generators\");\n    // NOOP: generator expansion not yet implemented\n  };\n\n  const renderContent = () => {\n    switch (activeTab) {\n      case \"validation\":\n        return (\n          <ValidationEditor\n            schema={schema}\n            eras={eras}\n            pressures={pressures}\n            generators={generators}\n            systems={systems}\n            actions={actions}\n            usageMap={usageMap}\n            onNavigateToGenerator={handleNavigateToGenerator}\n          />\n        );\n      case \"causal\":\n        return (\n          <CausalLoopEditor\n            pressures={pressures}\n            generators={generators}\n            systems={systems}\n            actions={actions}\n            schema={schema}\n            usageMap={usageMap}\n          />\n        );\n      case \"pressures\":\n        return (\n          <PressuresEditor\n            projectId={projectId}\n            pressures={pressures}\n            onChange={onPressuresChange || (() => {})}\n            schema={schema}\n            usageMap={usageMap}\n          />\n        );\n      case \"eras\":\n        return (\n          <ErasEditor\n            eras={eras}\n            onChange={onErasChange || (() => {})}\n            generators={generators}\n            systems={systems}\n            pressures={pressures}\n            schema={schema}\n            usageMap={usageMap}\n          />\n        );\n      case \"matrix\":\n        return (\n          <WeightMatrixEditor\n            generators={generators}\n            systems={systems}\n            eras={eras}\n            onErasChange={onErasChange || (() => {})}\n          />\n        );\n      case \"generators\":\n        return (\n          <GeneratorsEditor\n            projectId={projectId}\n            generators={generators}\n            onChange={onGeneratorsChange || (() => {})}\n            schema={schema}\n            pressures={pressures}\n            eras={eras}\n            usageMap={usageMap}\n          />\n        );\n      case \"actions\":\n        return (\n          <ActionsEditor\n            projectId={projectId}\n            actions={actions}\n            onChange={onActionsChange || (() => {})}\n            schema={schema}\n            pressures={pressures}\n            usageMap={usageMap}\n          />\n        );\n      case \"systems\":\n        return (\n          <SystemsEditor\n            projectId={projectId}\n            systems={systems}\n            onChange={onSystemsChange || (() => {})}\n            schema={schema}\n            pressures={pressures}\n            usageMap={usageMap}\n          />\n        );\n      default:\n        return (\n          <div className=\"cer-placeholder\">\n            <div className=\"cer-placeholder-icon\"></div>\n            <div className=\"cer-placeholder-title\">{currentSection.title}</div>\n            <div className=\"cer-placeholder-desc\">{currentSection.description}</div>\n          </div>\n        );\n    }\n  };\n\n  return (\n    <div className=\"cer-container\">\n      {/* Left sidebar with nav */}\n      <div className=\"cer-sidebar\">\n        <nav className=\"cer-nav\">\n          {TABS.map((tab) => {\n            // Show status indicator for validation tab\n            const showStatus = tab.id === \"validation\";\n            const statusColor = STATUS_COLORS[validationStatus.status];\n\n            return (\n              <button\n                key={tab.id}\n                onClick={() => setActiveTab(tab.id)}\n                className={`cer-nav-button ${activeTab === tab.id ? \"cer-nav-button-active\" : \"cer-nav-button-inactive\"}`}\n              >\n                <span className=\"cer-nav-button-content\">\n                  <span>{tab.label}</span>\n                  {showStatus && (\n                    <span\n                      className=\"cer-status-dot\"\n                      // eslint-disable-next-line local/no-inline-styles -- dynamic color from validation status\n                      style={{ '--cer-status-color': statusColor, backgroundColor: 'var(--cer-status-color)' }}\n                      title={(() => {\n                        if (validationStatus.status === \"clean\") return \"All validations passed\";\n                        const plural = validationStatus.totalIssues === 1 ? \"\" : \"s\";\n                        return `${validationStatus.totalIssues} issue${plural}`;\n                      })()}\n                    />\n                  )}\n                </span>\n              </button>\n            );\n          })}\n        </nav>\n      </div>\n\n      {/* Main content area */}\n      <div className=\"cer-main\">\n        <div className=\"cer-content\">{renderContent()}</div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  schema,\n  eras = [],\n  onErasChange,\n  pressures = [],\n  onPressuresChange,\n  generators = [],\n  onGeneratorsChange,\n  actions = [],\n  onActionsChange,\n  systems = [],\n  onSystemsChange,\n  activeSection,\n  onSectionChange,\n}", "type": "{ projectId: any; schema: any; eras?: any[]; onErasChange: any; pressures?: any[]; onPressuresChange: any; generators?: any[]; onGeneratorsChange: any; actions?: any[]; onActionsChange: any; systems?: any[]; onSystemsChange: any; activeSection: any; onSectionChange: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/ActionsEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/ActionsEditor.jsx", "sourceCode": "export default function ActionsEditor({\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"actions:selected\");\n  const {\n    selectedItem: selectedAction,\n    handleItemChange: handleActionChange,\n    handleToggle,\n    handleDelete,\n    handleAdd: handleAddAction,\n    handleSelect,\n    handleClose,\n  } = useEditorState(actions, onChange, { createItem: createAction, persistKey: selectionKey });\n\n  // Collect unique pressures across all actions\n  const uniquePressures = new Set();\n  actions.forEach((action) => {\n    (action.probability?.pressureModifiers || []).forEach((mod) => {\n      if (mod.pressure) uniquePressures.add(mod.pressure);\n    });\n  });\n\n  return (\n    <div className=\"actions-editor\">\n      <div className=\"actions-header\">\n        <h1 className=\"actions-title\">Actions</h1>\n        <p className=\"actions-subtitle\">\n          Actions define what agents can do during the simulation via the universal catalyst system.\n          Click an action to edit.\n        </p>\n        <div className=\"actions-stats\">\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Total Actions</span>\n            <span className=\"actions-stat-value\">{actions.length}</span>\n          </div>\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Pressures Referenced</span>\n            <span className=\"actions-stat-value\">{uniquePressures.size}</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"actions-grid\">\n        {actions.map((action, index) => (\n          <ActionListCard\n            key={action.id}\n            action={action}\n            onClick={() => handleSelect(index)}\n            onToggle={() => handleToggle(action)}\n            usageMap={usageMap}\n          />\n        ))}\n\n        <div className=\"actions-add-card\" onClick={() => handleAddAction()} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n          <span className=\"text-2xl\">+</span>\n          <span>Add Action</span>\n        </div>\n      </div>\n\n      {selectedAction && (\n        <ActionModal\n          action={selectedAction}\n          onChange={handleActionChange}\n          onClose={handleClose}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; actions?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/CausalLoopEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/CausalLoopEditor.jsx", "sourceCode": "export default function CausalLoopEditor({\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}) {\n  const containerRef = useRef(null);\n  const graphRef = useRef(null);\n  const [dimensions, setDimensions] = useState({ width: 800, height: 600 });\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [showLegend, setShowLegend] = useState(true);\n  const [showDisabled, setShowDisabled] = useState(true);\n  const [hoverNode, setHoverNode] = useState(null);\n\n  // Resize observer\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const updateDimensions = () => {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDimensions({\n        width: rect.width || 800,\n        height: Math.max(500, window.innerHeight - rect.top - 100),\n      });\n    };\n\n    updateDimensions();\n    const observer = new ResizeObserver(updateDimensions);\n    observer.observe(containerRef.current);\n    window.addEventListener(\"resize\", updateDimensions);\n\n    return () => {\n      observer.disconnect();\n      window.removeEventListener(\"resize\", updateDimensions);\n    };\n  }, []);\n\n  // Extract graph data\n  const {\n    nodes: graphNodes,\n    links: graphLinks,\n    warnings,\n  } = useMemo(\n    () =>\n      extractCausalGraph(pressures, generators, systems, actions, schema, showDisabled, usageMap),\n    [pressures, generators, systems, actions, schema, showDisabled, usageMap]\n  );\n  const graphData = useMemo(\n    () => ({ nodes: graphNodes, links: graphLinks }),\n    [graphNodes, graphLinks]\n  );\n\n  // Count disabled nodes for UI\n  const disabledCount = useMemo(() => {\n    const allNodes = extractCausalGraph(\n      pressures,\n      generators,\n      systems,\n      actions,\n      schema,\n      true,\n      usageMap\n    ).nodes;\n    return allNodes.filter((n) => n.isDisabled).length;\n  }, [pressures, generators, systems, actions, schema, usageMap]);\n\n  // Detect loops\n  const loops = useMemo(() => detectLoops(graphData.nodes, graphData.links), [graphData]);\n\n  const reinforcingLoops = loops.filter((l) => l.type === \"reinforcing\");\n  const balancingLoops = loops.filter((l) => l.type === \"balancing\");\n\n  // Node styling\n  const nodeCanvasObject = useCallback(\n    (node, ctx, globalScale) => {\n      const label = node.label;\n      const fontSize = Math.max(10 / globalScale, 3);\n      const abbrevFontSize = Math.max(8 / globalScale, 3);\n      const nodeRadius = Math.sqrt(node.val) * 3;\n      const isDisabled = node.isDisabled;\n\n      // Draw node circle with opacity for disabled\n      ctx.beginPath();\n      ctx.arc(node.x, node.y, nodeRadius, 0, 2 * Math.PI);\n      ctx.fillStyle = isDisabled ? `${node.color}60` : node.color;\n      ctx.fill();\n\n      // Strikethrough pattern for disabled nodes\n      if (isDisabled) {\n        ctx.strokeStyle = \"#64748b\";\n        ctx.lineWidth = 1 / globalScale;\n        ctx.setLineDash([2 / globalScale, 2 / globalScale]);\n        ctx.stroke();\n        ctx.setLineDash([]);\n      }\n\n      // Highlight selected/hovered\n      if (selectedNode === node.id || hoverNode === node.id) {\n        ctx.strokeStyle = \"#ffffff\";\n        ctx.lineWidth = 2 / globalScale;\n        ctx.stroke();\n      }\n\n      // Draw abbreviation inside node\n      ctx.font = `bold ${abbrevFontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"middle\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#0a1929\";\n      ctx.fillText(node.abbrev || \"?\", node.x, node.y);\n\n      // Draw label below node\n      ctx.font = `${fontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"top\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#e2e8f0\";\n      const displayLabel = label.length > 15 ? label.slice(0, 13) + \"...\" : label;\n      ctx.fillText(displayLabel, node.x, node.y + nodeRadius + 2);\n    },\n    [selectedNode, hoverNode]\n  );\n\n  // Link styling\n  const linkColor = useCallback((link) => {\n    return EDGE_COLORS[link.polarity] || EDGE_COLORS.neutral;\n  }, []);\n\n  const linkWidth = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? 1 : 2;\n  }, []);\n\n  const linkLineDash = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? [4, 4] : [];\n  }, []);\n\n  // Handle node click\n  const handleNodeClick = useCallback(\n    (node) => {\n      setSelectedNode(selectedNode === node.id ? null : node.id);\n    },\n    [selectedNode]\n  );\n\n  // Zoom to fit on load\n  useEffect(() => {\n    if (graphRef.current && graphData.nodes.length > 0) {\n      setTimeout(() => {\n        graphRef.current.zoomToFit(400, 60);\n      }, 500);\n    }\n  }, [graphData.nodes.length]);\n\n  const selectedNodeData = selectedNode ? graphData.nodes.find((n) => n.id === selectedNode) : null;\n\n  // Get edges for selected node\n  const selectedNodeEdges = useMemo(() => {\n    if (!selectedNode) return { incoming: [], outgoing: [] };\n    return {\n      incoming: graphData.links.filter((l) => {\n        const targetId = typeof l.target === \"object\" ? l.target.id : l.target;\n        return targetId === selectedNode;\n      }),\n      outgoing: graphData.links.filter((l) => {\n        const sourceId = typeof l.source === \"object\" ? l.source.id : l.source;\n        return sourceId === selectedNode;\n      }),\n    };\n  }, [selectedNode, graphData.links]);\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Causal Loop Diagram</h1>\n        <p className=\"subtitle\">\n          Visualize feedback loops between pressures, generators, systems, and entity kinds.\n          {loops.length > 0 && (\n            <span className=\"cl-loop-count\">\n              <span className=\"cl-loop-reinforcing\">{reinforcingLoops.length} reinforcing</span>\n              {\" / \"}\n              <span className=\"cl-loop-balancing\">{balancingLoops.length} balancing</span>\n              {\" loops detected\"}\n            </span>\n          )}\n        </p>\n      </div>\n\n      <div className=\"cl-toolbar\">\n        <button className=\"button-secondary\" onClick={() => setShowLegend(!showLegend)}>\n          {showLegend ? \"Hide\" : \"Show\"} Legend\n        </button>\n        {disabledCount > 0 && (\n          <button\n            className=\"button-secondary\"\n            onClick={() => setShowDisabled(!showDisabled)}\n            // eslint-disable-next-line local/no-inline-styles -- dynamic opacity toggle\n            style={{ opacity: showDisabled ? 1 : 0.7 }}\n          >\n            {showDisabled ? \"Hide\" : \"Show\"} Disabled ({disabledCount})\n          </button>\n        )}\n        <button className=\"button-secondary\" onClick={() => graphRef.current?.zoomToFit(400, 60)}>\n          Fit to View\n        </button>\n        <div className=\"cl-stats\">\n          <span>{graphData.nodes.length} nodes</span>\n          <span>{graphData.links.length} edges</span>\n          {warnings.length > 0 && (\n            <span className=\"cl-stats-warning\">{warnings.length} warnings</span>\n          )}\n          <span className=\"cl-stats-hint\">Scroll to zoom, drag to pan</span>\n        </div>\n      </div>\n\n      {/* Warnings */}\n      {warnings.length > 0 && (\n        <div className=\"cl-warnings-box\">\n          <div className=\"cl-warnings-title\">\n            Referential Integrity Warnings\n          </div>\n          <div className=\"cl-warnings-list\">\n            {warnings.slice(0, 5).map((w, i) => (\n              <div key={i}>{w.message}</div>\n            ))}\n            {warnings.length > 5 && (\n              <div className=\"cl-warnings-more\">\n                ...and {warnings.length - 5} more warnings\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Legend */}\n      {showLegend && (\n        <div className=\"cl-legend\">\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Nodes:</span>\n            {Object.entries(NODE_TYPES).map(([type, config]) => (\n              <span key={type} className=\"cl-legend-item\">\n                <span\n                  className=\"cl-legend-node\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per node type\n                  style={{ '--cl-node-color': config.color, backgroundColor: 'var(--cl-node-color)' }}\n                >\n                  {config.abbrev}\n                </span>\n                <span className=\"cl-legend-node-label\">{config.label}</span>\n              </span>\n            ))}\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Edges:</span>\n            <span className=\"cl-legend-item cl-edge-positive\">+ Positive</span>\n            <span className=\"cl-legend-item cl-edge-negative\">- Negative</span>\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Loops:</span>\n            <span className=\"cl-legend-item cl-loop-reinforcing\">Reinforcing (unstable)</span>\n            <span className=\"cl-legend-item cl-loop-balancing\">Balancing (stable)</span>\n          </div>\n        </div>\n      )}\n\n      {/* Graph container */}\n      <div ref={containerRef} className=\"cl-graph-container\">\n        {graphData.nodes.length === 0 ? (\n          <div className=\"cl-empty-state\">\n            <div className=\"cl-empty-icon\">&#128260;</div>\n            <div className=\"cl-empty-title\">\n              No causal relationships found\n            </div>\n            <div className=\"cl-empty-desc\">\n              Add pressures with feedback factors, generators with state updates, or systems with\n              pressure changes to see the causal loop diagram.\n            </div>\n          </div>\n        ) : (\n          <ForceGraph2D\n            ref={graphRef}\n            graphData={graphData}\n            width={dimensions.width}\n            height={dimensions.height}\n            backgroundColor=\"#0f172a\"\n            nodeCanvasObject={nodeCanvasObject}\n            nodePointerAreaPaint={(node, color, ctx) => {\n              const nodeRadius = Math.sqrt(node.val) * 3;\n              ctx.beginPath();\n              ctx.arc(node.x, node.y, nodeRadius + 5, 0, 2 * Math.PI);\n              ctx.fillStyle = color;\n              ctx.fill();\n            }}\n            linkColor={linkColor}\n            linkWidth={linkWidth}\n            linkLineDash={linkLineDash}\n            linkDirectionalArrowLength={6}\n            linkDirectionalArrowRelPos={0.9}\n            linkCurvature={0.2}\n            onNodeClick={handleNodeClick}\n            onNodeHover={(node) => setHoverNode(node?.id || null)}\n// ... (truncated)", "parameters": [{"name": "{\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}", "type": "{ pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; schema?: {}; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/DependencyViewer.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/DependencyViewer.jsx", "sourceCode": "export default function DependencyViewer({ usageMap }) {\n  // Prepare entity kinds data\n  const entityKindsData = useMemo(() => {\n    if (!usageMap?.entityKinds) return [];\n    return Object.entries(usageMap.entityKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare relationship kinds data\n  const relationshipKindsData = useMemo(() => {\n    if (!usageMap?.relationshipKinds) return [];\n    return Object.entries(usageMap.relationshipKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare pressures data\n  const pressuresData = useMemo(() => {\n    if (!usageMap?.pressures) return [];\n    return Object.entries(usageMap.pressures)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare generators data\n  const generatorsData = useMemo(() => {\n    if (!usageMap?.generators) return [];\n    return Object.entries(usageMap.generators)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare systems data\n  const systemsData = useMemo(() => {\n    if (!usageMap?.systems) return [];\n    return Object.entries(usageMap.systems)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare tags data\n  const tagsData = useMemo(() => {\n    if (!usageMap?.tags) return [];\n    return Object.entries(usageMap.tags)\n      .map(([tag, usage]) => ({\n        id: tag,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  if (!usageMap) {\n    return (\n      <div className=\"dependency-viewer-container\">\n        <div className=\"dependency-empty-state\">Loading dependency data...</div>\n      </div>\n    );\n  }\n\n  const renderSchemaItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      <UsageBadges usage={item.usage} />\n    </div>\n  );\n\n  const renderEraItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      {item.eraCount > 0 ? (\n        <div className=\"dependency-used-by-list\">\n          <span className=\"dependency-badge dependency-badge-era\">\n            {item.eraCount} era{item.eraCount !== 1 ? \"s\" : \"\"}\n          </span>\n        </div>\n      ) : (\n        <span className=\"dependency-orphan-badge\">Not in any era</span>\n      )}\n    </div>\n  );\n\n  return (\n    <div className=\"dependency-viewer-container\">\n      <div className=\"dependency-viewer-header\">\n        <div className=\"dependency-viewer-title\">\n          <span>\ud83d\udd17</span>\n          <span>Dependencies</span>\n        </div>\n        <div className=\"dependency-viewer-legend\">\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-generators\" />\n            <span>Generators</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-systems\" />\n            <span>Systems</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-actions\" />\n            <span>Actions</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-eras\" />\n            <span>Eras</span>\n          </div>\n        </div>\n      </div>\n\n      <DependencySection\n        title=\"Entity Kinds\"\n        icon=\"\ud83d\udce6\"\n        items={entityKindsData}\n        renderItem={renderSchemaItem}\n        defaultExpanded={true}\n      />\n\n      <DependencySection\n        title=\"Relationship Kinds\"\n        icon=\"\ud83d\udd17\"\n        items={relationshipKindsData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection title=\"Tags\" icon=\"\ud83c\udff7\ufe0f\" items={tagsData} renderItem={renderSchemaItem} />\n\n      <DependencySection\n        title=\"Pressures\"\n        icon=\"\ud83d\udcca\"\n        items={pressuresData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection\n        title=\"Generators \u2192 Eras\"\n        icon=\"\u2728\"\n        items={generatorsData}\n        renderItem={renderEraItem}\n      />\n\n      <DependencySection\n        title=\"Systems \u2192 Eras\"\n        icon=\"\u2699\ufe0f\"\n        items={systemsData}\n        renderItem={renderEraItem}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{ usageMap }", "type": "{ usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/GeneratorsEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/GeneratorsEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.generators - Array of generator configurations\n * @param {Function} props.onChange - Callback when generators change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport default function GeneratorsEditor({\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"generators:selected\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [expandedCategories, setExpandedCategories] = useState({});\n\n  // Derive selected generator from index - this ensures we always have the latest data\n  const resolvedIndex = selectedId ? generators.findIndex((g) => g.id === selectedId) : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedGenerator = selectedIndex !== null ? generators[selectedIndex] : null;\n\n  // Build entity kind info map for icons and labels\n  const entityKindInfo = useMemo(() => {\n    const info = {};\n    (schema?.entityKinds || []).forEach((ek) => {\n      info[ek.kind] = {\n        label: ek.description || ek.name || ek.kind,\n        icon: ek.icon || DEFAULT_KIND_ICONS[ek.kind] || \"\ud83d\udce6\",\n      };\n    });\n    return info;\n  }, [schema]);\n\n  // Group generators by the primary entity kind they create\n  const groupedGenerators = useMemo(() => {\n    const groups = {};\n\n    generators.forEach((generator) => {\n      // Get primary creation kind (first entity created, or target kind if no creation)\n      const createdKinds = (generator.creation || []).map((c) => c.kind).filter(Boolean);\n      const primaryKind = createdKinds[0] || generator.selection?.kind || \"uncategorized\";\n\n      if (!groups[primaryKind]) {\n        groups[primaryKind] = [];\n      }\n      groups[primaryKind].push(generator);\n    });\n\n    return groups;\n  }, [generators]);\n\n  // Get ordered list of categories\n  const categories = useMemo(() => {\n    // Order by schema entity kinds first, then any uncategorized\n    const schemaKinds = (schema?.entityKinds || []).map((ek) => ek.kind);\n    const usedKinds = Object.keys(groupedGenerators);\n\n    // Sort: schema kinds in order, then others alphabetically\n    return usedKinds.sort((a, b) => {\n      const aIdx = schemaKinds.indexOf(a);\n      const bIdx = schemaKinds.indexOf(b);\n      if (aIdx >= 0 && bIdx >= 0) return aIdx - bIdx;\n      if (aIdx >= 0) return -1;\n      if (bIdx >= 0) return 1;\n      return a.localeCompare(b);\n    });\n  }, [groupedGenerators, schema]);\n\n  // Initialize expanded state for new categories\n  useEffect(() => {\n    const needsUpdate = categories.some((cat) => expandedCategories[cat] === undefined);\n    if (!needsUpdate) return;\n    const updated = { ...expandedCategories };\n    categories.forEach((cat) => {\n      if (updated[cat] === undefined) {\n        updated[cat] = true;\n      }\n    });\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync category expansion defaults when categories change\n    setExpandedCategories(updated);\n  }, [categories, expandedCategories]);\n\n  // Restore selectedId from storage when selectionKey changes\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted selection when key changes\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  // Persist selectedId to storage\n  useEffect(() => {\n    if (!selectionKey) return;\n    if (selectedId) {\n      saveStoredValue(selectionKey, selectedId);\n    } else {\n      clearStoredValue(selectionKey);\n    }\n  }, [selectionKey, selectedId]);\n\n  // Clear invalid selectedId (during render)\n  if (selectedId && selectedIndex === null) {\n    setSelectedId(null);\n    clearStoredValue(selectionKey);\n  }\n\n  const handleGeneratorChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex < generators.length) {\n        const newGenerators = [...generators];\n        newGenerators[selectedIndex] = updated;\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (generator) => {\n      const index = generators.findIndex((g) => g.id === generator.id);\n      if (index >= 0) {\n        const newGenerators = [...generators];\n        newGenerators[index] = {\n          ...generator,\n          enabled: generator.enabled === false ? true : false,\n        };\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedGenerator &&\n      confirm(`Delete generator \"${selectedGenerator.name || selectedGenerator.id}\"?`)\n    ) {\n      const newGenerators = [...generators];\n      newGenerators.splice(selectedIndex, 1);\n      onChange(newGenerators);\n      setSelectedId(null);\n    }\n  }, [generators, onChange, selectedIndex, selectedGenerator]);\n\n  const handleAdd = useCallback(() => {\n    const newGenerator = {\n      id: `generator_${Date.now()}`,\n      name: \"New Generator\",\n      applicability: [],\n      selection: { strategy: \"by_kind\", kind: \"location\", pickStrategy: \"random\" },\n      creation: [],\n      relationships: [],\n      stateUpdates: [],\n      variables: {},\n    };\n    onChange([...generators, newGenerator]);\n    setSelectedId(newGenerator.id);\n  }, [generators, onChange]);\n\n  const handleDuplicate = useCallback(() => {\n    if (!selectedGenerator) return;\n    const duplicated = {\n      ...JSON.parse(JSON.stringify(selectedGenerator)), // Deep clone\n      id: `${selectedGenerator.id}_copy_${Date.now()}`,\n      name: `${selectedGenerator.name || selectedGenerator.id} (Copy)`,\n    };\n    onChange([...generators, duplicated]);\n    setSelectedId(duplicated.id);\n  }, [generators, onChange, selectedGenerator]);\n\n  const toggleCategoryExpand = useCallback((kind) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [kind]: !prev[kind],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (kind) => {\n      const categoryItems = groupedGenerators[kind] || [];\n      const allEnabled = categoryItems.every((g) => g.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of generators in this category\n      const categoryIds = new Set(categoryItems.map((g) => g.id));\n\n      const newGenerators = generators.map((g) => {\n        if (categoryIds.has(g.id)) {\n          return { ...g, enabled: newEnabled };\n        }\n        return g;\n      });\n      onChange(newGenerators);\n    },\n    [generators, groupedGenerators, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Generators</h1>\n        <p className=\"subtitle\">\n          Configure entity generators that populate your world. Click a generator to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((kind) => {\n        const kindInfo = entityKindInfo[kind] || {\n          label: kind.charAt(0).toUpperCase() + kind.slice(1),\n          icon: DEFAULT_KIND_ICONS[kind] || \"\ud83d\udce6\",\n        };\n        const categoryItems = groupedGenerators[kind] || [];\n        const allEnabled = categoryItems.every((g) => g.enabled !== false);\n\n        return (\n          <CategorySection\n            key={kind}\n            id={kind}\n            icon={kindInfo.icon}\n            label={`${kindInfo.label} Generators`}\n            items={categoryItems}\n            expanded={expandedCategories[kind] !== false}\n            onToggleExpand={() => toggleCategoryExpand(kind)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(kind)}\n            renderItem={(generator) => (\n              <GeneratorListCard\n                key={generator.id}\n                generator={generator}\n                onClick={() => setSelectedId(generator.id)}\n                onToggle={() => handleToggle(generator)}\n                usageMap={usageMap}\n              />\n            )}\n          />\n        );\n      })}\n\n      {/* Add Generator button */}\n      <div className=\"mt-lg\">\n        <AddCard onClick={handleAdd} label=\"Add Generator\" />\n      </div>\n\n      {selectedGenerator && (\n        <GeneratorModal\n          generator={selectedGenerator}\n          onChange={handleGeneratorChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          onDuplicate={handleDuplicate}\n          schema={schema}\n          pressures={pressures}\n          eras={eras}\n          usageMap={usageMap}\n          tagRegistry={schema.tagRegistry || []}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}", "type": "{ generators: any[]; onChange: Function; schema: any; pressures: any[]; eras: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/NamingProfileMappingViewer.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/NamingProfileMappingViewer.jsx", "sourceCode": "export default function NamingProfileMappingViewer({ generators = [], schema = {} }) {\n  const [showInherited, setShowInherited] = useState(false);\n\n  const { mappings, warnings } = useMemo(\n    () => analyzeNamingMappings(generators, schema),\n    [generators, schema]\n  );\n\n  // Group by generator for display\n  const groupedMappings = useMemo(() => {\n    const groups = {};\n    for (const m of mappings) {\n      if (!groups[m.generatorId]) {\n        groups[m.generatorId] = {\n          generatorId: m.generatorId,\n          generatorName: m.generatorName,\n          items: [],\n        };\n      }\n      groups[m.generatorId].items.push(m);\n    }\n    return Object.values(groups);\n  }, [mappings]);\n\n  // Filter warnings - show all by default, but can filter to just explicit cultures\n  const displayWarnings = showInherited\n    ? warnings\n    : warnings.filter(\n        (w) => w.cultureSource === \"explicit\" || w.reason === \"No matching strategy group\"\n      );\n\n  const successCount = mappings.filter((m) => m.match).length;\n  const warningCount = warnings.filter((w) => w.reason === \"No matching strategy group\").length;\n\n  if (mappings.length === 0) {\n    return (\n      <div className=\"naming-profile-container\">\n        <div className=\"naming-profile-header\">\n          <div className=\"naming-profile-title\">\n            <span>Naming Profile Mappings</span>\n          </div>\n        </div>\n        <div className=\"naming-profile-empty-state\">\n          No generators with entity creation defined. Add generators to see naming profile mappings.\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"naming-profile-container\">\n      <div className=\"naming-profile-header\">\n        <div className=\"naming-profile-title\">\n          <span>Naming Profile Mappings</span>\n        </div>\n        <div className=\"naming-profile-stats\">\n          <div className=\"naming-profile-stat-item\">\n            <span className=\"naming-profile-stat-value text-success\">{successCount}</span>\n            <span>matched</span>\n          </div>\n          <div className=\"naming-profile-stat-item\">\n            <span\n              className={`naming-profile-stat-value ${warningCount > 0 ? \"text-danger\" : \"text-muted\"}`}\n            >\n              {warningCount}\n            </span>\n            <span>missing</span>\n          </div>\n          <label className=\"cursor-pointer flex items-center gap-xs\">\n            <input\n              type=\"checkbox\"\n              checked={showInherited}\n              onChange={(e) => setShowInherited(e.target.checked)}\n            />\n            <span>Show inherited cultures</span>\n          </label>\n        </div>\n      </div>\n\n      <div className=\"naming-profile-content\">\n        {/* Warnings section */}\n        {displayWarnings.length > 0 && (\n          <div className=\"naming-profile-section\">\n            <div className=\"naming-profile-section-title\">\n              <span className=\"naming-profile-warning-icon\">Warning</span>\n              <span>Naming May Fail ({displayWarnings.length})</span>\n            </div>\n            <div className=\"naming-profile-warning-list\">\n              {displayWarnings.slice(0, 10).map((w, i) => (\n                <div\n                  key={`${w.generatorId}-${w.cultureId}-${i}`}\n                  className=\"naming-profile-warning-item\"\n                >\n                  <span className=\"naming-profile-warning-icon\">!</span>\n                  <span>\n                    <strong>{w.generatorName}</strong> creates <strong>{w.entityKind}</strong>\n                    {w.subtype && `:${w.subtype}`} for culture <strong>{w.cultureName}</strong> -{\" \"}\n                    {w.reason}\n                  </span>\n                </div>\n              ))}\n              {displayWarnings.length > 10 && (\n                <div\n                  className=\"text-muted py-md px-lg\"\n                >\n                  ... and {displayWarnings.length - 10} more\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Mappings table */}\n        <div className=\"naming-profile-section\">\n          <div className=\"naming-profile-section-title\">\n            <span>Entity Creation to Naming Profile</span>\n          </div>\n          <table className=\"naming-profile-mapping-table\">\n            <thead>\n              <tr>\n                <th className=\"naming-profile-table-header\">Generator</th>\n                <th className=\"naming-profile-table-header\">Entity Kind</th>\n                <th className=\"naming-profile-table-header\">Culture</th>\n                <th className=\"naming-profile-table-header\">Naming Profile</th>\n              </tr>\n            </thead>\n            <tbody>\n              {groupedMappings.slice(0, 20).flatMap((group) => {\n                // Filter items based on showInherited toggle\n                const filteredItems = showInherited\n                  ? group.items\n                  : group.items.filter(\n                      (m) => m.cultureSource === \"explicit\" || m.cultureSource === \"any\"\n                    );\n                // If no explicit cultures, show first inherited one as representative\n                const displayItems =\n                  filteredItems.length > 0 ? filteredItems : group.items.slice(0, 1);\n                return displayItems.map((m, idx) => (\n                  <tr\n                    key={`${m.generatorId}-${m.cultureId}-${m.entityKind}-${idx}`}\n                    className={`naming-profile-table-row ${!m.match && m.hasNamingProfile ? \"naming-profile-warning-row\" : \"\"}`}\n                  >\n                    <td className=\"naming-profile-table-cell naming-profile-generator-cell\">\n                      {idx === 0 ? m.generatorName : \"\"}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <span className=\"naming-profile-kind-badge\">{m.entityKind}</span>\n                      {m.subtype && (\n                        <span\n                          className=\"naming-profile-kind-badge naming-profile-kind-badge-transparent\"\n                        >\n                          {m.subtype}\n                        </span>\n                      )}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <div className=\"naming-profile-culture-cell\">\n                        {/* eslint-disable-next-line local/no-inline-styles -- dynamic culture color */}\n                        <span\n                          className=\"naming-profile-culture-dot\"\n                          style={{ '--npm-culture-color': m.cultureColor, backgroundColor: 'var(--npm-culture-color)' }}\n                        />\n                        <span>{m.cultureName}</span>\n                        {m.cultureSource === \"inherited\" && (\n                          <span className=\"naming-profile-badge naming-profile-badge-inherited\">\n                            inherited\n                          </span>\n                        )}\n                      </div>\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      {m.match && (\n                        <span className=\"naming-profile-badge naming-profile-badge-match\">\n                          {m.match.profileName || m.match.profileId}\n                          {m.match.groupName && ` / ${m.match.groupName}`}\n                        </span>\n                      )}\n                      {!m.match && !m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No profiles configured\n                        </span>\n                      )}\n                      {!m.match && m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No matching group\n                        </span>\n                      )}\n                    </td>\n                  </tr>\n                ));\n              })}\n            </tbody>\n          </table>\n          {groupedMappings.length > 20 && (\n            <div className=\"text-muted text-center text-xs p-md\">\n              Showing first 20 generators. Total: {groupedMappings.length}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generators = [], schema = {} }", "type": "{ generators?: any[]; schema?: {}; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/PressuresEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/PressuresEditor.jsx", "sourceCode": "export default function PressuresEditor({ projectId, pressures = [], onChange, schema, usageMap }) {\n  const [expandedPressure, setExpandedPressure] = useState(null);\n  const factorModalKey = buildStorageKey(projectId, \"pressures:factorModal\");\n  const restoredRef = useRef(false);\n\n  useEffect(() => {\n    restoredRef.current = false;\n  }, [factorModalKey]);\n\n  // Restore expanded pressure from storage (one-time per modal key)\n  useEffect(() => {\n    if (restoredRef.current || !factorModalKey || pressures.length === 0) return;\n\n    const stored = loadStoredValue(factorModalKey);\n    if (stored?.pressureId) {\n      const index = pressures.findIndex((pressure) => pressure.id === stored.pressureId);\n      if (index >= 0) {\n        // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted UI expansion state\n        setExpandedPressure(index);\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    }\n    restoredRef.current = true;\n  }, [factorModalKey, pressures]);\n\n  const handlePressureChange = useCallback(\n    (index, updatedPressure) => {\n      const newPressures = [...pressures];\n      newPressures[index] = updatedPressure;\n      onChange(newPressures);\n    },\n    [pressures, onChange]\n  );\n\n  const handleDeletePressure = useCallback(\n    (index) => {\n      if (confirm(`Delete \"${pressures[index].name}\"?`)) {\n        const newPressures = pressures.filter((_, i) => i !== index);\n        onChange(newPressures);\n        if (expandedPressure === index) {\n          setExpandedPressure(null);\n        }\n      }\n    },\n    [pressures, onChange, expandedPressure]\n  );\n\n  const handleAddPressure = useCallback(() => {\n    const newPressure = {\n      id: `pressure_${Date.now()}`,\n      name: \"New Pressure\",\n      initialValue: 0,\n      homeostasis: 0.05,\n      description: \"\",\n      growth: {\n        positiveFeedback: [],\n        negativeFeedback: [],\n      },\n    };\n    onChange([...pressures, newPressure]);\n    setExpandedPressure(pressures.length);\n  }, [pressures, onChange]);\n\n  if (pressures.length === 0) {\n    return (\n      <div className=\"editor-container\">\n        <div className=\"header\">\n          <h1 className=\"title\">Pressures</h1>\n          <p className=\"subtitle\">\n            Configure environmental and social pressures that drive world evolution\n          </p>\n        </div>\n        <div className=\"empty-state\">\n          <div className=\"empty-state-icon\">\ud83c\udf21\ufe0f</div>\n          <div className=\"pe-empty-title\">\n            No pressures defined\n          </div>\n          <div className=\"pe-empty-desc\">\n            Pressures respond to world state with feedback and a pull toward equilibrium, driving\n            the narrative forward.\n          </div>\n          <button\n            className=\"btn btn-primary pe-create-btn\"\n            onClick={handleAddPressure}\n          >\n            + Create First Pressure\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Pressures</h1>\n        <p className=\"subtitle\">\n          Configure environmental and social pressures that drive world evolution. Each pressure has\n          feedback factors that make it grow or shrink based on world state plus a homeostatic pull\n          toward equilibrium.\n        </p>\n      </div>\n\n      <div className=\"list-stack\">\n        {pressures.map((pressure, index) => (\n          <PressureCard\n            key={index}\n            pressure={pressure}\n            expanded={expandedPressure === index}\n            onToggle={() => setExpandedPressure(expandedPressure === index ? null : index)}\n            onChange={(updatedPressure) => handlePressureChange(index, updatedPressure)}\n            onDelete={() => handleDeletePressure(index)}\n            schema={schema}\n            usageMap={usageMap}\n            projectId={projectId}\n          />\n        ))}\n\n        <button className=\"btn btn-add\" onClick={handleAddPressure}>\n          + Add Pressure\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ projectId, pressures = [], onChange, schema, usageMap }", "type": "{ projectId: any; pressures?: any[]; onChange: any; schema: any; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/SystemsEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/SystemsEditor.jsx", "sourceCode": "export default function SystemsEditor({\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"systems:selected\");\n  const typePickerKey = buildStorageKey(projectId, \"systems:typePicker\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [showTypePicker, setShowTypePicker] = useState(\n    () => loadStoredValue(typePickerKey) === true\n  );\n\n  // Derive selectedSystem from index\n  const resolvedIndex = selectedId\n    ? systems.findIndex((system) => system.config?.id === selectedId)\n    : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedSystem = selectedIndex !== null ? systems[selectedIndex] : null;\n  const [expandedCategories, setExpandedCategories] = useState(() => {\n    // Start with all categories expanded\n    return Object.keys(SYSTEM_CATEGORIES).reduce((acc, cat) => {\n      acc[cat] = true;\n      return acc;\n    }, {});\n  });\n  const mouseDownOnOverlay = useRef(false);\n\n  const handleOverlayMouseDown = useCallback((e) => {\n    mouseDownOnOverlay.current = e.target === e.currentTarget;\n  }, []);\n\n  const handleOverlayClick = useCallback((e) => {\n    if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n      setShowTypePicker(false);\n    }\n  }, []);\n\n  // Group systems by category (framework systems grouped together)\n  const groupedSystems = useMemo(() => {\n    const groups = {};\n    systems.forEach((system) => {\n      const category = getSystemCategory(system.systemType || \"unknown\");\n      if (!groups[category]) {\n        groups[category] = [];\n      }\n      groups[category].push(system);\n    });\n    return groups;\n  }, [systems]);\n\n  // Get ordered list of categories that have systems\n  const categories = useMemo(() => {\n    const usedCategories = Object.keys(groupedSystems);\n    // Sort by defined order in SYSTEM_CATEGORIES\n    return usedCategories.sort((a, b) => {\n      const orderA = SYSTEM_CATEGORIES[a]?.order ?? 999;\n      const orderB = SYSTEM_CATEGORIES[b]?.order ?? 999;\n      return orderA - orderB;\n    });\n  }, [groupedSystems]);\n\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  useEffect(() => {\n    setShowTypePicker(loadStoredValue(typePickerKey) === true);\n  }, [typePickerKey]);\n\n  useEffect(() => {\n    if (selectionKey) {\n      if (selectedId) {\n        saveStoredValue(selectionKey, selectedId);\n      } else {\n        clearStoredValue(selectionKey);\n      }\n    }\n  }, [selectionKey, selectedId]);\n\n  useEffect(() => {\n    if (typePickerKey) {\n      if (showTypePicker) {\n        saveStoredValue(typePickerKey, true);\n      } else {\n        clearStoredValue(typePickerKey);\n      }\n    }\n  }, [typePickerKey, showTypePicker]);\n\n  useEffect(() => {\n    if (selectedId && selectedIndex === null) {\n      setSelectedId(null);\n      clearStoredValue(selectionKey);\n    }\n  }, [selectedId, selectedIndex, selectionKey]);\n\n  const handleSystemChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex >= 0 && selectedIndex < systems.length) {\n        const newSystems = [...systems];\n        newSystems[selectedIndex] = updated;\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (system) => {\n      const index = systems.findIndex((s) => s.config?.id === system.config?.id);\n      if (index >= 0) {\n        const newSystems = [...systems];\n        newSystems[index] = { ...system, enabled: system.enabled === false ? true : false };\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedSystem &&\n      confirm(`Delete system \"${selectedSystem.config?.name || selectedSystem.config?.id}\"?`)\n    ) {\n      const newSystems = systems.filter((_, i) => i !== selectedIndex);\n      onChange(newSystems);\n      setSelectedId(null);\n    }\n  }, [systems, onChange, selectedIndex, selectedSystem]);\n\n  const handleAddSystem = useCallback(\n    (type) => {\n      const needsSelection = [\n        \"graphContagion\",\n        \"connectionEvolution\",\n        \"thresholdTrigger\",\n        \"clusterFormation\",\n        \"tagDiffusion\",\n        \"planeDiffusion\",\n      ].includes(type);\n      const newSystem = {\n        systemType: type,\n        config: {\n          id: `system_${Date.now()}`,\n          name: `New ${SYSTEM_TYPES[type]?.label || type}`,\n          description: \"\",\n          ...(needsSelection ? { selection: { strategy: \"by_kind\", kind: \"any\" } } : {}),\n        },\n      };\n      onChange([...systems, newSystem]);\n      setSelectedId(newSystem.config.id);\n      setShowTypePicker(false);\n    },\n    [systems, onChange]\n  );\n\n  const toggleCategoryExpand = useCallback((type) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [type]: !prev[type],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (category) => {\n      const categoryItems = groupedSystems[category] || [];\n      const allEnabled = categoryItems.every((s) => s.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of systems in this category\n      const categoryIds = new Set(categoryItems.map((s) => s.config?.id));\n\n      const newSystems = systems.map((s) => {\n        if (categoryIds.has(s.config?.id)) {\n          return { ...s, enabled: newEnabled };\n        }\n        return s;\n      });\n      onChange(newSystems);\n    },\n    [systems, groupedSystems, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Systems</h1>\n        <p className=\"subtitle\">\n          Configure simulation systems that run during the simulation phase. Click a system to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((category) => {\n        const categoryConfig = SYSTEM_CATEGORIES[category] || { icon: \"\u2699\ufe0f\", label: category };\n        const categoryItems = groupedSystems[category] || [];\n        const allEnabled = categoryItems.every((s) => s.enabled !== false);\n\n        return (\n          <CategorySection\n            key={category}\n            id={category}\n            icon={categoryConfig.icon}\n            label={categoryConfig.label}\n            items={categoryItems}\n            expanded={expandedCategories[category] !== false}\n            onToggleExpand={() => toggleCategoryExpand(category)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(category)}\n            gridClassName=\"list-grid\"\n            renderItem={(system) => {\n              const flatIndex = systems.findIndex((s) => s.config?.id === system.config?.id);\n              return (\n                <SystemListCard\n                  key={flatIndex}\n                  system={system}\n                  onClick={() => setSelectedId(system.config.id)}\n                  onToggle={() => handleToggle(system)}\n                  usageMap={usageMap}\n                />\n              );\n            }}\n          />\n        );\n      })}\n\n      {/* Add System button */}\n      <div className=\"mt-xl\">\n        <div\n          className=\"add-card se-add-card-wrap\"\n          onClick={() => setShowTypePicker(true)}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n        >\n          <span className=\"se-add-icon\">+</span>\n          <span>Add System</span>\n        </div>\n      </div>\n\n      {showTypePicker && (\n        <div\n          className=\"modal-overlay\"\n          onMouseDown={handleOverlayMouseDown}\n          onClick={handleOverlayClick}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n        >\n          <div className=\"modal se-type-picker-modal\">\n            <div className=\"modal-header\">\n              <div className=\"modal-title\">Choose System Type</div>\n              <button className=\"close-btn\" onClick={() => setShowTypePicker(false)}>\n                \u00d7\n              </button>\n            </div>\n            <div className=\"se-type-picker-content\">\n              <div className=\"type-picker\">\n                {Object.entries(SYSTEM_TYPES).map(([type, config]) => (\n                  <div\n                    key={type}\n                    className=\"se-type-option type-option\"\n                    onClick={() => handleAddSystem(type)}\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    <div className=\"type-option-icon\">{config.icon}</div>\n                    <div className=\"type-option-label\">{config.label}</div>\n                    <div className=\"type-option-desc\">{config.desc}</div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {selectedSystem && (\n        <SystemModal\n          system={selectedSystem}\n          onChange={handleSystemChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; systems?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/ValidationEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/ValidationEditor.jsx", "sourceCode": "export default function ValidationEditor({\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}) {\n  const validationResults = useMemo(\n    () => runValidations(usageMap, schema, eras, pressures, generators, systems),\n    [usageMap, schema, eras, pressures, generators, systems]\n  );\n\n  // Count orphans from usageMap for summary\n  const orphanCounts = useMemo(() => {\n    if (!usageMap?.validation?.orphans)\n      return { generators: 0, systems: 0, pressures: 0, total: 0 };\n    const orphans = usageMap.validation.orphans;\n    const generators = orphans.filter((o) => o.type === \"generator\").length;\n    const systems = orphans.filter((o) => o.type === \"system\").length;\n    const pressures = orphans.filter((o) => o.type === \"pressure\").length;\n    return { generators, systems, pressures, total: generators + systems + pressures };\n  }, [usageMap]);\n\n  const overallStatus = getOverallStatus(validationResults);\n  const totalIssues = validationResults.errors.length + validationResults.warnings.length;\n  const hasNamingProfiles = useMemo(\n    () => (schema.cultures || []).some((culture) => culture.naming?.profiles?.length),\n    [schema]\n  );\n\n  let statusModifier;\n  if (overallStatus === \"clean\") {\n    statusModifier = \"validation-status-clean\";\n  } else if (overallStatus === \"warning\") {\n    statusModifier = \"validation-status-warning\";\n  } else {\n    statusModifier = \"validation-status-error\";\n  }\n  const statusBadgeClass = `validation-status-badge ${statusModifier}`;\n\n  const handleItemClick = (itemId) => {\n    if (onNavigateToGenerator) {\n      onNavigateToGenerator(itemId);\n    }\n  };\n\n  // Count total affected items\n  const totalAffectedItems = [...validationResults.errors, ...validationResults.warnings].reduce(\n    (sum, issue) => sum + issue.affectedItems.length,\n    0\n  );\n\n  return (\n    <div className=\"validation-container\">\n      <div className=\"validation-header\">\n        <div className=\"flex-between items-start\">\n          <div>\n            <h1 className=\"validation-title\">\n              Validation\n              <span className={statusBadgeClass}>\n                {(() => {\n                  if (overallStatus === \"clean\") return \"All Clear\";\n                  const issueWord = totalIssues === 1 ? \"Issue\" : \"Issues\";\n                  return `${totalIssues} ${issueWord}`;\n                })()}\n              </span>\n            </h1>\n            <p className=\"validation-subtitle\">\n              Semantic validation: reference integrity, pressure balance, and dead code detection.\n              Structure validation runs automatically as a gate before simulation.\n            </p>\n          </div>\n          {totalIssues > 0 && (\n            <div className=\"validation-export-row\">\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsJson(validationResults)}\n                title=\"Export validation report as JSON\"\n              >\n                Export JSON\n              </button>\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsCsv(validationResults)}\n                title=\"Export validation report as CSV\"\n              >\n                Export CSV\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"validation-summary-cards validation-summary-cards-4\">\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-danger\">\n            {validationResults.errors.length}\n          </div>\n          <div className=\"validation-summary-label\">Errors</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-warning\">\n            {validationResults.warnings.length}\n          </div>\n          <div className=\"validation-summary-label\">Warnings</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div\n            className={`validation-summary-value ${orphanCounts.total > 0 ? \"text-muted\" : \"text-info\"}`}\n          >\n            {orphanCounts.total}\n          </div>\n          <div className=\"validation-summary-label\">Unused</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-info\">\n            {totalAffectedItems}\n          </div>\n          <div className=\"validation-summary-label\">Affected Items</div>\n        </div>\n      </div>\n\n      {/* Clean state */}\n      {overallStatus === \"clean\" && (\n        <div className=\"validation-clean-state\">\n          <div className=\"validation-clean-icon\">\u2713</div>\n          <div className=\"validation-clean-title\">All Validations Passed</div>\n          <div className=\"validation-clean-message\">\n            Your configuration looks good. No issues detected.\n          </div>\n        </div>\n      )}\n\n      {/* Errors section */}\n      {validationResults.errors.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u274c</span>\n              Errors\n            </div>\n            <span className=\"validation-section-count validation-status-error\">\n              {validationResults.errors.length}\n            </span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.errors.map((error) => (\n              <IssueCard key={error.id} issue={error} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Warnings section */}\n      {validationResults.warnings.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u26a0\ufe0f</span>\n              Warnings\n            </div>\n            <span className=\"validation-section-count\">{validationResults.warnings.length}</span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.warnings.map((warning) => (\n              <IssueCard key={warning.id} issue={warning} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Dependency Viewer */}\n      {usageMap && (\n        <div className=\"mb-2xl\">\n          <DependencyViewer usageMap={usageMap} />\n        </div>\n      )}\n\n      {/* Naming Profile Mappings */}\n      {hasNamingProfiles && (\n        <div className=\"mb-2xl\">\n          <NamingProfileMappingViewer generators={generators} schema={schema} />\n        </div>\n      )}\n\n      {/* Rule info */}\n      <div className=\"validation-rule-info\">\n        <div className=\"validation-rule-title\">\n          Active Validation Rules ({Object.keys(validationRules).length})\n        </div>\n        <ul className=\"validation-rule-list\">\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-danger\">\u25cf</span>\n            <strong>Reference Validation:</strong> Entity kinds (generators, pressures, systems),\n            relationship kinds (generators, pressures, systems), pressure IDs (generators, systems,\n            eras, actions), era\u2192generator/system references\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Balance Validation:</strong> Pressure sources/sinks (feedback, homeostasis,\n            generators, systems), orphan generators/systems (not in any era)\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Configuration Quality:</strong> Subtypes, statuses, cultures, tags, numeric\n            ranges\n          </li>\n        </ul>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}", "type": "{ schema?: Readonly<{ entityKinds: any[]; relationshipKinds: any[]; cultures: any[]; tagRegistry: any[]; }>; eras?: any[]; pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; usageMap?: any; onNavigateToGenerator: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/ValidationEditor.jsx::getValidationStatus", "name": "getValidationStatus", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/ValidationEditor.jsx", "sourceCode": "/**\n * Export validation status calculation for use by parent\n */\nexport function getValidationStatus(usageMap, schema, eras, pressures, generators, systems) {\n  const results = runValidations(\n    usageMap,\n    schema || { entityKinds: [], relationshipKinds: [], cultures: [], tagRegistry: [] },\n    eras || [],\n    pressures || [],\n    generators || [],\n    systems || []\n  );\n  return {\n    status: getOverallStatus(results),\n    errorCount: results.errors.length,\n    warningCount: results.warnings.length,\n    totalIssues: results.errors.length + results.warnings.length,\n  };\n}", "parameters": [{"name": "usageMap", "type": "any", "optional": false}, {"name": "schema", "type": "any", "optional": false}, {"name": "eras", "type": "any", "optional": false}, {"name": "pressures", "type": "any", "optional": false}, {"name": "generators", "type": "any", "optional": false}, {"name": "systems", "type": "any", "optional": false}], "returnType": "{ status: string; errorCount: number; warningCount: number; totalIssues: number; }"}, {"id": "apps/coherence-engine/webui/src/utils/persistence.js::buildStorageKey", "name": "buildStorageKey", "kind": "function", "filePath": "apps/coherence-engine/webui/src/utils/persistence.js", "sourceCode": "export function buildStorageKey(projectId, suffix) {\n  if (!projectId) return null;\n  return `${STORAGE_PREFIX}${projectId}:${suffix}`;\n}", "parameters": [{"name": "projectId", "type": "any", "optional": false}, {"name": "suffix", "type": "any", "optional": false}], "returnType": "string"}, {"id": "apps/coherence-engine/webui/src/utils/persistence.js::loadStoredValue", "name": "loadStoredValue", "kind": "function", "filePath": "apps/coherence-engine/webui/src/utils/persistence.js", "sourceCode": "export function loadStoredValue(key) {\n  if (!key || !canUseStorage()) return null;\n  try {\n    const raw = localStorage.getItem(key);\n    if (!raw) return null;\n    return JSON.parse(raw);\n  } catch {\n    return null;\n  }\n}", "parameters": [{"name": "key", "type": "any", "optional": false}], "returnType": "any"}, {"id": "apps/coherence-engine/webui/src/utils/persistence.js::saveStoredValue", "name": "saveStoredValue", "kind": "function", "filePath": "apps/coherence-engine/webui/src/utils/persistence.js", "sourceCode": "export function saveStoredValue(key, value) {\n  if (!key || !canUseStorage()) return;\n  try {\n    localStorage.setItem(key, JSON.stringify(value));\n  } catch {\n    // Best-effort only.\n  }\n}", "parameters": [{"name": "key", "type": "any", "optional": false}, {"name": "value", "type": "any", "optional": false}], "returnType": "void"}, {"id": "apps/coherence-engine/webui/src/utils/persistence.js::clearStoredValue", "name": "clearStoredValue", "kind": "function", "filePath": "apps/coherence-engine/webui/src/utils/persistence.js", "sourceCode": "export function clearStoredValue(key) {\n  if (!key || !canUseStorage()) return;\n  try {\n    localStorage.removeItem(key);\n  } catch {\n    // Best-effort only.\n  }\n}", "parameters": [{"name": "key", "type": "any", "optional": false}], "returnType": "void"}, {"id": "apps/coherence-engine/webui/src/components/actions/ActionsEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/actions/ActionsEditor.jsx", "sourceCode": "export default function ActionsEditor({\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"actions:selected\");\n  const {\n    selectedItem: selectedAction,\n    handleItemChange: handleActionChange,\n    handleToggle,\n    handleDelete,\n    handleAdd: handleAddAction,\n    handleSelect,\n    handleClose,\n  } = useEditorState(actions, onChange, { createItem: createAction, persistKey: selectionKey });\n\n  // Collect unique pressures across all actions\n  const uniquePressures = new Set();\n  actions.forEach((action) => {\n    (action.probability?.pressureModifiers || []).forEach((mod) => {\n      if (mod.pressure) uniquePressures.add(mod.pressure);\n    });\n  });\n\n  return (\n    <div className=\"actions-editor\">\n      <div className=\"actions-header\">\n        <h1 className=\"actions-title\">Actions</h1>\n        <p className=\"actions-subtitle\">\n          Actions define what agents can do during the simulation via the universal catalyst system.\n          Click an action to edit.\n        </p>\n        <div className=\"actions-stats\">\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Total Actions</span>\n            <span className=\"actions-stat-value\">{actions.length}</span>\n          </div>\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Pressures Referenced</span>\n            <span className=\"actions-stat-value\">{uniquePressures.size}</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"actions-grid\">\n        {actions.map((action, index) => (\n          <ActionListCard\n            key={action.id}\n            action={action}\n            onClick={() => handleSelect(index)}\n            onToggle={() => handleToggle(action)}\n            usageMap={usageMap}\n          />\n        ))}\n\n        <div className=\"actions-add-card\" onClick={() => handleAddAction()} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n          <span className=\"text-2xl\">+</span>\n          <span>Add Action</span>\n        </div>\n      </div>\n\n      {selectedAction && (\n        <ActionModal\n          action={selectedAction}\n          onChange={handleActionChange}\n          onClose={handleClose}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; actions?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/actions/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/actions/index.js", "sourceCode": "export default function ActionsEditor({\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"actions:selected\");\n  const {\n    selectedItem: selectedAction,\n    handleItemChange: handleActionChange,\n    handleToggle,\n    handleDelete,\n    handleAdd: handleAddAction,\n    handleSelect,\n    handleClose,\n  } = useEditorState(actions, onChange, { createItem: createAction, persistKey: selectionKey });\n\n  // Collect unique pressures across all actions\n  const uniquePressures = new Set();\n  actions.forEach((action) => {\n    (action.probability?.pressureModifiers || []).forEach((mod) => {\n      if (mod.pressure) uniquePressures.add(mod.pressure);\n    });\n  });\n\n  return (\n    <div className=\"actions-editor\">\n      <div className=\"actions-header\">\n        <h1 className=\"actions-title\">Actions</h1>\n        <p className=\"actions-subtitle\">\n          Actions define what agents can do during the simulation via the universal catalyst system.\n          Click an action to edit.\n        </p>\n        <div className=\"actions-stats\">\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Total Actions</span>\n            <span className=\"actions-stat-value\">{actions.length}</span>\n          </div>\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Pressures Referenced</span>\n            <span className=\"actions-stat-value\">{uniquePressures.size}</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"actions-grid\">\n        {actions.map((action, index) => (\n          <ActionListCard\n            key={action.id}\n            action={action}\n            onClick={() => handleSelect(index)}\n            onToggle={() => handleToggle(action)}\n            usageMap={usageMap}\n          />\n        ))}\n\n        <div className=\"actions-add-card\" onClick={() => handleAddAction()} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n          <span className=\"text-2xl\">+</span>\n          <span>Add Action</span>\n        </div>\n      </div>\n\n      {selectedAction && (\n        <ActionModal\n          action={selectedAction}\n          onChange={handleActionChange}\n          onClose={handleClose}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; actions?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/causal-loop/CausalLoopEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/causal-loop/CausalLoopEditor.jsx", "sourceCode": "export default function CausalLoopEditor({\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}) {\n  const containerRef = useRef(null);\n  const graphRef = useRef(null);\n  const [dimensions, setDimensions] = useState({ width: 800, height: 600 });\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [showLegend, setShowLegend] = useState(true);\n  const [showDisabled, setShowDisabled] = useState(true);\n  const [hoverNode, setHoverNode] = useState(null);\n\n  // Resize observer\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const updateDimensions = () => {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDimensions({\n        width: rect.width || 800,\n        height: Math.max(500, window.innerHeight - rect.top - 100),\n      });\n    };\n\n    updateDimensions();\n    const observer = new ResizeObserver(updateDimensions);\n    observer.observe(containerRef.current);\n    window.addEventListener(\"resize\", updateDimensions);\n\n    return () => {\n      observer.disconnect();\n      window.removeEventListener(\"resize\", updateDimensions);\n    };\n  }, []);\n\n  // Extract graph data\n  const {\n    nodes: graphNodes,\n    links: graphLinks,\n    warnings,\n  } = useMemo(\n    () =>\n      extractCausalGraph(pressures, generators, systems, actions, schema, showDisabled, usageMap),\n    [pressures, generators, systems, actions, schema, showDisabled, usageMap]\n  );\n  const graphData = useMemo(\n    () => ({ nodes: graphNodes, links: graphLinks }),\n    [graphNodes, graphLinks]\n  );\n\n  // Count disabled nodes for UI\n  const disabledCount = useMemo(() => {\n    const allNodes = extractCausalGraph(\n      pressures,\n      generators,\n      systems,\n      actions,\n      schema,\n      true,\n      usageMap\n    ).nodes;\n    return allNodes.filter((n) => n.isDisabled).length;\n  }, [pressures, generators, systems, actions, schema, usageMap]);\n\n  // Detect loops\n  const loops = useMemo(() => detectLoops(graphData.nodes, graphData.links), [graphData]);\n\n  const reinforcingLoops = loops.filter((l) => l.type === \"reinforcing\");\n  const balancingLoops = loops.filter((l) => l.type === \"balancing\");\n\n  // Node styling\n  const nodeCanvasObject = useCallback(\n    (node, ctx, globalScale) => {\n      const label = node.label;\n      const fontSize = Math.max(10 / globalScale, 3);\n      const abbrevFontSize = Math.max(8 / globalScale, 3);\n      const nodeRadius = Math.sqrt(node.val) * 3;\n      const isDisabled = node.isDisabled;\n\n      // Draw node circle with opacity for disabled\n      ctx.beginPath();\n      ctx.arc(node.x, node.y, nodeRadius, 0, 2 * Math.PI);\n      ctx.fillStyle = isDisabled ? `${node.color}60` : node.color;\n      ctx.fill();\n\n      // Strikethrough pattern for disabled nodes\n      if (isDisabled) {\n        ctx.strokeStyle = \"#64748b\";\n        ctx.lineWidth = 1 / globalScale;\n        ctx.setLineDash([2 / globalScale, 2 / globalScale]);\n        ctx.stroke();\n        ctx.setLineDash([]);\n      }\n\n      // Highlight selected/hovered\n      if (selectedNode === node.id || hoverNode === node.id) {\n        ctx.strokeStyle = \"#ffffff\";\n        ctx.lineWidth = 2 / globalScale;\n        ctx.stroke();\n      }\n\n      // Draw abbreviation inside node\n      ctx.font = `bold ${abbrevFontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"middle\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#0a1929\";\n      ctx.fillText(node.abbrev || \"?\", node.x, node.y);\n\n      // Draw label below node\n      ctx.font = `${fontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"top\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#e2e8f0\";\n      const displayLabel = label.length > 15 ? label.slice(0, 13) + \"...\" : label;\n      ctx.fillText(displayLabel, node.x, node.y + nodeRadius + 2);\n    },\n    [selectedNode, hoverNode]\n  );\n\n  // Link styling\n  const linkColor = useCallback((link) => {\n    return EDGE_COLORS[link.polarity] || EDGE_COLORS.neutral;\n  }, []);\n\n  const linkWidth = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? 1 : 2;\n  }, []);\n\n  const linkLineDash = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? [4, 4] : [];\n  }, []);\n\n  // Handle node click\n  const handleNodeClick = useCallback(\n    (node) => {\n      setSelectedNode(selectedNode === node.id ? null : node.id);\n    },\n    [selectedNode]\n  );\n\n  // Zoom to fit on load\n  useEffect(() => {\n    if (graphRef.current && graphData.nodes.length > 0) {\n      setTimeout(() => {\n        graphRef.current.zoomToFit(400, 60);\n      }, 500);\n    }\n  }, [graphData.nodes.length]);\n\n  const selectedNodeData = selectedNode ? graphData.nodes.find((n) => n.id === selectedNode) : null;\n\n  // Get edges for selected node\n  const selectedNodeEdges = useMemo(() => {\n    if (!selectedNode) return { incoming: [], outgoing: [] };\n    return {\n      incoming: graphData.links.filter((l) => {\n        const targetId = typeof l.target === \"object\" ? l.target.id : l.target;\n        return targetId === selectedNode;\n      }),\n      outgoing: graphData.links.filter((l) => {\n        const sourceId = typeof l.source === \"object\" ? l.source.id : l.source;\n        return sourceId === selectedNode;\n      }),\n    };\n  }, [selectedNode, graphData.links]);\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Causal Loop Diagram</h1>\n        <p className=\"subtitle\">\n          Visualize feedback loops between pressures, generators, systems, and entity kinds.\n          {loops.length > 0 && (\n            <span className=\"cl-loop-count\">\n              <span className=\"cl-loop-reinforcing\">{reinforcingLoops.length} reinforcing</span>\n              {\" / \"}\n              <span className=\"cl-loop-balancing\">{balancingLoops.length} balancing</span>\n              {\" loops detected\"}\n            </span>\n          )}\n        </p>\n      </div>\n\n      <div className=\"cl-toolbar\">\n        <button className=\"button-secondary\" onClick={() => setShowLegend(!showLegend)}>\n          {showLegend ? \"Hide\" : \"Show\"} Legend\n        </button>\n        {disabledCount > 0 && (\n          <button\n            className=\"button-secondary\"\n            onClick={() => setShowDisabled(!showDisabled)}\n            // eslint-disable-next-line local/no-inline-styles -- dynamic opacity toggle\n            style={{ opacity: showDisabled ? 1 : 0.7 }}\n          >\n            {showDisabled ? \"Hide\" : \"Show\"} Disabled ({disabledCount})\n          </button>\n        )}\n        <button className=\"button-secondary\" onClick={() => graphRef.current?.zoomToFit(400, 60)}>\n          Fit to View\n        </button>\n        <div className=\"cl-stats\">\n          <span>{graphData.nodes.length} nodes</span>\n          <span>{graphData.links.length} edges</span>\n          {warnings.length > 0 && (\n            <span className=\"cl-stats-warning\">{warnings.length} warnings</span>\n          )}\n          <span className=\"cl-stats-hint\">Scroll to zoom, drag to pan</span>\n        </div>\n      </div>\n\n      {/* Warnings */}\n      {warnings.length > 0 && (\n        <div className=\"cl-warnings-box\">\n          <div className=\"cl-warnings-title\">\n            Referential Integrity Warnings\n          </div>\n          <div className=\"cl-warnings-list\">\n            {warnings.slice(0, 5).map((w, i) => (\n              <div key={i}>{w.message}</div>\n            ))}\n            {warnings.length > 5 && (\n              <div className=\"cl-warnings-more\">\n                ...and {warnings.length - 5} more warnings\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Legend */}\n      {showLegend && (\n        <div className=\"cl-legend\">\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Nodes:</span>\n            {Object.entries(NODE_TYPES).map(([type, config]) => (\n              <span key={type} className=\"cl-legend-item\">\n                <span\n                  className=\"cl-legend-node\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per node type\n                  style={{ '--cl-node-color': config.color, backgroundColor: 'var(--cl-node-color)' }}\n                >\n                  {config.abbrev}\n                </span>\n                <span className=\"cl-legend-node-label\">{config.label}</span>\n              </span>\n            ))}\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Edges:</span>\n            <span className=\"cl-legend-item cl-edge-positive\">+ Positive</span>\n            <span className=\"cl-legend-item cl-edge-negative\">- Negative</span>\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Loops:</span>\n            <span className=\"cl-legend-item cl-loop-reinforcing\">Reinforcing (unstable)</span>\n            <span className=\"cl-legend-item cl-loop-balancing\">Balancing (stable)</span>\n          </div>\n        </div>\n      )}\n\n      {/* Graph container */}\n      <div ref={containerRef} className=\"cl-graph-container\">\n        {graphData.nodes.length === 0 ? (\n          <div className=\"cl-empty-state\">\n            <div className=\"cl-empty-icon\">&#128260;</div>\n            <div className=\"cl-empty-title\">\n              No causal relationships found\n            </div>\n            <div className=\"cl-empty-desc\">\n              Add pressures with feedback factors, generators with state updates, or systems with\n              pressure changes to see the causal loop diagram.\n            </div>\n          </div>\n        ) : (\n          <ForceGraph2D\n            ref={graphRef}\n            graphData={graphData}\n            width={dimensions.width}\n            height={dimensions.height}\n            backgroundColor=\"#0f172a\"\n            nodeCanvasObject={nodeCanvasObject}\n            nodePointerAreaPaint={(node, color, ctx) => {\n              const nodeRadius = Math.sqrt(node.val) * 3;\n              ctx.beginPath();\n              ctx.arc(node.x, node.y, nodeRadius + 5, 0, 2 * Math.PI);\n              ctx.fillStyle = color;\n              ctx.fill();\n            }}\n            linkColor={linkColor}\n            linkWidth={linkWidth}\n            linkLineDash={linkLineDash}\n            linkDirectionalArrowLength={6}\n            linkDirectionalArrowRelPos={0.9}\n            linkCurvature={0.2}\n            onNodeClick={handleNodeClick}\n            onNodeHover={(node) => setHoverNode(node?.id || null)}\n// ... (truncated)", "parameters": [{"name": "{\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}", "type": "{ pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; schema?: {}; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/causal-loop/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/causal-loop/index.js", "sourceCode": "export default function CausalLoopEditor({\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}) {\n  const containerRef = useRef(null);\n  const graphRef = useRef(null);\n  const [dimensions, setDimensions] = useState({ width: 800, height: 600 });\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [showLegend, setShowLegend] = useState(true);\n  const [showDisabled, setShowDisabled] = useState(true);\n  const [hoverNode, setHoverNode] = useState(null);\n\n  // Resize observer\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const updateDimensions = () => {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDimensions({\n        width: rect.width || 800,\n        height: Math.max(500, window.innerHeight - rect.top - 100),\n      });\n    };\n\n    updateDimensions();\n    const observer = new ResizeObserver(updateDimensions);\n    observer.observe(containerRef.current);\n    window.addEventListener(\"resize\", updateDimensions);\n\n    return () => {\n      observer.disconnect();\n      window.removeEventListener(\"resize\", updateDimensions);\n    };\n  }, []);\n\n  // Extract graph data\n  const {\n    nodes: graphNodes,\n    links: graphLinks,\n    warnings,\n  } = useMemo(\n    () =>\n      extractCausalGraph(pressures, generators, systems, actions, schema, showDisabled, usageMap),\n    [pressures, generators, systems, actions, schema, showDisabled, usageMap]\n  );\n  const graphData = useMemo(\n    () => ({ nodes: graphNodes, links: graphLinks }),\n    [graphNodes, graphLinks]\n  );\n\n  // Count disabled nodes for UI\n  const disabledCount = useMemo(() => {\n    const allNodes = extractCausalGraph(\n      pressures,\n      generators,\n      systems,\n      actions,\n      schema,\n      true,\n      usageMap\n    ).nodes;\n    return allNodes.filter((n) => n.isDisabled).length;\n  }, [pressures, generators, systems, actions, schema, usageMap]);\n\n  // Detect loops\n  const loops = useMemo(() => detectLoops(graphData.nodes, graphData.links), [graphData]);\n\n  const reinforcingLoops = loops.filter((l) => l.type === \"reinforcing\");\n  const balancingLoops = loops.filter((l) => l.type === \"balancing\");\n\n  // Node styling\n  const nodeCanvasObject = useCallback(\n    (node, ctx, globalScale) => {\n      const label = node.label;\n      const fontSize = Math.max(10 / globalScale, 3);\n      const abbrevFontSize = Math.max(8 / globalScale, 3);\n      const nodeRadius = Math.sqrt(node.val) * 3;\n      const isDisabled = node.isDisabled;\n\n      // Draw node circle with opacity for disabled\n      ctx.beginPath();\n      ctx.arc(node.x, node.y, nodeRadius, 0, 2 * Math.PI);\n      ctx.fillStyle = isDisabled ? `${node.color}60` : node.color;\n      ctx.fill();\n\n      // Strikethrough pattern for disabled nodes\n      if (isDisabled) {\n        ctx.strokeStyle = \"#64748b\";\n        ctx.lineWidth = 1 / globalScale;\n        ctx.setLineDash([2 / globalScale, 2 / globalScale]);\n        ctx.stroke();\n        ctx.setLineDash([]);\n      }\n\n      // Highlight selected/hovered\n      if (selectedNode === node.id || hoverNode === node.id) {\n        ctx.strokeStyle = \"#ffffff\";\n        ctx.lineWidth = 2 / globalScale;\n        ctx.stroke();\n      }\n\n      // Draw abbreviation inside node\n      ctx.font = `bold ${abbrevFontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"middle\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#0a1929\";\n      ctx.fillText(node.abbrev || \"?\", node.x, node.y);\n\n      // Draw label below node\n      ctx.font = `${fontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"top\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#e2e8f0\";\n      const displayLabel = label.length > 15 ? label.slice(0, 13) + \"...\" : label;\n      ctx.fillText(displayLabel, node.x, node.y + nodeRadius + 2);\n    },\n    [selectedNode, hoverNode]\n  );\n\n  // Link styling\n  const linkColor = useCallback((link) => {\n    return EDGE_COLORS[link.polarity] || EDGE_COLORS.neutral;\n  }, []);\n\n  const linkWidth = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? 1 : 2;\n  }, []);\n\n  const linkLineDash = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? [4, 4] : [];\n  }, []);\n\n  // Handle node click\n  const handleNodeClick = useCallback(\n    (node) => {\n      setSelectedNode(selectedNode === node.id ? null : node.id);\n    },\n    [selectedNode]\n  );\n\n  // Zoom to fit on load\n  useEffect(() => {\n    if (graphRef.current && graphData.nodes.length > 0) {\n      setTimeout(() => {\n        graphRef.current.zoomToFit(400, 60);\n      }, 500);\n    }\n  }, [graphData.nodes.length]);\n\n  const selectedNodeData = selectedNode ? graphData.nodes.find((n) => n.id === selectedNode) : null;\n\n  // Get edges for selected node\n  const selectedNodeEdges = useMemo(() => {\n    if (!selectedNode) return { incoming: [], outgoing: [] };\n    return {\n      incoming: graphData.links.filter((l) => {\n        const targetId = typeof l.target === \"object\" ? l.target.id : l.target;\n        return targetId === selectedNode;\n      }),\n      outgoing: graphData.links.filter((l) => {\n        const sourceId = typeof l.source === \"object\" ? l.source.id : l.source;\n        return sourceId === selectedNode;\n      }),\n    };\n  }, [selectedNode, graphData.links]);\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Causal Loop Diagram</h1>\n        <p className=\"subtitle\">\n          Visualize feedback loops between pressures, generators, systems, and entity kinds.\n          {loops.length > 0 && (\n            <span className=\"cl-loop-count\">\n              <span className=\"cl-loop-reinforcing\">{reinforcingLoops.length} reinforcing</span>\n              {\" / \"}\n              <span className=\"cl-loop-balancing\">{balancingLoops.length} balancing</span>\n              {\" loops detected\"}\n            </span>\n          )}\n        </p>\n      </div>\n\n      <div className=\"cl-toolbar\">\n        <button className=\"button-secondary\" onClick={() => setShowLegend(!showLegend)}>\n          {showLegend ? \"Hide\" : \"Show\"} Legend\n        </button>\n        {disabledCount > 0 && (\n          <button\n            className=\"button-secondary\"\n            onClick={() => setShowDisabled(!showDisabled)}\n            // eslint-disable-next-line local/no-inline-styles -- dynamic opacity toggle\n            style={{ opacity: showDisabled ? 1 : 0.7 }}\n          >\n            {showDisabled ? \"Hide\" : \"Show\"} Disabled ({disabledCount})\n          </button>\n        )}\n        <button className=\"button-secondary\" onClick={() => graphRef.current?.zoomToFit(400, 60)}>\n          Fit to View\n        </button>\n        <div className=\"cl-stats\">\n          <span>{graphData.nodes.length} nodes</span>\n          <span>{graphData.links.length} edges</span>\n          {warnings.length > 0 && (\n            <span className=\"cl-stats-warning\">{warnings.length} warnings</span>\n          )}\n          <span className=\"cl-stats-hint\">Scroll to zoom, drag to pan</span>\n        </div>\n      </div>\n\n      {/* Warnings */}\n      {warnings.length > 0 && (\n        <div className=\"cl-warnings-box\">\n          <div className=\"cl-warnings-title\">\n            Referential Integrity Warnings\n          </div>\n          <div className=\"cl-warnings-list\">\n            {warnings.slice(0, 5).map((w, i) => (\n              <div key={i}>{w.message}</div>\n            ))}\n            {warnings.length > 5 && (\n              <div className=\"cl-warnings-more\">\n                ...and {warnings.length - 5} more warnings\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Legend */}\n      {showLegend && (\n        <div className=\"cl-legend\">\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Nodes:</span>\n            {Object.entries(NODE_TYPES).map(([type, config]) => (\n              <span key={type} className=\"cl-legend-item\">\n                <span\n                  className=\"cl-legend-node\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per node type\n                  style={{ '--cl-node-color': config.color, backgroundColor: 'var(--cl-node-color)' }}\n                >\n                  {config.abbrev}\n                </span>\n                <span className=\"cl-legend-node-label\">{config.label}</span>\n              </span>\n            ))}\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Edges:</span>\n            <span className=\"cl-legend-item cl-edge-positive\">+ Positive</span>\n            <span className=\"cl-legend-item cl-edge-negative\">- Negative</span>\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Loops:</span>\n            <span className=\"cl-legend-item cl-loop-reinforcing\">Reinforcing (unstable)</span>\n            <span className=\"cl-legend-item cl-loop-balancing\">Balancing (stable)</span>\n          </div>\n        </div>\n      )}\n\n      {/* Graph container */}\n      <div ref={containerRef} className=\"cl-graph-container\">\n        {graphData.nodes.length === 0 ? (\n          <div className=\"cl-empty-state\">\n            <div className=\"cl-empty-icon\">&#128260;</div>\n            <div className=\"cl-empty-title\">\n              No causal relationships found\n            </div>\n            <div className=\"cl-empty-desc\">\n              Add pressures with feedback factors, generators with state updates, or systems with\n              pressure changes to see the causal loop diagram.\n            </div>\n          </div>\n        ) : (\n          <ForceGraph2D\n            ref={graphRef}\n            graphData={graphData}\n            width={dimensions.width}\n            height={dimensions.height}\n            backgroundColor=\"#0f172a\"\n            nodeCanvasObject={nodeCanvasObject}\n            nodePointerAreaPaint={(node, color, ctx) => {\n              const nodeRadius = Math.sqrt(node.val) * 3;\n              ctx.beginPath();\n              ctx.arc(node.x, node.y, nodeRadius + 5, 0, 2 * Math.PI);\n              ctx.fillStyle = color;\n              ctx.fill();\n            }}\n            linkColor={linkColor}\n            linkWidth={linkWidth}\n            linkLineDash={linkLineDash}\n            linkDirectionalArrowLength={6}\n            linkDirectionalArrowRelPos={0.9}\n            linkCurvature={0.2}\n            onNodeClick={handleNodeClick}\n            onNodeHover={(node) => setHoverNode(node?.id || null)}\n// ... (truncated)", "parameters": [{"name": "{\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}", "type": "{ pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; schema?: {}; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/DependencyViewer.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/DependencyViewer.jsx", "sourceCode": "export default function DependencyViewer({ usageMap }) {\n  // Prepare entity kinds data\n  const entityKindsData = useMemo(() => {\n    if (!usageMap?.entityKinds) return [];\n    return Object.entries(usageMap.entityKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare relationship kinds data\n  const relationshipKindsData = useMemo(() => {\n    if (!usageMap?.relationshipKinds) return [];\n    return Object.entries(usageMap.relationshipKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare pressures data\n  const pressuresData = useMemo(() => {\n    if (!usageMap?.pressures) return [];\n    return Object.entries(usageMap.pressures)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare generators data\n  const generatorsData = useMemo(() => {\n    if (!usageMap?.generators) return [];\n    return Object.entries(usageMap.generators)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare systems data\n  const systemsData = useMemo(() => {\n    if (!usageMap?.systems) return [];\n    return Object.entries(usageMap.systems)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare tags data\n  const tagsData = useMemo(() => {\n    if (!usageMap?.tags) return [];\n    return Object.entries(usageMap.tags)\n      .map(([tag, usage]) => ({\n        id: tag,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  if (!usageMap) {\n    return (\n      <div className=\"dependency-viewer-container\">\n        <div className=\"dependency-empty-state\">Loading dependency data...</div>\n      </div>\n    );\n  }\n\n  const renderSchemaItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      <UsageBadges usage={item.usage} />\n    </div>\n  );\n\n  const renderEraItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      {item.eraCount > 0 ? (\n        <div className=\"dependency-used-by-list\">\n          <span className=\"dependency-badge dependency-badge-era\">\n            {item.eraCount} era{item.eraCount !== 1 ? \"s\" : \"\"}\n          </span>\n        </div>\n      ) : (\n        <span className=\"dependency-orphan-badge\">Not in any era</span>\n      )}\n    </div>\n  );\n\n  return (\n    <div className=\"dependency-viewer-container\">\n      <div className=\"dependency-viewer-header\">\n        <div className=\"dependency-viewer-title\">\n          <span>\ud83d\udd17</span>\n          <span>Dependencies</span>\n        </div>\n        <div className=\"dependency-viewer-legend\">\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-generators\" />\n            <span>Generators</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-systems\" />\n            <span>Systems</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-actions\" />\n            <span>Actions</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-eras\" />\n            <span>Eras</span>\n          </div>\n        </div>\n      </div>\n\n      <DependencySection\n        title=\"Entity Kinds\"\n        icon=\"\ud83d\udce6\"\n        items={entityKindsData}\n        renderItem={renderSchemaItem}\n        defaultExpanded={true}\n      />\n\n      <DependencySection\n        title=\"Relationship Kinds\"\n        icon=\"\ud83d\udd17\"\n        items={relationshipKindsData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection title=\"Tags\" icon=\"\ud83c\udff7\ufe0f\" items={tagsData} renderItem={renderSchemaItem} />\n\n      <DependencySection\n        title=\"Pressures\"\n        icon=\"\ud83d\udcca\"\n        items={pressuresData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection\n        title=\"Generators \u2192 Eras\"\n        icon=\"\u2728\"\n        items={generatorsData}\n        renderItem={renderEraItem}\n      />\n\n      <DependencySection\n        title=\"Systems \u2192 Eras\"\n        icon=\"\u2699\ufe0f\"\n        items={systemsData}\n        renderItem={renderEraItem}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{ usageMap }", "type": "{ usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/index.js", "sourceCode": "export default function DependencyViewer({ usageMap }) {\n  // Prepare entity kinds data\n  const entityKindsData = useMemo(() => {\n    if (!usageMap?.entityKinds) return [];\n    return Object.entries(usageMap.entityKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare relationship kinds data\n  const relationshipKindsData = useMemo(() => {\n    if (!usageMap?.relationshipKinds) return [];\n    return Object.entries(usageMap.relationshipKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare pressures data\n  const pressuresData = useMemo(() => {\n    if (!usageMap?.pressures) return [];\n    return Object.entries(usageMap.pressures)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare generators data\n  const generatorsData = useMemo(() => {\n    if (!usageMap?.generators) return [];\n    return Object.entries(usageMap.generators)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare systems data\n  const systemsData = useMemo(() => {\n    if (!usageMap?.systems) return [];\n    return Object.entries(usageMap.systems)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare tags data\n  const tagsData = useMemo(() => {\n    if (!usageMap?.tags) return [];\n    return Object.entries(usageMap.tags)\n      .map(([tag, usage]) => ({\n        id: tag,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  if (!usageMap) {\n    return (\n      <div className=\"dependency-viewer-container\">\n        <div className=\"dependency-empty-state\">Loading dependency data...</div>\n      </div>\n    );\n  }\n\n  const renderSchemaItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      <UsageBadges usage={item.usage} />\n    </div>\n  );\n\n  const renderEraItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      {item.eraCount > 0 ? (\n        <div className=\"dependency-used-by-list\">\n          <span className=\"dependency-badge dependency-badge-era\">\n            {item.eraCount} era{item.eraCount !== 1 ? \"s\" : \"\"}\n          </span>\n        </div>\n      ) : (\n        <span className=\"dependency-orphan-badge\">Not in any era</span>\n      )}\n    </div>\n  );\n\n  return (\n    <div className=\"dependency-viewer-container\">\n      <div className=\"dependency-viewer-header\">\n        <div className=\"dependency-viewer-title\">\n          <span>\ud83d\udd17</span>\n          <span>Dependencies</span>\n        </div>\n        <div className=\"dependency-viewer-legend\">\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-generators\" />\n            <span>Generators</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-systems\" />\n            <span>Systems</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-actions\" />\n            <span>Actions</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-eras\" />\n            <span>Eras</span>\n          </div>\n        </div>\n      </div>\n\n      <DependencySection\n        title=\"Entity Kinds\"\n        icon=\"\ud83d\udce6\"\n        items={entityKindsData}\n        renderItem={renderSchemaItem}\n        defaultExpanded={true}\n      />\n\n      <DependencySection\n        title=\"Relationship Kinds\"\n        icon=\"\ud83d\udd17\"\n        items={relationshipKindsData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection title=\"Tags\" icon=\"\ud83c\udff7\ufe0f\" items={tagsData} renderItem={renderSchemaItem} />\n\n      <DependencySection\n        title=\"Pressures\"\n        icon=\"\ud83d\udcca\"\n        items={pressuresData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection\n        title=\"Generators \u2192 Eras\"\n        icon=\"\u2728\"\n        items={generatorsData}\n        renderItem={renderEraItem}\n      />\n\n      <DependencySection\n        title=\"Systems \u2192 Eras\"\n        icon=\"\u2699\ufe0f\"\n        items={systemsData}\n        renderItem={renderEraItem}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{ usageMap }", "type": "{ usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/eras/ErasEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/eras/ErasEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.eras - Array of era objects\n * @param {Function} props.onChange - Called when eras change\n * @param {Array} props.pressures - Available pressures\n * @param {Object} props.schema - Domain schema\n */\nexport default function ErasEditor({ eras = [], onChange, pressures = [], schema }) {\n  const [expandedEra, setExpandedEra] = useState(null);\n\n  const handleEraChange = useCallback(\n    (index, updatedEra) => {\n      const newEras = [...eras];\n      newEras[index] = updatedEra;\n      onChange(newEras);\n    },\n    [eras, onChange]\n  );\n\n  const handleDeleteEra = useCallback(\n    (index) => {\n      if (confirm(`Delete era \"${eras[index].name}\"?`)) {\n        const newEras = eras.filter((_, i) => i !== index);\n        onChange(newEras);\n        if (expandedEra === index) {\n          setExpandedEra(null);\n        }\n      }\n    },\n    [eras, onChange, expandedEra]\n  );\n\n  const handleAddEra = useCallback(() => {\n    const newEra = {\n      id: `era_${Date.now()}`,\n      name: \"New Era\",\n      description: \"A new period in world history\",\n      templateWeights: {},\n      systemModifiers: {},\n      entryConditions: [],\n      entryEffects: { mutations: [] },\n      exitConditions: [{ type: \"growth_phases_complete\", minPhases: 2 }],\n      exitEffects: { mutations: [] },\n    };\n    onChange([...eras, newEra]);\n    setExpandedEra(eras.length);\n  }, [eras, onChange]);\n\n  if (eras.length === 0) {\n    return (\n      <div className=\"editor-container\">\n        <div className=\"header\">\n          <h1 className=\"title\">Eras</h1>\n          <p className=\"subtitle\">Define historical eras that structure world generation</p>\n        </div>\n        <div className=\"empty-state\">\n          <div className=\"empty-state-icon\">\ud83d\udd70\ufe0f</div>\n          <div className=\"empty-state-title\">No eras defined</div>\n          <div className=\"empty-state-desc\">\n            Eras control which generators and systems are active during different phases of world\n            history.\n          </div>\n          <button\n            className=\"btn btn-primary ee-create-btn\"\n            onClick={handleAddEra}\n          >\n            + Create First Era\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Eras</h1>\n        <p className=\"subtitle\">\n          Define historical eras that structure world generation. Each era controls which generators\n          and systems are active and at what strength.\n        </p>\n      </div>\n\n      <div className=\"list-stack\">\n        {eras.map((era, index) => (\n          <EraCard\n            key={era.id}\n            era={era}\n            expanded={expandedEra === index}\n            onToggle={() => setExpandedEra(expandedEra === index ? null : index)}\n            onChange={(updatedEra) => handleEraChange(index, updatedEra)}\n            onDelete={() => handleDeleteEra(index)}\n            pressures={pressures}\n            schema={schema}\n            allEras={eras}\n          />\n        ))}\n\n        <button className=\"btn btn-add\" onClick={handleAddEra}>\n          + Add Era\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ eras = [], onChange, pressures = [], schema }", "type": "{ eras: any[]; onChange: Function; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/GeneratorModal.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/GeneratorModal.jsx", "sourceCode": "export function GeneratorModal({\n  generator,\n  onChange,\n  onClose,\n  onDelete,\n  onDuplicate,\n  schema,\n  pressures,\n  eras,\n  usageMap,\n  tagRegistry = [],\n}) {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  const tabValidation = useMemo(\n    () => computeTabValidation(generator, usageMap),\n    [generator, usageMap]\n  );\n\n  const renderTabBadge = useCallback(\n    (tabId) => {\n      return <TabValidationBadge count={tabValidation.tabErrors[tabId]} />;\n    },\n    [tabValidation.tabErrors]\n  );\n\n  const sidebarFooter = tabValidation.isOrphan ? (\n    <div className=\"orphan-badge-container\">\n      <OrphanBadge isOrphan={true} />\n    </div>\n  ) : null;\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case \"overview\":\n        return (\n          <OverviewTab\n            generator={generator}\n            onChange={onChange}\n            onDelete={onDelete}\n            onDuplicate={onDuplicate}\n          />\n        );\n      case \"applicability\":\n        return (\n          <ApplicabilityTab\n            generator={generator}\n            onChange={onChange}\n            schema={schema}\n            pressures={pressures}\n            eras={eras}\n          />\n        );\n      case \"target\":\n        return <TargetTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"variables\":\n        return <VariablesTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"creation\":\n        return (\n          <CreationTab\n            generator={generator}\n            onChange={onChange}\n            schema={schema}\n            tagRegistry={tagRegistry}\n            pressures={pressures}\n          />\n        );\n      case \"relationships\":\n        return <RelationshipsTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"effects\":\n        return (\n          <EffectsTab\n            generator={generator}\n            onChange={onChange}\n            pressures={pressures}\n            schema={schema}\n          />\n        );\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <ModalShell\n      onClose={onClose}\n      icon=\"\u2699\ufe0f\"\n      title={generator.name || generator.id}\n      disabled={generator.enabled === false}\n      tabs={TABS}\n      activeTab={activeTab}\n      onTabChange={setActiveTab}\n      renderTabBadge={renderTabBadge}\n      sidebarFooter={sidebarFooter}\n    >\n      {renderTabContent()}\n    </ModalShell>\n  );\n}", "parameters": [{"name": "{\n  generator,\n  onChange,\n  onClose,\n  onDelete,\n  onDuplicate,\n  schema,\n  pressures,\n  eras,\n  usageMap,\n  tagRegistry = [],\n}", "type": "{ generator: any; onChange: any; onClose: any; onDelete: any; onDuplicate: any; schema: any; pressures: any; eras: any; usageMap: any; tagRegistry?: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/GeneratorsEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/GeneratorsEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.generators - Array of generator configurations\n * @param {Function} props.onChange - Callback when generators change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport default function GeneratorsEditor({\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"generators:selected\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [expandedCategories, setExpandedCategories] = useState({});\n\n  // Derive selected generator from index - this ensures we always have the latest data\n  const resolvedIndex = selectedId ? generators.findIndex((g) => g.id === selectedId) : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedGenerator = selectedIndex !== null ? generators[selectedIndex] : null;\n\n  // Build entity kind info map for icons and labels\n  const entityKindInfo = useMemo(() => {\n    const info = {};\n    (schema?.entityKinds || []).forEach((ek) => {\n      info[ek.kind] = {\n        label: ek.description || ek.name || ek.kind,\n        icon: ek.icon || DEFAULT_KIND_ICONS[ek.kind] || \"\ud83d\udce6\",\n      };\n    });\n    return info;\n  }, [schema]);\n\n  // Group generators by the primary entity kind they create\n  const groupedGenerators = useMemo(() => {\n    const groups = {};\n\n    generators.forEach((generator) => {\n      // Get primary creation kind (first entity created, or target kind if no creation)\n      const createdKinds = (generator.creation || []).map((c) => c.kind).filter(Boolean);\n      const primaryKind = createdKinds[0] || generator.selection?.kind || \"uncategorized\";\n\n      if (!groups[primaryKind]) {\n        groups[primaryKind] = [];\n      }\n      groups[primaryKind].push(generator);\n    });\n\n    return groups;\n  }, [generators]);\n\n  // Get ordered list of categories\n  const categories = useMemo(() => {\n    // Order by schema entity kinds first, then any uncategorized\n    const schemaKinds = (schema?.entityKinds || []).map((ek) => ek.kind);\n    const usedKinds = Object.keys(groupedGenerators);\n\n    // Sort: schema kinds in order, then others alphabetically\n    return usedKinds.sort((a, b) => {\n      const aIdx = schemaKinds.indexOf(a);\n      const bIdx = schemaKinds.indexOf(b);\n      if (aIdx >= 0 && bIdx >= 0) return aIdx - bIdx;\n      if (aIdx >= 0) return -1;\n      if (bIdx >= 0) return 1;\n      return a.localeCompare(b);\n    });\n  }, [groupedGenerators, schema]);\n\n  // Initialize expanded state for new categories\n  useEffect(() => {\n    const needsUpdate = categories.some((cat) => expandedCategories[cat] === undefined);\n    if (!needsUpdate) return;\n    const updated = { ...expandedCategories };\n    categories.forEach((cat) => {\n      if (updated[cat] === undefined) {\n        updated[cat] = true;\n      }\n    });\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync category expansion defaults when categories change\n    setExpandedCategories(updated);\n  }, [categories, expandedCategories]);\n\n  // Restore selectedId from storage when selectionKey changes\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted selection when key changes\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  // Persist selectedId to storage\n  useEffect(() => {\n    if (!selectionKey) return;\n    if (selectedId) {\n      saveStoredValue(selectionKey, selectedId);\n    } else {\n      clearStoredValue(selectionKey);\n    }\n  }, [selectionKey, selectedId]);\n\n  // Clear invalid selectedId (during render)\n  if (selectedId && selectedIndex === null) {\n    setSelectedId(null);\n    clearStoredValue(selectionKey);\n  }\n\n  const handleGeneratorChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex < generators.length) {\n        const newGenerators = [...generators];\n        newGenerators[selectedIndex] = updated;\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (generator) => {\n      const index = generators.findIndex((g) => g.id === generator.id);\n      if (index >= 0) {\n        const newGenerators = [...generators];\n        newGenerators[index] = {\n          ...generator,\n          enabled: generator.enabled === false ? true : false,\n        };\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedGenerator &&\n      confirm(`Delete generator \"${selectedGenerator.name || selectedGenerator.id}\"?`)\n    ) {\n      const newGenerators = [...generators];\n      newGenerators.splice(selectedIndex, 1);\n      onChange(newGenerators);\n      setSelectedId(null);\n    }\n  }, [generators, onChange, selectedIndex, selectedGenerator]);\n\n  const handleAdd = useCallback(() => {\n    const newGenerator = {\n      id: `generator_${Date.now()}`,\n      name: \"New Generator\",\n      applicability: [],\n      selection: { strategy: \"by_kind\", kind: \"location\", pickStrategy: \"random\" },\n      creation: [],\n      relationships: [],\n      stateUpdates: [],\n      variables: {},\n    };\n    onChange([...generators, newGenerator]);\n    setSelectedId(newGenerator.id);\n  }, [generators, onChange]);\n\n  const handleDuplicate = useCallback(() => {\n    if (!selectedGenerator) return;\n    const duplicated = {\n      ...JSON.parse(JSON.stringify(selectedGenerator)), // Deep clone\n      id: `${selectedGenerator.id}_copy_${Date.now()}`,\n      name: `${selectedGenerator.name || selectedGenerator.id} (Copy)`,\n    };\n    onChange([...generators, duplicated]);\n    setSelectedId(duplicated.id);\n  }, [generators, onChange, selectedGenerator]);\n\n  const toggleCategoryExpand = useCallback((kind) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [kind]: !prev[kind],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (kind) => {\n      const categoryItems = groupedGenerators[kind] || [];\n      const allEnabled = categoryItems.every((g) => g.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of generators in this category\n      const categoryIds = new Set(categoryItems.map((g) => g.id));\n\n      const newGenerators = generators.map((g) => {\n        if (categoryIds.has(g.id)) {\n          return { ...g, enabled: newEnabled };\n        }\n        return g;\n      });\n      onChange(newGenerators);\n    },\n    [generators, groupedGenerators, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Generators</h1>\n        <p className=\"subtitle\">\n          Configure entity generators that populate your world. Click a generator to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((kind) => {\n        const kindInfo = entityKindInfo[kind] || {\n          label: kind.charAt(0).toUpperCase() + kind.slice(1),\n          icon: DEFAULT_KIND_ICONS[kind] || \"\ud83d\udce6\",\n        };\n        const categoryItems = groupedGenerators[kind] || [];\n        const allEnabled = categoryItems.every((g) => g.enabled !== false);\n\n        return (\n          <CategorySection\n            key={kind}\n            id={kind}\n            icon={kindInfo.icon}\n            label={`${kindInfo.label} Generators`}\n            items={categoryItems}\n            expanded={expandedCategories[kind] !== false}\n            onToggleExpand={() => toggleCategoryExpand(kind)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(kind)}\n            renderItem={(generator) => (\n              <GeneratorListCard\n                key={generator.id}\n                generator={generator}\n                onClick={() => setSelectedId(generator.id)}\n                onToggle={() => handleToggle(generator)}\n                usageMap={usageMap}\n              />\n            )}\n          />\n        );\n      })}\n\n      {/* Add Generator button */}\n      <div className=\"mt-lg\">\n        <AddCard onClick={handleAdd} label=\"Add Generator\" />\n      </div>\n\n      {selectedGenerator && (\n        <GeneratorModal\n          generator={selectedGenerator}\n          onChange={handleGeneratorChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          onDuplicate={handleDuplicate}\n          schema={schema}\n          pressures={pressures}\n          eras={eras}\n          usageMap={usageMap}\n          tagRegistry={schema.tagRegistry || []}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}", "type": "{ generators: any[]; onChange: Function; schema: any; pressures: any[]; eras: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.generators - Array of generator configurations\n * @param {Function} props.onChange - Callback when generators change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport default function GeneratorsEditor({\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"generators:selected\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [expandedCategories, setExpandedCategories] = useState({});\n\n  // Derive selected generator from index - this ensures we always have the latest data\n  const resolvedIndex = selectedId ? generators.findIndex((g) => g.id === selectedId) : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedGenerator = selectedIndex !== null ? generators[selectedIndex] : null;\n\n  // Build entity kind info map for icons and labels\n  const entityKindInfo = useMemo(() => {\n    const info = {};\n    (schema?.entityKinds || []).forEach((ek) => {\n      info[ek.kind] = {\n        label: ek.description || ek.name || ek.kind,\n        icon: ek.icon || DEFAULT_KIND_ICONS[ek.kind] || \"\ud83d\udce6\",\n      };\n    });\n    return info;\n  }, [schema]);\n\n  // Group generators by the primary entity kind they create\n  const groupedGenerators = useMemo(() => {\n    const groups = {};\n\n    generators.forEach((generator) => {\n      // Get primary creation kind (first entity created, or target kind if no creation)\n      const createdKinds = (generator.creation || []).map((c) => c.kind).filter(Boolean);\n      const primaryKind = createdKinds[0] || generator.selection?.kind || \"uncategorized\";\n\n      if (!groups[primaryKind]) {\n        groups[primaryKind] = [];\n      }\n      groups[primaryKind].push(generator);\n    });\n\n    return groups;\n  }, [generators]);\n\n  // Get ordered list of categories\n  const categories = useMemo(() => {\n    // Order by schema entity kinds first, then any uncategorized\n    const schemaKinds = (schema?.entityKinds || []).map((ek) => ek.kind);\n    const usedKinds = Object.keys(groupedGenerators);\n\n    // Sort: schema kinds in order, then others alphabetically\n    return usedKinds.sort((a, b) => {\n      const aIdx = schemaKinds.indexOf(a);\n      const bIdx = schemaKinds.indexOf(b);\n      if (aIdx >= 0 && bIdx >= 0) return aIdx - bIdx;\n      if (aIdx >= 0) return -1;\n      if (bIdx >= 0) return 1;\n      return a.localeCompare(b);\n    });\n  }, [groupedGenerators, schema]);\n\n  // Initialize expanded state for new categories\n  useEffect(() => {\n    const needsUpdate = categories.some((cat) => expandedCategories[cat] === undefined);\n    if (!needsUpdate) return;\n    const updated = { ...expandedCategories };\n    categories.forEach((cat) => {\n      if (updated[cat] === undefined) {\n        updated[cat] = true;\n      }\n    });\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync category expansion defaults when categories change\n    setExpandedCategories(updated);\n  }, [categories, expandedCategories]);\n\n  // Restore selectedId from storage when selectionKey changes\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted selection when key changes\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  // Persist selectedId to storage\n  useEffect(() => {\n    if (!selectionKey) return;\n    if (selectedId) {\n      saveStoredValue(selectionKey, selectedId);\n    } else {\n      clearStoredValue(selectionKey);\n    }\n  }, [selectionKey, selectedId]);\n\n  // Clear invalid selectedId (during render)\n  if (selectedId && selectedIndex === null) {\n    setSelectedId(null);\n    clearStoredValue(selectionKey);\n  }\n\n  const handleGeneratorChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex < generators.length) {\n        const newGenerators = [...generators];\n        newGenerators[selectedIndex] = updated;\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (generator) => {\n      const index = generators.findIndex((g) => g.id === generator.id);\n      if (index >= 0) {\n        const newGenerators = [...generators];\n        newGenerators[index] = {\n          ...generator,\n          enabled: generator.enabled === false ? true : false,\n        };\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedGenerator &&\n      confirm(`Delete generator \"${selectedGenerator.name || selectedGenerator.id}\"?`)\n    ) {\n      const newGenerators = [...generators];\n      newGenerators.splice(selectedIndex, 1);\n      onChange(newGenerators);\n      setSelectedId(null);\n    }\n  }, [generators, onChange, selectedIndex, selectedGenerator]);\n\n  const handleAdd = useCallback(() => {\n    const newGenerator = {\n      id: `generator_${Date.now()}`,\n      name: \"New Generator\",\n      applicability: [],\n      selection: { strategy: \"by_kind\", kind: \"location\", pickStrategy: \"random\" },\n      creation: [],\n      relationships: [],\n      stateUpdates: [],\n      variables: {},\n    };\n    onChange([...generators, newGenerator]);\n    setSelectedId(newGenerator.id);\n  }, [generators, onChange]);\n\n  const handleDuplicate = useCallback(() => {\n    if (!selectedGenerator) return;\n    const duplicated = {\n      ...JSON.parse(JSON.stringify(selectedGenerator)), // Deep clone\n      id: `${selectedGenerator.id}_copy_${Date.now()}`,\n      name: `${selectedGenerator.name || selectedGenerator.id} (Copy)`,\n    };\n    onChange([...generators, duplicated]);\n    setSelectedId(duplicated.id);\n  }, [generators, onChange, selectedGenerator]);\n\n  const toggleCategoryExpand = useCallback((kind) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [kind]: !prev[kind],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (kind) => {\n      const categoryItems = groupedGenerators[kind] || [];\n      const allEnabled = categoryItems.every((g) => g.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of generators in this category\n      const categoryIds = new Set(categoryItems.map((g) => g.id));\n\n      const newGenerators = generators.map((g) => {\n        if (categoryIds.has(g.id)) {\n          return { ...g, enabled: newEnabled };\n        }\n        return g;\n      });\n      onChange(newGenerators);\n    },\n    [generators, groupedGenerators, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Generators</h1>\n        <p className=\"subtitle\">\n          Configure entity generators that populate your world. Click a generator to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((kind) => {\n        const kindInfo = entityKindInfo[kind] || {\n          label: kind.charAt(0).toUpperCase() + kind.slice(1),\n          icon: DEFAULT_KIND_ICONS[kind] || \"\ud83d\udce6\",\n        };\n        const categoryItems = groupedGenerators[kind] || [];\n        const allEnabled = categoryItems.every((g) => g.enabled !== false);\n\n        return (\n          <CategorySection\n            key={kind}\n            id={kind}\n            icon={kindInfo.icon}\n            label={`${kindInfo.label} Generators`}\n            items={categoryItems}\n            expanded={expandedCategories[kind] !== false}\n            onToggleExpand={() => toggleCategoryExpand(kind)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(kind)}\n            renderItem={(generator) => (\n              <GeneratorListCard\n                key={generator.id}\n                generator={generator}\n                onClick={() => setSelectedId(generator.id)}\n                onToggle={() => handleToggle(generator)}\n                usageMap={usageMap}\n              />\n            )}\n          />\n        );\n      })}\n\n      {/* Add Generator button */}\n      <div className=\"mt-lg\">\n        <AddCard onClick={handleAdd} label=\"Add Generator\" />\n      </div>\n\n      {selectedGenerator && (\n        <GeneratorModal\n          generator={selectedGenerator}\n          onChange={handleGeneratorChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          onDuplicate={handleDuplicate}\n          schema={schema}\n          pressures={pressures}\n          eras={eras}\n          usageMap={usageMap}\n          tagRegistry={schema.tagRegistry || []}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}", "type": "{ generators: any[]; onChange: Function; schema: any; pressures: any[]; eras: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::createNewRule", "name": "createNewRule", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * createNewRule - Factory for creating new applicability rules\n */\n\n/**\n * Creates a new applicability rule with default values based on type\n * @param {string} type - The rule type\n * @param {Array} pressures - Available pressure definitions\n * @returns {Object} A new rule object with default values\n */\nexport function createNewRule(type, pressures) {\n  // Create rules with empty required fields - validation will flag them\n  // No domain-specific defaults - user must explicitly select values\n  const newRule = { type };\n  const firstPressure = (pressures || [])[0]?.id || \"\";\n\n  switch (type) {\n    case \"pressure\":\n      return { ...newRule, pressureId: firstPressure, min: 0, max: 100 };\n    case \"pressure_any_above\":\n      return { ...newRule, pressureIds: firstPressure ? [firstPressure] : [], threshold: 50 };\n    case \"pressure_compare\":\n      return { ...newRule, pressureA: firstPressure, pressureB: firstPressure, operator: \">\" };\n    case \"entity_count\":\n      return { ...newRule, kind: \"\", min: 0 };\n    case \"relationship_count\":\n      return { ...newRule, relationshipKind: \"\", direction: \"both\", min: 0 };\n    case \"relationship_exists\":\n      return { ...newRule, relationshipKind: \"\", direction: \"both\" };\n    case \"tag_exists\":\n      return { ...newRule, tag: \"\" };\n    case \"tag_absent\":\n      return { ...newRule, tag: \"\" };\n    case \"status\":\n      return { ...newRule, status: \"\" };\n    case \"prominence\":\n      return { ...newRule, min: \"recognized\" };\n    case \"time_elapsed\":\n      return { ...newRule, minTicks: 10, since: \"updated\" };\n    case \"growth_phases_complete\":\n      return { ...newRule, minPhases: 2 };\n    case \"era_match\":\n      return { ...newRule, eras: [] };\n    case \"random_chance\":\n      return { ...newRule, chance: 0.5 };\n    case \"cooldown_elapsed\":\n      return { ...newRule, cooldownTicks: 10 };\n    case \"creations_per_epoch\":\n      return { ...newRule, maxPerEpoch: 1 };\n    case \"graph_path\":\n      return { ...newRule, assert: { check: \"exists\", path: [] } };\n    case \"entity_exists\":\n      return { ...newRule, entity: \"$target\" };\n    case \"entity_has_relationship\":\n      return { ...newRule, entity: \"$target\", relationshipKind: \"\", direction: \"both\" };\n    case \"or\":\n    case \"and\":\n      return { ...newRule, conditions: [] };\n    case \"always\":\n    default:\n      return newRule;\n  }\n}", "parameters": [{"name": "type", "type": "string", "optional": false}, {"name": "pressures", "type": "any[]", "optional": false}], "returnType": "any"}, {"id": "apps/coherence-engine/webui/src/components/naming-profile-viewer/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/naming-profile-viewer/index.js", "sourceCode": "export default function NamingProfileMappingViewer({ generators = [], schema = {} }) {\n  const [showInherited, setShowInherited] = useState(false);\n\n  const { mappings, warnings } = useMemo(\n    () => analyzeNamingMappings(generators, schema),\n    [generators, schema]\n  );\n\n  // Group by generator for display\n  const groupedMappings = useMemo(() => {\n    const groups = {};\n    for (const m of mappings) {\n      if (!groups[m.generatorId]) {\n        groups[m.generatorId] = {\n          generatorId: m.generatorId,\n          generatorName: m.generatorName,\n          items: [],\n        };\n      }\n      groups[m.generatorId].items.push(m);\n    }\n    return Object.values(groups);\n  }, [mappings]);\n\n  // Filter warnings - show all by default, but can filter to just explicit cultures\n  const displayWarnings = showInherited\n    ? warnings\n    : warnings.filter(\n        (w) => w.cultureSource === \"explicit\" || w.reason === \"No matching strategy group\"\n      );\n\n  const successCount = mappings.filter((m) => m.match).length;\n  const warningCount = warnings.filter((w) => w.reason === \"No matching strategy group\").length;\n\n  if (mappings.length === 0) {\n    return (\n      <div className=\"naming-profile-container\">\n        <div className=\"naming-profile-header\">\n          <div className=\"naming-profile-title\">\n            <span>Naming Profile Mappings</span>\n          </div>\n        </div>\n        <div className=\"naming-profile-empty-state\">\n          No generators with entity creation defined. Add generators to see naming profile mappings.\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"naming-profile-container\">\n      <div className=\"naming-profile-header\">\n        <div className=\"naming-profile-title\">\n          <span>Naming Profile Mappings</span>\n        </div>\n        <div className=\"naming-profile-stats\">\n          <div className=\"naming-profile-stat-item\">\n            <span className=\"naming-profile-stat-value text-success\">{successCount}</span>\n            <span>matched</span>\n          </div>\n          <div className=\"naming-profile-stat-item\">\n            <span\n              className={`naming-profile-stat-value ${warningCount > 0 ? \"text-danger\" : \"text-muted\"}`}\n            >\n              {warningCount}\n            </span>\n            <span>missing</span>\n          </div>\n          <label className=\"cursor-pointer flex items-center gap-xs\">\n            <input\n              type=\"checkbox\"\n              checked={showInherited}\n              onChange={(e) => setShowInherited(e.target.checked)}\n            />\n            <span>Show inherited cultures</span>\n          </label>\n        </div>\n      </div>\n\n      <div className=\"naming-profile-content\">\n        {/* Warnings section */}\n        {displayWarnings.length > 0 && (\n          <div className=\"naming-profile-section\">\n            <div className=\"naming-profile-section-title\">\n              <span className=\"naming-profile-warning-icon\">Warning</span>\n              <span>Naming May Fail ({displayWarnings.length})</span>\n            </div>\n            <div className=\"naming-profile-warning-list\">\n              {displayWarnings.slice(0, 10).map((w, i) => (\n                <div\n                  key={`${w.generatorId}-${w.cultureId}-${i}`}\n                  className=\"naming-profile-warning-item\"\n                >\n                  <span className=\"naming-profile-warning-icon\">!</span>\n                  <span>\n                    <strong>{w.generatorName}</strong> creates <strong>{w.entityKind}</strong>\n                    {w.subtype && `:${w.subtype}`} for culture <strong>{w.cultureName}</strong> -{\" \"}\n                    {w.reason}\n                  </span>\n                </div>\n              ))}\n              {displayWarnings.length > 10 && (\n                <div\n                  className=\"text-muted py-md px-lg\"\n                >\n                  ... and {displayWarnings.length - 10} more\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Mappings table */}\n        <div className=\"naming-profile-section\">\n          <div className=\"naming-profile-section-title\">\n            <span>Entity Creation to Naming Profile</span>\n          </div>\n          <table className=\"naming-profile-mapping-table\">\n            <thead>\n              <tr>\n                <th className=\"naming-profile-table-header\">Generator</th>\n                <th className=\"naming-profile-table-header\">Entity Kind</th>\n                <th className=\"naming-profile-table-header\">Culture</th>\n                <th className=\"naming-profile-table-header\">Naming Profile</th>\n              </tr>\n            </thead>\n            <tbody>\n              {groupedMappings.slice(0, 20).flatMap((group) => {\n                // Filter items based on showInherited toggle\n                const filteredItems = showInherited\n                  ? group.items\n                  : group.items.filter(\n                      (m) => m.cultureSource === \"explicit\" || m.cultureSource === \"any\"\n                    );\n                // If no explicit cultures, show first inherited one as representative\n                const displayItems =\n                  filteredItems.length > 0 ? filteredItems : group.items.slice(0, 1);\n                return displayItems.map((m, idx) => (\n                  <tr\n                    key={`${m.generatorId}-${m.cultureId}-${m.entityKind}-${idx}`}\n                    className={`naming-profile-table-row ${!m.match && m.hasNamingProfile ? \"naming-profile-warning-row\" : \"\"}`}\n                  >\n                    <td className=\"naming-profile-table-cell naming-profile-generator-cell\">\n                      {idx === 0 ? m.generatorName : \"\"}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <span className=\"naming-profile-kind-badge\">{m.entityKind}</span>\n                      {m.subtype && (\n                        <span\n                          className=\"naming-profile-kind-badge naming-profile-kind-badge-transparent\"\n                        >\n                          {m.subtype}\n                        </span>\n                      )}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <div className=\"naming-profile-culture-cell\">\n                        {/* eslint-disable-next-line local/no-inline-styles -- dynamic culture color */}\n                        <span\n                          className=\"naming-profile-culture-dot\"\n                          style={{ '--npm-culture-color': m.cultureColor, backgroundColor: 'var(--npm-culture-color)' }}\n                        />\n                        <span>{m.cultureName}</span>\n                        {m.cultureSource === \"inherited\" && (\n                          <span className=\"naming-profile-badge naming-profile-badge-inherited\">\n                            inherited\n                          </span>\n                        )}\n                      </div>\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      {m.match && (\n                        <span className=\"naming-profile-badge naming-profile-badge-match\">\n                          {m.match.profileName || m.match.profileId}\n                          {m.match.groupName && ` / ${m.match.groupName}`}\n                        </span>\n                      )}\n                      {!m.match && !m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No profiles configured\n                        </span>\n                      )}\n                      {!m.match && m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No matching group\n                        </span>\n                      )}\n                    </td>\n                  </tr>\n                ));\n              })}\n            </tbody>\n          </table>\n          {groupedMappings.length > 20 && (\n            <div className=\"text-muted text-center text-xs p-md\">\n              Showing first 20 generators. Total: {groupedMappings.length}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generators = [], schema = {} }", "type": "{ generators?: any[]; schema?: {}; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/naming-profile-viewer/NamingProfileMappingViewer.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/naming-profile-viewer/NamingProfileMappingViewer.jsx", "sourceCode": "export default function NamingProfileMappingViewer({ generators = [], schema = {} }) {\n  const [showInherited, setShowInherited] = useState(false);\n\n  const { mappings, warnings } = useMemo(\n    () => analyzeNamingMappings(generators, schema),\n    [generators, schema]\n  );\n\n  // Group by generator for display\n  const groupedMappings = useMemo(() => {\n    const groups = {};\n    for (const m of mappings) {\n      if (!groups[m.generatorId]) {\n        groups[m.generatorId] = {\n          generatorId: m.generatorId,\n          generatorName: m.generatorName,\n          items: [],\n        };\n      }\n      groups[m.generatorId].items.push(m);\n    }\n    return Object.values(groups);\n  }, [mappings]);\n\n  // Filter warnings - show all by default, but can filter to just explicit cultures\n  const displayWarnings = showInherited\n    ? warnings\n    : warnings.filter(\n        (w) => w.cultureSource === \"explicit\" || w.reason === \"No matching strategy group\"\n      );\n\n  const successCount = mappings.filter((m) => m.match).length;\n  const warningCount = warnings.filter((w) => w.reason === \"No matching strategy group\").length;\n\n  if (mappings.length === 0) {\n    return (\n      <div className=\"naming-profile-container\">\n        <div className=\"naming-profile-header\">\n          <div className=\"naming-profile-title\">\n            <span>Naming Profile Mappings</span>\n          </div>\n        </div>\n        <div className=\"naming-profile-empty-state\">\n          No generators with entity creation defined. Add generators to see naming profile mappings.\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"naming-profile-container\">\n      <div className=\"naming-profile-header\">\n        <div className=\"naming-profile-title\">\n          <span>Naming Profile Mappings</span>\n        </div>\n        <div className=\"naming-profile-stats\">\n          <div className=\"naming-profile-stat-item\">\n            <span className=\"naming-profile-stat-value text-success\">{successCount}</span>\n            <span>matched</span>\n          </div>\n          <div className=\"naming-profile-stat-item\">\n            <span\n              className={`naming-profile-stat-value ${warningCount > 0 ? \"text-danger\" : \"text-muted\"}`}\n            >\n              {warningCount}\n            </span>\n            <span>missing</span>\n          </div>\n          <label className=\"cursor-pointer flex items-center gap-xs\">\n            <input\n              type=\"checkbox\"\n              checked={showInherited}\n              onChange={(e) => setShowInherited(e.target.checked)}\n            />\n            <span>Show inherited cultures</span>\n          </label>\n        </div>\n      </div>\n\n      <div className=\"naming-profile-content\">\n        {/* Warnings section */}\n        {displayWarnings.length > 0 && (\n          <div className=\"naming-profile-section\">\n            <div className=\"naming-profile-section-title\">\n              <span className=\"naming-profile-warning-icon\">Warning</span>\n              <span>Naming May Fail ({displayWarnings.length})</span>\n            </div>\n            <div className=\"naming-profile-warning-list\">\n              {displayWarnings.slice(0, 10).map((w, i) => (\n                <div\n                  key={`${w.generatorId}-${w.cultureId}-${i}`}\n                  className=\"naming-profile-warning-item\"\n                >\n                  <span className=\"naming-profile-warning-icon\">!</span>\n                  <span>\n                    <strong>{w.generatorName}</strong> creates <strong>{w.entityKind}</strong>\n                    {w.subtype && `:${w.subtype}`} for culture <strong>{w.cultureName}</strong> -{\" \"}\n                    {w.reason}\n                  </span>\n                </div>\n              ))}\n              {displayWarnings.length > 10 && (\n                <div\n                  className=\"text-muted py-md px-lg\"\n                >\n                  ... and {displayWarnings.length - 10} more\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Mappings table */}\n        <div className=\"naming-profile-section\">\n          <div className=\"naming-profile-section-title\">\n            <span>Entity Creation to Naming Profile</span>\n          </div>\n          <table className=\"naming-profile-mapping-table\">\n            <thead>\n              <tr>\n                <th className=\"naming-profile-table-header\">Generator</th>\n                <th className=\"naming-profile-table-header\">Entity Kind</th>\n                <th className=\"naming-profile-table-header\">Culture</th>\n                <th className=\"naming-profile-table-header\">Naming Profile</th>\n              </tr>\n            </thead>\n            <tbody>\n              {groupedMappings.slice(0, 20).flatMap((group) => {\n                // Filter items based on showInherited toggle\n                const filteredItems = showInherited\n                  ? group.items\n                  : group.items.filter(\n                      (m) => m.cultureSource === \"explicit\" || m.cultureSource === \"any\"\n                    );\n                // If no explicit cultures, show first inherited one as representative\n                const displayItems =\n                  filteredItems.length > 0 ? filteredItems : group.items.slice(0, 1);\n                return displayItems.map((m, idx) => (\n                  <tr\n                    key={`${m.generatorId}-${m.cultureId}-${m.entityKind}-${idx}`}\n                    className={`naming-profile-table-row ${!m.match && m.hasNamingProfile ? \"naming-profile-warning-row\" : \"\"}`}\n                  >\n                    <td className=\"naming-profile-table-cell naming-profile-generator-cell\">\n                      {idx === 0 ? m.generatorName : \"\"}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <span className=\"naming-profile-kind-badge\">{m.entityKind}</span>\n                      {m.subtype && (\n                        <span\n                          className=\"naming-profile-kind-badge naming-profile-kind-badge-transparent\"\n                        >\n                          {m.subtype}\n                        </span>\n                      )}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <div className=\"naming-profile-culture-cell\">\n                        {/* eslint-disable-next-line local/no-inline-styles -- dynamic culture color */}\n                        <span\n                          className=\"naming-profile-culture-dot\"\n                          style={{ '--npm-culture-color': m.cultureColor, backgroundColor: 'var(--npm-culture-color)' }}\n                        />\n                        <span>{m.cultureName}</span>\n                        {m.cultureSource === \"inherited\" && (\n                          <span className=\"naming-profile-badge naming-profile-badge-inherited\">\n                            inherited\n                          </span>\n                        )}\n                      </div>\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      {m.match && (\n                        <span className=\"naming-profile-badge naming-profile-badge-match\">\n                          {m.match.profileName || m.match.profileId}\n                          {m.match.groupName && ` / ${m.match.groupName}`}\n                        </span>\n                      )}\n                      {!m.match && !m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No profiles configured\n                        </span>\n                      )}\n                      {!m.match && m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No matching group\n                        </span>\n                      )}\n                    </td>\n                  </tr>\n                ));\n              })}\n            </tbody>\n          </table>\n          {groupedMappings.length > 20 && (\n            <div className=\"text-muted text-center text-xs p-md\">\n              Showing first 20 generators. Total: {groupedMappings.length}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generators = [], schema = {} }", "type": "{ generators?: any[]; schema?: {}; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/pressures/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/pressures/index.js", "sourceCode": "export default function PressuresEditor({ projectId, pressures = [], onChange, schema, usageMap }) {\n  const [expandedPressure, setExpandedPressure] = useState(null);\n  const factorModalKey = buildStorageKey(projectId, \"pressures:factorModal\");\n  const restoredRef = useRef(false);\n\n  useEffect(() => {\n    restoredRef.current = false;\n  }, [factorModalKey]);\n\n  // Restore expanded pressure from storage (one-time per modal key)\n  useEffect(() => {\n    if (restoredRef.current || !factorModalKey || pressures.length === 0) return;\n\n    const stored = loadStoredValue(factorModalKey);\n    if (stored?.pressureId) {\n      const index = pressures.findIndex((pressure) => pressure.id === stored.pressureId);\n      if (index >= 0) {\n        // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted UI expansion state\n        setExpandedPressure(index);\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    }\n    restoredRef.current = true;\n  }, [factorModalKey, pressures]);\n\n  const handlePressureChange = useCallback(\n    (index, updatedPressure) => {\n      const newPressures = [...pressures];\n      newPressures[index] = updatedPressure;\n      onChange(newPressures);\n    },\n    [pressures, onChange]\n  );\n\n  const handleDeletePressure = useCallback(\n    (index) => {\n      if (confirm(`Delete \"${pressures[index].name}\"?`)) {\n        const newPressures = pressures.filter((_, i) => i !== index);\n        onChange(newPressures);\n        if (expandedPressure === index) {\n          setExpandedPressure(null);\n        }\n      }\n    },\n    [pressures, onChange, expandedPressure]\n  );\n\n  const handleAddPressure = useCallback(() => {\n    const newPressure = {\n      id: `pressure_${Date.now()}`,\n      name: \"New Pressure\",\n      initialValue: 0,\n      homeostasis: 0.05,\n      description: \"\",\n      growth: {\n        positiveFeedback: [],\n        negativeFeedback: [],\n      },\n    };\n    onChange([...pressures, newPressure]);\n    setExpandedPressure(pressures.length);\n  }, [pressures, onChange]);\n\n  if (pressures.length === 0) {\n    return (\n      <div className=\"editor-container\">\n        <div className=\"header\">\n          <h1 className=\"title\">Pressures</h1>\n          <p className=\"subtitle\">\n            Configure environmental and social pressures that drive world evolution\n          </p>\n        </div>\n        <div className=\"empty-state\">\n          <div className=\"empty-state-icon\">\ud83c\udf21\ufe0f</div>\n          <div className=\"pe-empty-title\">\n            No pressures defined\n          </div>\n          <div className=\"pe-empty-desc\">\n            Pressures respond to world state with feedback and a pull toward equilibrium, driving\n            the narrative forward.\n          </div>\n          <button\n            className=\"btn btn-primary pe-create-btn\"\n            onClick={handleAddPressure}\n          >\n            + Create First Pressure\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Pressures</h1>\n        <p className=\"subtitle\">\n          Configure environmental and social pressures that drive world evolution. Each pressure has\n          feedback factors that make it grow or shrink based on world state plus a homeostatic pull\n          toward equilibrium.\n        </p>\n      </div>\n\n      <div className=\"list-stack\">\n        {pressures.map((pressure, index) => (\n          <PressureCard\n            key={index}\n            pressure={pressure}\n            expanded={expandedPressure === index}\n            onToggle={() => setExpandedPressure(expandedPressure === index ? null : index)}\n            onChange={(updatedPressure) => handlePressureChange(index, updatedPressure)}\n            onDelete={() => handleDeletePressure(index)}\n            schema={schema}\n            usageMap={usageMap}\n            projectId={projectId}\n          />\n        ))}\n\n        <button className=\"btn btn-add\" onClick={handleAddPressure}>\n          + Add Pressure\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ projectId, pressures = [], onChange, schema, usageMap }", "type": "{ projectId: any; pressures?: any[]; onChange: any; schema: any; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/pressures/PressuresEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/pressures/PressuresEditor.jsx", "sourceCode": "export default function PressuresEditor({ projectId, pressures = [], onChange, schema, usageMap }) {\n  const [expandedPressure, setExpandedPressure] = useState(null);\n  const factorModalKey = buildStorageKey(projectId, \"pressures:factorModal\");\n  const restoredRef = useRef(false);\n\n  useEffect(() => {\n    restoredRef.current = false;\n  }, [factorModalKey]);\n\n  // Restore expanded pressure from storage (one-time per modal key)\n  useEffect(() => {\n    if (restoredRef.current || !factorModalKey || pressures.length === 0) return;\n\n    const stored = loadStoredValue(factorModalKey);\n    if (stored?.pressureId) {\n      const index = pressures.findIndex((pressure) => pressure.id === stored.pressureId);\n      if (index >= 0) {\n        // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted UI expansion state\n        setExpandedPressure(index);\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    }\n    restoredRef.current = true;\n  }, [factorModalKey, pressures]);\n\n  const handlePressureChange = useCallback(\n    (index, updatedPressure) => {\n      const newPressures = [...pressures];\n      newPressures[index] = updatedPressure;\n      onChange(newPressures);\n    },\n    [pressures, onChange]\n  );\n\n  const handleDeletePressure = useCallback(\n    (index) => {\n      if (confirm(`Delete \"${pressures[index].name}\"?`)) {\n        const newPressures = pressures.filter((_, i) => i !== index);\n        onChange(newPressures);\n        if (expandedPressure === index) {\n          setExpandedPressure(null);\n        }\n      }\n    },\n    [pressures, onChange, expandedPressure]\n  );\n\n  const handleAddPressure = useCallback(() => {\n    const newPressure = {\n      id: `pressure_${Date.now()}`,\n      name: \"New Pressure\",\n      initialValue: 0,\n      homeostasis: 0.05,\n      description: \"\",\n      growth: {\n        positiveFeedback: [],\n        negativeFeedback: [],\n      },\n    };\n    onChange([...pressures, newPressure]);\n    setExpandedPressure(pressures.length);\n  }, [pressures, onChange]);\n\n  if (pressures.length === 0) {\n    return (\n      <div className=\"editor-container\">\n        <div className=\"header\">\n          <h1 className=\"title\">Pressures</h1>\n          <p className=\"subtitle\">\n            Configure environmental and social pressures that drive world evolution\n          </p>\n        </div>\n        <div className=\"empty-state\">\n          <div className=\"empty-state-icon\">\ud83c\udf21\ufe0f</div>\n          <div className=\"pe-empty-title\">\n            No pressures defined\n          </div>\n          <div className=\"pe-empty-desc\">\n            Pressures respond to world state with feedback and a pull toward equilibrium, driving\n            the narrative forward.\n          </div>\n          <button\n            className=\"btn btn-primary pe-create-btn\"\n            onClick={handleAddPressure}\n          >\n            + Create First Pressure\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Pressures</h1>\n        <p className=\"subtitle\">\n          Configure environmental and social pressures that drive world evolution. Each pressure has\n          feedback factors that make it grow or shrink based on world state plus a homeostatic pull\n          toward equilibrium.\n        </p>\n      </div>\n\n      <div className=\"list-stack\">\n        {pressures.map((pressure, index) => (\n          <PressureCard\n            key={index}\n            pressure={pressure}\n            expanded={expandedPressure === index}\n            onToggle={() => setExpandedPressure(expandedPressure === index ? null : index)}\n            onChange={(updatedPressure) => handlePressureChange(index, updatedPressure)}\n            onDelete={() => handleDeletePressure(index)}\n            schema={schema}\n            usageMap={usageMap}\n            projectId={projectId}\n          />\n        ))}\n\n        <button className=\"btn btn-add\" onClick={handleAddPressure}>\n          + Add Pressure\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ projectId, pressures = [], onChange, schema, usageMap }", "type": "{ projectId: any; pressures?: any[]; onChange: any; schema: any; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::getElementValidation", "name": "getElementValidation", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * Get validation status for a specific element\n */\nexport function getElementValidation(usageMap, type, id) {\n  const invalidRefs = usageMap.validation.invalidRefs.filter(\n    ref => ref.type === type && ref.id === id\n  );\n  const compatibility = usageMap.validation.compatibility.filter(\n    c => c.type === type && c.id === id\n  );\n  const isOrphan = usageMap.validation.orphans.some(\n    o => o.type === type && o.id === id\n  );\n\n  return {\n    isValid: invalidRefs.length === 0 && compatibility.length === 0,\n    invalidRefs,\n    compatibility,\n    isOrphan,\n  };\n}", "parameters": [{"name": "usageMap", "type": "any", "optional": false}, {"name": "type", "type": "any", "optional": false}, {"name": "id", "type": "any", "optional": false}], "returnType": "{ isValid: boolean; invalidRefs: any; compatibility: any; isOrphan: any; }"}, {"id": "apps/coherence-engine/webui/src/components/shared/MutationCard.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/shared/MutationCard.jsx", "sourceCode": "export function MutationCard({\n  mutation,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  entityOptions,\n  typeOptions,\n  createMutation,\n  titlePrefix,\n}) {\n  const [expanded, setExpanded] = useState(false);\n  const types = typeOptions || DEFAULT_MUTATION_TYPES;\n  const entityRefs = normalizeOptions(entityOptions);\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n  const pressureOptions = (pressures || []).map((p) => ({\n    value: p.id,\n    label: p.name || p.id,\n  }));\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const update = (field, value) => {\n    onChange({ ...mutation, [field]: value });\n  };\n\n  const updateType = (value) => {\n    if (createMutation) {\n      onChange(createMutation(value));\n      return;\n    }\n    update(\"type\", value);\n  };\n\n  const fallbackLabel =\n    types.find((t) => t.value === mutation.type)?.label ||\n    MUTATION_TYPE_META[mutation.type]?.label ||\n    mutation.type;\n  const typeMeta = MUTATION_TYPE_META[mutation.type] || { icon: \"?\", color: \"#6b7280\" };\n  const headerLabel = titlePrefix ? `${titlePrefix}: ${fallbackLabel}` : fallbackLabel;\n\n  const getSummary = () => {\n    switch (mutation.type) {\n      case \"modify_pressure\":\n        return `${mutation.pressureId || \"?\"} ${formatDelta(mutation.delta)}`;\n      case \"set_tag\": {\n        const value = mutation.value !== undefined ? ` = ${mutation.value}` : \"\";\n        return `${mutation.entity || \"?\"} tag ${mutation.tag || \"?\"}${value}`;\n      }\n      case \"remove_tag\":\n        return `${mutation.entity || \"?\"} remove ${mutation.tag || \"?\"}`;\n      case \"change_status\":\n        return `${mutation.entity || \"?\"} -> ${mutation.newStatus || \"?\"}`;\n      case \"adjust_prominence\":\n        return `${mutation.entity || \"?\"} ${formatDelta(mutation.delta)}`;\n      case \"archive_relationship\": {\n        return `${mutation.entity || \"?\"} ${mutation.relationshipKind || \"?\"} with ${mutation.with || \"?\"}`;\n      }\n      case \"archive_all_relationships\": {\n        const dirLabel =\n          mutation.direction && mutation.direction !== \"both\" ? ` (${mutation.direction})` : \"\";\n        return `${mutation.entity || \"?\"} all ${mutation.relationshipKind || \"?\"}${dirLabel}`;\n      }\n      case \"adjust_relationship_strength\":\n        return `${mutation.kind || \"?\"} ${mutation.src || \"?\"} -> ${mutation.dst || \"?\"} ${formatDelta(mutation.delta)}`;\n      case \"create_relationship\": {\n        const arrow = mutation.bidirectional ? \"<->\" : \"->\";\n        return `${mutation.kind || \"?\"} ${mutation.src || \"?\"} ${arrow} ${mutation.dst || \"?\"}`;\n      }\n      case \"update_rate_limit\":\n        return \"track execution\";\n      case \"transfer_relationship\":\n        return `${mutation.entity || \"?\"} ${mutation.relationshipKind || \"?\"} from ${mutation.from || \"?\"} to ${mutation.to || \"?\"}`;\n      case \"for_each_related\": {\n        const actionCount = (mutation.actions || []).length;\n        return `${mutation.relationship || \"?\"} (${actionCount} action${actionCount !== 1 ? \"s\" : \"\"})`;\n      }\n      case \"conditional\": {\n        const thenCount = (mutation.thenActions || []).length;\n        const elseCount = (mutation.elseActions || []).length;\n        return `then: ${thenCount}, else: ${elseCount}`;\n      }\n      default:\n        return \"\";\n    }\n  };\n\n  const summary = getSummary();\n\n  return (\n    <div className=\"condition-card\">\n      <div className={`condition-card-header ${expanded ? \"\" : \"mb-0\"}`}>\n        <div className=\"condition-card-type\">\n          {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color */}\n          <div className=\"condition-card-icon\" style={{ '--mc-icon-bg': `${typeMeta.color}20`, backgroundColor: 'var(--mc-icon-bg)' }}>\n            {typeMeta.icon}\n          </div>\n          <div>\n            <div className=\"condition-card-label\">{headerLabel}</div>\n            {summary && <div className=\"condition-card-summary\">{summary}</div>}\n          </div>\n        </div>\n        <div className=\"condition-card-actions\">\n          <button className=\"btn-icon\" onClick={() => setExpanded(!expanded)}>\n            {expanded ? \"^\" : \"v\"}\n          </button>\n          {onRemove && (\n            <button className=\"btn-icon btn-icon-danger\" onClick={onRemove}>\n              x\n            </button>\n          )}\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"condition-card-fields\">\n          <div className=\"form-grid mc-fields-full\">\n            <ReferenceDropdown\n              label=\"Type\"\n              value={mutation.type}\n              onChange={updateType}\n              options={types}\n            />\n\n            {mutation.type === \"modify_pressure\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure\"\n                  value={mutation.pressureId || \"\"}\n                  onChange={(v) => update(\"pressureId\", v)}\n                  options={pressureOptions}\n                  placeholder=\"Select pressure...\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Delta\n                  <NumberInput value={mutation.delta} onChange={(v) => update(\"delta\", v ?? 0)} />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {(mutation.type === \"set_tag\" || mutation.type === \"remove_tag\") && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity\"\n                  value={mutation.entity || \"\"}\n                  onChange={(v) => update(\"entity\", v)}\n                  options={entityRefs}\n                  placeholder=\"Select entity...\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Tag\n                  <TagSelector\n                    value={mutation.tag ? [mutation.tag] : []}\n                    onChange={(tags) => update(\"tag\", tags[0] || \"\")}\n                    tagRegistry={tagRegistry}\n                    placeholder=\"Select tag...\"\n                    singleSelect\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {mutation.type === \"set_tag\" && (\n              <>\n                <div className=\"form-group\">\n                  <label htmlFor=\"value-optional\" className=\"label\">Value (optional)</label>\n                  <input id=\"value-optional\"\n                    type=\"text\"\n                    value={mutation.value !== undefined ? String(mutation.value) : \"\"}\n                    onChange={(e) => update(\"value\", parseTagValue(e.target.value))}\n                    className=\"input\"\n                    placeholder=\"true\"\n                    disabled={Boolean(mutation.valueFrom)}\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label htmlFor=\"value-source-optional\" className=\"label\">Value Source (optional)</label>\n                  <input id=\"value-source-optional\"\n                    type=\"text\"\n                    value={mutation.valueFrom || \"\"}\n                    onChange={(e) => update(\"valueFrom\", e.target.value || undefined)}\n                    className=\"input\"\n                    placeholder=\"e.g., cluster_id\"\n                  />\n                </div>\n              </>\n            )}\n\n            {mutation.type === \"change_status\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity\"\n                  value={mutation.entity || \"\"}\n                  onChange={(v) => update(\"entity\", v)}\n                  options={entityRefs}\n                  placeholder=\"Select entity...\"\n                />\n                <div className=\"form-group\">\n                  <label htmlFor=\"new-status\" className=\"label\">New Status</label>\n                  <input id=\"new-status\"\n                    type=\"text\"\n                    value={mutation.newStatus || \"\"}\n                    onChange={(e) => update(\"newStatus\", e.target.value || undefined)}\n                    className=\"input\"\n                    placeholder=\"e.g., active\"\n                  />\n                </div>\n              </>\n            )}\n\n            {mutation.type === \"adjust_prominence\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity\"\n                  value={mutation.entity || \"\"}\n                  onChange={(v) => update(\"entity\", v)}\n                  options={entityRefs}\n                  placeholder=\"Select entity...\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Delta\n                  <NumberInput\n                    value={mutation.delta}\n                    onChange={(v) => update(\"delta\", v ?? 0)}\n                    placeholder=\"e.g., 0.25 or -0.15\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {mutation.type === \"create_relationship\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Relationship Kind\"\n                  value={mutation.kind || \"\"}\n                  onChange={(v) => update(\"kind\", v)}\n                  options={relationshipKindOptions}\n                  placeholder=\"Select relationship...\"\n                />\n                <ReferenceDropdown\n                  label=\"Source\"\n                  value={mutation.src || \"\"}\n                  onChange={(v) => update(\"src\", v)}\n                  options={entityRefs}\n                  placeholder=\"Select source...\"\n                />\n                <ReferenceDropdown\n                  label=\"Destination\"\n                  value={mutation.dst || \"\"}\n                  onChange={(v) => update(\"dst\", v)}\n                  options={entityRefs}\n                  placeholder=\"Select destination...\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Strength\n                  <NumberInput\n                    value={mutation.strength}\n                    onChange={(v) => update(\"strength\", v)}\n                    min={0}\n                    max={1}\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label htmlFor=\"category-optional\" className=\"label\">Category (optional)</label>\n                  <input id=\"category-optional\"\n                    type=\"text\"\n                    value={mutation.category || \"\"}\n                    onChange={(e) => update(\"category\", e.target.value || undefined)}\n                    className=\"input\"\n                    placeholder=\"Optional\"\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"checkbox-label\">\n                    <input\n                      type=\"checkbox\"\n                      checked={mutation.bidirectional || false}\n                      onChange={(e) => update(\"bidirectional\", e.target.checked || undefined)}\n                      className=\"checkbox\"\n                    />\n                    Bidirectional\n                  </label>\n                </div>\n              </>\n            )}\n\n            {mutation.type === \"adjust_relationship_strength\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Relationship Kind\"\n                  value={mutation.kind || \"\"}\n                  onChange={(v) => update(\"kind\", v)}\n                  options={relationshipKindOptions}\n// ... (truncated)", "parameters": [{"name": "{\n  mutation,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  entityOptions,\n  typeOptions,\n  createMutation,\n  titlePrefix,\n}", "type": "{ mutation: any; onChange: any; onRemove: any; schema: any; pressures: any; entityOptions: any; typeOptions: any; createMutation: any; titlePrefix: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/shared/SelectionRuleEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/shared/SelectionRuleEditor.jsx", "sourceCode": "export function SelectionRuleEditor({\n  value,\n  onChange,\n  schema,\n  availableRefs = [],\n  showPickStrategy = true,\n  showMaxResults = true,\n  showFilters = true,\n  allowAnyKind = false,\n  showExcludeSubtypes = false,\n}) {\n  const selection = value || { strategy: \"by_kind\" };\n\n  const baseKindOptions = (schema?.entityKinds || []).map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n  const entityKindOptions = allowAnyKind\n    ? [{ value: \"any\", label: \"Any kind\" }, ...baseKindOptions]\n    : baseKindOptions;\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const getSubtypeOptions = (kind) => {\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const updateSelection = (field, fieldValue) => {\n    onChange({ ...selection, [field]: fieldValue });\n  };\n\n  const updateSelectionMultiple = (updates) => {\n    onChange({ ...selection, ...updates });\n  };\n\n  const referenceOptions = (availableRefs.length > 0 ? availableRefs : [\"$target\"]).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  return (\n    <div>\n      <div className=\"form-grid\">\n        <ReferenceDropdown\n          label=\"Selection Strategy\"\n          value={selection.strategy || \"by_kind\"}\n          onChange={(v) => updateSelection(\"strategy\", v)}\n          options={[\n            { value: \"by_kind\", label: \"By Entity Kind\" },\n            { value: \"by_preference_order\", label: \"By Subtype Preference\" },\n            { value: \"by_relationship\", label: \"By Relationship Presence\" },\n            { value: \"by_proximity\", label: \"By Proximity\" },\n            { value: \"by_prominence\", label: \"By Prominence\" },\n          ]}\n        />\n\n        {showPickStrategy && (\n          <ReferenceDropdown\n            label=\"Pick Strategy\"\n            value={selection.pickStrategy || \"random\"}\n            onChange={(v) => updateSelection(\"pickStrategy\", v)}\n            options={PICK_STRATEGIES}\n          />\n        )}\n\n        {showMaxResults && (\n          <div className=\"form-group\">\n            <label className=\"label\">Max Results\n            <NumberInput\n              value={selection.maxResults}\n              onChange={(v) => updateSelection(\"maxResults\", v)}\n              min={1}\n              integer\n              allowEmpty\n              placeholder=\"1\"\n            />\n            </label>\n          </div>\n        )}\n      </div>\n\n      <div className=\"form-grid mt-xl\">\n        <ReferenceDropdown\n          label=\"Entity Kind\"\n          value={selection.kind || \"\"}\n          onChange={(v) =>\n            updateSelectionMultiple({\n              kind: v || undefined,\n              subtypes: undefined,\n              excludeSubtypes: undefined,\n            })\n          }\n          options={entityKindOptions}\n          placeholder=\"Any kind\"\n        />\n        <div className=\"form-group\">\n          <label htmlFor=\"status-optional\" className=\"label\">Status (optional)</label>\n          <input id=\"status-optional\"\n            type=\"text\"\n            value={selection.status || \"\"}\n            onChange={(e) => updateSelection(\"status\", e.target.value || undefined)}\n            className=\"input\"\n            placeholder=\"e.g., active\"\n          />\n        </div>\n        <div className=\"form-group\">\n          <label htmlFor=\"not-status-optional\" className=\"label\">Not Status (optional)</label>\n          <input id=\"not-status-optional\"\n            type=\"text\"\n            value={selection.notStatus || \"\"}\n            onChange={(e) => updateSelection(\"notStatus\", e.target.value || undefined)}\n            className=\"input\"\n            placeholder=\"e.g., dead\"\n          />\n        </div>\n      </div>\n\n      {selection.kind && selection.kind !== \"any\" && (\n        <div className=\"mt-xl\">\n          <ChipSelect\n            label=\"Subtypes (optional)\"\n            value={selection.subtypes || []}\n            onChange={(v) => updateSelection(\"subtypes\", v.length > 0 ? v : undefined)}\n            options={getSubtypeOptions(selection.kind)}\n            placeholder=\"Any subtype\"\n          />\n        </div>\n      )}\n\n      {selection.kind && selection.kind !== \"any\" && showExcludeSubtypes && (\n        <div className=\"mt-xl\">\n          <ChipSelect\n            label=\"Exclude Subtypes (optional)\"\n            value={selection.excludeSubtypes || []}\n            onChange={(v) => updateSelection(\"excludeSubtypes\", v.length > 0 ? v : undefined)}\n            options={getSubtypeOptions(selection.kind)}\n            placeholder=\"None\"\n          />\n        </div>\n      )}\n\n      {selection.strategy === \"by_preference_order\" && (\n        <div className=\"mt-xl\">\n          <label htmlFor=\"subtype-preferences-comma-separated\" className=\"label\">Subtype Preferences (comma-separated)</label>\n          <input id=\"subtype-preferences-comma-separated\"\n            type=\"text\"\n            value={(selection.subtypePreferences || []).join(\", \")}\n            onChange={(e) => {\n              const prefs = e.target.value\n                .split(\",\")\n                .map((s) => s.trim())\n                .filter(Boolean);\n              updateSelection(\"subtypePreferences\", prefs.length > 0 ? prefs : undefined);\n            }}\n            className=\"input\"\n            placeholder=\"e.g., noble, commoner\"\n          />\n        </div>\n      )}\n\n      {selection.strategy === \"by_relationship\" && (\n        <div className=\"form-grid mt-xl\">\n          <ReferenceDropdown\n            label=\"Relationship Kind\"\n            value={selection.relationshipKind || \"\"}\n            onChange={(v) => updateSelection(\"relationshipKind\", v)}\n            options={relationshipKindOptions}\n            placeholder=\"Select relationship...\"\n          />\n          <ReferenceDropdown\n            label=\"Direction\"\n            value={selection.direction || \"both\"}\n            onChange={(v) => updateSelection(\"direction\", v)}\n            options={[\n              { value: \"both\", label: \"Both\" },\n              { value: \"src\", label: \"Source (outgoing)\" },\n              { value: \"dst\", label: \"Destination (incoming)\" },\n            ]}\n          />\n          <div className=\"form-group\">\n            <label className=\"checkbox-label\">\n              <input\n                type=\"checkbox\"\n                checked={selection.mustHave !== false}\n                onChange={(e) => updateSelection(\"mustHave\", e.target.checked)}\n                className=\"checkbox\"\n              />\n              Must Have Relationship\n            </label>\n          </div>\n        </div>\n      )}\n\n      {selection.strategy === \"by_proximity\" && (\n        <div className=\"form-grid mt-xl\">\n          <ReferenceDropdown\n            label=\"Reference Entity\"\n            value={selection.referenceEntity || \"\"}\n            onChange={(v) => updateSelection(\"referenceEntity\", v || undefined)}\n            options={referenceOptions}\n            placeholder={referenceOptions[0]?.value || \"\"}\n          />\n          <div className=\"form-group\">\n            <label className=\"label\">Max Distance\n            <NumberInput\n              value={selection.maxDistance}\n              onChange={(v) => updateSelection(\"maxDistance\", v)}\n              min={0}\n              allowEmpty\n              placeholder=\"50\"\n            />\n            </label>\n          </div>\n        </div>\n      )}\n\n      {selection.strategy === \"by_prominence\" && (\n        <div className=\"mt-xl\">\n          <ReferenceDropdown\n            label=\"Minimum Prominence\"\n            value={selection.minProminence || \"\"}\n            onChange={(v) => updateSelection(\"minProminence\", v || undefined)}\n            options={PROMINENCE_LEVELS.map((p) => ({ value: p.value, label: p.label }))}\n            placeholder=\"Any\"\n          />\n        </div>\n      )}\n\n      {showFilters && (\n        <div className=\"mt-2xl\">\n          <span className=\"label\">Selection Filters</span>\n          <div className=\"info-box-text mb-lg text-sm\">\n            Optional filters to narrow down which entities can be selected. All filters must pass.\n          </div>\n          <SelectionFiltersEditor\n            filters={selection.filters}\n            onChange={(filters) =>\n              updateSelection(\"filters\", filters.length > 0 ? filters : undefined)\n            }\n            schema={schema}\n            availableRefs={availableRefs}\n          />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  value,\n  onChange,\n  schema,\n  availableRefs = [],\n  showPickStrategy = true,\n  showMaxResults = true,\n  showFilters = true,\n  allowAnyKind = false,\n  showExcludeSubtypes = false,\n}", "type": "{ value: any; onChange: any; schema: any; availableRefs?: any[]; showPickStrategy?: boolean; showMaxResults?: boolean; showFilters?: boolean; allowAnyKind?: boolean; showExcludeSubtypes?: boolean; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/shared/VariableSelectionEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/shared/VariableSelectionEditor.jsx", "sourceCode": "export function VariableSelectionEditor({\n  value,\n  onChange,\n  schema,\n  availableRefs = [],\n  showPickStrategy = true,\n  showMaxResults = true,\n  allowPreferFilters = true,\n}) {\n  const select = value || {};\n  const selectionMode = getSelectionMode(select);\n  const isRelatedMode = selectionMode === \"related\";\n  const isPathMode = selectionMode === \"path\";\n  const fromSpec = isRelatedMode ? select.from : null;\n  const pathSpec = isPathMode ? select.from : null;\n\n  const entityKindOptions = (schema?.entityKinds || []).map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const getSubtypeOptions = (kind) => {\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const updateSelect = (field, fieldValue) => {\n    onChange({ ...select, [field]: fieldValue });\n  };\n\n  const updateSelectMultiple = (updates) => {\n    onChange({ ...select, ...updates });\n  };\n\n  const setMode = (mode) => {\n    if (mode === \"graph\") {\n      onChange({ ...select, from: \"graph\" });\n      return;\n    }\n    if (mode === \"path\") {\n      const startRef = availableRefs[0] || \"$self\";\n      onChange({\n        ...select,\n        from: {\n          path: [{ from: startRef, via: \"\", direction: \"both\" }],\n        },\n      });\n      return;\n    }\n    const relatedTo = availableRefs[0] || \"$target\";\n    onChange({\n      ...select,\n      from: { relatedTo, relationshipKind: \"\", direction: \"both\" },\n    });\n  };\n\n  const updatePathStep = (index, step) => {\n    const path = [...(pathSpec?.path || [])];\n    path[index] = step;\n    updateSelect(\"from\", { path });\n  };\n\n  const addPathStep = () => {\n    const path = [...(pathSpec?.path || [])];\n    path.push({ via: \"\", direction: \"both\" });\n    updateSelect(\"from\", { path });\n  };\n\n  const removePathStep = (index) => {\n    const path = (pathSpec?.path || []).filter((_, i) => i !== index);\n    if (path.length === 0) {\n      // Switch back to graph mode if no steps left\n      setMode(\"graph\");\n    } else {\n      updateSelect(\"from\", { path });\n    }\n  };\n\n  const updateFrom = (field, fieldValue) => {\n    const nextFrom = {\n      ...(fromSpec || {\n        relatedTo: availableRefs[0] || \"$target\",\n        relationshipKind: \"\",\n        direction: \"both\",\n      }),\n      [field]: fieldValue,\n    };\n    updateSelect(\"from\", nextFrom);\n  };\n\n  return (\n    <div>\n      <div className=\"form-grid\">\n        <ReferenceDropdown\n          label=\"Select From\"\n          value={selectionMode}\n          onChange={(v) => setMode(v)}\n          options={[\n            { value: \"graph\", label: \"Graph (by entity kind)\" },\n            { value: \"related\", label: \"Related Entities (single hop)\" },\n            { value: \"path\", label: \"Path Traversal (multi-hop)\" },\n          ]}\n        />\n\n        {selectionMode === \"graph\" && (\n          <ReferenceDropdown\n            label=\"Entity Kind\"\n            value={select.kind || \"\"}\n            onChange={(v) => updateSelectMultiple({ kind: v || undefined, subtypes: undefined })}\n            options={entityKindOptions}\n            placeholder=\"Any kind\"\n          />\n        )}\n\n        {isRelatedMode && (\n          <>\n            <ReferenceDropdown\n              label=\"Related To\"\n              value={fromSpec?.relatedTo || availableRefs[0] || \"$target\"}\n              onChange={(v) => updateFrom(\"relatedTo\", v)}\n              options={availableRefs.map((r) => ({ value: r, label: r }))}\n              placeholder=\"Select entity...\"\n            />\n            <ReferenceDropdown\n              label=\"Relationship Kind\"\n              value={fromSpec?.relationshipKind || \"\"}\n              onChange={(v) => updateFrom(\"relationshipKind\", v)}\n              options={relationshipKindOptions}\n              placeholder=\"Select relationship...\"\n            />\n            <ReferenceDropdown\n              label=\"Direction\"\n              value={fromSpec?.direction || \"both\"}\n              onChange={(v) => updateFrom(\"direction\", v)}\n              options={[\n                { value: \"both\", label: \"Both\" },\n                { value: \"src\", label: \"Source (outgoing)\" },\n                { value: \"dst\", label: \"Destination (incoming)\" },\n              ]}\n            />\n          </>\n        )}\n\n        {isPathMode && (\n          <div className=\"grid-col-full\">\n            <span className=\"label\">Path Steps</span>\n            <div className=\"info-box-text mb-lg text-sm\">\n              Multi-hop traversal from the starting entity through relationships.\n            </div>\n          </div>\n        )}\n\n        {showPickStrategy && (\n          <ReferenceDropdown\n            label=\"Pick Strategy\"\n            value={select.pickStrategy || \"\"}\n            onChange={(v) => updateSelect(\"pickStrategy\", v || undefined)}\n            options={VARIABLE_PICK_STRATEGIES}\n            placeholder=\"Select...\"\n          />\n        )}\n\n        {showMaxResults && (\n          <div className=\"form-group\">\n            <label className=\"label\">Max Results\n            <NumberInput\n              value={select.maxResults}\n              onChange={(v) => updateSelect(\"maxResults\", v)}\n              min={1}\n              integer\n              allowEmpty\n              placeholder=\"1\"\n            />\n            </label>\n          </div>\n        )}\n      </div>\n\n      {isPathMode && (\n        <div className=\"mt-xl\">\n          {(pathSpec?.path || []).map((step, index) => (\n            <div key={index} className=\"item-card mb-lg\">\n              <div className=\"item-card-header p-lg\">\n                <div className=\"item-card-icon\">\ud83d\udd17</div>\n                <div className=\"item-card-info\">\n                  <div className=\"item-card-title\">Step {index + 1}</div>\n                </div>\n                <button\n                  className=\"btn-icon btn-icon-danger\"\n                  onClick={() => removePathStep(index)}\n                  title=\"Remove step\"\n                >\n                  \u00d7\n                </button>\n              </div>\n              <div className=\"item-card-body\">\n                <div className=\"form-grid\">\n                  {index === 0 && (\n                    <ReferenceDropdown\n                      label=\"Start From\"\n                      value={step.from || availableRefs[0] || \"$self\"}\n                      onChange={(v) => updatePathStep(index, { ...step, from: v })}\n                      options={availableRefs.map((r) => ({ value: r, label: r }))}\n                      placeholder=\"Select entity...\"\n                    />\n                  )}\n                  <ReferenceDropdown\n                    label=\"Via Relationship\"\n                    value={step.via || \"\"}\n                    onChange={(v) => updatePathStep(index, { ...step, via: v })}\n                    options={relationshipKindOptions}\n                    placeholder=\"Select relationship...\"\n                  />\n                  <ReferenceDropdown\n                    label=\"Direction\"\n                    value={step.direction || \"both\"}\n                    onChange={(v) => updatePathStep(index, { ...step, direction: v })}\n                    options={[\n                      { value: \"both\", label: \"Both\" },\n                      { value: \"src\", label: \"Source (outgoing)\" },\n                      { value: \"dst\", label: \"Destination (incoming)\" },\n                    ]}\n                  />\n                  <ReferenceDropdown\n                    label=\"Target Kind (optional)\"\n                    value={step.targetKind || \"\"}\n                    onChange={(v) => updatePathStep(index, { ...step, targetKind: v || undefined })}\n                    options={entityKindOptions}\n                    placeholder=\"Any kind\"\n                  />\n                </div>\n              </div>\n            </div>\n          ))}\n          <button className=\"btn-add\" onClick={addPathStep}>\n            + Add Step\n          </button>\n        </div>\n      )}\n\n      {(isRelatedMode || isPathMode) && (\n        <div className=\"mt-xl\">\n          <ReferenceDropdown\n            label=\"Filter by Entity Kind (optional)\"\n            value={select.kind || \"\"}\n            onChange={(v) => updateSelectMultiple({ kind: v || undefined, subtypes: undefined })}\n            options={entityKindOptions}\n            placeholder=\"Any kind\"\n          />\n        </div>\n      )}\n\n      {select.kind && (\n        <div className=\"mt-xl\">\n          <ChipSelect\n            label=\"Subtypes (optional)\"\n            value={select.subtypes || []}\n            onChange={(v) => updateSelect(\"subtypes\", v.length > 0 ? v : undefined)}\n            options={getSubtypeOptions(select.kind)}\n            placeholder=\"Any subtype\"\n          />\n        </div>\n      )}\n\n      <div className=\"mt-xl\">\n        <label htmlFor=\"status-filter-optional\" className=\"label\">Status Filter (optional)</label>\n        <input id=\"status-filter-optional\"\n          type=\"text\"\n          value={select.status || \"\"}\n          onChange={(e) => updateSelect(\"status\", e.target.value || undefined)}\n          className=\"input\"\n          placeholder=\"e.g., active\"\n        />\n      </div>\n\n      <div className=\"mt-xl\">\n        <label htmlFor=\"not-status-optional\" className=\"label\">Not Status (optional)</label>\n        <input id=\"not-status-optional\"\n          type=\"text\"\n          value={select.notStatus || \"\"}\n          onChange={(e) => updateSelect(\"notStatus\", e.target.value || undefined)}\n          className=\"input\"\n          placeholder=\"e.g., dead\"\n        />\n      </div>\n\n      <div className=\"mt-2xl\">\n        <span className=\"label\">Selection Filters</span>\n        <div className=\"info-box-text mb-lg text-sm\">\n          Optional filters to narrow down which entities can be selected. All filters must pass.\n        </div>\n        <SelectionFiltersEditor\n          filters={select.filters}\n          onChange={(filters) => updateSelect(\"filters\", filters.length > 0 ? filters : undefined)}\n// ... (truncated)", "parameters": [{"name": "{\n  value,\n  onChange,\n  schema,\n  availableRefs = [],\n  showPickStrategy = true,\n  showMaxResults = true,\n  allowPreferFilters = true,\n}", "type": "{ value: any; onChange: any; schema: any; availableRefs?: any[]; showPickStrategy?: boolean; showMaxResults?: boolean; allowPreferFilters?: boolean; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/systems/constants.js::getSystemCategory", "name": "getSystemCategory", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/systems/constants.js", "sourceCode": "/**\n * Get the category for a system type\n * @param {string} systemType - The system type\n * @returns {string} The category name\n */\nexport function getSystemCategory(systemType) {\n  if (FRAMEWORK_SYSTEM_TYPES.has(systemType)) {\n    return \"framework\";\n  }\n  return systemType;\n}", "parameters": [{"name": "systemType", "type": "string", "optional": false}], "returnType": "string"}, {"id": "apps/coherence-engine/webui/src/components/systems/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/systems/index.js", "sourceCode": "export default function SystemsEditor({\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"systems:selected\");\n  const typePickerKey = buildStorageKey(projectId, \"systems:typePicker\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [showTypePicker, setShowTypePicker] = useState(\n    () => loadStoredValue(typePickerKey) === true\n  );\n\n  // Derive selectedSystem from index\n  const resolvedIndex = selectedId\n    ? systems.findIndex((system) => system.config?.id === selectedId)\n    : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedSystem = selectedIndex !== null ? systems[selectedIndex] : null;\n  const [expandedCategories, setExpandedCategories] = useState(() => {\n    // Start with all categories expanded\n    return Object.keys(SYSTEM_CATEGORIES).reduce((acc, cat) => {\n      acc[cat] = true;\n      return acc;\n    }, {});\n  });\n  const mouseDownOnOverlay = useRef(false);\n\n  const handleOverlayMouseDown = useCallback((e) => {\n    mouseDownOnOverlay.current = e.target === e.currentTarget;\n  }, []);\n\n  const handleOverlayClick = useCallback((e) => {\n    if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n      setShowTypePicker(false);\n    }\n  }, []);\n\n  // Group systems by category (framework systems grouped together)\n  const groupedSystems = useMemo(() => {\n    const groups = {};\n    systems.forEach((system) => {\n      const category = getSystemCategory(system.systemType || \"unknown\");\n      if (!groups[category]) {\n        groups[category] = [];\n      }\n      groups[category].push(system);\n    });\n    return groups;\n  }, [systems]);\n\n  // Get ordered list of categories that have systems\n  const categories = useMemo(() => {\n    const usedCategories = Object.keys(groupedSystems);\n    // Sort by defined order in SYSTEM_CATEGORIES\n    return usedCategories.sort((a, b) => {\n      const orderA = SYSTEM_CATEGORIES[a]?.order ?? 999;\n      const orderB = SYSTEM_CATEGORIES[b]?.order ?? 999;\n      return orderA - orderB;\n    });\n  }, [groupedSystems]);\n\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  useEffect(() => {\n    setShowTypePicker(loadStoredValue(typePickerKey) === true);\n  }, [typePickerKey]);\n\n  useEffect(() => {\n    if (selectionKey) {\n      if (selectedId) {\n        saveStoredValue(selectionKey, selectedId);\n      } else {\n        clearStoredValue(selectionKey);\n      }\n    }\n  }, [selectionKey, selectedId]);\n\n  useEffect(() => {\n    if (typePickerKey) {\n      if (showTypePicker) {\n        saveStoredValue(typePickerKey, true);\n      } else {\n        clearStoredValue(typePickerKey);\n      }\n    }\n  }, [typePickerKey, showTypePicker]);\n\n  useEffect(() => {\n    if (selectedId && selectedIndex === null) {\n      setSelectedId(null);\n      clearStoredValue(selectionKey);\n    }\n  }, [selectedId, selectedIndex, selectionKey]);\n\n  const handleSystemChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex >= 0 && selectedIndex < systems.length) {\n        const newSystems = [...systems];\n        newSystems[selectedIndex] = updated;\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (system) => {\n      const index = systems.findIndex((s) => s.config?.id === system.config?.id);\n      if (index >= 0) {\n        const newSystems = [...systems];\n        newSystems[index] = { ...system, enabled: system.enabled === false ? true : false };\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedSystem &&\n      confirm(`Delete system \"${selectedSystem.config?.name || selectedSystem.config?.id}\"?`)\n    ) {\n      const newSystems = systems.filter((_, i) => i !== selectedIndex);\n      onChange(newSystems);\n      setSelectedId(null);\n    }\n  }, [systems, onChange, selectedIndex, selectedSystem]);\n\n  const handleAddSystem = useCallback(\n    (type) => {\n      const needsSelection = [\n        \"graphContagion\",\n        \"connectionEvolution\",\n        \"thresholdTrigger\",\n        \"clusterFormation\",\n        \"tagDiffusion\",\n        \"planeDiffusion\",\n      ].includes(type);\n      const newSystem = {\n        systemType: type,\n        config: {\n          id: `system_${Date.now()}`,\n          name: `New ${SYSTEM_TYPES[type]?.label || type}`,\n          description: \"\",\n          ...(needsSelection ? { selection: { strategy: \"by_kind\", kind: \"any\" } } : {}),\n        },\n      };\n      onChange([...systems, newSystem]);\n      setSelectedId(newSystem.config.id);\n      setShowTypePicker(false);\n    },\n    [systems, onChange]\n  );\n\n  const toggleCategoryExpand = useCallback((type) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [type]: !prev[type],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (category) => {\n      const categoryItems = groupedSystems[category] || [];\n      const allEnabled = categoryItems.every((s) => s.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of systems in this category\n      const categoryIds = new Set(categoryItems.map((s) => s.config?.id));\n\n      const newSystems = systems.map((s) => {\n        if (categoryIds.has(s.config?.id)) {\n          return { ...s, enabled: newEnabled };\n        }\n        return s;\n      });\n      onChange(newSystems);\n    },\n    [systems, groupedSystems, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Systems</h1>\n        <p className=\"subtitle\">\n          Configure simulation systems that run during the simulation phase. Click a system to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((category) => {\n        const categoryConfig = SYSTEM_CATEGORIES[category] || { icon: \"\u2699\ufe0f\", label: category };\n        const categoryItems = groupedSystems[category] || [];\n        const allEnabled = categoryItems.every((s) => s.enabled !== false);\n\n        return (\n          <CategorySection\n            key={category}\n            id={category}\n            icon={categoryConfig.icon}\n            label={categoryConfig.label}\n            items={categoryItems}\n            expanded={expandedCategories[category] !== false}\n            onToggleExpand={() => toggleCategoryExpand(category)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(category)}\n            gridClassName=\"list-grid\"\n            renderItem={(system) => {\n              const flatIndex = systems.findIndex((s) => s.config?.id === system.config?.id);\n              return (\n                <SystemListCard\n                  key={flatIndex}\n                  system={system}\n                  onClick={() => setSelectedId(system.config.id)}\n                  onToggle={() => handleToggle(system)}\n                  usageMap={usageMap}\n                />\n              );\n            }}\n          />\n        );\n      })}\n\n      {/* Add System button */}\n      <div className=\"mt-xl\">\n        <div\n          className=\"add-card se-add-card-wrap\"\n          onClick={() => setShowTypePicker(true)}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n        >\n          <span className=\"se-add-icon\">+</span>\n          <span>Add System</span>\n        </div>\n      </div>\n\n      {showTypePicker && (\n        <div\n          className=\"modal-overlay\"\n          onMouseDown={handleOverlayMouseDown}\n          onClick={handleOverlayClick}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n        >\n          <div className=\"modal se-type-picker-modal\">\n            <div className=\"modal-header\">\n              <div className=\"modal-title\">Choose System Type</div>\n              <button className=\"close-btn\" onClick={() => setShowTypePicker(false)}>\n                \u00d7\n              </button>\n            </div>\n            <div className=\"se-type-picker-content\">\n              <div className=\"type-picker\">\n                {Object.entries(SYSTEM_TYPES).map(([type, config]) => (\n                  <div\n                    key={type}\n                    className=\"se-type-option type-option\"\n                    onClick={() => handleAddSystem(type)}\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    <div className=\"type-option-icon\">{config.icon}</div>\n                    <div className=\"type-option-label\">{config.label}</div>\n                    <div className=\"type-option-desc\">{config.desc}</div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {selectedSystem && (\n        <SystemModal\n          system={selectedSystem}\n          onChange={handleSystemChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; systems?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/systems/SystemsEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/systems/SystemsEditor.jsx", "sourceCode": "export default function SystemsEditor({\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"systems:selected\");\n  const typePickerKey = buildStorageKey(projectId, \"systems:typePicker\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [showTypePicker, setShowTypePicker] = useState(\n    () => loadStoredValue(typePickerKey) === true\n  );\n\n  // Derive selectedSystem from index\n  const resolvedIndex = selectedId\n    ? systems.findIndex((system) => system.config?.id === selectedId)\n    : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedSystem = selectedIndex !== null ? systems[selectedIndex] : null;\n  const [expandedCategories, setExpandedCategories] = useState(() => {\n    // Start with all categories expanded\n    return Object.keys(SYSTEM_CATEGORIES).reduce((acc, cat) => {\n      acc[cat] = true;\n      return acc;\n    }, {});\n  });\n  const mouseDownOnOverlay = useRef(false);\n\n  const handleOverlayMouseDown = useCallback((e) => {\n    mouseDownOnOverlay.current = e.target === e.currentTarget;\n  }, []);\n\n  const handleOverlayClick = useCallback((e) => {\n    if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n      setShowTypePicker(false);\n    }\n  }, []);\n\n  // Group systems by category (framework systems grouped together)\n  const groupedSystems = useMemo(() => {\n    const groups = {};\n    systems.forEach((system) => {\n      const category = getSystemCategory(system.systemType || \"unknown\");\n      if (!groups[category]) {\n        groups[category] = [];\n      }\n      groups[category].push(system);\n    });\n    return groups;\n  }, [systems]);\n\n  // Get ordered list of categories that have systems\n  const categories = useMemo(() => {\n    const usedCategories = Object.keys(groupedSystems);\n    // Sort by defined order in SYSTEM_CATEGORIES\n    return usedCategories.sort((a, b) => {\n      const orderA = SYSTEM_CATEGORIES[a]?.order ?? 999;\n      const orderB = SYSTEM_CATEGORIES[b]?.order ?? 999;\n      return orderA - orderB;\n    });\n  }, [groupedSystems]);\n\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  useEffect(() => {\n    setShowTypePicker(loadStoredValue(typePickerKey) === true);\n  }, [typePickerKey]);\n\n  useEffect(() => {\n    if (selectionKey) {\n      if (selectedId) {\n        saveStoredValue(selectionKey, selectedId);\n      } else {\n        clearStoredValue(selectionKey);\n      }\n    }\n  }, [selectionKey, selectedId]);\n\n  useEffect(() => {\n    if (typePickerKey) {\n      if (showTypePicker) {\n        saveStoredValue(typePickerKey, true);\n      } else {\n        clearStoredValue(typePickerKey);\n      }\n    }\n  }, [typePickerKey, showTypePicker]);\n\n  useEffect(() => {\n    if (selectedId && selectedIndex === null) {\n      setSelectedId(null);\n      clearStoredValue(selectionKey);\n    }\n  }, [selectedId, selectedIndex, selectionKey]);\n\n  const handleSystemChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex >= 0 && selectedIndex < systems.length) {\n        const newSystems = [...systems];\n        newSystems[selectedIndex] = updated;\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (system) => {\n      const index = systems.findIndex((s) => s.config?.id === system.config?.id);\n      if (index >= 0) {\n        const newSystems = [...systems];\n        newSystems[index] = { ...system, enabled: system.enabled === false ? true : false };\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedSystem &&\n      confirm(`Delete system \"${selectedSystem.config?.name || selectedSystem.config?.id}\"?`)\n    ) {\n      const newSystems = systems.filter((_, i) => i !== selectedIndex);\n      onChange(newSystems);\n      setSelectedId(null);\n    }\n  }, [systems, onChange, selectedIndex, selectedSystem]);\n\n  const handleAddSystem = useCallback(\n    (type) => {\n      const needsSelection = [\n        \"graphContagion\",\n        \"connectionEvolution\",\n        \"thresholdTrigger\",\n        \"clusterFormation\",\n        \"tagDiffusion\",\n        \"planeDiffusion\",\n      ].includes(type);\n      const newSystem = {\n        systemType: type,\n        config: {\n          id: `system_${Date.now()}`,\n          name: `New ${SYSTEM_TYPES[type]?.label || type}`,\n          description: \"\",\n          ...(needsSelection ? { selection: { strategy: \"by_kind\", kind: \"any\" } } : {}),\n        },\n      };\n      onChange([...systems, newSystem]);\n      setSelectedId(newSystem.config.id);\n      setShowTypePicker(false);\n    },\n    [systems, onChange]\n  );\n\n  const toggleCategoryExpand = useCallback((type) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [type]: !prev[type],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (category) => {\n      const categoryItems = groupedSystems[category] || [];\n      const allEnabled = categoryItems.every((s) => s.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of systems in this category\n      const categoryIds = new Set(categoryItems.map((s) => s.config?.id));\n\n      const newSystems = systems.map((s) => {\n        if (categoryIds.has(s.config?.id)) {\n          return { ...s, enabled: newEnabled };\n        }\n        return s;\n      });\n      onChange(newSystems);\n    },\n    [systems, groupedSystems, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Systems</h1>\n        <p className=\"subtitle\">\n          Configure simulation systems that run during the simulation phase. Click a system to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((category) => {\n        const categoryConfig = SYSTEM_CATEGORIES[category] || { icon: \"\u2699\ufe0f\", label: category };\n        const categoryItems = groupedSystems[category] || [];\n        const allEnabled = categoryItems.every((s) => s.enabled !== false);\n\n        return (\n          <CategorySection\n            key={category}\n            id={category}\n            icon={categoryConfig.icon}\n            label={categoryConfig.label}\n            items={categoryItems}\n            expanded={expandedCategories[category] !== false}\n            onToggleExpand={() => toggleCategoryExpand(category)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(category)}\n            gridClassName=\"list-grid\"\n            renderItem={(system) => {\n              const flatIndex = systems.findIndex((s) => s.config?.id === system.config?.id);\n              return (\n                <SystemListCard\n                  key={flatIndex}\n                  system={system}\n                  onClick={() => setSelectedId(system.config.id)}\n                  onToggle={() => handleToggle(system)}\n                  usageMap={usageMap}\n                />\n              );\n            }}\n          />\n        );\n      })}\n\n      {/* Add System button */}\n      <div className=\"mt-xl\">\n        <div\n          className=\"add-card se-add-card-wrap\"\n          onClick={() => setShowTypePicker(true)}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n        >\n          <span className=\"se-add-icon\">+</span>\n          <span>Add System</span>\n        </div>\n      </div>\n\n      {showTypePicker && (\n        <div\n          className=\"modal-overlay\"\n          onMouseDown={handleOverlayMouseDown}\n          onClick={handleOverlayClick}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n        >\n          <div className=\"modal se-type-picker-modal\">\n            <div className=\"modal-header\">\n              <div className=\"modal-title\">Choose System Type</div>\n              <button className=\"close-btn\" onClick={() => setShowTypePicker(false)}>\n                \u00d7\n              </button>\n            </div>\n            <div className=\"se-type-picker-content\">\n              <div className=\"type-picker\">\n                {Object.entries(SYSTEM_TYPES).map(([type, config]) => (\n                  <div\n                    key={type}\n                    className=\"se-type-option type-option\"\n                    onClick={() => handleAddSystem(type)}\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    <div className=\"type-option-icon\">{config.icon}</div>\n                    <div className=\"type-option-label\">{config.label}</div>\n                    <div className=\"type-option-desc\">{config.desc}</div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {selectedSystem && (\n        <SystemModal\n          system={selectedSystem}\n          onChange={handleSystemChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; systems?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/validation/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/validation/index.js", "sourceCode": "export default function ValidationEditor({\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}) {\n  const validationResults = useMemo(\n    () => runValidations(usageMap, schema, eras, pressures, generators, systems),\n    [usageMap, schema, eras, pressures, generators, systems]\n  );\n\n  // Count orphans from usageMap for summary\n  const orphanCounts = useMemo(() => {\n    if (!usageMap?.validation?.orphans)\n      return { generators: 0, systems: 0, pressures: 0, total: 0 };\n    const orphans = usageMap.validation.orphans;\n    const generators = orphans.filter((o) => o.type === \"generator\").length;\n    const systems = orphans.filter((o) => o.type === \"system\").length;\n    const pressures = orphans.filter((o) => o.type === \"pressure\").length;\n    return { generators, systems, pressures, total: generators + systems + pressures };\n  }, [usageMap]);\n\n  const overallStatus = getOverallStatus(validationResults);\n  const totalIssues = validationResults.errors.length + validationResults.warnings.length;\n  const hasNamingProfiles = useMemo(\n    () => (schema.cultures || []).some((culture) => culture.naming?.profiles?.length),\n    [schema]\n  );\n\n  let statusModifier;\n  if (overallStatus === \"clean\") {\n    statusModifier = \"validation-status-clean\";\n  } else if (overallStatus === \"warning\") {\n    statusModifier = \"validation-status-warning\";\n  } else {\n    statusModifier = \"validation-status-error\";\n  }\n  const statusBadgeClass = `validation-status-badge ${statusModifier}`;\n\n  const handleItemClick = (itemId) => {\n    if (onNavigateToGenerator) {\n      onNavigateToGenerator(itemId);\n    }\n  };\n\n  // Count total affected items\n  const totalAffectedItems = [...validationResults.errors, ...validationResults.warnings].reduce(\n    (sum, issue) => sum + issue.affectedItems.length,\n    0\n  );\n\n  return (\n    <div className=\"validation-container\">\n      <div className=\"validation-header\">\n        <div className=\"flex-between items-start\">\n          <div>\n            <h1 className=\"validation-title\">\n              Validation\n              <span className={statusBadgeClass}>\n                {(() => {\n                  if (overallStatus === \"clean\") return \"All Clear\";\n                  const issueWord = totalIssues === 1 ? \"Issue\" : \"Issues\";\n                  return `${totalIssues} ${issueWord}`;\n                })()}\n              </span>\n            </h1>\n            <p className=\"validation-subtitle\">\n              Semantic validation: reference integrity, pressure balance, and dead code detection.\n              Structure validation runs automatically as a gate before simulation.\n            </p>\n          </div>\n          {totalIssues > 0 && (\n            <div className=\"validation-export-row\">\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsJson(validationResults)}\n                title=\"Export validation report as JSON\"\n              >\n                Export JSON\n              </button>\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsCsv(validationResults)}\n                title=\"Export validation report as CSV\"\n              >\n                Export CSV\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"validation-summary-cards validation-summary-cards-4\">\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-danger\">\n            {validationResults.errors.length}\n          </div>\n          <div className=\"validation-summary-label\">Errors</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-warning\">\n            {validationResults.warnings.length}\n          </div>\n          <div className=\"validation-summary-label\">Warnings</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div\n            className={`validation-summary-value ${orphanCounts.total > 0 ? \"text-muted\" : \"text-info\"}`}\n          >\n            {orphanCounts.total}\n          </div>\n          <div className=\"validation-summary-label\">Unused</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-info\">\n            {totalAffectedItems}\n          </div>\n          <div className=\"validation-summary-label\">Affected Items</div>\n        </div>\n      </div>\n\n      {/* Clean state */}\n      {overallStatus === \"clean\" && (\n        <div className=\"validation-clean-state\">\n          <div className=\"validation-clean-icon\">\u2713</div>\n          <div className=\"validation-clean-title\">All Validations Passed</div>\n          <div className=\"validation-clean-message\">\n            Your configuration looks good. No issues detected.\n          </div>\n        </div>\n      )}\n\n      {/* Errors section */}\n      {validationResults.errors.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u274c</span>\n              Errors\n            </div>\n            <span className=\"validation-section-count validation-status-error\">\n              {validationResults.errors.length}\n            </span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.errors.map((error) => (\n              <IssueCard key={error.id} issue={error} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Warnings section */}\n      {validationResults.warnings.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u26a0\ufe0f</span>\n              Warnings\n            </div>\n            <span className=\"validation-section-count\">{validationResults.warnings.length}</span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.warnings.map((warning) => (\n              <IssueCard key={warning.id} issue={warning} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Dependency Viewer */}\n      {usageMap && (\n        <div className=\"mb-2xl\">\n          <DependencyViewer usageMap={usageMap} />\n        </div>\n      )}\n\n      {/* Naming Profile Mappings */}\n      {hasNamingProfiles && (\n        <div className=\"mb-2xl\">\n          <NamingProfileMappingViewer generators={generators} schema={schema} />\n        </div>\n      )}\n\n      {/* Rule info */}\n      <div className=\"validation-rule-info\">\n        <div className=\"validation-rule-title\">\n          Active Validation Rules ({Object.keys(validationRules).length})\n        </div>\n        <ul className=\"validation-rule-list\">\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-danger\">\u25cf</span>\n            <strong>Reference Validation:</strong> Entity kinds (generators, pressures, systems),\n            relationship kinds (generators, pressures, systems), pressure IDs (generators, systems,\n            eras, actions), era\u2192generator/system references\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Balance Validation:</strong> Pressure sources/sinks (feedback, homeostasis,\n            generators, systems), orphan generators/systems (not in any era)\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Configuration Quality:</strong> Subtypes, statuses, cultures, tags, numeric\n            ranges\n          </li>\n        </ul>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}", "type": "{ schema?: Readonly<{ entityKinds: any[]; relationshipKinds: any[]; cultures: any[]; tagRegistry: any[]; }>; eras?: any[]; pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; usageMap?: any; onNavigateToGenerator: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/validation/index.js::getValidationStatus", "name": "getValidationStatus", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/validation/index.js", "sourceCode": "/**\n * Export validation status calculation for use by parent\n */\nexport function getValidationStatus(usageMap, schema, eras, pressures, generators, systems) {\n  const results = runValidations(\n    usageMap,\n    schema || { entityKinds: [], relationshipKinds: [], cultures: [], tagRegistry: [] },\n    eras || [],\n    pressures || [],\n    generators || [],\n    systems || []\n  );\n  return {\n    status: getOverallStatus(results),\n    errorCount: results.errors.length,\n    warningCount: results.warnings.length,\n    totalIssues: results.errors.length + results.warnings.length,\n  };\n}", "parameters": [{"name": "usageMap", "type": "any", "optional": false}, {"name": "schema", "type": "any", "optional": false}, {"name": "eras", "type": "any", "optional": false}, {"name": "pressures", "type": "any", "optional": false}, {"name": "generators", "type": "any", "optional": false}, {"name": "systems", "type": "any", "optional": false}], "returnType": "{ status: string; errorCount: number; warningCount: number; totalIssues: number; }"}, {"id": "apps/coherence-engine/webui/src/components/validation/ValidationEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/validation/ValidationEditor.jsx", "sourceCode": "export default function ValidationEditor({\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}) {\n  const validationResults = useMemo(\n    () => runValidations(usageMap, schema, eras, pressures, generators, systems),\n    [usageMap, schema, eras, pressures, generators, systems]\n  );\n\n  // Count orphans from usageMap for summary\n  const orphanCounts = useMemo(() => {\n    if (!usageMap?.validation?.orphans)\n      return { generators: 0, systems: 0, pressures: 0, total: 0 };\n    const orphans = usageMap.validation.orphans;\n    const generators = orphans.filter((o) => o.type === \"generator\").length;\n    const systems = orphans.filter((o) => o.type === \"system\").length;\n    const pressures = orphans.filter((o) => o.type === \"pressure\").length;\n    return { generators, systems, pressures, total: generators + systems + pressures };\n  }, [usageMap]);\n\n  const overallStatus = getOverallStatus(validationResults);\n  const totalIssues = validationResults.errors.length + validationResults.warnings.length;\n  const hasNamingProfiles = useMemo(\n    () => (schema.cultures || []).some((culture) => culture.naming?.profiles?.length),\n    [schema]\n  );\n\n  let statusModifier;\n  if (overallStatus === \"clean\") {\n    statusModifier = \"validation-status-clean\";\n  } else if (overallStatus === \"warning\") {\n    statusModifier = \"validation-status-warning\";\n  } else {\n    statusModifier = \"validation-status-error\";\n  }\n  const statusBadgeClass = `validation-status-badge ${statusModifier}`;\n\n  const handleItemClick = (itemId) => {\n    if (onNavigateToGenerator) {\n      onNavigateToGenerator(itemId);\n    }\n  };\n\n  // Count total affected items\n  const totalAffectedItems = [...validationResults.errors, ...validationResults.warnings].reduce(\n    (sum, issue) => sum + issue.affectedItems.length,\n    0\n  );\n\n  return (\n    <div className=\"validation-container\">\n      <div className=\"validation-header\">\n        <div className=\"flex-between items-start\">\n          <div>\n            <h1 className=\"validation-title\">\n              Validation\n              <span className={statusBadgeClass}>\n                {(() => {\n                  if (overallStatus === \"clean\") return \"All Clear\";\n                  const issueWord = totalIssues === 1 ? \"Issue\" : \"Issues\";\n                  return `${totalIssues} ${issueWord}`;\n                })()}\n              </span>\n            </h1>\n            <p className=\"validation-subtitle\">\n              Semantic validation: reference integrity, pressure balance, and dead code detection.\n              Structure validation runs automatically as a gate before simulation.\n            </p>\n          </div>\n          {totalIssues > 0 && (\n            <div className=\"validation-export-row\">\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsJson(validationResults)}\n                title=\"Export validation report as JSON\"\n              >\n                Export JSON\n              </button>\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsCsv(validationResults)}\n                title=\"Export validation report as CSV\"\n              >\n                Export CSV\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"validation-summary-cards validation-summary-cards-4\">\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-danger\">\n            {validationResults.errors.length}\n          </div>\n          <div className=\"validation-summary-label\">Errors</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-warning\">\n            {validationResults.warnings.length}\n          </div>\n          <div className=\"validation-summary-label\">Warnings</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div\n            className={`validation-summary-value ${orphanCounts.total > 0 ? \"text-muted\" : \"text-info\"}`}\n          >\n            {orphanCounts.total}\n          </div>\n          <div className=\"validation-summary-label\">Unused</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-info\">\n            {totalAffectedItems}\n          </div>\n          <div className=\"validation-summary-label\">Affected Items</div>\n        </div>\n      </div>\n\n      {/* Clean state */}\n      {overallStatus === \"clean\" && (\n        <div className=\"validation-clean-state\">\n          <div className=\"validation-clean-icon\">\u2713</div>\n          <div className=\"validation-clean-title\">All Validations Passed</div>\n          <div className=\"validation-clean-message\">\n            Your configuration looks good. No issues detected.\n          </div>\n        </div>\n      )}\n\n      {/* Errors section */}\n      {validationResults.errors.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u274c</span>\n              Errors\n            </div>\n            <span className=\"validation-section-count validation-status-error\">\n              {validationResults.errors.length}\n            </span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.errors.map((error) => (\n              <IssueCard key={error.id} issue={error} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Warnings section */}\n      {validationResults.warnings.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u26a0\ufe0f</span>\n              Warnings\n            </div>\n            <span className=\"validation-section-count\">{validationResults.warnings.length}</span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.warnings.map((warning) => (\n              <IssueCard key={warning.id} issue={warning} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Dependency Viewer */}\n      {usageMap && (\n        <div className=\"mb-2xl\">\n          <DependencyViewer usageMap={usageMap} />\n        </div>\n      )}\n\n      {/* Naming Profile Mappings */}\n      {hasNamingProfiles && (\n        <div className=\"mb-2xl\">\n          <NamingProfileMappingViewer generators={generators} schema={schema} />\n        </div>\n      )}\n\n      {/* Rule info */}\n      <div className=\"validation-rule-info\">\n        <div className=\"validation-rule-title\">\n          Active Validation Rules ({Object.keys(validationRules).length})\n        </div>\n        <ul className=\"validation-rule-list\">\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-danger\">\u25cf</span>\n            <strong>Reference Validation:</strong> Entity kinds (generators, pressures, systems),\n            relationship kinds (generators, pressures, systems), pressure IDs (generators, systems,\n            eras, actions), era\u2192generator/system references\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Balance Validation:</strong> Pressure sources/sinks (feedback, homeostasis,\n            generators, systems), orphan generators/systems (not in any era)\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Configuration Quality:</strong> Subtypes, statuses, cultures, tags, numeric\n            ranges\n          </li>\n        </ul>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}", "type": "{ schema?: Readonly<{ entityKinds: any[]; relationshipKinds: any[]; cultures: any[]; tagRegistry: any[]; }>; eras?: any[]; pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; usageMap?: any; onNavigateToGenerator: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/validation/ValidationEditor.jsx::getValidationStatus", "name": "getValidationStatus", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/validation/ValidationEditor.jsx", "sourceCode": "/**\n * Export validation status calculation for use by parent\n */\nexport function getValidationStatus(usageMap, schema, eras, pressures, generators, systems) {\n  const results = runValidations(\n    usageMap,\n    schema || { entityKinds: [], relationshipKinds: [], cultures: [], tagRegistry: [] },\n    eras || [],\n    pressures || [],\n    generators || [],\n    systems || []\n  );\n  return {\n    status: getOverallStatus(results),\n    errorCount: results.errors.length,\n    warningCount: results.warnings.length,\n    totalIssues: results.errors.length + results.warnings.length,\n  };\n}", "parameters": [{"name": "usageMap", "type": "any", "optional": false}, {"name": "schema", "type": "any", "optional": false}, {"name": "eras", "type": "any", "optional": false}, {"name": "pressures", "type": "any", "optional": false}, {"name": "generators", "type": "any", "optional": false}, {"name": "systems", "type": "any", "optional": false}], "returnType": "{ status: string; errorCount: number; warningCount: number; totalIssues: number; }"}, {"id": "apps/coherence-engine/webui/src/components/weight-matrix/WeightMatrixEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/weight-matrix/WeightMatrixEditor.jsx", "sourceCode": "export default function WeightMatrixEditor({\n  generators = [],\n  systems = [],\n  eras = [],\n  onErasChange\n}) {\n  const [viewMode, setViewMode] = useState(\"generators\"); // 'generators' | 'systems'\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [editingCell, setEditingCell] = useState(null); // shape: rowId + eraId\n  const [editValue, setEditValue] = useState(\"\");\n  const [selectedRows, setSelectedRows] = useState(new Set());\n  const [copiedRow, setCopiedRow] = useState(null); // { id, weights: { eraId: value } }\n  const inputRef = useRef(null);\n\n  // Get current items based on view mode\n  const items = useMemo(() => {\n    const source = viewMode === \"generators\" ? generators : systems;\n    return source.map(item => ({\n      id: viewMode === \"generators\" ? item.id : item.config.id,\n      name: viewMode === \"generators\" ? item.name || item.id : item.config.name || item.config.id,\n      type: viewMode === \"generators\" ? \"generator\" : item.systemType\n    }));\n  }, [viewMode, generators, systems]);\n\n  // Detect orphaned references - IDs in eras that don't exist in generators/systems\n  const orphanedReferences = useMemo(() => {\n    const generatorIds = new Set(generators.map(g => g.id));\n    const systemIds = new Set(systems.map(s => s.config.id));\n    const orphanedGenerators = [];\n    const orphanedSystems = [];\n    eras.forEach(era => {\n      // Check template weights\n      Object.keys(era.templateWeights || {}).forEach(id => {\n        if (!generatorIds.has(id)) {\n          orphanedGenerators.push({\n            id,\n            eraId: era.id,\n            eraName: era.name\n          });\n        }\n      });\n\n      // Check system modifiers\n      Object.keys(era.systemModifiers || {}).forEach(id => {\n        if (!systemIds.has(id)) {\n          orphanedSystems.push({\n            id,\n            eraId: era.id,\n            eraName: era.name\n          });\n        }\n      });\n    });\n    return {\n      generators: orphanedGenerators,\n      systems: orphanedSystems\n    };\n  }, [eras, generators, systems]);\n\n  // Count total orphans\n  const totalOrphans = orphanedReferences.generators.length + orphanedReferences.systems.length;\n\n  // Clean up all orphaned references\n  const cleanupOrphanedReferences = useCallback(() => {\n    const generatorIds = new Set(generators.map(g => g.id));\n    const systemIds = new Set(systems.map(s => s.config.id));\n    const newEras = eras.map(era => {\n      const newTemplateWeights = {\n        ...era.templateWeights\n      };\n      const newSystemModifiers = {\n        ...era.systemModifiers\n      };\n\n      // Remove orphaned generator references\n      Object.keys(newTemplateWeights).forEach(id => {\n        if (!generatorIds.has(id)) {\n          delete newTemplateWeights[id];\n        }\n      });\n\n      // Remove orphaned system references\n      Object.keys(newSystemModifiers).forEach(id => {\n        if (!systemIds.has(id)) {\n          delete newSystemModifiers[id];\n        }\n      });\n      return {\n        ...era,\n        templateWeights: newTemplateWeights,\n        systemModifiers: newSystemModifiers\n      };\n    });\n    onErasChange(newEras);\n  }, [eras, generators, systems, onErasChange]);\n\n  // Filter items by search\n  const filteredItems = useMemo(() => {\n    if (!searchQuery) return items;\n    const query = searchQuery.toLowerCase();\n    return items.filter(item => item.id.toLowerCase().includes(query) || item.name.toLowerCase().includes(query));\n  }, [items, searchQuery]);\n\n  // Get weight for an item in an era\n  const getWeight = useCallback((itemId, eraId) => {\n    const era = eras.find(e => e.id === eraId);\n    if (!era) return null;\n    const weights = viewMode === \"generators\" ? era.templateWeights : era.systemModifiers;\n    return weights?.[itemId] ?? null;\n  }, [eras, viewMode]);\n\n  // Set weight for an item in an era\n  const setWeight = useCallback((itemId, eraId, value) => {\n    const newEras = eras.map(era => {\n      if (era.id !== eraId) return era;\n      const weightsKey = viewMode === \"generators\" ? \"templateWeights\" : \"systemModifiers\";\n      const weights = {\n        ...era[weightsKey]\n      };\n      if (value === null || value === \"\" || value === undefined) {\n        delete weights[itemId];\n      } else {\n        weights[itemId] = parseFloat(value) || 0;\n      }\n      return {\n        ...era,\n        [weightsKey]: weights\n      };\n    });\n    onErasChange(newEras);\n  }, [eras, viewMode, onErasChange]);\n\n  // Handle cell click to start editing\n  const handleCellClick = (rowId, eraId) => {\n    const currentValue = getWeight(rowId, eraId);\n    setEditingCell({\n      rowId,\n      eraId\n    });\n    setEditValue(currentValue !== null ? String(currentValue) : \"\");\n    setTimeout(() => inputRef.current?.select(), 0);\n  };\n\n  // Handle cell edit completion\n  const handleCellBlur = () => {\n    if (editingCell) {\n      const value = editValue.trim();\n      if (value === \"\") {\n        setWeight(editingCell.rowId, editingCell.eraId, null);\n      } else {\n        const numValue = parseFloat(value);\n        if (!isNaN(numValue)) {\n          setWeight(editingCell.rowId, editingCell.eraId, numValue);\n        }\n      }\n      setEditingCell(null);\n    }\n  };\n\n  // Handle keyboard navigation\n  const handleKeyDown = e => {\n    if (e.key === \"Enter\" || e.key === \"Tab\") {\n      e.preventDefault();\n      handleCellBlur();\n    } else if (e.key === \"Escape\") {\n      setEditingCell(null);\n    }\n  };\n\n  // Apply weight to all eras for a row\n  const applyToAllEras = (itemId, value) => {\n    const newEras = eras.map(era => {\n      const weightsKey = viewMode === \"generators\" ? \"templateWeights\" : \"systemModifiers\";\n      const weights = {\n        ...era[weightsKey]\n      };\n      if (value === null || value === 0) {\n        delete weights[itemId];\n      } else {\n        weights[itemId] = value;\n      }\n      return {\n        ...era,\n        [weightsKey]: weights\n      };\n    });\n    onErasChange(newEras);\n  };\n\n  // Copy row weights\n  const copyRow = itemId => {\n    const weights = {};\n    eras.forEach(era => {\n      const value = getWeight(itemId, era.id);\n      if (value !== null) {\n        weights[era.id] = value;\n      }\n    });\n    setCopiedRow({\n      id: itemId,\n      weights\n    });\n  };\n\n  // Paste row weights\n  const pasteRow = targetItemId => {\n    if (!copiedRow) return;\n    const newEras = eras.map(era => {\n      const weightsKey = viewMode === \"generators\" ? \"templateWeights\" : \"systemModifiers\";\n      const weights = {\n        ...era[weightsKey]\n      };\n      if (copiedRow.weights[era.id] !== undefined) {\n        weights[targetItemId] = copiedRow.weights[era.id];\n      } else {\n        delete weights[targetItemId];\n      }\n      return {\n        ...era,\n        [weightsKey]: weights\n      };\n    });\n    onErasChange(newEras);\n  };\n\n  // Remove from all eras\n  const removeFromAllEras = itemId => {\n    const newEras = eras.map(era => {\n      const weightsKey = viewMode === \"generators\" ? \"templateWeights\" : \"systemModifiers\";\n      const weights = {\n        ...era[weightsKey]\n      };\n      delete weights[itemId];\n      return {\n        ...era,\n        [weightsKey]: weights\n      };\n    });\n    onErasChange(newEras);\n  };\n\n  // Check if item is used in any era\n  const isUsedInAnyEra = itemId => {\n    return eras.some(era => {\n      const weights = viewMode === \"generators\" ? era.templateWeights : era.systemModifiers;\n      return weights?.[itemId] !== undefined && weights[itemId] !== null;\n    });\n  };\n\n  // Count eras where item is active\n  const countActiveEras = itemId => {\n    return eras.filter(era => {\n      const weights = viewMode === \"generators\" ? era.templateWeights : era.systemModifiers;\n      return weights?.[itemId] > 0;\n    }).length;\n  };\n\n  // Quick set weight for bulk operations\n  const [quickSetValue, setQuickSetValue] = useState(1);\n  const handleQuickSetSelected = () => {\n    const value = quickSetValue ?? 0;\n    selectedRows.forEach(itemId => {\n      applyToAllEras(itemId, value);\n    });\n    setSelectedRows(new Set());\n  };\n  const toggleRowSelection = itemId => {\n    const newSelection = new Set(selectedRows);\n    if (newSelection.has(itemId)) {\n      newSelection.delete(itemId);\n    } else {\n      newSelection.add(itemId);\n    }\n    setSelectedRows(newSelection);\n  };\n  const selectAllRows = () => {\n    if (selectedRows.size === filteredItems.length) {\n      setSelectedRows(new Set());\n    } else {\n      setSelectedRows(new Set(filteredItems.map(i => i.id)));\n    }\n  };\n  return <div className=\"weight-matrix-editor\">\n      <div className=\"header\">\n        <h1 className=\"title\">Weight Matrix</h1>\n        <p className=\"subtitle\">\n          Manage {viewMode} weights across all eras in a spreadsheet view. Click any cell to edit,\n          or use row actions for bulk operations.\n        </p>\n      </div>\n\n      {/* Orphaned References Warning */}\n      {totalOrphans > 0 && <div className=\"orphan-warning\">\n          <div className=\"orphan-warning-content\">\n            <span className=\"orphan-warning-icon\">\u26a0\ufe0f</span>\n            <div className=\"orphan-warning-text\">\n              <strong>\n                {totalOrphans} orphaned reference{totalOrphans !== 1 ? \"s\" : \"\"} detected\n              </strong>\n              <span className=\"orphan-warning-details\">\n// ... (truncated)", "parameters": [{"name": "{\n  generators = [],\n  systems = [],\n  eras = [],\n  onErasChange\n}", "type": "{ generators?: any[]; systems?: any[]; eras?: any[]; onErasChange: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/InstigatorTab.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/InstigatorTab.jsx", "sourceCode": "export function InstigatorTab({ action, onChange, schema }) {\n  const actor = action.actor || {};\n\n  const updateActor = (field, value) => {\n    onChange({\n      ...action,\n      actor: { ...actor, [field]: value },\n    });\n  };\n\n  const instigator = actor.instigator;\n  const hasInstigator = Boolean(instigator);\n\n  const addInstigator = () => {\n    updateActor(\"instigator\", { from: \"graph\", kind: \"\", pickStrategy: \"random\", required: false });\n  };\n\n  const updateInstigator = (updated) => {\n    updateActor(\"instigator\", updated);\n  };\n\n  const removeInstigator = () => {\n    updateActor(\"instigator\", undefined);\n  };\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Instigator</div>\n        <div className=\"info-box-text\">\n          Configure optional instigator selection for this action.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udc64 Instigator (Optional)</div>\n        <div className=\"section-desc\">\n          An instigator can trigger the action on behalf of the actor (e.g., NPC leader acts for\n          their faction).\n        </div>\n\n        {!hasInstigator ? (\n          <div>\n            <div className=\"text-muted text-small mb-md\">\n              No instigator configured. The actor performs the action directly.\n            </div>\n            <button className=\"btn btn-add\" onClick={addInstigator}>\n              + Add Instigator\n            </button>\n          </div>\n        ) : (\n          <div>\n            <label className=\"checkbox-label mb-lg\">\n              <input\n                type=\"checkbox\"\n                checked={instigator.required || false}\n                onChange={(e) =>\n                  updateInstigator({ ...instigator, required: e.target.checked || undefined })\n                }\n                className=\"checkbox\"\n              />\n              Instigator required\n            </label>\n            <VariableSelectionEditor\n              value={instigator}\n              onChange={(updated) =>\n                updateInstigator({ ...updated, required: instigator.required })\n              }\n              schema={schema}\n              availableRefs={[\"$actor\"]}\n            />\n            <button\n              className=\"btn btn-danger-outline mt-lg\"\n              onClick={removeInstigator}\n            >\n              Remove Instigator\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/VariablesTab.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/VariablesTab.jsx", "sourceCode": "// ============================================================================\n// VariablesTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.action - The action being edited\n * @param {Function} props.onChange - Callback when action changes\n * @param {Object} props.schema - Domain schema\n */\nexport function VariablesTab({ action, onChange, schema }) {\n  const variables = action.variables || {};\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  // Build available refs for relationship queries (actor, instigator, target, target2 + other vars)\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$actor\", \"$instigator\", \"$target\", \"$target2\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    // Ensure the name starts with $\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    // Create with empty required fields - validation will flag them\n    onChange({\n      ...action,\n      variables: {\n        ...variables,\n        [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"\" } },\n      },\n    });\n    setNewVarName(\"\");\n    setShowAddForm(false);\n  };\n\n  const varEntries = Object.entries(variables);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Variables</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What are variables?</div>\n          <div className=\"info-box-text\">\n            Variables let you select additional entities from the graph to use in mutations. For\n            example, you might select a <code className=\"inline-code\">$victimFaction</code> to\n            create an enemy relationship with, or an <code className=\"inline-code\">$artifact</code>{\" \"}\n            to modify. Variables are resolved after <code className=\"inline-code\">$actor</code> and{\" \"}\n            <code className=\"inline-code\">$target</code> are chosen.\n          </div>\n        </div>\n\n        {varEntries.length === 0 && !showAddForm ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udce6</div>\n            <div className=\"empty-state-title\">No variables defined</div>\n            <div className=\"empty-state-desc\">\n              Add variables to select additional entities for use in mutations.\n            </div>\n          </div>\n        ) : (\n          varEntries.map(([name, config]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={config}\n              onChange={(updated) =>\n                onChange({ ...action, variables: { ...variables, [name]: updated } })\n              }\n              onRemove={() => {\n                const newVars = { ...variables };\n                delete newVars[name];\n                onChange({ ...action, variables: newVars });\n              }}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/AddRuleButton.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/AddRuleButton.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Function} props.onAdd - Callback when a rule type is selected\n * @param {number} props.depth - Nesting depth (limits nested rule types at depth >= 2)\n */\nexport function AddRuleButton({ onAdd, depth = 0 }) {\n  const [showPicker, setShowPicker] = useState(false);\n\n  return (\n    <div className=\"dropdown\">\n      <button className=\"btn-add\" onClick={() => setShowPicker(!showPicker)}>\n        + Add Rule\n      </button>\n\n      {showPicker && (\n        <div className=\"dropdown-menu arb-dropdown\">\n          <div className=\"dropdown-options\">\n            {Object.entries(APPLICABILITY_TYPES)\n              .filter(([type]) => depth < 2 || (type !== \"or\" && type !== \"and\"))\n              .map(([type, config]) => (\n                <div\n                  key={type}\n                  className=\"dropdown-menu-item\"\n                  onClick={() => {\n                    onAdd(type);\n                    setShowPicker(false);\n                  }}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <div\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n                    style={{ '--arb-icon-bg': `${config.color}20`, backgroundColor: 'var(--arb-icon-bg)' }}\n                  >\n                    {config.icon}\n                  </div>\n                  <div>\n                    <div className=\"dropdown-menu-label\">{config.label}</div>\n                    <div className=\"arb-desc\">\n                      {config.desc}\n                    </div>\n                  </div>\n                </div>\n              ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ onAdd, depth = 0 }", "type": "{ onAdd: Function; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityRuleCard.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityRuleCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.rule - The rule configuration\n * @param {Function} props.onChange - Callback when rule changes\n * @param {Function} props.onRemove - Callback to remove this rule\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {number} props.depth - Nesting depth for nested rules\n */\nexport function ApplicabilityRuleCard({\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = APPLICABILITY_TYPES[rule.type] || {};\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const getSubtypesForKind = (kind) => {\n    const ek = entityKinds.find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const pressureOptions = (pressures || []).map((p) => ({\n    value: p.id,\n    label: p.name || p.id,\n  }));\n\n  const eraOptions = (eras || []).map((e) => ({\n    value: e.id,\n    label: e.name || e.id,\n  }));\n\n  const updateField = (field, value) => {\n    onChange({ ...rule, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (rule.type) {\n      case \"entity_count\": {\n        const kindSpec = `${rule.kind || \"?\"}${rule.subtype ? \":\" + rule.subtype : \"\"}`;\n        const minPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const maxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${kindSpec} ${minPart}${maxPart}`;\n      }\n      case \"pressure\":\n        return `${rule.pressureId || \"?\"} in [${rule.min ?? \"-\\u221E\"}, ${rule.max ?? \"\\u221E\"}]`;\n      case \"pressure_any_above\":\n        return `Any of [${rule.pressureIds?.join(\", \") || \"?\"}] > ${rule.threshold ?? \"?\"}`;\n      case \"pressure_compare\":\n        return `${rule.pressureA || \"?\"} ${rule.operator || \">\"} ${rule.pressureB || \"?\"}`;\n      case \"relationship_count\": {\n        const relMinPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const relMaxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${rule.relationshipKind || \"any\"} count ${relMinPart}${relMaxPart}`;\n      }\n      case \"relationship_exists\": {\n        const targetSuffix = rule.targetKind ? ` to ${rule.targetKind}` : \"\";\n        return `${rule.relationshipKind || \"?\"} exists${targetSuffix}`;\n      }\n      case \"tag_exists\":\n        return `has tag \"${rule.tag || \"?\"}\"`;\n      case \"tag_absent\":\n        return `missing tag \"${rule.tag || \"?\"}\"`;\n      case \"status\":\n        return rule.not ? `status != ${rule.status || \"?\"}` : `status = ${rule.status || \"?\"}`;\n      case \"prominence\":\n        return `prominence ${rule.min || \"?\"}-${rule.max || \"?\"}`;\n      case \"time_elapsed\":\n        return `${rule.minTicks || \"?\"} ticks since ${rule.since || \"updated\"}`;\n      case \"growth_phases_complete\": {\n        const eraSuffix = rule.eraId ? ` in ${rule.eraId}` : \"\";\n        return `${rule.minPhases ?? \"?\"} growth phases${eraSuffix}`;\n      }\n      case \"era_match\":\n        return rule.eras?.length ? rule.eras.join(\", \") : \"No eras selected\";\n      case \"random_chance\":\n        return `${Math.round((rule.chance ?? 0.5) * 100)}% chance`;\n      case \"cooldown_elapsed\":\n        return `${rule.cooldownTicks ?? \"?\"} ticks since last run`;\n      case \"creations_per_epoch\":\n        return `max ${rule.maxPerEpoch ?? \"?\"} per epoch`;\n      case \"graph_path\":\n        return `graph path (${rule.assert?.check || \"exists\"})`;\n      case \"entity_exists\":\n        return `entity ${rule.entity || \"?\"} exists`;\n      case \"entity_has_relationship\":\n        return `${rule.entity || \"?\"} has ${rule.relationshipKind || \"?\"} relationship`;\n      case \"or\":\n      case \"and\":\n        return `${rule.conditions?.length || 0} sub-rules`;\n      case \"always\":\n        return \"always\";\n      default:\n        return rule.type;\n    }\n  };\n\n  const isNested = rule.type === \"or\" || rule.type === \"and\";\n\n  return (\n    <div className=\"condition-card\">\n      <div className=\"condition-card-header\">\n        <div className=\"condition-card-type\">\n          <div\n            className=\"condition-card-icon\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n            style={{ '--arc-icon-bg': `${typeConfig.color || \"#3b82f6\"}20`, backgroundColor: 'var(--arc-icon-bg)' }}\n          >\n            {typeConfig.icon || \"\ud83d\udccb\"}\n          </div>\n          <div>\n            <div className=\"condition-card-label\">{typeConfig.label || rule.type}</div>\n            <div className=\"condition-card-summary\">{getSummary()}</div>\n          </div>\n        </div>\n        <div className=\"condition-card-actions\">\n          <button className=\"btn-icon\" onClick={() => setExpanded(!expanded)}>\n            {expanded ? \"^\" : \"v\"}\n          </button>\n          <button className=\"btn-icon btn-icon-danger\" onClick={onRemove}>\n            x\n          </button>\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"mt-lg\">\n          <div className=\"form-grid\">\n            {rule.type === \"entity_count\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={rule.kind}\n                  onChange={(v) => {\n                    updateField(\"kind\", v);\n                    if (rule.subtype) updateField(\"subtype\", undefined);\n                  }}\n                  options={entityKindOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Subtype (optional)\"\n                  value={rule.subtype || \"\"}\n                  onChange={(v) => updateField(\"subtype\", v || undefined)}\n                  options={[{ value: \"\", label: \"Any\" }, ...getSubtypesForKind(rule.kind)]}\n                  placeholder=\"Any\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure\"\n                  value={rule.pressureId}\n                  onChange={(v) => updateField(\"pressureId\", v)}\n                  options={pressureOptions}\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min Value\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"0\"\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max Value\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"100\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_any_above\" && (\n              <>\n                <div className=\"grid-col-full\">\n                  <ChipSelect\n                    label=\"Pressures\"\n                    value={rule.pressureIds || []}\n                    onChange={(v) => updateField(\"pressureIds\", v)}\n                    options={pressureOptions}\n                    placeholder=\"+ Add pressure\"\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Threshold\n                  <NumberInput\n                    value={rule.threshold}\n                    onChange={(v) => updateField(\"threshold\", v ?? 0)}\n                    min={-100}\n                    max={100}\n                    integer\n                    placeholder=\"50\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_compare\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure A\"\n                  value={rule.pressureA}\n                  onChange={(v) => updateField(\"pressureA\", v)}\n                  options={pressureOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Operator\"\n                  value={rule.operator || \">\"}\n                  onChange={(v) => updateField(\"operator\", v)}\n                  options={[\n                    { value: \">\", label: \">\" },\n                    { value: \">=\", label: \">=\" },\n                    { value: \"<\", label: \"<\" },\n                    { value: \"<=\", label: \"<=\" },\n                    { value: \"==\", label: \"==\" },\n                    { value: \"!=\", label: \"!=\" },\n                  ]}\n                />\n                <ReferenceDropdown\n                  label=\"Pressure B\"\n                  value={rule.pressureB}\n                  onChange={(v) => updateField(\"pressureB\", v)}\n                  options={pressureOptions}\n                />\n              </>\n            )}\n\n\n            {rule.type === \"era_match\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Eras\"\n                  value={rule.eras || []}\n                  onChange={(v) => updateField(\"eras\", v)}\n                  options={eraOptions}\n                  placeholder=\"+ Add era\"\n                />\n              </div>\n            )}\n\n            {rule.type === \"random_chance\" && (\n              <div className=\"form-group grid-col-full\">\n                <span className=\"label\">Chance (%)</span>\n                <div className=\"flex items-center gap-lg\">\n// ... (truncated)", "parameters": [{"name": "{\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}", "type": "{ rule: any; onChange: Function; onRemove: Function; schema: any; pressures: any[]; eras: any[]; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityTab.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n */\nexport function ApplicabilityTab({ generator, onChange, schema, pressures, eras }) {\n  const rules = generator.applicability || [];\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Applicability Rules</div>\n        <div className=\"section-desc\">\n          Define when this generator is eligible to run. If no rules are defined, the generator will\n          always be eligible. Multiple top-level rules are combined with AND logic.\n        </div>\n\n        {rules.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2713</div>\n            <div className=\"empty-state-title\">No applicability rules</div>\n            <div className=\"empty-state-desc\">\n              This generator will always be eligible to run. Add rules to control when it activates.\n            </div>\n          </div>\n        ) : (\n          rules.map((rule, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={rule}\n              onChange={(updated) => {\n                const newRules = [...rules];\n                newRules[index] = updated;\n                onChange({ ...generator, applicability: newRules });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, applicability: rules.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              pressures={pressures}\n              eras={eras}\n            />\n          ))\n        )}\n\n        <AddRuleButton\n          onAdd={(type) => {\n            const newRule = createNewRule(type, pressures);\n            onChange({ ...generator, applicability: [...rules, newRule] });\n          }}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema, pressures, eras }", "type": "{ generator: any; onChange: Function; schema: any; pressures: any[]; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/createNewRule.js::createNewRule", "name": "createNewRule", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/createNewRule.js", "sourceCode": "/**\n * createNewRule - Factory for creating new applicability rules\n */\n\n/**\n * Creates a new applicability rule with default values based on type\n * @param {string} type - The rule type\n * @param {Array} pressures - Available pressure definitions\n * @returns {Object} A new rule object with default values\n */\nexport function createNewRule(type, pressures) {\n  // Create rules with empty required fields - validation will flag them\n  // No domain-specific defaults - user must explicitly select values\n  const newRule = { type };\n  const firstPressure = (pressures || [])[0]?.id || \"\";\n\n  switch (type) {\n    case \"pressure\":\n      return { ...newRule, pressureId: firstPressure, min: 0, max: 100 };\n    case \"pressure_any_above\":\n      return { ...newRule, pressureIds: firstPressure ? [firstPressure] : [], threshold: 50 };\n    case \"pressure_compare\":\n      return { ...newRule, pressureA: firstPressure, pressureB: firstPressure, operator: \">\" };\n    case \"entity_count\":\n      return { ...newRule, kind: \"\", min: 0 };\n    case \"relationship_count\":\n      return { ...newRule, relationshipKind: \"\", direction: \"both\", min: 0 };\n    case \"relationship_exists\":\n      return { ...newRule, relationshipKind: \"\", direction: \"both\" };\n    case \"tag_exists\":\n      return { ...newRule, tag: \"\" };\n    case \"tag_absent\":\n      return { ...newRule, tag: \"\" };\n    case \"status\":\n      return { ...newRule, status: \"\" };\n    case \"prominence\":\n      return { ...newRule, min: \"recognized\" };\n    case \"time_elapsed\":\n      return { ...newRule, minTicks: 10, since: \"updated\" };\n    case \"growth_phases_complete\":\n      return { ...newRule, minPhases: 2 };\n    case \"era_match\":\n      return { ...newRule, eras: [] };\n    case \"random_chance\":\n      return { ...newRule, chance: 0.5 };\n    case \"cooldown_elapsed\":\n      return { ...newRule, cooldownTicks: 10 };\n    case \"creations_per_epoch\":\n      return { ...newRule, maxPerEpoch: 1 };\n    case \"graph_path\":\n      return { ...newRule, assert: { check: \"exists\", path: [] } };\n    case \"entity_exists\":\n      return { ...newRule, entity: \"$target\" };\n    case \"entity_has_relationship\":\n      return { ...newRule, entity: \"$target\", relationshipKind: \"\", direction: \"both\" };\n    case \"or\":\n    case \"and\":\n      return { ...newRule, conditions: [] };\n    case \"always\":\n    default:\n      return newRule;\n  }\n}", "parameters": [{"name": "type", "type": "string", "optional": false}, {"name": "pressures", "type": "any[]", "optional": false}], "returnType": "any"}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/createNewRule.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/createNewRule.js", "sourceCode": "/**\n * createNewRule - Factory for creating new applicability rules\n */\n\n/**\n * Creates a new applicability rule with default values based on type\n * @param {string} type - The rule type\n * @param {Array} pressures - Available pressure definitions\n * @returns {Object} A new rule object with default values\n */\nexport function createNewRule(type, pressures) {\n  // Create rules with empty required fields - validation will flag them\n  // No domain-specific defaults - user must explicitly select values\n  const newRule = { type };\n  const firstPressure = (pressures || [])[0]?.id || \"\";\n\n  switch (type) {\n    case \"pressure\":\n      return { ...newRule, pressureId: firstPressure, min: 0, max: 100 };\n    case \"pressure_any_above\":\n      return { ...newRule, pressureIds: firstPressure ? [firstPressure] : [], threshold: 50 };\n    case \"pressure_compare\":\n      return { ...newRule, pressureA: firstPressure, pressureB: firstPressure, operator: \">\" };\n    case \"entity_count\":\n      return { ...newRule, kind: \"\", min: 0 };\n    case \"relationship_count\":\n      return { ...newRule, relationshipKind: \"\", direction: \"both\", min: 0 };\n    case \"relationship_exists\":\n      return { ...newRule, relationshipKind: \"\", direction: \"both\" };\n    case \"tag_exists\":\n      return { ...newRule, tag: \"\" };\n    case \"tag_absent\":\n      return { ...newRule, tag: \"\" };\n    case \"status\":\n      return { ...newRule, status: \"\" };\n    case \"prominence\":\n      return { ...newRule, min: \"recognized\" };\n    case \"time_elapsed\":\n      return { ...newRule, minTicks: 10, since: \"updated\" };\n    case \"growth_phases_complete\":\n      return { ...newRule, minPhases: 2 };\n    case \"era_match\":\n      return { ...newRule, eras: [] };\n    case \"random_chance\":\n      return { ...newRule, chance: 0.5 };\n    case \"cooldown_elapsed\":\n      return { ...newRule, cooldownTicks: 10 };\n    case \"creations_per_epoch\":\n      return { ...newRule, maxPerEpoch: 1 };\n    case \"graph_path\":\n      return { ...newRule, assert: { check: \"exists\", path: [] } };\n    case \"entity_exists\":\n      return { ...newRule, entity: \"$target\" };\n    case \"entity_has_relationship\":\n      return { ...newRule, entity: \"$target\", relationshipKind: \"\", direction: \"both\" };\n    case \"or\":\n    case \"and\":\n      return { ...newRule, conditions: [] };\n    case \"always\":\n    default:\n      return newRule;\n  }\n}", "parameters": [{"name": "type", "type": "string", "optional": false}, {"name": "pressures", "type": "any[]", "optional": false}], "returnType": "any"}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/index.js::createNewRule", "name": "createNewRule", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/index.js", "sourceCode": "/**\n * createNewRule - Factory for creating new applicability rules\n */\n\n/**\n * Creates a new applicability rule with default values based on type\n * @param {string} type - The rule type\n * @param {Array} pressures - Available pressure definitions\n * @returns {Object} A new rule object with default values\n */\nexport function createNewRule(type, pressures) {\n  // Create rules with empty required fields - validation will flag them\n  // No domain-specific defaults - user must explicitly select values\n  const newRule = { type };\n  const firstPressure = (pressures || [])[0]?.id || \"\";\n\n  switch (type) {\n    case \"pressure\":\n      return { ...newRule, pressureId: firstPressure, min: 0, max: 100 };\n    case \"pressure_any_above\":\n      return { ...newRule, pressureIds: firstPressure ? [firstPressure] : [], threshold: 50 };\n    case \"pressure_compare\":\n      return { ...newRule, pressureA: firstPressure, pressureB: firstPressure, operator: \">\" };\n    case \"entity_count\":\n      return { ...newRule, kind: \"\", min: 0 };\n    case \"relationship_count\":\n      return { ...newRule, relationshipKind: \"\", direction: \"both\", min: 0 };\n    case \"relationship_exists\":\n      return { ...newRule, relationshipKind: \"\", direction: \"both\" };\n    case \"tag_exists\":\n      return { ...newRule, tag: \"\" };\n    case \"tag_absent\":\n      return { ...newRule, tag: \"\" };\n    case \"status\":\n      return { ...newRule, status: \"\" };\n    case \"prominence\":\n      return { ...newRule, min: \"recognized\" };\n    case \"time_elapsed\":\n      return { ...newRule, minTicks: 10, since: \"updated\" };\n    case \"growth_phases_complete\":\n      return { ...newRule, minPhases: 2 };\n    case \"era_match\":\n      return { ...newRule, eras: [] };\n    case \"random_chance\":\n      return { ...newRule, chance: 0.5 };\n    case \"cooldown_elapsed\":\n      return { ...newRule, cooldownTicks: 10 };\n    case \"creations_per_epoch\":\n      return { ...newRule, maxPerEpoch: 1 };\n    case \"graph_path\":\n      return { ...newRule, assert: { check: \"exists\", path: [] } };\n    case \"entity_exists\":\n      return { ...newRule, entity: \"$target\" };\n    case \"entity_has_relationship\":\n      return { ...newRule, entity: \"$target\", relationshipKind: \"\", direction: \"both\" };\n    case \"or\":\n    case \"and\":\n      return { ...newRule, conditions: [] };\n    case \"always\":\n    default:\n      return newRule;\n  }\n}", "parameters": [{"name": "type", "type": "string", "optional": false}, {"name": "pressures", "type": "any[]", "optional": false}], "returnType": "any"}, {"id": "apps/coherence-engine/webui/src/components/generators/cards/GeneratorListCard.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/cards/GeneratorListCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator to display\n * @param {Function} props.onClick - Callback when card is clicked\n * @param {Function} props.onToggle - Callback to toggle enabled state\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport function GeneratorListCard({ generator, onClick, onToggle, usageMap }) {\n  const isEnabled = generator.enabled !== false;\n\n  const summary = useMemo(() => {\n    const creates =\n      generator.creation?.map((c) => c.kind).filter((v, i, a) => a.indexOf(v) === i) || [];\n    const rels = generator.relationships?.length || 0;\n    const effects = generator.stateUpdates?.length || 0;\n    return { creates, rels, effects };\n  }, [generator]);\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"generator\", generator.id)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, generator.id]\n  );\n\n  const eraUsage = useMemo(() => {\n    if (!usageMap?.generators?.[generator.id]) return [];\n    return usageMap.generators[generator.id].eras || [];\n  }, [usageMap, generator.id]);\n\n  const errorCount = validation.invalidRefs.length;\n  const hasErrors = errorCount > 0;\n  const isOrphan = validation.isOrphan;\n\n  return (\n    <div\n      className={`card card-clickable ${!isEnabled ? \"card-disabled\" : \"\"} ${hasErrors ? \"card-error\" : \"\"} ${isOrphan && !hasErrors ? \"card-warning\" : \"\"}`}\n      onClick={onClick}\n      role=\"button\"\n      tabIndex={0}\n      onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }}\n    >\n      <div className=\"card-header\">\n        <div>\n          <div className=\"flex items-center gap-md\">\n            <span className=\"card-title\">{generator.name || generator.id}</span>\n            <ErrorBadge count={errorCount} />\n          </div>\n          <div className=\"card-id\">{generator.id}</div>\n        </div>\n        <EnableToggle\n          enabled={isEnabled}\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n        />\n      </div>\n\n      <div className=\"card-stats\">\n        <div className=\"card-stat\">\n          <span>\u2728</span> {generator.creation?.length || 0} creates\n        </div>\n        <div className=\"card-stat\">\n          <span>\ud83d\udd17</span> {summary.rels} rels\n        </div>\n        <div className=\"card-stat\">\n          <span>\u26a1</span> {summary.effects} effects\n        </div>\n      </div>\n\n      <div className=\"card-badges\">\n        {summary.creates.slice(0, 3).map((kind) => (\n          <span key={kind} className=\"badge badge-entity-kind\">\n            + {kind}\n          </span>\n        ))}\n      </div>\n\n      <EraBadges eras={eraUsage} />\n      {isOrphan && (\n        <div className=\"mt-md\">\n          <OrphanBadge isOrphan={isOrphan} />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onClick, onToggle, usageMap }", "type": "{ generator: any; onClick: Function; onToggle: Function; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/GraphPathEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/GraphPathEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.assert - The path assertion configuration\n * @param {Function} props.onChange - Callback when assertion changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function GraphPathEditor({ assert, onChange, schema, availableRefs }) {\n  const [showConstraintMenu, setShowConstraintMenu] = useState(false);\n\n  const assertion = assert || { check: \"exists\", path: [] };\n\n  const updateAssertion = (field, value) => {\n    onChange({ ...assertion, [field]: value });\n  };\n\n  const addStep = () => {\n    // Create with empty required fields - validation will flag them\n    const newStep = { via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" };\n    updateAssertion(\"path\", [...(assertion.path || []), newStep]);\n  };\n\n  const updateStep = (index, updated) => {\n    const newPath = [...(assertion.path || [])];\n    newPath[index] = updated;\n    updateAssertion(\"path\", newPath);\n  };\n\n  const removeStep = (index) => {\n    updateAssertion(\n      \"path\",\n      (assertion.path || []).filter((_, i) => i !== index)\n    );\n  };\n\n  const addConstraint = (type) => {\n    const newConstraint = { type };\n    if (type === \"has_relationship\" || type === \"lacks_relationship\") {\n      newConstraint.direction = \"any\";\n    }\n    updateAssertion(\"where\", [...(assertion.where || []), newConstraint]);\n    setShowConstraintMenu(false);\n  };\n\n  const updateConstraint = (index, updated) => {\n    const newWhere = [...(assertion.where || [])];\n    newWhere[index] = updated;\n    updateAssertion(\"where\", newWhere);\n  };\n\n  const removeConstraint = (index) => {\n    const newWhere = (assertion.where || []).filter((_, i) => i !== index);\n    updateAssertion(\"where\", newWhere.length > 0 ? newWhere : undefined);\n  };\n\n  // Collect variables from path steps for constraint references\n  const pathVars = (assertion.path || []).filter((s) => s.as).map((s) => s.as);\n  const allRefs = [...(availableRefs || []), ...pathVars];\n\n  return (\n    <div className=\"graph-path-editor\">\n      {/* Check type and count */}\n      <div className=\"path-editor-grid\">\n        <div>\n          <label className=\"label label-tiny\">Check Type\n          <ReferenceDropdown\n            value={assertion.check || \"exists\"}\n            onChange={(v) => updateAssertion(\"check\", v)}\n            options={PATH_CHECK_TYPES}\n          />\n          </label>\n        </div>\n        {(assertion.check === \"count_min\" || assertion.check === \"count_max\") && (\n          <div>\n            <label className=\"label label-tiny\">Count\n            <NumberInput\n              value={assertion.count ?? 1}\n              onChange={(v) => updateAssertion(\"count\", v ?? 1)}\n              min={0}\n              integer\n              className=\"input input-compact\"\n            />\n            </label>\n          </div>\n        )}\n      </div>\n\n      {/* Path steps */}\n      <div>\n        <span className=\"label label-tiny\">Path Steps (traverse relationships)</span>\n        <div className=\"path-steps-list\">\n          {(assertion.path || []).map((step, index) => (\n            <PathStepEditor\n              key={index}\n              step={step}\n              onChange={(updated) => updateStep(index, updated)}\n              onRemove={() => removeStep(index)}\n              schema={schema}\n              stepIndex={index}\n            />\n          ))}\n          {(assertion.path || []).length < 2 && (\n            <button onClick={addStep} className=\"button button-add-step\">\n              + Add Step {(assertion.path || []).length === 0 ? \"(required)\" : \"(optional)\"}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Where constraints */}\n      <div>\n        <span className=\"label label-tiny\">Where Constraints (optional)</span>\n        <div className=\"path-constraints-list\">\n          {(assertion.where || []).map((constraint, index) => (\n            <PathConstraintEditor\n              key={index}\n              constraint={constraint}\n              onChange={(updated) => updateConstraint(index, updated)}\n              onRemove={() => removeConstraint(index)}\n              schema={schema}\n              availableRefs={allRefs}\n            />\n          ))}\n          <div className=\"relative\">\n            <button\n              onClick={() => setShowConstraintMenu(!showConstraintMenu)}\n              className=\"button button-add-constraint\"\n            >\n              + Add Constraint\n            </button>\n            {showConstraintMenu && (\n              <div className=\"dropdown-menu\">\n                {PATH_CONSTRAINT_TYPES.map(({ value, label }) => (\n                  <div\n                    key={value}\n                    onClick={() => addConstraint(value)}\n                    className=\"dropdown-menu-item\"\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    {label}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ assert, onChange, schema, availableRefs }", "type": "{ assert: any; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/PathConstraintEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/PathConstraintEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.constraint - The path constraint configuration\n * @param {Function} props.onChange - Callback when constraint changes\n * @param {Function} props.onRemove - Callback to remove this constraint\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function PathConstraintEditor({ constraint, onChange, onRemove, schema, availableRefs }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  // Gather all subtypes from all entity kinds for subtype_equals constraint\n  const allSubtypeOptions = entityKinds.flatMap((ek) =>\n    (ek.subtypes || []).map((st) => ({\n      value: st.id,\n      label: `${st.name || st.id} (${ek.kind})`,\n    }))\n  );\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateConstraint = (field, value) => {\n    onChange({ ...constraint, [field]: value || undefined });\n  };\n\n  const renderConstraintFields = () => {\n    switch (constraint.type) {\n      case \"not_self\":\n        return <span className=\"text-muted text-small\">Target cannot be the starting entity</span>;\n\n      case \"not_in\":\n      case \"in\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Set Variable\n            <ReferenceDropdown\n              value={constraint.set || \"\"}\n              onChange={(v) => updateConstraint(\"set\", v)}\n              options={refOptions}\n              placeholder=\"e.g. $allies\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"kind_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Entity Kind\n            <ReferenceDropdown\n              value={constraint.kind || \"\"}\n              onChange={(v) => updateConstraint(\"kind\", v)}\n              options={entityKindOptions}\n            />\n            </label>\n          </div>\n        );\n\n      case \"subtype_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Subtype\n            <ReferenceDropdown\n              value={constraint.subtype || \"\"}\n              onChange={(v) => updateConstraint(\"subtype\", v)}\n              options={allSubtypeOptions}\n              placeholder=\"Select subtype...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"constraint-fields-grid\">\n            <div>\n              <label className=\"label label-micro\">Kind\n              <ReferenceDropdown\n                value={constraint.kind || \"\"}\n                onChange={(v) => updateConstraint(\"kind\", v)}\n                options={relationshipKindOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">With\n              <ReferenceDropdown\n                value={constraint.with || \"\"}\n                onChange={(v) => updateConstraint(\"with\", v)}\n                options={refOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">Direction\n              <ReferenceDropdown\n                value={constraint.direction || \"any\"}\n                onChange={(v) => updateConstraint(\"direction\", v)}\n                options={PATH_DIRECTIONS}\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  const constraintLabel =\n    PATH_CONSTRAINT_TYPES.find((c) => c.value === constraint.type)?.label || constraint.type;\n\n  return (\n    <div className=\"path-constraint-card\">\n      <div className=\"path-constraint-header\">\n        <span className=\"path-constraint-label\">{constraintLabel}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      {renderConstraintFields()}\n    </div>\n  );\n}", "parameters": [{"name": "{ constraint, onChange, onRemove, schema, availableRefs }", "type": "{ constraint: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/PathStepEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/PathStepEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.step - The path step configuration\n * @param {Function} props.onChange - Callback when step changes\n * @param {Function} props.onRemove - Callback to remove this step\n * @param {Object} props.schema - Domain schema\n * @param {number} props.stepIndex - Index of this step in the path\n */\nexport function PathStepEditor({ step, onChange, onRemove, schema, stepIndex }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKindOptions = [\n    { value: \"any\", label: \"Any kind\" },\n    ...(schema?.entityKinds || []).map((ek) => ({\n      value: ek.kind,\n      label: ek.description || ek.kind,\n    })),\n  ];\n\n  const getSubtypeOptions = (kind) => {\n    if (!kind || kind === \"any\") return [{ value: \"any\", label: \"Any subtype\" }];\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [{ value: \"any\", label: \"Any subtype\" }];\n    return [\n      { value: \"any\", label: \"Any subtype\" },\n      ...ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id })),\n    ];\n  };\n\n  const updateStep = (field, value) => {\n    onChange({ ...step, [field]: value });\n  };\n\n  return (\n    <div className=\"path-step-card\">\n      <div className=\"path-step-header\">\n        <span className=\"path-step-label\">Step {stepIndex + 1}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      <div className=\"path-step-grid\">\n        <div>\n          <label className=\"label label-micro\">Via Relationship\n          <ReferenceDropdown\n            value={step.via || \"\"}\n            onChange={(v) => updateStep(\"via\", v)}\n            options={relationshipKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Direction\n          <ReferenceDropdown\n            value={step.direction || \"any\"}\n            onChange={(v) => updateStep(\"direction\", v)}\n            options={PATH_DIRECTIONS}\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Kind\n          <ReferenceDropdown\n            value={step.targetKind}\n            onChange={(v) => updateStep(\"targetKind\", v)}\n            options={entityKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Subtype\n          <ReferenceDropdown\n            value={step.targetSubtype}\n            onChange={(v) => updateStep(\"targetSubtype\", v)}\n            options={getSubtypeOptions(step.targetKind)}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div className=\"path-step-full-width\">\n          <label htmlFor=\"store-as-variable-optional\" className=\"label label-micro\">Store As Variable (optional)</label>\n          <input id=\"store-as-variable-optional\"\n            type=\"text\"\n            value={step.as || \"\"}\n            onChange={(e) => updateStep(\"as\", e.target.value)}\n            className=\"input input-micro\"\n            placeholder=\"e.g. $allies\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ step, onChange, onRemove, schema, stepIndex }", "type": "{ step: any; onChange: Function; onRemove: Function; schema: any; stepIndex: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFilterCard.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFilterCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.filter - The filter configuration\n * @param {Function} props.onChange - Callback when filter changes\n * @param {Function} props.onRemove - Callback to remove this filter\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFilterCard({ filter, onChange, onRemove, schema, availableRefs }) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = FILTER_TYPES[filter.type] || {\n    label: filter.type,\n    icon: \"\u2753\",\n    color: \"#6b7280\",\n  };\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateFilter = (field, value) => {\n    onChange({ ...filter, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (filter.type) {\n      case \"has_tag\": {\n        const valueSuffix = filter.value !== undefined ? ` = ${filter.value}` : \"\";\n        return `${filter.tag || \"?\"}${valueSuffix}`;\n      }\n      case \"has_tags\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"lacks_tag\":\n        return filter.tag || \"tag?\";\n      case \"lacks_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_culture\":\n        return filter.culture || \"culture?\";\n      case \"matches_culture\":\n        return `with ${filter.with || \"?\"}`;\n      case \"has_status\":\n        return filter.status || \"status?\";\n      case \"has_prominence\":\n        return filter.minProminence || \"prominence?\";\n      case \"has_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        const direction = filter.direction ? ` [${filter.direction}]` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}${direction}`;\n      }\n      case \"lacks_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}`;\n      }\n      case \"exclude\":\n        return `${(filter.entities || []).length} excluded`;\n      case \"shares_related\":\n        return `${filter.relationshipKind || \"?\"} with ${filter.with || \"?\"}`;\n      case \"graph_path\":\n        return `graph path (${filter.assert?.check || \"exists\"})`;\n      default:\n        return \"\";\n    }\n  };\n\n  const summary = getSummary();\n\n  const renderFilterFields = () => {\n    switch (filter.type) {\n      case \"has_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"has_tags\":\n      case \"has_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">\n              {filter.type === \"has_tags\" ? \"Tags (must have ALL)\" : \"Tags (must have at least ONE)\"}\n            </label>\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n          </div>\n        );\n\n      case \"lacks_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"lacks_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">Tags (exclude if has ANY)\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n        );\n\n\n      case \"has_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Culture\n            <ReferenceDropdown\n              value={filter.culture || \"\"}\n              onChange={(v) => updateFilter(\"culture\", v)}\n              options={(schema?.cultures || []).map((c) => ({\n                value: c.id,\n                label: c.name || c.id,\n              }))}\n              placeholder=\"Select culture...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"matches_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Same Culture As\n            <ReferenceDropdown\n              value={filter.with || \"\"}\n              onChange={(v) => updateFilter(\"with\", v)}\n              options={refOptions}\n              placeholder=\"Select variable...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_status\":\n        return (\n          <div>\n            <label htmlFor=\"status\" className=\"label label-small\">Status</label>\n            <input id=\"status\"\n              type=\"text\"\n              value={filter.status || \"\"}\n              onChange={(e) => updateFilter(\"status\", e.target.value)}\n              className=\"input input-compact\"\n              placeholder=\"e.g., active, historical\"\n            />\n          </div>\n        );\n\n      case \"has_prominence\":\n        return (\n          <div>\n            <label className=\"label label-small\">Minimum Prominence\n            <ReferenceDropdown\n              value={filter.minProminence || \"\"}\n              onChange={(v) => updateFilter(\"minProminence\", v)}\n              options={PROMINENCE_LEVELS.map((p) => ({ value: p.value, label: p.label }))}\n              placeholder=\"Select prominence...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Relationship Kind\n              <ReferenceDropdown\n                value={filter.kind || \"\"}\n                onChange={(v) => updateFilter(\"kind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity (optional)\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v || undefined)}\n                options={refOptions}\n                placeholder=\"Any entity\"\n              />\n              </label>\n            </div>\n            {filter.type === \"has_relationship\" && (\n              <div className=\"sfc-flex-field-tiny\">\n                <label className=\"label label-small\">Direction\n                <ReferenceDropdown\n                  value={filter.direction || \"both\"}\n                  onChange={(v) => updateFilter(\"direction\", v)}\n                  options={[\n                    { value: \"both\", label: \"Both\" },\n                    { value: \"src\", label: \"Outgoing\" },\n                    { value: \"dst\", label: \"Incoming\" },\n                  ]}\n                />\n                </label>\n              </div>\n            )}\n          </div>\n        );\n\n      case \"exclude\":\n        return (\n          <ChipSelect\n            label=\"Entities to Exclude\"\n            value={filter.entities || []}\n            onChange={(v) => updateFilter(\"entities\", v)}\n            options={refOptions}\n            placeholder=\"+ Add variable...\"\n          />\n        );\n\n      case \"shares_related\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Via Relationship\n              <ReferenceDropdown\n                value={filter.relationshipKind || \"\"}\n                onChange={(v) => updateFilter(\"relationshipKind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v)}\n                options={refOptions}\n                placeholder=\"Select variable...\"\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      case \"graph_path\":\n// ... (truncated)", "parameters": [{"name": "{ filter, onChange, onRemove, schema, availableRefs }", "type": "{ filter: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFiltersEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFiltersEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.filters - Array of filter configurations\n * @param {Function} props.onChange - Callback when filters change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFiltersEditor({ filters, onChange, schema, availableRefs }) {\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const containerRef = useRef(null);\n\n  // Calculate dropdown position when opening (like TagSelector)\n  useLayoutEffect(() => {\n    if (showTypeMenu && containerRef.current) {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  const handleAddFilter = (type) => {\n    // Create with empty required fields - validation will flag them\n    const newFilter = { type };\n    // Tag filters\n    if (type === \"has_tag\") newFilter.tag = \"\";\n    if (type === \"has_tags\") newFilter.tags = [];\n    if (type === \"has_any_tag\") newFilter.tags = [];\n    if (type === \"lacks_tag\") newFilter.tag = \"\";\n    if (type === \"lacks_any_tag\") newFilter.tags = [];\n    // Attribute filters\n    if (type === \"has_culture\") newFilter.culture = \"\";\n    if (type === \"matches_culture\") newFilter.with = \"\";\n    if (type === \"has_status\") newFilter.status = \"\";\n    if (type === \"has_prominence\") newFilter.minProminence = \"\";\n    // Relationship filters\n    if (type === \"has_relationship\") newFilter.kind = \"\";\n    if (type === \"lacks_relationship\") newFilter.kind = \"\";\n    if (type === \"shares_related\") {\n      newFilter.relationshipKind = \"\";\n      newFilter.with = \"\";\n    }\n    // Other\n    if (type === \"exclude\") newFilter.entities = [];\n    if (type === \"graph_path\")\n      newFilter.assert = {\n        check: \"\",\n        path: [{ via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" }],\n      };\n    onChange([...(filters || []), newFilter]);\n    setShowTypeMenu(false);\n  };\n\n  const handleUpdateFilter = (index, updated) => {\n    const newFilters = [...(filters || [])];\n    newFilters[index] = updated;\n    onChange(newFilters);\n  };\n\n  const handleRemoveFilter = (index) => {\n    onChange((filters || []).filter((_, i) => i !== index));\n  };\n\n  return (\n    <div>\n      {(filters || []).length === 0 ? (\n        <div className=\"empty-state-compact\">\n          No filters defined. Filters narrow down which entities can be selected as targets.\n        </div>\n      ) : (\n        <div className=\"condition-list\">\n          {(filters || []).map((filter, index) => (\n            <SelectionFilterCard\n              key={index}\n              filter={filter}\n              onChange={(updated) => handleUpdateFilter(index, updated)}\n              onRemove={() => handleRemoveFilter(index)}\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))}\n        </div>\n      )}\n\n      <div ref={containerRef} className=\"relative mt-lg\">\n        <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n          + Add Filter\n        </button>\n\n        {showTypeMenu && (\n          <div\n            className=\"dropdown-menu sfe-dropdown-fixed\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n            style={{ '--sfe-dd-top': `${dropdownPos.top}px`, '--sfe-dd-left': `${dropdownPos.left}px`, '--sfe-dd-width': `${dropdownPos.width}px`, top: 'var(--sfe-dd-top)', left: 'var(--sfe-dd-left)', width: 'var(--sfe-dd-width)' }}\n          >\n            {Object.entries(FILTER_TYPES).map(([type, config]) => (\n              <div key={type} onClick={() => handleAddFilter(type)} className=\"dropdown-menu-item\" role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n                <span\n                  className=\"dropdown-menu-icon\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per filter type\n                  style={{ '--sfe-icon-bg': `${config.color}20`, backgroundColor: 'var(--sfe-icon-bg)' }}\n                >\n                  {config.icon}\n                </span>\n                <span className=\"dropdown-menu-label\">{config.label}</span>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ filters, onChange, schema, availableRefs }", "type": "{ filters: any[]; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx", "sourceCode": "// ============================================================================\n// CreationTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.tagRegistry - Available tags\n * @param {Function} props.onAddToRegistry - Callback to add new tag to registry\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function CreationTab({\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}) {\n  const creation = generator.creation || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    creation.forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, creation]);\n\n  const culturesById = useMemo(() => {\n    const map = {};\n    (schema?.cultures || []).forEach((culture) => {\n      map[culture.id] = culture;\n    });\n    return map;\n  }, [schema?.cultures]);\n\n  const cultureIds = useMemo(() => Object.keys(culturesById), [culturesById]);\n\n  const handleAdd = () => {\n    const nextNum = creation.length + 1;\n    onChange({\n      ...generator,\n      creation: [\n        ...creation,\n        { entityRef: `$entity${nextNum}`, kind: \"npc\", prominence: \"marginal\" },\n      ],\n    });\n  };\n\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Entity Creation</div>\n        <div className=\"section-desc\">\n          Define entities that this generator creates. Each entity gets a reference (like{\" \"}\n          <code className=\"inline-code\">$hero</code>) that can be used in relationships.\n        </div>\n\n        {creation.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2728</div>\n            <div className=\"empty-state-title\">No entities created</div>\n            <div className=\"empty-state-desc\">\n              This generator only modifies existing entities. Add creation rules to spawn new\n              entities.\n            </div>\n          </div>\n        ) : (\n          creation.map((item, index) => (\n            <CreationCard\n              key={index}\n              item={item}\n              onChange={(updated) => {\n                const newCreation = [...creation];\n                newCreation[index] = updated;\n                onChange({ ...generator, creation: newCreation });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, creation: creation.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n              culturesById={culturesById}\n              cultureIds={cultureIds}\n              generator={generator}\n              tagRegistry={tagRegistry}\n              onAddToRegistry={onAddToRegistry}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Entity Creation\n        </button>\n      </div>\n\n      <VariantsSection\n        generator={generator}\n        onChange={onChange}\n        pressures={pressures}\n        schema={schema}\n        tagRegistry={tagRegistry}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}", "type": "{ generator: any; onChange: Function; schema: any; tagRegistry: any[]; onAddToRegistry: Function; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/EffectsTab.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/EffectsTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Object} props.schema - Domain schema\n */\nexport function EffectsTab({ generator, onChange, pressures, schema }) {\n  const stateUpdates = generator.stateUpdates || [];\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const addButtonRef = useRef(null);\n\n  // Build available entity references from target + variables + created entities\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, generator.creation]);\n\n  const createMutation = (type) => {\n    let newUpdate;\n    switch (type) {\n      case \"modify_pressure\":\n        newUpdate = { type: \"modify_pressure\", pressureId: pressures?.[0]?.id || \"\", delta: 0 };\n        break;\n      case \"archive_relationship\":\n        newUpdate = {\n          type: \"archive_relationship\",\n          entity: \"$target\",\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n        break;\n      case \"change_status\":\n        newUpdate = { type: \"change_status\", entity: \"$target\", newStatus: \"\" };\n        break;\n      case \"set_tag\":\n        newUpdate = { type: \"set_tag\", entity: \"$target\", tag: \"\", value: true };\n        break;\n      case \"remove_tag\":\n        newUpdate = { type: \"remove_tag\", entity: \"$target\", tag: \"\" };\n        break;\n      case \"update_rate_limit\":\n        newUpdate = { type: \"update_rate_limit\" };\n        break;\n      default:\n        return null;\n    }\n    return newUpdate;\n  };\n\n  const addMutation = (type) => {\n    const next = createMutation(type);\n    if (!next) return;\n    onChange({ ...generator, stateUpdates: [...stateUpdates, next] });\n  };\n\n  const updateMutation = (index, updated) => {\n    const newUpdates = [...stateUpdates];\n    newUpdates[index] = updated;\n    onChange({ ...generator, stateUpdates: newUpdates });\n  };\n\n  const removeMutation = (index) => {\n    onChange({ ...generator, stateUpdates: stateUpdates.filter((_, i) => i !== index) });\n  };\n\n  const knownTypes = new Set(DEFAULT_MUTATION_TYPES.map((type) => type.value));\n  const unrecognizedUpdates = stateUpdates\n    .map((update, index) => (knownTypes.has(update.type) ? null : { update, index }))\n    .filter(Boolean);\n\n  useLayoutEffect(() => {\n    if (showTypeMenu && addButtonRef.current) {\n      const rect = addButtonRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (event) => {\n      if (addButtonRef.current && !addButtonRef.current.contains(event.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  return (\n    <div>\n      {/* Unrecognized Effects - shown first to draw attention */}\n      {unrecognizedUpdates.length > 0 && (\n        <div className=\"section et-unrecognized-section\">\n          <div className=\"section-title et-unrecognized-title\">\n            <span>\u26a0\ufe0f</span> Unrecognized Effects\n          </div>\n          <div className=\"section-desc mb-lg\">\n            These state updates have unrecognized types and may be from an older version. Remove\n            them to clear validation errors.\n          </div>\n\n          {unrecognizedUpdates.map((entry) => {\n            const globalIdx = entry.index;\n            const update = entry.update;\n            return (\n              <div\n                key={globalIdx}\n                className=\"item-card et-unrecognized-card\"\n              >\n                <div className=\"et-unrecognized-body\">\n                  <div className=\"et-unrecognized-layout\">\n                    <div className=\"flex-1\">\n                      <div className=\"et-unrecognized-type\">\n                        Unknown type: &quot;{update.type || \"(no type)\"}&quot;\n                      </div>\n                      <pre className=\"et-unrecognized-json\">\n                        {JSON.stringify(update, null, 2)}\n                      </pre>\n                    </div>\n                    <button\n                      className=\"btn btn-danger flex-shrink-0\"\n                      onClick={() => removeMutation(globalIdx)}\n                    >\n                      Remove\n                    </button>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u26a1 Effects ({stateUpdates.length})</div>\n        <div className=\"section-desc\">\n          Apply state updates when this generator runs. Effects use the unified mutation library.\n        </div>\n\n        {stateUpdates.map((update, index) => {\n          if (!knownTypes.has(update.type)) return null;\n          return (\n            <MutationCard\n              key={index}\n              mutation={update}\n              onChange={(updated) => updateMutation(index, updated)}\n              onRemove={() => removeMutation(index)}\n              schema={schema}\n              pressures={pressures}\n              entityOptions={availableRefs}\n              typeOptions={DEFAULT_MUTATION_TYPES}\n              createMutation={createMutation}\n            />\n          );\n        })}\n\n        <div ref={addButtonRef} className=\"relative mt-lg\">\n          <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n            + Add Effect\n          </button>\n\n          {showTypeMenu && (\n            <div\n              className=\"dropdown-menu et-dropdown-fixed\"\n              // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n              style={{ '--et-dd-top': `${dropdownPos.top}px`, '--et-dd-left': `${dropdownPos.left}px`, '--et-dd-width': `${dropdownPos.width}px`, top: 'var(--et-dd-top)', left: 'var(--et-dd-left)', width: 'var(--et-dd-width)' }}\n            >\n              {MUTATION_TYPE_OPTIONS.map((opt) => (\n                <div\n                  key={opt.value}\n                  onClick={() => {\n                    addMutation(opt.value);\n                    setShowTypeMenu(false);\n                  }}\n                  className=\"dropdown-menu-item\"\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <span\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per mutation type\n                    style={{ '--et-icon-bg': `${opt.color}20`, backgroundColor: 'var(--et-icon-bg)' }}\n                  >\n                    {opt.icon}\n                  </span>\n                  <span className=\"dropdown-menu-label\">{opt.label}</span>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, pressures, schema }", "type": "{ generator: any; onChange: Function; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Function} props.onDelete - Callback to delete the generator\n * @param {Function} props.onDuplicate - Callback to duplicate the generator\n */\nexport function OverviewTab({ generator, onChange, onDelete, onDuplicate }) {\n  const updateField = (field, value) => {\n    onChange({ ...generator, [field]: value });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(generator.id, (value) =>\n    updateField(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(generator.name, (value) =>\n    updateField(\"name\", value)\n  );\n\n  const summary = useMemo(() => {\n    return {\n      rules: generator.applicability?.length || 0,\n      variables: Object.keys(generator.variables || {}).length,\n      creates: generator.creation?.length || 0,\n      relationships: generator.relationships?.length || 0,\n      effects: generator.stateUpdates?.length || 0,\n    };\n  }, [generator]);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"generator-id\" className=\"label\">Generator ID</label>\n            <input id=\"generator-id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"display-name\" className=\"label\">Display Name</label>\n            <input id=\"display-name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n              placeholder=\"Optional friendly name\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Enabled\n          <EnableToggle\n            enabled={generator.enabled !== false}\n            onChange={(enabled) => updateField(\"enabled\", enabled)}\n            label={generator.enabled !== false ? \"Generator is active\" : \"Generator is disabled\"}\n          />\n          </label>\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">Narration Template</span>\n          <div className=\"section-desc mb-md\">\n            Syntax: {\"{$target.field}\"}, {\"{$var.field}\"}, {\"{count:kind}\"}, {\"{list:created}\"},{\" \"}\n            {\"{field|fallback}\"}.\n          </div>\n          <LocalTextArea\n            value={generator.narrationTemplate || \"\"}\n            onChange={(value) => updateField(\"narrationTemplate\", value || undefined)}\n            placeholder=\"e.g., From {$target.name}, {count:npc} new souls emerged to shape the realm.\"\n            rows={2}\n          />\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Summary</div>\n        <div className=\"summary-stats-grid\">\n          {[\n            { label: \"Rules\", value: summary.rules, icon: \"\u2713\" },\n            { label: \"Variables\", value: summary.variables, icon: \"\ud83d\udce6\" },\n            { label: \"Creates\", value: summary.creates, icon: \"\u2728\" },\n            { label: \"Connects\", value: summary.relationships, icon: \"\ud83d\udd17\" },\n            { label: \"Effects\", value: summary.effects, icon: \"\u26a1\" },\n          ].map((stat) => (\n            <div key={stat.label} className=\"summary-stat\">\n              <div className=\"summary-stat-icon\">{stat.icon}</div>\n              <div className=\"summary-stat-value\">{stat.value}</div>\n              <div className=\"summary-stat-label\">{stat.label}</div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"danger-zone\">\n        <button className=\"btn btn-secondary\" onClick={onDuplicate}>\n          Duplicate Generator\n        </button>\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete Generator\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, onDelete, onDuplicate }", "type": "{ generator: any; onChange: Function; onDelete: Function; onDuplicate: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/RelationshipsTab.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/RelationshipsTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n */\nexport function RelationshipsTab({ generator, onChange, schema }) {\n  const relationships = generator.relationships || [];\n  const saturationLimits = generator.selection?.saturationLimits || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, generator.creation]);\n\n  // Find the first created entity ref for implied relationships\n  const firstCreatedRef = useMemo(() => {\n    const creation = generator.creation || [];\n    return creation.length > 0 ? creation[0].entityRef : \"$created\";\n  }, [generator.creation]);\n\n  const handleAdd = () => {\n    onChange({\n      ...generator,\n      relationships: [\n        ...relationships,\n        {\n          kind: schema?.relationshipKinds?.[0]?.kind || \"ally_of\",\n          src: availableRefs[1] || \"$entity1\",\n          dst: \"$target\",\n          strength: 0.8,\n        },\n      ],\n    });\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Relationships</div>\n        <div className=\"section-desc\">\n          Define relationships created between entities. Use entity references like{\" \"}\n          <code className=\"inline-code\">$target</code>, created entities like{\" \"}\n          <code className=\"inline-code\">$hero</code>, or variables like{\" \"}\n          <code className=\"inline-code\">$faction</code>.\n        </div>\n\n        {/* Implied relationships from saturation limits */}\n        {saturationLimits.length > 0 && (\n          <div className=\"mb-xl\">\n            {saturationLimits.map((limit, index) => (\n              <ImpliedRelationshipCard\n                key={`implied-${index}`}\n                saturationLimit={limit}\n                schema={schema}\n                createdEntityRef={firstCreatedRef}\n              />\n            ))}\n          </div>\n        )}\n\n        {relationships.length === 0 && saturationLimits.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udd17</div>\n            <div className=\"empty-state-title\">No relationships</div>\n            <div className=\"empty-state-desc\">\n              This generator doesn&apos;t create any relationships. Add relationships to connect\n              entities.\n            </div>\n          </div>\n        ) : (\n          relationships.map((rel, index) => (\n            <RelationshipCard\n              key={index}\n              rel={rel}\n              onChange={(updated) => {\n                const newRels = [...relationships];\n                newRels[index] = updated;\n                onChange({ ...generator, relationships: newRels });\n              }}\n              onRemove={() =>\n                onChange({\n                  ...generator,\n                  relationships: relationships.filter((_, i) => i !== index),\n                })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Relationship\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/TargetTab.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/TargetTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema with entity/relationship kinds\n */\nexport function TargetTab({ generator, onChange, schema }) {\n  const selection = generator.selection || { strategy: \"by_kind\" };\n\n  // Get the kind of the first created entity for saturation limit inference\n  const firstCreatedKind = (generator.creation || [])[0]?.kind;\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Target Selection</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What is $target?</div>\n          <div className=\"info-box-text\">\n            The <code className=\"inline-code\">$target</code> is the primary entity this generator\n            operates on. It&apos;s selected from the world graph based on the rules you define here. Once\n            selected, you can reference it in creation rules (e.g., inherit culture from $target)\n            and relationships (e.g., connect new entity to $target).\n          </div>\n        </div>\n\n        <SelectionRuleEditor\n          value={selection}\n          onChange={(updated) => onChange({ ...generator, selection: updated })}\n          schema={schema}\n          availableRefs={[\"$target\", ...Object.keys(generator.variables || {})]}\n        />\n\n        {/* Saturation Limits */}\n        <div className=\"mt-2xl\">\n          <span className=\"label\">Saturation Limits</span>\n          <div className=\"info-box-text mb-lg text-sm\">\n            Limit targets based on existing relationship counts. Only targets with fewer than the\n            max count of relationships will be selected.\n          </div>\n          <SaturationLimitsEditor\n            limits={selection.saturationLimits || []}\n            onChange={(limits) =>\n              onChange({\n                ...generator,\n                selection: {\n                  ...selection,\n                  saturationLimits: limits.length > 0 ? limits : undefined,\n                },\n              })\n            }\n            schema={schema}\n            createdKind={firstCreatedKind}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/VariablesTab.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/VariablesTab.jsx", "sourceCode": "// ============================================================================\n// VariablesTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n */\nexport function VariablesTab({ generator, onChange, schema }) {\n  const variables = generator.variables || {};\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  // Build available refs for relationship queries (target + other vars + creation refs)\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$target\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    // Ensure the name starts with $\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    // Create with empty required fields - validation will flag them\n    onChange({\n      ...generator,\n      variables: {\n        ...variables,\n        [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"\" } },\n      },\n    });\n    setNewVarName(\"\");\n    setShowAddForm(false);\n  };\n\n  const varEntries = Object.entries(variables);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Variables</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What are variables?</div>\n          <div className=\"info-box-text\">\n            Variables let you select additional entities from the graph to use in creation and\n            relationships. For example, you might select a{\" \"}\n            <code className=\"inline-code\">$faction</code> to make a new NPC a member of, or an{\" \"}\n            <code className=\"inline-code\">$ability</code> for them to practice. Variables are\n            selected after <code className=\"inline-code\">$target</code> is chosen.\n          </div>\n        </div>\n\n        {varEntries.length === 0 && !showAddForm ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udce6</div>\n            <div className=\"empty-state-title\">No variables defined</div>\n            <div className=\"empty-state-desc\">\n              Add variables to select additional entities for use in creation and relationships.\n            </div>\n          </div>\n        ) : (\n          varEntries.map(([name, config]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={config}\n              onChange={(updated) =>\n                onChange({ ...generator, variables: { ...variables, [name]: updated } })\n              }\n              onRemove={() => {\n                const newVars = { ...variables };\n                delete newVars[name];\n                onChange({ ...generator, variables: newVars });\n              }}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/naming-profile-viewer/utils/analyzeNamingMappings.js::analyzeNamingMappings", "name": "analyzeNamingMappings", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/naming-profile-viewer/utils/analyzeNamingMappings.js", "sourceCode": "export function analyzeNamingMappings(generators, schema) {\n  const mappings = [];\n  const warnings = [];\n\n  // Build culture lookup\n  const culturesById = {};\n  (schema.cultures || []).forEach((c) => {\n    culturesById[c.id] = c;\n  });\n\n  for (const gen of generators) {\n    if (gen.enabled === false) continue;\n    if (!gen.creation || gen.creation.length === 0) continue;\n\n    for (const creation of gen.creation) {\n      const entityKind = creation.kind;\n      // Subtype can be a string or object - ensure we get a string\n      const subtype = typeof creation.subtype === \"string\" ? creation.subtype : null;\n      const prominence = creation.prominence;\n      const tags = creation.tags ? Object.keys(creation.tags) : [];\n\n      // Determine culture source\n      let cultureSource = null;\n      let cultureIds = [];\n\n      if (creation.culture) {\n        if (typeof creation.culture === \"string\") {\n          cultureIds = [creation.culture];\n          cultureSource = \"explicit\";\n        } else if (creation.culture.inherit) {\n          cultureSource = \"inherited\";\n          // Culture is inherited from target - could be any culture\n          cultureIds = Object.keys(culturesById);\n        } else if (creation.culture.from) {\n          cultureSource = \"reference\";\n          cultureIds = Object.keys(culturesById);\n        }\n      } else {\n        // No culture specified - could be any\n        cultureSource = \"any\";\n        cultureIds = Object.keys(culturesById);\n      }\n\n      // Check each possible culture for naming profile match\n      for (const cultureId of cultureIds) {\n        const culture = culturesById[cultureId];\n        const namingConfig = culture?.naming;\n        const hasProfiles = !!namingConfig?.profiles?.length;\n        const match = hasProfiles\n          ? findMatchingProfile(namingConfig, entityKind, subtype, prominence, tags)\n          : null;\n\n        mappings.push({\n          generatorId: gen.id,\n          generatorName: gen.name || gen.id,\n          entityKind,\n          subtype,\n          prominence,\n          cultureId,\n          cultureName: culture?.name || cultureId,\n          cultureColor: culture?.color || \"#888\",\n          cultureSource,\n          hasNamingProfile: hasProfiles,\n          match,\n        });\n\n        // Add warning if no match found\n        if (!match && hasProfiles) {\n          warnings.push({\n            generatorId: gen.id,\n            generatorName: gen.name || gen.id,\n            entityKind,\n            subtype,\n            cultureId,\n            cultureName: culture?.name || cultureId,\n            cultureSource,\n            reason: \"No matching strategy group\",\n          });\n        } else if (!hasProfiles) {\n          warnings.push({\n            generatorId: gen.id,\n            generatorName: gen.name || gen.id,\n            entityKind,\n            subtype,\n            cultureId,\n            cultureName: culture?.name || cultureId,\n            cultureSource,\n            reason: \"Culture has no naming profiles\",\n          });\n        }\n      }\n    }\n  }\n\n  return { mappings, warnings };\n}", "parameters": [{"name": "generators", "type": "any", "optional": false}, {"name": "schema", "type": "any", "optional": false}], "returnType": "{ mappings: { generatorId: any; generatorName: any; entityKind: any; subtype: any; prominence: any; cultureId: any; cultureName: any; cultureColor: any; cultureSource: string; hasNamingProfile: boolean; match: { profileId: any; profileName: any; groupName: any; strategy: any; grammarId: any; }; }[]; warnings: { generatorId: any; generatorName: any; entityKind: any; subtype: any; cultureId: any; cultureName: any; cultureSource: string; reason: string; }[]; }"}, {"id": "apps/coherence-engine/webui/src/components/naming-profile-viewer/utils/findMatchingProfile.js::findMatchingProfile", "name": "findMatchingProfile", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/naming-profile-viewer/utils/findMatchingProfile.js", "sourceCode": "/**\n * Find which naming profile strategy group matches a given entity creation\n */\n\nexport function findMatchingProfile(namingConfig, entityKind, subtype, prominence, tags = []) {\n  if (!namingConfig?.profiles) return null;\n\n  for (const profile of namingConfig.profiles) {\n    for (const group of profile.strategyGroups || []) {\n      const cond = group.conditions || {};\n\n      // Check entity kind\n      if (cond.entityKinds?.length > 0 && !cond.entityKinds.includes(entityKind)) {\n        continue;\n      }\n\n      // Check subtype\n      if (cond.subtypes?.length > 0) {\n        // Check if subtype matches (same logic for matchAll or matchAny on single entity)\n        if (!subtype || !cond.subtypes.includes(subtype)) continue;\n      }\n\n      // Check prominence\n      if (cond.prominence?.length > 0 && !cond.prominence.includes(prominence)) {\n        continue;\n      }\n\n      // Check tags\n      if (cond.tags?.length > 0) {\n        const entityTags = Array.isArray(tags) ? tags : Object.keys(tags || {});\n        if (cond.tagMatchAll) {\n          // All tags must be present\n          if (!cond.tags.every((t) => entityTags.includes(t))) continue;\n        } else {\n          // Any tag matches\n          if (!cond.tags.some((t) => entityTags.includes(t))) continue;\n        }\n      }\n\n      // Found a match!\n      return {\n        profileId: profile.id,\n        profileName: profile.name,\n        groupName: group.name,\n        strategy: group.strategy,\n        grammarId: group.grammarId,\n      };\n    }\n  }\n\n  return null;\n}", "parameters": [{"name": "namingConfig", "type": "any", "optional": false}, {"name": "entityKind", "type": "any", "optional": false}, {"name": "subtype", "type": "any", "optional": false}, {"name": "prominence", "type": "any", "optional": false}, {"name": "tags", "type": "any[]", "optional": true}], "returnType": "{ profileId: any; profileName: any; groupName: any; strategy: any; grammarId: any; }"}, {"id": "apps/coherence-engine/webui/src/components/naming-profile-viewer/utils/index.js::findMatchingProfile", "name": "findMatchingProfile", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/naming-profile-viewer/utils/index.js", "sourceCode": "/**\n * Find which naming profile strategy group matches a given entity creation\n */\n\nexport function findMatchingProfile(namingConfig, entityKind, subtype, prominence, tags = []) {\n  if (!namingConfig?.profiles) return null;\n\n  for (const profile of namingConfig.profiles) {\n    for (const group of profile.strategyGroups || []) {\n      const cond = group.conditions || {};\n\n      // Check entity kind\n      if (cond.entityKinds?.length > 0 && !cond.entityKinds.includes(entityKind)) {\n        continue;\n      }\n\n      // Check subtype\n      if (cond.subtypes?.length > 0) {\n        // Check if subtype matches (same logic for matchAll or matchAny on single entity)\n        if (!subtype || !cond.subtypes.includes(subtype)) continue;\n      }\n\n      // Check prominence\n      if (cond.prominence?.length > 0 && !cond.prominence.includes(prominence)) {\n        continue;\n      }\n\n      // Check tags\n      if (cond.tags?.length > 0) {\n        const entityTags = Array.isArray(tags) ? tags : Object.keys(tags || {});\n        if (cond.tagMatchAll) {\n          // All tags must be present\n          if (!cond.tags.every((t) => entityTags.includes(t))) continue;\n        } else {\n          // Any tag matches\n          if (!cond.tags.some((t) => entityTags.includes(t))) continue;\n        }\n      }\n\n      // Found a match!\n      return {\n        profileId: profile.id,\n        profileName: profile.name,\n        groupName: group.name,\n        strategy: group.strategy,\n        grammarId: group.grammarId,\n      };\n    }\n  }\n\n  return null;\n}", "parameters": [{"name": "namingConfig", "type": "any", "optional": false}, {"name": "entityKind", "type": "any", "optional": false}, {"name": "subtype", "type": "any", "optional": false}, {"name": "prominence", "type": "any", "optional": false}, {"name": "tags", "type": "any[]", "optional": true}], "returnType": "{ profileId: any; profileName: any; groupName: any; strategy: any; grammarId: any; }"}, {"id": "apps/coherence-engine/webui/src/components/naming-profile-viewer/utils/index.js::analyzeNamingMappings", "name": "analyzeNamingMappings", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/naming-profile-viewer/utils/index.js", "sourceCode": "export function analyzeNamingMappings(generators, schema) {\n  const mappings = [];\n  const warnings = [];\n\n  // Build culture lookup\n  const culturesById = {};\n  (schema.cultures || []).forEach((c) => {\n    culturesById[c.id] = c;\n  });\n\n  for (const gen of generators) {\n    if (gen.enabled === false) continue;\n    if (!gen.creation || gen.creation.length === 0) continue;\n\n    for (const creation of gen.creation) {\n      const entityKind = creation.kind;\n      // Subtype can be a string or object - ensure we get a string\n      const subtype = typeof creation.subtype === \"string\" ? creation.subtype : null;\n      const prominence = creation.prominence;\n      const tags = creation.tags ? Object.keys(creation.tags) : [];\n\n      // Determine culture source\n      let cultureSource = null;\n      let cultureIds = [];\n\n      if (creation.culture) {\n        if (typeof creation.culture === \"string\") {\n          cultureIds = [creation.culture];\n          cultureSource = \"explicit\";\n        } else if (creation.culture.inherit) {\n          cultureSource = \"inherited\";\n          // Culture is inherited from target - could be any culture\n          cultureIds = Object.keys(culturesById);\n        } else if (creation.culture.from) {\n          cultureSource = \"reference\";\n          cultureIds = Object.keys(culturesById);\n        }\n      } else {\n        // No culture specified - could be any\n        cultureSource = \"any\";\n        cultureIds = Object.keys(culturesById);\n      }\n\n      // Check each possible culture for naming profile match\n      for (const cultureId of cultureIds) {\n        const culture = culturesById[cultureId];\n        const namingConfig = culture?.naming;\n        const hasProfiles = !!namingConfig?.profiles?.length;\n        const match = hasProfiles\n          ? findMatchingProfile(namingConfig, entityKind, subtype, prominence, tags)\n          : null;\n\n        mappings.push({\n          generatorId: gen.id,\n          generatorName: gen.name || gen.id,\n          entityKind,\n          subtype,\n          prominence,\n          cultureId,\n          cultureName: culture?.name || cultureId,\n          cultureColor: culture?.color || \"#888\",\n          cultureSource,\n          hasNamingProfile: hasProfiles,\n          match,\n        });\n\n        // Add warning if no match found\n        if (!match && hasProfiles) {\n          warnings.push({\n            generatorId: gen.id,\n            generatorName: gen.name || gen.id,\n            entityKind,\n            subtype,\n            cultureId,\n            cultureName: culture?.name || cultureId,\n            cultureSource,\n            reason: \"No matching strategy group\",\n          });\n        } else if (!hasProfiles) {\n          warnings.push({\n            generatorId: gen.id,\n            generatorName: gen.name || gen.id,\n            entityKind,\n            subtype,\n            cultureId,\n            cultureName: culture?.name || cultureId,\n            cultureSource,\n            reason: \"Culture has no naming profiles\",\n          });\n        }\n      }\n    }\n  }\n\n  return { mappings, warnings };\n}", "parameters": [{"name": "generators", "type": "any", "optional": false}, {"name": "schema", "type": "any", "optional": false}], "returnType": "{ mappings: { generatorId: any; generatorName: any; entityKind: any; subtype: any; prominence: any; cultureId: any; cultureName: any; cultureColor: any; cultureSource: string; hasNamingProfile: boolean; match: { profileId: any; profileName: any; groupName: any; strategy: any; grammarId: any; }; }[]; warnings: { generatorId: any; generatorName: any; entityKind: any; subtype: any; cultureId: any; cultureName: any; cultureSource: string; reason: string; }[]; }"}, {"id": "apps/coherence-engine/webui/src/components/validation/utils/exportFunctions.js::formatValidationForExport", "name": "formatValidationForExport", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/validation/utils/exportFunctions.js", "sourceCode": "/**\n * Export functions for validation results\n */\n\nexport function formatValidationForExport(validationResults) {\n  const items = [];\n\n  // Process errors\n  for (const error of validationResults.errors) {\n    for (const item of error.affectedItems) {\n      items.push({\n        severity: \"ERROR\",\n        category: error.id,\n        title: error.title,\n        message: error.message,\n        itemId: item.id,\n        itemLabel: item.label,\n        detail: item.detail || \"\",\n      });\n    }\n  }\n\n  // Process warnings\n  for (const warning of validationResults.warnings) {\n    for (const item of warning.affectedItems) {\n      items.push({\n        severity: \"WARNING\",\n        category: warning.id,\n        title: warning.title,\n        message: warning.message,\n        itemId: item.id,\n        itemLabel: item.label,\n        detail: item.detail || \"\",\n      });\n    }\n  }\n\n  return items;\n}", "parameters": [{"name": "validationResults", "type": "any", "optional": false}], "returnType": "{ severity: string; category: any; title: any; message: any; itemId: any; itemLabel: any; detail: any; }[]"}, {"id": "apps/coherence-engine/webui/src/components/validation/utils/exportFunctions.js::exportAsJson", "name": "exportAsJson", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/validation/utils/exportFunctions.js", "sourceCode": "export function exportAsJson(validationResults) {\n  const items = formatValidationForExport(validationResults);\n  const json = JSON.stringify(\n    {\n      exportedAt: new Date().toISOString(),\n      summary: {\n        errorCount: validationResults.errors.length,\n        warningCount: validationResults.warnings.length,\n        totalItems: items.length,\n      },\n      issues: items,\n    },\n    null,\n    2\n  );\n\n  const blob = new Blob([json], { type: \"application/json\" });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement(\"a\");\n  a.href = url;\n  a.download = `validation-report-${new Date().toISOString().split(\"T\")[0]}.json`;\n  a.click();\n  URL.revokeObjectURL(url);\n}", "parameters": [{"name": "validationResults", "type": "any", "optional": false}], "returnType": "void"}, {"id": "apps/coherence-engine/webui/src/components/validation/utils/exportFunctions.js::exportAsCsv", "name": "exportAsCsv", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/validation/utils/exportFunctions.js", "sourceCode": "export function exportAsCsv(validationResults) {\n  const items = formatValidationForExport(validationResults);\n\n  // CSV header\n  const headers = [\"Severity\", \"Category\", \"Title\", \"Message\", \"Item ID\", \"Item Label\", \"Detail\"];\n\n  // Escape CSV field\n  const escapeField = (field) => {\n    const str = String(field || \"\");\n    if (str.includes(\",\") || str.includes('\"') || str.includes(\"\\n\")) {\n      return `\"${str.replace(/\"/g, '\"\"')}\"`;\n    }\n    return str;\n  };\n\n  // Build CSV rows\n  const rows = [\n    headers.join(\",\"),\n    ...items.map((item) =>\n      [\n        item.severity,\n        item.category,\n        escapeField(item.title),\n        escapeField(item.message),\n        escapeField(item.itemId),\n        escapeField(item.itemLabel),\n        escapeField(item.detail),\n      ].join(\",\")\n    ),\n  ];\n\n  const csv = rows.join(\"\\n\");\n  const blob = new Blob([csv], { type: \"text/csv\" });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement(\"a\");\n  a.href = url;\n  a.download = `validation-report-${new Date().toISOString().split(\"T\")[0]}.csv`;\n  a.click();\n  URL.revokeObjectURL(url);\n}", "parameters": [{"name": "validationResults", "type": "any", "optional": false}], "returnType": "void"}, {"id": "apps/coherence-engine/webui/src/components/validation/utils/index.js::formatValidationForExport", "name": "formatValidationForExport", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/validation/utils/index.js", "sourceCode": "/**\n * Export functions for validation results\n */\n\nexport function formatValidationForExport(validationResults) {\n  const items = [];\n\n  // Process errors\n  for (const error of validationResults.errors) {\n    for (const item of error.affectedItems) {\n      items.push({\n        severity: \"ERROR\",\n        category: error.id,\n        title: error.title,\n        message: error.message,\n        itemId: item.id,\n        itemLabel: item.label,\n        detail: item.detail || \"\",\n      });\n    }\n  }\n\n  // Process warnings\n  for (const warning of validationResults.warnings) {\n    for (const item of warning.affectedItems) {\n      items.push({\n        severity: \"WARNING\",\n        category: warning.id,\n        title: warning.title,\n        message: warning.message,\n        itemId: item.id,\n        itemLabel: item.label,\n        detail: item.detail || \"\",\n      });\n    }\n  }\n\n  return items;\n}", "parameters": [{"name": "validationResults", "type": "any", "optional": false}], "returnType": "{ severity: string; category: any; title: any; message: any; itemId: any; itemLabel: any; detail: any; }[]"}, {"id": "apps/coherence-engine/webui/src/components/validation/utils/index.js::exportAsJson", "name": "exportAsJson", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/validation/utils/index.js", "sourceCode": "export function exportAsJson(validationResults) {\n  const items = formatValidationForExport(validationResults);\n  const json = JSON.stringify(\n    {\n      exportedAt: new Date().toISOString(),\n      summary: {\n        errorCount: validationResults.errors.length,\n        warningCount: validationResults.warnings.length,\n        totalItems: items.length,\n      },\n      issues: items,\n    },\n    null,\n    2\n  );\n\n  const blob = new Blob([json], { type: \"application/json\" });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement(\"a\");\n  a.href = url;\n  a.download = `validation-report-${new Date().toISOString().split(\"T\")[0]}.json`;\n  a.click();\n  URL.revokeObjectURL(url);\n}", "parameters": [{"name": "validationResults", "type": "any", "optional": false}], "returnType": "void"}, {"id": "apps/coherence-engine/webui/src/components/validation/utils/index.js::exportAsCsv", "name": "exportAsCsv", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/validation/utils/index.js", "sourceCode": "export function exportAsCsv(validationResults) {\n  const items = formatValidationForExport(validationResults);\n\n  // CSV header\n  const headers = [\"Severity\", \"Category\", \"Title\", \"Message\", \"Item ID\", \"Item Label\", \"Detail\"];\n\n  // Escape CSV field\n  const escapeField = (field) => {\n    const str = String(field || \"\");\n    if (str.includes(\",\") || str.includes('\"') || str.includes(\"\\n\")) {\n      return `\"${str.replace(/\"/g, '\"\"')}\"`;\n    }\n    return str;\n  };\n\n  // Build CSV rows\n  const rows = [\n    headers.join(\",\"),\n    ...items.map((item) =>\n      [\n        item.severity,\n        item.category,\n        escapeField(item.title),\n        escapeField(item.message),\n        escapeField(item.itemId),\n        escapeField(item.itemLabel),\n        escapeField(item.detail),\n      ].join(\",\")\n    ),\n  ];\n\n  const csv = rows.join(\"\\n\");\n  const blob = new Blob([csv], { type: \"text/csv\" });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement(\"a\");\n  a.href = url;\n  a.download = `validation-report-${new Date().toISOString().split(\"T\")[0]}.csv`;\n  a.click();\n  URL.revokeObjectURL(url);\n}", "parameters": [{"name": "validationResults", "type": "any", "optional": false}], "returnType": "void"}, {"id": "apps/coherence-engine/webui/src/components/validation/utils/index.js::runValidations", "name": "runValidations", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/validation/utils/index.js", "sourceCode": "/**\n * Run all validations\n * @param {Object} usageMap - Pre-computed usage map from computeUsageMap\n * @param {Object} schema - Domain schema\n * @param {Array} eras - Era configurations\n * @param {Array} pressures - Pressure configurations\n * @param {Array} generators - Generator configurations\n * @param {Array} systems - System configurations\n */\nexport function runValidations(usageMap, schema, eras, pressures, generators, systems) {\n  const results = {\n    errors: [],\n    warnings: [],\n  };\n\n  // Run each validation rule\n  // Rules that use usageMap only\n  const usageMapRules = [\n    () => validationRules.invalidEntityKind(usageMap),\n    () => validationRules.invalidRelationshipKind(usageMap),\n    () => validationRules.invalidPressureId(usageMap),\n    () => validationRules.invalidEraTemplateRef(usageMap),\n    () => validationRules.invalidEraSystemRef(usageMap),\n    () => validationRules.orphanGenerators(usageMap),\n    () => validationRules.orphanSystems(usageMap),\n    () => validationRules.relationshipCompatibility(usageMap),\n  ];\n\n  // Rules that need additional data\n  const dataRules = [\n    () => validationRules.pressureWithoutSources(usageMap, pressures, generators, systems),\n    () => validationRules.pressureWithoutSinks(usageMap, pressures, generators, systems),\n    () => validationRules.zeroWeightGenerators(usageMap, eras, generators),\n    () => validationRules.invalidSubtypeRef(usageMap, schema, generators, pressures),\n    () => validationRules.invalidStatusRef(usageMap, schema, generators),\n    () => validationRules.invalidCultureRef(usageMap, schema),\n    () => validationRules.undefinedTagRefs(usageMap, schema),\n    () => validationRules.conflictingTagsInUse(usageMap, schema, generators),\n    () => validationRules.numericRangeIssues(usageMap, pressures, eras),\n  ];\n\n  const allRules = [...usageMapRules, ...dataRules];\n\n  for (const rule of allRules) {\n    const result = rule();\n    if (result) {\n      if (result.severity === \"error\") {\n        results.errors.push(result);\n      } else {\n        results.warnings.push(result);\n      }\n    }\n  }\n\n  return results;\n}", "parameters": [{"name": "usageMap", "type": "any", "optional": false}, {"name": "schema", "type": "any", "optional": false}, {"name": "eras", "type": "any[]", "optional": false}, {"name": "pressures", "type": "any[]", "optional": false}, {"name": "generators", "type": "any[]", "optional": false}, {"name": "systems", "type": "any[]", "optional": false}], "returnType": "{ errors: any[]; warnings: any[]; }"}, {"id": "apps/coherence-engine/webui/src/components/validation/utils/index.js::getOverallStatus", "name": "getOverallStatus", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/validation/utils/index.js", "sourceCode": "export function getOverallStatus(results) {\n  if (results.errors.length > 0) return \"error\";\n  if (results.warnings.length > 0) return \"warning\";\n  return \"clean\";\n}", "parameters": [{"name": "results", "type": "any", "optional": false}], "returnType": "\"error\" | \"warning\" | \"clean\""}, {"id": "apps/coherence-engine/webui/src/components/validation/utils/validationRules.js::runValidations", "name": "runValidations", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/validation/utils/validationRules.js", "sourceCode": "/**\n * Run all validations\n * @param {Object} usageMap - Pre-computed usage map from computeUsageMap\n * @param {Object} schema - Domain schema\n * @param {Array} eras - Era configurations\n * @param {Array} pressures - Pressure configurations\n * @param {Array} generators - Generator configurations\n * @param {Array} systems - System configurations\n */\nexport function runValidations(usageMap, schema, eras, pressures, generators, systems) {\n  const results = {\n    errors: [],\n    warnings: [],\n  };\n\n  // Run each validation rule\n  // Rules that use usageMap only\n  const usageMapRules = [\n    () => validationRules.invalidEntityKind(usageMap),\n    () => validationRules.invalidRelationshipKind(usageMap),\n    () => validationRules.invalidPressureId(usageMap),\n    () => validationRules.invalidEraTemplateRef(usageMap),\n    () => validationRules.invalidEraSystemRef(usageMap),\n    () => validationRules.orphanGenerators(usageMap),\n    () => validationRules.orphanSystems(usageMap),\n    () => validationRules.relationshipCompatibility(usageMap),\n  ];\n\n  // Rules that need additional data\n  const dataRules = [\n    () => validationRules.pressureWithoutSources(usageMap, pressures, generators, systems),\n    () => validationRules.pressureWithoutSinks(usageMap, pressures, generators, systems),\n    () => validationRules.zeroWeightGenerators(usageMap, eras, generators),\n    () => validationRules.invalidSubtypeRef(usageMap, schema, generators, pressures),\n    () => validationRules.invalidStatusRef(usageMap, schema, generators),\n    () => validationRules.invalidCultureRef(usageMap, schema),\n    () => validationRules.undefinedTagRefs(usageMap, schema),\n    () => validationRules.conflictingTagsInUse(usageMap, schema, generators),\n    () => validationRules.numericRangeIssues(usageMap, pressures, eras),\n  ];\n\n  const allRules = [...usageMapRules, ...dataRules];\n\n  for (const rule of allRules) {\n    const result = rule();\n    if (result) {\n      if (result.severity === \"error\") {\n        results.errors.push(result);\n      } else {\n        results.warnings.push(result);\n      }\n    }\n  }\n\n  return results;\n}", "parameters": [{"name": "usageMap", "type": "any", "optional": false}, {"name": "schema", "type": "any", "optional": false}, {"name": "eras", "type": "any[]", "optional": false}, {"name": "pressures", "type": "any[]", "optional": false}, {"name": "generators", "type": "any[]", "optional": false}, {"name": "systems", "type": "any[]", "optional": false}], "returnType": "{ errors: any[]; warnings: any[]; }"}, {"id": "apps/coherence-engine/webui/src/components/validation/utils/validationRules.js::getOverallStatus", "name": "getOverallStatus", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/validation/utils/validationRules.js", "sourceCode": "export function getOverallStatus(results) {\n  if (results.errors.length > 0) return \"error\";\n  if (results.warnings.length > 0) return \"warning\";\n  return \"clean\";\n}", "parameters": [{"name": "results", "type": "any", "optional": false}], "returnType": "\"error\" | \"warning\" | \"clean\""}]