[{"id": "packages/world-store/src/index.ts::getSlotRecord", "name": "getSlotRecord", "kind": "function", "filePath": "packages/world-store/src/index.ts", "sourceCode": "export async function getSlotRecord(\n  projectId: string,\n  slotIndex: number,\n): Promise<SimulationSlotRecord | null> {\n  const db = await openDb();\n  const record = await getRecord<SimulationSlotRecord>(db, SLOTS_STORE, [projectId, slotIndex]);\n  db.close();\n  return record;\n}", "parameters": [{"name": "projectId", "type": "string", "optional": false}, {"name": "slotIndex", "type": "number", "optional": false}], "returnType": "Promise<SimulationSlotRecord | null>"}, {"id": "packages/world-store/src/index.ts::getWorldSchema", "name": "getWorldSchema", "kind": "function", "filePath": "packages/world-store/src/index.ts", "sourceCode": "export async function getWorldSchema(projectId: string): Promise<CanonrySchemaSlice | null> {\n  const db = await openDb();\n  const record = await getRecord<WorldSchemaRecord>(db, SCHEMAS_STORE, projectId);\n  db.close();\n  return record?.schema ?? null;\n}", "parameters": [{"name": "projectId", "type": "string", "optional": false}], "returnType": "Promise<CanonrySchemaSlice | null>"}, {"id": "packages/world-store/src/index.ts::getCoordinateState", "name": "getCoordinateState", "kind": "function", "filePath": "packages/world-store/src/index.ts", "sourceCode": "export async function getCoordinateState(simulationRunId: string): Promise<CoordinateState | null> {\n  const db = await openDb();\n  const record = await getRecord<CoordinateStateRecord>(db, COORDINATE_STORE, simulationRunId);\n  db.close();\n  return record?.coordinateState ?? null;\n}", "parameters": [{"name": "simulationRunId", "type": "string", "optional": false}], "returnType": "Promise<CoordinateState | null>"}, {"id": "packages/world-store/src/index.ts::getEntities", "name": "getEntities", "kind": "function", "filePath": "packages/world-store/src/index.ts", "sourceCode": "export async function getEntities(simulationRunId: string): Promise<WorldEntity[]> {\n  const db = await openDb();\n  const records = await getAllByIndex<WorldEntity & { simulationRunId?: string }>(\n    db,\n    ENTITIES_STORE,\n    'simulationRunId',\n    simulationRunId,\n  );\n  db.close();\n  return records.map(stripSimulationRunId) as WorldEntity[];\n}", "parameters": [{"name": "simulationRunId", "type": "string", "optional": false}], "returnType": "Promise<WorldEntity[]>"}, {"id": "packages/world-store/src/index.ts::getRelationships", "name": "getRelationships", "kind": "function", "filePath": "packages/world-store/src/index.ts", "sourceCode": "export async function getRelationships(simulationRunId: string): Promise<WorldRelationship[]> {\n  const db = await openDb();\n  const records = await getAllByIndex<WorldRelationship & { simulationRunId?: string }>(\n    db,\n    RELATIONSHIPS_STORE,\n    'simulationRunId',\n    simulationRunId,\n  );\n  db.close();\n  return records.map(stripSimulationRunId) as WorldRelationship[];\n}", "parameters": [{"name": "simulationRunId", "type": "string", "optional": false}], "returnType": "Promise<WorldRelationship[]>"}, {"id": "packages/world-store/src/index.ts::getNarrativeEvents", "name": "getNarrativeEvents", "kind": "function", "filePath": "packages/world-store/src/index.ts", "sourceCode": "export async function getNarrativeEvents(simulationRunId: string): Promise<NarrativeEvent[]> {\n  const db = await openDb();\n  const records = await getAllByIndex<NarrativeEvent & { simulationRunId?: string }>(\n    db,\n    EVENTS_STORE,\n    'simulationRunId',\n    simulationRunId,\n  );\n  db.close();\n  return records.map(stripSimulationRunId) as NarrativeEvent[];\n}", "parameters": [{"name": "simulationRunId", "type": "string", "optional": false}], "returnType": "Promise<NarrativeEvent[]>"}, {"id": "packages/world-store/src/index.ts::getChronicles", "name": "getChronicles", "kind": "function", "filePath": "packages/world-store/src/index.ts", "sourceCode": "export async function getChronicles(simulationRunId: string): Promise<ChronicleRecord[]> {\n  const db = await openDb();\n  const records = await getAllByIndex<ChronicleRecord>(\n    db,\n    CHRONICLES_STORE,\n    'simulationRunId',\n    simulationRunId,\n  );\n  db.close();\n  return records;\n}", "parameters": [{"name": "simulationRunId", "type": "string", "optional": false}], "returnType": "Promise<ChronicleRecord[]>"}, {"id": "packages/world-store/src/index.ts::getStaticPages", "name": "getStaticPages", "kind": "function", "filePath": "packages/world-store/src/index.ts", "sourceCode": "export async function getStaticPages(projectId: string): Promise<StaticPageRecord[]> {\n  const db = await openDb();\n  const records = await getAllByIndex<StaticPageRecord>(\n    db,\n    STATIC_PAGES_STORE,\n    'projectId',\n    projectId,\n  );\n  db.close();\n  return records;\n}", "parameters": [{"name": "projectId", "type": "string", "optional": false}], "returnType": "Promise<StaticPageRecord[]>"}, {"id": "packages/world-store/src/index.ts::buildWorldStateForSlot", "name": "buildWorldStateForSlot", "kind": "function", "filePath": "packages/world-store/src/index.ts", "sourceCode": "export async function buildWorldStateForSlot(\n  projectId: string,\n  slotIndex: number,\n): Promise<WorldOutput | null> {\n  const slot = await getSlotRecord(projectId, slotIndex);\n  if (!slot?.simulationRunId) return null;\n\n  const [schema, entities, relationships, narrativeHistory, coordinateState] = await Promise.all([\n    getWorldSchema(projectId),\n    getEntities(slot.simulationRunId),\n    getRelationships(slot.simulationRunId),\n    getNarrativeEvents(slot.simulationRunId),\n    getCoordinateState(slot.simulationRunId),\n  ]);\n\n  const eraName = resolveEraName(entities, slot.finalEraId);\n\n  return {\n    schema: schema || { entityKinds: [], relationshipKinds: [], cultures: [], tagRegistry: [] },\n    metadata: {\n      simulationRunId: slot.simulationRunId,\n      tick: typeof slot.finalTick === 'number' ? slot.finalTick : 0,\n      epoch: 0,\n      era: eraName,\n      entityCount: entities.length,\n      relationshipCount: relationships.length,\n    },\n    hardState: entities,\n    relationships,\n    pressures: {},\n    narrativeHistory: narrativeHistory.length > 0 ? narrativeHistory : undefined,\n    coordinateState: coordinateState || undefined,\n  };\n}", "parameters": [{"name": "projectId", "type": "string", "optional": false}, {"name": "slotIndex", "type": "number", "optional": false}], "returnType": "Promise<WorldOutput | null>"}]