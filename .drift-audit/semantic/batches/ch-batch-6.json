[{"id": "apps/coherence-engine/webui/src/components/actions/modals/index.js::ActionModal", "name": "ActionModal", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/modals/index.js", "sourceCode": "export function ActionModal({ action, onChange, onClose, onDelete, schema, pressures }) {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case \"overview\":\n        return <OverviewTab action={action} onChange={onChange} onDelete={onDelete} />;\n      case \"actor\":\n        return (\n          <ActorTab action={action} onChange={onChange} schema={schema} pressures={pressures} />\n        );\n      case \"instigator\":\n        return <InstigatorTab action={action} onChange={onChange} schema={schema} />;\n      case \"targeting\":\n        return <TargetingTab action={action} onChange={onChange} schema={schema} />;\n      case \"variables\":\n        return <VariablesTab action={action} onChange={onChange} schema={schema} />;\n      case \"outcome\":\n        return (\n          <OutcomeTab action={action} onChange={onChange} schema={schema} pressures={pressures} />\n        );\n      case \"probability\":\n        return <ProbabilityTab action={action} onChange={onChange} pressures={pressures} />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <ModalShell\n      onClose={onClose}\n      icon=\"\ud83c\udfad\"\n      title={action.name || action.id}\n      disabled={action.enabled === false}\n      tabs={TABS}\n      activeTab={activeTab}\n      onTabChange={setActiveTab}\n      tabClassName=\"ae-tab-btn\"\n    >\n      {renderTabContent()}\n    </ModalShell>\n  );\n}", "parameters": [{"name": "{ action, onChange, onClose, onDelete, schema, pressures }", "type": "{ action: any; onChange: any; onClose: any; onDelete: any; schema: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["OverviewTab"], "hookCalls": [{"name": "useState", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/ActorTab.jsx::ActorTab", "name": "ActorTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/ActorTab.jsx", "sourceCode": "export function ActorTab({ action, onChange, schema, pressures }) {\n  const actor = action.actor || {};\n  const selection = actor.selection || { strategy: \"by_kind\" };\n  const conditions = actor.conditions || [];\n\n  const updateActor = (field, value) => {\n    onChange({\n      ...action,\n      actor: { ...actor, [field]: value },\n    });\n  };\n\n  const availableRefs = [\"$actor\"];\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Actor Configuration</div>\n        <div className=\"info-box-text\">\n          The actor is the primary entity that performs the action on the target. Optional\n          instigator rules can provide richer context.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83c\udfad Actor Selection</div>\n        <SelectionRuleEditor\n          value={selection}\n          onChange={(updated) => updateActor(\"selection\", updated)}\n          schema={schema}\n          availableRefs={availableRefs}\n          showPickStrategy={false}\n          showMaxResults={false}\n        />\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2705 Actor Conditions ({conditions.length})</div>\n        <div className=\"section-desc\">\n          Additional rules that must pass for the actor to perform this action.\n        </div>\n\n        {conditions.length === 0 ? (\n          <div className=\"empty-state-compact\">No conditions defined.</div>\n        ) : (\n          conditions.map((condition, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={condition}\n              onChange={(updated) => {\n                const next = [...conditions];\n                next[index] = updated;\n                updateActor(\"conditions\", next);\n              }}\n              onRemove={() =>\n                updateActor(\n                  \"conditions\",\n                  conditions.filter((_, i) => i !== index)\n                )\n              }\n              schema={schema}\n              pressures={pressures}\n            />\n          ))\n        )}\n\n        <AddRuleButton\n          onAdd={(type) => {\n            const newRule = createNewRule(type, pressures);\n            updateActor(\"conditions\", [...conditions, newRule]);\n          }}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema, pressures }", "type": "{ action: any; onChange: any; schema: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "SelectionRuleEditor", "AddRuleButton"], "hookCalls": [], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../generators/applicability/AddRuleButton", "specifiers": ["AddRuleButton"], "category": "internal"}, {"source": "../../generators/applicability/ApplicabilityRuleCard", "specifiers": ["ApplicabilityRuleCard"], "category": "internal"}, {"source": "../../generators/applicability/createNewRule", "specifiers": ["createNewRule"], "category": "internal"}, {"source": "../../shared/SelectionRuleEditor", "specifiers": ["SelectionRuleEditor"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/index.js::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/index.js", "sourceCode": "export function OverviewTab({ action, onChange, onDelete }) {\n  const updateAction = (field, value) => {\n    onChange({ ...action, [field]: value });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(action.id, (value) =>\n    updateAction(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(action.name, (value) =>\n    updateAction(\"name\", value)\n  );\n\n  const isEnabled = action.enabled !== false;\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udccb Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"id\" className=\"label\">ID</label>\n            <input id=\"id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n              placeholder=\"unique_action_id\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"name\" className=\"label\">Name</label>\n            <input id=\"name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n              placeholder=\"Action Name\"\n            />\n          </div>\n          <div className=\"form-group form-group-wide\">\n            <label className=\"label\">Description\n            <LocalTextArea\n              value={action.description || \"\"}\n              onChange={(value) => updateAction(\"description\", value)}\n              placeholder=\"What does this action do?\"\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2699\ufe0f Status</div>\n        <label className=\"checkbox-label\">\n          <input\n            type=\"checkbox\"\n            checked={isEnabled}\n            onChange={(e) => updateAction(\"enabled\", e.target.checked)}\n            className=\"checkbox\"\n          />\n          Action Enabled\n        </label>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\uddd1\ufe0f Danger Zone</div>\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete Action\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, onDelete }", "type": "{ action: any; onChange: any; onDelete: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "label", "input", "LocalTextArea", "button"], "hookCalls": [{"name": "useLocalInputState", "count": 2}], "customHookCalls": ["useLocalInputState"], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/index.js::ActorTab", "name": "ActorTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/index.js", "sourceCode": "export function ActorTab({ action, onChange, schema, pressures }) {\n  const actor = action.actor || {};\n  const selection = actor.selection || { strategy: \"by_kind\" };\n  const conditions = actor.conditions || [];\n\n  const updateActor = (field, value) => {\n    onChange({\n      ...action,\n      actor: { ...actor, [field]: value },\n    });\n  };\n\n  const availableRefs = [\"$actor\"];\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Actor Configuration</div>\n        <div className=\"info-box-text\">\n          The actor is the primary entity that performs the action on the target. Optional\n          instigator rules can provide richer context.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83c\udfad Actor Selection</div>\n        <SelectionRuleEditor\n          value={selection}\n          onChange={(updated) => updateActor(\"selection\", updated)}\n          schema={schema}\n          availableRefs={availableRefs}\n          showPickStrategy={false}\n          showMaxResults={false}\n        />\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2705 Actor Conditions ({conditions.length})</div>\n        <div className=\"section-desc\">\n          Additional rules that must pass for the actor to perform this action.\n        </div>\n\n        {conditions.length === 0 ? (\n          <div className=\"empty-state-compact\">No conditions defined.</div>\n        ) : (\n          conditions.map((condition, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={condition}\n              onChange={(updated) => {\n                const next = [...conditions];\n                next[index] = updated;\n                updateActor(\"conditions\", next);\n              }}\n              onRemove={() =>\n                updateActor(\n                  \"conditions\",\n                  conditions.filter((_, i) => i !== index)\n                )\n              }\n              schema={schema}\n              pressures={pressures}\n            />\n          ))\n        )}\n\n        <AddRuleButton\n          onAdd={(type) => {\n            const newRule = createNewRule(type, pressures);\n            updateActor(\"conditions\", [...conditions, newRule]);\n          }}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema, pressures }", "type": "{ action: any; onChange: any; schema: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "SelectionRuleEditor", "AddRuleButton"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/index.js::InstigatorTab", "name": "InstigatorTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/index.js", "sourceCode": "export function InstigatorTab({ action, onChange, schema }) {\n  const actor = action.actor || {};\n\n  const updateActor = (field, value) => {\n    onChange({\n      ...action,\n      actor: { ...actor, [field]: value },\n    });\n  };\n\n  const instigator = actor.instigator;\n  const hasInstigator = Boolean(instigator);\n\n  const addInstigator = () => {\n    updateActor(\"instigator\", { from: \"graph\", kind: \"\", pickStrategy: \"random\", required: false });\n  };\n\n  const updateInstigator = (updated) => {\n    updateActor(\"instigator\", updated);\n  };\n\n  const removeInstigator = () => {\n    updateActor(\"instigator\", undefined);\n  };\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Instigator</div>\n        <div className=\"info-box-text\">\n          Configure optional instigator selection for this action.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udc64 Instigator (Optional)</div>\n        <div className=\"section-desc\">\n          An instigator can trigger the action on behalf of the actor (e.g., NPC leader acts for\n          their faction).\n        </div>\n\n        {!hasInstigator ? (\n          <div>\n            <div className=\"text-muted text-small mb-md\">\n              No instigator configured. The actor performs the action directly.\n            </div>\n            <button className=\"btn btn-add\" onClick={addInstigator}>\n              + Add Instigator\n            </button>\n          </div>\n        ) : (\n          <div>\n            <label className=\"checkbox-label mb-lg\">\n              <input\n                type=\"checkbox\"\n                checked={instigator.required || false}\n                onChange={(e) =>\n                  updateInstigator({ ...instigator, required: e.target.checked || undefined })\n                }\n                className=\"checkbox\"\n              />\n              Instigator required\n            </label>\n            <VariableSelectionEditor\n              value={instigator}\n              onChange={(updated) =>\n                updateInstigator({ ...updated, required: instigator.required })\n              }\n              schema={schema}\n              availableRefs={[\"$actor\"]}\n            />\n            <button\n              className=\"btn btn-danger-outline mt-lg\"\n              onClick={removeInstigator}\n            >\n              Remove Instigator\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "button", "input", "VariableSelectionEditor"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/index.js::TargetingTab", "name": "TargetingTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/index.js", "sourceCode": "export function TargetingTab({ action, onChange, schema }) {\n  const targeting = action.targeting || { strategy: \"by_kind\" };\n\n  const updateTargeting = (updated) => {\n    onChange({\n      ...action,\n      targeting: updated,\n    });\n  };\n\n  // Available refs for selection filters (action context)\n  const availableRefs = [\"$actor\", \"$instigator\"];\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Target Selection</div>\n        <div className=\"info-box-text\">Define how valid targets are selected for this action.</div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83c\udfaf Target Selection</div>\n        <SelectionRuleEditor\n          value={targeting}\n          onChange={updateTargeting}\n          schema={schema}\n          availableRefs={availableRefs}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "SelectionRuleEditor"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/index.js::VariablesTab", "name": "VariablesTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/index.js", "sourceCode": "// ============================================================================\n// VariablesTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.action - The action being edited\n * @param {Function} props.onChange - Callback when action changes\n * @param {Object} props.schema - Domain schema\n */\nexport function VariablesTab({ action, onChange, schema }) {\n  const variables = action.variables || {};\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  // Build available refs for relationship queries (actor, instigator, target, target2 + other vars)\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$actor\", \"$instigator\", \"$target\", \"$target2\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    // Ensure the name starts with $\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    // Create with empty required fields - validation will flag them\n    onChange({\n      ...action,\n      variables: {\n        ...variables,\n        [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"\" } },\n      },\n    });\n    setNewVarName(\"\");\n    setShowAddForm(false);\n  };\n\n  const varEntries = Object.entries(variables);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Variables</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What are variables?</div>\n          <div className=\"info-box-text\">\n            Variables let you select additional entities from the graph to use in mutations. For\n            example, you might select a <code className=\"inline-code\">$victimFaction</code> to\n            create an enemy relationship with, or an <code className=\"inline-code\">$artifact</code>{\" \"}\n            to modify. Variables are resolved after <code className=\"inline-code\">$actor</code> and{\" \"}\n            <code className=\"inline-code\">$target</code> are chosen.\n          </div>\n        </div>\n\n        {varEntries.length === 0 && !showAddForm ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udce6</div>\n            <div className=\"empty-state-title\">No variables defined</div>\n            <div className=\"empty-state-desc\">\n              Add variables to select additional entities for use in mutations.\n            </div>\n          </div>\n        ) : (\n          varEntries.map(([name, config]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={config}\n              onChange={(updated) =>\n                onChange({ ...action, variables: { ...variables, [name]: updated } })\n              }\n              onRemove={() => {\n                const newVars = { ...variables };\n                delete newVars[name];\n                onChange({ ...action, variables: newVars });\n              }}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "code", "label", "input", "button"], "hookCalls": [{"name": "useState", "count": 2}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/index.js::OutcomeTab", "name": "OutcomeTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/index.js", "sourceCode": "export function OutcomeTab({ action, onChange, schema, pressures }) {\n  const outcome = action.outcome || {};\n  const mutations = outcome.mutations || [];\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const addButtonRef = useRef(null);\n\n  const updateOutcome = (field, value) => {\n    onChange({\n      ...action,\n      outcome: { ...outcome, [field]: value },\n    });\n  };\n\n  const createMutation = (type) => {\n    const defaultPressure = pressures?.[0]?.id || \"\";\n    const defaultEntity = \"$actor\";\n    const defaultTarget = \"$target\";\n    const defaultOther = \"$target2\";\n\n    switch (type) {\n      case \"modify_pressure\":\n        return { type: \"modify_pressure\", pressureId: defaultPressure, delta: 0 };\n      case \"set_tag\":\n        return { type: \"set_tag\", entity: defaultTarget, tag: \"\", value: true };\n      case \"remove_tag\":\n        return { type: \"remove_tag\", entity: defaultTarget, tag: \"\" };\n      case \"change_status\":\n        return { type: \"change_status\", entity: defaultTarget, newStatus: \"\" };\n      case \"adjust_prominence\":\n        return { type: \"adjust_prominence\", entity: defaultEntity, delta: 0.1 };\n      case \"archive_relationship\":\n        return {\n          type: \"archive_relationship\",\n          entity: defaultEntity,\n          relationshipKind: \"\",\n          with: defaultTarget,\n          direction: \"both\",\n        };\n      case \"archive_all_relationships\":\n        return {\n          type: \"archive_all_relationships\",\n          entity: defaultEntity,\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n      case \"adjust_relationship_strength\":\n        return {\n          type: \"adjust_relationship_strength\",\n          kind: \"\",\n          src: defaultEntity,\n          dst: defaultTarget,\n          delta: 0.1,\n        };\n      case \"update_rate_limit\":\n        return { type: \"update_rate_limit\" };\n      case \"create_relationship\":\n      default:\n        return {\n          type: \"create_relationship\",\n          kind: \"\",\n          src: defaultEntity,\n          dst: defaultTarget || defaultOther,\n          strength: 0.5,\n        };\n    }\n  };\n\n  const addMutation = (type) => {\n    updateOutcome(\"mutations\", [...mutations, createMutation(type)]);\n  };\n\n  const updateMutation = (index, mutation) => {\n    const next = [...mutations];\n    next[index] = mutation;\n    updateOutcome(\"mutations\", next);\n  };\n\n  const removeMutation = (index) => {\n    updateOutcome(\n      \"mutations\",\n      mutations.filter((_, i) => i !== index)\n    );\n  };\n\n  useLayoutEffect(() => {\n    if (showTypeMenu && addButtonRef.current) {\n      const rect = addButtonRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (event) => {\n      if (addButtonRef.current && !addButtonRef.current.contains(event.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Action Outcome</div>\n        <div className=\"info-box-text\">\n          Define what happens when this action succeeds. Create relationships, change statuses,\n          modify pressures, or strengthen existing connections.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2699\ufe0f Mutations ({mutations.length})</div>\n        <div className=\"section-desc\">\n          Apply mutations when the action succeeds. Each mutation uses the unified rules library.\n        </div>\n\n        {mutations.map((mutation, index) => (\n          <MutationCard\n            key={index}\n            mutation={mutation}\n            onChange={(updated) => updateMutation(index, updated)}\n            onRemove={() => removeMutation(index)}\n            schema={schema}\n            pressures={pressures}\n            entityOptions={RELATIONSHIP_REFS}\n            typeOptions={ACTION_MUTATION_TYPES}\n            createMutation={createMutation}\n          />\n        ))}\n\n        <div ref={addButtonRef} className=\"ot-add-btn-wrap mt-lg\">\n          <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n            + Add Mutation\n          </button>\n\n          {showTypeMenu && (\n            {/* eslint-disable-next-line local/no-inline-styles -- dynamic position from JS measurement */}\n            <div\n              className=\"dropdown-menu ot-dropdown-fixed\"\n              style={{\n                '--ot-dd-top': `${dropdownPos.top}px`,\n                '--ot-dd-left': `${dropdownPos.left}px`,\n                '--ot-dd-width': `${dropdownPos.width}px`,\n                top: 'var(--ot-dd-top)',\n                left: 'var(--ot-dd-left)',\n                width: 'var(--ot-dd-width)',\n              }}\n            >\n              {MUTATION_TYPE_OPTIONS.map((opt) => (\n                <div\n                  key={opt.value}\n                  onClick={() => {\n                    addMutation(opt.value);\n                    setShowTypeMenu(false);\n                  }}\n                  className=\"dropdown-menu-item\"\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color */}\n                  <span\n                    className=\"dropdown-menu-icon\"\n                    style={{ '--ot-menu-icon-bg': `${opt.color}20`, backgroundColor: 'var(--ot-menu-icon-bg)' }}\n                  >\n                    {opt.icon}\n                  </span>\n                  <span className=\"dropdown-menu-label\">{opt.label}</span>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2b50 Prominence Changes</div>\n        <div className=\"section-desc\">\n          Apply prominence changes to actor or target on action success/failure. Values are numeric\n          deltas (e.g., 0.1 or -0.05).\n        </div>\n\n        <div className=\"mb-xl\">\n          <div className=\"label mb-md\">\n            Actor Prominence Delta\n          </div>\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Success\n              <NumberInput\n                value={outcome.actorProminenceDelta?.onSuccess}\n                onChange={(v) => {\n                  const current = outcome.actorProminenceDelta || {};\n                  const updated = { ...current, onSuccess: v };\n                  if (updated.onSuccess === undefined) delete updated.onSuccess;\n                  updateOutcome(\n                    \"actorProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., 0.1\"\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Failure\n              <NumberInput\n                value={outcome.actorProminenceDelta?.onFailure}\n                onChange={(v) => {\n                  const current = outcome.actorProminenceDelta || {};\n                  const updated = { ...current, onFailure: v };\n                  if (updated.onFailure === undefined) delete updated.onFailure;\n                  updateOutcome(\n                    \"actorProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., -0.05\"\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        </div>\n\n        <div>\n          <div className=\"label mb-md\">\n            Target Prominence Delta\n          </div>\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Success\n              <NumberInput\n                value={outcome.targetProminenceDelta?.onSuccess}\n                onChange={(v) => {\n                  const current = outcome.targetProminenceDelta || {};\n                  const updated = { ...current, onSuccess: v };\n                  if (updated.onSuccess === undefined) delete updated.onSuccess;\n                  updateOutcome(\n                    \"targetProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., 0.1\"\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Failure\n              <NumberInput\n                value={outcome.targetProminenceDelta?.onFailure}\n                onChange={(v) => {\n                  const current = outcome.targetProminenceDelta || {};\n                  const updated = { ...current, onFailure: v };\n                  if (updated.onFailure === undefined) delete updated.onFailure;\n                  updateOutcome(\n                    \"targetProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., -0.05\"\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udcdd Description Template</div>\n        <div className=\"section-desc\">\n          Template for generating occurrence descriptions. Use {\"{actor.name}\"},{\" \"}\n          {\"{instigator.name}\"}, {\"{target.name}\"}, etc.\n        </div>\n        <LocalTextArea\n          value={outcome.descriptionTemplate || \"\"}\n          onChange={(value) => updateOutcome(\"descriptionTemplate\", value || undefined)}\n          placeholder=\"e.g., declared war on {target.name}\"\n        />\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udcd6 Narration Template</div>\n        <div className=\"section-desc\">\n          Domain-controlled narrative text. Syntax: {\"{entity.field}\"}, {\"{$var.field}\"},{\" \"}\n          {\"{field|fallback}\"}, {\"{list:entities}\"}.\n        </div>\n        <LocalTextArea\n          value={outcome.narrationTemplate || \"\"}\n          onChange={(value) => updateOutcome(\"narrationTemplate\", value || undefined)}\n// ... (truncated)", "parameters": [{"name": "{ action, onChange, schema, pressures }", "type": "{ action: any; onChange: any; schema: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": [], "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/index.js::ProbabilityTab", "name": "ProbabilityTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/index.js", "sourceCode": "export function ProbabilityTab({ action, onChange, pressures }) {\n  const probability = action.probability || {};\n\n  const updateProbability = (field, value) => {\n    onChange({\n      ...action,\n      probability: { ...probability, [field]: value },\n    });\n  };\n\n  const pressureModifiers = probability.pressureModifiers || [];\n  const baseSuccessChance = probability.baseSuccessChance ?? 0.5;\n  const baseWeight = probability.baseWeight ?? 1.0;\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Probability Configuration</div>\n        <div className=\"info-box-text\">\n          Control how likely this action is to be selected and succeed. Pressure modifiers\n          dynamically adjust weight based on world state.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83c\udfaf Base Success Chance</div>\n        <div className=\"section-desc\">Probability that this action succeeds when attempted.</div>\n        <div className=\"slider-row\">\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.05\"\n            value={baseSuccessChance}\n            onChange={(e) => updateProbability(\"baseSuccessChance\", parseFloat(e.target.value))}\n            className=\"slider\"\n          />\n          <span className=\"slider-value\">{(baseSuccessChance * 100).toFixed(0)}%</span>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2696\ufe0f Base Weight</div>\n        <div className=\"section-desc\">\n          Relative weight for action selection. Higher weight means more likely to be chosen.\n        </div>\n        <div className=\"form-group\">\n          <NumberInput\n            value={baseWeight}\n            onChange={(v) => updateProbability(\"baseWeight\", v ?? 1.0)}\n            min={0}\n          />\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udcca Pressure Modifiers ({pressureModifiers.length})</div>\n        <div className=\"section-desc\">\n          Pressures that affect the weight of this action. Formula: weight = baseWeight \u00d7 (1 +\n          \u03a3(pressure/100 \u00d7 multiplier))\n        </div>\n        <PressureModifiersEditor\n          value={pressureModifiers}\n          onChange={(v) => updateProbability(\"pressureModifiers\", v.length > 0 ? v : undefined)}\n          pressures={pressures}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, pressures }", "type": "{ action: any; onChange: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "input", "span", "NumberInput", "PressureModifiersEditor"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/InstigatorTab.jsx::InstigatorTab", "name": "InstigatorTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/InstigatorTab.jsx", "sourceCode": "export function InstigatorTab({ action, onChange, schema }) {\n  const actor = action.actor || {};\n\n  const updateActor = (field, value) => {\n    onChange({\n      ...action,\n      actor: { ...actor, [field]: value },\n    });\n  };\n\n  const instigator = actor.instigator;\n  const hasInstigator = Boolean(instigator);\n\n  const addInstigator = () => {\n    updateActor(\"instigator\", { from: \"graph\", kind: \"\", pickStrategy: \"random\", required: false });\n  };\n\n  const updateInstigator = (updated) => {\n    updateActor(\"instigator\", updated);\n  };\n\n  const removeInstigator = () => {\n    updateActor(\"instigator\", undefined);\n  };\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Instigator</div>\n        <div className=\"info-box-text\">\n          Configure optional instigator selection for this action.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udc64 Instigator (Optional)</div>\n        <div className=\"section-desc\">\n          An instigator can trigger the action on behalf of the actor (e.g., NPC leader acts for\n          their faction).\n        </div>\n\n        {!hasInstigator ? (\n          <div>\n            <div className=\"text-muted text-small mb-md\">\n              No instigator configured. The actor performs the action directly.\n            </div>\n            <button className=\"btn btn-add\" onClick={addInstigator}>\n              + Add Instigator\n            </button>\n          </div>\n        ) : (\n          <div>\n            <label className=\"checkbox-label mb-lg\">\n              <input\n                type=\"checkbox\"\n                checked={instigator.required || false}\n                onChange={(e) =>\n                  updateInstigator({ ...instigator, required: e.target.checked || undefined })\n                }\n                className=\"checkbox\"\n              />\n              Instigator required\n            </label>\n            <VariableSelectionEditor\n              value={instigator}\n              onChange={(updated) =>\n                updateInstigator({ ...updated, required: instigator.required })\n              }\n              schema={schema}\n              availableRefs={[\"$actor\"]}\n            />\n            <button\n              className=\"btn btn-danger-outline mt-lg\"\n              onClick={removeInstigator}\n            >\n              Remove Instigator\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "button", "input", "VariableSelectionEditor"], "hookCalls": [], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared/VariableSelectionEditor", "specifiers": ["VariableSelectionEditor"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/OutcomeTab.jsx::OutcomeTab", "name": "OutcomeTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/OutcomeTab.jsx", "sourceCode": "export function OutcomeTab({ action, onChange, schema, pressures }) {\n  const outcome = action.outcome || {};\n  const mutations = outcome.mutations || [];\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const addButtonRef = useRef(null);\n\n  const updateOutcome = (field, value) => {\n    onChange({\n      ...action,\n      outcome: { ...outcome, [field]: value },\n    });\n  };\n\n  const createMutation = (type) => {\n    const defaultPressure = pressures?.[0]?.id || \"\";\n    const defaultEntity = \"$actor\";\n    const defaultTarget = \"$target\";\n    const defaultOther = \"$target2\";\n\n    switch (type) {\n      case \"modify_pressure\":\n        return { type: \"modify_pressure\", pressureId: defaultPressure, delta: 0 };\n      case \"set_tag\":\n        return { type: \"set_tag\", entity: defaultTarget, tag: \"\", value: true };\n      case \"remove_tag\":\n        return { type: \"remove_tag\", entity: defaultTarget, tag: \"\" };\n      case \"change_status\":\n        return { type: \"change_status\", entity: defaultTarget, newStatus: \"\" };\n      case \"adjust_prominence\":\n        return { type: \"adjust_prominence\", entity: defaultEntity, delta: 0.1 };\n      case \"archive_relationship\":\n        return {\n          type: \"archive_relationship\",\n          entity: defaultEntity,\n          relationshipKind: \"\",\n          with: defaultTarget,\n          direction: \"both\",\n        };\n      case \"archive_all_relationships\":\n        return {\n          type: \"archive_all_relationships\",\n          entity: defaultEntity,\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n      case \"adjust_relationship_strength\":\n        return {\n          type: \"adjust_relationship_strength\",\n          kind: \"\",\n          src: defaultEntity,\n          dst: defaultTarget,\n          delta: 0.1,\n        };\n      case \"update_rate_limit\":\n        return { type: \"update_rate_limit\" };\n      case \"create_relationship\":\n      default:\n        return {\n          type: \"create_relationship\",\n          kind: \"\",\n          src: defaultEntity,\n          dst: defaultTarget || defaultOther,\n          strength: 0.5,\n        };\n    }\n  };\n\n  const addMutation = (type) => {\n    updateOutcome(\"mutations\", [...mutations, createMutation(type)]);\n  };\n\n  const updateMutation = (index, mutation) => {\n    const next = [...mutations];\n    next[index] = mutation;\n    updateOutcome(\"mutations\", next);\n  };\n\n  const removeMutation = (index) => {\n    updateOutcome(\n      \"mutations\",\n      mutations.filter((_, i) => i !== index)\n    );\n  };\n\n  useLayoutEffect(() => {\n    if (showTypeMenu && addButtonRef.current) {\n      const rect = addButtonRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (event) => {\n      if (addButtonRef.current && !addButtonRef.current.contains(event.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Action Outcome</div>\n        <div className=\"info-box-text\">\n          Define what happens when this action succeeds. Create relationships, change statuses,\n          modify pressures, or strengthen existing connections.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2699\ufe0f Mutations ({mutations.length})</div>\n        <div className=\"section-desc\">\n          Apply mutations when the action succeeds. Each mutation uses the unified rules library.\n        </div>\n\n        {mutations.map((mutation, index) => (\n          <MutationCard\n            key={index}\n            mutation={mutation}\n            onChange={(updated) => updateMutation(index, updated)}\n            onRemove={() => removeMutation(index)}\n            schema={schema}\n            pressures={pressures}\n            entityOptions={RELATIONSHIP_REFS}\n            typeOptions={ACTION_MUTATION_TYPES}\n            createMutation={createMutation}\n          />\n        ))}\n\n        <div ref={addButtonRef} className=\"ot-add-btn-wrap mt-lg\">\n          <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n            + Add Mutation\n          </button>\n\n          {showTypeMenu && (\n            {/* eslint-disable-next-line local/no-inline-styles -- dynamic position from JS measurement */}\n            <div\n              className=\"dropdown-menu ot-dropdown-fixed\"\n              style={{\n                '--ot-dd-top': `${dropdownPos.top}px`,\n                '--ot-dd-left': `${dropdownPos.left}px`,\n                '--ot-dd-width': `${dropdownPos.width}px`,\n                top: 'var(--ot-dd-top)',\n                left: 'var(--ot-dd-left)',\n                width: 'var(--ot-dd-width)',\n              }}\n            >\n              {MUTATION_TYPE_OPTIONS.map((opt) => (\n                <div\n                  key={opt.value}\n                  onClick={() => {\n                    addMutation(opt.value);\n                    setShowTypeMenu(false);\n                  }}\n                  className=\"dropdown-menu-item\"\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color */}\n                  <span\n                    className=\"dropdown-menu-icon\"\n                    style={{ '--ot-menu-icon-bg': `${opt.color}20`, backgroundColor: 'var(--ot-menu-icon-bg)' }}\n                  >\n                    {opt.icon}\n                  </span>\n                  <span className=\"dropdown-menu-label\">{opt.label}</span>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2b50 Prominence Changes</div>\n        <div className=\"section-desc\">\n          Apply prominence changes to actor or target on action success/failure. Values are numeric\n          deltas (e.g., 0.1 or -0.05).\n        </div>\n\n        <div className=\"mb-xl\">\n          <div className=\"label mb-md\">\n            Actor Prominence Delta\n          </div>\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Success\n              <NumberInput\n                value={outcome.actorProminenceDelta?.onSuccess}\n                onChange={(v) => {\n                  const current = outcome.actorProminenceDelta || {};\n                  const updated = { ...current, onSuccess: v };\n                  if (updated.onSuccess === undefined) delete updated.onSuccess;\n                  updateOutcome(\n                    \"actorProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., 0.1\"\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Failure\n              <NumberInput\n                value={outcome.actorProminenceDelta?.onFailure}\n                onChange={(v) => {\n                  const current = outcome.actorProminenceDelta || {};\n                  const updated = { ...current, onFailure: v };\n                  if (updated.onFailure === undefined) delete updated.onFailure;\n                  updateOutcome(\n                    \"actorProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., -0.05\"\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        </div>\n\n        <div>\n          <div className=\"label mb-md\">\n            Target Prominence Delta\n          </div>\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Success\n              <NumberInput\n                value={outcome.targetProminenceDelta?.onSuccess}\n                onChange={(v) => {\n                  const current = outcome.targetProminenceDelta || {};\n                  const updated = { ...current, onSuccess: v };\n                  if (updated.onSuccess === undefined) delete updated.onSuccess;\n                  updateOutcome(\n                    \"targetProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., 0.1\"\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Failure\n              <NumberInput\n                value={outcome.targetProminenceDelta?.onFailure}\n                onChange={(v) => {\n                  const current = outcome.targetProminenceDelta || {};\n                  const updated = { ...current, onFailure: v };\n                  if (updated.onFailure === undefined) delete updated.onFailure;\n                  updateOutcome(\n                    \"targetProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., -0.05\"\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udcdd Description Template</div>\n        <div className=\"section-desc\">\n          Template for generating occurrence descriptions. Use {\"{actor.name}\"},{\" \"}\n          {\"{instigator.name}\"}, {\"{target.name}\"}, etc.\n        </div>\n        <LocalTextArea\n          value={outcome.descriptionTemplate || \"\"}\n          onChange={(value) => updateOutcome(\"descriptionTemplate\", value || undefined)}\n          placeholder=\"e.g., declared war on {target.name}\"\n        />\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udcd6 Narration Template</div>\n        <div className=\"section-desc\">\n          Domain-controlled narrative text. Syntax: {\"{entity.field}\"}, {\"{$var.field}\"},{\" \"}\n          {\"{field|fallback}\"}, {\"{list:entities}\"}.\n        </div>\n        <LocalTextArea\n          value={outcome.narrationTemplate || \"\"}\n          onChange={(value) => updateOutcome(\"narrationTemplate\", value || undefined)}\n// ... (truncated)", "parameters": [{"name": "{ action, onChange, schema, pressures }", "type": "{ action: any; onChange: any; schema: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": [], "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useEffect", "useLayoutEffect", "useRef", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["RELATIONSHIP_REFS", "MUTATION_TYPE_OPTIONS"], "category": "internal"}, {"source": "../../shared/MutationCard", "specifiers": ["MutationCard", "DEFAULT_MUTATION_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["NumberInput", "LocalTextArea"], "category": "internal"}, {"source": "./OutcomeTab.css", "specifiers": [], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/OverviewTab.jsx::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/OverviewTab.jsx", "sourceCode": "export function OverviewTab({ action, onChange, onDelete }) {\n  const updateAction = (field, value) => {\n    onChange({ ...action, [field]: value });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(action.id, (value) =>\n    updateAction(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(action.name, (value) =>\n    updateAction(\"name\", value)\n  );\n\n  const isEnabled = action.enabled !== false;\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udccb Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"id\" className=\"label\">ID</label>\n            <input id=\"id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n              placeholder=\"unique_action_id\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"name\" className=\"label\">Name</label>\n            <input id=\"name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n              placeholder=\"Action Name\"\n            />\n          </div>\n          <div className=\"form-group form-group-wide\">\n            <label className=\"label\">Description\n            <LocalTextArea\n              value={action.description || \"\"}\n              onChange={(value) => updateAction(\"description\", value)}\n              placeholder=\"What does this action do?\"\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2699\ufe0f Status</div>\n        <label className=\"checkbox-label\">\n          <input\n            type=\"checkbox\"\n            checked={isEnabled}\n            onChange={(e) => updateAction(\"enabled\", e.target.checked)}\n            className=\"checkbox\"\n          />\n          Action Enabled\n        </label>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\uddd1\ufe0f Danger Zone</div>\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete Action\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, onDelete }", "type": "{ action: any; onChange: any; onDelete: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "label", "input", "LocalTextArea", "button"], "hookCalls": [{"name": "useLocalInputState", "count": 2}], "customHookCalls": ["useLocalInputState"], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["useLocalInputState", "LocalTextArea"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/ProbabilityTab.jsx::ProbabilityTab", "name": "ProbabilityTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/ProbabilityTab.jsx", "sourceCode": "export function ProbabilityTab({ action, onChange, pressures }) {\n  const probability = action.probability || {};\n\n  const updateProbability = (field, value) => {\n    onChange({\n      ...action,\n      probability: { ...probability, [field]: value },\n    });\n  };\n\n  const pressureModifiers = probability.pressureModifiers || [];\n  const baseSuccessChance = probability.baseSuccessChance ?? 0.5;\n  const baseWeight = probability.baseWeight ?? 1.0;\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Probability Configuration</div>\n        <div className=\"info-box-text\">\n          Control how likely this action is to be selected and succeed. Pressure modifiers\n          dynamically adjust weight based on world state.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83c\udfaf Base Success Chance</div>\n        <div className=\"section-desc\">Probability that this action succeeds when attempted.</div>\n        <div className=\"slider-row\">\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.05\"\n            value={baseSuccessChance}\n            onChange={(e) => updateProbability(\"baseSuccessChance\", parseFloat(e.target.value))}\n            className=\"slider\"\n          />\n          <span className=\"slider-value\">{(baseSuccessChance * 100).toFixed(0)}%</span>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2696\ufe0f Base Weight</div>\n        <div className=\"section-desc\">\n          Relative weight for action selection. Higher weight means more likely to be chosen.\n        </div>\n        <div className=\"form-group\">\n          <NumberInput\n            value={baseWeight}\n            onChange={(v) => updateProbability(\"baseWeight\", v ?? 1.0)}\n            min={0}\n          />\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udcca Pressure Modifiers ({pressureModifiers.length})</div>\n        <div className=\"section-desc\">\n          Pressures that affect the weight of this action. Formula: weight = baseWeight \u00d7 (1 +\n          \u03a3(pressure/100 \u00d7 multiplier))\n        </div>\n        <PressureModifiersEditor\n          value={pressureModifiers}\n          onChange={(v) => updateProbability(\"pressureModifiers\", v.length > 0 ? v : undefined)}\n          pressures={pressures}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, pressures }", "type": "{ action: any; onChange: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "input", "span", "NumberInput", "PressureModifiersEditor"], "hookCalls": [], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["NumberInput"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/TargetingTab.jsx::TargetingTab", "name": "TargetingTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/TargetingTab.jsx", "sourceCode": "export function TargetingTab({ action, onChange, schema }) {\n  const targeting = action.targeting || { strategy: \"by_kind\" };\n\n  const updateTargeting = (updated) => {\n    onChange({\n      ...action,\n      targeting: updated,\n    });\n  };\n\n  // Available refs for selection filters (action context)\n  const availableRefs = [\"$actor\", \"$instigator\"];\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Target Selection</div>\n        <div className=\"info-box-text\">Define how valid targets are selected for this action.</div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83c\udfaf Target Selection</div>\n        <SelectionRuleEditor\n          value={targeting}\n          onChange={updateTargeting}\n          schema={schema}\n          availableRefs={availableRefs}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "SelectionRuleEditor"], "hookCalls": [], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared/SelectionRuleEditor", "specifiers": ["SelectionRuleEditor"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/VariablesTab.jsx::VariablesTab", "name": "VariablesTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/VariablesTab.jsx", "sourceCode": "// ============================================================================\n// VariablesTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.action - The action being edited\n * @param {Function} props.onChange - Callback when action changes\n * @param {Object} props.schema - Domain schema\n */\nexport function VariablesTab({ action, onChange, schema }) {\n  const variables = action.variables || {};\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  // Build available refs for relationship queries (actor, instigator, target, target2 + other vars)\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$actor\", \"$instigator\", \"$target\", \"$target2\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    // Ensure the name starts with $\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    // Create with empty required fields - validation will flag them\n    onChange({\n      ...action,\n      variables: {\n        ...variables,\n        [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"\" } },\n      },\n    });\n    setNewVarName(\"\");\n    setShowAddForm(false);\n  };\n\n  const varEntries = Object.entries(variables);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Variables</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What are variables?</div>\n          <div className=\"info-box-text\">\n            Variables let you select additional entities from the graph to use in mutations. For\n            example, you might select a <code className=\"inline-code\">$victimFaction</code> to\n            create an enemy relationship with, or an <code className=\"inline-code\">$artifact</code>{\" \"}\n            to modify. Variables are resolved after <code className=\"inline-code\">$actor</code> and{\" \"}\n            <code className=\"inline-code\">$target</code> are chosen.\n          </div>\n        </div>\n\n        {varEntries.length === 0 && !showAddForm ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udce6</div>\n            <div className=\"empty-state-title\">No variables defined</div>\n            <div className=\"empty-state-desc\">\n              Add variables to select additional entities for use in mutations.\n            </div>\n          </div>\n        ) : (\n          varEntries.map(([name, config]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={config}\n              onChange={(updated) =>\n                onChange({ ...action, variables: { ...variables, [name]: updated } })\n              }\n              onRemove={() => {\n                const newVars = { ...variables };\n                delete newVars[name];\n                onChange({ ...action, variables: newVars });\n              }}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "code", "label", "input", "button"], "hookCalls": [{"name": "useState", "count": 2}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared/VariableSelectionEditor", "specifiers": ["VariableSelectionEditor"], "category": "internal"}, {"source": "./VariablesTab.css", "specifiers": [], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/components/DependencySection.jsx::DependencySection", "name": "DependencySection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/components/DependencySection.jsx", "sourceCode": "export function DependencySection({ title, icon, items, renderItem, defaultExpanded = false }) {\n  const [expanded, setExpanded] = useState(defaultExpanded);\n  const [, setHovering] = useState(false);\n\n  if (items.length === 0) return null;\n\n  return (\n    <div className=\"dependency-viewer-section\">\n      <div\n        className=\"dependency-section-header\"\n        onClick={() => setExpanded(!expanded)}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n      >\n        <div className=\"dependency-section-title\">\n          <span>{icon}</span>\n          <span>{title}</span>\n          <span className=\"dependency-section-count\">{items.length}</span>\n        </div>\n        <span className={`dependency-expand-icon ${expanded ? \"dependency-expand-icon-open\" : \"\"}`}>\n          \u25bc\n        </span>\n      </div>\n      {expanded && (\n        <div className=\"dependency-section-content\">\n          {items.map((item, index) => renderItem(item, index))}\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ title, icon, items, renderItem, defaultExpanded = false }", "type": "{ title: any; icon: any; items: any; renderItem: any; defaultExpanded?: boolean; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "div"], "hookCalls": [{"name": "useState", "count": 2}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../dependency-viewer.css", "specifiers": [], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/components/index.js::DependencySection", "name": "DependencySection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/components/index.js", "sourceCode": "export function DependencySection({ title, icon, items, renderItem, defaultExpanded = false }) {\n  const [expanded, setExpanded] = useState(defaultExpanded);\n  const [, setHovering] = useState(false);\n\n  if (items.length === 0) return null;\n\n  return (\n    <div className=\"dependency-viewer-section\">\n      <div\n        className=\"dependency-section-header\"\n        onClick={() => setExpanded(!expanded)}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n      >\n        <div className=\"dependency-section-title\">\n          <span>{icon}</span>\n          <span>{title}</span>\n          <span className=\"dependency-section-count\">{items.length}</span>\n        </div>\n        <span className={`dependency-expand-icon ${expanded ? \"dependency-expand-icon-open\" : \"\"}`}>\n          \u25bc\n        </span>\n      </div>\n      {expanded && (\n        <div className=\"dependency-section-content\">\n          {items.map((item, index) => renderItem(item, index))}\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ title, icon, items, renderItem, defaultExpanded = false }", "type": "{ title: any; icon: any; items: any; renderItem: any; defaultExpanded?: boolean; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "div"], "hookCalls": [{"name": "useState", "count": 2}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/components/index.js::UsageBadges", "name": "UsageBadges", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/components/index.js", "sourceCode": "/**\n * DetailUsageBadges component\n *\n * @param {Object} props\n * @param {Object} props.usage - Object with arrays of referencing items\n *   e.g., { generators: ['gen1', 'gen2'], systems: ['sys1'] }\n * @param {boolean} props.showOrphan - If true, show \"Not used\" when no usage (default: true)\n */\nexport function DetailUsageBadges({ usage = {}, showOrphan = true }) {\n  const badges = [];\n\n  for (const [type, config] of Object.entries(BADGE_CONFIG)) {\n    const items = usage[type];\n    if (items?.length > 0) {\n      const count = items.length;\n      const label = type === 'eras' && count !== 1 ? config.labelPlural : config.label;\n      badges.push(\n        <span\n          key={type}\n          className={`detail-badge ${config.className}`}\n          title={`${config.tooltip}: ${items.join(', ')}`}\n        >\n          {count} {label}\n        </span>\n      );\n    }\n  }\n\n  if (badges.length === 0) {\n    if (showOrphan) {\n      return <span className=\"detail-badge detail-badge-orphan\">Not used</span>;\n    }\n    return null;\n  }\n\n  return <div className=\"detail-badge-container\">{badges}</div>;\n}", "parameters": [{"name": "{ usage = {}, showOrphan = true }", "type": "{ usage: any; showOrphan: boolean; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["span"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/BasicInfoSection.jsx::BasicInfoSection", "name": "BasicInfoSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/BasicInfoSection.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.era - The era object\n * @param {Function} props.onFieldChange - Called when a field changes\n */\nexport function BasicInfoSection({ era, onFieldChange }) {\n  return (\n    <div className=\"section\">\n      <SectionHeader icon=\"\ud83d\udcdd\" title=\"Basic Information\" />\n      <div className=\"input-grid\">\n        <div className=\"form-group\">\n          <label htmlFor=\"id\" className=\"label\">ID</label>\n          <input id=\"id\"\n            type=\"text\"\n            value={era.id}\n            onChange={(e) => onFieldChange(\"id\", e.target.value)}\n            className=\"input\"\n          />\n        </div>\n        <div className=\"form-group\">\n          <label htmlFor=\"name\" className=\"label\">Name</label>\n          <input id=\"name\"\n            type=\"text\"\n            value={era.name}\n            onChange={(e) => onFieldChange(\"name\", e.target.value)}\n            className=\"input\"\n          />\n        </div>\n      </div>\n      <div className=\"form-group mt-xl\">\n        <label className=\"label\">Summary\n        <LocalTextArea value={era.summary} onChange={(value) => onFieldChange(\"summary\", value)} />\n        </label>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ era, onFieldChange }", "type": "{ era: any; onFieldChange: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["SectionHeader", "label", "input", "LocalTextArea"], "hookCalls": [], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["SectionHeader", "LocalTextArea"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/ConditionsSection.jsx::ConditionsSection", "name": "ConditionsSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/ConditionsSection.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.title - Section title\n * @param {string} props.icon - Section icon\n * @param {string} props.description - Section description\n * @param {string} props.emptyMessage - Message when no conditions\n * @param {Array} props.conditions - Array of condition objects\n * @param {Function} props.onUpdate - Called when a condition is updated\n * @param {Function} props.onRemove - Called to remove a condition\n * @param {Function} props.onAdd - Called to add a new condition\n * @param {string} props.addLabel - Label for add button\n * @param {Array} props.pressures - Available pressures\n * @param {Object} props.schema - Domain schema\n */\nexport function ConditionsSection({\n  title,\n  icon,\n  description,\n  emptyMessage,\n  conditions,\n  onUpdate,\n  onRemove,\n  onAdd,\n  addLabel,\n  pressures,\n  schema,\n}) {\n  return (\n    <div className=\"section\">\n      <SectionHeader\n        icon={icon}\n        title={title}\n        count={`${conditions.length} condition${conditions.length !== 1 ? \"s\" : \"\"}`}\n        description={description}\n      />\n      <div className=\"items-grid\">\n        {conditions.length === 0 ? (\n          <EmptyState title={emptyMessage} styles={EMPTY_STATE_STYLES} />\n        ) : (\n          conditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdate(index, updated)}\n              onRemove={() => onRemove(index)}\n              pressures={pressures || []}\n              schema={schema}\n            />\n          ))\n        )}\n      </div>\n      <AddItemButton onClick={onAdd} label={addLabel} styles={ADD_ITEM_STYLES} />\n    </div>\n  );\n}", "parameters": [{"name": "{\n  title,\n  icon,\n  description,\n  emptyMessage,\n  conditions,\n  onUpdate,\n  onRemove,\n  onAdd,\n  addLabel,\n  pressures,\n  schema,\n}", "type": "{ title: string; icon: string; description: string; emptyMessage: string; conditions: any[]; onUpdate: Function; onRemove: Function; onAdd: Function; addLabel: string; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["SectionHeader", "EmptyState", "AddItemButton"], "hookCalls": [], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["SectionHeader", "EmptyState", "AddItemButton"], "category": "internal"}, {"source": "../shared", "specifiers": ["TransitionConditionEditor"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/EffectsSection.jsx::EffectsSection", "name": "EffectsSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/EffectsSection.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.title - Section title\n * @param {string} props.icon - Section icon\n * @param {string} props.description - Section description\n * @param {string} props.emptyMessage - Message when no effects\n * @param {Array} props.pressureChanges - Array of [pressureId, value] tuples\n * @param {Function} props.onUpdate - Called when an effect value changes\n * @param {Function} props.onRemove - Called to remove an effect\n * @param {Array} props.availablePressures - Pressures that can be added\n * @param {Function} props.onAdd - Called to add an effect\n * @param {string} props.addPlaceholder - Placeholder for add dropdown\n * @param {Array} props.pressures - All pressure definitions for display\n */\nexport function EffectsSection({\n  title,\n  icon,\n  description,\n  emptyMessage,\n  pressureChanges,\n  onUpdate,\n  onRemove,\n  availablePressures,\n  onAdd,\n  addPlaceholder,\n  pressures,\n}) {\n  return (\n    <div className=\"section\">\n      <SectionHeader\n        icon={icon}\n        title={title}\n        count={`${pressureChanges.length} effect${pressureChanges.length !== 1 ? \"s\" : \"\"}`}\n        description={description}\n      />\n      <div className=\"items-grid\">\n        {pressureChanges.length === 0 ? (\n          <EmptyState title={emptyMessage} styles={EMPTY_STATE_STYLES} />\n        ) : (\n          pressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdate(pressureId, newValue)}\n              onRemove={() => onRemove(pressureId)}\n              pressures={pressures || []}\n            />\n          ))\n        )}\n      </div>\n      <div className=\"add-container\">\n        <SearchableDropdown\n          items={availablePressures}\n          onSelect={onAdd}\n          placeholder={addPlaceholder}\n          emptyMessage=\"All pressures added\"\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  title,\n  icon,\n  description,\n  emptyMessage,\n  pressureChanges,\n  onUpdate,\n  onRemove,\n  availablePressures,\n  onAdd,\n  addPlaceholder,\n  pressures,\n}", "type": "{ title: string; icon: string; description: string; emptyMessage: string; pressureChanges: any[]; onUpdate: Function; onRemove: Function; availablePressures: any[]; onAdd: Function; addPlaceholder: string; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["SectionHeader", "EmptyState", "SearchableDropdown"], "hookCalls": [], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["SectionHeader", "EmptyState", "SearchableDropdown"], "category": "internal"}, {"source": "../shared", "specifiers": ["TransitionEffectItem"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/index.js::BasicInfoSection", "name": "BasicInfoSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.era - The era object\n * @param {Function} props.onFieldChange - Called when a field changes\n */\nexport function BasicInfoSection({ era, onFieldChange }) {\n  return (\n    <div className=\"section\">\n      <SectionHeader icon=\"\ud83d\udcdd\" title=\"Basic Information\" />\n      <div className=\"input-grid\">\n        <div className=\"form-group\">\n          <label htmlFor=\"id\" className=\"label\">ID</label>\n          <input id=\"id\"\n            type=\"text\"\n            value={era.id}\n            onChange={(e) => onFieldChange(\"id\", e.target.value)}\n            className=\"input\"\n          />\n        </div>\n        <div className=\"form-group\">\n          <label htmlFor=\"name\" className=\"label\">Name</label>\n          <input id=\"name\"\n            type=\"text\"\n            value={era.name}\n            onChange={(e) => onFieldChange(\"name\", e.target.value)}\n            className=\"input\"\n          />\n        </div>\n      </div>\n      <div className=\"form-group mt-xl\">\n        <label className=\"label\">Summary\n        <LocalTextArea value={era.summary} onChange={(value) => onFieldChange(\"summary\", value)} />\n        </label>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ era, onFieldChange }", "type": "{ era: any; onFieldChange: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["SectionHeader", "label", "input", "LocalTextArea"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/index.js::ConditionsSection", "name": "ConditionsSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.title - Section title\n * @param {string} props.icon - Section icon\n * @param {string} props.description - Section description\n * @param {string} props.emptyMessage - Message when no conditions\n * @param {Array} props.conditions - Array of condition objects\n * @param {Function} props.onUpdate - Called when a condition is updated\n * @param {Function} props.onRemove - Called to remove a condition\n * @param {Function} props.onAdd - Called to add a new condition\n * @param {string} props.addLabel - Label for add button\n * @param {Array} props.pressures - Available pressures\n * @param {Object} props.schema - Domain schema\n */\nexport function ConditionsSection({\n  title,\n  icon,\n  description,\n  emptyMessage,\n  conditions,\n  onUpdate,\n  onRemove,\n  onAdd,\n  addLabel,\n  pressures,\n  schema,\n}) {\n  return (\n    <div className=\"section\">\n      <SectionHeader\n        icon={icon}\n        title={title}\n        count={`${conditions.length} condition${conditions.length !== 1 ? \"s\" : \"\"}`}\n        description={description}\n      />\n      <div className=\"items-grid\">\n        {conditions.length === 0 ? (\n          <EmptyState title={emptyMessage} styles={EMPTY_STATE_STYLES} />\n        ) : (\n          conditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdate(index, updated)}\n              onRemove={() => onRemove(index)}\n              pressures={pressures || []}\n              schema={schema}\n            />\n          ))\n        )}\n      </div>\n      <AddItemButton onClick={onAdd} label={addLabel} styles={ADD_ITEM_STYLES} />\n    </div>\n  );\n}", "parameters": [{"name": "{\n  title,\n  icon,\n  description,\n  emptyMessage,\n  conditions,\n  onUpdate,\n  onRemove,\n  onAdd,\n  addLabel,\n  pressures,\n  schema,\n}", "type": "{ title: string; icon: string; description: string; emptyMessage: string; conditions: any[]; onUpdate: Function; onRemove: Function; onAdd: Function; addLabel: string; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["SectionHeader", "EmptyState", "AddItemButton"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/index.js::EffectsSection", "name": "EffectsSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.title - Section title\n * @param {string} props.icon - Section icon\n * @param {string} props.description - Section description\n * @param {string} props.emptyMessage - Message when no effects\n * @param {Array} props.pressureChanges - Array of [pressureId, value] tuples\n * @param {Function} props.onUpdate - Called when an effect value changes\n * @param {Function} props.onRemove - Called to remove an effect\n * @param {Array} props.availablePressures - Pressures that can be added\n * @param {Function} props.onAdd - Called to add an effect\n * @param {string} props.addPlaceholder - Placeholder for add dropdown\n * @param {Array} props.pressures - All pressure definitions for display\n */\nexport function EffectsSection({\n  title,\n  icon,\n  description,\n  emptyMessage,\n  pressureChanges,\n  onUpdate,\n  onRemove,\n  availablePressures,\n  onAdd,\n  addPlaceholder,\n  pressures,\n}) {\n  return (\n    <div className=\"section\">\n      <SectionHeader\n        icon={icon}\n        title={title}\n        count={`${pressureChanges.length} effect${pressureChanges.length !== 1 ? \"s\" : \"\"}`}\n        description={description}\n      />\n      <div className=\"items-grid\">\n        {pressureChanges.length === 0 ? (\n          <EmptyState title={emptyMessage} styles={EMPTY_STATE_STYLES} />\n        ) : (\n          pressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdate(pressureId, newValue)}\n              onRemove={() => onRemove(pressureId)}\n              pressures={pressures || []}\n            />\n          ))\n        )}\n      </div>\n      <div className=\"add-container\">\n        <SearchableDropdown\n          items={availablePressures}\n          onSelect={onAdd}\n          placeholder={addPlaceholder}\n          emptyMessage=\"All pressures added\"\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  title,\n  icon,\n  description,\n  emptyMessage,\n  pressureChanges,\n  onUpdate,\n  onRemove,\n  availablePressures,\n  onAdd,\n  addPlaceholder,\n  pressures,\n}", "type": "{ title: string; icon: string; description: string; emptyMessage: string; pressureChanges: any[]; onUpdate: Function; onRemove: Function; availablePressures: any[]; onAdd: Function; addPlaceholder: string; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["SectionHeader", "EmptyState", "SearchableDropdown"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/index.js::TransitionsGrid", "name": "TransitionsGrid", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.entryConditions - Entry condition array\n * @param {Array} props.exitConditions - Exit condition array\n * @param {Array} props.entryPressureChanges - Entry effect tuples\n * @param {Array} props.exitPressureChanges - Exit effect tuples\n * @param {Function} props.onUpdateEntryCondition\n * @param {Function} props.onRemoveEntryCondition\n * @param {Function} props.onAddEntryCondition\n * @param {Function} props.onUpdateExitCondition\n * @param {Function} props.onRemoveExitCondition\n * @param {Function} props.onAddExitCondition\n * @param {Function} props.onUpdateEntryEffect\n * @param {Function} props.onRemoveEntryEffect\n * @param {Function} props.onAddEntryEffect\n * @param {Function} props.onUpdateExitEffect\n * @param {Function} props.onRemoveExitEffect\n * @param {Function} props.onAddExitEffect\n * @param {Array} props.availablePressuresForEntry\n * @param {Array} props.availablePressuresForExit\n * @param {Array} props.pressures - All pressures for display\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.eras - All eras for era-specific conditions\n */\nexport function TransitionsGrid({\n  entryConditions = [],\n  exitConditions = [],\n  entryPressureChanges = [],\n  exitPressureChanges = [],\n  onUpdateEntryCondition,\n  onRemoveEntryCondition,\n  onAddEntryCondition,\n  onUpdateExitCondition,\n  onRemoveExitCondition,\n  onAddExitCondition,\n  onUpdateEntryEffect,\n  onRemoveEntryEffect,\n  onAddEntryEffect,\n  onUpdateExitEffect,\n  onRemoveExitEffect,\n  onAddExitEffect,\n  availablePressuresForEntry = [],\n  availablePressuresForExit = [],\n  pressures = [],\n  schema,\n  eras = [],\n}) {\n  return (\n    <div className=\"transitions-grid\">\n      {/* Entry Column */}\n      <div className=\"transitions-column transitions-entry\">\n        <div className=\"transitions-column-header\">\n          <span className=\"transitions-column-icon\">\ud83d\udeaa</span>\n          <span className=\"transitions-column-title\">Entry</span>\n          <span className=\"transitions-column-subtitle\">When era starts</span>\n        </div>\n\n        <MiniSection\n          title=\"Conditions\"\n          icon=\"?\"\n          count={entryConditions.length}\n          isEmpty={entryConditions.length === 0}\n          emptyMessage=\"No entry conditions \u2014 starts immediately\"\n        >\n          {entryConditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdateEntryCondition(index, updated)}\n              onRemove={() => onRemoveEntryCondition(index)}\n              pressures={pressures}\n              schema={schema}\n              eras={eras}\n            />\n          ))}\n          <AddItemButton\n            onClick={onAddEntryCondition}\n            label=\"+ Condition\"\n            styles={ADD_ITEM_STYLES}\n          />\n        </MiniSection>\n\n        <MiniSection\n          title=\"Effects\"\n          icon=\"\u2728\"\n          count={entryPressureChanges.length}\n          isEmpty={entryPressureChanges.length === 0}\n          emptyMessage=\"No pressure changes on entry\"\n        >\n          {entryPressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdateEntryEffect(pressureId, newValue)}\n              onRemove={() => onRemoveEntryEffect(pressureId)}\n              pressures={pressures}\n            />\n          ))}\n          <div className=\"transitions-add-effect\">\n            <SearchableDropdown\n              items={availablePressuresForEntry}\n              onSelect={onAddEntryEffect}\n              placeholder=\"+ Add effect...\"\n              emptyMessage=\"All pressures added\"\n            />\n          </div>\n        </MiniSection>\n      </div>\n\n      {/* Arrow divider */}\n      <div className=\"transitions-divider\">\n        <span className=\"transitions-arrow\">\u2192</span>\n      </div>\n\n      {/* Exit Column */}\n      <div className=\"transitions-column transitions-exit\">\n        <div className=\"transitions-column-header\">\n          <span className=\"transitions-column-icon\">\ud83d\udd04</span>\n          <span className=\"transitions-column-title\">Exit</span>\n          <span className=\"transitions-column-subtitle\">When era ends</span>\n        </div>\n\n        <MiniSection\n          title=\"Conditions\"\n          icon=\"?\"\n          count={exitConditions.length}\n          isEmpty={exitConditions.length === 0}\n          emptyMessage=\"No exit conditions \u2014 transitions immediately\"\n        >\n          {exitConditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdateExitCondition(index, updated)}\n              onRemove={() => onRemoveExitCondition(index)}\n              pressures={pressures}\n              schema={schema}\n              eras={eras}\n            />\n          ))}\n          <AddItemButton\n            onClick={onAddExitCondition}\n            label=\"+ Condition\"\n            styles={ADD_ITEM_STYLES}\n          />\n        </MiniSection>\n\n        <MiniSection\n          title=\"Effects\"\n          icon=\"\ud83d\udcab\"\n          count={exitPressureChanges.length}\n          isEmpty={exitPressureChanges.length === 0}\n          emptyMessage=\"No pressure changes on exit\"\n        >\n          {exitPressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdateExitEffect(pressureId, newValue)}\n              onRemove={() => onRemoveExitEffect(pressureId)}\n              pressures={pressures}\n            />\n          ))}\n          <div className=\"transitions-add-effect\">\n            <SearchableDropdown\n              items={availablePressuresForExit}\n              onSelect={onAddExitEffect}\n              placeholder=\"+ Add effect...\"\n              emptyMessage=\"All pressures added\"\n            />\n          </div>\n        </MiniSection>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  entryConditions = [],\n  exitConditions = [],\n  entryPressureChanges = [],\n  exitPressureChanges = [],\n  onUpdateEntryCondition,\n  onRemoveEntryCondition,\n  onAddEntryCondition,\n  onUpdateExitCondition,\n  onRemoveExitCondition,\n  onAddExitCondition,\n  onUpdateEntryEffect,\n  onRemoveEntryEffect,\n  onAddEntryEffect,\n  onUpdateExitEffect,\n  onRemoveExitEffect,\n  onAddExitEffect,\n  availablePressuresForEntry = [],\n  availablePressuresForExit = [],\n  pressures = [],\n  schema,\n  eras = [],\n}", "type": "{ entryConditions: any[]; exitConditions: any[]; entryPressureChanges: any[]; exitPressureChanges: any[]; onUpdateEntryCondition: Function; onRemoveEntryCondition: Function; onAddEntryCondition: Function; onUpdateExitCondition: Function; onRemoveExitCondition: Function; onAddExitCondition: Function; onUpdateEntryEffect: Function; onRemoveEntryEffect: Function; onAddEntryEffect: Function; onUpdateExitEffect: Function; onRemoveExitEffect: Function; onAddExitEffect: Function; availablePressuresF...", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "TransitionConditionEditor", "AddItemButton", "TransitionEffectItem", "SearchableDropdown"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/TransitionsGrid.jsx::TransitionsGrid", "name": "TransitionsGrid", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/TransitionsGrid.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.entryConditions - Entry condition array\n * @param {Array} props.exitConditions - Exit condition array\n * @param {Array} props.entryPressureChanges - Entry effect tuples\n * @param {Array} props.exitPressureChanges - Exit effect tuples\n * @param {Function} props.onUpdateEntryCondition\n * @param {Function} props.onRemoveEntryCondition\n * @param {Function} props.onAddEntryCondition\n * @param {Function} props.onUpdateExitCondition\n * @param {Function} props.onRemoveExitCondition\n * @param {Function} props.onAddExitCondition\n * @param {Function} props.onUpdateEntryEffect\n * @param {Function} props.onRemoveEntryEffect\n * @param {Function} props.onAddEntryEffect\n * @param {Function} props.onUpdateExitEffect\n * @param {Function} props.onRemoveExitEffect\n * @param {Function} props.onAddExitEffect\n * @param {Array} props.availablePressuresForEntry\n * @param {Array} props.availablePressuresForExit\n * @param {Array} props.pressures - All pressures for display\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.eras - All eras for era-specific conditions\n */\nexport function TransitionsGrid({\n  entryConditions = [],\n  exitConditions = [],\n  entryPressureChanges = [],\n  exitPressureChanges = [],\n  onUpdateEntryCondition,\n  onRemoveEntryCondition,\n  onAddEntryCondition,\n  onUpdateExitCondition,\n  onRemoveExitCondition,\n  onAddExitCondition,\n  onUpdateEntryEffect,\n  onRemoveEntryEffect,\n  onAddEntryEffect,\n  onUpdateExitEffect,\n  onRemoveExitEffect,\n  onAddExitEffect,\n  availablePressuresForEntry = [],\n  availablePressuresForExit = [],\n  pressures = [],\n  schema,\n  eras = [],\n}) {\n  return (\n    <div className=\"transitions-grid\">\n      {/* Entry Column */}\n      <div className=\"transitions-column transitions-entry\">\n        <div className=\"transitions-column-header\">\n          <span className=\"transitions-column-icon\">\ud83d\udeaa</span>\n          <span className=\"transitions-column-title\">Entry</span>\n          <span className=\"transitions-column-subtitle\">When era starts</span>\n        </div>\n\n        <MiniSection\n          title=\"Conditions\"\n          icon=\"?\"\n          count={entryConditions.length}\n          isEmpty={entryConditions.length === 0}\n          emptyMessage=\"No entry conditions \u2014 starts immediately\"\n        >\n          {entryConditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdateEntryCondition(index, updated)}\n              onRemove={() => onRemoveEntryCondition(index)}\n              pressures={pressures}\n              schema={schema}\n              eras={eras}\n            />\n          ))}\n          <AddItemButton\n            onClick={onAddEntryCondition}\n            label=\"+ Condition\"\n            styles={ADD_ITEM_STYLES}\n          />\n        </MiniSection>\n\n        <MiniSection\n          title=\"Effects\"\n          icon=\"\u2728\"\n          count={entryPressureChanges.length}\n          isEmpty={entryPressureChanges.length === 0}\n          emptyMessage=\"No pressure changes on entry\"\n        >\n          {entryPressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdateEntryEffect(pressureId, newValue)}\n              onRemove={() => onRemoveEntryEffect(pressureId)}\n              pressures={pressures}\n            />\n          ))}\n          <div className=\"transitions-add-effect\">\n            <SearchableDropdown\n              items={availablePressuresForEntry}\n              onSelect={onAddEntryEffect}\n              placeholder=\"+ Add effect...\"\n              emptyMessage=\"All pressures added\"\n            />\n          </div>\n        </MiniSection>\n      </div>\n\n      {/* Arrow divider */}\n      <div className=\"transitions-divider\">\n        <span className=\"transitions-arrow\">\u2192</span>\n      </div>\n\n      {/* Exit Column */}\n      <div className=\"transitions-column transitions-exit\">\n        <div className=\"transitions-column-header\">\n          <span className=\"transitions-column-icon\">\ud83d\udd04</span>\n          <span className=\"transitions-column-title\">Exit</span>\n          <span className=\"transitions-column-subtitle\">When era ends</span>\n        </div>\n\n        <MiniSection\n          title=\"Conditions\"\n          icon=\"?\"\n          count={exitConditions.length}\n          isEmpty={exitConditions.length === 0}\n          emptyMessage=\"No exit conditions \u2014 transitions immediately\"\n        >\n          {exitConditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdateExitCondition(index, updated)}\n              onRemove={() => onRemoveExitCondition(index)}\n              pressures={pressures}\n              schema={schema}\n              eras={eras}\n            />\n          ))}\n          <AddItemButton\n            onClick={onAddExitCondition}\n            label=\"+ Condition\"\n            styles={ADD_ITEM_STYLES}\n          />\n        </MiniSection>\n\n        <MiniSection\n          title=\"Effects\"\n          icon=\"\ud83d\udcab\"\n          count={exitPressureChanges.length}\n          isEmpty={exitPressureChanges.length === 0}\n          emptyMessage=\"No pressure changes on exit\"\n        >\n          {exitPressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdateExitEffect(pressureId, newValue)}\n              onRemove={() => onRemoveExitEffect(pressureId)}\n              pressures={pressures}\n            />\n          ))}\n          <div className=\"transitions-add-effect\">\n            <SearchableDropdown\n              items={availablePressuresForExit}\n              onSelect={onAddExitEffect}\n              placeholder=\"+ Add effect...\"\n              emptyMessage=\"All pressures added\"\n            />\n          </div>\n        </MiniSection>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  entryConditions = [],\n  exitConditions = [],\n  entryPressureChanges = [],\n  exitPressureChanges = [],\n  onUpdateEntryCondition,\n  onRemoveEntryCondition,\n  onAddEntryCondition,\n  onUpdateExitCondition,\n  onRemoveExitCondition,\n  onAddExitCondition,\n  onUpdateEntryEffect,\n  onRemoveEntryEffect,\n  onAddEntryEffect,\n  onUpdateExitEffect,\n  onRemoveExitEffect,\n  onAddExitEffect,\n  availablePressuresForEntry = [],\n  availablePressuresForExit = [],\n  pressures = [],\n  schema,\n  eras = [],\n}", "type": "{ entryConditions: any[]; exitConditions: any[]; entryPressureChanges: any[]; exitPressureChanges: any[]; onUpdateEntryCondition: Function; onRemoveEntryCondition: Function; onAddEntryCondition: Function; onUpdateExitCondition: Function; onRemoveExitCondition: Function; onAddExitCondition: Function; onUpdateEntryEffect: Function; onRemoveEntryEffect: Function; onAddEntryEffect: Function; onUpdateExitEffect: Function; onRemoveExitEffect: Function; onAddExitEffect: Function; availablePressuresF...", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "TransitionConditionEditor", "AddItemButton", "TransitionEffectItem", "SearchableDropdown"], "hookCalls": [], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["AddItemButton", "SearchableDropdown"], "category": "internal"}, {"source": "../shared", "specifiers": ["TransitionConditionEditor", "TransitionEffectItem"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/eras/shared/index.js::TransitionConditionEditor", "name": "TransitionConditionEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.condition - The condition object\n * @param {number} props.index - Index in the conditions array\n * @param {Function} props.onChange - Called when condition changes\n * @param {Function} props.onRemove - Called to remove condition\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.eras - Era definitions (optional)\n */\nexport function TransitionConditionEditor({\n  condition,\n  index: _index,\n  onChange,\n  onRemove,\n  pressures,\n  schema,\n  eras,\n}) {\n  return (\n    <ApplicabilityRuleCard\n      rule={condition}\n      onChange={(updated) => onChange(updated)}\n      onRemove={onRemove}\n      schema={schema}\n      pressures={pressures}\n      eras={eras}\n      depth={0}\n    />\n  );\n}", "parameters": [{"name": "{\n  condition,\n  index: _index,\n  onChange,\n  onRemove,\n  pressures,\n  schema,\n  eras,\n}", "type": "{ condition: any; index: number; onChange: Function; onRemove: Function; pressures: any[]; schema: any; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["ApplicabilityRuleCard"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/eras/shared/index.js::TransitionEffectItem", "name": "TransitionEffectItem", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.pressureId - The pressure ID\n * @param {number} props.value - The delta value\n * @param {Function} props.onChange - Called when value changes\n * @param {Function} props.onRemove - Called to remove effect\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function TransitionEffectItem({ pressureId, value, onChange, onRemove, pressures }) {\n  const pressure = pressures.find((p) => p.id === pressureId);\n\n  return (\n    <ItemRow name={pressure?.name || pressureId} onRemove={onRemove} removeTitle=\"Remove effect\">\n      <NumberInput\n        value={value}\n        onChange={(v) => onChange(v ?? 0)}\n        className={`input input-compact input-centered ${value >= 0 ? \"text-success\" : \"text-danger\"}`}\n        integer\n      />\n      <span className=\"text-dim text-sm tei-pressure-label\">\n        {value >= 0 ? \"+\" : \"\"}\n        {value} pressure\n      </span>\n    </ItemRow>\n  );\n}", "parameters": [{"name": "{ pressureId, value, onChange, onRemove, pressures }", "type": "{ pressureId: string; value: number; onChange: Function; onRemove: Function; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["NumberInput", "span"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/eras/shared/TransitionConditionEditor.jsx::TransitionConditionEditor", "name": "TransitionConditionEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/shared/TransitionConditionEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.condition - The condition object\n * @param {number} props.index - Index in the conditions array\n * @param {Function} props.onChange - Called when condition changes\n * @param {Function} props.onRemove - Called to remove condition\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.eras - Era definitions (optional)\n */\nexport function TransitionConditionEditor({\n  condition,\n  index: _index,\n  onChange,\n  onRemove,\n  pressures,\n  schema,\n  eras,\n}) {\n  return (\n    <ApplicabilityRuleCard\n      rule={condition}\n      onChange={(updated) => onChange(updated)}\n      onRemove={onRemove}\n      schema={schema}\n      pressures={pressures}\n      eras={eras}\n      depth={0}\n    />\n  );\n}", "parameters": [{"name": "{\n  condition,\n  index: _index,\n  onChange,\n  onRemove,\n  pressures,\n  schema,\n  eras,\n}", "type": "{ condition: any; index: number; onChange: Function; onRemove: Function; pressures: any[]; schema: any; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["ApplicabilityRuleCard"], "hookCalls": [], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../generators/applicability/ApplicabilityRuleCard", "specifiers": ["ApplicabilityRuleCard"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/eras/shared/TransitionEffectItem.jsx::TransitionEffectItem", "name": "TransitionEffectItem", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/shared/TransitionEffectItem.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.pressureId - The pressure ID\n * @param {number} props.value - The delta value\n * @param {Function} props.onChange - Called when value changes\n * @param {Function} props.onRemove - Called to remove effect\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function TransitionEffectItem({ pressureId, value, onChange, onRemove, pressures }) {\n  const pressure = pressures.find((p) => p.id === pressureId);\n\n  return (\n    <ItemRow name={pressure?.name || pressureId} onRemove={onRemove} removeTitle=\"Remove effect\">\n      <NumberInput\n        value={value}\n        onChange={(v) => onChange(v ?? 0)}\n        className={`input input-compact input-centered ${value >= 0 ? \"text-success\" : \"text-danger\"}`}\n        integer\n      />\n      <span className=\"text-dim text-sm tei-pressure-label\">\n        {value >= 0 ? \"+\" : \"\"}\n        {value} pressure\n      </span>\n    </ItemRow>\n  );\n}", "parameters": [{"name": "{ pressureId, value, onChange, onRemove, pressures }", "type": "{ pressureId: string; value: number; onChange: Function; onRemove: Function; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["NumberInput", "span"], "hookCalls": [], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["ItemRow", "NumberInput"], "category": "internal"}, {"source": "./TransitionEffectItem.css", "specifiers": [], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/AddRuleButton.jsx::AddRuleButton", "name": "AddRuleButton", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/AddRuleButton.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Function} props.onAdd - Callback when a rule type is selected\n * @param {number} props.depth - Nesting depth (limits nested rule types at depth >= 2)\n */\nexport function AddRuleButton({ onAdd, depth = 0 }) {\n  const [showPicker, setShowPicker] = useState(false);\n\n  return (\n    <div className=\"dropdown\">\n      <button className=\"btn-add\" onClick={() => setShowPicker(!showPicker)}>\n        + Add Rule\n      </button>\n\n      {showPicker && (\n        <div className=\"dropdown-menu arb-dropdown\">\n          <div className=\"dropdown-options\">\n            {Object.entries(APPLICABILITY_TYPES)\n              .filter(([type]) => depth < 2 || (type !== \"or\" && type !== \"and\"))\n              .map(([type, config]) => (\n                <div\n                  key={type}\n                  className=\"dropdown-menu-item\"\n                  onClick={() => {\n                    onAdd(type);\n                    setShowPicker(false);\n                  }}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <div\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n                    style={{ '--arb-icon-bg': `${config.color}20`, backgroundColor: 'var(--arb-icon-bg)' }}\n                  >\n                    {config.icon}\n                  </div>\n                  <div>\n                    <div className=\"dropdown-menu-label\">{config.label}</div>\n                    <div className=\"arb-desc\">\n                      {config.desc}\n                    </div>\n                  </div>\n                </div>\n              ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ onAdd, depth = 0 }", "type": "{ onAdd: Function; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["button", "div"], "hookCalls": [{"name": "useState", "count": 1}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["APPLICABILITY_TYPES"], "category": "internal"}, {"source": "./AddRuleButton.css", "specifiers": [], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityRuleCard.jsx::ApplicabilityRuleCard", "name": "ApplicabilityRuleCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityRuleCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.rule - The rule configuration\n * @param {Function} props.onChange - Callback when rule changes\n * @param {Function} props.onRemove - Callback to remove this rule\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {number} props.depth - Nesting depth for nested rules\n */\nexport function ApplicabilityRuleCard({\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = APPLICABILITY_TYPES[rule.type] || {};\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const getSubtypesForKind = (kind) => {\n    const ek = entityKinds.find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const pressureOptions = (pressures || []).map((p) => ({\n    value: p.id,\n    label: p.name || p.id,\n  }));\n\n  const eraOptions = (eras || []).map((e) => ({\n    value: e.id,\n    label: e.name || e.id,\n  }));\n\n  const updateField = (field, value) => {\n    onChange({ ...rule, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (rule.type) {\n      case \"entity_count\": {\n        const kindSpec = `${rule.kind || \"?\"}${rule.subtype ? \":\" + rule.subtype : \"\"}`;\n        const minPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const maxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${kindSpec} ${minPart}${maxPart}`;\n      }\n      case \"pressure\":\n        return `${rule.pressureId || \"?\"} in [${rule.min ?? \"-\\u221E\"}, ${rule.max ?? \"\\u221E\"}]`;\n      case \"pressure_any_above\":\n        return `Any of [${rule.pressureIds?.join(\", \") || \"?\"}] > ${rule.threshold ?? \"?\"}`;\n      case \"pressure_compare\":\n        return `${rule.pressureA || \"?\"} ${rule.operator || \">\"} ${rule.pressureB || \"?\"}`;\n      case \"relationship_count\": {\n        const relMinPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const relMaxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${rule.relationshipKind || \"any\"} count ${relMinPart}${relMaxPart}`;\n      }\n      case \"relationship_exists\": {\n        const targetSuffix = rule.targetKind ? ` to ${rule.targetKind}` : \"\";\n        return `${rule.relationshipKind || \"?\"} exists${targetSuffix}`;\n      }\n      case \"tag_exists\":\n        return `has tag \"${rule.tag || \"?\"}\"`;\n      case \"tag_absent\":\n        return `missing tag \"${rule.tag || \"?\"}\"`;\n      case \"status\":\n        return rule.not ? `status != ${rule.status || \"?\"}` : `status = ${rule.status || \"?\"}`;\n      case \"prominence\":\n        return `prominence ${rule.min || \"?\"}-${rule.max || \"?\"}`;\n      case \"time_elapsed\":\n        return `${rule.minTicks || \"?\"} ticks since ${rule.since || \"updated\"}`;\n      case \"growth_phases_complete\": {\n        const eraSuffix = rule.eraId ? ` in ${rule.eraId}` : \"\";\n        return `${rule.minPhases ?? \"?\"} growth phases${eraSuffix}`;\n      }\n      case \"era_match\":\n        return rule.eras?.length ? rule.eras.join(\", \") : \"No eras selected\";\n      case \"random_chance\":\n        return `${Math.round((rule.chance ?? 0.5) * 100)}% chance`;\n      case \"cooldown_elapsed\":\n        return `${rule.cooldownTicks ?? \"?\"} ticks since last run`;\n      case \"creations_per_epoch\":\n        return `max ${rule.maxPerEpoch ?? \"?\"} per epoch`;\n      case \"graph_path\":\n        return `graph path (${rule.assert?.check || \"exists\"})`;\n      case \"entity_exists\":\n        return `entity ${rule.entity || \"?\"} exists`;\n      case \"entity_has_relationship\":\n        return `${rule.entity || \"?\"} has ${rule.relationshipKind || \"?\"} relationship`;\n      case \"or\":\n      case \"and\":\n        return `${rule.conditions?.length || 0} sub-rules`;\n      case \"always\":\n        return \"always\";\n      default:\n        return rule.type;\n    }\n  };\n\n  const isNested = rule.type === \"or\" || rule.type === \"and\";\n\n  return (\n    <div className=\"condition-card\">\n      <div className=\"condition-card-header\">\n        <div className=\"condition-card-type\">\n          <div\n            className=\"condition-card-icon\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n            style={{ '--arc-icon-bg': `${typeConfig.color || \"#3b82f6\"}20`, backgroundColor: 'var(--arc-icon-bg)' }}\n          >\n            {typeConfig.icon || \"\ud83d\udccb\"}\n          </div>\n          <div>\n            <div className=\"condition-card-label\">{typeConfig.label || rule.type}</div>\n            <div className=\"condition-card-summary\">{getSummary()}</div>\n          </div>\n        </div>\n        <div className=\"condition-card-actions\">\n          <button className=\"btn-icon\" onClick={() => setExpanded(!expanded)}>\n            {expanded ? \"^\" : \"v\"}\n          </button>\n          <button className=\"btn-icon btn-icon-danger\" onClick={onRemove}>\n            x\n          </button>\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"mt-lg\">\n          <div className=\"form-grid\">\n            {rule.type === \"entity_count\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={rule.kind}\n                  onChange={(v) => {\n                    updateField(\"kind\", v);\n                    if (rule.subtype) updateField(\"subtype\", undefined);\n                  }}\n                  options={entityKindOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Subtype (optional)\"\n                  value={rule.subtype || \"\"}\n                  onChange={(v) => updateField(\"subtype\", v || undefined)}\n                  options={[{ value: \"\", label: \"Any\" }, ...getSubtypesForKind(rule.kind)]}\n                  placeholder=\"Any\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure\"\n                  value={rule.pressureId}\n                  onChange={(v) => updateField(\"pressureId\", v)}\n                  options={pressureOptions}\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min Value\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"0\"\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max Value\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"100\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_any_above\" && (\n              <>\n                <div className=\"grid-col-full\">\n                  <ChipSelect\n                    label=\"Pressures\"\n                    value={rule.pressureIds || []}\n                    onChange={(v) => updateField(\"pressureIds\", v)}\n                    options={pressureOptions}\n                    placeholder=\"+ Add pressure\"\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Threshold\n                  <NumberInput\n                    value={rule.threshold}\n                    onChange={(v) => updateField(\"threshold\", v ?? 0)}\n                    min={-100}\n                    max={100}\n                    integer\n                    placeholder=\"50\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_compare\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure A\"\n                  value={rule.pressureA}\n                  onChange={(v) => updateField(\"pressureA\", v)}\n                  options={pressureOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Operator\"\n                  value={rule.operator || \">\"}\n                  onChange={(v) => updateField(\"operator\", v)}\n                  options={[\n                    { value: \">\", label: \">\" },\n                    { value: \">=\", label: \">=\" },\n                    { value: \"<\", label: \"<\" },\n                    { value: \"<=\", label: \"<=\" },\n                    { value: \"==\", label: \"==\" },\n                    { value: \"!=\", label: \"!=\" },\n                  ]}\n                />\n                <ReferenceDropdown\n                  label=\"Pressure B\"\n                  value={rule.pressureB}\n                  onChange={(v) => updateField(\"pressureB\", v)}\n                  options={pressureOptions}\n                />\n              </>\n            )}\n\n\n            {rule.type === \"era_match\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Eras\"\n                  value={rule.eras || []}\n                  onChange={(v) => updateField(\"eras\", v)}\n                  options={eraOptions}\n                  placeholder=\"+ Add era\"\n                />\n              </div>\n            )}\n\n            {rule.type === \"random_chance\" && (\n              <div className=\"form-group grid-col-full\">\n                <span className=\"label\">Chance (%)</span>\n                <div className=\"flex items-center gap-lg\">\n// ... (truncated)", "parameters": [{"name": "{\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}", "type": "{ rule: any; onChange: Function; onRemove: Function; schema: any; pressures: any[]; eras: any[]; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "button", "ReferenceDropdown", "NumberInput", "ChipSelect", "span", "input", "label", "TagSelector", "GraphPathEditor", "ApplicabilityRuleCard", "AddRuleButton"], "hookCalls": [{"name": "useState", "count": 1}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["APPLICABILITY_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "ChipSelect", "NumberInput", "PROMINENCE_LEVELS"], "category": "internal"}, {"source": "./AddRuleButton", "specifiers": ["AddRuleButton"], "category": "internal"}, {"source": "./createNewRule", "specifiers": ["createNewRule"], "category": "internal"}, {"source": "../filters/GraphPathEditor", "specifiers": ["GraphPathEditor"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}]}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityTab.jsx::ApplicabilityTab", "name": "ApplicabilityTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n */\nexport function ApplicabilityTab({ generator, onChange, schema, pressures, eras }) {\n  const rules = generator.applicability || [];\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Applicability Rules</div>\n        <div className=\"section-desc\">\n          Define when this generator is eligible to run. If no rules are defined, the generator will\n          always be eligible. Multiple top-level rules are combined with AND logic.\n        </div>\n\n        {rules.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2713</div>\n            <div className=\"empty-state-title\">No applicability rules</div>\n            <div className=\"empty-state-desc\">\n              This generator will always be eligible to run. Add rules to control when it activates.\n            </div>\n          </div>\n        ) : (\n          rules.map((rule, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={rule}\n              onChange={(updated) => {\n                const newRules = [...rules];\n                newRules[index] = updated;\n                onChange({ ...generator, applicability: newRules });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, applicability: rules.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              pressures={pressures}\n              eras={eras}\n            />\n          ))\n        )}\n\n        <AddRuleButton\n          onAdd={(type) => {\n            const newRule = createNewRule(type, pressures);\n            onChange({ ...generator, applicability: [...rules, newRule] });\n          }}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema, pressures, eras }", "type": "{ generator: any; onChange: Function; schema: any; pressures: any[]; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "AddRuleButton"], "hookCalls": [], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./ApplicabilityRuleCard", "specifiers": ["ApplicabilityRuleCard"], "category": "internal"}, {"source": "./AddRuleButton", "specifiers": ["AddRuleButton"], "category": "internal"}, {"source": "./createNewRule", "specifiers": ["createNewRule"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/index.js::AddRuleButton", "name": "AddRuleButton", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Function} props.onAdd - Callback when a rule type is selected\n * @param {number} props.depth - Nesting depth (limits nested rule types at depth >= 2)\n */\nexport function AddRuleButton({ onAdd, depth = 0 }) {\n  const [showPicker, setShowPicker] = useState(false);\n\n  return (\n    <div className=\"dropdown\">\n      <button className=\"btn-add\" onClick={() => setShowPicker(!showPicker)}>\n        + Add Rule\n      </button>\n\n      {showPicker && (\n        <div className=\"dropdown-menu arb-dropdown\">\n          <div className=\"dropdown-options\">\n            {Object.entries(APPLICABILITY_TYPES)\n              .filter(([type]) => depth < 2 || (type !== \"or\" && type !== \"and\"))\n              .map(([type, config]) => (\n                <div\n                  key={type}\n                  className=\"dropdown-menu-item\"\n                  onClick={() => {\n                    onAdd(type);\n                    setShowPicker(false);\n                  }}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <div\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n                    style={{ '--arb-icon-bg': `${config.color}20`, backgroundColor: 'var(--arb-icon-bg)' }}\n                  >\n                    {config.icon}\n                  </div>\n                  <div>\n                    <div className=\"dropdown-menu-label\">{config.label}</div>\n                    <div className=\"arb-desc\">\n                      {config.desc}\n                    </div>\n                  </div>\n                </div>\n              ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ onAdd, depth = 0 }", "type": "{ onAdd: Function; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["button", "div"], "hookCalls": [{"name": "useState", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/index.js::ApplicabilityRuleCard", "name": "ApplicabilityRuleCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.rule - The rule configuration\n * @param {Function} props.onChange - Callback when rule changes\n * @param {Function} props.onRemove - Callback to remove this rule\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {number} props.depth - Nesting depth for nested rules\n */\nexport function ApplicabilityRuleCard({\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = APPLICABILITY_TYPES[rule.type] || {};\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const getSubtypesForKind = (kind) => {\n    const ek = entityKinds.find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const pressureOptions = (pressures || []).map((p) => ({\n    value: p.id,\n    label: p.name || p.id,\n  }));\n\n  const eraOptions = (eras || []).map((e) => ({\n    value: e.id,\n    label: e.name || e.id,\n  }));\n\n  const updateField = (field, value) => {\n    onChange({ ...rule, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (rule.type) {\n      case \"entity_count\": {\n        const kindSpec = `${rule.kind || \"?\"}${rule.subtype ? \":\" + rule.subtype : \"\"}`;\n        const minPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const maxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${kindSpec} ${minPart}${maxPart}`;\n      }\n      case \"pressure\":\n        return `${rule.pressureId || \"?\"} in [${rule.min ?? \"-\\u221E\"}, ${rule.max ?? \"\\u221E\"}]`;\n      case \"pressure_any_above\":\n        return `Any of [${rule.pressureIds?.join(\", \") || \"?\"}] > ${rule.threshold ?? \"?\"}`;\n      case \"pressure_compare\":\n        return `${rule.pressureA || \"?\"} ${rule.operator || \">\"} ${rule.pressureB || \"?\"}`;\n      case \"relationship_count\": {\n        const relMinPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const relMaxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${rule.relationshipKind || \"any\"} count ${relMinPart}${relMaxPart}`;\n      }\n      case \"relationship_exists\": {\n        const targetSuffix = rule.targetKind ? ` to ${rule.targetKind}` : \"\";\n        return `${rule.relationshipKind || \"?\"} exists${targetSuffix}`;\n      }\n      case \"tag_exists\":\n        return `has tag \"${rule.tag || \"?\"}\"`;\n      case \"tag_absent\":\n        return `missing tag \"${rule.tag || \"?\"}\"`;\n      case \"status\":\n        return rule.not ? `status != ${rule.status || \"?\"}` : `status = ${rule.status || \"?\"}`;\n      case \"prominence\":\n        return `prominence ${rule.min || \"?\"}-${rule.max || \"?\"}`;\n      case \"time_elapsed\":\n        return `${rule.minTicks || \"?\"} ticks since ${rule.since || \"updated\"}`;\n      case \"growth_phases_complete\": {\n        const eraSuffix = rule.eraId ? ` in ${rule.eraId}` : \"\";\n        return `${rule.minPhases ?? \"?\"} growth phases${eraSuffix}`;\n      }\n      case \"era_match\":\n        return rule.eras?.length ? rule.eras.join(\", \") : \"No eras selected\";\n      case \"random_chance\":\n        return `${Math.round((rule.chance ?? 0.5) * 100)}% chance`;\n      case \"cooldown_elapsed\":\n        return `${rule.cooldownTicks ?? \"?\"} ticks since last run`;\n      case \"creations_per_epoch\":\n        return `max ${rule.maxPerEpoch ?? \"?\"} per epoch`;\n      case \"graph_path\":\n        return `graph path (${rule.assert?.check || \"exists\"})`;\n      case \"entity_exists\":\n        return `entity ${rule.entity || \"?\"} exists`;\n      case \"entity_has_relationship\":\n        return `${rule.entity || \"?\"} has ${rule.relationshipKind || \"?\"} relationship`;\n      case \"or\":\n      case \"and\":\n        return `${rule.conditions?.length || 0} sub-rules`;\n      case \"always\":\n        return \"always\";\n      default:\n        return rule.type;\n    }\n  };\n\n  const isNested = rule.type === \"or\" || rule.type === \"and\";\n\n  return (\n    <div className=\"condition-card\">\n      <div className=\"condition-card-header\">\n        <div className=\"condition-card-type\">\n          <div\n            className=\"condition-card-icon\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n            style={{ '--arc-icon-bg': `${typeConfig.color || \"#3b82f6\"}20`, backgroundColor: 'var(--arc-icon-bg)' }}\n          >\n            {typeConfig.icon || \"\ud83d\udccb\"}\n          </div>\n          <div>\n            <div className=\"condition-card-label\">{typeConfig.label || rule.type}</div>\n            <div className=\"condition-card-summary\">{getSummary()}</div>\n          </div>\n        </div>\n        <div className=\"condition-card-actions\">\n          <button className=\"btn-icon\" onClick={() => setExpanded(!expanded)}>\n            {expanded ? \"^\" : \"v\"}\n          </button>\n          <button className=\"btn-icon btn-icon-danger\" onClick={onRemove}>\n            x\n          </button>\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"mt-lg\">\n          <div className=\"form-grid\">\n            {rule.type === \"entity_count\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={rule.kind}\n                  onChange={(v) => {\n                    updateField(\"kind\", v);\n                    if (rule.subtype) updateField(\"subtype\", undefined);\n                  }}\n                  options={entityKindOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Subtype (optional)\"\n                  value={rule.subtype || \"\"}\n                  onChange={(v) => updateField(\"subtype\", v || undefined)}\n                  options={[{ value: \"\", label: \"Any\" }, ...getSubtypesForKind(rule.kind)]}\n                  placeholder=\"Any\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure\"\n                  value={rule.pressureId}\n                  onChange={(v) => updateField(\"pressureId\", v)}\n                  options={pressureOptions}\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min Value\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"0\"\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max Value\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"100\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_any_above\" && (\n              <>\n                <div className=\"grid-col-full\">\n                  <ChipSelect\n                    label=\"Pressures\"\n                    value={rule.pressureIds || []}\n                    onChange={(v) => updateField(\"pressureIds\", v)}\n                    options={pressureOptions}\n                    placeholder=\"+ Add pressure\"\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Threshold\n                  <NumberInput\n                    value={rule.threshold}\n                    onChange={(v) => updateField(\"threshold\", v ?? 0)}\n                    min={-100}\n                    max={100}\n                    integer\n                    placeholder=\"50\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_compare\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure A\"\n                  value={rule.pressureA}\n                  onChange={(v) => updateField(\"pressureA\", v)}\n                  options={pressureOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Operator\"\n                  value={rule.operator || \">\"}\n                  onChange={(v) => updateField(\"operator\", v)}\n                  options={[\n                    { value: \">\", label: \">\" },\n                    { value: \">=\", label: \">=\" },\n                    { value: \"<\", label: \"<\" },\n                    { value: \"<=\", label: \"<=\" },\n                    { value: \"==\", label: \"==\" },\n                    { value: \"!=\", label: \"!=\" },\n                  ]}\n                />\n                <ReferenceDropdown\n                  label=\"Pressure B\"\n                  value={rule.pressureB}\n                  onChange={(v) => updateField(\"pressureB\", v)}\n                  options={pressureOptions}\n                />\n              </>\n            )}\n\n\n            {rule.type === \"era_match\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Eras\"\n                  value={rule.eras || []}\n                  onChange={(v) => updateField(\"eras\", v)}\n                  options={eraOptions}\n                  placeholder=\"+ Add era\"\n                />\n              </div>\n            )}\n\n            {rule.type === \"random_chance\" && (\n              <div className=\"form-group grid-col-full\">\n                <span className=\"label\">Chance (%)</span>\n                <div className=\"flex items-center gap-lg\">\n// ... (truncated)", "parameters": [{"name": "{\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}", "type": "{ rule: any; onChange: Function; onRemove: Function; schema: any; pressures: any[]; eras: any[]; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "button", "ReferenceDropdown", "NumberInput", "ChipSelect", "span", "input", "label", "TagSelector", "GraphPathEditor", "ApplicabilityRuleCard", "AddRuleButton"], "hookCalls": [{"name": "useState", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/index.js::ApplicabilityTab", "name": "ApplicabilityTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n */\nexport function ApplicabilityTab({ generator, onChange, schema, pressures, eras }) {\n  const rules = generator.applicability || [];\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Applicability Rules</div>\n        <div className=\"section-desc\">\n          Define when this generator is eligible to run. If no rules are defined, the generator will\n          always be eligible. Multiple top-level rules are combined with AND logic.\n        </div>\n\n        {rules.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2713</div>\n            <div className=\"empty-state-title\">No applicability rules</div>\n            <div className=\"empty-state-desc\">\n              This generator will always be eligible to run. Add rules to control when it activates.\n            </div>\n          </div>\n        ) : (\n          rules.map((rule, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={rule}\n              onChange={(updated) => {\n                const newRules = [...rules];\n                newRules[index] = updated;\n                onChange({ ...generator, applicability: newRules });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, applicability: rules.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              pressures={pressures}\n              eras={eras}\n            />\n          ))\n        )}\n\n        <AddRuleButton\n          onAdd={(type) => {\n            const newRule = createNewRule(type, pressures);\n            onChange({ ...generator, applicability: [...rules, newRule] });\n          }}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema, pressures, eras }", "type": "{ generator: any; onChange: Function; schema: any; pressures: any[]; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "AddRuleButton"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/cards/GeneratorListCard.jsx::GeneratorListCard", "name": "GeneratorListCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/cards/GeneratorListCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator to display\n * @param {Function} props.onClick - Callback when card is clicked\n * @param {Function} props.onToggle - Callback to toggle enabled state\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport function GeneratorListCard({ generator, onClick, onToggle, usageMap }) {\n  const isEnabled = generator.enabled !== false;\n\n  const summary = useMemo(() => {\n    const creates =\n      generator.creation?.map((c) => c.kind).filter((v, i, a) => a.indexOf(v) === i) || [];\n    const rels = generator.relationships?.length || 0;\n    const effects = generator.stateUpdates?.length || 0;\n    return { creates, rels, effects };\n  }, [generator]);\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"generator\", generator.id)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, generator.id]\n  );\n\n  const eraUsage = useMemo(() => {\n    if (!usageMap?.generators?.[generator.id]) return [];\n    return usageMap.generators[generator.id].eras || [];\n  }, [usageMap, generator.id]);\n\n  const errorCount = validation.invalidRefs.length;\n  const hasErrors = errorCount > 0;\n  const isOrphan = validation.isOrphan;\n\n  return (\n    <div\n      className={`card card-clickable ${!isEnabled ? \"card-disabled\" : \"\"} ${hasErrors ? \"card-error\" : \"\"} ${isOrphan && !hasErrors ? \"card-warning\" : \"\"}`}\n      onClick={onClick}\n      role=\"button\"\n      tabIndex={0}\n      onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }}\n    >\n      <div className=\"card-header\">\n        <div>\n          <div className=\"flex items-center gap-md\">\n            <span className=\"card-title\">{generator.name || generator.id}</span>\n            <ErrorBadge count={errorCount} />\n          </div>\n          <div className=\"card-id\">{generator.id}</div>\n        </div>\n        <EnableToggle\n          enabled={isEnabled}\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n        />\n      </div>\n\n      <div className=\"card-stats\">\n        <div className=\"card-stat\">\n          <span>\u2728</span> {generator.creation?.length || 0} creates\n        </div>\n        <div className=\"card-stat\">\n          <span>\ud83d\udd17</span> {summary.rels} rels\n        </div>\n        <div className=\"card-stat\">\n          <span>\u26a1</span> {summary.effects} effects\n        </div>\n      </div>\n\n      <div className=\"card-badges\">\n        {summary.creates.slice(0, 3).map((kind) => (\n          <span key={kind} className=\"badge badge-entity-kind\">\n            + {kind}\n          </span>\n        ))}\n      </div>\n\n      <EraBadges eras={eraUsage} />\n      {isOrphan && (\n        <div className=\"mt-md\">\n          <OrphanBadge isOrphan={isOrphan} />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onClick, onToggle, usageMap }", "type": "{ generator: any; onClick: Function; onToggle: Function; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "ErrorBadge", "div", "EnableToggle", "EraBadges", "OrphanBadge"], "hookCalls": [{"name": "useMemo", "count": 3}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "@the-canonry/shared-components", "specifiers": ["getElementValidation"], "category": "external"}, {"source": "../../shared", "specifiers": ["ErrorBadge", "OrphanBadge", "EraBadges", "EnableToggle"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/generators/cards/index.js::GeneratorListCard", "name": "GeneratorListCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/cards/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator to display\n * @param {Function} props.onClick - Callback when card is clicked\n * @param {Function} props.onToggle - Callback to toggle enabled state\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport function GeneratorListCard({ generator, onClick, onToggle, usageMap }) {\n  const isEnabled = generator.enabled !== false;\n\n  const summary = useMemo(() => {\n    const creates =\n      generator.creation?.map((c) => c.kind).filter((v, i, a) => a.indexOf(v) === i) || [];\n    const rels = generator.relationships?.length || 0;\n    const effects = generator.stateUpdates?.length || 0;\n    return { creates, rels, effects };\n  }, [generator]);\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"generator\", generator.id)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, generator.id]\n  );\n\n  const eraUsage = useMemo(() => {\n    if (!usageMap?.generators?.[generator.id]) return [];\n    return usageMap.generators[generator.id].eras || [];\n  }, [usageMap, generator.id]);\n\n  const errorCount = validation.invalidRefs.length;\n  const hasErrors = errorCount > 0;\n  const isOrphan = validation.isOrphan;\n\n  return (\n    <div\n      className={`card card-clickable ${!isEnabled ? \"card-disabled\" : \"\"} ${hasErrors ? \"card-error\" : \"\"} ${isOrphan && !hasErrors ? \"card-warning\" : \"\"}`}\n      onClick={onClick}\n      role=\"button\"\n      tabIndex={0}\n      onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }}\n    >\n      <div className=\"card-header\">\n        <div>\n          <div className=\"flex items-center gap-md\">\n            <span className=\"card-title\">{generator.name || generator.id}</span>\n            <ErrorBadge count={errorCount} />\n          </div>\n          <div className=\"card-id\">{generator.id}</div>\n        </div>\n        <EnableToggle\n          enabled={isEnabled}\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n        />\n      </div>\n\n      <div className=\"card-stats\">\n        <div className=\"card-stat\">\n          <span>\u2728</span> {generator.creation?.length || 0} creates\n        </div>\n        <div className=\"card-stat\">\n          <span>\ud83d\udd17</span> {summary.rels} rels\n        </div>\n        <div className=\"card-stat\">\n          <span>\u26a1</span> {summary.effects} effects\n        </div>\n      </div>\n\n      <div className=\"card-badges\">\n        {summary.creates.slice(0, 3).map((kind) => (\n          <span key={kind} className=\"badge badge-entity-kind\">\n            + {kind}\n          </span>\n        ))}\n      </div>\n\n      <EraBadges eras={eraUsage} />\n      {isOrphan && (\n        <div className=\"mt-md\">\n          <OrphanBadge isOrphan={isOrphan} />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onClick, onToggle, usageMap }", "type": "{ generator: any; onClick: Function; onToggle: Function; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "ErrorBadge", "div", "EnableToggle", "EraBadges", "OrphanBadge"], "hookCalls": [{"name": "useMemo", "count": 3}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/GraphPathEditor.jsx::GraphPathEditor", "name": "GraphPathEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/GraphPathEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.assert - The path assertion configuration\n * @param {Function} props.onChange - Callback when assertion changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function GraphPathEditor({ assert, onChange, schema, availableRefs }) {\n  const [showConstraintMenu, setShowConstraintMenu] = useState(false);\n\n  const assertion = assert || { check: \"exists\", path: [] };\n\n  const updateAssertion = (field, value) => {\n    onChange({ ...assertion, [field]: value });\n  };\n\n  const addStep = () => {\n    // Create with empty required fields - validation will flag them\n    const newStep = { via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" };\n    updateAssertion(\"path\", [...(assertion.path || []), newStep]);\n  };\n\n  const updateStep = (index, updated) => {\n    const newPath = [...(assertion.path || [])];\n    newPath[index] = updated;\n    updateAssertion(\"path\", newPath);\n  };\n\n  const removeStep = (index) => {\n    updateAssertion(\n      \"path\",\n      (assertion.path || []).filter((_, i) => i !== index)\n    );\n  };\n\n  const addConstraint = (type) => {\n    const newConstraint = { type };\n    if (type === \"has_relationship\" || type === \"lacks_relationship\") {\n      newConstraint.direction = \"any\";\n    }\n    updateAssertion(\"where\", [...(assertion.where || []), newConstraint]);\n    setShowConstraintMenu(false);\n  };\n\n  const updateConstraint = (index, updated) => {\n    const newWhere = [...(assertion.where || [])];\n    newWhere[index] = updated;\n    updateAssertion(\"where\", newWhere);\n  };\n\n  const removeConstraint = (index) => {\n    const newWhere = (assertion.where || []).filter((_, i) => i !== index);\n    updateAssertion(\"where\", newWhere.length > 0 ? newWhere : undefined);\n  };\n\n  // Collect variables from path steps for constraint references\n  const pathVars = (assertion.path || []).filter((s) => s.as).map((s) => s.as);\n  const allRefs = [...(availableRefs || []), ...pathVars];\n\n  return (\n    <div className=\"graph-path-editor\">\n      {/* Check type and count */}\n      <div className=\"path-editor-grid\">\n        <div>\n          <label className=\"label label-tiny\">Check Type\n          <ReferenceDropdown\n            value={assertion.check || \"exists\"}\n            onChange={(v) => updateAssertion(\"check\", v)}\n            options={PATH_CHECK_TYPES}\n          />\n          </label>\n        </div>\n        {(assertion.check === \"count_min\" || assertion.check === \"count_max\") && (\n          <div>\n            <label className=\"label label-tiny\">Count\n            <NumberInput\n              value={assertion.count ?? 1}\n              onChange={(v) => updateAssertion(\"count\", v ?? 1)}\n              min={0}\n              integer\n              className=\"input input-compact\"\n            />\n            </label>\n          </div>\n        )}\n      </div>\n\n      {/* Path steps */}\n      <div>\n        <span className=\"label label-tiny\">Path Steps (traverse relationships)</span>\n        <div className=\"path-steps-list\">\n          {(assertion.path || []).map((step, index) => (\n            <PathStepEditor\n              key={index}\n              step={step}\n              onChange={(updated) => updateStep(index, updated)}\n              onRemove={() => removeStep(index)}\n              schema={schema}\n              stepIndex={index}\n            />\n          ))}\n          {(assertion.path || []).length < 2 && (\n            <button onClick={addStep} className=\"button button-add-step\">\n              + Add Step {(assertion.path || []).length === 0 ? \"(required)\" : \"(optional)\"}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Where constraints */}\n      <div>\n        <span className=\"label label-tiny\">Where Constraints (optional)</span>\n        <div className=\"path-constraints-list\">\n          {(assertion.where || []).map((constraint, index) => (\n            <PathConstraintEditor\n              key={index}\n              constraint={constraint}\n              onChange={(updated) => updateConstraint(index, updated)}\n              onRemove={() => removeConstraint(index)}\n              schema={schema}\n              availableRefs={allRefs}\n            />\n          ))}\n          <div className=\"relative\">\n            <button\n              onClick={() => setShowConstraintMenu(!showConstraintMenu)}\n              className=\"button button-add-constraint\"\n            >\n              + Add Constraint\n            </button>\n            {showConstraintMenu && (\n              <div className=\"dropdown-menu\">\n                {PATH_CONSTRAINT_TYPES.map(({ value, label }) => (\n                  <div\n                    key={value}\n                    onClick={() => addConstraint(value)}\n                    className=\"dropdown-menu-item\"\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    {label}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ assert, onChange, schema, availableRefs }", "type": "{ assert: any; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["ReferenceDropdown", "NumberInput", "span", "PathStepEditor", "button", "PathConstraintEditor", "div"], "hookCalls": [{"name": "useState", "count": 1}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["PATH_CHECK_TYPES", "PATH_CONSTRAINT_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput"], "category": "internal"}, {"source": "./PathStepEditor", "specifiers": ["PathStepEditor"], "category": "internal"}, {"source": "./PathConstraintEditor", "specifiers": ["PathConstraintEditor"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/index.js::PathStepEditor", "name": "PathStepEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.step - The path step configuration\n * @param {Function} props.onChange - Callback when step changes\n * @param {Function} props.onRemove - Callback to remove this step\n * @param {Object} props.schema - Domain schema\n * @param {number} props.stepIndex - Index of this step in the path\n */\nexport function PathStepEditor({ step, onChange, onRemove, schema, stepIndex }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKindOptions = [\n    { value: \"any\", label: \"Any kind\" },\n    ...(schema?.entityKinds || []).map((ek) => ({\n      value: ek.kind,\n      label: ek.description || ek.kind,\n    })),\n  ];\n\n  const getSubtypeOptions = (kind) => {\n    if (!kind || kind === \"any\") return [{ value: \"any\", label: \"Any subtype\" }];\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [{ value: \"any\", label: \"Any subtype\" }];\n    return [\n      { value: \"any\", label: \"Any subtype\" },\n      ...ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id })),\n    ];\n  };\n\n  const updateStep = (field, value) => {\n    onChange({ ...step, [field]: value });\n  };\n\n  return (\n    <div className=\"path-step-card\">\n      <div className=\"path-step-header\">\n        <span className=\"path-step-label\">Step {stepIndex + 1}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      <div className=\"path-step-grid\">\n        <div>\n          <label className=\"label label-micro\">Via Relationship\n          <ReferenceDropdown\n            value={step.via || \"\"}\n            onChange={(v) => updateStep(\"via\", v)}\n            options={relationshipKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Direction\n          <ReferenceDropdown\n            value={step.direction || \"any\"}\n            onChange={(v) => updateStep(\"direction\", v)}\n            options={PATH_DIRECTIONS}\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Kind\n          <ReferenceDropdown\n            value={step.targetKind}\n            onChange={(v) => updateStep(\"targetKind\", v)}\n            options={entityKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Subtype\n          <ReferenceDropdown\n            value={step.targetSubtype}\n            onChange={(v) => updateStep(\"targetSubtype\", v)}\n            options={getSubtypeOptions(step.targetKind)}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div className=\"path-step-full-width\">\n          <label htmlFor=\"store-as-variable-optional\" className=\"label label-micro\">Store As Variable (optional)</label>\n          <input id=\"store-as-variable-optional\"\n            type=\"text\"\n            value={step.as || \"\"}\n            onChange={(e) => updateStep(\"as\", e.target.value)}\n            className=\"input input-micro\"\n            placeholder=\"e.g. $allies\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ step, onChange, onRemove, schema, stepIndex }", "type": "{ step: any; onChange: Function; onRemove: Function; schema: any; stepIndex: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "button", "ReferenceDropdown", "label", "input"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/index.js::PathConstraintEditor", "name": "PathConstraintEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.constraint - The path constraint configuration\n * @param {Function} props.onChange - Callback when constraint changes\n * @param {Function} props.onRemove - Callback to remove this constraint\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function PathConstraintEditor({ constraint, onChange, onRemove, schema, availableRefs }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  // Gather all subtypes from all entity kinds for subtype_equals constraint\n  const allSubtypeOptions = entityKinds.flatMap((ek) =>\n    (ek.subtypes || []).map((st) => ({\n      value: st.id,\n      label: `${st.name || st.id} (${ek.kind})`,\n    }))\n  );\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateConstraint = (field, value) => {\n    onChange({ ...constraint, [field]: value || undefined });\n  };\n\n  const renderConstraintFields = () => {\n    switch (constraint.type) {\n      case \"not_self\":\n        return <span className=\"text-muted text-small\">Target cannot be the starting entity</span>;\n\n      case \"not_in\":\n      case \"in\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Set Variable\n            <ReferenceDropdown\n              value={constraint.set || \"\"}\n              onChange={(v) => updateConstraint(\"set\", v)}\n              options={refOptions}\n              placeholder=\"e.g. $allies\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"kind_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Entity Kind\n            <ReferenceDropdown\n              value={constraint.kind || \"\"}\n              onChange={(v) => updateConstraint(\"kind\", v)}\n              options={entityKindOptions}\n            />\n            </label>\n          </div>\n        );\n\n      case \"subtype_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Subtype\n            <ReferenceDropdown\n              value={constraint.subtype || \"\"}\n              onChange={(v) => updateConstraint(\"subtype\", v)}\n              options={allSubtypeOptions}\n              placeholder=\"Select subtype...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"constraint-fields-grid\">\n            <div>\n              <label className=\"label label-micro\">Kind\n              <ReferenceDropdown\n                value={constraint.kind || \"\"}\n                onChange={(v) => updateConstraint(\"kind\", v)}\n                options={relationshipKindOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">With\n              <ReferenceDropdown\n                value={constraint.with || \"\"}\n                onChange={(v) => updateConstraint(\"with\", v)}\n                options={refOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">Direction\n              <ReferenceDropdown\n                value={constraint.direction || \"any\"}\n                onChange={(v) => updateConstraint(\"direction\", v)}\n                options={PATH_DIRECTIONS}\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  const constraintLabel =\n    PATH_CONSTRAINT_TYPES.find((c) => c.value === constraint.type)?.label || constraint.type;\n\n  return (\n    <div className=\"path-constraint-card\">\n      <div className=\"path-constraint-header\">\n        <span className=\"path-constraint-label\">{constraintLabel}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      {renderConstraintFields()}\n    </div>\n  );\n}", "parameters": [{"name": "{ constraint, onChange, onRemove, schema, availableRefs }", "type": "{ constraint: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/index.js::GraphPathEditor", "name": "GraphPathEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.assert - The path assertion configuration\n * @param {Function} props.onChange - Callback when assertion changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function GraphPathEditor({ assert, onChange, schema, availableRefs }) {\n  const [showConstraintMenu, setShowConstraintMenu] = useState(false);\n\n  const assertion = assert || { check: \"exists\", path: [] };\n\n  const updateAssertion = (field, value) => {\n    onChange({ ...assertion, [field]: value });\n  };\n\n  const addStep = () => {\n    // Create with empty required fields - validation will flag them\n    const newStep = { via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" };\n    updateAssertion(\"path\", [...(assertion.path || []), newStep]);\n  };\n\n  const updateStep = (index, updated) => {\n    const newPath = [...(assertion.path || [])];\n    newPath[index] = updated;\n    updateAssertion(\"path\", newPath);\n  };\n\n  const removeStep = (index) => {\n    updateAssertion(\n      \"path\",\n      (assertion.path || []).filter((_, i) => i !== index)\n    );\n  };\n\n  const addConstraint = (type) => {\n    const newConstraint = { type };\n    if (type === \"has_relationship\" || type === \"lacks_relationship\") {\n      newConstraint.direction = \"any\";\n    }\n    updateAssertion(\"where\", [...(assertion.where || []), newConstraint]);\n    setShowConstraintMenu(false);\n  };\n\n  const updateConstraint = (index, updated) => {\n    const newWhere = [...(assertion.where || [])];\n    newWhere[index] = updated;\n    updateAssertion(\"where\", newWhere);\n  };\n\n  const removeConstraint = (index) => {\n    const newWhere = (assertion.where || []).filter((_, i) => i !== index);\n    updateAssertion(\"where\", newWhere.length > 0 ? newWhere : undefined);\n  };\n\n  // Collect variables from path steps for constraint references\n  const pathVars = (assertion.path || []).filter((s) => s.as).map((s) => s.as);\n  const allRefs = [...(availableRefs || []), ...pathVars];\n\n  return (\n    <div className=\"graph-path-editor\">\n      {/* Check type and count */}\n      <div className=\"path-editor-grid\">\n        <div>\n          <label className=\"label label-tiny\">Check Type\n          <ReferenceDropdown\n            value={assertion.check || \"exists\"}\n            onChange={(v) => updateAssertion(\"check\", v)}\n            options={PATH_CHECK_TYPES}\n          />\n          </label>\n        </div>\n        {(assertion.check === \"count_min\" || assertion.check === \"count_max\") && (\n          <div>\n            <label className=\"label label-tiny\">Count\n            <NumberInput\n              value={assertion.count ?? 1}\n              onChange={(v) => updateAssertion(\"count\", v ?? 1)}\n              min={0}\n              integer\n              className=\"input input-compact\"\n            />\n            </label>\n          </div>\n        )}\n      </div>\n\n      {/* Path steps */}\n      <div>\n        <span className=\"label label-tiny\">Path Steps (traverse relationships)</span>\n        <div className=\"path-steps-list\">\n          {(assertion.path || []).map((step, index) => (\n            <PathStepEditor\n              key={index}\n              step={step}\n              onChange={(updated) => updateStep(index, updated)}\n              onRemove={() => removeStep(index)}\n              schema={schema}\n              stepIndex={index}\n            />\n          ))}\n          {(assertion.path || []).length < 2 && (\n            <button onClick={addStep} className=\"button button-add-step\">\n              + Add Step {(assertion.path || []).length === 0 ? \"(required)\" : \"(optional)\"}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Where constraints */}\n      <div>\n        <span className=\"label label-tiny\">Where Constraints (optional)</span>\n        <div className=\"path-constraints-list\">\n          {(assertion.where || []).map((constraint, index) => (\n            <PathConstraintEditor\n              key={index}\n              constraint={constraint}\n              onChange={(updated) => updateConstraint(index, updated)}\n              onRemove={() => removeConstraint(index)}\n              schema={schema}\n              availableRefs={allRefs}\n            />\n          ))}\n          <div className=\"relative\">\n            <button\n              onClick={() => setShowConstraintMenu(!showConstraintMenu)}\n              className=\"button button-add-constraint\"\n            >\n              + Add Constraint\n            </button>\n            {showConstraintMenu && (\n              <div className=\"dropdown-menu\">\n                {PATH_CONSTRAINT_TYPES.map(({ value, label }) => (\n                  <div\n                    key={value}\n                    onClick={() => addConstraint(value)}\n                    className=\"dropdown-menu-item\"\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    {label}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ assert, onChange, schema, availableRefs }", "type": "{ assert: any; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["ReferenceDropdown", "NumberInput", "span", "PathStepEditor", "button", "PathConstraintEditor", "div"], "hookCalls": [{"name": "useState", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/index.js::SelectionFilterCard", "name": "SelectionFilterCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.filter - The filter configuration\n * @param {Function} props.onChange - Callback when filter changes\n * @param {Function} props.onRemove - Callback to remove this filter\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFilterCard({ filter, onChange, onRemove, schema, availableRefs }) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = FILTER_TYPES[filter.type] || {\n    label: filter.type,\n    icon: \"\u2753\",\n    color: \"#6b7280\",\n  };\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateFilter = (field, value) => {\n    onChange({ ...filter, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (filter.type) {\n      case \"has_tag\": {\n        const valueSuffix = filter.value !== undefined ? ` = ${filter.value}` : \"\";\n        return `${filter.tag || \"?\"}${valueSuffix}`;\n      }\n      case \"has_tags\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"lacks_tag\":\n        return filter.tag || \"tag?\";\n      case \"lacks_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_culture\":\n        return filter.culture || \"culture?\";\n      case \"matches_culture\":\n        return `with ${filter.with || \"?\"}`;\n      case \"has_status\":\n        return filter.status || \"status?\";\n      case \"has_prominence\":\n        return filter.minProminence || \"prominence?\";\n      case \"has_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        const direction = filter.direction ? ` [${filter.direction}]` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}${direction}`;\n      }\n      case \"lacks_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}`;\n      }\n      case \"exclude\":\n        return `${(filter.entities || []).length} excluded`;\n      case \"shares_related\":\n        return `${filter.relationshipKind || \"?\"} with ${filter.with || \"?\"}`;\n      case \"graph_path\":\n        return `graph path (${filter.assert?.check || \"exists\"})`;\n      default:\n        return \"\";\n    }\n  };\n\n  const summary = getSummary();\n\n  const renderFilterFields = () => {\n    switch (filter.type) {\n      case \"has_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"has_tags\":\n      case \"has_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">\n              {filter.type === \"has_tags\" ? \"Tags (must have ALL)\" : \"Tags (must have at least ONE)\"}\n            </label>\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n          </div>\n        );\n\n      case \"lacks_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"lacks_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">Tags (exclude if has ANY)\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n        );\n\n\n      case \"has_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Culture\n            <ReferenceDropdown\n              value={filter.culture || \"\"}\n              onChange={(v) => updateFilter(\"culture\", v)}\n              options={(schema?.cultures || []).map((c) => ({\n                value: c.id,\n                label: c.name || c.id,\n              }))}\n              placeholder=\"Select culture...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"matches_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Same Culture As\n            <ReferenceDropdown\n              value={filter.with || \"\"}\n              onChange={(v) => updateFilter(\"with\", v)}\n              options={refOptions}\n              placeholder=\"Select variable...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_status\":\n        return (\n          <div>\n            <label htmlFor=\"status\" className=\"label label-small\">Status</label>\n            <input id=\"status\"\n              type=\"text\"\n              value={filter.status || \"\"}\n              onChange={(e) => updateFilter(\"status\", e.target.value)}\n              className=\"input input-compact\"\n              placeholder=\"e.g., active, historical\"\n            />\n          </div>\n        );\n\n      case \"has_prominence\":\n        return (\n          <div>\n            <label className=\"label label-small\">Minimum Prominence\n            <ReferenceDropdown\n              value={filter.minProminence || \"\"}\n              onChange={(v) => updateFilter(\"minProminence\", v)}\n              options={PROMINENCE_LEVELS.map((p) => ({ value: p.value, label: p.label }))}\n              placeholder=\"Select prominence...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Relationship Kind\n              <ReferenceDropdown\n                value={filter.kind || \"\"}\n                onChange={(v) => updateFilter(\"kind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity (optional)\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v || undefined)}\n                options={refOptions}\n                placeholder=\"Any entity\"\n              />\n              </label>\n            </div>\n            {filter.type === \"has_relationship\" && (\n              <div className=\"sfc-flex-field-tiny\">\n                <label className=\"label label-small\">Direction\n                <ReferenceDropdown\n                  value={filter.direction || \"both\"}\n                  onChange={(v) => updateFilter(\"direction\", v)}\n                  options={[\n                    { value: \"both\", label: \"Both\" },\n                    { value: \"src\", label: \"Outgoing\" },\n                    { value: \"dst\", label: \"Incoming\" },\n                  ]}\n                />\n                </label>\n              </div>\n            )}\n          </div>\n        );\n\n      case \"exclude\":\n        return (\n          <ChipSelect\n            label=\"Entities to Exclude\"\n            value={filter.entities || []}\n            onChange={(v) => updateFilter(\"entities\", v)}\n            options={refOptions}\n            placeholder=\"+ Add variable...\"\n          />\n        );\n\n      case \"shares_related\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Via Relationship\n              <ReferenceDropdown\n                value={filter.relationshipKind || \"\"}\n                onChange={(v) => updateFilter(\"relationshipKind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v)}\n                options={refOptions}\n                placeholder=\"Select variable...\"\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      case \"graph_path\":\n// ... (truncated)", "parameters": [{"name": "{ filter, onChange, onRemove, schema, availableRefs }", "type": "{ filter: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["TagSelector", "label", "input"], "hookCalls": [{"name": "useState", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/index.js::SelectionFiltersEditor", "name": "SelectionFiltersEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.filters - Array of filter configurations\n * @param {Function} props.onChange - Callback when filters change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFiltersEditor({ filters, onChange, schema, availableRefs }) {\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const containerRef = useRef(null);\n\n  // Calculate dropdown position when opening (like TagSelector)\n  useLayoutEffect(() => {\n    if (showTypeMenu && containerRef.current) {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  const handleAddFilter = (type) => {\n    // Create with empty required fields - validation will flag them\n    const newFilter = { type };\n    // Tag filters\n    if (type === \"has_tag\") newFilter.tag = \"\";\n    if (type === \"has_tags\") newFilter.tags = [];\n    if (type === \"has_any_tag\") newFilter.tags = [];\n    if (type === \"lacks_tag\") newFilter.tag = \"\";\n    if (type === \"lacks_any_tag\") newFilter.tags = [];\n    // Attribute filters\n    if (type === \"has_culture\") newFilter.culture = \"\";\n    if (type === \"matches_culture\") newFilter.with = \"\";\n    if (type === \"has_status\") newFilter.status = \"\";\n    if (type === \"has_prominence\") newFilter.minProminence = \"\";\n    // Relationship filters\n    if (type === \"has_relationship\") newFilter.kind = \"\";\n    if (type === \"lacks_relationship\") newFilter.kind = \"\";\n    if (type === \"shares_related\") {\n      newFilter.relationshipKind = \"\";\n      newFilter.with = \"\";\n    }\n    // Other\n    if (type === \"exclude\") newFilter.entities = [];\n    if (type === \"graph_path\")\n      newFilter.assert = {\n        check: \"\",\n        path: [{ via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" }],\n      };\n    onChange([...(filters || []), newFilter]);\n    setShowTypeMenu(false);\n  };\n\n  const handleUpdateFilter = (index, updated) => {\n    const newFilters = [...(filters || [])];\n    newFilters[index] = updated;\n    onChange(newFilters);\n  };\n\n  const handleRemoveFilter = (index) => {\n    onChange((filters || []).filter((_, i) => i !== index));\n  };\n\n  return (\n    <div>\n      {(filters || []).length === 0 ? (\n        <div className=\"empty-state-compact\">\n          No filters defined. Filters narrow down which entities can be selected as targets.\n        </div>\n      ) : (\n        <div className=\"condition-list\">\n          {(filters || []).map((filter, index) => (\n            <SelectionFilterCard\n              key={index}\n              filter={filter}\n              onChange={(updated) => handleUpdateFilter(index, updated)}\n              onRemove={() => handleRemoveFilter(index)}\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))}\n        </div>\n      )}\n\n      <div ref={containerRef} className=\"relative mt-lg\">\n        <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n          + Add Filter\n        </button>\n\n        {showTypeMenu && (\n          <div\n            className=\"dropdown-menu sfe-dropdown-fixed\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n            style={{ '--sfe-dd-top': `${dropdownPos.top}px`, '--sfe-dd-left': `${dropdownPos.left}px`, '--sfe-dd-width': `${dropdownPos.width}px`, top: 'var(--sfe-dd-top)', left: 'var(--sfe-dd-left)', width: 'var(--sfe-dd-width)' }}\n          >\n            {Object.entries(FILTER_TYPES).map(([type, config]) => (\n              <div key={type} onClick={() => handleAddFilter(type)} className=\"dropdown-menu-item\" role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n                <span\n                  className=\"dropdown-menu-icon\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per filter type\n                  style={{ '--sfe-icon-bg': `${config.color}20`, backgroundColor: 'var(--sfe-icon-bg)' }}\n                >\n                  {config.icon}\n                </span>\n                <span className=\"dropdown-menu-label\">{config.label}</span>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ filters, onChange, schema, availableRefs }", "type": "{ filters: any[]; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "SelectionFilterCard", "button", "span"], "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/PathConstraintEditor.jsx::PathConstraintEditor", "name": "PathConstraintEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/PathConstraintEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.constraint - The path constraint configuration\n * @param {Function} props.onChange - Callback when constraint changes\n * @param {Function} props.onRemove - Callback to remove this constraint\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function PathConstraintEditor({ constraint, onChange, onRemove, schema, availableRefs }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  // Gather all subtypes from all entity kinds for subtype_equals constraint\n  const allSubtypeOptions = entityKinds.flatMap((ek) =>\n    (ek.subtypes || []).map((st) => ({\n      value: st.id,\n      label: `${st.name || st.id} (${ek.kind})`,\n    }))\n  );\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateConstraint = (field, value) => {\n    onChange({ ...constraint, [field]: value || undefined });\n  };\n\n  const renderConstraintFields = () => {\n    switch (constraint.type) {\n      case \"not_self\":\n        return <span className=\"text-muted text-small\">Target cannot be the starting entity</span>;\n\n      case \"not_in\":\n      case \"in\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Set Variable\n            <ReferenceDropdown\n              value={constraint.set || \"\"}\n              onChange={(v) => updateConstraint(\"set\", v)}\n              options={refOptions}\n              placeholder=\"e.g. $allies\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"kind_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Entity Kind\n            <ReferenceDropdown\n              value={constraint.kind || \"\"}\n              onChange={(v) => updateConstraint(\"kind\", v)}\n              options={entityKindOptions}\n            />\n            </label>\n          </div>\n        );\n\n      case \"subtype_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Subtype\n            <ReferenceDropdown\n              value={constraint.subtype || \"\"}\n              onChange={(v) => updateConstraint(\"subtype\", v)}\n              options={allSubtypeOptions}\n              placeholder=\"Select subtype...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"constraint-fields-grid\">\n            <div>\n              <label className=\"label label-micro\">Kind\n              <ReferenceDropdown\n                value={constraint.kind || \"\"}\n                onChange={(v) => updateConstraint(\"kind\", v)}\n                options={relationshipKindOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">With\n              <ReferenceDropdown\n                value={constraint.with || \"\"}\n                onChange={(v) => updateConstraint(\"with\", v)}\n                options={refOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">Direction\n              <ReferenceDropdown\n                value={constraint.direction || \"any\"}\n                onChange={(v) => updateConstraint(\"direction\", v)}\n                options={PATH_DIRECTIONS}\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  const constraintLabel =\n    PATH_CONSTRAINT_TYPES.find((c) => c.value === constraint.type)?.label || constraint.type;\n\n  return (\n    <div className=\"path-constraint-card\">\n      <div className=\"path-constraint-header\">\n        <span className=\"path-constraint-label\">{constraintLabel}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      {renderConstraintFields()}\n    </div>\n  );\n}", "parameters": [{"name": "{ constraint, onChange, onRemove, schema, availableRefs }", "type": "{ constraint: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span"], "hookCalls": [], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["PATH_DIRECTIONS", "PATH_CONSTRAINT_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/PathStepEditor.jsx::PathStepEditor", "name": "PathStepEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/PathStepEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.step - The path step configuration\n * @param {Function} props.onChange - Callback when step changes\n * @param {Function} props.onRemove - Callback to remove this step\n * @param {Object} props.schema - Domain schema\n * @param {number} props.stepIndex - Index of this step in the path\n */\nexport function PathStepEditor({ step, onChange, onRemove, schema, stepIndex }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKindOptions = [\n    { value: \"any\", label: \"Any kind\" },\n    ...(schema?.entityKinds || []).map((ek) => ({\n      value: ek.kind,\n      label: ek.description || ek.kind,\n    })),\n  ];\n\n  const getSubtypeOptions = (kind) => {\n    if (!kind || kind === \"any\") return [{ value: \"any\", label: \"Any subtype\" }];\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [{ value: \"any\", label: \"Any subtype\" }];\n    return [\n      { value: \"any\", label: \"Any subtype\" },\n      ...ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id })),\n    ];\n  };\n\n  const updateStep = (field, value) => {\n    onChange({ ...step, [field]: value });\n  };\n\n  return (\n    <div className=\"path-step-card\">\n      <div className=\"path-step-header\">\n        <span className=\"path-step-label\">Step {stepIndex + 1}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      <div className=\"path-step-grid\">\n        <div>\n          <label className=\"label label-micro\">Via Relationship\n          <ReferenceDropdown\n            value={step.via || \"\"}\n            onChange={(v) => updateStep(\"via\", v)}\n            options={relationshipKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Direction\n          <ReferenceDropdown\n            value={step.direction || \"any\"}\n            onChange={(v) => updateStep(\"direction\", v)}\n            options={PATH_DIRECTIONS}\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Kind\n          <ReferenceDropdown\n            value={step.targetKind}\n            onChange={(v) => updateStep(\"targetKind\", v)}\n            options={entityKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Subtype\n          <ReferenceDropdown\n            value={step.targetSubtype}\n            onChange={(v) => updateStep(\"targetSubtype\", v)}\n            options={getSubtypeOptions(step.targetKind)}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div className=\"path-step-full-width\">\n          <label htmlFor=\"store-as-variable-optional\" className=\"label label-micro\">Store As Variable (optional)</label>\n          <input id=\"store-as-variable-optional\"\n            type=\"text\"\n            value={step.as || \"\"}\n            onChange={(e) => updateStep(\"as\", e.target.value)}\n            className=\"input input-micro\"\n            placeholder=\"e.g. $allies\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ step, onChange, onRemove, schema, stepIndex }", "type": "{ step: any; onChange: Function; onRemove: Function; schema: any; stepIndex: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "button", "ReferenceDropdown", "label", "input"], "hookCalls": [], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["PATH_DIRECTIONS"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFilterCard.jsx::SelectionFilterCard", "name": "SelectionFilterCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFilterCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.filter - The filter configuration\n * @param {Function} props.onChange - Callback when filter changes\n * @param {Function} props.onRemove - Callback to remove this filter\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFilterCard({ filter, onChange, onRemove, schema, availableRefs }) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = FILTER_TYPES[filter.type] || {\n    label: filter.type,\n    icon: \"\u2753\",\n    color: \"#6b7280\",\n  };\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateFilter = (field, value) => {\n    onChange({ ...filter, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (filter.type) {\n      case \"has_tag\": {\n        const valueSuffix = filter.value !== undefined ? ` = ${filter.value}` : \"\";\n        return `${filter.tag || \"?\"}${valueSuffix}`;\n      }\n      case \"has_tags\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"lacks_tag\":\n        return filter.tag || \"tag?\";\n      case \"lacks_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_culture\":\n        return filter.culture || \"culture?\";\n      case \"matches_culture\":\n        return `with ${filter.with || \"?\"}`;\n      case \"has_status\":\n        return filter.status || \"status?\";\n      case \"has_prominence\":\n        return filter.minProminence || \"prominence?\";\n      case \"has_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        const direction = filter.direction ? ` [${filter.direction}]` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}${direction}`;\n      }\n      case \"lacks_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}`;\n      }\n      case \"exclude\":\n        return `${(filter.entities || []).length} excluded`;\n      case \"shares_related\":\n        return `${filter.relationshipKind || \"?\"} with ${filter.with || \"?\"}`;\n      case \"graph_path\":\n        return `graph path (${filter.assert?.check || \"exists\"})`;\n      default:\n        return \"\";\n    }\n  };\n\n  const summary = getSummary();\n\n  const renderFilterFields = () => {\n    switch (filter.type) {\n      case \"has_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"has_tags\":\n      case \"has_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">\n              {filter.type === \"has_tags\" ? \"Tags (must have ALL)\" : \"Tags (must have at least ONE)\"}\n            </label>\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n          </div>\n        );\n\n      case \"lacks_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"lacks_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">Tags (exclude if has ANY)\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n        );\n\n\n      case \"has_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Culture\n            <ReferenceDropdown\n              value={filter.culture || \"\"}\n              onChange={(v) => updateFilter(\"culture\", v)}\n              options={(schema?.cultures || []).map((c) => ({\n                value: c.id,\n                label: c.name || c.id,\n              }))}\n              placeholder=\"Select culture...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"matches_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Same Culture As\n            <ReferenceDropdown\n              value={filter.with || \"\"}\n              onChange={(v) => updateFilter(\"with\", v)}\n              options={refOptions}\n              placeholder=\"Select variable...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_status\":\n        return (\n          <div>\n            <label htmlFor=\"status\" className=\"label label-small\">Status</label>\n            <input id=\"status\"\n              type=\"text\"\n              value={filter.status || \"\"}\n              onChange={(e) => updateFilter(\"status\", e.target.value)}\n              className=\"input input-compact\"\n              placeholder=\"e.g., active, historical\"\n            />\n          </div>\n        );\n\n      case \"has_prominence\":\n        return (\n          <div>\n            <label className=\"label label-small\">Minimum Prominence\n            <ReferenceDropdown\n              value={filter.minProminence || \"\"}\n              onChange={(v) => updateFilter(\"minProminence\", v)}\n              options={PROMINENCE_LEVELS.map((p) => ({ value: p.value, label: p.label }))}\n              placeholder=\"Select prominence...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Relationship Kind\n              <ReferenceDropdown\n                value={filter.kind || \"\"}\n                onChange={(v) => updateFilter(\"kind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity (optional)\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v || undefined)}\n                options={refOptions}\n                placeholder=\"Any entity\"\n              />\n              </label>\n            </div>\n            {filter.type === \"has_relationship\" && (\n              <div className=\"sfc-flex-field-tiny\">\n                <label className=\"label label-small\">Direction\n                <ReferenceDropdown\n                  value={filter.direction || \"both\"}\n                  onChange={(v) => updateFilter(\"direction\", v)}\n                  options={[\n                    { value: \"both\", label: \"Both\" },\n                    { value: \"src\", label: \"Outgoing\" },\n                    { value: \"dst\", label: \"Incoming\" },\n                  ]}\n                />\n                </label>\n              </div>\n            )}\n          </div>\n        );\n\n      case \"exclude\":\n        return (\n          <ChipSelect\n            label=\"Entities to Exclude\"\n            value={filter.entities || []}\n            onChange={(v) => updateFilter(\"entities\", v)}\n            options={refOptions}\n            placeholder=\"+ Add variable...\"\n          />\n        );\n\n      case \"shares_related\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Via Relationship\n              <ReferenceDropdown\n                value={filter.relationshipKind || \"\"}\n                onChange={(v) => updateFilter(\"relationshipKind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v)}\n                options={refOptions}\n                placeholder=\"Select variable...\"\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      case \"graph_path\":\n// ... (truncated)", "parameters": [{"name": "{ filter, onChange, onRemove, schema, availableRefs }", "type": "{ filter: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["TagSelector", "label", "input"], "hookCalls": [{"name": "useState", "count": 1}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["FILTER_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "ChipSelect", "PROMINENCE_LEVELS"], "category": "internal"}, {"source": "./GraphPathEditor", "specifiers": ["GraphPathEditor"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}, {"source": "./SelectionFilterCard.css", "specifiers": [], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFiltersEditor.jsx::SelectionFiltersEditor", "name": "SelectionFiltersEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFiltersEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.filters - Array of filter configurations\n * @param {Function} props.onChange - Callback when filters change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFiltersEditor({ filters, onChange, schema, availableRefs }) {\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const containerRef = useRef(null);\n\n  // Calculate dropdown position when opening (like TagSelector)\n  useLayoutEffect(() => {\n    if (showTypeMenu && containerRef.current) {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  const handleAddFilter = (type) => {\n    // Create with empty required fields - validation will flag them\n    const newFilter = { type };\n    // Tag filters\n    if (type === \"has_tag\") newFilter.tag = \"\";\n    if (type === \"has_tags\") newFilter.tags = [];\n    if (type === \"has_any_tag\") newFilter.tags = [];\n    if (type === \"lacks_tag\") newFilter.tag = \"\";\n    if (type === \"lacks_any_tag\") newFilter.tags = [];\n    // Attribute filters\n    if (type === \"has_culture\") newFilter.culture = \"\";\n    if (type === \"matches_culture\") newFilter.with = \"\";\n    if (type === \"has_status\") newFilter.status = \"\";\n    if (type === \"has_prominence\") newFilter.minProminence = \"\";\n    // Relationship filters\n    if (type === \"has_relationship\") newFilter.kind = \"\";\n    if (type === \"lacks_relationship\") newFilter.kind = \"\";\n    if (type === \"shares_related\") {\n      newFilter.relationshipKind = \"\";\n      newFilter.with = \"\";\n    }\n    // Other\n    if (type === \"exclude\") newFilter.entities = [];\n    if (type === \"graph_path\")\n      newFilter.assert = {\n        check: \"\",\n        path: [{ via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" }],\n      };\n    onChange([...(filters || []), newFilter]);\n    setShowTypeMenu(false);\n  };\n\n  const handleUpdateFilter = (index, updated) => {\n    const newFilters = [...(filters || [])];\n    newFilters[index] = updated;\n    onChange(newFilters);\n  };\n\n  const handleRemoveFilter = (index) => {\n    onChange((filters || []).filter((_, i) => i !== index));\n  };\n\n  return (\n    <div>\n      {(filters || []).length === 0 ? (\n        <div className=\"empty-state-compact\">\n          No filters defined. Filters narrow down which entities can be selected as targets.\n        </div>\n      ) : (\n        <div className=\"condition-list\">\n          {(filters || []).map((filter, index) => (\n            <SelectionFilterCard\n              key={index}\n              filter={filter}\n              onChange={(updated) => handleUpdateFilter(index, updated)}\n              onRemove={() => handleRemoveFilter(index)}\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))}\n        </div>\n      )}\n\n      <div ref={containerRef} className=\"relative mt-lg\">\n        <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n          + Add Filter\n        </button>\n\n        {showTypeMenu && (\n          <div\n            className=\"dropdown-menu sfe-dropdown-fixed\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n            style={{ '--sfe-dd-top': `${dropdownPos.top}px`, '--sfe-dd-left': `${dropdownPos.left}px`, '--sfe-dd-width': `${dropdownPos.width}px`, top: 'var(--sfe-dd-top)', left: 'var(--sfe-dd-left)', width: 'var(--sfe-dd-width)' }}\n          >\n            {Object.entries(FILTER_TYPES).map(([type, config]) => (\n              <div key={type} onClick={() => handleAddFilter(type)} className=\"dropdown-menu-item\" role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n                <span\n                  className=\"dropdown-menu-icon\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per filter type\n                  style={{ '--sfe-icon-bg': `${config.color}20`, backgroundColor: 'var(--sfe-icon-bg)' }}\n                >\n                  {config.icon}\n                </span>\n                <span className=\"dropdown-menu-label\">{config.label}</span>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ filters, onChange, schema, availableRefs }", "type": "{ filters: any[]; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "SelectionFilterCard", "button", "span"], "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useState", "useRef", "useLayoutEffect", "useEffect"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["FILTER_TYPES"], "category": "internal"}, {"source": "./SelectionFilterCard", "specifiers": ["SelectionFilterCard"], "category": "internal"}, {"source": "./SelectionFiltersEditor.css", "specifiers": [], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx::CreationTab", "name": "CreationTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx", "sourceCode": "// ============================================================================\n// CreationTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.tagRegistry - Available tags\n * @param {Function} props.onAddToRegistry - Callback to add new tag to registry\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function CreationTab({\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}) {\n  const creation = generator.creation || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    creation.forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, creation]);\n\n  const culturesById = useMemo(() => {\n    const map = {};\n    (schema?.cultures || []).forEach((culture) => {\n      map[culture.id] = culture;\n    });\n    return map;\n  }, [schema?.cultures]);\n\n  const cultureIds = useMemo(() => Object.keys(culturesById), [culturesById]);\n\n  const handleAdd = () => {\n    const nextNum = creation.length + 1;\n    onChange({\n      ...generator,\n      creation: [\n        ...creation,\n        { entityRef: `$entity${nextNum}`, kind: \"npc\", prominence: \"marginal\" },\n      ],\n    });\n  };\n\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Entity Creation</div>\n        <div className=\"section-desc\">\n          Define entities that this generator creates. Each entity gets a reference (like{\" \"}\n          <code className=\"inline-code\">$hero</code>) that can be used in relationships.\n        </div>\n\n        {creation.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2728</div>\n            <div className=\"empty-state-title\">No entities created</div>\n            <div className=\"empty-state-desc\">\n              This generator only modifies existing entities. Add creation rules to spawn new\n              entities.\n            </div>\n          </div>\n        ) : (\n          creation.map((item, index) => (\n            <CreationCard\n              key={index}\n              item={item}\n              onChange={(updated) => {\n                const newCreation = [...creation];\n                newCreation[index] = updated;\n                onChange({ ...generator, creation: newCreation });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, creation: creation.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n              culturesById={culturesById}\n              cultureIds={cultureIds}\n              generator={generator}\n              tagRegistry={tagRegistry}\n              onAddToRegistry={onAddToRegistry}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Entity Creation\n        </button>\n      </div>\n\n      <VariantsSection\n        generator={generator}\n        onChange={onChange}\n        pressures={pressures}\n        schema={schema}\n        tagRegistry={tagRegistry}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}", "type": "{ generator: any; onChange: Function; schema: any; tagRegistry: any[]; onAddToRegistry: Function; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "code", "button", "VariantsSection"], "hookCalls": [{"name": "useMemo", "count": 3}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useState", "useMemo", "useCallback"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "LevelSelector", "PROMINENCE_LEVELS", "ChipSelect", "NumberInput", "LocalTextArea"], "category": "internal"}, {"source": "./CreationTab.css", "specifiers": [], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/EffectsTab.jsx::EffectsTab", "name": "EffectsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/EffectsTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Object} props.schema - Domain schema\n */\nexport function EffectsTab({ generator, onChange, pressures, schema }) {\n  const stateUpdates = generator.stateUpdates || [];\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const addButtonRef = useRef(null);\n\n  // Build available entity references from target + variables + created entities\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, generator.creation]);\n\n  const createMutation = (type) => {\n    let newUpdate;\n    switch (type) {\n      case \"modify_pressure\":\n        newUpdate = { type: \"modify_pressure\", pressureId: pressures?.[0]?.id || \"\", delta: 0 };\n        break;\n      case \"archive_relationship\":\n        newUpdate = {\n          type: \"archive_relationship\",\n          entity: \"$target\",\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n        break;\n      case \"change_status\":\n        newUpdate = { type: \"change_status\", entity: \"$target\", newStatus: \"\" };\n        break;\n      case \"set_tag\":\n        newUpdate = { type: \"set_tag\", entity: \"$target\", tag: \"\", value: true };\n        break;\n      case \"remove_tag\":\n        newUpdate = { type: \"remove_tag\", entity: \"$target\", tag: \"\" };\n        break;\n      case \"update_rate_limit\":\n        newUpdate = { type: \"update_rate_limit\" };\n        break;\n      default:\n        return null;\n    }\n    return newUpdate;\n  };\n\n  const addMutation = (type) => {\n    const next = createMutation(type);\n    if (!next) return;\n    onChange({ ...generator, stateUpdates: [...stateUpdates, next] });\n  };\n\n  const updateMutation = (index, updated) => {\n    const newUpdates = [...stateUpdates];\n    newUpdates[index] = updated;\n    onChange({ ...generator, stateUpdates: newUpdates });\n  };\n\n  const removeMutation = (index) => {\n    onChange({ ...generator, stateUpdates: stateUpdates.filter((_, i) => i !== index) });\n  };\n\n  const knownTypes = new Set(DEFAULT_MUTATION_TYPES.map((type) => type.value));\n  const unrecognizedUpdates = stateUpdates\n    .map((update, index) => (knownTypes.has(update.type) ? null : { update, index }))\n    .filter(Boolean);\n\n  useLayoutEffect(() => {\n    if (showTypeMenu && addButtonRef.current) {\n      const rect = addButtonRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (event) => {\n      if (addButtonRef.current && !addButtonRef.current.contains(event.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  return (\n    <div>\n      {/* Unrecognized Effects - shown first to draw attention */}\n      {unrecognizedUpdates.length > 0 && (\n        <div className=\"section et-unrecognized-section\">\n          <div className=\"section-title et-unrecognized-title\">\n            <span>\u26a0\ufe0f</span> Unrecognized Effects\n          </div>\n          <div className=\"section-desc mb-lg\">\n            These state updates have unrecognized types and may be from an older version. Remove\n            them to clear validation errors.\n          </div>\n\n          {unrecognizedUpdates.map((entry) => {\n            const globalIdx = entry.index;\n            const update = entry.update;\n            return (\n              <div\n                key={globalIdx}\n                className=\"item-card et-unrecognized-card\"\n              >\n                <div className=\"et-unrecognized-body\">\n                  <div className=\"et-unrecognized-layout\">\n                    <div className=\"flex-1\">\n                      <div className=\"et-unrecognized-type\">\n                        Unknown type: &quot;{update.type || \"(no type)\"}&quot;\n                      </div>\n                      <pre className=\"et-unrecognized-json\">\n                        {JSON.stringify(update, null, 2)}\n                      </pre>\n                    </div>\n                    <button\n                      className=\"btn btn-danger flex-shrink-0\"\n                      onClick={() => removeMutation(globalIdx)}\n                    >\n                      Remove\n                    </button>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u26a1 Effects ({stateUpdates.length})</div>\n        <div className=\"section-desc\">\n          Apply state updates when this generator runs. Effects use the unified mutation library.\n        </div>\n\n        {stateUpdates.map((update, index) => {\n          if (!knownTypes.has(update.type)) return null;\n          return (\n            <MutationCard\n              key={index}\n              mutation={update}\n              onChange={(updated) => updateMutation(index, updated)}\n              onRemove={() => removeMutation(index)}\n              schema={schema}\n              pressures={pressures}\n              entityOptions={availableRefs}\n              typeOptions={DEFAULT_MUTATION_TYPES}\n              createMutation={createMutation}\n            />\n          );\n        })}\n\n        <div ref={addButtonRef} className=\"relative mt-lg\">\n          <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n            + Add Effect\n          </button>\n\n          {showTypeMenu && (\n            <div\n              className=\"dropdown-menu et-dropdown-fixed\"\n              // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n              style={{ '--et-dd-top': `${dropdownPos.top}px`, '--et-dd-left': `${dropdownPos.left}px`, '--et-dd-width': `${dropdownPos.width}px`, top: 'var(--et-dd-top)', left: 'var(--et-dd-left)', width: 'var(--et-dd-width)' }}\n            >\n              {MUTATION_TYPE_OPTIONS.map((opt) => (\n                <div\n                  key={opt.value}\n                  onClick={() => {\n                    addMutation(opt.value);\n                    setShowTypeMenu(false);\n                  }}\n                  className=\"dropdown-menu-item\"\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <span\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per mutation type\n                    style={{ '--et-icon-bg': `${opt.color}20`, backgroundColor: 'var(--et-icon-bg)' }}\n                  >\n                    {opt.icon}\n                  </span>\n                  <span className=\"dropdown-menu-label\">{opt.label}</span>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, pressures, schema }", "type": "{ generator: any; onChange: Function; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "div", "pre", "button", "MutationCard"], "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useMemo", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useEffect", "useLayoutEffect", "useMemo", "useRef", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared/MutationCard", "specifiers": ["MutationCard", "DEFAULT_MUTATION_TYPES"], "category": "internal"}, {"source": "../../actions/constants", "specifiers": ["MUTATION_TYPE_OPTIONS"], "category": "internal"}, {"source": "./EffectsTab.css", "specifiers": [], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Function} props.onDelete - Callback to delete the generator\n * @param {Function} props.onDuplicate - Callback to duplicate the generator\n */\nexport function OverviewTab({ generator, onChange, onDelete, onDuplicate }) {\n  const updateField = (field, value) => {\n    onChange({ ...generator, [field]: value });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(generator.id, (value) =>\n    updateField(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(generator.name, (value) =>\n    updateField(\"name\", value)\n  );\n\n  const summary = useMemo(() => {\n    return {\n      rules: generator.applicability?.length || 0,\n      variables: Object.keys(generator.variables || {}).length,\n      creates: generator.creation?.length || 0,\n      relationships: generator.relationships?.length || 0,\n      effects: generator.stateUpdates?.length || 0,\n    };\n  }, [generator]);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"generator-id\" className=\"label\">Generator ID</label>\n            <input id=\"generator-id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"display-name\" className=\"label\">Display Name</label>\n            <input id=\"display-name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n              placeholder=\"Optional friendly name\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Enabled\n          <EnableToggle\n            enabled={generator.enabled !== false}\n            onChange={(enabled) => updateField(\"enabled\", enabled)}\n            label={generator.enabled !== false ? \"Generator is active\" : \"Generator is disabled\"}\n          />\n          </label>\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">Narration Template</span>\n          <div className=\"section-desc mb-md\">\n            Syntax: {\"{$target.field}\"}, {\"{$var.field}\"}, {\"{count:kind}\"}, {\"{list:created}\"},{\" \"}\n            {\"{field|fallback}\"}.\n          </div>\n          <LocalTextArea\n            value={generator.narrationTemplate || \"\"}\n            onChange={(value) => updateField(\"narrationTemplate\", value || undefined)}\n            placeholder=\"e.g., From {$target.name}, {count:npc} new souls emerged to shape the realm.\"\n            rows={2}\n          />\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Summary</div>\n        <div className=\"summary-stats-grid\">\n          {[\n            { label: \"Rules\", value: summary.rules, icon: \"\u2713\" },\n            { label: \"Variables\", value: summary.variables, icon: \"\ud83d\udce6\" },\n            { label: \"Creates\", value: summary.creates, icon: \"\u2728\" },\n            { label: \"Connects\", value: summary.relationships, icon: \"\ud83d\udd17\" },\n            { label: \"Effects\", value: summary.effects, icon: \"\u26a1\" },\n          ].map((stat) => (\n            <div key={stat.label} className=\"summary-stat\">\n              <div className=\"summary-stat-icon\">{stat.icon}</div>\n              <div className=\"summary-stat-value\">{stat.value}</div>\n              <div className=\"summary-stat-label\">{stat.label}</div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"danger-zone\">\n        <button className=\"btn btn-secondary\" onClick={onDuplicate}>\n          Duplicate Generator\n        </button>\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete Generator\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, onDelete, onDuplicate }", "type": "{ generator: any; onChange: Function; onDelete: Function; onDuplicate: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "label", "input", "EnableToggle", "span", "LocalTextArea", "button"], "hookCalls": [{"name": "useLocalInputState", "count": 2}, {"name": "useMemo", "count": 1}], "customHookCalls": ["useLocalInputState"], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::TargetTab", "name": "TargetTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema with entity/relationship kinds\n */\nexport function TargetTab({ generator, onChange, schema }) {\n  const selection = generator.selection || { strategy: \"by_kind\" };\n\n  // Get the kind of the first created entity for saturation limit inference\n  const firstCreatedKind = (generator.creation || [])[0]?.kind;\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Target Selection</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What is $target?</div>\n          <div className=\"info-box-text\">\n            The <code className=\"inline-code\">$target</code> is the primary entity this generator\n            operates on. It&apos;s selected from the world graph based on the rules you define here. Once\n            selected, you can reference it in creation rules (e.g., inherit culture from $target)\n            and relationships (e.g., connect new entity to $target).\n          </div>\n        </div>\n\n        <SelectionRuleEditor\n          value={selection}\n          onChange={(updated) => onChange({ ...generator, selection: updated })}\n          schema={schema}\n          availableRefs={[\"$target\", ...Object.keys(generator.variables || {})]}\n        />\n\n        {/* Saturation Limits */}\n        <div className=\"mt-2xl\">\n          <span className=\"label\">Saturation Limits</span>\n          <div className=\"info-box-text mb-lg text-sm\">\n            Limit targets based on existing relationship counts. Only targets with fewer than the\n            max count of relationships will be selected.\n          </div>\n          <SaturationLimitsEditor\n            limits={selection.saturationLimits || []}\n            onChange={(limits) =>\n              onChange({\n                ...generator,\n                selection: {\n                  ...selection,\n                  saturationLimits: limits.length > 0 ? limits : undefined,\n                },\n              })\n            }\n            schema={schema}\n            createdKind={firstCreatedKind}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "code", "SelectionRuleEditor", "span", "SaturationLimitsEditor"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::VariablesTab", "name": "VariablesTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "// ============================================================================\n// VariablesTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n */\nexport function VariablesTab({ generator, onChange, schema }) {\n  const variables = generator.variables || {};\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  // Build available refs for relationship queries (target + other vars + creation refs)\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$target\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    // Ensure the name starts with $\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    // Create with empty required fields - validation will flag them\n    onChange({\n      ...generator,\n      variables: {\n        ...variables,\n        [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"\" } },\n      },\n    });\n    setNewVarName(\"\");\n    setShowAddForm(false);\n  };\n\n  const varEntries = Object.entries(variables);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Variables</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What are variables?</div>\n          <div className=\"info-box-text\">\n            Variables let you select additional entities from the graph to use in creation and\n            relationships. For example, you might select a{\" \"}\n            <code className=\"inline-code\">$faction</code> to make a new NPC a member of, or an{\" \"}\n            <code className=\"inline-code\">$ability</code> for them to practice. Variables are\n            selected after <code className=\"inline-code\">$target</code> is chosen.\n          </div>\n        </div>\n\n        {varEntries.length === 0 && !showAddForm ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udce6</div>\n            <div className=\"empty-state-title\">No variables defined</div>\n            <div className=\"empty-state-desc\">\n              Add variables to select additional entities for use in creation and relationships.\n            </div>\n          </div>\n        ) : (\n          varEntries.map(([name, config]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={config}\n              onChange={(updated) =>\n                onChange({ ...generator, variables: { ...variables, [name]: updated } })\n              }\n              onRemove={() => {\n                const newVars = { ...variables };\n                delete newVars[name];\n                onChange({ ...generator, variables: newVars });\n              }}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "code", "label", "input", "button"], "hookCalls": [{"name": "useState", "count": 2}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::CreationTab", "name": "CreationTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "// ============================================================================\n// CreationTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.tagRegistry - Available tags\n * @param {Function} props.onAddToRegistry - Callback to add new tag to registry\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function CreationTab({\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}) {\n  const creation = generator.creation || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    creation.forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, creation]);\n\n  const culturesById = useMemo(() => {\n    const map = {};\n    (schema?.cultures || []).forEach((culture) => {\n      map[culture.id] = culture;\n    });\n    return map;\n  }, [schema?.cultures]);\n\n  const cultureIds = useMemo(() => Object.keys(culturesById), [culturesById]);\n\n  const handleAdd = () => {\n    const nextNum = creation.length + 1;\n    onChange({\n      ...generator,\n      creation: [\n        ...creation,\n        { entityRef: `$entity${nextNum}`, kind: \"npc\", prominence: \"marginal\" },\n      ],\n    });\n  };\n\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Entity Creation</div>\n        <div className=\"section-desc\">\n          Define entities that this generator creates. Each entity gets a reference (like{\" \"}\n          <code className=\"inline-code\">$hero</code>) that can be used in relationships.\n        </div>\n\n        {creation.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2728</div>\n            <div className=\"empty-state-title\">No entities created</div>\n            <div className=\"empty-state-desc\">\n              This generator only modifies existing entities. Add creation rules to spawn new\n              entities.\n            </div>\n          </div>\n        ) : (\n          creation.map((item, index) => (\n            <CreationCard\n              key={index}\n              item={item}\n              onChange={(updated) => {\n                const newCreation = [...creation];\n                newCreation[index] = updated;\n                onChange({ ...generator, creation: newCreation });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, creation: creation.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n              culturesById={culturesById}\n              cultureIds={cultureIds}\n              generator={generator}\n              tagRegistry={tagRegistry}\n              onAddToRegistry={onAddToRegistry}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Entity Creation\n        </button>\n      </div>\n\n      <VariantsSection\n        generator={generator}\n        onChange={onChange}\n        pressures={pressures}\n        schema={schema}\n        tagRegistry={tagRegistry}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}", "type": "{ generator: any; onChange: Function; schema: any; tagRegistry: any[]; onAddToRegistry: Function; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "code", "button", "VariantsSection"], "hookCalls": [{"name": "useMemo", "count": 3}], "customHookCalls": [], "imports": []}]