[{"id": "apps/coherence-engine/webui/src/components/actions/tabs/OutcomeTab.jsx::OutcomeTab", "name": "OutcomeTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/OutcomeTab.jsx", "sourceCode": "export function OutcomeTab({ action, onChange, schema, pressures }) {\n  const outcome = action.outcome || {};\n  const mutations = outcome.mutations || [];\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const addButtonRef = useRef(null);\n\n  const updateOutcome = (field, value) => {\n    onChange({\n      ...action,\n      outcome: { ...outcome, [field]: value },\n    });\n  };\n\n  const createMutation = (type) => {\n    const defaultPressure = pressures?.[0]?.id || \"\";\n    const defaultEntity = \"$actor\";\n    const defaultTarget = \"$target\";\n    const defaultOther = \"$target2\";\n\n    switch (type) {\n      case \"modify_pressure\":\n        return { type: \"modify_pressure\", pressureId: defaultPressure, delta: 0 };\n      case \"set_tag\":\n        return { type: \"set_tag\", entity: defaultTarget, tag: \"\", value: true };\n      case \"remove_tag\":\n        return { type: \"remove_tag\", entity: defaultTarget, tag: \"\" };\n      case \"change_status\":\n        return { type: \"change_status\", entity: defaultTarget, newStatus: \"\" };\n      case \"adjust_prominence\":\n        return { type: \"adjust_prominence\", entity: defaultEntity, delta: 0.1 };\n      case \"archive_relationship\":\n        return {\n          type: \"archive_relationship\",\n          entity: defaultEntity,\n          relationshipKind: \"\",\n          with: defaultTarget,\n          direction: \"both\",\n        };\n      case \"archive_all_relationships\":\n        return {\n          type: \"archive_all_relationships\",\n          entity: defaultEntity,\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n      case \"adjust_relationship_strength\":\n        return {\n          type: \"adjust_relationship_strength\",\n          kind: \"\",\n          src: defaultEntity,\n          dst: defaultTarget,\n          delta: 0.1,\n        };\n      case \"update_rate_limit\":\n        return { type: \"update_rate_limit\" };\n      case \"create_relationship\":\n      default:\n        return {\n          type: \"create_relationship\",\n          kind: \"\",\n          src: defaultEntity,\n          dst: defaultTarget || defaultOther,\n          strength: 0.5,\n        };\n    }\n  };\n\n  const addMutation = (type) => {\n    updateOutcome(\"mutations\", [...mutations, createMutation(type)]);\n  };\n\n  const updateMutation = (index, mutation) => {\n    const next = [...mutations];\n    next[index] = mutation;\n    updateOutcome(\"mutations\", next);\n  };\n\n  const removeMutation = (index) => {\n    updateOutcome(\n      \"mutations\",\n      mutations.filter((_, i) => i !== index)\n    );\n  };\n\n  useLayoutEffect(() => {\n    if (showTypeMenu && addButtonRef.current) {\n      const rect = addButtonRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (event) => {\n      if (addButtonRef.current && !addButtonRef.current.contains(event.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Action Outcome</div>\n        <div className=\"info-box-text\">\n          Define what happens when this action succeeds. Create relationships, change statuses,\n          modify pressures, or strengthen existing connections.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2699\ufe0f Mutations ({mutations.length})</div>\n        <div className=\"section-desc\">\n          Apply mutations when the action succeeds. Each mutation uses the unified rules library.\n        </div>\n\n        {mutations.map((mutation, index) => (\n          <MutationCard\n            key={index}\n            mutation={mutation}\n            onChange={(updated) => updateMutation(index, updated)}\n            onRemove={() => removeMutation(index)}\n            schema={schema}\n            pressures={pressures}\n            entityOptions={RELATIONSHIP_REFS}\n            typeOptions={ACTION_MUTATION_TYPES}\n            createMutation={createMutation}\n          />\n        ))}\n\n        <div ref={addButtonRef} className=\"ot-add-btn-wrap mt-lg\">\n          <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n            + Add Mutation\n          </button>\n\n          {showTypeMenu && (\n            {/* eslint-disable-next-line local/no-inline-styles -- dynamic position from JS measurement */}\n            <div\n              className=\"dropdown-menu ot-dropdown-fixed\"\n              style={{\n                '--ot-dd-top': `${dropdownPos.top}px`,\n                '--ot-dd-left': `${dropdownPos.left}px`,\n                '--ot-dd-width': `${dropdownPos.width}px`,\n                top: 'var(--ot-dd-top)',\n                left: 'var(--ot-dd-left)',\n                width: 'var(--ot-dd-width)',\n              }}\n            >\n              {MUTATION_TYPE_OPTIONS.map((opt) => (\n                <div\n                  key={opt.value}\n                  onClick={() => {\n                    addMutation(opt.value);\n                    setShowTypeMenu(false);\n                  }}\n                  className=\"dropdown-menu-item\"\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color */}\n                  <span\n                    className=\"dropdown-menu-icon\"\n                    style={{ '--ot-menu-icon-bg': `${opt.color}20`, backgroundColor: 'var(--ot-menu-icon-bg)' }}\n                  >\n                    {opt.icon}\n                  </span>\n                  <span className=\"dropdown-menu-label\">{opt.label}</span>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2b50 Prominence Changes</div>\n        <div className=\"section-desc\">\n          Apply prominence changes to actor or target on action success/failure. Values are numeric\n          deltas (e.g., 0.1 or -0.05).\n        </div>\n\n        <div className=\"mb-xl\">\n          <div className=\"label mb-md\">\n            Actor Prominence Delta\n          </div>\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Success\n              <NumberInput\n                value={outcome.actorProminenceDelta?.onSuccess}\n                onChange={(v) => {\n                  const current = outcome.actorProminenceDelta || {};\n                  const updated = { ...current, onSuccess: v };\n                  if (updated.onSuccess === undefined) delete updated.onSuccess;\n                  updateOutcome(\n                    \"actorProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., 0.1\"\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Failure\n              <NumberInput\n                value={outcome.actorProminenceDelta?.onFailure}\n                onChange={(v) => {\n                  const current = outcome.actorProminenceDelta || {};\n                  const updated = { ...current, onFailure: v };\n                  if (updated.onFailure === undefined) delete updated.onFailure;\n                  updateOutcome(\n                    \"actorProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., -0.05\"\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        </div>\n\n        <div>\n          <div className=\"label mb-md\">\n            Target Prominence Delta\n          </div>\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Success\n              <NumberInput\n                value={outcome.targetProminenceDelta?.onSuccess}\n                onChange={(v) => {\n                  const current = outcome.targetProminenceDelta || {};\n                  const updated = { ...current, onSuccess: v };\n                  if (updated.onSuccess === undefined) delete updated.onSuccess;\n                  updateOutcome(\n                    \"targetProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., 0.1\"\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Failure\n              <NumberInput\n                value={outcome.targetProminenceDelta?.onFailure}\n                onChange={(v) => {\n                  const current = outcome.targetProminenceDelta || {};\n                  const updated = { ...current, onFailure: v };\n                  if (updated.onFailure === undefined) delete updated.onFailure;\n                  updateOutcome(\n                    \"targetProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., -0.05\"\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udcdd Description Template</div>\n        <div className=\"section-desc\">\n          Template for generating occurrence descriptions. Use {\"{actor.name}\"},{\" \"}\n          {\"{instigator.name}\"}, {\"{target.name}\"}, etc.\n        </div>\n        <LocalTextArea\n          value={outcome.descriptionTemplate || \"\"}\n          onChange={(value) => updateOutcome(\"descriptionTemplate\", value || undefined)}\n          placeholder=\"e.g., declared war on {target.name}\"\n        />\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udcd6 Narration Template</div>\n        <div className=\"section-desc\">\n          Domain-controlled narrative text. Syntax: {\"{entity.field}\"}, {\"{$var.field}\"},{\" \"}\n          {\"{field|fallback}\"}, {\"{list:entities}\"}.\n        </div>\n        <LocalTextArea\n          value={outcome.narrationTemplate || \"\"}\n          onChange={(value) => updateOutcome(\"narrationTemplate\", value || undefined)}\n// ... (truncated)", "parameters": [{"name": "{ action, onChange, schema, pressures }", "type": "{ action: any; onChange: any; schema: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": null, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useEffect", "useLayoutEffect", "useRef", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["RELATIONSHIP_REFS", "MUTATION_TYPE_OPTIONS"], "category": "internal"}, {"source": "../../shared/MutationCard", "specifiers": ["MutationCard", "DEFAULT_MUTATION_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["NumberInput", "LocalTextArea"], "category": "internal"}, {"source": "./OutcomeTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/OverviewTab.jsx::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/OverviewTab.jsx", "sourceCode": "export function OverviewTab({ action, onChange, onDelete }) {\n  const updateAction = (field, value) => {\n    onChange({ ...action, [field]: value });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(action.id, (value) =>\n    updateAction(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(action.name, (value) =>\n    updateAction(\"name\", value)\n  );\n\n  const isEnabled = action.enabled !== false;\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udccb Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"id\" className=\"label\">ID</label>\n            <input id=\"id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n              placeholder=\"unique_action_id\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"name\" className=\"label\">Name</label>\n            <input id=\"name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n              placeholder=\"Action Name\"\n            />\n          </div>\n          <div className=\"form-group form-group-wide\">\n            <label className=\"label\">Description\n            <LocalTextArea\n              value={action.description || \"\"}\n              onChange={(value) => updateAction(\"description\", value)}\n              placeholder=\"What does this action do?\"\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2699\ufe0f Status</div>\n        <label className=\"checkbox-label\">\n          <input\n            type=\"checkbox\"\n            checked={isEnabled}\n            onChange={(e) => updateAction(\"enabled\", e.target.checked)}\n            className=\"checkbox\"\n          />\n          Action Enabled\n        </label>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\uddd1\ufe0f Danger Zone</div>\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete Action\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, onDelete }", "type": "{ action: any; onChange: any; onDelete: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useLocalInputState", "count": 2}], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["useLocalInputState", "LocalTextArea"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/ProbabilityTab.jsx::ProbabilityTab", "name": "ProbabilityTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/ProbabilityTab.jsx", "sourceCode": "export function ProbabilityTab({ action, onChange, pressures }) {\n  const probability = action.probability || {};\n\n  const updateProbability = (field, value) => {\n    onChange({\n      ...action,\n      probability: { ...probability, [field]: value },\n    });\n  };\n\n  const pressureModifiers = probability.pressureModifiers || [];\n  const baseSuccessChance = probability.baseSuccessChance ?? 0.5;\n  const baseWeight = probability.baseWeight ?? 1.0;\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Probability Configuration</div>\n        <div className=\"info-box-text\">\n          Control how likely this action is to be selected and succeed. Pressure modifiers\n          dynamically adjust weight based on world state.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83c\udfaf Base Success Chance</div>\n        <div className=\"section-desc\">Probability that this action succeeds when attempted.</div>\n        <div className=\"slider-row\">\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.05\"\n            value={baseSuccessChance}\n            onChange={(e) => updateProbability(\"baseSuccessChance\", parseFloat(e.target.value))}\n            className=\"slider\"\n          />\n          <span className=\"slider-value\">{(baseSuccessChance * 100).toFixed(0)}%</span>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2696\ufe0f Base Weight</div>\n        <div className=\"section-desc\">\n          Relative weight for action selection. Higher weight means more likely to be chosen.\n        </div>\n        <div className=\"form-group\">\n          <NumberInput\n            value={baseWeight}\n            onChange={(v) => updateProbability(\"baseWeight\", v ?? 1.0)}\n            min={0}\n          />\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udcca Pressure Modifiers ({pressureModifiers.length})</div>\n        <div className=\"section-desc\">\n          Pressures that affect the weight of this action. Formula: weight = baseWeight \u00d7 (1 +\n          \u03a3(pressure/100 \u00d7 multiplier))\n        </div>\n        <PressureModifiersEditor\n          value={pressureModifiers}\n          onChange={(v) => updateProbability(\"pressureModifiers\", v.length > 0 ? v : undefined)}\n          pressures={pressures}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, pressures }", "type": "{ action: any; onChange: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "PressureModifiersEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["NumberInput"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/TargetingTab.jsx::TargetingTab", "name": "TargetingTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/TargetingTab.jsx", "sourceCode": "export function TargetingTab({ action, onChange, schema }) {\n  const targeting = action.targeting || { strategy: \"by_kind\" };\n\n  const updateTargeting = (updated) => {\n    onChange({\n      ...action,\n      targeting: updated,\n    });\n  };\n\n  // Available refs for selection filters (action context)\n  const availableRefs = [\"$actor\", \"$instigator\"];\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Target Selection</div>\n        <div className=\"info-box-text\">Define how valid targets are selected for this action.</div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83c\udfaf Target Selection</div>\n        <SelectionRuleEditor\n          value={targeting}\n          onChange={updateTargeting}\n          schema={schema}\n          availableRefs={availableRefs}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SelectionRuleEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared/SelectionRuleEditor", "specifiers": ["SelectionRuleEditor"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/VariablesTab.jsx::VariablesTab", "name": "VariablesTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/VariablesTab.jsx", "sourceCode": "// ============================================================================\n// VariablesTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.action - The action being edited\n * @param {Function} props.onChange - Callback when action changes\n * @param {Object} props.schema - Domain schema\n */\nexport function VariablesTab({ action, onChange, schema }) {\n  const variables = action.variables || {};\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  // Build available refs for relationship queries (actor, instigator, target, target2 + other vars)\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$actor\", \"$instigator\", \"$target\", \"$target2\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    // Ensure the name starts with $\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    // Create with empty required fields - validation will flag them\n    onChange({\n      ...action,\n      variables: {\n        ...variables,\n        [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"\" } },\n      },\n    });\n    setNewVarName(\"\");\n    setShowAddForm(false);\n  };\n\n  const varEntries = Object.entries(variables);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Variables</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What are variables?</div>\n          <div className=\"info-box-text\">\n            Variables let you select additional entities from the graph to use in mutations. For\n            example, you might select a <code className=\"inline-code\">$victimFaction</code> to\n            create an enemy relationship with, or an <code className=\"inline-code\">$artifact</code>{\" \"}\n            to modify. Variables are resolved after <code className=\"inline-code\">$actor</code> and{\" \"}\n            <code className=\"inline-code\">$target</code> are chosen.\n          </div>\n        </div>\n\n        {varEntries.length === 0 && !showAddForm ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udce6</div>\n            <div className=\"empty-state-title\">No variables defined</div>\n            <div className=\"empty-state-desc\">\n              Add variables to select additional entities for use in mutations.\n            </div>\n          </div>\n        ) : (\n          varEntries.map(([name, config]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={config}\n              onChange={(updated) =>\n                onChange({ ...action, variables: { ...variables, [name]: updated } })\n              }\n              onRemove={() => {\n                const newVars = { ...variables };\n                delete newVars[name];\n                onChange({ ...action, variables: newVars });\n              }}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared/VariableSelectionEditor", "specifiers": ["VariableSelectionEditor"], "category": "internal"}, {"source": "./VariablesTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/components/DependencySection.jsx::DependencySection", "name": "DependencySection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/components/DependencySection.jsx", "sourceCode": "export function DependencySection({ title, icon, items, renderItem, defaultExpanded = false }) {\n  const [expanded, setExpanded] = useState(defaultExpanded);\n  const [, setHovering] = useState(false);\n\n  if (items.length === 0) return null;\n\n  return (\n    <div className=\"dependency-viewer-section\">\n      <div\n        className=\"dependency-section-header\"\n        onClick={() => setExpanded(!expanded)}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n      >\n        <div className=\"dependency-section-title\">\n          <span>{icon}</span>\n          <span>{title}</span>\n          <span className=\"dependency-section-count\">{items.length}</span>\n        </div>\n        <span className={`dependency-expand-icon ${expanded ? \"dependency-expand-icon-open\" : \"\"}`}>\n          \u25bc\n        </span>\n      </div>\n      {expanded && (\n        <div className=\"dependency-section-content\">\n          {items.map((item, index) => renderItem(item, index))}\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ title, icon, items, renderItem, defaultExpanded = false }", "type": "{ title: any; icon: any; items: any; renderItem: any; defaultExpanded?: boolean; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../dependency-viewer.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/components/index.js::DependencySection", "name": "DependencySection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/components/index.js", "sourceCode": "export function DependencySection({ title, icon, items, renderItem, defaultExpanded = false }) {\n  const [expanded, setExpanded] = useState(defaultExpanded);\n  const [, setHovering] = useState(false);\n\n  if (items.length === 0) return null;\n\n  return (\n    <div className=\"dependency-viewer-section\">\n      <div\n        className=\"dependency-section-header\"\n        onClick={() => setExpanded(!expanded)}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n      >\n        <div className=\"dependency-section-title\">\n          <span>{icon}</span>\n          <span>{title}</span>\n          <span className=\"dependency-section-count\">{items.length}</span>\n        </div>\n        <span className={`dependency-expand-icon ${expanded ? \"dependency-expand-icon-open\" : \"\"}`}>\n          \u25bc\n        </span>\n      </div>\n      {expanded && (\n        <div className=\"dependency-section-content\">\n          {items.map((item, index) => renderItem(item, index))}\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ title, icon, items, renderItem, defaultExpanded = false }", "type": "{ title: any; icon: any; items: any; renderItem: any; defaultExpanded?: boolean; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/components/index.js::UsageBadges", "name": "UsageBadges", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/components/index.js", "sourceCode": "/**\n * DetailUsageBadges component\n *\n * @param {Object} props\n * @param {Object} props.usage - Object with arrays of referencing items\n *   e.g., { generators: ['gen1', 'gen2'], systems: ['sys1'] }\n * @param {boolean} props.showOrphan - If true, show \"Not used\" when no usage (default: true)\n */\nexport function DetailUsageBadges({ usage = {}, showOrphan = true }) {\n  const badges = [];\n\n  for (const [type, config] of Object.entries(BADGE_CONFIG)) {\n    const items = usage[type];\n    if (items?.length > 0) {\n      const count = items.length;\n      const label = type === 'eras' && count !== 1 ? config.labelPlural : config.label;\n      badges.push(\n        <span\n          key={type}\n          className={`detail-badge ${config.className}`}\n          title={`${config.tooltip}: ${items.join(', ')}`}\n        >\n          {count} {label}\n        </span>\n      );\n    }\n  }\n\n  if (badges.length === 0) {\n    if (showOrphan) {\n      return <span className=\"detail-badge detail-badge-orphan\">Not used</span>;\n    }\n    return null;\n  }\n\n  return <div className=\"detail-badge-container\">{badges}</div>;\n}", "parameters": [{"name": "{ usage = {}, showOrphan = true }", "type": "{ usage: any; showOrphan: boolean; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "span", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/BasicInfoSection.jsx::BasicInfoSection", "name": "BasicInfoSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/BasicInfoSection.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.era - The era object\n * @param {Function} props.onFieldChange - Called when a field changes\n */\nexport function BasicInfoSection({ era, onFieldChange }) {\n  return (\n    <div className=\"section\">\n      <SectionHeader icon=\"\ud83d\udcdd\" title=\"Basic Information\" />\n      <div className=\"input-grid\">\n        <div className=\"form-group\">\n          <label htmlFor=\"id\" className=\"label\">ID</label>\n          <input id=\"id\"\n            type=\"text\"\n            value={era.id}\n            onChange={(e) => onFieldChange(\"id\", e.target.value)}\n            className=\"input\"\n          />\n        </div>\n        <div className=\"form-group\">\n          <label htmlFor=\"name\" className=\"label\">Name</label>\n          <input id=\"name\"\n            type=\"text\"\n            value={era.name}\n            onChange={(e) => onFieldChange(\"name\", e.target.value)}\n            className=\"input\"\n          />\n        </div>\n      </div>\n      <div className=\"form-group mt-xl\">\n        <label className=\"label\">Summary\n        <LocalTextArea value={era.summary} onChange={(value) => onFieldChange(\"summary\", value)} />\n        </label>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ era, onFieldChange }", "type": "{ era: any; onFieldChange: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "SectionHeader", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["SectionHeader", "LocalTextArea"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/ConditionsSection.jsx::ConditionsSection", "name": "ConditionsSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/ConditionsSection.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.title - Section title\n * @param {string} props.icon - Section icon\n * @param {string} props.description - Section description\n * @param {string} props.emptyMessage - Message when no conditions\n * @param {Array} props.conditions - Array of condition objects\n * @param {Function} props.onUpdate - Called when a condition is updated\n * @param {Function} props.onRemove - Called to remove a condition\n * @param {Function} props.onAdd - Called to add a new condition\n * @param {string} props.addLabel - Label for add button\n * @param {Array} props.pressures - Available pressures\n * @param {Object} props.schema - Domain schema\n */\nexport function ConditionsSection({\n  title,\n  icon,\n  description,\n  emptyMessage,\n  conditions,\n  onUpdate,\n  onRemove,\n  onAdd,\n  addLabel,\n  pressures,\n  schema,\n}) {\n  return (\n    <div className=\"section\">\n      <SectionHeader\n        icon={icon}\n        title={title}\n        count={`${conditions.length} condition${conditions.length !== 1 ? \"s\" : \"\"}`}\n        description={description}\n      />\n      <div className=\"items-grid\">\n        {conditions.length === 0 ? (\n          <EmptyState title={emptyMessage} styles={EMPTY_STATE_STYLES} />\n        ) : (\n          conditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdate(index, updated)}\n              onRemove={() => onRemove(index)}\n              pressures={pressures || []}\n              schema={schema}\n            />\n          ))\n        )}\n      </div>\n      <AddItemButton onClick={onAdd} label={addLabel} styles={ADD_ITEM_STYLES} />\n    </div>\n  );\n}", "parameters": [{"name": "{\n  title,\n  icon,\n  description,\n  emptyMessage,\n  conditions,\n  onUpdate,\n  onRemove,\n  onAdd,\n  addLabel,\n  pressures,\n  schema,\n}", "type": "{ title: string; icon: string; description: string; emptyMessage: string; conditions: any[]; onUpdate: Function; onRemove: Function; onAdd: Function; addLabel: string; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "SectionHeader", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "EmptyState", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "AddItemButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["SectionHeader", "EmptyState", "AddItemButton"], "category": "internal"}, {"source": "../shared", "specifiers": ["TransitionConditionEditor"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/EffectsSection.jsx::EffectsSection", "name": "EffectsSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/EffectsSection.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.title - Section title\n * @param {string} props.icon - Section icon\n * @param {string} props.description - Section description\n * @param {string} props.emptyMessage - Message when no effects\n * @param {Array} props.pressureChanges - Array of [pressureId, value] tuples\n * @param {Function} props.onUpdate - Called when an effect value changes\n * @param {Function} props.onRemove - Called to remove an effect\n * @param {Array} props.availablePressures - Pressures that can be added\n * @param {Function} props.onAdd - Called to add an effect\n * @param {string} props.addPlaceholder - Placeholder for add dropdown\n * @param {Array} props.pressures - All pressure definitions for display\n */\nexport function EffectsSection({\n  title,\n  icon,\n  description,\n  emptyMessage,\n  pressureChanges,\n  onUpdate,\n  onRemove,\n  availablePressures,\n  onAdd,\n  addPlaceholder,\n  pressures,\n}) {\n  return (\n    <div className=\"section\">\n      <SectionHeader\n        icon={icon}\n        title={title}\n        count={`${pressureChanges.length} effect${pressureChanges.length !== 1 ? \"s\" : \"\"}`}\n        description={description}\n      />\n      <div className=\"items-grid\">\n        {pressureChanges.length === 0 ? (\n          <EmptyState title={emptyMessage} styles={EMPTY_STATE_STYLES} />\n        ) : (\n          pressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdate(pressureId, newValue)}\n              onRemove={() => onRemove(pressureId)}\n              pressures={pressures || []}\n            />\n          ))\n        )}\n      </div>\n      <div className=\"add-container\">\n        <SearchableDropdown\n          items={availablePressures}\n          onSelect={onAdd}\n          placeholder={addPlaceholder}\n          emptyMessage=\"All pressures added\"\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  title,\n  icon,\n  description,\n  emptyMessage,\n  pressureChanges,\n  onUpdate,\n  onRemove,\n  availablePressures,\n  onAdd,\n  addPlaceholder,\n  pressures,\n}", "type": "{ title: string; icon: string; description: string; emptyMessage: string; pressureChanges: any[]; onUpdate: Function; onRemove: Function; availablePressures: any[]; onAdd: Function; addPlaceholder: string; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "SectionHeader", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "EmptyState", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "SearchableDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["SectionHeader", "EmptyState", "SearchableDropdown"], "category": "internal"}, {"source": "../shared", "specifiers": ["TransitionEffectItem"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/index.js::BasicInfoSection", "name": "BasicInfoSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.era - The era object\n * @param {Function} props.onFieldChange - Called when a field changes\n */\nexport function BasicInfoSection({ era, onFieldChange }) {\n  return (\n    <div className=\"section\">\n      <SectionHeader icon=\"\ud83d\udcdd\" title=\"Basic Information\" />\n      <div className=\"input-grid\">\n        <div className=\"form-group\">\n          <label htmlFor=\"id\" className=\"label\">ID</label>\n          <input id=\"id\"\n            type=\"text\"\n            value={era.id}\n            onChange={(e) => onFieldChange(\"id\", e.target.value)}\n            className=\"input\"\n          />\n        </div>\n        <div className=\"form-group\">\n          <label htmlFor=\"name\" className=\"label\">Name</label>\n          <input id=\"name\"\n            type=\"text\"\n            value={era.name}\n            onChange={(e) => onFieldChange(\"name\", e.target.value)}\n            className=\"input\"\n          />\n        </div>\n      </div>\n      <div className=\"form-group mt-xl\">\n        <label className=\"label\">Summary\n        <LocalTextArea value={era.summary} onChange={(value) => onFieldChange(\"summary\", value)} />\n        </label>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ era, onFieldChange }", "type": "{ era: any; onFieldChange: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "SectionHeader", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/index.js::ConditionsSection", "name": "ConditionsSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.title - Section title\n * @param {string} props.icon - Section icon\n * @param {string} props.description - Section description\n * @param {string} props.emptyMessage - Message when no conditions\n * @param {Array} props.conditions - Array of condition objects\n * @param {Function} props.onUpdate - Called when a condition is updated\n * @param {Function} props.onRemove - Called to remove a condition\n * @param {Function} props.onAdd - Called to add a new condition\n * @param {string} props.addLabel - Label for add button\n * @param {Array} props.pressures - Available pressures\n * @param {Object} props.schema - Domain schema\n */\nexport function ConditionsSection({\n  title,\n  icon,\n  description,\n  emptyMessage,\n  conditions,\n  onUpdate,\n  onRemove,\n  onAdd,\n  addLabel,\n  pressures,\n  schema,\n}) {\n  return (\n    <div className=\"section\">\n      <SectionHeader\n        icon={icon}\n        title={title}\n        count={`${conditions.length} condition${conditions.length !== 1 ? \"s\" : \"\"}`}\n        description={description}\n      />\n      <div className=\"items-grid\">\n        {conditions.length === 0 ? (\n          <EmptyState title={emptyMessage} styles={EMPTY_STATE_STYLES} />\n        ) : (\n          conditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdate(index, updated)}\n              onRemove={() => onRemove(index)}\n              pressures={pressures || []}\n              schema={schema}\n            />\n          ))\n        )}\n      </div>\n      <AddItemButton onClick={onAdd} label={addLabel} styles={ADD_ITEM_STYLES} />\n    </div>\n  );\n}", "parameters": [{"name": "{\n  title,\n  icon,\n  description,\n  emptyMessage,\n  conditions,\n  onUpdate,\n  onRemove,\n  onAdd,\n  addLabel,\n  pressures,\n  schema,\n}", "type": "{ title: string; icon: string; description: string; emptyMessage: string; conditions: any[]; onUpdate: Function; onRemove: Function; onAdd: Function; addLabel: string; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "SectionHeader", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "EmptyState", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "AddItemButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/index.js::EffectsSection", "name": "EffectsSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.title - Section title\n * @param {string} props.icon - Section icon\n * @param {string} props.description - Section description\n * @param {string} props.emptyMessage - Message when no effects\n * @param {Array} props.pressureChanges - Array of [pressureId, value] tuples\n * @param {Function} props.onUpdate - Called when an effect value changes\n * @param {Function} props.onRemove - Called to remove an effect\n * @param {Array} props.availablePressures - Pressures that can be added\n * @param {Function} props.onAdd - Called to add an effect\n * @param {string} props.addPlaceholder - Placeholder for add dropdown\n * @param {Array} props.pressures - All pressure definitions for display\n */\nexport function EffectsSection({\n  title,\n  icon,\n  description,\n  emptyMessage,\n  pressureChanges,\n  onUpdate,\n  onRemove,\n  availablePressures,\n  onAdd,\n  addPlaceholder,\n  pressures,\n}) {\n  return (\n    <div className=\"section\">\n      <SectionHeader\n        icon={icon}\n        title={title}\n        count={`${pressureChanges.length} effect${pressureChanges.length !== 1 ? \"s\" : \"\"}`}\n        description={description}\n      />\n      <div className=\"items-grid\">\n        {pressureChanges.length === 0 ? (\n          <EmptyState title={emptyMessage} styles={EMPTY_STATE_STYLES} />\n        ) : (\n          pressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdate(pressureId, newValue)}\n              onRemove={() => onRemove(pressureId)}\n              pressures={pressures || []}\n            />\n          ))\n        )}\n      </div>\n      <div className=\"add-container\">\n        <SearchableDropdown\n          items={availablePressures}\n          onSelect={onAdd}\n          placeholder={addPlaceholder}\n          emptyMessage=\"All pressures added\"\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  title,\n  icon,\n  description,\n  emptyMessage,\n  pressureChanges,\n  onUpdate,\n  onRemove,\n  availablePressures,\n  onAdd,\n  addPlaceholder,\n  pressures,\n}", "type": "{ title: string; icon: string; description: string; emptyMessage: string; pressureChanges: any[]; onUpdate: Function; onRemove: Function; availablePressures: any[]; onAdd: Function; addPlaceholder: string; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "SectionHeader", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "EmptyState", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "SearchableDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/index.js::TransitionsGrid", "name": "TransitionsGrid", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.entryConditions - Entry condition array\n * @param {Array} props.exitConditions - Exit condition array\n * @param {Array} props.entryPressureChanges - Entry effect tuples\n * @param {Array} props.exitPressureChanges - Exit effect tuples\n * @param {Function} props.onUpdateEntryCondition\n * @param {Function} props.onRemoveEntryCondition\n * @param {Function} props.onAddEntryCondition\n * @param {Function} props.onUpdateExitCondition\n * @param {Function} props.onRemoveExitCondition\n * @param {Function} props.onAddExitCondition\n * @param {Function} props.onUpdateEntryEffect\n * @param {Function} props.onRemoveEntryEffect\n * @param {Function} props.onAddEntryEffect\n * @param {Function} props.onUpdateExitEffect\n * @param {Function} props.onRemoveExitEffect\n * @param {Function} props.onAddExitEffect\n * @param {Array} props.availablePressuresForEntry\n * @param {Array} props.availablePressuresForExit\n * @param {Array} props.pressures - All pressures for display\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.eras - All eras for era-specific conditions\n */\nexport function TransitionsGrid({\n  entryConditions = [],\n  exitConditions = [],\n  entryPressureChanges = [],\n  exitPressureChanges = [],\n  onUpdateEntryCondition,\n  onRemoveEntryCondition,\n  onAddEntryCondition,\n  onUpdateExitCondition,\n  onRemoveExitCondition,\n  onAddExitCondition,\n  onUpdateEntryEffect,\n  onRemoveEntryEffect,\n  onAddEntryEffect,\n  onUpdateExitEffect,\n  onRemoveExitEffect,\n  onAddExitEffect,\n  availablePressuresForEntry = [],\n  availablePressuresForExit = [],\n  pressures = [],\n  schema,\n  eras = [],\n}) {\n  return (\n    <div className=\"transitions-grid\">\n      {/* Entry Column */}\n      <div className=\"transitions-column transitions-entry\">\n        <div className=\"transitions-column-header\">\n          <span className=\"transitions-column-icon\">\ud83d\udeaa</span>\n          <span className=\"transitions-column-title\">Entry</span>\n          <span className=\"transitions-column-subtitle\">When era starts</span>\n        </div>\n\n        <MiniSection\n          title=\"Conditions\"\n          icon=\"?\"\n          count={entryConditions.length}\n          isEmpty={entryConditions.length === 0}\n          emptyMessage=\"No entry conditions \u2014 starts immediately\"\n        >\n          {entryConditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdateEntryCondition(index, updated)}\n              onRemove={() => onRemoveEntryCondition(index)}\n              pressures={pressures}\n              schema={schema}\n              eras={eras}\n            />\n          ))}\n          <AddItemButton\n            onClick={onAddEntryCondition}\n            label=\"+ Condition\"\n            styles={ADD_ITEM_STYLES}\n          />\n        </MiniSection>\n\n        <MiniSection\n          title=\"Effects\"\n          icon=\"\u2728\"\n          count={entryPressureChanges.length}\n          isEmpty={entryPressureChanges.length === 0}\n          emptyMessage=\"No pressure changes on entry\"\n        >\n          {entryPressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdateEntryEffect(pressureId, newValue)}\n              onRemove={() => onRemoveEntryEffect(pressureId)}\n              pressures={pressures}\n            />\n          ))}\n          <div className=\"transitions-add-effect\">\n            <SearchableDropdown\n              items={availablePressuresForEntry}\n              onSelect={onAddEntryEffect}\n              placeholder=\"+ Add effect...\"\n              emptyMessage=\"All pressures added\"\n            />\n          </div>\n        </MiniSection>\n      </div>\n\n      {/* Arrow divider */}\n      <div className=\"transitions-divider\">\n        <span className=\"transitions-arrow\">\u2192</span>\n      </div>\n\n      {/* Exit Column */}\n      <div className=\"transitions-column transitions-exit\">\n        <div className=\"transitions-column-header\">\n          <span className=\"transitions-column-icon\">\ud83d\udd04</span>\n          <span className=\"transitions-column-title\">Exit</span>\n          <span className=\"transitions-column-subtitle\">When era ends</span>\n        </div>\n\n        <MiniSection\n          title=\"Conditions\"\n          icon=\"?\"\n          count={exitConditions.length}\n          isEmpty={exitConditions.length === 0}\n          emptyMessage=\"No exit conditions \u2014 transitions immediately\"\n        >\n          {exitConditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdateExitCondition(index, updated)}\n              onRemove={() => onRemoveExitCondition(index)}\n              pressures={pressures}\n              schema={schema}\n              eras={eras}\n            />\n          ))}\n          <AddItemButton\n            onClick={onAddExitCondition}\n            label=\"+ Condition\"\n            styles={ADD_ITEM_STYLES}\n          />\n        </MiniSection>\n\n        <MiniSection\n          title=\"Effects\"\n          icon=\"\ud83d\udcab\"\n          count={exitPressureChanges.length}\n          isEmpty={exitPressureChanges.length === 0}\n          emptyMessage=\"No pressure changes on exit\"\n        >\n          {exitPressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdateExitEffect(pressureId, newValue)}\n              onRemove={() => onRemoveExitEffect(pressureId)}\n              pressures={pressures}\n            />\n          ))}\n          <div className=\"transitions-add-effect\">\n            <SearchableDropdown\n              items={availablePressuresForExit}\n              onSelect={onAddExitEffect}\n              placeholder=\"+ Add effect...\"\n              emptyMessage=\"All pressures added\"\n            />\n          </div>\n        </MiniSection>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  entryConditions = [],\n  exitConditions = [],\n  entryPressureChanges = [],\n  exitPressureChanges = [],\n  onUpdateEntryCondition,\n  onRemoveEntryCondition,\n  onAddEntryCondition,\n  onUpdateExitCondition,\n  onRemoveExitCondition,\n  onAddExitCondition,\n  onUpdateEntryEffect,\n  onRemoveEntryEffect,\n  onAddEntryEffect,\n  onUpdateExitEffect,\n  onRemoveExitEffect,\n  onAddExitEffect,\n  availablePressuresForEntry = [],\n  availablePressuresForExit = [],\n  pressures = [],\n  schema,\n  eras = [],\n}", "type": "{ entryConditions: any[]; exitConditions: any[]; entryPressureChanges: any[]; exitPressureChanges: any[]; onUpdateEntryCondition: Function; onRemoveEntryCondition: Function; onAddEntryCondition: Function; onUpdateExitCondition: Function; onRemoveExitCondition: Function; onAddExitCondition: Function; onUpdateEntryEffect: Function; onRemoveEntryEffect: Function; onAddEntryEffect: Function; onUpdateExitEffect: Function; onRemoveExitEffect: Function; onAddExitEffect: Function; availablePressuresF...", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionConditionEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "AddItemButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionEffectItem", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "SearchableDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionConditionEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "AddItemButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionEffectItem", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "SearchableDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/TransitionsGrid.jsx::TransitionsGrid", "name": "TransitionsGrid", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/TransitionsGrid.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.entryConditions - Entry condition array\n * @param {Array} props.exitConditions - Exit condition array\n * @param {Array} props.entryPressureChanges - Entry effect tuples\n * @param {Array} props.exitPressureChanges - Exit effect tuples\n * @param {Function} props.onUpdateEntryCondition\n * @param {Function} props.onRemoveEntryCondition\n * @param {Function} props.onAddEntryCondition\n * @param {Function} props.onUpdateExitCondition\n * @param {Function} props.onRemoveExitCondition\n * @param {Function} props.onAddExitCondition\n * @param {Function} props.onUpdateEntryEffect\n * @param {Function} props.onRemoveEntryEffect\n * @param {Function} props.onAddEntryEffect\n * @param {Function} props.onUpdateExitEffect\n * @param {Function} props.onRemoveExitEffect\n * @param {Function} props.onAddExitEffect\n * @param {Array} props.availablePressuresForEntry\n * @param {Array} props.availablePressuresForExit\n * @param {Array} props.pressures - All pressures for display\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.eras - All eras for era-specific conditions\n */\nexport function TransitionsGrid({\n  entryConditions = [],\n  exitConditions = [],\n  entryPressureChanges = [],\n  exitPressureChanges = [],\n  onUpdateEntryCondition,\n  onRemoveEntryCondition,\n  onAddEntryCondition,\n  onUpdateExitCondition,\n  onRemoveExitCondition,\n  onAddExitCondition,\n  onUpdateEntryEffect,\n  onRemoveEntryEffect,\n  onAddEntryEffect,\n  onUpdateExitEffect,\n  onRemoveExitEffect,\n  onAddExitEffect,\n  availablePressuresForEntry = [],\n  availablePressuresForExit = [],\n  pressures = [],\n  schema,\n  eras = [],\n}) {\n  return (\n    <div className=\"transitions-grid\">\n      {/* Entry Column */}\n      <div className=\"transitions-column transitions-entry\">\n        <div className=\"transitions-column-header\">\n          <span className=\"transitions-column-icon\">\ud83d\udeaa</span>\n          <span className=\"transitions-column-title\">Entry</span>\n          <span className=\"transitions-column-subtitle\">When era starts</span>\n        </div>\n\n        <MiniSection\n          title=\"Conditions\"\n          icon=\"?\"\n          count={entryConditions.length}\n          isEmpty={entryConditions.length === 0}\n          emptyMessage=\"No entry conditions \u2014 starts immediately\"\n        >\n          {entryConditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdateEntryCondition(index, updated)}\n              onRemove={() => onRemoveEntryCondition(index)}\n              pressures={pressures}\n              schema={schema}\n              eras={eras}\n            />\n          ))}\n          <AddItemButton\n            onClick={onAddEntryCondition}\n            label=\"+ Condition\"\n            styles={ADD_ITEM_STYLES}\n          />\n        </MiniSection>\n\n        <MiniSection\n          title=\"Effects\"\n          icon=\"\u2728\"\n          count={entryPressureChanges.length}\n          isEmpty={entryPressureChanges.length === 0}\n          emptyMessage=\"No pressure changes on entry\"\n        >\n          {entryPressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdateEntryEffect(pressureId, newValue)}\n              onRemove={() => onRemoveEntryEffect(pressureId)}\n              pressures={pressures}\n            />\n          ))}\n          <div className=\"transitions-add-effect\">\n            <SearchableDropdown\n              items={availablePressuresForEntry}\n              onSelect={onAddEntryEffect}\n              placeholder=\"+ Add effect...\"\n              emptyMessage=\"All pressures added\"\n            />\n          </div>\n        </MiniSection>\n      </div>\n\n      {/* Arrow divider */}\n      <div className=\"transitions-divider\">\n        <span className=\"transitions-arrow\">\u2192</span>\n      </div>\n\n      {/* Exit Column */}\n      <div className=\"transitions-column transitions-exit\">\n        <div className=\"transitions-column-header\">\n          <span className=\"transitions-column-icon\">\ud83d\udd04</span>\n          <span className=\"transitions-column-title\">Exit</span>\n          <span className=\"transitions-column-subtitle\">When era ends</span>\n        </div>\n\n        <MiniSection\n          title=\"Conditions\"\n          icon=\"?\"\n          count={exitConditions.length}\n          isEmpty={exitConditions.length === 0}\n          emptyMessage=\"No exit conditions \u2014 transitions immediately\"\n        >\n          {exitConditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdateExitCondition(index, updated)}\n              onRemove={() => onRemoveExitCondition(index)}\n              pressures={pressures}\n              schema={schema}\n              eras={eras}\n            />\n          ))}\n          <AddItemButton\n            onClick={onAddExitCondition}\n            label=\"+ Condition\"\n            styles={ADD_ITEM_STYLES}\n          />\n        </MiniSection>\n\n        <MiniSection\n          title=\"Effects\"\n          icon=\"\ud83d\udcab\"\n          count={exitPressureChanges.length}\n          isEmpty={exitPressureChanges.length === 0}\n          emptyMessage=\"No pressure changes on exit\"\n        >\n          {exitPressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdateExitEffect(pressureId, newValue)}\n              onRemove={() => onRemoveExitEffect(pressureId)}\n              pressures={pressures}\n            />\n          ))}\n          <div className=\"transitions-add-effect\">\n            <SearchableDropdown\n              items={availablePressuresForExit}\n              onSelect={onAddExitEffect}\n              placeholder=\"+ Add effect...\"\n              emptyMessage=\"All pressures added\"\n            />\n          </div>\n        </MiniSection>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  entryConditions = [],\n  exitConditions = [],\n  entryPressureChanges = [],\n  exitPressureChanges = [],\n  onUpdateEntryCondition,\n  onRemoveEntryCondition,\n  onAddEntryCondition,\n  onUpdateExitCondition,\n  onRemoveExitCondition,\n  onAddExitCondition,\n  onUpdateEntryEffect,\n  onRemoveEntryEffect,\n  onAddEntryEffect,\n  onUpdateExitEffect,\n  onRemoveExitEffect,\n  onAddExitEffect,\n  availablePressuresForEntry = [],\n  availablePressuresForExit = [],\n  pressures = [],\n  schema,\n  eras = [],\n}", "type": "{ entryConditions: any[]; exitConditions: any[]; entryPressureChanges: any[]; exitPressureChanges: any[]; onUpdateEntryCondition: Function; onRemoveEntryCondition: Function; onAddEntryCondition: Function; onUpdateExitCondition: Function; onRemoveExitCondition: Function; onAddExitCondition: Function; onUpdateEntryEffect: Function; onRemoveEntryEffect: Function; onAddEntryEffect: Function; onUpdateExitEffect: Function; onRemoveExitEffect: Function; onAddExitEffect: Function; availablePressuresF...", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionConditionEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "AddItemButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionEffectItem", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "SearchableDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionConditionEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "AddItemButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionEffectItem", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "SearchableDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["AddItemButton", "SearchableDropdown"], "category": "internal"}, {"source": "../shared", "specifiers": ["TransitionConditionEditor", "TransitionEffectItem"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/shared/index.js::TransitionConditionEditor", "name": "TransitionConditionEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.condition - The condition object\n * @param {number} props.index - Index in the conditions array\n * @param {Function} props.onChange - Called when condition changes\n * @param {Function} props.onRemove - Called to remove condition\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.eras - Era definitions (optional)\n */\nexport function TransitionConditionEditor({\n  condition,\n  index: _index,\n  onChange,\n  onRemove,\n  pressures,\n  schema,\n  eras,\n}) {\n  return (\n    <ApplicabilityRuleCard\n      rule={condition}\n      onChange={(updated) => onChange(updated)}\n      onRemove={onRemove}\n      schema={schema}\n      pressures={pressures}\n      eras={eras}\n      depth={0}\n    />\n  );\n}", "parameters": [{"name": "{\n  condition,\n  index: _index,\n  onChange,\n  onRemove,\n  pressures,\n  schema,\n  eras,\n}", "type": "{ condition: any; index: number; onChange: Function; onRemove: Function; pressures: any[]; schema: any; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "ApplicabilityRuleCard", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/shared/index.js::TransitionEffectItem", "name": "TransitionEffectItem", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.pressureId - The pressure ID\n * @param {number} props.value - The delta value\n * @param {Function} props.onChange - Called when value changes\n * @param {Function} props.onRemove - Called to remove effect\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function TransitionEffectItem({ pressureId, value, onChange, onRemove, pressures }) {\n  const pressure = pressures.find((p) => p.id === pressureId);\n\n  return (\n    <ItemRow name={pressure?.name || pressureId} onRemove={onRemove} removeTitle=\"Remove effect\">\n      <NumberInput\n        value={value}\n        onChange={(v) => onChange(v ?? 0)}\n        className={`input input-compact input-centered ${value >= 0 ? \"text-success\" : \"text-danger\"}`}\n        integer\n      />\n      <span className=\"text-dim text-sm tei-pressure-label\">\n        {value >= 0 ? \"+\" : \"\"}\n        {value} pressure\n      </span>\n    </ItemRow>\n  );\n}", "parameters": [{"name": "{ pressureId, value, onChange, onRemove, pressures }", "type": "{ pressureId: string; value: number; onChange: Function; onRemove: Function; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "ItemRow", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/shared/TransitionConditionEditor.jsx::TransitionConditionEditor", "name": "TransitionConditionEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/shared/TransitionConditionEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.condition - The condition object\n * @param {number} props.index - Index in the conditions array\n * @param {Function} props.onChange - Called when condition changes\n * @param {Function} props.onRemove - Called to remove condition\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.eras - Era definitions (optional)\n */\nexport function TransitionConditionEditor({\n  condition,\n  index: _index,\n  onChange,\n  onRemove,\n  pressures,\n  schema,\n  eras,\n}) {\n  return (\n    <ApplicabilityRuleCard\n      rule={condition}\n      onChange={(updated) => onChange(updated)}\n      onRemove={onRemove}\n      schema={schema}\n      pressures={pressures}\n      eras={eras}\n      depth={0}\n    />\n  );\n}", "parameters": [{"name": "{\n  condition,\n  index: _index,\n  onChange,\n  onRemove,\n  pressures,\n  schema,\n  eras,\n}", "type": "{ condition: any; index: number; onChange: Function; onRemove: Function; pressures: any[]; schema: any; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "ApplicabilityRuleCard", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../generators/applicability/ApplicabilityRuleCard", "specifiers": ["ApplicabilityRuleCard"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/shared/TransitionEffectItem.jsx::TransitionEffectItem", "name": "TransitionEffectItem", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/shared/TransitionEffectItem.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.pressureId - The pressure ID\n * @param {number} props.value - The delta value\n * @param {Function} props.onChange - Called when value changes\n * @param {Function} props.onRemove - Called to remove effect\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function TransitionEffectItem({ pressureId, value, onChange, onRemove, pressures }) {\n  const pressure = pressures.find((p) => p.id === pressureId);\n\n  return (\n    <ItemRow name={pressure?.name || pressureId} onRemove={onRemove} removeTitle=\"Remove effect\">\n      <NumberInput\n        value={value}\n        onChange={(v) => onChange(v ?? 0)}\n        className={`input input-compact input-centered ${value >= 0 ? \"text-success\" : \"text-danger\"}`}\n        integer\n      />\n      <span className=\"text-dim text-sm tei-pressure-label\">\n        {value >= 0 ? \"+\" : \"\"}\n        {value} pressure\n      </span>\n    </ItemRow>\n  );\n}", "parameters": [{"name": "{ pressureId, value, onChange, onRemove, pressures }", "type": "{ pressureId: string; value: number; onChange: Function; onRemove: Function; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "ItemRow", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["ItemRow", "NumberInput"], "category": "internal"}, {"source": "./TransitionEffectItem.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/AddRuleButton.jsx::AddRuleButton", "name": "AddRuleButton", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/AddRuleButton.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Function} props.onAdd - Callback when a rule type is selected\n * @param {number} props.depth - Nesting depth (limits nested rule types at depth >= 2)\n */\nexport function AddRuleButton({ onAdd, depth = 0 }) {\n  const [showPicker, setShowPicker] = useState(false);\n\n  return (\n    <div className=\"dropdown\">\n      <button className=\"btn-add\" onClick={() => setShowPicker(!showPicker)}>\n        + Add Rule\n      </button>\n\n      {showPicker && (\n        <div className=\"dropdown-menu arb-dropdown\">\n          <div className=\"dropdown-options\">\n            {Object.entries(APPLICABILITY_TYPES)\n              .filter(([type]) => depth < 2 || (type !== \"or\" && type !== \"and\"))\n              .map(([type, config]) => (\n                <div\n                  key={type}\n                  className=\"dropdown-menu-item\"\n                  onClick={() => {\n                    onAdd(type);\n                    setShowPicker(false);\n                  }}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <div\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n                    style={{ '--arb-icon-bg': `${config.color}20`, backgroundColor: 'var(--arb-icon-bg)' }}\n                  >\n                    {config.icon}\n                  </div>\n                  <div>\n                    <div className=\"dropdown-menu-label\">{config.label}</div>\n                    <div className=\"arb-desc\">\n                      {config.desc}\n                    </div>\n                  </div>\n                </div>\n              ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ onAdd, depth = 0 }", "type": "{ onAdd: Function; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["APPLICABILITY_TYPES"], "category": "internal"}, {"source": "./AddRuleButton.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityRuleCard.jsx::ApplicabilityRuleCard", "name": "ApplicabilityRuleCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityRuleCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.rule - The rule configuration\n * @param {Function} props.onChange - Callback when rule changes\n * @param {Function} props.onRemove - Callback to remove this rule\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {number} props.depth - Nesting depth for nested rules\n */\nexport function ApplicabilityRuleCard({\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = APPLICABILITY_TYPES[rule.type] || {};\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const getSubtypesForKind = (kind) => {\n    const ek = entityKinds.find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const pressureOptions = (pressures || []).map((p) => ({\n    value: p.id,\n    label: p.name || p.id,\n  }));\n\n  const eraOptions = (eras || []).map((e) => ({\n    value: e.id,\n    label: e.name || e.id,\n  }));\n\n  const updateField = (field, value) => {\n    onChange({ ...rule, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (rule.type) {\n      case \"entity_count\": {\n        const kindSpec = `${rule.kind || \"?\"}${rule.subtype ? \":\" + rule.subtype : \"\"}`;\n        const minPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const maxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${kindSpec} ${minPart}${maxPart}`;\n      }\n      case \"pressure\":\n        return `${rule.pressureId || \"?\"} in [${rule.min ?? \"-\\u221E\"}, ${rule.max ?? \"\\u221E\"}]`;\n      case \"pressure_any_above\":\n        return `Any of [${rule.pressureIds?.join(\", \") || \"?\"}] > ${rule.threshold ?? \"?\"}`;\n      case \"pressure_compare\":\n        return `${rule.pressureA || \"?\"} ${rule.operator || \">\"} ${rule.pressureB || \"?\"}`;\n      case \"relationship_count\": {\n        const relMinPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const relMaxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${rule.relationshipKind || \"any\"} count ${relMinPart}${relMaxPart}`;\n      }\n      case \"relationship_exists\": {\n        const targetSuffix = rule.targetKind ? ` to ${rule.targetKind}` : \"\";\n        return `${rule.relationshipKind || \"?\"} exists${targetSuffix}`;\n      }\n      case \"tag_exists\":\n        return `has tag \"${rule.tag || \"?\"}\"`;\n      case \"tag_absent\":\n        return `missing tag \"${rule.tag || \"?\"}\"`;\n      case \"status\":\n        return rule.not ? `status != ${rule.status || \"?\"}` : `status = ${rule.status || \"?\"}`;\n      case \"prominence\":\n        return `prominence ${rule.min || \"?\"}-${rule.max || \"?\"}`;\n      case \"time_elapsed\":\n        return `${rule.minTicks || \"?\"} ticks since ${rule.since || \"updated\"}`;\n      case \"growth_phases_complete\": {\n        const eraSuffix = rule.eraId ? ` in ${rule.eraId}` : \"\";\n        return `${rule.minPhases ?? \"?\"} growth phases${eraSuffix}`;\n      }\n      case \"era_match\":\n        return rule.eras?.length ? rule.eras.join(\", \") : \"No eras selected\";\n      case \"random_chance\":\n        return `${Math.round((rule.chance ?? 0.5) * 100)}% chance`;\n      case \"cooldown_elapsed\":\n        return `${rule.cooldownTicks ?? \"?\"} ticks since last run`;\n      case \"creations_per_epoch\":\n        return `max ${rule.maxPerEpoch ?? \"?\"} per epoch`;\n      case \"graph_path\":\n        return `graph path (${rule.assert?.check || \"exists\"})`;\n      case \"entity_exists\":\n        return `entity ${rule.entity || \"?\"} exists`;\n      case \"entity_has_relationship\":\n        return `${rule.entity || \"?\"} has ${rule.relationshipKind || \"?\"} relationship`;\n      case \"or\":\n      case \"and\":\n        return `${rule.conditions?.length || 0} sub-rules`;\n      case \"always\":\n        return \"always\";\n      default:\n        return rule.type;\n    }\n  };\n\n  const isNested = rule.type === \"or\" || rule.type === \"and\";\n\n  return (\n    <div className=\"condition-card\">\n      <div className=\"condition-card-header\">\n        <div className=\"condition-card-type\">\n          <div\n            className=\"condition-card-icon\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n            style={{ '--arc-icon-bg': `${typeConfig.color || \"#3b82f6\"}20`, backgroundColor: 'var(--arc-icon-bg)' }}\n          >\n            {typeConfig.icon || \"\ud83d\udccb\"}\n          </div>\n          <div>\n            <div className=\"condition-card-label\">{typeConfig.label || rule.type}</div>\n            <div className=\"condition-card-summary\">{getSummary()}</div>\n          </div>\n        </div>\n        <div className=\"condition-card-actions\">\n          <button className=\"btn-icon\" onClick={() => setExpanded(!expanded)}>\n            {expanded ? \"^\" : \"v\"}\n          </button>\n          <button className=\"btn-icon btn-icon-danger\" onClick={onRemove}>\n            x\n          </button>\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"mt-lg\">\n          <div className=\"form-grid\">\n            {rule.type === \"entity_count\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={rule.kind}\n                  onChange={(v) => {\n                    updateField(\"kind\", v);\n                    if (rule.subtype) updateField(\"subtype\", undefined);\n                  }}\n                  options={entityKindOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Subtype (optional)\"\n                  value={rule.subtype || \"\"}\n                  onChange={(v) => updateField(\"subtype\", v || undefined)}\n                  options={[{ value: \"\", label: \"Any\" }, ...getSubtypesForKind(rule.kind)]}\n                  placeholder=\"Any\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure\"\n                  value={rule.pressureId}\n                  onChange={(v) => updateField(\"pressureId\", v)}\n                  options={pressureOptions}\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min Value\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"0\"\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max Value\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"100\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_any_above\" && (\n              <>\n                <div className=\"grid-col-full\">\n                  <ChipSelect\n                    label=\"Pressures\"\n                    value={rule.pressureIds || []}\n                    onChange={(v) => updateField(\"pressureIds\", v)}\n                    options={pressureOptions}\n                    placeholder=\"+ Add pressure\"\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Threshold\n                  <NumberInput\n                    value={rule.threshold}\n                    onChange={(v) => updateField(\"threshold\", v ?? 0)}\n                    min={-100}\n                    max={100}\n                    integer\n                    placeholder=\"50\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_compare\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure A\"\n                  value={rule.pressureA}\n                  onChange={(v) => updateField(\"pressureA\", v)}\n                  options={pressureOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Operator\"\n                  value={rule.operator || \">\"}\n                  onChange={(v) => updateField(\"operator\", v)}\n                  options={[\n                    { value: \">\", label: \">\" },\n                    { value: \">=\", label: \">=\" },\n                    { value: \"<\", label: \"<\" },\n                    { value: \"<=\", label: \"<=\" },\n                    { value: \"==\", label: \"==\" },\n                    { value: \"!=\", label: \"!=\" },\n                  ]}\n                />\n                <ReferenceDropdown\n                  label=\"Pressure B\"\n                  value={rule.pressureB}\n                  onChange={(v) => updateField(\"pressureB\", v)}\n                  options={pressureOptions}\n                />\n              </>\n            )}\n\n\n            {rule.type === \"era_match\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Eras\"\n                  value={rule.eras || []}\n                  onChange={(v) => updateField(\"eras\", v)}\n                  options={eraOptions}\n                  placeholder=\"+ Add era\"\n                />\n              </div>\n            )}\n\n            {rule.type === \"random_chance\" && (\n              <div className=\"form-group grid-col-full\">\n                <span className=\"label\">Chance (%)</span>\n                <div className=\"flex items-center gap-lg\">\n// ... (truncated)", "parameters": [{"name": "{\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}", "type": "{ rule: any; onChange: Function; onRemove: Function; schema: any; pressures: any[]; eras: any[]; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}, {"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "GraphPathEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ApplicabilityRuleCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["APPLICABILITY_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "ChipSelect", "NumberInput", "PROMINENCE_LEVELS"], "category": "internal"}, {"source": "./AddRuleButton", "specifiers": ["AddRuleButton"], "category": "internal"}, {"source": "./createNewRule", "specifiers": ["createNewRule"], "category": "internal"}, {"source": "../filters/GraphPathEditor", "specifiers": ["GraphPathEditor"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityTab.jsx::ApplicabilityTab", "name": "ApplicabilityTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n */\nexport function ApplicabilityTab({ generator, onChange, schema, pressures, eras }) {\n  const rules = generator.applicability || [];\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Applicability Rules</div>\n        <div className=\"section-desc\">\n          Define when this generator is eligible to run. If no rules are defined, the generator will\n          always be eligible. Multiple top-level rules are combined with AND logic.\n        </div>\n\n        {rules.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2713</div>\n            <div className=\"empty-state-title\">No applicability rules</div>\n            <div className=\"empty-state-desc\">\n              This generator will always be eligible to run. Add rules to control when it activates.\n            </div>\n          </div>\n        ) : (\n          rules.map((rule, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={rule}\n              onChange={(updated) => {\n                const newRules = [...rules];\n                newRules[index] = updated;\n                onChange({ ...generator, applicability: newRules });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, applicability: rules.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              pressures={pressures}\n              eras={eras}\n            />\n          ))\n        )}\n\n        <AddRuleButton\n          onAdd={(type) => {\n            const newRule = createNewRule(type, pressures);\n            onChange({ ...generator, applicability: [...rules, newRule] });\n          }}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema, pressures, eras }", "type": "{ generator: any; onChange: Function; schema: any; pressures: any[]; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./ApplicabilityRuleCard", "specifiers": ["ApplicabilityRuleCard"], "category": "internal"}, {"source": "./AddRuleButton", "specifiers": ["AddRuleButton"], "category": "internal"}, {"source": "./createNewRule", "specifiers": ["createNewRule"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/index.js::AddRuleButton", "name": "AddRuleButton", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Function} props.onAdd - Callback when a rule type is selected\n * @param {number} props.depth - Nesting depth (limits nested rule types at depth >= 2)\n */\nexport function AddRuleButton({ onAdd, depth = 0 }) {\n  const [showPicker, setShowPicker] = useState(false);\n\n  return (\n    <div className=\"dropdown\">\n      <button className=\"btn-add\" onClick={() => setShowPicker(!showPicker)}>\n        + Add Rule\n      </button>\n\n      {showPicker && (\n        <div className=\"dropdown-menu arb-dropdown\">\n          <div className=\"dropdown-options\">\n            {Object.entries(APPLICABILITY_TYPES)\n              .filter(([type]) => depth < 2 || (type !== \"or\" && type !== \"and\"))\n              .map(([type, config]) => (\n                <div\n                  key={type}\n                  className=\"dropdown-menu-item\"\n                  onClick={() => {\n                    onAdd(type);\n                    setShowPicker(false);\n                  }}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <div\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n                    style={{ '--arb-icon-bg': `${config.color}20`, backgroundColor: 'var(--arb-icon-bg)' }}\n                  >\n                    {config.icon}\n                  </div>\n                  <div>\n                    <div className=\"dropdown-menu-label\">{config.label}</div>\n                    <div className=\"arb-desc\">\n                      {config.desc}\n                    </div>\n                  </div>\n                </div>\n              ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ onAdd, depth = 0 }", "type": "{ onAdd: Function; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/index.js::ApplicabilityRuleCard", "name": "ApplicabilityRuleCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.rule - The rule configuration\n * @param {Function} props.onChange - Callback when rule changes\n * @param {Function} props.onRemove - Callback to remove this rule\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {number} props.depth - Nesting depth for nested rules\n */\nexport function ApplicabilityRuleCard({\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = APPLICABILITY_TYPES[rule.type] || {};\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const getSubtypesForKind = (kind) => {\n    const ek = entityKinds.find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const pressureOptions = (pressures || []).map((p) => ({\n    value: p.id,\n    label: p.name || p.id,\n  }));\n\n  const eraOptions = (eras || []).map((e) => ({\n    value: e.id,\n    label: e.name || e.id,\n  }));\n\n  const updateField = (field, value) => {\n    onChange({ ...rule, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (rule.type) {\n      case \"entity_count\": {\n        const kindSpec = `${rule.kind || \"?\"}${rule.subtype ? \":\" + rule.subtype : \"\"}`;\n        const minPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const maxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${kindSpec} ${minPart}${maxPart}`;\n      }\n      case \"pressure\":\n        return `${rule.pressureId || \"?\"} in [${rule.min ?? \"-\\u221E\"}, ${rule.max ?? \"\\u221E\"}]`;\n      case \"pressure_any_above\":\n        return `Any of [${rule.pressureIds?.join(\", \") || \"?\"}] > ${rule.threshold ?? \"?\"}`;\n      case \"pressure_compare\":\n        return `${rule.pressureA || \"?\"} ${rule.operator || \">\"} ${rule.pressureB || \"?\"}`;\n      case \"relationship_count\": {\n        const relMinPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const relMaxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${rule.relationshipKind || \"any\"} count ${relMinPart}${relMaxPart}`;\n      }\n      case \"relationship_exists\": {\n        const targetSuffix = rule.targetKind ? ` to ${rule.targetKind}` : \"\";\n        return `${rule.relationshipKind || \"?\"} exists${targetSuffix}`;\n      }\n      case \"tag_exists\":\n        return `has tag \"${rule.tag || \"?\"}\"`;\n      case \"tag_absent\":\n        return `missing tag \"${rule.tag || \"?\"}\"`;\n      case \"status\":\n        return rule.not ? `status != ${rule.status || \"?\"}` : `status = ${rule.status || \"?\"}`;\n      case \"prominence\":\n        return `prominence ${rule.min || \"?\"}-${rule.max || \"?\"}`;\n      case \"time_elapsed\":\n        return `${rule.minTicks || \"?\"} ticks since ${rule.since || \"updated\"}`;\n      case \"growth_phases_complete\": {\n        const eraSuffix = rule.eraId ? ` in ${rule.eraId}` : \"\";\n        return `${rule.minPhases ?? \"?\"} growth phases${eraSuffix}`;\n      }\n      case \"era_match\":\n        return rule.eras?.length ? rule.eras.join(\", \") : \"No eras selected\";\n      case \"random_chance\":\n        return `${Math.round((rule.chance ?? 0.5) * 100)}% chance`;\n      case \"cooldown_elapsed\":\n        return `${rule.cooldownTicks ?? \"?\"} ticks since last run`;\n      case \"creations_per_epoch\":\n        return `max ${rule.maxPerEpoch ?? \"?\"} per epoch`;\n      case \"graph_path\":\n        return `graph path (${rule.assert?.check || \"exists\"})`;\n      case \"entity_exists\":\n        return `entity ${rule.entity || \"?\"} exists`;\n      case \"entity_has_relationship\":\n        return `${rule.entity || \"?\"} has ${rule.relationshipKind || \"?\"} relationship`;\n      case \"or\":\n      case \"and\":\n        return `${rule.conditions?.length || 0} sub-rules`;\n      case \"always\":\n        return \"always\";\n      default:\n        return rule.type;\n    }\n  };\n\n  const isNested = rule.type === \"or\" || rule.type === \"and\";\n\n  return (\n    <div className=\"condition-card\">\n      <div className=\"condition-card-header\">\n        <div className=\"condition-card-type\">\n          <div\n            className=\"condition-card-icon\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n            style={{ '--arc-icon-bg': `${typeConfig.color || \"#3b82f6\"}20`, backgroundColor: 'var(--arc-icon-bg)' }}\n          >\n            {typeConfig.icon || \"\ud83d\udccb\"}\n          </div>\n          <div>\n            <div className=\"condition-card-label\">{typeConfig.label || rule.type}</div>\n            <div className=\"condition-card-summary\">{getSummary()}</div>\n          </div>\n        </div>\n        <div className=\"condition-card-actions\">\n          <button className=\"btn-icon\" onClick={() => setExpanded(!expanded)}>\n            {expanded ? \"^\" : \"v\"}\n          </button>\n          <button className=\"btn-icon btn-icon-danger\" onClick={onRemove}>\n            x\n          </button>\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"mt-lg\">\n          <div className=\"form-grid\">\n            {rule.type === \"entity_count\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={rule.kind}\n                  onChange={(v) => {\n                    updateField(\"kind\", v);\n                    if (rule.subtype) updateField(\"subtype\", undefined);\n                  }}\n                  options={entityKindOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Subtype (optional)\"\n                  value={rule.subtype || \"\"}\n                  onChange={(v) => updateField(\"subtype\", v || undefined)}\n                  options={[{ value: \"\", label: \"Any\" }, ...getSubtypesForKind(rule.kind)]}\n                  placeholder=\"Any\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure\"\n                  value={rule.pressureId}\n                  onChange={(v) => updateField(\"pressureId\", v)}\n                  options={pressureOptions}\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min Value\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"0\"\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max Value\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"100\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_any_above\" && (\n              <>\n                <div className=\"grid-col-full\">\n                  <ChipSelect\n                    label=\"Pressures\"\n                    value={rule.pressureIds || []}\n                    onChange={(v) => updateField(\"pressureIds\", v)}\n                    options={pressureOptions}\n                    placeholder=\"+ Add pressure\"\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Threshold\n                  <NumberInput\n                    value={rule.threshold}\n                    onChange={(v) => updateField(\"threshold\", v ?? 0)}\n                    min={-100}\n                    max={100}\n                    integer\n                    placeholder=\"50\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_compare\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure A\"\n                  value={rule.pressureA}\n                  onChange={(v) => updateField(\"pressureA\", v)}\n                  options={pressureOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Operator\"\n                  value={rule.operator || \">\"}\n                  onChange={(v) => updateField(\"operator\", v)}\n                  options={[\n                    { value: \">\", label: \">\" },\n                    { value: \">=\", label: \">=\" },\n                    { value: \"<\", label: \"<\" },\n                    { value: \"<=\", label: \"<=\" },\n                    { value: \"==\", label: \"==\" },\n                    { value: \"!=\", label: \"!=\" },\n                  ]}\n                />\n                <ReferenceDropdown\n                  label=\"Pressure B\"\n                  value={rule.pressureB}\n                  onChange={(v) => updateField(\"pressureB\", v)}\n                  options={pressureOptions}\n                />\n              </>\n            )}\n\n\n            {rule.type === \"era_match\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Eras\"\n                  value={rule.eras || []}\n                  onChange={(v) => updateField(\"eras\", v)}\n                  options={eraOptions}\n                  placeholder=\"+ Add era\"\n                />\n              </div>\n            )}\n\n            {rule.type === \"random_chance\" && (\n              <div className=\"form-group grid-col-full\">\n                <span className=\"label\">Chance (%)</span>\n                <div className=\"flex items-center gap-lg\">\n// ... (truncated)", "parameters": [{"name": "{\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}", "type": "{ rule: any; onChange: Function; onRemove: Function; schema: any; pressures: any[]; eras: any[]; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}, {"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "GraphPathEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ApplicabilityRuleCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/index.js::ApplicabilityTab", "name": "ApplicabilityTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n */\nexport function ApplicabilityTab({ generator, onChange, schema, pressures, eras }) {\n  const rules = generator.applicability || [];\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Applicability Rules</div>\n        <div className=\"section-desc\">\n          Define when this generator is eligible to run. If no rules are defined, the generator will\n          always be eligible. Multiple top-level rules are combined with AND logic.\n        </div>\n\n        {rules.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2713</div>\n            <div className=\"empty-state-title\">No applicability rules</div>\n            <div className=\"empty-state-desc\">\n              This generator will always be eligible to run. Add rules to control when it activates.\n            </div>\n          </div>\n        ) : (\n          rules.map((rule, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={rule}\n              onChange={(updated) => {\n                const newRules = [...rules];\n                newRules[index] = updated;\n                onChange({ ...generator, applicability: newRules });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, applicability: rules.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              pressures={pressures}\n              eras={eras}\n            />\n          ))\n        )}\n\n        <AddRuleButton\n          onAdd={(type) => {\n            const newRule = createNewRule(type, pressures);\n            onChange({ ...generator, applicability: [...rules, newRule] });\n          }}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema, pressures, eras }", "type": "{ generator: any; onChange: Function; schema: any; pressures: any[]; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/cards/GeneratorListCard.jsx::GeneratorListCard", "name": "GeneratorListCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/cards/GeneratorListCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator to display\n * @param {Function} props.onClick - Callback when card is clicked\n * @param {Function} props.onToggle - Callback to toggle enabled state\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport function GeneratorListCard({ generator, onClick, onToggle, usageMap }) {\n  const isEnabled = generator.enabled !== false;\n\n  const summary = useMemo(() => {\n    const creates =\n      generator.creation?.map((c) => c.kind).filter((v, i, a) => a.indexOf(v) === i) || [];\n    const rels = generator.relationships?.length || 0;\n    const effects = generator.stateUpdates?.length || 0;\n    return { creates, rels, effects };\n  }, [generator]);\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"generator\", generator.id)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, generator.id]\n  );\n\n  const eraUsage = useMemo(() => {\n    if (!usageMap?.generators?.[generator.id]) return [];\n    return usageMap.generators[generator.id].eras || [];\n  }, [usageMap, generator.id]);\n\n  const errorCount = validation.invalidRefs.length;\n  const hasErrors = errorCount > 0;\n  const isOrphan = validation.isOrphan;\n\n  return (\n    <div\n      className={`card card-clickable ${!isEnabled ? \"card-disabled\" : \"\"} ${hasErrors ? \"card-error\" : \"\"} ${isOrphan && !hasErrors ? \"card-warning\" : \"\"}`}\n      onClick={onClick}\n      role=\"button\"\n      tabIndex={0}\n      onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }}\n    >\n      <div className=\"card-header\">\n        <div>\n          <div className=\"flex items-center gap-md\">\n            <span className=\"card-title\">{generator.name || generator.id}</span>\n            <ErrorBadge count={errorCount} />\n          </div>\n          <div className=\"card-id\">{generator.id}</div>\n        </div>\n        <EnableToggle\n          enabled={isEnabled}\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n        />\n      </div>\n\n      <div className=\"card-stats\">\n        <div className=\"card-stat\">\n          <span>\u2728</span> {generator.creation?.length || 0} creates\n        </div>\n        <div className=\"card-stat\">\n          <span>\ud83d\udd17</span> {summary.rels} rels\n        </div>\n        <div className=\"card-stat\">\n          <span>\u26a1</span> {summary.effects} effects\n        </div>\n      </div>\n\n      <div className=\"card-badges\">\n        {summary.creates.slice(0, 3).map((kind) => (\n          <span key={kind} className=\"badge badge-entity-kind\">\n            + {kind}\n          </span>\n        ))}\n      </div>\n\n      <EraBadges eras={eraUsage} />\n      {isOrphan && (\n        <div className=\"mt-md\">\n          <OrphanBadge isOrphan={isOrphan} />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onClick, onToggle, usageMap }", "type": "{ generator: any; onClick: Function; onToggle: Function; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "ErrorBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "EraBadges", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "OrphanBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 3}], "imports": [{"source": "react", "specifiers": ["React", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "@the-canonry/shared-components", "specifiers": ["getElementValidation"], "category": "external"}, {"source": "../../shared", "specifiers": ["ErrorBadge", "OrphanBadge", "EraBadges", "EnableToggle"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/cards/index.js::GeneratorListCard", "name": "GeneratorListCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/cards/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator to display\n * @param {Function} props.onClick - Callback when card is clicked\n * @param {Function} props.onToggle - Callback to toggle enabled state\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport function GeneratorListCard({ generator, onClick, onToggle, usageMap }) {\n  const isEnabled = generator.enabled !== false;\n\n  const summary = useMemo(() => {\n    const creates =\n      generator.creation?.map((c) => c.kind).filter((v, i, a) => a.indexOf(v) === i) || [];\n    const rels = generator.relationships?.length || 0;\n    const effects = generator.stateUpdates?.length || 0;\n    return { creates, rels, effects };\n  }, [generator]);\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"generator\", generator.id)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, generator.id]\n  );\n\n  const eraUsage = useMemo(() => {\n    if (!usageMap?.generators?.[generator.id]) return [];\n    return usageMap.generators[generator.id].eras || [];\n  }, [usageMap, generator.id]);\n\n  const errorCount = validation.invalidRefs.length;\n  const hasErrors = errorCount > 0;\n  const isOrphan = validation.isOrphan;\n\n  return (\n    <div\n      className={`card card-clickable ${!isEnabled ? \"card-disabled\" : \"\"} ${hasErrors ? \"card-error\" : \"\"} ${isOrphan && !hasErrors ? \"card-warning\" : \"\"}`}\n      onClick={onClick}\n      role=\"button\"\n      tabIndex={0}\n      onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }}\n    >\n      <div className=\"card-header\">\n        <div>\n          <div className=\"flex items-center gap-md\">\n            <span className=\"card-title\">{generator.name || generator.id}</span>\n            <ErrorBadge count={errorCount} />\n          </div>\n          <div className=\"card-id\">{generator.id}</div>\n        </div>\n        <EnableToggle\n          enabled={isEnabled}\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n        />\n      </div>\n\n      <div className=\"card-stats\">\n        <div className=\"card-stat\">\n          <span>\u2728</span> {generator.creation?.length || 0} creates\n        </div>\n        <div className=\"card-stat\">\n          <span>\ud83d\udd17</span> {summary.rels} rels\n        </div>\n        <div className=\"card-stat\">\n          <span>\u26a1</span> {summary.effects} effects\n        </div>\n      </div>\n\n      <div className=\"card-badges\">\n        {summary.creates.slice(0, 3).map((kind) => (\n          <span key={kind} className=\"badge badge-entity-kind\">\n            + {kind}\n          </span>\n        ))}\n      </div>\n\n      <EraBadges eras={eraUsage} />\n      {isOrphan && (\n        <div className=\"mt-md\">\n          <OrphanBadge isOrphan={isOrphan} />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onClick, onToggle, usageMap }", "type": "{ generator: any; onClick: Function; onToggle: Function; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "ErrorBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "EraBadges", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "OrphanBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 3}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/GraphPathEditor.jsx::GraphPathEditor", "name": "GraphPathEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/GraphPathEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.assert - The path assertion configuration\n * @param {Function} props.onChange - Callback when assertion changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function GraphPathEditor({ assert, onChange, schema, availableRefs }) {\n  const [showConstraintMenu, setShowConstraintMenu] = useState(false);\n\n  const assertion = assert || { check: \"exists\", path: [] };\n\n  const updateAssertion = (field, value) => {\n    onChange({ ...assertion, [field]: value });\n  };\n\n  const addStep = () => {\n    // Create with empty required fields - validation will flag them\n    const newStep = { via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" };\n    updateAssertion(\"path\", [...(assertion.path || []), newStep]);\n  };\n\n  const updateStep = (index, updated) => {\n    const newPath = [...(assertion.path || [])];\n    newPath[index] = updated;\n    updateAssertion(\"path\", newPath);\n  };\n\n  const removeStep = (index) => {\n    updateAssertion(\n      \"path\",\n      (assertion.path || []).filter((_, i) => i !== index)\n    );\n  };\n\n  const addConstraint = (type) => {\n    const newConstraint = { type };\n    if (type === \"has_relationship\" || type === \"lacks_relationship\") {\n      newConstraint.direction = \"any\";\n    }\n    updateAssertion(\"where\", [...(assertion.where || []), newConstraint]);\n    setShowConstraintMenu(false);\n  };\n\n  const updateConstraint = (index, updated) => {\n    const newWhere = [...(assertion.where || [])];\n    newWhere[index] = updated;\n    updateAssertion(\"where\", newWhere);\n  };\n\n  const removeConstraint = (index) => {\n    const newWhere = (assertion.where || []).filter((_, i) => i !== index);\n    updateAssertion(\"where\", newWhere.length > 0 ? newWhere : undefined);\n  };\n\n  // Collect variables from path steps for constraint references\n  const pathVars = (assertion.path || []).filter((s) => s.as).map((s) => s.as);\n  const allRefs = [...(availableRefs || []), ...pathVars];\n\n  return (\n    <div className=\"graph-path-editor\">\n      {/* Check type and count */}\n      <div className=\"path-editor-grid\">\n        <div>\n          <label className=\"label label-tiny\">Check Type\n          <ReferenceDropdown\n            value={assertion.check || \"exists\"}\n            onChange={(v) => updateAssertion(\"check\", v)}\n            options={PATH_CHECK_TYPES}\n          />\n          </label>\n        </div>\n        {(assertion.check === \"count_min\" || assertion.check === \"count_max\") && (\n          <div>\n            <label className=\"label label-tiny\">Count\n            <NumberInput\n              value={assertion.count ?? 1}\n              onChange={(v) => updateAssertion(\"count\", v ?? 1)}\n              min={0}\n              integer\n              className=\"input input-compact\"\n            />\n            </label>\n          </div>\n        )}\n      </div>\n\n      {/* Path steps */}\n      <div>\n        <span className=\"label label-tiny\">Path Steps (traverse relationships)</span>\n        <div className=\"path-steps-list\">\n          {(assertion.path || []).map((step, index) => (\n            <PathStepEditor\n              key={index}\n              step={step}\n              onChange={(updated) => updateStep(index, updated)}\n              onRemove={() => removeStep(index)}\n              schema={schema}\n              stepIndex={index}\n            />\n          ))}\n          {(assertion.path || []).length < 2 && (\n            <button onClick={addStep} className=\"button button-add-step\">\n              + Add Step {(assertion.path || []).length === 0 ? \"(required)\" : \"(optional)\"}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Where constraints */}\n      <div>\n        <span className=\"label label-tiny\">Where Constraints (optional)</span>\n        <div className=\"path-constraints-list\">\n          {(assertion.where || []).map((constraint, index) => (\n            <PathConstraintEditor\n              key={index}\n              constraint={constraint}\n              onChange={(updated) => updateConstraint(index, updated)}\n              onRemove={() => removeConstraint(index)}\n              schema={schema}\n              availableRefs={allRefs}\n            />\n          ))}\n          <div className=\"relative\">\n            <button\n              onClick={() => setShowConstraintMenu(!showConstraintMenu)}\n              className=\"button button-add-constraint\"\n            >\n              + Add Constraint\n            </button>\n            {showConstraintMenu && (\n              <div className=\"dropdown-menu\">\n                {PATH_CONSTRAINT_TYPES.map(({ value, label }) => (\n                  <div\n                    key={value}\n                    onClick={() => addConstraint(value)}\n                    className=\"dropdown-menu-item\"\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    {label}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ assert, onChange, schema, availableRefs }", "type": "{ assert: any; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "PathStepEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "PathConstraintEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["PATH_CHECK_TYPES", "PATH_CONSTRAINT_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput"], "category": "internal"}, {"source": "./PathStepEditor", "specifiers": ["PathStepEditor"], "category": "internal"}, {"source": "./PathConstraintEditor", "specifiers": ["PathConstraintEditor"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/index.js::PathStepEditor", "name": "PathStepEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.step - The path step configuration\n * @param {Function} props.onChange - Callback when step changes\n * @param {Function} props.onRemove - Callback to remove this step\n * @param {Object} props.schema - Domain schema\n * @param {number} props.stepIndex - Index of this step in the path\n */\nexport function PathStepEditor({ step, onChange, onRemove, schema, stepIndex }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKindOptions = [\n    { value: \"any\", label: \"Any kind\" },\n    ...(schema?.entityKinds || []).map((ek) => ({\n      value: ek.kind,\n      label: ek.description || ek.kind,\n    })),\n  ];\n\n  const getSubtypeOptions = (kind) => {\n    if (!kind || kind === \"any\") return [{ value: \"any\", label: \"Any subtype\" }];\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [{ value: \"any\", label: \"Any subtype\" }];\n    return [\n      { value: \"any\", label: \"Any subtype\" },\n      ...ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id })),\n    ];\n  };\n\n  const updateStep = (field, value) => {\n    onChange({ ...step, [field]: value });\n  };\n\n  return (\n    <div className=\"path-step-card\">\n      <div className=\"path-step-header\">\n        <span className=\"path-step-label\">Step {stepIndex + 1}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      <div className=\"path-step-grid\">\n        <div>\n          <label className=\"label label-micro\">Via Relationship\n          <ReferenceDropdown\n            value={step.via || \"\"}\n            onChange={(v) => updateStep(\"via\", v)}\n            options={relationshipKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Direction\n          <ReferenceDropdown\n            value={step.direction || \"any\"}\n            onChange={(v) => updateStep(\"direction\", v)}\n            options={PATH_DIRECTIONS}\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Kind\n          <ReferenceDropdown\n            value={step.targetKind}\n            onChange={(v) => updateStep(\"targetKind\", v)}\n            options={entityKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Subtype\n          <ReferenceDropdown\n            value={step.targetSubtype}\n            onChange={(v) => updateStep(\"targetSubtype\", v)}\n            options={getSubtypeOptions(step.targetKind)}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div className=\"path-step-full-width\">\n          <label htmlFor=\"store-as-variable-optional\" className=\"label label-micro\">Store As Variable (optional)</label>\n          <input id=\"store-as-variable-optional\"\n            type=\"text\"\n            value={step.as || \"\"}\n            onChange={(e) => updateStep(\"as\", e.target.value)}\n            className=\"input input-micro\"\n            placeholder=\"e.g. $allies\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ step, onChange, onRemove, schema, stepIndex }", "type": "{ step: any; onChange: Function; onRemove: Function; schema: any; stepIndex: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/index.js::PathConstraintEditor", "name": "PathConstraintEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.constraint - The path constraint configuration\n * @param {Function} props.onChange - Callback when constraint changes\n * @param {Function} props.onRemove - Callback to remove this constraint\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function PathConstraintEditor({ constraint, onChange, onRemove, schema, availableRefs }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  // Gather all subtypes from all entity kinds for subtype_equals constraint\n  const allSubtypeOptions = entityKinds.flatMap((ek) =>\n    (ek.subtypes || []).map((st) => ({\n      value: st.id,\n      label: `${st.name || st.id} (${ek.kind})`,\n    }))\n  );\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateConstraint = (field, value) => {\n    onChange({ ...constraint, [field]: value || undefined });\n  };\n\n  const renderConstraintFields = () => {\n    switch (constraint.type) {\n      case \"not_self\":\n        return <span className=\"text-muted text-small\">Target cannot be the starting entity</span>;\n\n      case \"not_in\":\n      case \"in\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Set Variable\n            <ReferenceDropdown\n              value={constraint.set || \"\"}\n              onChange={(v) => updateConstraint(\"set\", v)}\n              options={refOptions}\n              placeholder=\"e.g. $allies\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"kind_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Entity Kind\n            <ReferenceDropdown\n              value={constraint.kind || \"\"}\n              onChange={(v) => updateConstraint(\"kind\", v)}\n              options={entityKindOptions}\n            />\n            </label>\n          </div>\n        );\n\n      case \"subtype_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Subtype\n            <ReferenceDropdown\n              value={constraint.subtype || \"\"}\n              onChange={(v) => updateConstraint(\"subtype\", v)}\n              options={allSubtypeOptions}\n              placeholder=\"Select subtype...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"constraint-fields-grid\">\n            <div>\n              <label className=\"label label-micro\">Kind\n              <ReferenceDropdown\n                value={constraint.kind || \"\"}\n                onChange={(v) => updateConstraint(\"kind\", v)}\n                options={relationshipKindOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">With\n              <ReferenceDropdown\n                value={constraint.with || \"\"}\n                onChange={(v) => updateConstraint(\"with\", v)}\n                options={refOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">Direction\n              <ReferenceDropdown\n                value={constraint.direction || \"any\"}\n                onChange={(v) => updateConstraint(\"direction\", v)}\n                options={PATH_DIRECTIONS}\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  const constraintLabel =\n    PATH_CONSTRAINT_TYPES.find((c) => c.value === constraint.type)?.label || constraint.type;\n\n  return (\n    <div className=\"path-constraint-card\">\n      <div className=\"path-constraint-header\">\n        <span className=\"path-constraint-label\">{constraintLabel}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      {renderConstraintFields()}\n    </div>\n  );\n}", "parameters": [{"name": "{ constraint, onChange, onRemove, schema, availableRefs }", "type": "{ constraint: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "span", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/index.js::GraphPathEditor", "name": "GraphPathEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.assert - The path assertion configuration\n * @param {Function} props.onChange - Callback when assertion changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function GraphPathEditor({ assert, onChange, schema, availableRefs }) {\n  const [showConstraintMenu, setShowConstraintMenu] = useState(false);\n\n  const assertion = assert || { check: \"exists\", path: [] };\n\n  const updateAssertion = (field, value) => {\n    onChange({ ...assertion, [field]: value });\n  };\n\n  const addStep = () => {\n    // Create with empty required fields - validation will flag them\n    const newStep = { via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" };\n    updateAssertion(\"path\", [...(assertion.path || []), newStep]);\n  };\n\n  const updateStep = (index, updated) => {\n    const newPath = [...(assertion.path || [])];\n    newPath[index] = updated;\n    updateAssertion(\"path\", newPath);\n  };\n\n  const removeStep = (index) => {\n    updateAssertion(\n      \"path\",\n      (assertion.path || []).filter((_, i) => i !== index)\n    );\n  };\n\n  const addConstraint = (type) => {\n    const newConstraint = { type };\n    if (type === \"has_relationship\" || type === \"lacks_relationship\") {\n      newConstraint.direction = \"any\";\n    }\n    updateAssertion(\"where\", [...(assertion.where || []), newConstraint]);\n    setShowConstraintMenu(false);\n  };\n\n  const updateConstraint = (index, updated) => {\n    const newWhere = [...(assertion.where || [])];\n    newWhere[index] = updated;\n    updateAssertion(\"where\", newWhere);\n  };\n\n  const removeConstraint = (index) => {\n    const newWhere = (assertion.where || []).filter((_, i) => i !== index);\n    updateAssertion(\"where\", newWhere.length > 0 ? newWhere : undefined);\n  };\n\n  // Collect variables from path steps for constraint references\n  const pathVars = (assertion.path || []).filter((s) => s.as).map((s) => s.as);\n  const allRefs = [...(availableRefs || []), ...pathVars];\n\n  return (\n    <div className=\"graph-path-editor\">\n      {/* Check type and count */}\n      <div className=\"path-editor-grid\">\n        <div>\n          <label className=\"label label-tiny\">Check Type\n          <ReferenceDropdown\n            value={assertion.check || \"exists\"}\n            onChange={(v) => updateAssertion(\"check\", v)}\n            options={PATH_CHECK_TYPES}\n          />\n          </label>\n        </div>\n        {(assertion.check === \"count_min\" || assertion.check === \"count_max\") && (\n          <div>\n            <label className=\"label label-tiny\">Count\n            <NumberInput\n              value={assertion.count ?? 1}\n              onChange={(v) => updateAssertion(\"count\", v ?? 1)}\n              min={0}\n              integer\n              className=\"input input-compact\"\n            />\n            </label>\n          </div>\n        )}\n      </div>\n\n      {/* Path steps */}\n      <div>\n        <span className=\"label label-tiny\">Path Steps (traverse relationships)</span>\n        <div className=\"path-steps-list\">\n          {(assertion.path || []).map((step, index) => (\n            <PathStepEditor\n              key={index}\n              step={step}\n              onChange={(updated) => updateStep(index, updated)}\n              onRemove={() => removeStep(index)}\n              schema={schema}\n              stepIndex={index}\n            />\n          ))}\n          {(assertion.path || []).length < 2 && (\n            <button onClick={addStep} className=\"button button-add-step\">\n              + Add Step {(assertion.path || []).length === 0 ? \"(required)\" : \"(optional)\"}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Where constraints */}\n      <div>\n        <span className=\"label label-tiny\">Where Constraints (optional)</span>\n        <div className=\"path-constraints-list\">\n          {(assertion.where || []).map((constraint, index) => (\n            <PathConstraintEditor\n              key={index}\n              constraint={constraint}\n              onChange={(updated) => updateConstraint(index, updated)}\n              onRemove={() => removeConstraint(index)}\n              schema={schema}\n              availableRefs={allRefs}\n            />\n          ))}\n          <div className=\"relative\">\n            <button\n              onClick={() => setShowConstraintMenu(!showConstraintMenu)}\n              className=\"button button-add-constraint\"\n            >\n              + Add Constraint\n            </button>\n            {showConstraintMenu && (\n              <div className=\"dropdown-menu\">\n                {PATH_CONSTRAINT_TYPES.map(({ value, label }) => (\n                  <div\n                    key={value}\n                    onClick={() => addConstraint(value)}\n                    className=\"dropdown-menu-item\"\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    {label}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ assert, onChange, schema, availableRefs }", "type": "{ assert: any; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "PathStepEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "PathConstraintEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/index.js::SelectionFilterCard", "name": "SelectionFilterCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.filter - The filter configuration\n * @param {Function} props.onChange - Callback when filter changes\n * @param {Function} props.onRemove - Callback to remove this filter\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFilterCard({ filter, onChange, onRemove, schema, availableRefs }) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = FILTER_TYPES[filter.type] || {\n    label: filter.type,\n    icon: \"\u2753\",\n    color: \"#6b7280\",\n  };\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateFilter = (field, value) => {\n    onChange({ ...filter, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (filter.type) {\n      case \"has_tag\": {\n        const valueSuffix = filter.value !== undefined ? ` = ${filter.value}` : \"\";\n        return `${filter.tag || \"?\"}${valueSuffix}`;\n      }\n      case \"has_tags\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"lacks_tag\":\n        return filter.tag || \"tag?\";\n      case \"lacks_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_culture\":\n        return filter.culture || \"culture?\";\n      case \"matches_culture\":\n        return `with ${filter.with || \"?\"}`;\n      case \"has_status\":\n        return filter.status || \"status?\";\n      case \"has_prominence\":\n        return filter.minProminence || \"prominence?\";\n      case \"has_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        const direction = filter.direction ? ` [${filter.direction}]` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}${direction}`;\n      }\n      case \"lacks_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}`;\n      }\n      case \"exclude\":\n        return `${(filter.entities || []).length} excluded`;\n      case \"shares_related\":\n        return `${filter.relationshipKind || \"?\"} with ${filter.with || \"?\"}`;\n      case \"graph_path\":\n        return `graph path (${filter.assert?.check || \"exists\"})`;\n      default:\n        return \"\";\n    }\n  };\n\n  const summary = getSummary();\n\n  const renderFilterFields = () => {\n    switch (filter.type) {\n      case \"has_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"has_tags\":\n      case \"has_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">\n              {filter.type === \"has_tags\" ? \"Tags (must have ALL)\" : \"Tags (must have at least ONE)\"}\n            </label>\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n          </div>\n        );\n\n      case \"lacks_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"lacks_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">Tags (exclude if has ANY)\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n        );\n\n\n      case \"has_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Culture\n            <ReferenceDropdown\n              value={filter.culture || \"\"}\n              onChange={(v) => updateFilter(\"culture\", v)}\n              options={(schema?.cultures || []).map((c) => ({\n                value: c.id,\n                label: c.name || c.id,\n              }))}\n              placeholder=\"Select culture...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"matches_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Same Culture As\n            <ReferenceDropdown\n              value={filter.with || \"\"}\n              onChange={(v) => updateFilter(\"with\", v)}\n              options={refOptions}\n              placeholder=\"Select variable...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_status\":\n        return (\n          <div>\n            <label htmlFor=\"status\" className=\"label label-small\">Status</label>\n            <input id=\"status\"\n              type=\"text\"\n              value={filter.status || \"\"}\n              onChange={(e) => updateFilter(\"status\", e.target.value)}\n              className=\"input input-compact\"\n              placeholder=\"e.g., active, historical\"\n            />\n          </div>\n        );\n\n      case \"has_prominence\":\n        return (\n          <div>\n            <label className=\"label label-small\">Minimum Prominence\n            <ReferenceDropdown\n              value={filter.minProminence || \"\"}\n              onChange={(v) => updateFilter(\"minProminence\", v)}\n              options={PROMINENCE_LEVELS.map((p) => ({ value: p.value, label: p.label }))}\n              placeholder=\"Select prominence...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Relationship Kind\n              <ReferenceDropdown\n                value={filter.kind || \"\"}\n                onChange={(v) => updateFilter(\"kind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity (optional)\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v || undefined)}\n                options={refOptions}\n                placeholder=\"Any entity\"\n              />\n              </label>\n            </div>\n            {filter.type === \"has_relationship\" && (\n              <div className=\"sfc-flex-field-tiny\">\n                <label className=\"label label-small\">Direction\n                <ReferenceDropdown\n                  value={filter.direction || \"both\"}\n                  onChange={(v) => updateFilter(\"direction\", v)}\n                  options={[\n                    { value: \"both\", label: \"Both\" },\n                    { value: \"src\", label: \"Outgoing\" },\n                    { value: \"dst\", label: \"Incoming\" },\n                  ]}\n                />\n                </label>\n              </div>\n            )}\n          </div>\n        );\n\n      case \"exclude\":\n        return (\n          <ChipSelect\n            label=\"Entities to Exclude\"\n            value={filter.entities || []}\n            onChange={(v) => updateFilter(\"entities\", v)}\n            options={refOptions}\n            placeholder=\"+ Add variable...\"\n          />\n        );\n\n      case \"shares_related\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Via Relationship\n              <ReferenceDropdown\n                value={filter.relationshipKind || \"\"}\n                onChange={(v) => updateFilter(\"relationshipKind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v)}\n                options={refOptions}\n                placeholder=\"Select variable...\"\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      case \"graph_path\":\n// ... (truncated)", "parameters": [{"name": "{ filter, onChange, onRemove, schema, availableRefs }", "type": "{ filter: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/index.js::SelectionFiltersEditor", "name": "SelectionFiltersEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.filters - Array of filter configurations\n * @param {Function} props.onChange - Callback when filters change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFiltersEditor({ filters, onChange, schema, availableRefs }) {\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const containerRef = useRef(null);\n\n  // Calculate dropdown position when opening (like TagSelector)\n  useLayoutEffect(() => {\n    if (showTypeMenu && containerRef.current) {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  const handleAddFilter = (type) => {\n    // Create with empty required fields - validation will flag them\n    const newFilter = { type };\n    // Tag filters\n    if (type === \"has_tag\") newFilter.tag = \"\";\n    if (type === \"has_tags\") newFilter.tags = [];\n    if (type === \"has_any_tag\") newFilter.tags = [];\n    if (type === \"lacks_tag\") newFilter.tag = \"\";\n    if (type === \"lacks_any_tag\") newFilter.tags = [];\n    // Attribute filters\n    if (type === \"has_culture\") newFilter.culture = \"\";\n    if (type === \"matches_culture\") newFilter.with = \"\";\n    if (type === \"has_status\") newFilter.status = \"\";\n    if (type === \"has_prominence\") newFilter.minProminence = \"\";\n    // Relationship filters\n    if (type === \"has_relationship\") newFilter.kind = \"\";\n    if (type === \"lacks_relationship\") newFilter.kind = \"\";\n    if (type === \"shares_related\") {\n      newFilter.relationshipKind = \"\";\n      newFilter.with = \"\";\n    }\n    // Other\n    if (type === \"exclude\") newFilter.entities = [];\n    if (type === \"graph_path\")\n      newFilter.assert = {\n        check: \"\",\n        path: [{ via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" }],\n      };\n    onChange([...(filters || []), newFilter]);\n    setShowTypeMenu(false);\n  };\n\n  const handleUpdateFilter = (index, updated) => {\n    const newFilters = [...(filters || [])];\n    newFilters[index] = updated;\n    onChange(newFilters);\n  };\n\n  const handleRemoveFilter = (index) => {\n    onChange((filters || []).filter((_, i) => i !== index));\n  };\n\n  return (\n    <div>\n      {(filters || []).length === 0 ? (\n        <div className=\"empty-state-compact\">\n          No filters defined. Filters narrow down which entities can be selected as targets.\n        </div>\n      ) : (\n        <div className=\"condition-list\">\n          {(filters || []).map((filter, index) => (\n            <SelectionFilterCard\n              key={index}\n              filter={filter}\n              onChange={(updated) => handleUpdateFilter(index, updated)}\n              onRemove={() => handleRemoveFilter(index)}\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))}\n        </div>\n      )}\n\n      <div ref={containerRef} className=\"relative mt-lg\">\n        <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n          + Add Filter\n        </button>\n\n        {showTypeMenu && (\n          <div\n            className=\"dropdown-menu sfe-dropdown-fixed\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n            style={{ '--sfe-dd-top': `${dropdownPos.top}px`, '--sfe-dd-left': `${dropdownPos.left}px`, '--sfe-dd-width': `${dropdownPos.width}px`, top: 'var(--sfe-dd-top)', left: 'var(--sfe-dd-left)', width: 'var(--sfe-dd-width)' }}\n          >\n            {Object.entries(FILTER_TYPES).map(([type, config]) => (\n              <div key={type} onClick={() => handleAddFilter(type)} className=\"dropdown-menu-item\" role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n                <span\n                  className=\"dropdown-menu-icon\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per filter type\n                  style={{ '--sfe-icon-bg': `${config.color}20`, backgroundColor: 'var(--sfe-icon-bg)' }}\n                >\n                  {config.icon}\n                </span>\n                <span className=\"dropdown-menu-label\">{config.label}</span>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ filters, onChange, schema, availableRefs }", "type": "{ filters: any[]; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "SelectionFilterCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/PathConstraintEditor.jsx::PathConstraintEditor", "name": "PathConstraintEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/PathConstraintEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.constraint - The path constraint configuration\n * @param {Function} props.onChange - Callback when constraint changes\n * @param {Function} props.onRemove - Callback to remove this constraint\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function PathConstraintEditor({ constraint, onChange, onRemove, schema, availableRefs }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  // Gather all subtypes from all entity kinds for subtype_equals constraint\n  const allSubtypeOptions = entityKinds.flatMap((ek) =>\n    (ek.subtypes || []).map((st) => ({\n      value: st.id,\n      label: `${st.name || st.id} (${ek.kind})`,\n    }))\n  );\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateConstraint = (field, value) => {\n    onChange({ ...constraint, [field]: value || undefined });\n  };\n\n  const renderConstraintFields = () => {\n    switch (constraint.type) {\n      case \"not_self\":\n        return <span className=\"text-muted text-small\">Target cannot be the starting entity</span>;\n\n      case \"not_in\":\n      case \"in\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Set Variable\n            <ReferenceDropdown\n              value={constraint.set || \"\"}\n              onChange={(v) => updateConstraint(\"set\", v)}\n              options={refOptions}\n              placeholder=\"e.g. $allies\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"kind_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Entity Kind\n            <ReferenceDropdown\n              value={constraint.kind || \"\"}\n              onChange={(v) => updateConstraint(\"kind\", v)}\n              options={entityKindOptions}\n            />\n            </label>\n          </div>\n        );\n\n      case \"subtype_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Subtype\n            <ReferenceDropdown\n              value={constraint.subtype || \"\"}\n              onChange={(v) => updateConstraint(\"subtype\", v)}\n              options={allSubtypeOptions}\n              placeholder=\"Select subtype...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"constraint-fields-grid\">\n            <div>\n              <label className=\"label label-micro\">Kind\n              <ReferenceDropdown\n                value={constraint.kind || \"\"}\n                onChange={(v) => updateConstraint(\"kind\", v)}\n                options={relationshipKindOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">With\n              <ReferenceDropdown\n                value={constraint.with || \"\"}\n                onChange={(v) => updateConstraint(\"with\", v)}\n                options={refOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">Direction\n              <ReferenceDropdown\n                value={constraint.direction || \"any\"}\n                onChange={(v) => updateConstraint(\"direction\", v)}\n                options={PATH_DIRECTIONS}\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  const constraintLabel =\n    PATH_CONSTRAINT_TYPES.find((c) => c.value === constraint.type)?.label || constraint.type;\n\n  return (\n    <div className=\"path-constraint-card\">\n      <div className=\"path-constraint-header\">\n        <span className=\"path-constraint-label\">{constraintLabel}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      {renderConstraintFields()}\n    </div>\n  );\n}", "parameters": [{"name": "{ constraint, onChange, onRemove, schema, availableRefs }", "type": "{ constraint: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "span", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["PATH_DIRECTIONS", "PATH_CONSTRAINT_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/PathStepEditor.jsx::PathStepEditor", "name": "PathStepEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/PathStepEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.step - The path step configuration\n * @param {Function} props.onChange - Callback when step changes\n * @param {Function} props.onRemove - Callback to remove this step\n * @param {Object} props.schema - Domain schema\n * @param {number} props.stepIndex - Index of this step in the path\n */\nexport function PathStepEditor({ step, onChange, onRemove, schema, stepIndex }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKindOptions = [\n    { value: \"any\", label: \"Any kind\" },\n    ...(schema?.entityKinds || []).map((ek) => ({\n      value: ek.kind,\n      label: ek.description || ek.kind,\n    })),\n  ];\n\n  const getSubtypeOptions = (kind) => {\n    if (!kind || kind === \"any\") return [{ value: \"any\", label: \"Any subtype\" }];\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [{ value: \"any\", label: \"Any subtype\" }];\n    return [\n      { value: \"any\", label: \"Any subtype\" },\n      ...ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id })),\n    ];\n  };\n\n  const updateStep = (field, value) => {\n    onChange({ ...step, [field]: value });\n  };\n\n  return (\n    <div className=\"path-step-card\">\n      <div className=\"path-step-header\">\n        <span className=\"path-step-label\">Step {stepIndex + 1}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      <div className=\"path-step-grid\">\n        <div>\n          <label className=\"label label-micro\">Via Relationship\n          <ReferenceDropdown\n            value={step.via || \"\"}\n            onChange={(v) => updateStep(\"via\", v)}\n            options={relationshipKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Direction\n          <ReferenceDropdown\n            value={step.direction || \"any\"}\n            onChange={(v) => updateStep(\"direction\", v)}\n            options={PATH_DIRECTIONS}\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Kind\n          <ReferenceDropdown\n            value={step.targetKind}\n            onChange={(v) => updateStep(\"targetKind\", v)}\n            options={entityKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Subtype\n          <ReferenceDropdown\n            value={step.targetSubtype}\n            onChange={(v) => updateStep(\"targetSubtype\", v)}\n            options={getSubtypeOptions(step.targetKind)}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div className=\"path-step-full-width\">\n          <label htmlFor=\"store-as-variable-optional\" className=\"label label-micro\">Store As Variable (optional)</label>\n          <input id=\"store-as-variable-optional\"\n            type=\"text\"\n            value={step.as || \"\"}\n            onChange={(e) => updateStep(\"as\", e.target.value)}\n            className=\"input input-micro\"\n            placeholder=\"e.g. $allies\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ step, onChange, onRemove, schema, stepIndex }", "type": "{ step: any; onChange: Function; onRemove: Function; schema: any; stepIndex: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["PATH_DIRECTIONS"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFilterCard.jsx::SelectionFilterCard", "name": "SelectionFilterCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFilterCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.filter - The filter configuration\n * @param {Function} props.onChange - Callback when filter changes\n * @param {Function} props.onRemove - Callback to remove this filter\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFilterCard({ filter, onChange, onRemove, schema, availableRefs }) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = FILTER_TYPES[filter.type] || {\n    label: filter.type,\n    icon: \"\u2753\",\n    color: \"#6b7280\",\n  };\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateFilter = (field, value) => {\n    onChange({ ...filter, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (filter.type) {\n      case \"has_tag\": {\n        const valueSuffix = filter.value !== undefined ? ` = ${filter.value}` : \"\";\n        return `${filter.tag || \"?\"}${valueSuffix}`;\n      }\n      case \"has_tags\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"lacks_tag\":\n        return filter.tag || \"tag?\";\n      case \"lacks_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_culture\":\n        return filter.culture || \"culture?\";\n      case \"matches_culture\":\n        return `with ${filter.with || \"?\"}`;\n      case \"has_status\":\n        return filter.status || \"status?\";\n      case \"has_prominence\":\n        return filter.minProminence || \"prominence?\";\n      case \"has_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        const direction = filter.direction ? ` [${filter.direction}]` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}${direction}`;\n      }\n      case \"lacks_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}`;\n      }\n      case \"exclude\":\n        return `${(filter.entities || []).length} excluded`;\n      case \"shares_related\":\n        return `${filter.relationshipKind || \"?\"} with ${filter.with || \"?\"}`;\n      case \"graph_path\":\n        return `graph path (${filter.assert?.check || \"exists\"})`;\n      default:\n        return \"\";\n    }\n  };\n\n  const summary = getSummary();\n\n  const renderFilterFields = () => {\n    switch (filter.type) {\n      case \"has_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"has_tags\":\n      case \"has_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">\n              {filter.type === \"has_tags\" ? \"Tags (must have ALL)\" : \"Tags (must have at least ONE)\"}\n            </label>\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n          </div>\n        );\n\n      case \"lacks_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"lacks_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">Tags (exclude if has ANY)\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n        );\n\n\n      case \"has_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Culture\n            <ReferenceDropdown\n              value={filter.culture || \"\"}\n              onChange={(v) => updateFilter(\"culture\", v)}\n              options={(schema?.cultures || []).map((c) => ({\n                value: c.id,\n                label: c.name || c.id,\n              }))}\n              placeholder=\"Select culture...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"matches_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Same Culture As\n            <ReferenceDropdown\n              value={filter.with || \"\"}\n              onChange={(v) => updateFilter(\"with\", v)}\n              options={refOptions}\n              placeholder=\"Select variable...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_status\":\n        return (\n          <div>\n            <label htmlFor=\"status\" className=\"label label-small\">Status</label>\n            <input id=\"status\"\n              type=\"text\"\n              value={filter.status || \"\"}\n              onChange={(e) => updateFilter(\"status\", e.target.value)}\n              className=\"input input-compact\"\n              placeholder=\"e.g., active, historical\"\n            />\n          </div>\n        );\n\n      case \"has_prominence\":\n        return (\n          <div>\n            <label className=\"label label-small\">Minimum Prominence\n            <ReferenceDropdown\n              value={filter.minProminence || \"\"}\n              onChange={(v) => updateFilter(\"minProminence\", v)}\n              options={PROMINENCE_LEVELS.map((p) => ({ value: p.value, label: p.label }))}\n              placeholder=\"Select prominence...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Relationship Kind\n              <ReferenceDropdown\n                value={filter.kind || \"\"}\n                onChange={(v) => updateFilter(\"kind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity (optional)\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v || undefined)}\n                options={refOptions}\n                placeholder=\"Any entity\"\n              />\n              </label>\n            </div>\n            {filter.type === \"has_relationship\" && (\n              <div className=\"sfc-flex-field-tiny\">\n                <label className=\"label label-small\">Direction\n                <ReferenceDropdown\n                  value={filter.direction || \"both\"}\n                  onChange={(v) => updateFilter(\"direction\", v)}\n                  options={[\n                    { value: \"both\", label: \"Both\" },\n                    { value: \"src\", label: \"Outgoing\" },\n                    { value: \"dst\", label: \"Incoming\" },\n                  ]}\n                />\n                </label>\n              </div>\n            )}\n          </div>\n        );\n\n      case \"exclude\":\n        return (\n          <ChipSelect\n            label=\"Entities to Exclude\"\n            value={filter.entities || []}\n            onChange={(v) => updateFilter(\"entities\", v)}\n            options={refOptions}\n            placeholder=\"+ Add variable...\"\n          />\n        );\n\n      case \"shares_related\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Via Relationship\n              <ReferenceDropdown\n                value={filter.relationshipKind || \"\"}\n                onChange={(v) => updateFilter(\"relationshipKind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v)}\n                options={refOptions}\n                placeholder=\"Select variable...\"\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      case \"graph_path\":\n// ... (truncated)", "parameters": [{"name": "{ filter, onChange, onRemove, schema, availableRefs }", "type": "{ filter: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["FILTER_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "ChipSelect", "PROMINENCE_LEVELS"], "category": "internal"}, {"source": "./GraphPathEditor", "specifiers": ["GraphPathEditor"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}, {"source": "./SelectionFilterCard.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFiltersEditor.jsx::SelectionFiltersEditor", "name": "SelectionFiltersEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFiltersEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.filters - Array of filter configurations\n * @param {Function} props.onChange - Callback when filters change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFiltersEditor({ filters, onChange, schema, availableRefs }) {\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const containerRef = useRef(null);\n\n  // Calculate dropdown position when opening (like TagSelector)\n  useLayoutEffect(() => {\n    if (showTypeMenu && containerRef.current) {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  const handleAddFilter = (type) => {\n    // Create with empty required fields - validation will flag them\n    const newFilter = { type };\n    // Tag filters\n    if (type === \"has_tag\") newFilter.tag = \"\";\n    if (type === \"has_tags\") newFilter.tags = [];\n    if (type === \"has_any_tag\") newFilter.tags = [];\n    if (type === \"lacks_tag\") newFilter.tag = \"\";\n    if (type === \"lacks_any_tag\") newFilter.tags = [];\n    // Attribute filters\n    if (type === \"has_culture\") newFilter.culture = \"\";\n    if (type === \"matches_culture\") newFilter.with = \"\";\n    if (type === \"has_status\") newFilter.status = \"\";\n    if (type === \"has_prominence\") newFilter.minProminence = \"\";\n    // Relationship filters\n    if (type === \"has_relationship\") newFilter.kind = \"\";\n    if (type === \"lacks_relationship\") newFilter.kind = \"\";\n    if (type === \"shares_related\") {\n      newFilter.relationshipKind = \"\";\n      newFilter.with = \"\";\n    }\n    // Other\n    if (type === \"exclude\") newFilter.entities = [];\n    if (type === \"graph_path\")\n      newFilter.assert = {\n        check: \"\",\n        path: [{ via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" }],\n      };\n    onChange([...(filters || []), newFilter]);\n    setShowTypeMenu(false);\n  };\n\n  const handleUpdateFilter = (index, updated) => {\n    const newFilters = [...(filters || [])];\n    newFilters[index] = updated;\n    onChange(newFilters);\n  };\n\n  const handleRemoveFilter = (index) => {\n    onChange((filters || []).filter((_, i) => i !== index));\n  };\n\n  return (\n    <div>\n      {(filters || []).length === 0 ? (\n        <div className=\"empty-state-compact\">\n          No filters defined. Filters narrow down which entities can be selected as targets.\n        </div>\n      ) : (\n        <div className=\"condition-list\">\n          {(filters || []).map((filter, index) => (\n            <SelectionFilterCard\n              key={index}\n              filter={filter}\n              onChange={(updated) => handleUpdateFilter(index, updated)}\n              onRemove={() => handleRemoveFilter(index)}\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))}\n        </div>\n      )}\n\n      <div ref={containerRef} className=\"relative mt-lg\">\n        <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n          + Add Filter\n        </button>\n\n        {showTypeMenu && (\n          <div\n            className=\"dropdown-menu sfe-dropdown-fixed\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n            style={{ '--sfe-dd-top': `${dropdownPos.top}px`, '--sfe-dd-left': `${dropdownPos.left}px`, '--sfe-dd-width': `${dropdownPos.width}px`, top: 'var(--sfe-dd-top)', left: 'var(--sfe-dd-left)', width: 'var(--sfe-dd-width)' }}\n          >\n            {Object.entries(FILTER_TYPES).map(([type, config]) => (\n              <div key={type} onClick={() => handleAddFilter(type)} className=\"dropdown-menu-item\" role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n                <span\n                  className=\"dropdown-menu-icon\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per filter type\n                  style={{ '--sfe-icon-bg': `${config.color}20`, backgroundColor: 'var(--sfe-icon-bg)' }}\n                >\n                  {config.icon}\n                </span>\n                <span className=\"dropdown-menu-label\">{config.label}</span>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ filters, onChange, schema, availableRefs }", "type": "{ filters: any[]; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "SelectionFilterCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useRef", "useLayoutEffect", "useEffect"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["FILTER_TYPES"], "category": "internal"}, {"source": "./SelectionFilterCard", "specifiers": ["SelectionFilterCard"], "category": "internal"}, {"source": "./SelectionFiltersEditor.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx::CreationTab", "name": "CreationTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx", "sourceCode": "// ============================================================================\n// CreationTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.tagRegistry - Available tags\n * @param {Function} props.onAddToRegistry - Callback to add new tag to registry\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function CreationTab({\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}) {\n  const creation = generator.creation || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    creation.forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, creation]);\n\n  const culturesById = useMemo(() => {\n    const map = {};\n    (schema?.cultures || []).forEach((culture) => {\n      map[culture.id] = culture;\n    });\n    return map;\n  }, [schema?.cultures]);\n\n  const cultureIds = useMemo(() => Object.keys(culturesById), [culturesById]);\n\n  const handleAdd = () => {\n    const nextNum = creation.length + 1;\n    onChange({\n      ...generator,\n      creation: [\n        ...creation,\n        { entityRef: `$entity${nextNum}`, kind: \"npc\", prominence: \"marginal\" },\n      ],\n    });\n  };\n\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Entity Creation</div>\n        <div className=\"section-desc\">\n          Define entities that this generator creates. Each entity gets a reference (like{\" \"}\n          <code className=\"inline-code\">$hero</code>) that can be used in relationships.\n        </div>\n\n        {creation.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2728</div>\n            <div className=\"empty-state-title\">No entities created</div>\n            <div className=\"empty-state-desc\">\n              This generator only modifies existing entities. Add creation rules to spawn new\n              entities.\n            </div>\n          </div>\n        ) : (\n          creation.map((item, index) => (\n            <CreationCard\n              key={index}\n              item={item}\n              onChange={(updated) => {\n                const newCreation = [...creation];\n                newCreation[index] = updated;\n                onChange({ ...generator, creation: newCreation });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, creation: creation.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n              culturesById={culturesById}\n              cultureIds={cultureIds}\n              generator={generator}\n              tagRegistry={tagRegistry}\n              onAddToRegistry={onAddToRegistry}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Entity Creation\n        </button>\n      </div>\n\n      <VariantsSection\n        generator={generator}\n        onChange={onChange}\n        pressures={pressures}\n        schema={schema}\n        tagRegistry={tagRegistry}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}", "type": "{ generator: any; onChange: Function; schema: any; tagRegistry: any[]; onAddToRegistry: Function; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "VariantsSection", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 3}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useMemo", "useCallback"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "LevelSelector", "PROMINENCE_LEVELS", "ChipSelect", "NumberInput", "LocalTextArea"], "category": "internal"}, {"source": "./CreationTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/EffectsTab.jsx::EffectsTab", "name": "EffectsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/EffectsTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Object} props.schema - Domain schema\n */\nexport function EffectsTab({ generator, onChange, pressures, schema }) {\n  const stateUpdates = generator.stateUpdates || [];\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const addButtonRef = useRef(null);\n\n  // Build available entity references from target + variables + created entities\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, generator.creation]);\n\n  const createMutation = (type) => {\n    let newUpdate;\n    switch (type) {\n      case \"modify_pressure\":\n        newUpdate = { type: \"modify_pressure\", pressureId: pressures?.[0]?.id || \"\", delta: 0 };\n        break;\n      case \"archive_relationship\":\n        newUpdate = {\n          type: \"archive_relationship\",\n          entity: \"$target\",\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n        break;\n      case \"change_status\":\n        newUpdate = { type: \"change_status\", entity: \"$target\", newStatus: \"\" };\n        break;\n      case \"set_tag\":\n        newUpdate = { type: \"set_tag\", entity: \"$target\", tag: \"\", value: true };\n        break;\n      case \"remove_tag\":\n        newUpdate = { type: \"remove_tag\", entity: \"$target\", tag: \"\" };\n        break;\n      case \"update_rate_limit\":\n        newUpdate = { type: \"update_rate_limit\" };\n        break;\n      default:\n        return null;\n    }\n    return newUpdate;\n  };\n\n  const addMutation = (type) => {\n    const next = createMutation(type);\n    if (!next) return;\n    onChange({ ...generator, stateUpdates: [...stateUpdates, next] });\n  };\n\n  const updateMutation = (index, updated) => {\n    const newUpdates = [...stateUpdates];\n    newUpdates[index] = updated;\n    onChange({ ...generator, stateUpdates: newUpdates });\n  };\n\n  const removeMutation = (index) => {\n    onChange({ ...generator, stateUpdates: stateUpdates.filter((_, i) => i !== index) });\n  };\n\n  const knownTypes = new Set(DEFAULT_MUTATION_TYPES.map((type) => type.value));\n  const unrecognizedUpdates = stateUpdates\n    .map((update, index) => (knownTypes.has(update.type) ? null : { update, index }))\n    .filter(Boolean);\n\n  useLayoutEffect(() => {\n    if (showTypeMenu && addButtonRef.current) {\n      const rect = addButtonRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (event) => {\n      if (addButtonRef.current && !addButtonRef.current.contains(event.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  return (\n    <div>\n      {/* Unrecognized Effects - shown first to draw attention */}\n      {unrecognizedUpdates.length > 0 && (\n        <div className=\"section et-unrecognized-section\">\n          <div className=\"section-title et-unrecognized-title\">\n            <span>\u26a0\ufe0f</span> Unrecognized Effects\n          </div>\n          <div className=\"section-desc mb-lg\">\n            These state updates have unrecognized types and may be from an older version. Remove\n            them to clear validation errors.\n          </div>\n\n          {unrecognizedUpdates.map((entry) => {\n            const globalIdx = entry.index;\n            const update = entry.update;\n            return (\n              <div\n                key={globalIdx}\n                className=\"item-card et-unrecognized-card\"\n              >\n                <div className=\"et-unrecognized-body\">\n                  <div className=\"et-unrecognized-layout\">\n                    <div className=\"flex-1\">\n                      <div className=\"et-unrecognized-type\">\n                        Unknown type: &quot;{update.type || \"(no type)\"}&quot;\n                      </div>\n                      <pre className=\"et-unrecognized-json\">\n                        {JSON.stringify(update, null, 2)}\n                      </pre>\n                    </div>\n                    <button\n                      className=\"btn btn-danger flex-shrink-0\"\n                      onClick={() => removeMutation(globalIdx)}\n                    >\n                      Remove\n                    </button>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u26a1 Effects ({stateUpdates.length})</div>\n        <div className=\"section-desc\">\n          Apply state updates when this generator runs. Effects use the unified mutation library.\n        </div>\n\n        {stateUpdates.map((update, index) => {\n          if (!knownTypes.has(update.type)) return null;\n          return (\n            <MutationCard\n              key={index}\n              mutation={update}\n              onChange={(updated) => updateMutation(index, updated)}\n              onRemove={() => removeMutation(index)}\n              schema={schema}\n              pressures={pressures}\n              entityOptions={availableRefs}\n              typeOptions={DEFAULT_MUTATION_TYPES}\n              createMutation={createMutation}\n            />\n          );\n        })}\n\n        <div ref={addButtonRef} className=\"relative mt-lg\">\n          <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n            + Add Effect\n          </button>\n\n          {showTypeMenu && (\n            <div\n              className=\"dropdown-menu et-dropdown-fixed\"\n              // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n              style={{ '--et-dd-top': `${dropdownPos.top}px`, '--et-dd-left': `${dropdownPos.left}px`, '--et-dd-width': `${dropdownPos.width}px`, top: 'var(--et-dd-top)', left: 'var(--et-dd-left)', width: 'var(--et-dd-width)' }}\n            >\n              {MUTATION_TYPE_OPTIONS.map((opt) => (\n                <div\n                  key={opt.value}\n                  onClick={() => {\n                    addMutation(opt.value);\n                    setShowTypeMenu(false);\n                  }}\n                  className=\"dropdown-menu-item\"\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <span\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per mutation type\n                    style={{ '--et-icon-bg': `${opt.color}20`, backgroundColor: 'var(--et-icon-bg)' }}\n                  >\n                    {opt.icon}\n                  </span>\n                  <span className=\"dropdown-menu-label\">{opt.label}</span>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, pressures, schema }", "type": "{ generator: any; onChange: Function; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "pre", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "MutationCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useMemo", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useEffect", "useLayoutEffect", "useMemo", "useRef", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared/MutationCard", "specifiers": ["MutationCard", "DEFAULT_MUTATION_TYPES"], "category": "internal"}, {"source": "../../actions/constants", "specifiers": ["MUTATION_TYPE_OPTIONS"], "category": "internal"}, {"source": "./EffectsTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Function} props.onDelete - Callback to delete the generator\n * @param {Function} props.onDuplicate - Callback to duplicate the generator\n */\nexport function OverviewTab({ generator, onChange, onDelete, onDuplicate }) {\n  const updateField = (field, value) => {\n    onChange({ ...generator, [field]: value });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(generator.id, (value) =>\n    updateField(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(generator.name, (value) =>\n    updateField(\"name\", value)\n  );\n\n  const summary = useMemo(() => {\n    return {\n      rules: generator.applicability?.length || 0,\n      variables: Object.keys(generator.variables || {}).length,\n      creates: generator.creation?.length || 0,\n      relationships: generator.relationships?.length || 0,\n      effects: generator.stateUpdates?.length || 0,\n    };\n  }, [generator]);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"generator-id\" className=\"label\">Generator ID</label>\n            <input id=\"generator-id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"display-name\" className=\"label\">Display Name</label>\n            <input id=\"display-name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n              placeholder=\"Optional friendly name\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Enabled\n          <EnableToggle\n            enabled={generator.enabled !== false}\n            onChange={(enabled) => updateField(\"enabled\", enabled)}\n            label={generator.enabled !== false ? \"Generator is active\" : \"Generator is disabled\"}\n          />\n          </label>\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">Narration Template</span>\n          <div className=\"section-desc mb-md\">\n            Syntax: {\"{$target.field}\"}, {\"{$var.field}\"}, {\"{count:kind}\"}, {\"{list:created}\"},{\" \"}\n            {\"{field|fallback}\"}.\n          </div>\n          <LocalTextArea\n            value={generator.narrationTemplate || \"\"}\n            onChange={(value) => updateField(\"narrationTemplate\", value || undefined)}\n            placeholder=\"e.g., From {$target.name}, {count:npc} new souls emerged to shape the realm.\"\n            rows={2}\n          />\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Summary</div>\n        <div className=\"summary-stats-grid\">\n          {[\n            { label: \"Rules\", value: summary.rules, icon: \"\u2713\" },\n            { label: \"Variables\", value: summary.variables, icon: \"\ud83d\udce6\" },\n            { label: \"Creates\", value: summary.creates, icon: \"\u2728\" },\n            { label: \"Connects\", value: summary.relationships, icon: \"\ud83d\udd17\" },\n            { label: \"Effects\", value: summary.effects, icon: \"\u26a1\" },\n          ].map((stat) => (\n            <div key={stat.label} className=\"summary-stat\">\n              <div className=\"summary-stat-icon\">{stat.icon}</div>\n              <div className=\"summary-stat-value\">{stat.value}</div>\n              <div className=\"summary-stat-label\">{stat.label}</div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"danger-zone\">\n        <button className=\"btn btn-secondary\" onClick={onDuplicate}>\n          Duplicate Generator\n        </button>\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete Generator\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, onDelete, onDuplicate }", "type": "{ generator: any; onChange: Function; onDelete: Function; onDuplicate: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useLocalInputState", "count": 2}, {"name": "useMemo", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::TargetTab", "name": "TargetTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema with entity/relationship kinds\n */\nexport function TargetTab({ generator, onChange, schema }) {\n  const selection = generator.selection || { strategy: \"by_kind\" };\n\n  // Get the kind of the first created entity for saturation limit inference\n  const firstCreatedKind = (generator.creation || [])[0]?.kind;\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Target Selection</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What is $target?</div>\n          <div className=\"info-box-text\">\n            The <code className=\"inline-code\">$target</code> is the primary entity this generator\n            operates on. It&apos;s selected from the world graph based on the rules you define here. Once\n            selected, you can reference it in creation rules (e.g., inherit culture from $target)\n            and relationships (e.g., connect new entity to $target).\n          </div>\n        </div>\n\n        <SelectionRuleEditor\n          value={selection}\n          onChange={(updated) => onChange({ ...generator, selection: updated })}\n          schema={schema}\n          availableRefs={[\"$target\", ...Object.keys(generator.variables || {})]}\n        />\n\n        {/* Saturation Limits */}\n        <div className=\"mt-2xl\">\n          <span className=\"label\">Saturation Limits</span>\n          <div className=\"info-box-text mb-lg text-sm\">\n            Limit targets based on existing relationship counts. Only targets with fewer than the\n            max count of relationships will be selected.\n          </div>\n          <SaturationLimitsEditor\n            limits={selection.saturationLimits || []}\n            onChange={(limits) =>\n              onChange({\n                ...generator,\n                selection: {\n                  ...selection,\n                  saturationLimits: limits.length > 0 ? limits : undefined,\n                },\n              })\n            }\n            schema={schema}\n            createdKind={firstCreatedKind}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "SelectionRuleEditor", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SaturationLimitsEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::VariablesTab", "name": "VariablesTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "// ============================================================================\n// VariablesTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n */\nexport function VariablesTab({ generator, onChange, schema }) {\n  const variables = generator.variables || {};\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  // Build available refs for relationship queries (target + other vars + creation refs)\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$target\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    // Ensure the name starts with $\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    // Create with empty required fields - validation will flag them\n    onChange({\n      ...generator,\n      variables: {\n        ...variables,\n        [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"\" } },\n      },\n    });\n    setNewVarName(\"\");\n    setShowAddForm(false);\n  };\n\n  const varEntries = Object.entries(variables);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Variables</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What are variables?</div>\n          <div className=\"info-box-text\">\n            Variables let you select additional entities from the graph to use in creation and\n            relationships. For example, you might select a{\" \"}\n            <code className=\"inline-code\">$faction</code> to make a new NPC a member of, or an{\" \"}\n            <code className=\"inline-code\">$ability</code> for them to practice. Variables are\n            selected after <code className=\"inline-code\">$target</code> is chosen.\n          </div>\n        </div>\n\n        {varEntries.length === 0 && !showAddForm ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udce6</div>\n            <div className=\"empty-state-title\">No variables defined</div>\n            <div className=\"empty-state-desc\">\n              Add variables to select additional entities for use in creation and relationships.\n            </div>\n          </div>\n        ) : (\n          varEntries.map(([name, config]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={config}\n              onChange={(updated) =>\n                onChange({ ...generator, variables: { ...variables, [name]: updated } })\n              }\n              onRemove={() => {\n                const newVars = { ...variables };\n                delete newVars[name];\n                onChange({ ...generator, variables: newVars });\n              }}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::CreationTab", "name": "CreationTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "// ============================================================================\n// CreationTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.tagRegistry - Available tags\n * @param {Function} props.onAddToRegistry - Callback to add new tag to registry\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function CreationTab({\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}) {\n  const creation = generator.creation || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    creation.forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, creation]);\n\n  const culturesById = useMemo(() => {\n    const map = {};\n    (schema?.cultures || []).forEach((culture) => {\n      map[culture.id] = culture;\n    });\n    return map;\n  }, [schema?.cultures]);\n\n  const cultureIds = useMemo(() => Object.keys(culturesById), [culturesById]);\n\n  const handleAdd = () => {\n    const nextNum = creation.length + 1;\n    onChange({\n      ...generator,\n      creation: [\n        ...creation,\n        { entityRef: `$entity${nextNum}`, kind: \"npc\", prominence: \"marginal\" },\n      ],\n    });\n  };\n\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Entity Creation</div>\n        <div className=\"section-desc\">\n          Define entities that this generator creates. Each entity gets a reference (like{\" \"}\n          <code className=\"inline-code\">$hero</code>) that can be used in relationships.\n        </div>\n\n        {creation.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2728</div>\n            <div className=\"empty-state-title\">No entities created</div>\n            <div className=\"empty-state-desc\">\n              This generator only modifies existing entities. Add creation rules to spawn new\n              entities.\n            </div>\n          </div>\n        ) : (\n          creation.map((item, index) => (\n            <CreationCard\n              key={index}\n              item={item}\n              onChange={(updated) => {\n                const newCreation = [...creation];\n                newCreation[index] = updated;\n                onChange({ ...generator, creation: newCreation });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, creation: creation.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n              culturesById={culturesById}\n              cultureIds={cultureIds}\n              generator={generator}\n              tagRegistry={tagRegistry}\n              onAddToRegistry={onAddToRegistry}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Entity Creation\n        </button>\n      </div>\n\n      <VariantsSection\n        generator={generator}\n        onChange={onChange}\n        pressures={pressures}\n        schema={schema}\n        tagRegistry={tagRegistry}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}", "type": "{ generator: any; onChange: Function; schema: any; tagRegistry: any[]; onAddToRegistry: Function; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "VariantsSection", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 3}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::RelationshipsTab", "name": "RelationshipsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n */\nexport function RelationshipsTab({ generator, onChange, schema }) {\n  const relationships = generator.relationships || [];\n  const saturationLimits = generator.selection?.saturationLimits || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, generator.creation]);\n\n  // Find the first created entity ref for implied relationships\n  const firstCreatedRef = useMemo(() => {\n    const creation = generator.creation || [];\n    return creation.length > 0 ? creation[0].entityRef : \"$created\";\n  }, [generator.creation]);\n\n  const handleAdd = () => {\n    onChange({\n      ...generator,\n      relationships: [\n        ...relationships,\n        {\n          kind: schema?.relationshipKinds?.[0]?.kind || \"ally_of\",\n          src: availableRefs[1] || \"$entity1\",\n          dst: \"$target\",\n          strength: 0.8,\n        },\n      ],\n    });\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Relationships</div>\n        <div className=\"section-desc\">\n          Define relationships created between entities. Use entity references like{\" \"}\n          <code className=\"inline-code\">$target</code>, created entities like{\" \"}\n          <code className=\"inline-code\">$hero</code>, or variables like{\" \"}\n          <code className=\"inline-code\">$faction</code>.\n        </div>\n\n        {/* Implied relationships from saturation limits */}\n        {saturationLimits.length > 0 && (\n          <div className=\"mb-xl\">\n            {saturationLimits.map((limit, index) => (\n              <ImpliedRelationshipCard\n                key={`implied-${index}`}\n                saturationLimit={limit}\n                schema={schema}\n                createdEntityRef={firstCreatedRef}\n              />\n            ))}\n          </div>\n        )}\n\n        {relationships.length === 0 && saturationLimits.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udd17</div>\n            <div className=\"empty-state-title\">No relationships</div>\n            <div className=\"empty-state-desc\">\n              This generator doesn&apos;t create any relationships. Add relationships to connect\n              entities.\n            </div>\n          </div>\n        ) : (\n          relationships.map((rel, index) => (\n            <RelationshipCard\n              key={index}\n              rel={rel}\n              onChange={(updated) => {\n                const newRels = [...relationships];\n                newRels[index] = updated;\n                onChange({ ...generator, relationships: newRels });\n              }}\n              onRemove={() =>\n                onChange({\n                  ...generator,\n                  relationships: relationships.filter((_, i) => i !== index),\n                })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Relationship\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ImpliedRelationshipCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::EffectsTab", "name": "EffectsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Object} props.schema - Domain schema\n */\nexport function EffectsTab({ generator, onChange, pressures, schema }) {\n  const stateUpdates = generator.stateUpdates || [];\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const addButtonRef = useRef(null);\n\n  // Build available entity references from target + variables + created entities\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, generator.creation]);\n\n  const createMutation = (type) => {\n    let newUpdate;\n    switch (type) {\n      case \"modify_pressure\":\n        newUpdate = { type: \"modify_pressure\", pressureId: pressures?.[0]?.id || \"\", delta: 0 };\n        break;\n      case \"archive_relationship\":\n        newUpdate = {\n          type: \"archive_relationship\",\n          entity: \"$target\",\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n        break;\n      case \"change_status\":\n        newUpdate = { type: \"change_status\", entity: \"$target\", newStatus: \"\" };\n        break;\n      case \"set_tag\":\n        newUpdate = { type: \"set_tag\", entity: \"$target\", tag: \"\", value: true };\n        break;\n      case \"remove_tag\":\n        newUpdate = { type: \"remove_tag\", entity: \"$target\", tag: \"\" };\n        break;\n      case \"update_rate_limit\":\n        newUpdate = { type: \"update_rate_limit\" };\n        break;\n      default:\n        return null;\n    }\n    return newUpdate;\n  };\n\n  const addMutation = (type) => {\n    const next = createMutation(type);\n    if (!next) return;\n    onChange({ ...generator, stateUpdates: [...stateUpdates, next] });\n  };\n\n  const updateMutation = (index, updated) => {\n    const newUpdates = [...stateUpdates];\n    newUpdates[index] = updated;\n    onChange({ ...generator, stateUpdates: newUpdates });\n  };\n\n  const removeMutation = (index) => {\n    onChange({ ...generator, stateUpdates: stateUpdates.filter((_, i) => i !== index) });\n  };\n\n  const knownTypes = new Set(DEFAULT_MUTATION_TYPES.map((type) => type.value));\n  const unrecognizedUpdates = stateUpdates\n    .map((update, index) => (knownTypes.has(update.type) ? null : { update, index }))\n    .filter(Boolean);\n\n  useLayoutEffect(() => {\n    if (showTypeMenu && addButtonRef.current) {\n      const rect = addButtonRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (event) => {\n      if (addButtonRef.current && !addButtonRef.current.contains(event.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  return (\n    <div>\n      {/* Unrecognized Effects - shown first to draw attention */}\n      {unrecognizedUpdates.length > 0 && (\n        <div className=\"section et-unrecognized-section\">\n          <div className=\"section-title et-unrecognized-title\">\n            <span>\u26a0\ufe0f</span> Unrecognized Effects\n          </div>\n          <div className=\"section-desc mb-lg\">\n            These state updates have unrecognized types and may be from an older version. Remove\n            them to clear validation errors.\n          </div>\n\n          {unrecognizedUpdates.map((entry) => {\n            const globalIdx = entry.index;\n            const update = entry.update;\n            return (\n              <div\n                key={globalIdx}\n                className=\"item-card et-unrecognized-card\"\n              >\n                <div className=\"et-unrecognized-body\">\n                  <div className=\"et-unrecognized-layout\">\n                    <div className=\"flex-1\">\n                      <div className=\"et-unrecognized-type\">\n                        Unknown type: &quot;{update.type || \"(no type)\"}&quot;\n                      </div>\n                      <pre className=\"et-unrecognized-json\">\n                        {JSON.stringify(update, null, 2)}\n                      </pre>\n                    </div>\n                    <button\n                      className=\"btn btn-danger flex-shrink-0\"\n                      onClick={() => removeMutation(globalIdx)}\n                    >\n                      Remove\n                    </button>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u26a1 Effects ({stateUpdates.length})</div>\n        <div className=\"section-desc\">\n          Apply state updates when this generator runs. Effects use the unified mutation library.\n        </div>\n\n        {stateUpdates.map((update, index) => {\n          if (!knownTypes.has(update.type)) return null;\n          return (\n            <MutationCard\n              key={index}\n              mutation={update}\n              onChange={(updated) => updateMutation(index, updated)}\n              onRemove={() => removeMutation(index)}\n              schema={schema}\n              pressures={pressures}\n              entityOptions={availableRefs}\n              typeOptions={DEFAULT_MUTATION_TYPES}\n              createMutation={createMutation}\n            />\n          );\n        })}\n\n        <div ref={addButtonRef} className=\"relative mt-lg\">\n          <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n            + Add Effect\n          </button>\n\n          {showTypeMenu && (\n            <div\n              className=\"dropdown-menu et-dropdown-fixed\"\n              // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n              style={{ '--et-dd-top': `${dropdownPos.top}px`, '--et-dd-left': `${dropdownPos.left}px`, '--et-dd-width': `${dropdownPos.width}px`, top: 'var(--et-dd-top)', left: 'var(--et-dd-left)', width: 'var(--et-dd-width)' }}\n            >\n              {MUTATION_TYPE_OPTIONS.map((opt) => (\n                <div\n                  key={opt.value}\n                  onClick={() => {\n                    addMutation(opt.value);\n                    setShowTypeMenu(false);\n                  }}\n                  className=\"dropdown-menu-item\"\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <span\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per mutation type\n                    style={{ '--et-icon-bg': `${opt.color}20`, backgroundColor: 'var(--et-icon-bg)' }}\n                  >\n                    {opt.icon}\n                  </span>\n                  <span className=\"dropdown-menu-label\">{opt.label}</span>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, pressures, schema }", "type": "{ generator: any; onChange: Function; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "pre", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "MutationCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useMemo", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::ApplicabilityTab", "name": "ApplicabilityTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n */\nexport function ApplicabilityTab({ generator, onChange, schema, pressures, eras }) {\n  const rules = generator.applicability || [];\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Applicability Rules</div>\n        <div className=\"section-desc\">\n          Define when this generator is eligible to run. If no rules are defined, the generator will\n          always be eligible. Multiple top-level rules are combined with AND logic.\n        </div>\n\n        {rules.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2713</div>\n            <div className=\"empty-state-title\">No applicability rules</div>\n            <div className=\"empty-state-desc\">\n              This generator will always be eligible to run. Add rules to control when it activates.\n            </div>\n          </div>\n        ) : (\n          rules.map((rule, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={rule}\n              onChange={(updated) => {\n                const newRules = [...rules];\n                newRules[index] = updated;\n                onChange({ ...generator, applicability: newRules });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, applicability: rules.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              pressures={pressures}\n              eras={eras}\n            />\n          ))\n        )}\n\n        <AddRuleButton\n          onAdd={(type) => {\n            const newRule = createNewRule(type, pressures);\n            onChange({ ...generator, applicability: [...rules, newRule] });\n          }}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema, pressures, eras }", "type": "{ generator: any; onChange: Function; schema: any; pressures: any[]; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Function} props.onDelete - Callback to delete the generator\n * @param {Function} props.onDuplicate - Callback to duplicate the generator\n */\nexport function OverviewTab({ generator, onChange, onDelete, onDuplicate }) {\n  const updateField = (field, value) => {\n    onChange({ ...generator, [field]: value });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(generator.id, (value) =>\n    updateField(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(generator.name, (value) =>\n    updateField(\"name\", value)\n  );\n\n  const summary = useMemo(() => {\n    return {\n      rules: generator.applicability?.length || 0,\n      variables: Object.keys(generator.variables || {}).length,\n      creates: generator.creation?.length || 0,\n      relationships: generator.relationships?.length || 0,\n      effects: generator.stateUpdates?.length || 0,\n    };\n  }, [generator]);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"generator-id\" className=\"label\">Generator ID</label>\n            <input id=\"generator-id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"display-name\" className=\"label\">Display Name</label>\n            <input id=\"display-name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n              placeholder=\"Optional friendly name\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Enabled\n          <EnableToggle\n            enabled={generator.enabled !== false}\n            onChange={(enabled) => updateField(\"enabled\", enabled)}\n            label={generator.enabled !== false ? \"Generator is active\" : \"Generator is disabled\"}\n          />\n          </label>\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">Narration Template</span>\n          <div className=\"section-desc mb-md\">\n            Syntax: {\"{$target.field}\"}, {\"{$var.field}\"}, {\"{count:kind}\"}, {\"{list:created}\"},{\" \"}\n            {\"{field|fallback}\"}.\n          </div>\n          <LocalTextArea\n            value={generator.narrationTemplate || \"\"}\n            onChange={(value) => updateField(\"narrationTemplate\", value || undefined)}\n            placeholder=\"e.g., From {$target.name}, {count:npc} new souls emerged to shape the realm.\"\n            rows={2}\n          />\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Summary</div>\n        <div className=\"summary-stats-grid\">\n          {[\n            { label: \"Rules\", value: summary.rules, icon: \"\u2713\" },\n            { label: \"Variables\", value: summary.variables, icon: \"\ud83d\udce6\" },\n            { label: \"Creates\", value: summary.creates, icon: \"\u2728\" },\n            { label: \"Connects\", value: summary.relationships, icon: \"\ud83d\udd17\" },\n            { label: \"Effects\", value: summary.effects, icon: \"\u26a1\" },\n          ].map((stat) => (\n            <div key={stat.label} className=\"summary-stat\">\n              <div className=\"summary-stat-icon\">{stat.icon}</div>\n              <div className=\"summary-stat-value\">{stat.value}</div>\n              <div className=\"summary-stat-label\">{stat.label}</div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"danger-zone\">\n        <button className=\"btn btn-secondary\" onClick={onDuplicate}>\n          Duplicate Generator\n        </button>\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete Generator\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, onDelete, onDuplicate }", "type": "{ generator: any; onChange: Function; onDelete: Function; onDuplicate: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useLocalInputState", "count": 2}, {"name": "useMemo", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["EnableToggle", "useLocalInputState", "LocalTextArea"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/RelationshipsTab.jsx::RelationshipsTab", "name": "RelationshipsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/RelationshipsTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n */\nexport function RelationshipsTab({ generator, onChange, schema }) {\n  const relationships = generator.relationships || [];\n  const saturationLimits = generator.selection?.saturationLimits || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, generator.creation]);\n\n  // Find the first created entity ref for implied relationships\n  const firstCreatedRef = useMemo(() => {\n    const creation = generator.creation || [];\n    return creation.length > 0 ? creation[0].entityRef : \"$created\";\n  }, [generator.creation]);\n\n  const handleAdd = () => {\n    onChange({\n      ...generator,\n      relationships: [\n        ...relationships,\n        {\n          kind: schema?.relationshipKinds?.[0]?.kind || \"ally_of\",\n          src: availableRefs[1] || \"$entity1\",\n          dst: \"$target\",\n          strength: 0.8,\n        },\n      ],\n    });\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Relationships</div>\n        <div className=\"section-desc\">\n          Define relationships created between entities. Use entity references like{\" \"}\n          <code className=\"inline-code\">$target</code>, created entities like{\" \"}\n          <code className=\"inline-code\">$hero</code>, or variables like{\" \"}\n          <code className=\"inline-code\">$faction</code>.\n        </div>\n\n        {/* Implied relationships from saturation limits */}\n        {saturationLimits.length > 0 && (\n          <div className=\"mb-xl\">\n            {saturationLimits.map((limit, index) => (\n              <ImpliedRelationshipCard\n                key={`implied-${index}`}\n                saturationLimit={limit}\n                schema={schema}\n                createdEntityRef={firstCreatedRef}\n              />\n            ))}\n          </div>\n        )}\n\n        {relationships.length === 0 && saturationLimits.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udd17</div>\n            <div className=\"empty-state-title\">No relationships</div>\n            <div className=\"empty-state-desc\">\n              This generator doesn&apos;t create any relationships. Add relationships to connect\n              entities.\n            </div>\n          </div>\n        ) : (\n          relationships.map((rel, index) => (\n            <RelationshipCard\n              key={index}\n              rel={rel}\n              onChange={(updated) => {\n                const newRels = [...relationships];\n                newRels[index] = updated;\n                onChange({ ...generator, relationships: newRels });\n              }}\n              onRemove={() =>\n                onChange({\n                  ...generator,\n                  relationships: relationships.filter((_, i) => i !== index),\n                })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Relationship\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ImpliedRelationshipCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 2}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput"], "category": "internal"}, {"source": "./RelationshipsTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/TargetTab.jsx::TargetTab", "name": "TargetTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/TargetTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema with entity/relationship kinds\n */\nexport function TargetTab({ generator, onChange, schema }) {\n  const selection = generator.selection || { strategy: \"by_kind\" };\n\n  // Get the kind of the first created entity for saturation limit inference\n  const firstCreatedKind = (generator.creation || [])[0]?.kind;\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Target Selection</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What is $target?</div>\n          <div className=\"info-box-text\">\n            The <code className=\"inline-code\">$target</code> is the primary entity this generator\n            operates on. It&apos;s selected from the world graph based on the rules you define here. Once\n            selected, you can reference it in creation rules (e.g., inherit culture from $target)\n            and relationships (e.g., connect new entity to $target).\n          </div>\n        </div>\n\n        <SelectionRuleEditor\n          value={selection}\n          onChange={(updated) => onChange({ ...generator, selection: updated })}\n          schema={schema}\n          availableRefs={[\"$target\", ...Object.keys(generator.variables || {})]}\n        />\n\n        {/* Saturation Limits */}\n        <div className=\"mt-2xl\">\n          <span className=\"label\">Saturation Limits</span>\n          <div className=\"info-box-text mb-lg text-sm\">\n            Limit targets based on existing relationship counts. Only targets with fewer than the\n            max count of relationships will be selected.\n          </div>\n          <SaturationLimitsEditor\n            limits={selection.saturationLimits || []}\n            onChange={(limits) =>\n              onChange({\n                ...generator,\n                selection: {\n                  ...selection,\n                  saturationLimits: limits.length > 0 ? limits : undefined,\n                },\n              })\n            }\n            schema={schema}\n            createdKind={firstCreatedKind}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "SelectionRuleEditor", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SaturationLimitsEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput"], "category": "internal"}, {"source": "../../shared/SelectionRuleEditor", "specifiers": ["SelectionRuleEditor"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/VariablesTab.jsx::VariablesTab", "name": "VariablesTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/VariablesTab.jsx", "sourceCode": "// ============================================================================\n// VariablesTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n */\nexport function VariablesTab({ generator, onChange, schema }) {\n  const variables = generator.variables || {};\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  // Build available refs for relationship queries (target + other vars + creation refs)\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$target\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    // Ensure the name starts with $\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    // Create with empty required fields - validation will flag them\n    onChange({\n      ...generator,\n      variables: {\n        ...variables,\n        [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"\" } },\n      },\n    });\n    setNewVarName(\"\");\n    setShowAddForm(false);\n  };\n\n  const varEntries = Object.entries(variables);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Variables</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What are variables?</div>\n          <div className=\"info-box-text\">\n            Variables let you select additional entities from the graph to use in creation and\n            relationships. For example, you might select a{\" \"}\n            <code className=\"inline-code\">$faction</code> to make a new NPC a member of, or an{\" \"}\n            <code className=\"inline-code\">$ability</code> for them to practice. Variables are\n            selected after <code className=\"inline-code\">$target</code> is chosen.\n          </div>\n        </div>\n\n        {varEntries.length === 0 && !showAddForm ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udce6</div>\n            <div className=\"empty-state-title\">No variables defined</div>\n            <div className=\"empty-state-desc\">\n              Add variables to select additional entities for use in creation and relationships.\n            </div>\n          </div>\n        ) : (\n          varEntries.map(([name, config]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={config}\n              onChange={(updated) =>\n                onChange({ ...generator, variables: { ...variables, [name]: updated } })\n              }\n              onRemove={() => {\n                const newVars = { ...variables };\n                delete newVars[name];\n                onChange({ ...generator, variables: newVars });\n              }}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared/VariableSelectionEditor", "specifiers": ["VariableSelectionEditor"], "category": "internal"}, {"source": "./VariablesTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/pressures/cards/FactorCard.jsx::FactorCard", "name": "FactorCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/cards/FactorCard.jsx", "sourceCode": "export function FactorCard({\n  factor,\n  feedbackType,\n  onEdit,\n  onDelete,\n  schema: _schema\n}) {\n  const typeConfig = FACTOR_TYPES[factor.type] || {};\n\n  // Generate summary based on factor type\n  const getSummary = () => {\n    switch (factor.type) {\n      case \"entity_count\":\n        {\n          const entityKindSpec = `${factor.kind}${factor.subtype ? \":\" + factor.subtype : \"\"}`;\n          const statusSuffix = factor.status ? ` (${factor.status})` : \"\";\n          return `${entityKindSpec}${statusSuffix}`;\n        }\n      case \"relationship_count\":\n        return factor.relationshipKinds?.join(\", \") || \"No relationships selected\";\n      case \"tag_count\":\n        return factor.tags?.join(\", \") || \"No tags selected\";\n      case \"ratio\":\n        {\n          const num = factor.numerator?.kind || factor.numerator?.relationshipKinds?.join(\",\") || \"?\";\n          const den = factor.denominator?.kind || factor.denominator?.relationshipKinds?.join(\",\") || factor.denominator?.type || \"?\";\n          return `${num} / ${den}`;\n        }\n      case \"status_ratio\":\n        {\n          const statusKindSpec = `${factor.kind}${factor.subtype ? \":\" + factor.subtype : \"\"}`;\n          return `${statusKindSpec} (${factor.aliveStatus})`;\n        }\n      case \"cross_culture_ratio\":\n        return factor.relationshipKinds?.join(\", \") || \"No relationships selected\";\n      default:\n        return \"Unknown factor\";\n    }\n  };\n  return <div className=\"nested-card\">\n      <div className=\"nested-card-header\" onClick={onEdit} role=\"button\" tabIndex={0} onKeyDown={e => {\n      if (e.key === \"Enter\" || e.key === \" \") onEdit(e);\n    }}>\n        {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color */}\n        <div className=\"nested-card-icon\" style={{\n        '--fc-icon-bg': `${typeConfig.color}20`, backgroundColor: 'var(--fc-icon-bg)'\n      }}>\n          {typeConfig.icon}\n        </div>\n        <div className=\"nested-card-info\">\n          <div className=\"nested-card-type\">{typeConfig.label}</div>\n          <div className=\"nested-card-summary\">{getSummary()}</div>\n        </div>\n        <div className={`nested-card-coefficient ${feedbackType === \"positive\" ? \"pc-factor-positive\" : \"pc-factor-negative\"}`}>\n          {feedbackType === \"positive\" ? \"+\" : \"\u2212\"}\n          {Math.abs(factor.coefficient)}\n          {factor.cap ? ` (cap: ${factor.cap})` : \"\"}\n        </div>\n        <div className=\"nested-card-actions\">\n          <button className=\"icon-button\" onClick={e => {\n          e.stopPropagation();\n          onEdit();\n        }} title=\"Edit\">\n            \u270f\ufe0f\n          </button>\n          <button className=\"icon-button delete-button\" onClick={e => {\n          e.stopPropagation();\n          onDelete();\n        }} title=\"Remove\">\n            \ud83d\uddd1\ufe0f\n          </button>\n        </div>\n      </div>\n    </div>;\n}", "parameters": [{"name": "{\n  factor,\n  feedbackType,\n  onEdit,\n  onDelete,\n  schema: _schema\n}", "type": "{ factor: any; feedbackType: any; onEdit: any; onDelete: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["FACTOR_TYPES"], "category": "internal"}, {"source": "./PressureCard.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/pressures/cards/index.js::FactorCard", "name": "FactorCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/cards/index.js", "sourceCode": "export function FactorCard({\n  factor,\n  feedbackType,\n  onEdit,\n  onDelete,\n  schema: _schema\n}) {\n  const typeConfig = FACTOR_TYPES[factor.type] || {};\n\n  // Generate summary based on factor type\n  const getSummary = () => {\n    switch (factor.type) {\n      case \"entity_count\":\n        {\n          const entityKindSpec = `${factor.kind}${factor.subtype ? \":\" + factor.subtype : \"\"}`;\n          const statusSuffix = factor.status ? ` (${factor.status})` : \"\";\n          return `${entityKindSpec}${statusSuffix}`;\n        }\n      case \"relationship_count\":\n        return factor.relationshipKinds?.join(\", \") || \"No relationships selected\";\n      case \"tag_count\":\n        return factor.tags?.join(\", \") || \"No tags selected\";\n      case \"ratio\":\n        {\n          const num = factor.numerator?.kind || factor.numerator?.relationshipKinds?.join(\",\") || \"?\";\n          const den = factor.denominator?.kind || factor.denominator?.relationshipKinds?.join(\",\") || factor.denominator?.type || \"?\";\n          return `${num} / ${den}`;\n        }\n      case \"status_ratio\":\n        {\n          const statusKindSpec = `${factor.kind}${factor.subtype ? \":\" + factor.subtype : \"\"}`;\n          return `${statusKindSpec} (${factor.aliveStatus})`;\n        }\n      case \"cross_culture_ratio\":\n        return factor.relationshipKinds?.join(\", \") || \"No relationships selected\";\n      default:\n        return \"Unknown factor\";\n    }\n  };\n  return <div className=\"nested-card\">\n      <div className=\"nested-card-header\" onClick={onEdit} role=\"button\" tabIndex={0} onKeyDown={e => {\n      if (e.key === \"Enter\" || e.key === \" \") onEdit(e);\n    }}>\n        {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color */}\n        <div className=\"nested-card-icon\" style={{\n        '--fc-icon-bg': `${typeConfig.color}20`, backgroundColor: 'var(--fc-icon-bg)'\n      }}>\n          {typeConfig.icon}\n        </div>\n        <div className=\"nested-card-info\">\n          <div className=\"nested-card-type\">{typeConfig.label}</div>\n          <div className=\"nested-card-summary\">{getSummary()}</div>\n        </div>\n        <div className={`nested-card-coefficient ${feedbackType === \"positive\" ? \"pc-factor-positive\" : \"pc-factor-negative\"}`}>\n          {feedbackType === \"positive\" ? \"+\" : \"\u2212\"}\n          {Math.abs(factor.coefficient)}\n          {factor.cap ? ` (cap: ${factor.cap})` : \"\"}\n        </div>\n        <div className=\"nested-card-actions\">\n          <button className=\"icon-button\" onClick={e => {\n          e.stopPropagation();\n          onEdit();\n        }} title=\"Edit\">\n            \u270f\ufe0f\n          </button>\n          <button className=\"icon-button delete-button\" onClick={e => {\n          e.stopPropagation();\n          onDelete();\n        }} title=\"Remove\">\n            \ud83d\uddd1\ufe0f\n          </button>\n        </div>\n      </div>\n    </div>;\n}", "parameters": [{"name": "{\n  factor,\n  feedbackType,\n  onEdit,\n  onDelete,\n  schema: _schema\n}", "type": "{ factor: any; feedbackType: any; onEdit: any; onDelete: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/pressures/cards/index.js::PressureCard", "name": "PressureCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/cards/index.js", "sourceCode": "export function PressureCard({\n  pressure,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  schema,\n  usageMap,\n  projectId,\n}) {\n  const [, setHovering] = useState(false);\n  const [editingFactor, setEditingFactor] = useState(null);\n  const [addingFactorType, setAddingFactorType] = useState(null);\n  const factorModalKey = buildStorageKey(projectId, \"pressures:factorModal\");\n\n  const handleFieldChange = useCallback(\n    (field, value) => {\n      onChange({\n        ...pressure,\n        [field]: value,\n      });\n    },\n    [pressure, onChange]\n  );\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(pressure.id, (value) =>\n    handleFieldChange(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(pressure.name, (value) =>\n    handleFieldChange(\"name\", value)\n  );\n  const [localDescription, setLocalDescription, handleDescriptionBlur] = useLocalInputState(\n    pressure.description || \"\",\n    (value) => handleFieldChange(\"description\", value)\n  );\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"pressure\", pressure.id)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, pressure.id]\n  );\n\n  const usage = useMemo(() => {\n    if (!usageMap?.pressures?.[pressure.id]) return null;\n    return usageMap.pressures[pressure.id];\n  }, [usageMap, pressure.id]);\n\n  const hasErrors = validation.invalidRefs.length > 0;\n  const isOrphan = validation.isOrphan;\n  const usedByCount = usage\n    ? (usage.generators?.length || 0) + (usage.systems?.length || 0) + (usage.actions?.length || 0)\n    : 0;\n\n  const handleGrowthChange = useCallback(\n    (field, value) => {\n      onChange({\n        ...pressure,\n        growth: {\n          ...pressure.growth,\n          [field]: value,\n        },\n      });\n    },\n    [pressure, onChange]\n  );\n\n  const persistFactorModal = useCallback(\n    (payload) => {\n      if (!factorModalKey) return;\n      if (payload) {\n        saveStoredValue(factorModalKey, payload);\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    },\n    [factorModalKey]\n  );\n\n  const handleAddFactor = useCallback(\n    (feedbackType) => {\n      setAddingFactorType(feedbackType);\n      persistFactorModal({\n        pressureId: pressure.id,\n        mode: \"add\",\n        feedbackType,\n      });\n    },\n    [pressure.id, persistFactorModal]\n  );\n\n  const handleSaveFactor = useCallback(\n    (factor, feedbackType, index) => {\n      const feedbackKey = feedbackType === \"positive\" ? \"positiveFeedback\" : \"negativeFeedback\";\n      const currentFactors = [...(pressure.growth?.[feedbackKey] || [])];\n\n      if (index !== undefined && index >= 0) {\n        currentFactors[index] = factor;\n      } else {\n        currentFactors.push(factor);\n      }\n\n      handleGrowthChange(feedbackKey, currentFactors);\n      setEditingFactor(null);\n      setAddingFactorType(null);\n      persistFactorModal(null);\n    },\n    [pressure, handleGrowthChange, persistFactorModal]\n  );\n\n  const handleEditFactor = useCallback(\n    (factor, feedbackType, index) => {\n      setEditingFactor({ factor, feedbackType, index });\n      persistFactorModal({\n        pressureId: pressure.id,\n        mode: \"edit\",\n        feedbackType,\n        factorIndex: index,\n      });\n    },\n    [pressure.id, persistFactorModal]\n  );\n\n  const handleCloseFactorModal = useCallback(() => {\n    setEditingFactor(null);\n    setAddingFactorType(null);\n    persistFactorModal(null);\n  }, [persistFactorModal]);\n\n  const handleRemoveFactor = useCallback(\n    (feedbackType, index) => {\n      const feedbackKey = feedbackType === \"positive\" ? \"positiveFeedback\" : \"negativeFeedback\";\n      const newFactors = [...(pressure.growth?.[feedbackKey] || [])];\n      newFactors.splice(index, 1);\n      handleGrowthChange(feedbackKey, newFactors);\n    },\n    [pressure, handleGrowthChange]\n  );\n\n  const positiveFeedback = pressure.growth?.positiveFeedback || [];\n  const negativeFeedback = pressure.growth?.negativeFeedback || [];\n  // Compute feedback loop balance status\n  const feedbackStatus = useMemo(() => {\n    const hasPositive = positiveFeedback.length > 0;\n    const hasNegative = negativeFeedback.length > 0;\n    const hasHomeostasis = (pressure.homeostasis || 0) !== 0;\n\n    if (!hasPositive && !hasNegative && !hasHomeostasis) {\n      return {\n        icon: \"\u26aa\",\n        color: \"#9ca3af\",\n        label: \"Static\",\n        description: \"No feedback or homeostasis\",\n      };\n    }\n    if (!hasPositive && !hasNegative && hasHomeostasis) {\n      return {\n        icon: \"\ud83e\udded\",\n        color: \"#22c55e\",\n        label: \"Centering\",\n        description: \"Homeostasis will pull toward equilibrium\",\n      };\n    }\n    if (hasPositive && !hasNegative) {\n      return {\n        icon: \"\ud83d\udcc8\",\n        color: \"#f59e0b\",\n        label: \"Runaway\",\n        description: \"May grow unbounded - consider adding negative feedback\",\n      };\n    }\n    if (!hasPositive && hasNegative && !hasHomeostasis) {\n      return {\n        icon: \"\ud83d\udcc9\",\n        color: \"#3b82f6\",\n        label: \"Diminishing\",\n        description: \"Will trend downward from feedback alone\",\n      };\n    }\n    // Both present - self-correcting\n    return {\n      icon: \"\u2696\ufe0f\",\n      color: \"#22c55e\",\n      label: \"Balanced\",\n      description: \"Feedback plus homeostasis provide stabilization\",\n    };\n  }, [positiveFeedback.length, negativeFeedback.length, pressure.homeostasis]);\n\n  // Restore factor modal state from storage (guarded)\n  const restoredModalKeyRef = useRef(null);\n  useEffect(() => {\n    if (!factorModalKey || editingFactor || addingFactorType || restoredModalKeyRef.current === factorModalKey) {\n      return;\n    }\n\n    restoredModalKeyRef.current = factorModalKey;\n    const stored = loadStoredValue(factorModalKey);\n    if (!(stored && stored.pressureId === pressure.id)) {\n      return;\n    }\n\n    if (stored.mode === \"add\") {\n      // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted factor modal state\n      setAddingFactorType(stored.feedbackType);\n      return;\n    }\n\n    if (stored.mode === \"edit\") {\n      const feedbackKey =\n        stored.feedbackType === \"positive\" ? \"positiveFeedback\" : \"negativeFeedback\";\n      const factor = pressure.growth?.[feedbackKey]?.[stored.factorIndex];\n      if (factor) {\n        // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted factor modal state\n        setEditingFactor({ factor, feedbackType: stored.feedbackType, index: stored.factorIndex });\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    }\n  }, [addingFactorType, editingFactor, factorModalKey, pressure]);\n\n  return (\n    <div className=\"expandable-card\">\n      <div\n        className=\"expandable-card-header\"\n        onClick={onToggle}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onToggle(e); }}\n      >\n        <div\n          className=\"expandable-card-title pc-title-layout\"\n        >\n          <div className=\"pc-title-row\">\n            <span className=\"expandable-card-name\">{pressure.name}</span>\n            <span className=\"expandable-card-id\">{pressure.id}</span>\n            {hasErrors && (\n              <span className=\"card-error-badge\">\n                {validation.invalidRefs.length} error\n                {validation.invalidRefs.length !== 1 ? \"s\" : \"\"}\n              </span>\n            )}\n            {usedByCount > 0 && <span className=\"card-usage-badge\">Used by {usedByCount}</span>}\n            {isOrphan && !hasErrors && <span className=\"card-orphan-badge\">Not used</span>}\n          </div>\n          {pressure.description && (\n            <div className=\"expandable-card-subtitle\">{pressure.description}</div>\n          )}\n        </div>\n        <div className=\"pc-header-right\">\n          <div className=\"expandable-card-stats\">\n            <div className=\"stat\">\n              <span className=\"stat-label\">Initial</span>\n              <span className=\"stat-value\">{pressure.initialValue}</span>\n              <div className=\"stat-bar\">\n                <div\n                  className=\"stat-bar-fill pc-stat-bar-fill\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic width from pressure value\n                  style={{\n                    '--pc-bar-width': `${Math.min(100, Math.max(0, ((pressure.initialValue || 0) + 100) / 2))}%`,\n                    width: 'var(--pc-bar-width)',\n                  }}\n                />\n              </div>\n            </div>\n            <div className=\"stat\">\n              <span className=\"stat-label\">Homeostasis</span>\n              <span className=\"stat-value\">{pressure.homeostasis}</span>\n            </div>\n            <div className=\"stat\">\n              <span className=\"stat-label\">Factors</span>\n              <span className=\"stat-value\">\n                <span className=\"pc-factor-positive\">+{positiveFeedback.length}</span>\n                {\" / \"}\n                <span className=\"pc-factor-negative\">-{negativeFeedback.length}</span>\n              </span>\n            </div>\n            <div className=\"stat\" title={feedbackStatus.description}>\n              <span className=\"stat-label\">Balance</span>\n              {/* eslint-disable-next-line local/no-inline-styles -- dynamic feedback color */}\n              <span\n                className=\"stat-value pc-balance-value\"\n                style={{ '--pc-balance-color': feedbackStatus.color, color: 'var(--pc-balance-color)' }}\n              >\n                <span>{feedbackStatus.icon}</span>\n                <span className=\"pc-balance-label\">{feedbackStatus.label}</span>\n              </span>\n            </div>\n          </div>\n          <span className={`expand-icon ${expanded ? \"expand-icon-open\" : \"\"}`}>\u25bc</span>\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"expandable-card-content\">\n          {/* Basic Info */}\n          <div className=\"section\">\n// ... (truncated)", "parameters": [{"name": "{\n  pressure,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  schema,\n  usageMap,\n  projectId,\n}", "type": "{ pressure: any; expanded: any; onToggle: any; onChange: any; onDelete: any; schema: any; usageMap: any; projectId: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "textarea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "FactorEditorModal", "children": [], "isMap": false, "isConditional": true}, {"tag": "FactorEditorModal", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 3}, {"name": "useCallback", "count": 8}, {"name": "useLocalInputState", "count": 3}, {"name": "useMemo", "count": 3}, {"name": "useRef", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/pressures/cards/PressureCard.jsx::PressureCard", "name": "PressureCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/cards/PressureCard.jsx", "sourceCode": "export function PressureCard({\n  pressure,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  schema,\n  usageMap,\n  projectId,\n}) {\n  const [, setHovering] = useState(false);\n  const [editingFactor, setEditingFactor] = useState(null);\n  const [addingFactorType, setAddingFactorType] = useState(null);\n  const factorModalKey = buildStorageKey(projectId, \"pressures:factorModal\");\n\n  const handleFieldChange = useCallback(\n    (field, value) => {\n      onChange({\n        ...pressure,\n        [field]: value,\n      });\n    },\n    [pressure, onChange]\n  );\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(pressure.id, (value) =>\n    handleFieldChange(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(pressure.name, (value) =>\n    handleFieldChange(\"name\", value)\n  );\n  const [localDescription, setLocalDescription, handleDescriptionBlur] = useLocalInputState(\n    pressure.description || \"\",\n    (value) => handleFieldChange(\"description\", value)\n  );\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"pressure\", pressure.id)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, pressure.id]\n  );\n\n  const usage = useMemo(() => {\n    if (!usageMap?.pressures?.[pressure.id]) return null;\n    return usageMap.pressures[pressure.id];\n  }, [usageMap, pressure.id]);\n\n  const hasErrors = validation.invalidRefs.length > 0;\n  const isOrphan = validation.isOrphan;\n  const usedByCount = usage\n    ? (usage.generators?.length || 0) + (usage.systems?.length || 0) + (usage.actions?.length || 0)\n    : 0;\n\n  const handleGrowthChange = useCallback(\n    (field, value) => {\n      onChange({\n        ...pressure,\n        growth: {\n          ...pressure.growth,\n          [field]: value,\n        },\n      });\n    },\n    [pressure, onChange]\n  );\n\n  const persistFactorModal = useCallback(\n    (payload) => {\n      if (!factorModalKey) return;\n      if (payload) {\n        saveStoredValue(factorModalKey, payload);\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    },\n    [factorModalKey]\n  );\n\n  const handleAddFactor = useCallback(\n    (feedbackType) => {\n      setAddingFactorType(feedbackType);\n      persistFactorModal({\n        pressureId: pressure.id,\n        mode: \"add\",\n        feedbackType,\n      });\n    },\n    [pressure.id, persistFactorModal]\n  );\n\n  const handleSaveFactor = useCallback(\n    (factor, feedbackType, index) => {\n      const feedbackKey = feedbackType === \"positive\" ? \"positiveFeedback\" : \"negativeFeedback\";\n      const currentFactors = [...(pressure.growth?.[feedbackKey] || [])];\n\n      if (index !== undefined && index >= 0) {\n        currentFactors[index] = factor;\n      } else {\n        currentFactors.push(factor);\n      }\n\n      handleGrowthChange(feedbackKey, currentFactors);\n      setEditingFactor(null);\n      setAddingFactorType(null);\n      persistFactorModal(null);\n    },\n    [pressure, handleGrowthChange, persistFactorModal]\n  );\n\n  const handleEditFactor = useCallback(\n    (factor, feedbackType, index) => {\n      setEditingFactor({ factor, feedbackType, index });\n      persistFactorModal({\n        pressureId: pressure.id,\n        mode: \"edit\",\n        feedbackType,\n        factorIndex: index,\n      });\n    },\n    [pressure.id, persistFactorModal]\n  );\n\n  const handleCloseFactorModal = useCallback(() => {\n    setEditingFactor(null);\n    setAddingFactorType(null);\n    persistFactorModal(null);\n  }, [persistFactorModal]);\n\n  const handleRemoveFactor = useCallback(\n    (feedbackType, index) => {\n      const feedbackKey = feedbackType === \"positive\" ? \"positiveFeedback\" : \"negativeFeedback\";\n      const newFactors = [...(pressure.growth?.[feedbackKey] || [])];\n      newFactors.splice(index, 1);\n      handleGrowthChange(feedbackKey, newFactors);\n    },\n    [pressure, handleGrowthChange]\n  );\n\n  const positiveFeedback = pressure.growth?.positiveFeedback || [];\n  const negativeFeedback = pressure.growth?.negativeFeedback || [];\n  // Compute feedback loop balance status\n  const feedbackStatus = useMemo(() => {\n    const hasPositive = positiveFeedback.length > 0;\n    const hasNegative = negativeFeedback.length > 0;\n    const hasHomeostasis = (pressure.homeostasis || 0) !== 0;\n\n    if (!hasPositive && !hasNegative && !hasHomeostasis) {\n      return {\n        icon: \"\u26aa\",\n        color: \"#9ca3af\",\n        label: \"Static\",\n        description: \"No feedback or homeostasis\",\n      };\n    }\n    if (!hasPositive && !hasNegative && hasHomeostasis) {\n      return {\n        icon: \"\ud83e\udded\",\n        color: \"#22c55e\",\n        label: \"Centering\",\n        description: \"Homeostasis will pull toward equilibrium\",\n      };\n    }\n    if (hasPositive && !hasNegative) {\n      return {\n        icon: \"\ud83d\udcc8\",\n        color: \"#f59e0b\",\n        label: \"Runaway\",\n        description: \"May grow unbounded - consider adding negative feedback\",\n      };\n    }\n    if (!hasPositive && hasNegative && !hasHomeostasis) {\n      return {\n        icon: \"\ud83d\udcc9\",\n        color: \"#3b82f6\",\n        label: \"Diminishing\",\n        description: \"Will trend downward from feedback alone\",\n      };\n    }\n    // Both present - self-correcting\n    return {\n      icon: \"\u2696\ufe0f\",\n      color: \"#22c55e\",\n      label: \"Balanced\",\n      description: \"Feedback plus homeostasis provide stabilization\",\n    };\n  }, [positiveFeedback.length, negativeFeedback.length, pressure.homeostasis]);\n\n  // Restore factor modal state from storage (guarded)\n  const restoredModalKeyRef = useRef(null);\n  useEffect(() => {\n    if (!factorModalKey || editingFactor || addingFactorType || restoredModalKeyRef.current === factorModalKey) {\n      return;\n    }\n\n    restoredModalKeyRef.current = factorModalKey;\n    const stored = loadStoredValue(factorModalKey);\n    if (!(stored && stored.pressureId === pressure.id)) {\n      return;\n    }\n\n    if (stored.mode === \"add\") {\n      // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted factor modal state\n      setAddingFactorType(stored.feedbackType);\n      return;\n    }\n\n    if (stored.mode === \"edit\") {\n      const feedbackKey =\n        stored.feedbackType === \"positive\" ? \"positiveFeedback\" : \"negativeFeedback\";\n      const factor = pressure.growth?.[feedbackKey]?.[stored.factorIndex];\n      if (factor) {\n        // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted factor modal state\n        setEditingFactor({ factor, feedbackType: stored.feedbackType, index: stored.factorIndex });\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    }\n  }, [addingFactorType, editingFactor, factorModalKey, pressure]);\n\n  return (\n    <div className=\"expandable-card\">\n      <div\n        className=\"expandable-card-header\"\n        onClick={onToggle}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onToggle(e); }}\n      >\n        <div\n          className=\"expandable-card-title pc-title-layout\"\n        >\n          <div className=\"pc-title-row\">\n            <span className=\"expandable-card-name\">{pressure.name}</span>\n            <span className=\"expandable-card-id\">{pressure.id}</span>\n            {hasErrors && (\n              <span className=\"card-error-badge\">\n                {validation.invalidRefs.length} error\n                {validation.invalidRefs.length !== 1 ? \"s\" : \"\"}\n              </span>\n            )}\n            {usedByCount > 0 && <span className=\"card-usage-badge\">Used by {usedByCount}</span>}\n            {isOrphan && !hasErrors && <span className=\"card-orphan-badge\">Not used</span>}\n          </div>\n          {pressure.description && (\n            <div className=\"expandable-card-subtitle\">{pressure.description}</div>\n          )}\n        </div>\n        <div className=\"pc-header-right\">\n          <div className=\"expandable-card-stats\">\n            <div className=\"stat\">\n              <span className=\"stat-label\">Initial</span>\n              <span className=\"stat-value\">{pressure.initialValue}</span>\n              <div className=\"stat-bar\">\n                <div\n                  className=\"stat-bar-fill pc-stat-bar-fill\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic width from pressure value\n                  style={{\n                    '--pc-bar-width': `${Math.min(100, Math.max(0, ((pressure.initialValue || 0) + 100) / 2))}%`,\n                    width: 'var(--pc-bar-width)',\n                  }}\n                />\n              </div>\n            </div>\n            <div className=\"stat\">\n              <span className=\"stat-label\">Homeostasis</span>\n              <span className=\"stat-value\">{pressure.homeostasis}</span>\n            </div>\n            <div className=\"stat\">\n              <span className=\"stat-label\">Factors</span>\n              <span className=\"stat-value\">\n                <span className=\"pc-factor-positive\">+{positiveFeedback.length}</span>\n                {\" / \"}\n                <span className=\"pc-factor-negative\">-{negativeFeedback.length}</span>\n              </span>\n            </div>\n            <div className=\"stat\" title={feedbackStatus.description}>\n              <span className=\"stat-label\">Balance</span>\n              {/* eslint-disable-next-line local/no-inline-styles -- dynamic feedback color */}\n              <span\n                className=\"stat-value pc-balance-value\"\n                style={{ '--pc-balance-color': feedbackStatus.color, color: 'var(--pc-balance-color)' }}\n              >\n                <span>{feedbackStatus.icon}</span>\n                <span className=\"pc-balance-label\">{feedbackStatus.label}</span>\n              </span>\n            </div>\n          </div>\n          <span className={`expand-icon ${expanded ? \"expand-icon-open\" : \"\"}`}>\u25bc</span>\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"expandable-card-content\">\n          {/* Basic Info */}\n          <div className=\"section\">\n// ... (truncated)", "parameters": [{"name": "{\n  pressure,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  schema,\n  usageMap,\n  projectId,\n}", "type": "{ pressure: any; expanded: any; onToggle: any; onChange: any; onDelete: any; schema: any; usageMap: any; projectId: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "textarea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "FactorEditorModal", "children": [], "isMap": false, "isConditional": true}, {"tag": "FactorEditorModal", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 3}, {"name": "useCallback", "count": 8}, {"name": "useLocalInputState", "count": 3}, {"name": "useMemo", "count": 3}, {"name": "useRef", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useCallback", "useMemo", "useRef", "useEffect"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./FactorCard", "specifiers": ["FactorCard"], "category": "internal"}, {"source": "../modals/FactorEditorModal", "specifiers": ["FactorEditorModal"], "category": "internal"}, {"source": "../../shared", "specifiers": ["getElementValidation", "useLocalInputState", "NumberInput"], "category": "internal"}, {"source": "../../../utils/persistence", "specifiers": ["buildStorageKey", "clearStoredValue", "loadStoredValue", "saveStoredValue"], "category": "internal"}, {"source": "./PressureCard.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/pressures/modals/FactorEditorModal.jsx::FactorEditorModal", "name": "FactorEditorModal", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/modals/FactorEditorModal.jsx", "sourceCode": "export function FactorEditorModal({ isOpen, onClose, factor, onChange, feedbackType, schema }) {\n  const [localFactor, setLocalFactor] = useState(factor || { type: \"entity_count\" });\n  const [selectedType, setSelectedType] = useState(factor?.type || \"entity_count\");\n\n  // Build options from schema\n  const entityKindOptions = useMemo(() => {\n    return (schema?.entityKinds || []).map((ek) => ({\n      value: ek.kind,\n      label: ek.description || ek.kind,\n    }));\n  }, [schema]);\n\n  const getSubtypeOptions = useCallback(\n    (kind) => {\n      const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n      if (!ek?.subtypes) return [];\n      return ek.subtypes.map((st) => ({\n        value: st.id,\n        label: st.name || st.id,\n      }));\n    },\n    [schema]\n  );\n\n  const getStatusOptions = useCallback(\n    (kind) => {\n      const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n      if (!ek?.statuses) return [];\n      return ek.statuses.map((st) => ({\n        value: st.id,\n        label: st.name || st.id,\n        meta: st.isTerminal ? \"terminal\" : \"\",\n      }));\n    },\n    [schema]\n  );\n\n  const relationshipKindOptions = useMemo(() => {\n    return (schema?.relationshipKinds || []).map((rk) => ({\n      value: rk.kind,\n      label: rk.description || rk.kind,\n    }));\n  }, [schema]);\n\n  // Sync local state when factor or isOpen changes\n  useEffect(() => {\n    if (factor) {\n      // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n      setLocalFactor(factor);\n      // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n      setSelectedType(factor.type);\n      return;\n    }\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n    setLocalFactor({ type: \"entity_count\", coefficient: 1 });\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n    setSelectedType(\"entity_count\");\n  }, [factor, isOpen]);\n\n  const handleTypeChange = (type) => {\n    setSelectedType(type);\n    // Reset factor to defaults for new type\n    const defaults = { type, coefficient: 1 };\n    if (type === \"ratio\") {\n      defaults.numerator = { type: \"entity_count\" };\n      defaults.denominator = { type: \"entity_count\" };\n      defaults.fallbackValue = 0;\n    }\n    setLocalFactor(defaults);\n  };\n\n  const updateField = (field, value) => {\n    setLocalFactor((prev) => ({ ...prev, [field]: value }));\n  };\n\n  const handleSave = () => {\n    onChange(localFactor);\n    onClose();\n  };\n\n  const mouseDownOnOverlay = useRef(false);\n\n  const handleOverlayMouseDown = (e) => {\n    mouseDownOnOverlay.current = e.target === e.currentTarget;\n  };\n\n  const handleOverlayClick = (e) => {\n    if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n      onClose();\n    }\n  };\n\n  if (!isOpen) return null;\n\n  const typeConfig = FACTOR_TYPES[selectedType];\n\n  // Render numerator/denominator editor for ratio type\n  const renderCountEditor = (countObj, onCountChange, label) => {\n    const countType = countObj?.type || \"entity_count\";\n    return (\n      <div className=\"nested-section\">\n        <div className=\"nested-title\">{label}</div>\n        <div className=\"input-grid\">\n          <ReferenceDropdown\n            label=\"Count Type\"\n            value={countType}\n            onChange={(v) => onCountChange({ ...countObj, type: v })}\n            options={[\n              { value: \"entity_count\", label: \"Entity Count\" },\n              { value: \"relationship_count\", label: \"Relationship Count\" },\n              { value: \"total_entities\", label: \"Total Entities\" },\n            ]}\n          />\n          {countType === \"entity_count\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Entity Kind\"\n                value={countObj?.kind || \"\"}\n                onChange={(v) => onCountChange({ ...countObj, kind: v, subtype: undefined })}\n                options={entityKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              {countObj?.kind && (\n                <ReferenceDropdown\n                  label=\"Subtype (optional)\"\n                  value={countObj?.subtype || \"\"}\n                  onChange={(v) => onCountChange({ ...countObj, subtype: v || undefined })}\n                  options={getSubtypeOptions(countObj.kind)}\n                  placeholder=\"Any subtype\"\n                />\n              )}\n            </>\n          )}\n          {countType === \"relationship_count\" && (\n            <ChipSelect\n              label=\"Relationship Kinds\"\n              value={countObj?.relationshipKinds || []}\n              onChange={(v) => onCountChange({ ...countObj, relationshipKinds: v })}\n              options={relationshipKindOptions}\n              placeholder=\"Select relationships...\"\n            />\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div\n      className=\"modal-overlay\"\n      onMouseDown={handleOverlayMouseDown}\n      onClick={handleOverlayClick}\n      role=\"button\"\n      tabIndex={0}\n      onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n    >\n      <div className=\"modal\">\n        <div className=\"modal-header\">\n          <div className=\"modal-title\">\n            <span>{typeConfig?.icon}</span>\n            {factor ? \"Edit Factor\" : \"Add Factor\"}\n            <span\n              className={feedbackType === \"positive\" ? \"fem-feedback-badge-positive\" : \"fem-feedback-badge-negative\"}\n            >\n              {feedbackType === \"positive\" ? \"+ Positive\" : \"- Negative\"}\n            </span>\n          </div>\n          <button className=\"btn-close\" onClick={onClose}>\n            \u00d7\n          </button>\n        </div>\n\n        <div className=\"modal-content\">\n          {/* Type selector - compact pills */}\n          <div className=\"mb-2xl\">\n            <span className=\"label\">Factor Type</span>\n            <div className=\"type-selector\">\n              {Object.entries(FACTOR_TYPES).map(([type, config]) => (\n                <div\n                  key={type}\n                  onClick={() => handleTypeChange(type)}\n                  className={`type-pill ${selectedType === type ? \"type-pill-selected\" : \"\"}`}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <span className=\"type-pill-icon\">{config.icon}</span>\n                  <span>{config.label}</span>\n                </div>\n              ))}\n            </div>\n            {typeConfig && <div className=\"type-description\">{typeConfig.description}</div>}\n          </div>\n\n          {/* Type-specific fields */}\n          <div className=\"input-grid\">\n            {/* Entity Count fields */}\n            {selectedType === \"entity_count\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={localFactor.kind || \"\"}\n                  onChange={(v) => updateField(\"kind\", v)}\n                  options={entityKindOptions}\n                  placeholder=\"Select kind...\"\n                />\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Subtype (optional)\"\n                    value={localFactor.subtype || \"\"}\n                    onChange={(v) => updateField(\"subtype\", v || undefined)}\n                    options={getSubtypeOptions(localFactor.kind)}\n                    placeholder=\"Any subtype\"\n                  />\n                )}\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Status (optional)\"\n                    value={localFactor.status || \"\"}\n                    onChange={(v) => updateField(\"status\", v || undefined)}\n                    options={getStatusOptions(localFactor.kind)}\n                    placeholder=\"Any status\"\n                  />\n                )}\n              </>\n            )}\n\n            {/* Relationship Count fields */}\n            {selectedType === \"relationship_count\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Relationship Kinds\"\n                  value={localFactor.relationshipKinds || []}\n                  onChange={(v) => updateField(\"relationshipKinds\", v)}\n                  options={relationshipKindOptions}\n                  placeholder=\"Select relationship types...\"\n                />\n              </div>\n            )}\n\n            {/* Tag Count fields */}\n            {selectedType === \"tag_count\" && (\n              <div className=\"grid-col-full\">\n                <label className=\"label\">Tags\n                <TagSelector\n                  value={localFactor.tags || []}\n                  onChange={(v) => updateField(\"tags\", v)}\n                  tagRegistry={schema?.tagRegistry || []}\n                  placeholder=\"Select tags...\"\n                />\n                </label>\n              </div>\n            )}\n\n            {/* Status Ratio fields */}\n            {selectedType === \"status_ratio\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={localFactor.kind || \"\"}\n                  onChange={(v) => {\n                    updateField(\"kind\", v);\n                    updateField(\"subtype\", undefined);\n                    updateField(\"aliveStatus\", undefined);\n                  }}\n                  options={entityKindOptions}\n                  placeholder=\"Select kind...\"\n                />\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Subtype (optional)\"\n                    value={localFactor.subtype || \"\"}\n                    onChange={(v) => updateField(\"subtype\", v || undefined)}\n                    options={getSubtypeOptions(localFactor.kind)}\n                    placeholder=\"Any subtype\"\n                  />\n                )}\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Alive Status\"\n                    value={localFactor.aliveStatus || \"\"}\n                    onChange={(v) => updateField(\"aliveStatus\", v)}\n                    options={getStatusOptions(localFactor.kind)}\n                    placeholder=\"Select status...\"\n                  />\n                )}\n              </>\n            )}\n\n            {/* Cross-Culture Ratio fields */}\n            {selectedType === \"cross_culture_ratio\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Relationship Kinds\"\n                  value={localFactor.relationshipKinds || []}\n                  onChange={(v) => updateField(\"relationshipKinds\", v)}\n                  options={relationshipKindOptions}\n                  placeholder=\"Select relationship types...\"\n                />\n              </div>\n// ... (truncated)", "parameters": [{"name": "{ isOpen, onClose, factor, onChange, feedbackType, schema }", "type": "{ isOpen: any; onClose: any; factor: any; onChange: any; feedbackType: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": true}, {"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useMemo", "count": 2}, {"name": "useCallback", "count": 2}, {"name": "useEffect", "count": 1}, {"name": "useRef", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useMemo", "useCallback", "useRef", "useEffect"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["FACTOR_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "ChipSelect", "NumberInput"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}, {"source": "./FactorEditorModal.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/pressures/modals/index.js::FactorEditorModal", "name": "FactorEditorModal", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/modals/index.js", "sourceCode": "export function FactorEditorModal({ isOpen, onClose, factor, onChange, feedbackType, schema }) {\n  const [localFactor, setLocalFactor] = useState(factor || { type: \"entity_count\" });\n  const [selectedType, setSelectedType] = useState(factor?.type || \"entity_count\");\n\n  // Build options from schema\n  const entityKindOptions = useMemo(() => {\n    return (schema?.entityKinds || []).map((ek) => ({\n      value: ek.kind,\n      label: ek.description || ek.kind,\n    }));\n  }, [schema]);\n\n  const getSubtypeOptions = useCallback(\n    (kind) => {\n      const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n      if (!ek?.subtypes) return [];\n      return ek.subtypes.map((st) => ({\n        value: st.id,\n        label: st.name || st.id,\n      }));\n    },\n    [schema]\n  );\n\n  const getStatusOptions = useCallback(\n    (kind) => {\n      const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n      if (!ek?.statuses) return [];\n      return ek.statuses.map((st) => ({\n        value: st.id,\n        label: st.name || st.id,\n        meta: st.isTerminal ? \"terminal\" : \"\",\n      }));\n    },\n    [schema]\n  );\n\n  const relationshipKindOptions = useMemo(() => {\n    return (schema?.relationshipKinds || []).map((rk) => ({\n      value: rk.kind,\n      label: rk.description || rk.kind,\n    }));\n  }, [schema]);\n\n  // Sync local state when factor or isOpen changes\n  useEffect(() => {\n    if (factor) {\n      // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n      setLocalFactor(factor);\n      // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n      setSelectedType(factor.type);\n      return;\n    }\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n    setLocalFactor({ type: \"entity_count\", coefficient: 1 });\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n    setSelectedType(\"entity_count\");\n  }, [factor, isOpen]);\n\n  const handleTypeChange = (type) => {\n    setSelectedType(type);\n    // Reset factor to defaults for new type\n    const defaults = { type, coefficient: 1 };\n    if (type === \"ratio\") {\n      defaults.numerator = { type: \"entity_count\" };\n      defaults.denominator = { type: \"entity_count\" };\n      defaults.fallbackValue = 0;\n    }\n    setLocalFactor(defaults);\n  };\n\n  const updateField = (field, value) => {\n    setLocalFactor((prev) => ({ ...prev, [field]: value }));\n  };\n\n  const handleSave = () => {\n    onChange(localFactor);\n    onClose();\n  };\n\n  const mouseDownOnOverlay = useRef(false);\n\n  const handleOverlayMouseDown = (e) => {\n    mouseDownOnOverlay.current = e.target === e.currentTarget;\n  };\n\n  const handleOverlayClick = (e) => {\n    if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n      onClose();\n    }\n  };\n\n  if (!isOpen) return null;\n\n  const typeConfig = FACTOR_TYPES[selectedType];\n\n  // Render numerator/denominator editor for ratio type\n  const renderCountEditor = (countObj, onCountChange, label) => {\n    const countType = countObj?.type || \"entity_count\";\n    return (\n      <div className=\"nested-section\">\n        <div className=\"nested-title\">{label}</div>\n        <div className=\"input-grid\">\n          <ReferenceDropdown\n            label=\"Count Type\"\n            value={countType}\n            onChange={(v) => onCountChange({ ...countObj, type: v })}\n            options={[\n              { value: \"entity_count\", label: \"Entity Count\" },\n              { value: \"relationship_count\", label: \"Relationship Count\" },\n              { value: \"total_entities\", label: \"Total Entities\" },\n            ]}\n          />\n          {countType === \"entity_count\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Entity Kind\"\n                value={countObj?.kind || \"\"}\n                onChange={(v) => onCountChange({ ...countObj, kind: v, subtype: undefined })}\n                options={entityKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              {countObj?.kind && (\n                <ReferenceDropdown\n                  label=\"Subtype (optional)\"\n                  value={countObj?.subtype || \"\"}\n                  onChange={(v) => onCountChange({ ...countObj, subtype: v || undefined })}\n                  options={getSubtypeOptions(countObj.kind)}\n                  placeholder=\"Any subtype\"\n                />\n              )}\n            </>\n          )}\n          {countType === \"relationship_count\" && (\n            <ChipSelect\n              label=\"Relationship Kinds\"\n              value={countObj?.relationshipKinds || []}\n              onChange={(v) => onCountChange({ ...countObj, relationshipKinds: v })}\n              options={relationshipKindOptions}\n              placeholder=\"Select relationships...\"\n            />\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div\n      className=\"modal-overlay\"\n      onMouseDown={handleOverlayMouseDown}\n      onClick={handleOverlayClick}\n      role=\"button\"\n      tabIndex={0}\n      onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n    >\n      <div className=\"modal\">\n        <div className=\"modal-header\">\n          <div className=\"modal-title\">\n            <span>{typeConfig?.icon}</span>\n            {factor ? \"Edit Factor\" : \"Add Factor\"}\n            <span\n              className={feedbackType === \"positive\" ? \"fem-feedback-badge-positive\" : \"fem-feedback-badge-negative\"}\n            >\n              {feedbackType === \"positive\" ? \"+ Positive\" : \"- Negative\"}\n            </span>\n          </div>\n          <button className=\"btn-close\" onClick={onClose}>\n            \u00d7\n          </button>\n        </div>\n\n        <div className=\"modal-content\">\n          {/* Type selector - compact pills */}\n          <div className=\"mb-2xl\">\n            <span className=\"label\">Factor Type</span>\n            <div className=\"type-selector\">\n              {Object.entries(FACTOR_TYPES).map(([type, config]) => (\n                <div\n                  key={type}\n                  onClick={() => handleTypeChange(type)}\n                  className={`type-pill ${selectedType === type ? \"type-pill-selected\" : \"\"}`}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <span className=\"type-pill-icon\">{config.icon}</span>\n                  <span>{config.label}</span>\n                </div>\n              ))}\n            </div>\n            {typeConfig && <div className=\"type-description\">{typeConfig.description}</div>}\n          </div>\n\n          {/* Type-specific fields */}\n          <div className=\"input-grid\">\n            {/* Entity Count fields */}\n            {selectedType === \"entity_count\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={localFactor.kind || \"\"}\n                  onChange={(v) => updateField(\"kind\", v)}\n                  options={entityKindOptions}\n                  placeholder=\"Select kind...\"\n                />\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Subtype (optional)\"\n                    value={localFactor.subtype || \"\"}\n                    onChange={(v) => updateField(\"subtype\", v || undefined)}\n                    options={getSubtypeOptions(localFactor.kind)}\n                    placeholder=\"Any subtype\"\n                  />\n                )}\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Status (optional)\"\n                    value={localFactor.status || \"\"}\n                    onChange={(v) => updateField(\"status\", v || undefined)}\n                    options={getStatusOptions(localFactor.kind)}\n                    placeholder=\"Any status\"\n                  />\n                )}\n              </>\n            )}\n\n            {/* Relationship Count fields */}\n            {selectedType === \"relationship_count\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Relationship Kinds\"\n                  value={localFactor.relationshipKinds || []}\n                  onChange={(v) => updateField(\"relationshipKinds\", v)}\n                  options={relationshipKindOptions}\n                  placeholder=\"Select relationship types...\"\n                />\n              </div>\n            )}\n\n            {/* Tag Count fields */}\n            {selectedType === \"tag_count\" && (\n              <div className=\"grid-col-full\">\n                <label className=\"label\">Tags\n                <TagSelector\n                  value={localFactor.tags || []}\n                  onChange={(v) => updateField(\"tags\", v)}\n                  tagRegistry={schema?.tagRegistry || []}\n                  placeholder=\"Select tags...\"\n                />\n                </label>\n              </div>\n            )}\n\n            {/* Status Ratio fields */}\n            {selectedType === \"status_ratio\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={localFactor.kind || \"\"}\n                  onChange={(v) => {\n                    updateField(\"kind\", v);\n                    updateField(\"subtype\", undefined);\n                    updateField(\"aliveStatus\", undefined);\n                  }}\n                  options={entityKindOptions}\n                  placeholder=\"Select kind...\"\n                />\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Subtype (optional)\"\n                    value={localFactor.subtype || \"\"}\n                    onChange={(v) => updateField(\"subtype\", v || undefined)}\n                    options={getSubtypeOptions(localFactor.kind)}\n                    placeholder=\"Any subtype\"\n                  />\n                )}\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Alive Status\"\n                    value={localFactor.aliveStatus || \"\"}\n                    onChange={(v) => updateField(\"aliveStatus\", v)}\n                    options={getStatusOptions(localFactor.kind)}\n                    placeholder=\"Select status...\"\n                  />\n                )}\n              </>\n            )}\n\n            {/* Cross-Culture Ratio fields */}\n            {selectedType === \"cross_culture_ratio\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Relationship Kinds\"\n                  value={localFactor.relationshipKinds || []}\n                  onChange={(v) => updateField(\"relationshipKinds\", v)}\n                  options={relationshipKindOptions}\n                  placeholder=\"Select relationship types...\"\n                />\n              </div>\n// ... (truncated)", "parameters": [{"name": "{ isOpen, onClose, factor, onChange, feedbackType, schema }", "type": "{ isOpen: any; onClose: any; factor: any; onChange: any; feedbackType: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": true}, {"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useMemo", "count": 2}, {"name": "useCallback", "count": 2}, {"name": "useEffect", "count": 1}, {"name": "useRef", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/cards/index.js::SystemListCard", "name": "SystemListCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/cards/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system to display\n * @param {Function} props.onClick - Called when card is clicked\n * @param {Function} props.onToggle - Called to toggle enabled state\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport function SystemListCard({ system, onClick, onToggle, usageMap }) {\n  const config = system.config;\n  const sysId = config.id;\n  const isEnabled = system.enabled !== false;\n  const typeConfig = SYSTEM_TYPES[system.systemType] || {};\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"system\", sysId)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, sysId]\n  );\n\n  const eraUsage = useMemo(() => {\n    if (!usageMap?.systems?.[sysId]) return [];\n    return usageMap.systems[sysId].eras || [];\n  }, [usageMap, sysId]);\n\n  const errorCount = validation.invalidRefs.length;\n  const hasErrors = errorCount > 0;\n  const isOrphan = validation.isOrphan;\n\n  const cardClassName = [\n    \"card card-clickable\",\n    !isEnabled && \"card-disabled\",\n    hasErrors && \"card-error\",\n    isOrphan && !hasErrors && \"card-warning\",\n  ]\n    .filter(Boolean)\n    .join(\" \");\n\n  return (\n    <div className={cardClassName} onClick={onClick} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }} >\n      <div className=\"card-header\">\n        <div>\n          <div className=\"flex items-center gap-md\">\n            <span className=\"card-title\">{config.name || config.id}</span>\n            <ErrorBadge count={errorCount} />\n          </div>\n          <div className=\"card-id\">{config.id}</div>\n        </div>\n        <EnableToggle\n          enabled={isEnabled}\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n        />\n      </div>\n\n      <div className=\"card-badges\">\n        {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color from config */}\n        <span\n          className=\"type-badge\"\n          style={{ '--slc-type-bg': `${typeConfig.color}30`, '--slc-type-color': typeConfig.color, backgroundColor: 'var(--slc-type-bg)', color: 'var(--slc-type-color)' }}\n        >\n          {typeConfig.icon} {typeConfig.label}\n        </span>\n      </div>\n\n      {config.description && <div className=\"card-desc\">{config.description}</div>}\n\n      <EraBadges eras={eraUsage} />\n      {isOrphan && (\n        <div className=\"mt-md\">\n          <OrphanBadge isOrphan={isOrphan} />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onClick, onToggle, usageMap }", "type": "{ system: any; onClick: Function; onToggle: Function; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "ErrorBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "EraBadges", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "OrphanBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/cards/SystemListCard.jsx::SystemListCard", "name": "SystemListCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/cards/SystemListCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system to display\n * @param {Function} props.onClick - Called when card is clicked\n * @param {Function} props.onToggle - Called to toggle enabled state\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport function SystemListCard({ system, onClick, onToggle, usageMap }) {\n  const config = system.config;\n  const sysId = config.id;\n  const isEnabled = system.enabled !== false;\n  const typeConfig = SYSTEM_TYPES[system.systemType] || {};\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"system\", sysId)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, sysId]\n  );\n\n  const eraUsage = useMemo(() => {\n    if (!usageMap?.systems?.[sysId]) return [];\n    return usageMap.systems[sysId].eras || [];\n  }, [usageMap, sysId]);\n\n  const errorCount = validation.invalidRefs.length;\n  const hasErrors = errorCount > 0;\n  const isOrphan = validation.isOrphan;\n\n  const cardClassName = [\n    \"card card-clickable\",\n    !isEnabled && \"card-disabled\",\n    hasErrors && \"card-error\",\n    isOrphan && !hasErrors && \"card-warning\",\n  ]\n    .filter(Boolean)\n    .join(\" \");\n\n  return (\n    <div className={cardClassName} onClick={onClick} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }} >\n      <div className=\"card-header\">\n        <div>\n          <div className=\"flex items-center gap-md\">\n            <span className=\"card-title\">{config.name || config.id}</span>\n            <ErrorBadge count={errorCount} />\n          </div>\n          <div className=\"card-id\">{config.id}</div>\n        </div>\n        <EnableToggle\n          enabled={isEnabled}\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n        />\n      </div>\n\n      <div className=\"card-badges\">\n        {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color from config */}\n        <span\n          className=\"type-badge\"\n          style={{ '--slc-type-bg': `${typeConfig.color}30`, '--slc-type-color': typeConfig.color, backgroundColor: 'var(--slc-type-bg)', color: 'var(--slc-type-color)' }}\n        >\n          {typeConfig.icon} {typeConfig.label}\n        </span>\n      </div>\n\n      {config.description && <div className=\"card-desc\">{config.description}</div>}\n\n      <EraBadges eras={eraUsage} />\n      {isOrphan && (\n        <div className=\"mt-md\">\n          <OrphanBadge isOrphan={isOrphan} />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onClick, onToggle, usageMap }", "type": "{ system: any; onClick: Function; onToggle: Function; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "ErrorBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "EraBadges", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "OrphanBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 2}], "imports": [{"source": "react", "specifiers": ["React", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["SYSTEM_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ErrorBadge", "OrphanBadge", "EraBadges", "EnableToggle"], "category": "internal"}, {"source": "../../shared", "specifiers": ["getElementValidation"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/ClusterFormationTab.jsx::ClusterFormationTab", "name": "ClusterFormationTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/ClusterFormationTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function ClusterFormationTab({ system, onChange, schema }) {\n  const config = system.config;\n\n  const entityKindOptions = (schema?.entityKinds || []).map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateClustering = (field, value) => {\n    updateConfig(\"clustering\", { ...config.clustering, [field]: value });\n  };\n\n  const updateMetaEntity = (field, value) => {\n    updateConfig(\"metaEntity\", { ...config.metaEntity, [field]: value });\n  };\n\n  // Criteria\n  const criteria = config.clustering?.criteria || [];\n\n  const addCriterion = () => {\n    updateClustering(\"criteria\", [...criteria, { type: \"same_culture\", weight: 1.0 }]);\n  };\n\n  const updateCriterion = (index, crit) => {\n    const newCriteria = [...criteria];\n    newCriteria[index] = crit;\n    updateClustering(\"criteria\", newCriteria);\n  };\n\n  const removeCriterion = (index) => {\n    updateClustering(\n      \"criteria\",\n      criteria.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Clustering Configuration</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Min Size\n            <NumberInput\n              value={config.clustering?.minSize}\n              onChange={(v) => updateClustering(\"minSize\", v)}\n              min={2}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Max Size\n            <NumberInput\n              value={config.clustering?.maxSize}\n              onChange={(v) => updateClustering(\"maxSize\", v)}\n              min={2}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Minimum Score\n            <NumberInput\n              value={config.clustering?.minimumScore}\n              onChange={(v) => updateClustering(\"minimumScore\", v)}\n              min={0}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Clustering Criteria ({criteria.length})</label>\n        </div>\n\n        {criteria.map((crit, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"py-lg px-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <ReferenceDropdown\n                    label=\"Type\"\n                    value={crit.type}\n                    onChange={(v) => updateCriterion(index, { ...crit, type: v })}\n                    options={CLUSTERING_CRITERIA_TYPES}\n                  />\n                  <div className=\"form-group\">\n                    <label className=\"label\">Weight\n                    <NumberInput\n                      value={crit.weight}\n                      onChange={(v) => updateCriterion(index, { ...crit, weight: v ?? 0 })}\n                      min={0}\n                    />\n                    </label>\n                  </div>\n                  {crit.type === \"shared_relationship\" && (\n                    <ReferenceDropdown\n                      label=\"Relationship Kind\"\n                      value={crit.relationshipKind}\n                      onChange={(v) => updateCriterion(index, { ...crit, relationshipKind: v })}\n                      options={relationshipKindOptions}\n                    />\n                  )}\n                </div>\n                <button className=\"btn-icon btn-icon-danger\" onClick={() => removeCriterion(index)}>\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addCriterion}>\n          + Add Criterion\n        </button>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Meta Entity</div>\n        <div className=\"section-desc\">Configuration for the meta-entity created from clusters.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Kind\"\n            value={config.metaEntity?.kind}\n            onChange={(v) => updateMetaEntity(\"kind\", v)}\n            options={entityKindOptions}\n          />\n          <div className=\"form-group\">\n            <label htmlFor=\"status\" className=\"label\">Status</label>\n            <input id=\"status\"\n              type=\"text\"\n              value={config.metaEntity?.status || \"\"}\n              onChange={(e) => updateMetaEntity(\"status\", e.target.value)}\n              className=\"input\"\n            />\n          </div>\n        </div>\n        <div className=\"mt-xl\">\n          <div className=\"form-group\">\n            <label className=\"label\">Description Template\n            <LocalTextArea\n              value={config.metaEntity?.descriptionTemplate || \"\"}\n              onChange={(value) => updateMetaEntity(\"descriptionTemplate\", value)}\n              placeholder=\"Use {names}, {count} placeholders\"\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Narration Template</div>\n        <div className=\"section-desc mb-md text-xs\">\n          Syntax: {\"{list:members}\"}, {\"{count}\"}, {\"{field|fallback}\"}.\n        </div>\n        <LocalTextArea\n          value={config.narrationTemplate || \"\"}\n          onChange={(value) => updateConfig(\"narrationTemplate\", value || undefined)}\n          placeholder=\"e.g., {list:members} united to form a new alliance.\"\n          rows={2}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["CLUSTERING_CRITERIA_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput", "LocalTextArea"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/CommonSettingsTab.jsx::CommonSettingsTab", "name": "CommonSettingsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/CommonSettingsTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function CommonSettingsTab({ system, onChange, schema, pressures }) {\n  const config = system.config;\n  const selection = config.selection || DEFAULT_SELECTION;\n  const supportsSelection = [\n    \"graphContagion\",\n    \"connectionEvolution\",\n    \"thresholdTrigger\",\n    \"clusterFormation\",\n    \"tagDiffusion\",\n    \"planeDiffusion\",\n  ].includes(system.systemType);\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  return (\n    <div>\n      {supportsSelection && (\n        <div className=\"section\">\n          <div className=\"section-title\">Entity Selection</div>\n          <div className=\"section-desc\">Define which entities this system operates on.</div>\n          <SelectionRuleEditor\n            value={selection}\n            onChange={(next) => updateConfig(\"selection\", next)}\n            schema={schema}\n            availableRefs={[]}\n            showPickStrategy={false}\n            showMaxResults={false}\n            showFilters\n            allowAnyKind\n            showExcludeSubtypes\n          />\n        </div>\n      )}\n\n      <div className=\"section\">\n        <div className=\"section-title\">Throttling</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Throttle Chance (0-1)\n            <NumberInput\n              value={config.throttleChance}\n              onChange={(v) => updateConfig(\"throttleChance\", v)}\n              className=\"input\"\n              min={0}\n              max={1}\n              step={0.1}\n              placeholder=\"0.2\"\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Cooldown (ticks)\n            <NumberInput\n              value={config.cooldown}\n              onChange={(v) => updateConfig(\"cooldown\", v)}\n              className=\"input\"\n              min={0}\n              placeholder=\"0\"\n              allowEmpty\n              integer\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <PressureChangesEditor\n          value={config.pressureChanges || EMPTY_PRESSURE_CHANGES}\n          onChange={(v) =>\n            updateConfig(\"pressureChanges\", Object.keys(v).length > 0 ? v : undefined)\n          }\n          pressures={pressures}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema, pressures }", "type": "{ system: any; onChange: Function; schema: any; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SelectionRuleEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "PressureChangesEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["PressureChangesEditor", "NumberInput"], "category": "internal"}, {"source": "../../shared/SelectionRuleEditor", "specifiers": ["SelectionRuleEditor"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/ConnectionEvolutionTab.jsx::ConnectionEvolutionTab", "name": "ConnectionEvolutionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/ConnectionEvolutionTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function ConnectionEvolutionTab({ system, onChange, schema }) {\n  const config = system.config;\n  const selectionKind =\n    config.selection?.kind && config.selection.kind !== \"any\" ? config.selection.kind : undefined;\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const getSubtypeOptions = (kind) => {\n    if (!kind) return [];\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateMetric = (field, value) => {\n    updateConfig(\"metric\", { ...config.metric, [field]: value });\n  };\n\n  // Rules\n  const rules = config.rules || [];\n\n  const addRule = () => {\n    updateConfig(\"rules\", [\n      ...rules,\n      {\n        condition: { operator: \">=\", threshold: 1 },\n        probability: 0.1,\n        action: { type: \"adjust_prominence\", entity: \"$self\", delta: 0.2 },\n      },\n    ]);\n  };\n\n  const updateRule = (index, rule) => {\n    const newRules = [...rules];\n    newRules[index] = rule;\n    updateConfig(\"rules\", newRules);\n  };\n\n  const removeRule = (index) => {\n    updateConfig(\n      \"rules\",\n      rules.filter((_, i) => i !== index)\n    );\n  };\n\n  // Subtype bonuses\n  const subtypeBonuses = config.subtypeBonuses || [];\n\n  const addSubtypeBonus = () => {\n    updateConfig(\"subtypeBonuses\", [...subtypeBonuses, { subtype: \"\", bonus: 0 }]);\n  };\n\n  const updateSubtypeBonus = (index, bonus) => {\n    const newBonuses = [...subtypeBonuses];\n    newBonuses[index] = bonus;\n    updateConfig(\"subtypeBonuses\", newBonuses);\n  };\n\n  const removeSubtypeBonus = (index) => {\n    updateConfig(\n      \"subtypeBonuses\",\n      subtypeBonuses.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Metric</div>\n        <div className=\"section-desc\">How entities are measured for rule evaluation.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Metric Type\"\n            value={config.metric?.type || \"connection_count\"}\n            onChange={(v) => updateMetric(\"type\", v)}\n            options={METRIC_TYPES}\n          />\n          <ReferenceDropdown\n            label=\"Direction\"\n            value={config.metric?.direction || \"both\"}\n            onChange={(v) => updateMetric(\"direction\", v)}\n            options={DIRECTIONS}\n          />\n          {(config.metric?.type === \"connection_count\" ||\n            config.metric?.type === \"relationship_count\") && (\n            <div className=\"form-group\">\n              <label htmlFor=\"filter-by-relationship-kinds-optional\" className=\"label\">Filter by Relationship Kinds (optional)</label>\n              <input id=\"filter-by-relationship-kinds-optional\"\n                type=\"text\"\n                value={(config.metric?.relationshipKinds || []).join(\", \")}\n                onChange={(e) => {\n                  const kinds = e.target.value\n                    .split(\",\")\n                    .map((s) => s.trim())\n                    .filter(Boolean);\n                  updateMetric(\"relationshipKinds\", kinds.length > 0 ? kinds : undefined);\n                }}\n                className=\"input\"\n                placeholder=\"Leave empty for all kinds\"\n              />\n            </div>\n          )}\n          {config.metric?.type === \"shared_relationship\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Shared Relationship Kind\"\n                value={config.metric?.sharedRelationshipKind}\n                onChange={(v) => updateMetric(\"sharedRelationshipKind\", v)}\n                options={relationshipKindOptions}\n              />\n              <ReferenceDropdown\n                label=\"Shared Direction\"\n                value={config.metric?.sharedDirection || \"src\"}\n                onChange={(v) => updateMetric(\"sharedDirection\", v)}\n                options={[\n                  { value: \"src\", label: \"Source (outgoing)\" },\n                  { value: \"dst\", label: \"Destination (incoming)\" },\n                ]}\n              />\n            </>\n          )}\n          <div className=\"form-group\">\n            <label className=\"label\">Min Strength\n            <NumberInput\n              value={config.metric?.minStrength}\n              onChange={(v) => updateMetric(\"minStrength\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n              placeholder=\"0\"\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Rules ({rules.length})</div>\n        <div className=\"section-desc\">Conditions and actions based on the metric.</div>\n\n        {rules.map((rule, index) => (\n          <RuleCard\n            key={index}\n            rule={rule}\n            onChange={(r) => updateRule(index, r)}\n            onRemove={() => removeRule(index)}\n            schema={schema}\n          />\n        ))}\n\n        <button className=\"btn-add\" onClick={addRule}>\n          + Add Rule\n        </button>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Subtype Bonuses ({subtypeBonuses.length})</div>\n        <div className=\"section-desc\">Bonuses added to metric value based on entity subtype.</div>\n\n        {subtypeBonuses.map((bonus, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"py-lg px-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <ReferenceDropdown\n                    label=\"Subtype\"\n                    value={bonus.subtype}\n                    onChange={(v) => updateSubtypeBonus(index, { ...bonus, subtype: v })}\n                    options={getSubtypeOptions(selectionKind)}\n                  />\n                  <div className=\"form-group\">\n                    <label className=\"label\">Bonus\n                    <NumberInput\n                      value={bonus.bonus}\n                      onChange={(v) => updateSubtypeBonus(index, { ...bonus, bonus: v ?? 0 })}\n                    />\n                    </label>\n                  </div>\n                </div>\n                <button\n                  className=\"btn-icon btn-icon-danger\"\n                  onClick={() => removeSubtypeBonus(index)}\n                >\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addSubtypeBonus}>\n          + Add Subtype Bonus\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "RuleCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["METRIC_TYPES", "DIRECTIONS"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput", "LocalTextArea"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}, {"source": "./ConnectionEvolutionTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/FrameworkSystemTab.jsx::FrameworkSystemTab", "name": "FrameworkSystemTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/FrameworkSystemTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n */\nexport function FrameworkSystemTab({ system, onChange }) {\n  const config = system.config;\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Framework System</div>\n        <div className=\"info-box-text\">\n          This is a framework-level system with specific configuration options.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Configuration</div>\n\n        {system.systemType === \"eraTransition\" && (\n          <div className=\"form-grid\">\n            <p className=\"label grid-col-full text-dim\">\n              Era transition timing is controlled by per-era exitConditions in eras.json. Add a time\n              condition (e.g., {`{ type: 'time_elapsed', minTicks: 25 }`}) to control minimum era\n              length.\n            </p>\n          </div>\n        )}\n\n        {system.systemType === \"universalCatalyst\" && (\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label\">Action Attempt Rate\n              <NumberInput\n                value={config.actionAttemptRate}\n                onChange={(v) => updateConfig(\"actionAttemptRate\", v)}\n                className=\"input\"\n                step={0.1}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Pressure Multiplier\n              <NumberInput\n                value={config.pressureMultiplier}\n                onChange={(v) => updateConfig(\"pressureMultiplier\", v)}\n                className=\"input\"\n                step={0.1}\n                min={0}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Prominence Up % on Success\n              <NumberInput\n                value={config.prominenceUpChanceOnSuccess}\n                onChange={(v) => updateConfig(\"prominenceUpChanceOnSuccess\", v)}\n                className=\"input\"\n                step={0.05}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Prominence Down % on Failure\n              <NumberInput\n                value={config.prominenceDownChanceOnFailure}\n                onChange={(v) => updateConfig(\"prominenceDownChanceOnFailure\", v)}\n                className=\"input\"\n                step={0.05}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        )}\n\n        {system.systemType === \"relationshipMaintenance\" && (\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label\">Maintenance Frequency\n              <NumberInput\n                value={config.maintenanceFrequency}\n                onChange={(v) => updateConfig(\"maintenanceFrequency\", v)}\n                className=\"input\"\n                min={1}\n                allowEmpty\n                integer\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Cull Threshold\n              <NumberInput\n                value={config.cullThreshold}\n                onChange={(v) => updateConfig(\"cullThreshold\", v)}\n                className=\"input\"\n                step={0.05}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Grace Period\n              <NumberInput\n                value={config.gracePeriod}\n                onChange={(v) => updateConfig(\"gracePeriod\", v)}\n                className=\"input\"\n                min={0}\n                allowEmpty\n                integer\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Reinforcement Bonus\n              <NumberInput\n                value={config.reinforcementBonus}\n                onChange={(v) => updateConfig(\"reinforcementBonus\", v)}\n                className=\"input\"\n                step={0.01}\n                min={0}\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange }", "type": "{ system: any; onChange: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "p", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["NumberInput"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/GraphContagionTab.jsx::GraphContagionTab", "name": "GraphContagionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/GraphContagionTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function GraphContagionTab({ system, onChange, schema }) {\n  const config = system.config;\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateContagion = (field, value) => {\n    updateConfig(\"contagion\", { ...config.contagion, [field]: value });\n  };\n\n  const updateTransmission = (field, value) => {\n    updateConfig(\"transmission\", { ...config.transmission, [field]: value });\n  };\n\n  const updateInfectionAction = (field, value) => {\n    updateConfig(\"infectionAction\", { ...config.infectionAction, [field]: value });\n  };\n\n  // Vectors\n  const vectors = config.vectors || [];\n\n  const addVector = () => {\n    updateConfig(\"vectors\", [\n      ...vectors,\n      { relationshipKind: \"\", direction: \"both\", minStrength: 0.5 },\n    ]);\n  };\n\n  const updateVector = (index, field, value) => {\n    const newVectors = [...vectors];\n    newVectors[index] = { ...newVectors[index], [field]: value };\n    updateConfig(\"vectors\", newVectors);\n  };\n\n  const removeVector = (index) => {\n    updateConfig(\n      \"vectors\",\n      vectors.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Contagion Source</div>\n        <div className=\"section-desc\">What is being spread through the network.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Type\"\n            value={config.contagion?.type || \"relationship\"}\n            onChange={(v) => updateContagion(\"type\", v)}\n            options={[\n              { value: \"relationship\", label: \"Relationship\" },\n              { value: \"tag\", label: \"Tag\" },\n            ]}\n          />\n          {config.contagion?.type === \"relationship\" && (\n            <ReferenceDropdown\n              label=\"Relationship Kind\"\n              value={config.contagion?.relationshipKind}\n              onChange={(v) => updateContagion(\"relationshipKind\", v)}\n              options={relationshipKindOptions}\n            />\n          )}\n          {config.contagion?.type === \"tag\" && (\n            <div className=\"form-group\">\n              <label htmlFor=\"tag\" className=\"label\">Tag</label>\n              <input id=\"tag\"\n                type=\"text\"\n                value={config.contagion?.tagPattern || \"\"}\n                onChange={(e) => updateContagion(\"tagPattern\", e.target.value)}\n                className=\"input\"\n              />\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Transmission Vectors ({vectors.length})</div>\n        <div className=\"section-desc\">Relationships through which the contagion spreads.</div>\n\n        {vectors.map((vector, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"p-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <ReferenceDropdown\n                    label=\"Relationship Kind\"\n                    value={vector.relationshipKind}\n                    onChange={(v) => updateVector(index, \"relationshipKind\", v)}\n                    options={relationshipKindOptions}\n                  />\n                  <ReferenceDropdown\n                    label=\"Direction\"\n                    value={vector.direction || \"both\"}\n                    onChange={(v) => updateVector(index, \"direction\", v)}\n                    options={DIRECTIONS}\n                  />\n                  <div className=\"form-group\">\n                    <label className=\"label\">Min Strength\n                    <NumberInput\n                      value={vector.minStrength}\n                      onChange={(v) => updateVector(index, \"minStrength\", v)}\n                      className=\"input\"\n                      step={0.1}\n                      min={0}\n                      max={1}\n                      allowEmpty\n                    />\n                    </label>\n                  </div>\n                </div>\n                <button className=\"btn-icon btn-icon-danger\" onClick={() => removeVector(index)}>\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addVector}>\n          + Add Vector\n        </button>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Transmission Rates</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Base Rate\n            <NumberInput\n              value={config.transmission?.baseRate}\n              onChange={(v) => updateTransmission(\"baseRate\", v)}\n              className=\"input\"\n              step={0.05}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Contact Multiplier\n            <NumberInput\n              value={config.transmission?.contactMultiplier}\n              onChange={(v) => updateTransmission(\"contactMultiplier\", v)}\n              className=\"input\"\n              step={0.05}\n              min={0}\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Max Probability\n            <NumberInput\n              value={config.transmission?.maxProbability}\n              onChange={(v) => updateTransmission(\"maxProbability\", v)}\n              className=\"input\"\n              step={0.05}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Infection Action</div>\n        <div className=\"section-desc\">What happens when an entity gets infected.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Action Type\"\n            value={config.infectionAction?.type || \"create_relationship\"}\n            onChange={(v) => updateInfectionAction(\"type\", v)}\n            options={[\n              { value: \"create_relationship\", label: \"Create Relationship\" },\n              { value: \"set_tag\", label: \"Set Tag\" },\n            ]}\n          />\n          {config.infectionAction?.type === \"create_relationship\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Relationship Kind\"\n                value={config.infectionAction?.kind}\n                onChange={(v) => updateInfectionAction(\"kind\", v)}\n                options={relationshipKindOptions}\n              />\n              <ReferenceDropdown\n                label=\"Source\"\n                value={config.infectionAction?.src || \"$self\"}\n                onChange={(v) => updateInfectionAction(\"src\", v)}\n                options={[\n                  { value: \"$self\", label: \"$self\" },\n                  { value: \"$source\", label: \"$source\" },\n                  { value: \"$contagion_source\", label: \"$contagion_source\" },\n                ]}\n              />\n              <ReferenceDropdown\n                label=\"Destination\"\n                value={config.infectionAction?.dst || \"$source\"}\n                onChange={(v) => updateInfectionAction(\"dst\", v)}\n                options={[\n                  { value: \"$self\", label: \"$self\" },\n                  { value: \"$source\", label: \"$source\" },\n                  { value: \"$contagion_source\", label: \"$contagion_source\" },\n                ]}\n              />\n              <div className=\"form-group\">\n                <label className=\"label\">Strength\n                <NumberInput\n                  value={config.infectionAction?.strength}\n                  onChange={(v) => updateInfectionAction(\"strength\", v)}\n                  className=\"input\"\n                  step={0.1}\n                  min={0}\n                  max={1}\n                  allowEmpty\n                />\n                </label>\n              </div>\n              <div className=\"form-group\">\n                <label className=\"checkbox-label\">\n                  <input\n                    type=\"checkbox\"\n                    checked={config.infectionAction?.bidirectional || false}\n                    onChange={(e) =>\n                      updateInfectionAction(\"bidirectional\", e.target.checked || undefined)\n                    }\n                    className=\"checkbox\"\n                  />\n                  Bidirectional\n                </label>\n              </div>\n            </>\n          )}\n          {config.infectionAction?.type === \"set_tag\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Entity\"\n                value={config.infectionAction?.entity || \"$self\"}\n                onChange={(v) => updateInfectionAction(\"entity\", v)}\n                options={[\n                  { value: \"$self\", label: \"$self\" },\n                  { value: \"$source\", label: \"$source\" },\n                  { value: \"$contagion_source\", label: \"$contagion_source\" },\n                ]}\n              />\n              <div className=\"form-group\">\n                <label className=\"label\">Tag\n                <TagSelector\n                  value={config.infectionAction?.tag ? [config.infectionAction.tag] : []}\n                  onChange={(tags) => updateInfectionAction(\"tag\", tags[0] || \"\")}\n                  tagRegistry={schema?.tagRegistry || []}\n                  placeholder=\"Select tag...\"\n                  singleSelect\n                />\n                </label>\n              </div>\n              <div className=\"form-group\">\n                <label htmlFor=\"value-optional\" className=\"label\">Value (optional)</label>\n                <input id=\"value-optional\"\n                  type=\"text\"\n                  value={\n                    config.infectionAction?.value !== undefined\n                      ? String(config.infectionAction.value)\n                      : \"\"\n                  }\n                  onChange={(e) => updateInfectionAction(\"value\", e.target.value || undefined)}\n                  className=\"input\"\n                  placeholder=\"true\"\n                />\n              </div>\n            </>\n          )}\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">Narration Template</span>\n          <div className=\"section-desc mb-xs text-xs\">\n            Syntax: {\"{$self.field}\"}, {\"{$source.field}\"}, {\"{$contagion_source.field}\"},{\" \"}\n            {\"{field|fallback}\"}.\n          </div>\n          <LocalTextArea\n            value={config.narrationTemplate || \"\"}\n// ... (truncated)", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["DIRECTIONS"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput", "LocalTextArea"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Function} props.onDelete - Called to delete the system\n */\nexport function OverviewTab({ system, onChange, onDelete }) {\n  const config = system.config;\n  const typeConfig = SYSTEM_TYPES[system.systemType] || {};\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(config.id, (value) =>\n    updateConfig(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(config.name, (value) =>\n    updateConfig(\"name\", value)\n  );\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"system-id\" className=\"label\">System ID</label>\n            <input id=\"system-id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"display-name\" className=\"label\">Display Name</label>\n            <input id=\"display-name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <div className=\"form-group\">\n            <label className=\"label\">Description\n            <LocalTextArea\n              value={config.description || \"\"}\n              onChange={(value) => updateConfig(\"description\", value)}\n              className=\"ot-description-textarea\"\n              placeholder=\"Describe what this system does...\"\n            />\n            </label>\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">System Type</span>\n          <div className=\"flex items-center gap-lg\">\n            {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color from config */}\n            <span\n              className=\"type-badge\"\n              style={{ '--ot-type-bg': `${typeConfig.color}30`, '--ot-type-color': typeConfig.color, backgroundColor: 'var(--ot-type-bg)', color: 'var(--ot-type-color)' }}\n            >\n              {typeConfig.icon} {typeConfig.label}\n            </span>\n            <span className=\"text-muted ot-type-desc\">\n              {typeConfig.desc}\n            </span>\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Enabled\n          <EnableToggle\n            enabled={system.enabled !== false}\n            onChange={(enabled) => onChange({ ...system, enabled })}\n            label={system.enabled !== false ? \"System is active\" : \"System is disabled\"}\n          />\n          </label>\n        </div>\n      </div>\n\n      <div className=\"danger-zone\">\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete System\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, onDelete }", "type": "{ system: any; onChange: Function; onDelete: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useLocalInputState", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::CommonSettingsTab", "name": "CommonSettingsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function CommonSettingsTab({ system, onChange, schema, pressures }) {\n  const config = system.config;\n  const selection = config.selection || DEFAULT_SELECTION;\n  const supportsSelection = [\n    \"graphContagion\",\n    \"connectionEvolution\",\n    \"thresholdTrigger\",\n    \"clusterFormation\",\n    \"tagDiffusion\",\n    \"planeDiffusion\",\n  ].includes(system.systemType);\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  return (\n    <div>\n      {supportsSelection && (\n        <div className=\"section\">\n          <div className=\"section-title\">Entity Selection</div>\n          <div className=\"section-desc\">Define which entities this system operates on.</div>\n          <SelectionRuleEditor\n            value={selection}\n            onChange={(next) => updateConfig(\"selection\", next)}\n            schema={schema}\n            availableRefs={[]}\n            showPickStrategy={false}\n            showMaxResults={false}\n            showFilters\n            allowAnyKind\n            showExcludeSubtypes\n          />\n        </div>\n      )}\n\n      <div className=\"section\">\n        <div className=\"section-title\">Throttling</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Throttle Chance (0-1)\n            <NumberInput\n              value={config.throttleChance}\n              onChange={(v) => updateConfig(\"throttleChance\", v)}\n              className=\"input\"\n              min={0}\n              max={1}\n              step={0.1}\n              placeholder=\"0.2\"\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Cooldown (ticks)\n            <NumberInput\n              value={config.cooldown}\n              onChange={(v) => updateConfig(\"cooldown\", v)}\n              className=\"input\"\n              min={0}\n              placeholder=\"0\"\n              allowEmpty\n              integer\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <PressureChangesEditor\n          value={config.pressureChanges || EMPTY_PRESSURE_CHANGES}\n          onChange={(v) =>\n            updateConfig(\"pressureChanges\", Object.keys(v).length > 0 ? v : undefined)\n          }\n          pressures={pressures}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema, pressures }", "type": "{ system: any; onChange: Function; schema: any; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SelectionRuleEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "PressureChangesEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::GraphContagionTab", "name": "GraphContagionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function GraphContagionTab({ system, onChange, schema }) {\n  const config = system.config;\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateContagion = (field, value) => {\n    updateConfig(\"contagion\", { ...config.contagion, [field]: value });\n  };\n\n  const updateTransmission = (field, value) => {\n    updateConfig(\"transmission\", { ...config.transmission, [field]: value });\n  };\n\n  const updateInfectionAction = (field, value) => {\n    updateConfig(\"infectionAction\", { ...config.infectionAction, [field]: value });\n  };\n\n  // Vectors\n  const vectors = config.vectors || [];\n\n  const addVector = () => {\n    updateConfig(\"vectors\", [\n      ...vectors,\n      { relationshipKind: \"\", direction: \"both\", minStrength: 0.5 },\n    ]);\n  };\n\n  const updateVector = (index, field, value) => {\n    const newVectors = [...vectors];\n    newVectors[index] = { ...newVectors[index], [field]: value };\n    updateConfig(\"vectors\", newVectors);\n  };\n\n  const removeVector = (index) => {\n    updateConfig(\n      \"vectors\",\n      vectors.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Contagion Source</div>\n        <div className=\"section-desc\">What is being spread through the network.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Type\"\n            value={config.contagion?.type || \"relationship\"}\n            onChange={(v) => updateContagion(\"type\", v)}\n            options={[\n              { value: \"relationship\", label: \"Relationship\" },\n              { value: \"tag\", label: \"Tag\" },\n            ]}\n          />\n          {config.contagion?.type === \"relationship\" && (\n            <ReferenceDropdown\n              label=\"Relationship Kind\"\n              value={config.contagion?.relationshipKind}\n              onChange={(v) => updateContagion(\"relationshipKind\", v)}\n              options={relationshipKindOptions}\n            />\n          )}\n          {config.contagion?.type === \"tag\" && (\n            <div className=\"form-group\">\n              <label htmlFor=\"tag\" className=\"label\">Tag</label>\n              <input id=\"tag\"\n                type=\"text\"\n                value={config.contagion?.tagPattern || \"\"}\n                onChange={(e) => updateContagion(\"tagPattern\", e.target.value)}\n                className=\"input\"\n              />\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Transmission Vectors ({vectors.length})</div>\n        <div className=\"section-desc\">Relationships through which the contagion spreads.</div>\n\n        {vectors.map((vector, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"p-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <ReferenceDropdown\n                    label=\"Relationship Kind\"\n                    value={vector.relationshipKind}\n                    onChange={(v) => updateVector(index, \"relationshipKind\", v)}\n                    options={relationshipKindOptions}\n                  />\n                  <ReferenceDropdown\n                    label=\"Direction\"\n                    value={vector.direction || \"both\"}\n                    onChange={(v) => updateVector(index, \"direction\", v)}\n                    options={DIRECTIONS}\n                  />\n                  <div className=\"form-group\">\n                    <label className=\"label\">Min Strength\n                    <NumberInput\n                      value={vector.minStrength}\n                      onChange={(v) => updateVector(index, \"minStrength\", v)}\n                      className=\"input\"\n                      step={0.1}\n                      min={0}\n                      max={1}\n                      allowEmpty\n                    />\n                    </label>\n                  </div>\n                </div>\n                <button className=\"btn-icon btn-icon-danger\" onClick={() => removeVector(index)}>\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addVector}>\n          + Add Vector\n        </button>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Transmission Rates</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Base Rate\n            <NumberInput\n              value={config.transmission?.baseRate}\n              onChange={(v) => updateTransmission(\"baseRate\", v)}\n              className=\"input\"\n              step={0.05}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Contact Multiplier\n            <NumberInput\n              value={config.transmission?.contactMultiplier}\n              onChange={(v) => updateTransmission(\"contactMultiplier\", v)}\n              className=\"input\"\n              step={0.05}\n              min={0}\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Max Probability\n            <NumberInput\n              value={config.transmission?.maxProbability}\n              onChange={(v) => updateTransmission(\"maxProbability\", v)}\n              className=\"input\"\n              step={0.05}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Infection Action</div>\n        <div className=\"section-desc\">What happens when an entity gets infected.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Action Type\"\n            value={config.infectionAction?.type || \"create_relationship\"}\n            onChange={(v) => updateInfectionAction(\"type\", v)}\n            options={[\n              { value: \"create_relationship\", label: \"Create Relationship\" },\n              { value: \"set_tag\", label: \"Set Tag\" },\n            ]}\n          />\n          {config.infectionAction?.type === \"create_relationship\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Relationship Kind\"\n                value={config.infectionAction?.kind}\n                onChange={(v) => updateInfectionAction(\"kind\", v)}\n                options={relationshipKindOptions}\n              />\n              <ReferenceDropdown\n                label=\"Source\"\n                value={config.infectionAction?.src || \"$self\"}\n                onChange={(v) => updateInfectionAction(\"src\", v)}\n                options={[\n                  { value: \"$self\", label: \"$self\" },\n                  { value: \"$source\", label: \"$source\" },\n                  { value: \"$contagion_source\", label: \"$contagion_source\" },\n                ]}\n              />\n              <ReferenceDropdown\n                label=\"Destination\"\n                value={config.infectionAction?.dst || \"$source\"}\n                onChange={(v) => updateInfectionAction(\"dst\", v)}\n                options={[\n                  { value: \"$self\", label: \"$self\" },\n                  { value: \"$source\", label: \"$source\" },\n                  { value: \"$contagion_source\", label: \"$contagion_source\" },\n                ]}\n              />\n              <div className=\"form-group\">\n                <label className=\"label\">Strength\n                <NumberInput\n                  value={config.infectionAction?.strength}\n                  onChange={(v) => updateInfectionAction(\"strength\", v)}\n                  className=\"input\"\n                  step={0.1}\n                  min={0}\n                  max={1}\n                  allowEmpty\n                />\n                </label>\n              </div>\n              <div className=\"form-group\">\n                <label className=\"checkbox-label\">\n                  <input\n                    type=\"checkbox\"\n                    checked={config.infectionAction?.bidirectional || false}\n                    onChange={(e) =>\n                      updateInfectionAction(\"bidirectional\", e.target.checked || undefined)\n                    }\n                    className=\"checkbox\"\n                  />\n                  Bidirectional\n                </label>\n              </div>\n            </>\n          )}\n          {config.infectionAction?.type === \"set_tag\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Entity\"\n                value={config.infectionAction?.entity || \"$self\"}\n                onChange={(v) => updateInfectionAction(\"entity\", v)}\n                options={[\n                  { value: \"$self\", label: \"$self\" },\n                  { value: \"$source\", label: \"$source\" },\n                  { value: \"$contagion_source\", label: \"$contagion_source\" },\n                ]}\n              />\n              <div className=\"form-group\">\n                <label className=\"label\">Tag\n                <TagSelector\n                  value={config.infectionAction?.tag ? [config.infectionAction.tag] : []}\n                  onChange={(tags) => updateInfectionAction(\"tag\", tags[0] || \"\")}\n                  tagRegistry={schema?.tagRegistry || []}\n                  placeholder=\"Select tag...\"\n                  singleSelect\n                />\n                </label>\n              </div>\n              <div className=\"form-group\">\n                <label htmlFor=\"value-optional\" className=\"label\">Value (optional)</label>\n                <input id=\"value-optional\"\n                  type=\"text\"\n                  value={\n                    config.infectionAction?.value !== undefined\n                      ? String(config.infectionAction.value)\n                      : \"\"\n                  }\n                  onChange={(e) => updateInfectionAction(\"value\", e.target.value || undefined)}\n                  className=\"input\"\n                  placeholder=\"true\"\n                />\n              </div>\n            </>\n          )}\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">Narration Template</span>\n          <div className=\"section-desc mb-xs text-xs\">\n            Syntax: {\"{$self.field}\"}, {\"{$source.field}\"}, {\"{$contagion_source.field}\"},{\" \"}\n            {\"{field|fallback}\"}.\n          </div>\n          <LocalTextArea\n            value={config.narrationTemplate || \"\"}\n// ... (truncated)", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::ConnectionEvolutionTab", "name": "ConnectionEvolutionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function ConnectionEvolutionTab({ system, onChange, schema }) {\n  const config = system.config;\n  const selectionKind =\n    config.selection?.kind && config.selection.kind !== \"any\" ? config.selection.kind : undefined;\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const getSubtypeOptions = (kind) => {\n    if (!kind) return [];\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateMetric = (field, value) => {\n    updateConfig(\"metric\", { ...config.metric, [field]: value });\n  };\n\n  // Rules\n  const rules = config.rules || [];\n\n  const addRule = () => {\n    updateConfig(\"rules\", [\n      ...rules,\n      {\n        condition: { operator: \">=\", threshold: 1 },\n        probability: 0.1,\n        action: { type: \"adjust_prominence\", entity: \"$self\", delta: 0.2 },\n      },\n    ]);\n  };\n\n  const updateRule = (index, rule) => {\n    const newRules = [...rules];\n    newRules[index] = rule;\n    updateConfig(\"rules\", newRules);\n  };\n\n  const removeRule = (index) => {\n    updateConfig(\n      \"rules\",\n      rules.filter((_, i) => i !== index)\n    );\n  };\n\n  // Subtype bonuses\n  const subtypeBonuses = config.subtypeBonuses || [];\n\n  const addSubtypeBonus = () => {\n    updateConfig(\"subtypeBonuses\", [...subtypeBonuses, { subtype: \"\", bonus: 0 }]);\n  };\n\n  const updateSubtypeBonus = (index, bonus) => {\n    const newBonuses = [...subtypeBonuses];\n    newBonuses[index] = bonus;\n    updateConfig(\"subtypeBonuses\", newBonuses);\n  };\n\n  const removeSubtypeBonus = (index) => {\n    updateConfig(\n      \"subtypeBonuses\",\n      subtypeBonuses.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Metric</div>\n        <div className=\"section-desc\">How entities are measured for rule evaluation.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Metric Type\"\n            value={config.metric?.type || \"connection_count\"}\n            onChange={(v) => updateMetric(\"type\", v)}\n            options={METRIC_TYPES}\n          />\n          <ReferenceDropdown\n            label=\"Direction\"\n            value={config.metric?.direction || \"both\"}\n            onChange={(v) => updateMetric(\"direction\", v)}\n            options={DIRECTIONS}\n          />\n          {(config.metric?.type === \"connection_count\" ||\n            config.metric?.type === \"relationship_count\") && (\n            <div className=\"form-group\">\n              <label htmlFor=\"filter-by-relationship-kinds-optional\" className=\"label\">Filter by Relationship Kinds (optional)</label>\n              <input id=\"filter-by-relationship-kinds-optional\"\n                type=\"text\"\n                value={(config.metric?.relationshipKinds || []).join(\", \")}\n                onChange={(e) => {\n                  const kinds = e.target.value\n                    .split(\",\")\n                    .map((s) => s.trim())\n                    .filter(Boolean);\n                  updateMetric(\"relationshipKinds\", kinds.length > 0 ? kinds : undefined);\n                }}\n                className=\"input\"\n                placeholder=\"Leave empty for all kinds\"\n              />\n            </div>\n          )}\n          {config.metric?.type === \"shared_relationship\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Shared Relationship Kind\"\n                value={config.metric?.sharedRelationshipKind}\n                onChange={(v) => updateMetric(\"sharedRelationshipKind\", v)}\n                options={relationshipKindOptions}\n              />\n              <ReferenceDropdown\n                label=\"Shared Direction\"\n                value={config.metric?.sharedDirection || \"src\"}\n                onChange={(v) => updateMetric(\"sharedDirection\", v)}\n                options={[\n                  { value: \"src\", label: \"Source (outgoing)\" },\n                  { value: \"dst\", label: \"Destination (incoming)\" },\n                ]}\n              />\n            </>\n          )}\n          <div className=\"form-group\">\n            <label className=\"label\">Min Strength\n            <NumberInput\n              value={config.metric?.minStrength}\n              onChange={(v) => updateMetric(\"minStrength\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n              placeholder=\"0\"\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Rules ({rules.length})</div>\n        <div className=\"section-desc\">Conditions and actions based on the metric.</div>\n\n        {rules.map((rule, index) => (\n          <RuleCard\n            key={index}\n            rule={rule}\n            onChange={(r) => updateRule(index, r)}\n            onRemove={() => removeRule(index)}\n            schema={schema}\n          />\n        ))}\n\n        <button className=\"btn-add\" onClick={addRule}>\n          + Add Rule\n        </button>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Subtype Bonuses ({subtypeBonuses.length})</div>\n        <div className=\"section-desc\">Bonuses added to metric value based on entity subtype.</div>\n\n        {subtypeBonuses.map((bonus, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"py-lg px-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <ReferenceDropdown\n                    label=\"Subtype\"\n                    value={bonus.subtype}\n                    onChange={(v) => updateSubtypeBonus(index, { ...bonus, subtype: v })}\n                    options={getSubtypeOptions(selectionKind)}\n                  />\n                  <div className=\"form-group\">\n                    <label className=\"label\">Bonus\n                    <NumberInput\n                      value={bonus.bonus}\n                      onChange={(v) => updateSubtypeBonus(index, { ...bonus, bonus: v ?? 0 })}\n                    />\n                    </label>\n                  </div>\n                </div>\n                <button\n                  className=\"btn-icon btn-icon-danger\"\n                  onClick={() => removeSubtypeBonus(index)}\n                >\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addSubtypeBonus}>\n          + Add Subtype Bonus\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "RuleCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::ThresholdTriggerTab", "name": "ThresholdTriggerTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Pressure definitions\n */\nexport function ThresholdTriggerTab({ system, onChange, schema, pressures }) {\n  const config = system.config;\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddVarForm, setShowAddVarForm] = useState(false);\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  // Conditions\n  const conditions = config.conditions || [];\n\n  const addCondition = (type) => {\n    const newRule = createNewRule(type, pressures);\n    updateConfig(\"conditions\", [...conditions, newRule]);\n  };\n\n  const updateCondition = (index, cond) => {\n    const newConditions = [...conditions];\n    newConditions[index] = cond;\n    updateConfig(\"conditions\", newConditions);\n  };\n\n  const removeCondition = (index) => {\n    updateConfig(\n      \"conditions\",\n      conditions.filter((_, i) => i !== index)\n    );\n  };\n\n  // Variables\n  const variables = config.variables || {};\n\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$self\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    updateConfig(\"variables\", {\n      ...variables,\n      [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"random\" } },\n    });\n    setNewVarName(\"\");\n    setShowAddVarForm(false);\n  };\n\n  const updateVariable = (name, config) => {\n    updateConfig(\"variables\", { ...variables, [name]: config });\n  };\n\n  const removeVariable = (name) => {\n    const newVars = { ...variables };\n    delete newVars[name];\n    updateConfig(\"variables\", newVars);\n  };\n\n  // Build entity options for actions (include defined variables)\n  const entityOptions = [\n    { value: \"$self\", label: \"$self\" },\n    { value: \"$member\", label: \"$member\" },\n    { value: \"$member2\", label: \"$member2\" },\n    ...Object.keys(variables).map((v) => ({ value: v, label: v })),\n  ];\n\n  // Actions (mutations)\n  const actions = config.actions || [];\n\n  const createAction = (type) => {\n    const defaultPressure = pressures?.[0]?.id || \"\";\n    switch (type) {\n      case \"modify_pressure\":\n        return { type: \"modify_pressure\", pressureId: defaultPressure, delta: 0 };\n      case \"set_tag\":\n        return { type: \"set_tag\", entity: \"$self\", tag: \"\", value: true };\n      case \"remove_tag\":\n        return { type: \"remove_tag\", entity: \"$self\", tag: \"\" };\n      case \"change_status\":\n        return { type: \"change_status\", entity: \"$self\", newStatus: \"\" };\n      case \"adjust_prominence\":\n        return { type: \"adjust_prominence\", entity: \"$self\", delta: 0.25 };\n      case \"archive_relationship\":\n        return {\n          type: \"archive_relationship\",\n          entity: \"$self\",\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n      case \"adjust_relationship_strength\":\n        return {\n          type: \"adjust_relationship_strength\",\n          kind: \"\",\n          src: \"$self\",\n          dst: \"$self\",\n          delta: 0.1,\n        };\n      case \"transfer_relationship\":\n        return {\n          type: \"transfer_relationship\",\n          entity: \"$self\",\n          relationshipKind: \"\",\n          from: \"$self\",\n          to: \"$self\",\n        };\n      case \"update_rate_limit\":\n        return { type: \"update_rate_limit\" };\n      case \"for_each_related\":\n        return { type: \"for_each_related\", relationship: \"\", direction: \"both\", actions: [] };\n      case \"conditional\":\n        return {\n          type: \"conditional\",\n          condition: { type: \"random_chance\", chance: 0.5 },\n          thenActions: [],\n          elseActions: [],\n        };\n      case \"create_relationship\":\n      default:\n        return { type: \"create_relationship\", kind: \"\", src: \"$self\", dst: \"$self\", strength: 0.5 };\n    }\n  };\n\n  const addAction = (type) => {\n    updateConfig(\"actions\", [...actions, createAction(type)]);\n  };\n\n  const updateAction = (index, action) => {\n    const newActions = [...actions];\n    newActions[index] = action;\n    updateConfig(\"actions\", newActions);\n  };\n\n  const removeAction = (index) => {\n    updateConfig(\n      \"actions\",\n      actions.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Conditions ({conditions.length})</div>\n        <div className=\"section-desc\">\n          All conditions must pass for an entity to be included in the trigger.\n        </div>\n\n        {conditions.length === 0 ? (\n          <div className=\"empty-state-compact\">No conditions defined.</div>\n        ) : (\n          conditions.map((cond, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={cond}\n              onChange={(c) => updateCondition(index, c)}\n              onRemove={() => removeCondition(index)}\n              schema={schema}\n              pressures={pressures}\n            />\n          ))\n        )}\n\n        <AddRuleButton onAdd={addCondition} />\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Variables ({Object.keys(variables).length})</div>\n        <div className=\"section-desc\">\n          Variables select additional entities from the graph to use in actions. Referenced as{\" \"}\n          <code className=\"inline-code\">$varName</code> in action entity fields.\n        </div>\n\n        {Object.keys(variables).length === 0 && !showAddVarForm ? (\n          <div className=\"empty-state-compact\">No variables defined.</div>\n        ) : (\n          Object.entries(variables).map(([name, varConfig]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={varConfig}\n              onChange={(updated) => updateVariable(name, updated)}\n              onRemove={() => removeVariable(name)}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddVarForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddVarForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddVarForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Actions ({actions.length})</div>\n        <div className=\"section-desc\">\n          Mutations applied to each matching entity (or clusters when configured).\n        </div>\n\n        {actions.map((actionItem, index) => (\n          <div key={index} className=\"mb-lg\">\n            <MutationCard\n              mutation={actionItem}\n              onChange={(a) => updateAction(index, a)}\n              onRemove={() => removeAction(index)}\n              schema={schema}\n              pressures={pressures}\n              entityOptions={entityOptions}\n              typeOptions={TRIGGER_MUTATION_TYPES}\n              createMutation={createAction}\n              titlePrefix=\"Action\"\n            />\n            {actionItem.type === \"create_relationship\" && (\n              <label className=\"checkbox-label mt-md\">\n                <input\n                  type=\"checkbox\"\n                  checked={actionItem.betweenMatching || false}\n                  onChange={(e) =>\n                    updateAction(index, { ...actionItem, betweenMatching: e.target.checked })\n                  }\n                  className=\"checkbox\"\n                />\n                Between matching entities\n              </label>\n            )}\n          </div>\n        ))}\n\n        <div className=\"form-group mt-lg\">\n          <select\n            className=\"select\"\n            value=\"\"\n            onChange={(e) => {\n              if (!e.target.value) return;\n              addAction(e.target.value);\n            }}\n          >\n            <option value=\"\">+ Add action...</option>\n            {TRIGGER_MUTATION_TYPES.map((opt) => (\n              <option key={opt.value} value={opt.value}>\n                {opt.label}\n              </option>\n            ))}\n          </select>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Clustering</div>\n// ... (truncated)", "parameters": [{"name": "{ system, onChange, schema, pressures }", "type": "{ system: any; onChange: Function; schema: any; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "MutationCard", "children": [], "isMap": false, "isConditional": false}, {"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "select", "children": [{"tag": "option", "children": [], "isMap": false, "isConditional": false}, {"tag": "option", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::ClusterFormationTab", "name": "ClusterFormationTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function ClusterFormationTab({ system, onChange, schema }) {\n  const config = system.config;\n\n  const entityKindOptions = (schema?.entityKinds || []).map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateClustering = (field, value) => {\n    updateConfig(\"clustering\", { ...config.clustering, [field]: value });\n  };\n\n  const updateMetaEntity = (field, value) => {\n    updateConfig(\"metaEntity\", { ...config.metaEntity, [field]: value });\n  };\n\n  // Criteria\n  const criteria = config.clustering?.criteria || [];\n\n  const addCriterion = () => {\n    updateClustering(\"criteria\", [...criteria, { type: \"same_culture\", weight: 1.0 }]);\n  };\n\n  const updateCriterion = (index, crit) => {\n    const newCriteria = [...criteria];\n    newCriteria[index] = crit;\n    updateClustering(\"criteria\", newCriteria);\n  };\n\n  const removeCriterion = (index) => {\n    updateClustering(\n      \"criteria\",\n      criteria.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Clustering Configuration</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Min Size\n            <NumberInput\n              value={config.clustering?.minSize}\n              onChange={(v) => updateClustering(\"minSize\", v)}\n              min={2}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Max Size\n            <NumberInput\n              value={config.clustering?.maxSize}\n              onChange={(v) => updateClustering(\"maxSize\", v)}\n              min={2}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Minimum Score\n            <NumberInput\n              value={config.clustering?.minimumScore}\n              onChange={(v) => updateClustering(\"minimumScore\", v)}\n              min={0}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Clustering Criteria ({criteria.length})</label>\n        </div>\n\n        {criteria.map((crit, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"py-lg px-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <ReferenceDropdown\n                    label=\"Type\"\n                    value={crit.type}\n                    onChange={(v) => updateCriterion(index, { ...crit, type: v })}\n                    options={CLUSTERING_CRITERIA_TYPES}\n                  />\n                  <div className=\"form-group\">\n                    <label className=\"label\">Weight\n                    <NumberInput\n                      value={crit.weight}\n                      onChange={(v) => updateCriterion(index, { ...crit, weight: v ?? 0 })}\n                      min={0}\n                    />\n                    </label>\n                  </div>\n                  {crit.type === \"shared_relationship\" && (\n                    <ReferenceDropdown\n                      label=\"Relationship Kind\"\n                      value={crit.relationshipKind}\n                      onChange={(v) => updateCriterion(index, { ...crit, relationshipKind: v })}\n                      options={relationshipKindOptions}\n                    />\n                  )}\n                </div>\n                <button className=\"btn-icon btn-icon-danger\" onClick={() => removeCriterion(index)}>\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addCriterion}>\n          + Add Criterion\n        </button>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Meta Entity</div>\n        <div className=\"section-desc\">Configuration for the meta-entity created from clusters.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Kind\"\n            value={config.metaEntity?.kind}\n            onChange={(v) => updateMetaEntity(\"kind\", v)}\n            options={entityKindOptions}\n          />\n          <div className=\"form-group\">\n            <label htmlFor=\"status\" className=\"label\">Status</label>\n            <input id=\"status\"\n              type=\"text\"\n              value={config.metaEntity?.status || \"\"}\n              onChange={(e) => updateMetaEntity(\"status\", e.target.value)}\n              className=\"input\"\n            />\n          </div>\n        </div>\n        <div className=\"mt-xl\">\n          <div className=\"form-group\">\n            <label className=\"label\">Description Template\n            <LocalTextArea\n              value={config.metaEntity?.descriptionTemplate || \"\"}\n              onChange={(value) => updateMetaEntity(\"descriptionTemplate\", value)}\n              placeholder=\"Use {names}, {count} placeholders\"\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Narration Template</div>\n        <div className=\"section-desc mb-md text-xs\">\n          Syntax: {\"{list:members}\"}, {\"{count}\"}, {\"{field|fallback}\"}.\n        </div>\n        <LocalTextArea\n          value={config.narrationTemplate || \"\"}\n          onChange={(value) => updateConfig(\"narrationTemplate\", value || undefined)}\n          placeholder=\"e.g., {list:members} united to form a new alliance.\"\n          rows={2}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::TagDiffusionTab", "name": "TagDiffusionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function TagDiffusionTab({ system, onChange, schema }) {\n  const config = system.config;\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateConvergence = (field, value) => {\n    updateConfig(\"convergence\", { ...config.convergence, [field]: value });\n  };\n\n  const updateDivergence = (field, value) => {\n    updateConfig(\"divergence\", { ...config.divergence, [field]: value });\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Connection</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Connection Kind\"\n            value={config.connectionKind}\n            onChange={(v) => updateConfig(\"connectionKind\", v)}\n            options={relationshipKindOptions}\n          />\n          <ReferenceDropdown\n            label=\"Direction\"\n            value={config.connectionDirection || \"both\"}\n            onChange={(v) => updateConfig(\"connectionDirection\", v)}\n            options={DIRECTIONS}\n          />\n          <div className=\"form-group\">\n            <label className=\"label\">Max Tags\n            <NumberInput\n              value={config.maxTags}\n              onChange={(v) => updateConfig(\"maxTags\", v)}\n              min={1}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Convergence</div>\n        <div className=\"section-desc\">Connected entities become more similar.</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tags\n            <TagSelector\n              value={config.convergence?.tags || []}\n              onChange={(tags) => updateConvergence(\"tags\", tags)}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Min Connections\n            <NumberInput\n              value={config.convergence?.minConnections}\n              onChange={(v) => updateConvergence(\"minConnections\", v)}\n              min={0}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Probability\n            <NumberInput\n              value={config.convergence?.probability}\n              onChange={(v) => updateConvergence(\"probability\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Divergence</div>\n        <div className=\"section-desc\">Isolated entities become more unique.</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tags\n            <TagSelector\n              value={config.divergence?.tags || []}\n              onChange={(tags) => updateDivergence(\"tags\", tags)}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Max Connections\n            <NumberInput\n              value={config.divergence?.maxConnections}\n              onChange={(v) => updateDivergence(\"maxConnections\", v)}\n              min={0}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Probability\n            <NumberInput\n              value={config.divergence?.probability}\n              onChange={(v) => updateDivergence(\"probability\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::PlaneDiffusionTab", "name": "PlaneDiffusionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema (for tag registry)\n */\nexport function PlaneDiffusionTab({ system, onChange, schema }) {\n  const config = system.config;\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateSources = (field, value) => {\n    updateConfig(\"sources\", { ...config.sources, [field]: value });\n  };\n\n  const updateSinks = (field, value) => {\n    updateConfig(\"sinks\", { ...config.sinks, [field]: value });\n  };\n\n  const updateDiffusion = (field, value) => {\n    updateConfig(\"diffusion\", { ...config.diffusion, [field]: value });\n  };\n\n  // Output tags\n  const outputTags = config.outputTags || [];\n\n  const addOutputTag = () => {\n    updateConfig(\"outputTags\", [...outputTags, { tag: \"\", minValue: 0 }]);\n  };\n\n  const updateOutputTag = (index, tag) => {\n    const newTags = [...outputTags];\n    newTags[index] = tag;\n    updateConfig(\"outputTags\", newTags);\n  };\n\n  const removeOutputTag = (index) => {\n    updateConfig(\n      \"outputTags\",\n      outputTags.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Sources</div>\n        <div className=\"pdt-section-hint\">\n          Entities that SET values into the diffusion field. Values are maintained at source\n          positions each tick (Dirichlet boundary condition).\n        </div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tag Filter\n            <TagSelector\n              value={config.sources?.tagFilter ? [config.sources.tagFilter] : []}\n              onChange={(tags) => updateSources(\"tagFilter\", tags[0] || \"\")}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tag...\"\n              singleSelect\n            />\n            </label>\n            <div className=\"pdt-hint\">Tag that marks an entity as a source</div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Default Strength\n            <NumberInput\n              value={config.sources?.defaultStrength}\n              onChange={(v) => updateSources(\"defaultStrength\", v)}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              Any number. Simulation is uncapped. Output tags clamp to -100/100.\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Sinks</div>\n        <div className=\"pdt-section-hint\">\n          Entities that SET negative values into the diffusion field.\n        </div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tag Filter\n            <TagSelector\n              value={config.sinks?.tagFilter ? [config.sinks.tagFilter] : []}\n              onChange={(tags) => updateSinks(\"tagFilter\", tags[0] || \"\")}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tag...\"\n              singleSelect\n            />\n            </label>\n            <div className=\"pdt-hint\">Tag that marks an entity as a sink</div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Default Strength\n            <NumberInput\n              value={config.sinks?.defaultStrength}\n              onChange={(v) => updateSinks(\"defaultStrength\", v)}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">Will be negated. Any number - simulation is uncapped.</div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Diffusion</div>\n        <div className=\"pdt-section-hint\">\n          Heat equation parameters. Each tick: sources/sinks SET values (fixed boundary), then\n          diffusion runs N iterations to spread values.\n        </div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Rate\n            <NumberInput\n              value={config.diffusion?.rate}\n              onChange={(v) => updateDiffusion(\"rate\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              0-1. Recommended 0.1-0.25. Above 0.25 may cause oscillations.\n            </div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Source Radius\n            <NumberInput\n              value={config.diffusion?.sourceRadius}\n              onChange={(v) => updateDiffusion(\"sourceRadius\", v)}\n              min={0}\n              max={50}\n              integer\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">Grid cells where source/sink SET values. Default: 1.</div>\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"falloff-type\" className=\"label\">Falloff Type</label>\n            <select id=\"falloff-type\"\n              className=\"input\"\n              value={config.diffusion?.falloffType || \"absolute\"}\n              onChange={(e) => updateDiffusion(\"falloffType\", e.target.value)}\n            >\n              {FALLOFF_OPTIONS.map((opt) => (\n                <option key={opt.value} value={opt.value}>\n                  {opt.label}\n                </option>\n              ))}\n            </select>\n            <div className=\"pdt-hint\">How strength decreases within source radius.</div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Decay Rate\n            <NumberInput\n              value={config.diffusion?.decayRate}\n              onChange={(v) => updateDiffusion(\"decayRate\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              0-1. Default: 0 (no decay). Decay fights diffusion spreading.\n            </div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Iterations Per Tick\n            <NumberInput\n              value={config.diffusion?.iterationsPerTick}\n              onChange={(v) => updateDiffusion(\"iterationsPerTick\", v)}\n              min={1}\n              max={200}\n              integer\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              Default: 20. Higher = faster spreading. 20 achieves ~50 cells in 15 ticks.\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Output Tags ({outputTags.length})</div>\n        <div className=\"pdt-section-hint\">\n          Tags assigned to entities based on sampled field value (clamped to -100 to 100).\n        </div>\n\n        {outputTags.map((tag, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"py-lg px-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <div className=\"form-group\">\n                    <label className=\"label\">Tag\n                    <TagSelector\n                      value={tag.tag ? [tag.tag] : []}\n                      onChange={(tags) => updateOutputTag(index, { ...tag, tag: tags[0] || \"\" })}\n                      tagRegistry={tagRegistry}\n                      placeholder=\"Select tag...\"\n                      singleSelect\n                    />\n                    </label>\n                  </div>\n                  <div className=\"form-group\">\n                    <label className=\"label\">Min Value\n                    <NumberInput\n                      value={tag.minValue}\n                      onChange={(v) => updateOutputTag(index, { ...tag, minValue: v })}\n                      min={-100}\n                      max={100}\n                      allowEmpty\n                    />\n                    </label>\n                    <div className=\"pdt-hint\">-100 to 100</div>\n                  </div>\n                  <div className=\"form-group\">\n                    <label className=\"label\">Max Value\n                    <NumberInput\n                      value={tag.maxValue}\n                      onChange={(v) => updateOutputTag(index, { ...tag, maxValue: v })}\n                      min={-100}\n                      max={100}\n                      allowEmpty\n                    />\n                    </label>\n                    <div className=\"pdt-hint\">-100 to 100</div>\n                  </div>\n                </div>\n                <button className=\"btn-icon btn-icon-danger\" onClick={() => removeOutputTag(index)}>\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addOutputTag}>\n          + Add Output Tag\n        </button>\n\n        <div className=\"mt-xl\">\n          <div className=\"form-group\">\n            <label className=\"label\">Value Tag\n            <TagSelector\n              value={config.valueTag ? [config.valueTag] : []}\n              onChange={(tags) => updateConfig(\"valueTag\", tags[0] || \"\")}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tag...\"\n              singleSelect\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              Optional: Store clamped field value as tag (e.g., &quot;field_value:25.5&quot;)\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "select", "children": [{"tag": "option", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::FrameworkSystemTab", "name": "FrameworkSystemTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n */\nexport function FrameworkSystemTab({ system, onChange }) {\n  const config = system.config;\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Framework System</div>\n        <div className=\"info-box-text\">\n          This is a framework-level system with specific configuration options.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Configuration</div>\n\n        {system.systemType === \"eraTransition\" && (\n          <div className=\"form-grid\">\n            <p className=\"label grid-col-full text-dim\">\n              Era transition timing is controlled by per-era exitConditions in eras.json. Add a time\n              condition (e.g., {`{ type: 'time_elapsed', minTicks: 25 }`}) to control minimum era\n              length.\n            </p>\n          </div>\n        )}\n\n        {system.systemType === \"universalCatalyst\" && (\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label\">Action Attempt Rate\n              <NumberInput\n                value={config.actionAttemptRate}\n                onChange={(v) => updateConfig(\"actionAttemptRate\", v)}\n                className=\"input\"\n                step={0.1}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Pressure Multiplier\n              <NumberInput\n                value={config.pressureMultiplier}\n                onChange={(v) => updateConfig(\"pressureMultiplier\", v)}\n                className=\"input\"\n                step={0.1}\n                min={0}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Prominence Up % on Success\n              <NumberInput\n                value={config.prominenceUpChanceOnSuccess}\n                onChange={(v) => updateConfig(\"prominenceUpChanceOnSuccess\", v)}\n                className=\"input\"\n                step={0.05}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Prominence Down % on Failure\n              <NumberInput\n                value={config.prominenceDownChanceOnFailure}\n                onChange={(v) => updateConfig(\"prominenceDownChanceOnFailure\", v)}\n                className=\"input\"\n                step={0.05}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        )}\n\n        {system.systemType === \"relationshipMaintenance\" && (\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label\">Maintenance Frequency\n              <NumberInput\n                value={config.maintenanceFrequency}\n                onChange={(v) => updateConfig(\"maintenanceFrequency\", v)}\n                className=\"input\"\n                min={1}\n                allowEmpty\n                integer\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Cull Threshold\n              <NumberInput\n                value={config.cullThreshold}\n                onChange={(v) => updateConfig(\"cullThreshold\", v)}\n                className=\"input\"\n                step={0.05}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Grace Period\n              <NumberInput\n                value={config.gracePeriod}\n                onChange={(v) => updateConfig(\"gracePeriod\", v)}\n                className=\"input\"\n                min={0}\n                allowEmpty\n                integer\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Reinforcement Bonus\n              <NumberInput\n                value={config.reinforcementBonus}\n                onChange={(v) => updateConfig(\"reinforcementBonus\", v)}\n                className=\"input\"\n                step={0.01}\n                min={0}\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange }", "type": "{ system: any; onChange: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "p", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/OverviewTab.jsx::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/OverviewTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Function} props.onDelete - Called to delete the system\n */\nexport function OverviewTab({ system, onChange, onDelete }) {\n  const config = system.config;\n  const typeConfig = SYSTEM_TYPES[system.systemType] || {};\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(config.id, (value) =>\n    updateConfig(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(config.name, (value) =>\n    updateConfig(\"name\", value)\n  );\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"system-id\" className=\"label\">System ID</label>\n            <input id=\"system-id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"display-name\" className=\"label\">Display Name</label>\n            <input id=\"display-name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <div className=\"form-group\">\n            <label className=\"label\">Description\n            <LocalTextArea\n              value={config.description || \"\"}\n              onChange={(value) => updateConfig(\"description\", value)}\n              className=\"ot-description-textarea\"\n              placeholder=\"Describe what this system does...\"\n            />\n            </label>\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">System Type</span>\n          <div className=\"flex items-center gap-lg\">\n            {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color from config */}\n            <span\n              className=\"type-badge\"\n              style={{ '--ot-type-bg': `${typeConfig.color}30`, '--ot-type-color': typeConfig.color, backgroundColor: 'var(--ot-type-bg)', color: 'var(--ot-type-color)' }}\n            >\n              {typeConfig.icon} {typeConfig.label}\n            </span>\n            <span className=\"text-muted ot-type-desc\">\n              {typeConfig.desc}\n            </span>\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Enabled\n          <EnableToggle\n            enabled={system.enabled !== false}\n            onChange={(enabled) => onChange({ ...system, enabled })}\n            label={system.enabled !== false ? \"System is active\" : \"System is disabled\"}\n          />\n          </label>\n        </div>\n      </div>\n\n      <div className=\"danger-zone\">\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete System\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, onDelete }", "type": "{ system: any; onChange: Function; onDelete: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useLocalInputState", "count": 2}], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["SYSTEM_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["EnableToggle", "useLocalInputState", "LocalTextArea"], "category": "internal"}, {"source": "./OverviewTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/PlaneDiffusionTab.jsx::PlaneDiffusionTab", "name": "PlaneDiffusionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/PlaneDiffusionTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema (for tag registry)\n */\nexport function PlaneDiffusionTab({ system, onChange, schema }) {\n  const config = system.config;\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateSources = (field, value) => {\n    updateConfig(\"sources\", { ...config.sources, [field]: value });\n  };\n\n  const updateSinks = (field, value) => {\n    updateConfig(\"sinks\", { ...config.sinks, [field]: value });\n  };\n\n  const updateDiffusion = (field, value) => {\n    updateConfig(\"diffusion\", { ...config.diffusion, [field]: value });\n  };\n\n  // Output tags\n  const outputTags = config.outputTags || [];\n\n  const addOutputTag = () => {\n    updateConfig(\"outputTags\", [...outputTags, { tag: \"\", minValue: 0 }]);\n  };\n\n  const updateOutputTag = (index, tag) => {\n    const newTags = [...outputTags];\n    newTags[index] = tag;\n    updateConfig(\"outputTags\", newTags);\n  };\n\n  const removeOutputTag = (index) => {\n    updateConfig(\n      \"outputTags\",\n      outputTags.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Sources</div>\n        <div className=\"pdt-section-hint\">\n          Entities that SET values into the diffusion field. Values are maintained at source\n          positions each tick (Dirichlet boundary condition).\n        </div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tag Filter\n            <TagSelector\n              value={config.sources?.tagFilter ? [config.sources.tagFilter] : []}\n              onChange={(tags) => updateSources(\"tagFilter\", tags[0] || \"\")}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tag...\"\n              singleSelect\n            />\n            </label>\n            <div className=\"pdt-hint\">Tag that marks an entity as a source</div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Default Strength\n            <NumberInput\n              value={config.sources?.defaultStrength}\n              onChange={(v) => updateSources(\"defaultStrength\", v)}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              Any number. Simulation is uncapped. Output tags clamp to -100/100.\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Sinks</div>\n        <div className=\"pdt-section-hint\">\n          Entities that SET negative values into the diffusion field.\n        </div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tag Filter\n            <TagSelector\n              value={config.sinks?.tagFilter ? [config.sinks.tagFilter] : []}\n              onChange={(tags) => updateSinks(\"tagFilter\", tags[0] || \"\")}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tag...\"\n              singleSelect\n            />\n            </label>\n            <div className=\"pdt-hint\">Tag that marks an entity as a sink</div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Default Strength\n            <NumberInput\n              value={config.sinks?.defaultStrength}\n              onChange={(v) => updateSinks(\"defaultStrength\", v)}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">Will be negated. Any number - simulation is uncapped.</div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Diffusion</div>\n        <div className=\"pdt-section-hint\">\n          Heat equation parameters. Each tick: sources/sinks SET values (fixed boundary), then\n          diffusion runs N iterations to spread values.\n        </div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Rate\n            <NumberInput\n              value={config.diffusion?.rate}\n              onChange={(v) => updateDiffusion(\"rate\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              0-1. Recommended 0.1-0.25. Above 0.25 may cause oscillations.\n            </div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Source Radius\n            <NumberInput\n              value={config.diffusion?.sourceRadius}\n              onChange={(v) => updateDiffusion(\"sourceRadius\", v)}\n              min={0}\n              max={50}\n              integer\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">Grid cells where source/sink SET values. Default: 1.</div>\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"falloff-type\" className=\"label\">Falloff Type</label>\n            <select id=\"falloff-type\"\n              className=\"input\"\n              value={config.diffusion?.falloffType || \"absolute\"}\n              onChange={(e) => updateDiffusion(\"falloffType\", e.target.value)}\n            >\n              {FALLOFF_OPTIONS.map((opt) => (\n                <option key={opt.value} value={opt.value}>\n                  {opt.label}\n                </option>\n              ))}\n            </select>\n            <div className=\"pdt-hint\">How strength decreases within source radius.</div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Decay Rate\n            <NumberInput\n              value={config.diffusion?.decayRate}\n              onChange={(v) => updateDiffusion(\"decayRate\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              0-1. Default: 0 (no decay). Decay fights diffusion spreading.\n            </div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Iterations Per Tick\n            <NumberInput\n              value={config.diffusion?.iterationsPerTick}\n              onChange={(v) => updateDiffusion(\"iterationsPerTick\", v)}\n              min={1}\n              max={200}\n              integer\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              Default: 20. Higher = faster spreading. 20 achieves ~50 cells in 15 ticks.\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Output Tags ({outputTags.length})</div>\n        <div className=\"pdt-section-hint\">\n          Tags assigned to entities based on sampled field value (clamped to -100 to 100).\n        </div>\n\n        {outputTags.map((tag, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"py-lg px-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <div className=\"form-group\">\n                    <label className=\"label\">Tag\n                    <TagSelector\n                      value={tag.tag ? [tag.tag] : []}\n                      onChange={(tags) => updateOutputTag(index, { ...tag, tag: tags[0] || \"\" })}\n                      tagRegistry={tagRegistry}\n                      placeholder=\"Select tag...\"\n                      singleSelect\n                    />\n                    </label>\n                  </div>\n                  <div className=\"form-group\">\n                    <label className=\"label\">Min Value\n                    <NumberInput\n                      value={tag.minValue}\n                      onChange={(v) => updateOutputTag(index, { ...tag, minValue: v })}\n                      min={-100}\n                      max={100}\n                      allowEmpty\n                    />\n                    </label>\n                    <div className=\"pdt-hint\">-100 to 100</div>\n                  </div>\n                  <div className=\"form-group\">\n                    <label className=\"label\">Max Value\n                    <NumberInput\n                      value={tag.maxValue}\n                      onChange={(v) => updateOutputTag(index, { ...tag, maxValue: v })}\n                      min={-100}\n                      max={100}\n                      allowEmpty\n                    />\n                    </label>\n                    <div className=\"pdt-hint\">-100 to 100</div>\n                  </div>\n                </div>\n                <button className=\"btn-icon btn-icon-danger\" onClick={() => removeOutputTag(index)}>\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addOutputTag}>\n          + Add Output Tag\n        </button>\n\n        <div className=\"mt-xl\">\n          <div className=\"form-group\">\n            <label className=\"label\">Value Tag\n            <TagSelector\n              value={config.valueTag ? [config.valueTag] : []}\n              onChange={(tags) => updateConfig(\"valueTag\", tags[0] || \"\")}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tag...\"\n              singleSelect\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              Optional: Store clamped field value as tag (e.g., &quot;field_value:25.5&quot;)\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "select", "children": [{"tag": "option", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["NumberInput"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}, {"source": "./PlaneDiffusionTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/TagDiffusionTab.jsx::TagDiffusionTab", "name": "TagDiffusionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/TagDiffusionTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function TagDiffusionTab({ system, onChange, schema }) {\n  const config = system.config;\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateConvergence = (field, value) => {\n    updateConfig(\"convergence\", { ...config.convergence, [field]: value });\n  };\n\n  const updateDivergence = (field, value) => {\n    updateConfig(\"divergence\", { ...config.divergence, [field]: value });\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Connection</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Connection Kind\"\n            value={config.connectionKind}\n            onChange={(v) => updateConfig(\"connectionKind\", v)}\n            options={relationshipKindOptions}\n          />\n          <ReferenceDropdown\n            label=\"Direction\"\n            value={config.connectionDirection || \"both\"}\n            onChange={(v) => updateConfig(\"connectionDirection\", v)}\n            options={DIRECTIONS}\n          />\n          <div className=\"form-group\">\n            <label className=\"label\">Max Tags\n            <NumberInput\n              value={config.maxTags}\n              onChange={(v) => updateConfig(\"maxTags\", v)}\n              min={1}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Convergence</div>\n        <div className=\"section-desc\">Connected entities become more similar.</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tags\n            <TagSelector\n              value={config.convergence?.tags || []}\n              onChange={(tags) => updateConvergence(\"tags\", tags)}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Min Connections\n            <NumberInput\n              value={config.convergence?.minConnections}\n              onChange={(v) => updateConvergence(\"minConnections\", v)}\n              min={0}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Probability\n            <NumberInput\n              value={config.convergence?.probability}\n              onChange={(v) => updateConvergence(\"probability\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Divergence</div>\n        <div className=\"section-desc\">Isolated entities become more unique.</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tags\n            <TagSelector\n              value={config.divergence?.tags || []}\n              onChange={(tags) => updateDivergence(\"tags\", tags)}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Max Connections\n            <NumberInput\n              value={config.divergence?.maxConnections}\n              onChange={(v) => updateDivergence(\"maxConnections\", v)}\n              min={0}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Probability\n            <NumberInput\n              value={config.divergence?.probability}\n              onChange={(v) => updateDivergence(\"probability\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["DIRECTIONS"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/ThresholdTriggerTab.jsx::ThresholdTriggerTab", "name": "ThresholdTriggerTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/ThresholdTriggerTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Pressure definitions\n */\nexport function ThresholdTriggerTab({ system, onChange, schema, pressures }) {\n  const config = system.config;\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddVarForm, setShowAddVarForm] = useState(false);\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  // Conditions\n  const conditions = config.conditions || [];\n\n  const addCondition = (type) => {\n    const newRule = createNewRule(type, pressures);\n    updateConfig(\"conditions\", [...conditions, newRule]);\n  };\n\n  const updateCondition = (index, cond) => {\n    const newConditions = [...conditions];\n    newConditions[index] = cond;\n    updateConfig(\"conditions\", newConditions);\n  };\n\n  const removeCondition = (index) => {\n    updateConfig(\n      \"conditions\",\n      conditions.filter((_, i) => i !== index)\n    );\n  };\n\n  // Variables\n  const variables = config.variables || {};\n\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$self\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    updateConfig(\"variables\", {\n      ...variables,\n      [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"random\" } },\n    });\n    setNewVarName(\"\");\n    setShowAddVarForm(false);\n  };\n\n  const updateVariable = (name, config) => {\n    updateConfig(\"variables\", { ...variables, [name]: config });\n  };\n\n  const removeVariable = (name) => {\n    const newVars = { ...variables };\n    delete newVars[name];\n    updateConfig(\"variables\", newVars);\n  };\n\n  // Build entity options for actions (include defined variables)\n  const entityOptions = [\n    { value: \"$self\", label: \"$self\" },\n    { value: \"$member\", label: \"$member\" },\n    { value: \"$member2\", label: \"$member2\" },\n    ...Object.keys(variables).map((v) => ({ value: v, label: v })),\n  ];\n\n  // Actions (mutations)\n  const actions = config.actions || [];\n\n  const createAction = (type) => {\n    const defaultPressure = pressures?.[0]?.id || \"\";\n    switch (type) {\n      case \"modify_pressure\":\n        return { type: \"modify_pressure\", pressureId: defaultPressure, delta: 0 };\n      case \"set_tag\":\n        return { type: \"set_tag\", entity: \"$self\", tag: \"\", value: true };\n      case \"remove_tag\":\n        return { type: \"remove_tag\", entity: \"$self\", tag: \"\" };\n      case \"change_status\":\n        return { type: \"change_status\", entity: \"$self\", newStatus: \"\" };\n      case \"adjust_prominence\":\n        return { type: \"adjust_prominence\", entity: \"$self\", delta: 0.25 };\n      case \"archive_relationship\":\n        return {\n          type: \"archive_relationship\",\n          entity: \"$self\",\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n      case \"adjust_relationship_strength\":\n        return {\n          type: \"adjust_relationship_strength\",\n          kind: \"\",\n          src: \"$self\",\n          dst: \"$self\",\n          delta: 0.1,\n        };\n      case \"transfer_relationship\":\n        return {\n          type: \"transfer_relationship\",\n          entity: \"$self\",\n          relationshipKind: \"\",\n          from: \"$self\",\n          to: \"$self\",\n        };\n      case \"update_rate_limit\":\n        return { type: \"update_rate_limit\" };\n      case \"for_each_related\":\n        return { type: \"for_each_related\", relationship: \"\", direction: \"both\", actions: [] };\n      case \"conditional\":\n        return {\n          type: \"conditional\",\n          condition: { type: \"random_chance\", chance: 0.5 },\n          thenActions: [],\n          elseActions: [],\n        };\n      case \"create_relationship\":\n      default:\n        return { type: \"create_relationship\", kind: \"\", src: \"$self\", dst: \"$self\", strength: 0.5 };\n    }\n  };\n\n  const addAction = (type) => {\n    updateConfig(\"actions\", [...actions, createAction(type)]);\n  };\n\n  const updateAction = (index, action) => {\n    const newActions = [...actions];\n    newActions[index] = action;\n    updateConfig(\"actions\", newActions);\n  };\n\n  const removeAction = (index) => {\n    updateConfig(\n      \"actions\",\n      actions.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Conditions ({conditions.length})</div>\n        <div className=\"section-desc\">\n          All conditions must pass for an entity to be included in the trigger.\n        </div>\n\n        {conditions.length === 0 ? (\n          <div className=\"empty-state-compact\">No conditions defined.</div>\n        ) : (\n          conditions.map((cond, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={cond}\n              onChange={(c) => updateCondition(index, c)}\n              onRemove={() => removeCondition(index)}\n              schema={schema}\n              pressures={pressures}\n            />\n          ))\n        )}\n\n        <AddRuleButton onAdd={addCondition} />\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Variables ({Object.keys(variables).length})</div>\n        <div className=\"section-desc\">\n          Variables select additional entities from the graph to use in actions. Referenced as{\" \"}\n          <code className=\"inline-code\">$varName</code> in action entity fields.\n        </div>\n\n        {Object.keys(variables).length === 0 && !showAddVarForm ? (\n          <div className=\"empty-state-compact\">No variables defined.</div>\n        ) : (\n          Object.entries(variables).map(([name, varConfig]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={varConfig}\n              onChange={(updated) => updateVariable(name, updated)}\n              onRemove={() => removeVariable(name)}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddVarForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddVarForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddVarForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Actions ({actions.length})</div>\n        <div className=\"section-desc\">\n          Mutations applied to each matching entity (or clusters when configured).\n        </div>\n\n        {actions.map((actionItem, index) => (\n          <div key={index} className=\"mb-lg\">\n            <MutationCard\n              mutation={actionItem}\n              onChange={(a) => updateAction(index, a)}\n              onRemove={() => removeAction(index)}\n              schema={schema}\n              pressures={pressures}\n              entityOptions={entityOptions}\n              typeOptions={TRIGGER_MUTATION_TYPES}\n              createMutation={createAction}\n              titlePrefix=\"Action\"\n            />\n            {actionItem.type === \"create_relationship\" && (\n              <label className=\"checkbox-label mt-md\">\n                <input\n                  type=\"checkbox\"\n                  checked={actionItem.betweenMatching || false}\n                  onChange={(e) =>\n                    updateAction(index, { ...actionItem, betweenMatching: e.target.checked })\n                  }\n                  className=\"checkbox\"\n                />\n                Between matching entities\n              </label>\n            )}\n          </div>\n        ))}\n\n        <div className=\"form-group mt-lg\">\n          <select\n            className=\"select\"\n            value=\"\"\n            onChange={(e) => {\n              if (!e.target.value) return;\n              addAction(e.target.value);\n            }}\n          >\n            <option value=\"\">+ Add action...</option>\n            {TRIGGER_MUTATION_TYPES.map((opt) => (\n              <option key={opt.value} value={opt.value}>\n                {opt.label}\n              </option>\n            ))}\n          </select>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Clustering</div>\n// ... (truncated)", "parameters": [{"name": "{ system, onChange, schema, pressures }", "type": "{ system: any; onChange: Function; schema: any; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "MutationCard", "children": [], "isMap": false, "isConditional": false}, {"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "select", "children": [{"tag": "option", "children": [], "isMap": false, "isConditional": false}, {"tag": "option", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["CLUSTER_MODES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput", "LocalTextArea"], "category": "internal"}, {"source": "../../shared/VariableSelectionEditor", "specifiers": ["VariableSelectionEditor"], "category": "internal"}, {"source": "../../generators/applicability/ApplicabilityRuleCard", "specifiers": ["ApplicabilityRuleCard"], "category": "internal"}, {"source": "../../generators/applicability/AddRuleButton", "specifiers": ["AddRuleButton"], "category": "internal"}, {"source": "../../generators/applicability/createNewRule", "specifiers": ["createNewRule"], "category": "internal"}, {"source": "../../shared/MutationCard", "specifiers": ["MutationCard", "DEFAULT_MUTATION_TYPES"], "category": "internal"}, {"source": "./ThresholdTriggerTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/validation/cards/index.js::IssueCard", "name": "IssueCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/validation/cards/index.js", "sourceCode": "export function IssueCard({ issue, onItemClick }) {\n  const [expanded, setExpanded] = useState(false);\n  const [, setHovering] = useState(false);\n  const [, setHoveredItem] = useState(null);\n\n  const severityClass =\n    issue.severity === \"error\"\n      ? \"validation-issue-severity validation-status-error\"\n      : \"validation-issue-severity validation-status-warning\";\n\n  const icons = {\n    error: \"\u274c\",\n    warning: \"\u26a0\ufe0f\",\n  };\n\n  return (\n    <div className=\"validation-issue-card\">\n      <div\n        className=\"validation-issue-header\"\n        onClick={() => setExpanded(!expanded)}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n      >\n        <span className=\"validation-issue-icon\">{icons[issue.severity]}</span>\n        <span className=\"validation-issue-title\">{issue.title}</span>\n        <span className=\"validation-issue-count\">{issue.affectedItems.length}</span>\n        <span className={severityClass}>{issue.severity.toUpperCase()}</span>\n        <span\n          className={`validation-issue-expand-icon ${expanded ? \"ic-expand-rotated\" : \"\"}`}\n        >\n          \u25bc\n        </span>\n      </div>\n      {expanded && (\n        <div className=\"validation-issue-content\">\n          <div className=\"validation-issue-message\">{issue.message}</div>\n          <div className=\"validation-affected-items\">\n            {issue.affectedItems.map((item) => (\n              <div key={item.id} className=\"flex-col ic-affected-item-row\">\n                <span\n                  className=\"validation-affected-item\"\n                  title={item.detail}\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    onItemClick?.(item.id);\n                  }}\n                  onMouseEnter={() => setHoveredItem(item.id)}\n                  onMouseLeave={() => setHoveredItem(null)}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  {item.label}\n                </span>\n                {item.detail && <span className=\"validation-detail-row\">{item.detail}</span>}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ issue, onItemClick }", "type": "{ issue: any; onItemClick: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 3}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/validation/cards/IssueCard.jsx::IssueCard", "name": "IssueCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/validation/cards/IssueCard.jsx", "sourceCode": "export function IssueCard({ issue, onItemClick }) {\n  const [expanded, setExpanded] = useState(false);\n  const [, setHovering] = useState(false);\n  const [, setHoveredItem] = useState(null);\n\n  const severityClass =\n    issue.severity === \"error\"\n      ? \"validation-issue-severity validation-status-error\"\n      : \"validation-issue-severity validation-status-warning\";\n\n  const icons = {\n    error: \"\u274c\",\n    warning: \"\u26a0\ufe0f\",\n  };\n\n  return (\n    <div className=\"validation-issue-card\">\n      <div\n        className=\"validation-issue-header\"\n        onClick={() => setExpanded(!expanded)}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n      >\n        <span className=\"validation-issue-icon\">{icons[issue.severity]}</span>\n        <span className=\"validation-issue-title\">{issue.title}</span>\n        <span className=\"validation-issue-count\">{issue.affectedItems.length}</span>\n        <span className={severityClass}>{issue.severity.toUpperCase()}</span>\n        <span\n          className={`validation-issue-expand-icon ${expanded ? \"ic-expand-rotated\" : \"\"}`}\n        >\n          \u25bc\n        </span>\n      </div>\n      {expanded && (\n        <div className=\"validation-issue-content\">\n          <div className=\"validation-issue-message\">{issue.message}</div>\n          <div className=\"validation-affected-items\">\n            {issue.affectedItems.map((item) => (\n              <div key={item.id} className=\"flex-col ic-affected-item-row\">\n                <span\n                  className=\"validation-affected-item\"\n                  title={item.detail}\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    onItemClick?.(item.id);\n                  }}\n                  onMouseEnter={() => setHoveredItem(item.id)}\n                  onMouseLeave={() => setHoveredItem(null)}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  {item.label}\n                </span>\n                {item.detail && <span className=\"validation-detail-row\">{item.detail}</span>}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ issue, onItemClick }", "type": "{ issue: any; onItemClick: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 3}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../validation.css", "specifiers": [], "category": "internal"}, {"source": "./IssueCard.css", "specifiers": [], "category": "internal"}], "storeAccess": []}]