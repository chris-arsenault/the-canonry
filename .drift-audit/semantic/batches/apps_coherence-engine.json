[{"id": "apps/coherence-engine/webui/src/components/ValidationEditor.jsx::ValidationEditor", "name": "ValidationEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/ValidationEditor.jsx", "sourceCode": "export default function ValidationEditor({\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}) {\n  const validationResults = useMemo(\n    () => runValidations(usageMap, schema, eras, pressures, generators, systems),\n    [usageMap, schema, eras, pressures, generators, systems]\n  );\n\n  // Count orphans from usageMap for summary\n  const orphanCounts = useMemo(() => {\n    if (!usageMap?.validation?.orphans)\n      return { generators: 0, systems: 0, pressures: 0, total: 0 };\n    const orphans = usageMap.validation.orphans;\n    const generators = orphans.filter((o) => o.type === \"generator\").length;\n    const systems = orphans.filter((o) => o.type === \"system\").length;\n    const pressures = orphans.filter((o) => o.type === \"pressure\").length;\n    return { generators, systems, pressures, total: generators + systems + pressures };\n  }, [usageMap]);\n\n  const overallStatus = getOverallStatus(validationResults);\n  const totalIssues = validationResults.errors.length + validationResults.warnings.length;\n  const hasNamingProfiles = useMemo(\n    () => (schema.cultures || []).some((culture) => culture.naming?.profiles?.length),\n    [schema]\n  );\n\n  let statusModifier;\n  if (overallStatus === \"clean\") {\n    statusModifier = \"validation-status-clean\";\n  } else if (overallStatus === \"warning\") {\n    statusModifier = \"validation-status-warning\";\n  } else {\n    statusModifier = \"validation-status-error\";\n  }\n  const statusBadgeClass = `validation-status-badge ${statusModifier}`;\n\n  const handleItemClick = (itemId) => {\n    if (onNavigateToGenerator) {\n      onNavigateToGenerator(itemId);\n    }\n  };\n\n  // Count total affected items\n  const totalAffectedItems = [...validationResults.errors, ...validationResults.warnings].reduce(\n    (sum, issue) => sum + issue.affectedItems.length,\n    0\n  );\n\n  return (\n    <div className=\"validation-container\">\n      <div className=\"validation-header\">\n        <div className=\"flex-between items-start\">\n          <div>\n            <h1 className=\"validation-title\">\n              Validation\n              <span className={statusBadgeClass}>\n                {(() => {\n                  if (overallStatus === \"clean\") return \"All Clear\";\n                  const issueWord = totalIssues === 1 ? \"Issue\" : \"Issues\";\n                  return `${totalIssues} ${issueWord}`;\n                })()}\n              </span>\n            </h1>\n            <p className=\"validation-subtitle\">\n              Semantic validation: reference integrity, pressure balance, and dead code detection.\n              Structure validation runs automatically as a gate before simulation.\n            </p>\n          </div>\n          {totalIssues > 0 && (\n            <div className=\"validation-export-row\">\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsJson(validationResults)}\n                title=\"Export validation report as JSON\"\n              >\n                Export JSON\n              </button>\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsCsv(validationResults)}\n                title=\"Export validation report as CSV\"\n              >\n                Export CSV\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"validation-summary-cards validation-summary-cards-4\">\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-danger\">\n            {validationResults.errors.length}\n          </div>\n          <div className=\"validation-summary-label\">Errors</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-warning\">\n            {validationResults.warnings.length}\n          </div>\n          <div className=\"validation-summary-label\">Warnings</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div\n            className={`validation-summary-value ${orphanCounts.total > 0 ? \"text-muted\" : \"text-info\"}`}\n          >\n            {orphanCounts.total}\n          </div>\n          <div className=\"validation-summary-label\">Unused</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-info\">\n            {totalAffectedItems}\n          </div>\n          <div className=\"validation-summary-label\">Affected Items</div>\n        </div>\n      </div>\n\n      {/* Clean state */}\n      {overallStatus === \"clean\" && (\n        <div className=\"validation-clean-state\">\n          <div className=\"validation-clean-icon\">\u2713</div>\n          <div className=\"validation-clean-title\">All Validations Passed</div>\n          <div className=\"validation-clean-message\">\n            Your configuration looks good. No issues detected.\n          </div>\n        </div>\n      )}\n\n      {/* Errors section */}\n      {validationResults.errors.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u274c</span>\n              Errors\n            </div>\n            <span className=\"validation-section-count validation-status-error\">\n              {validationResults.errors.length}\n            </span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.errors.map((error) => (\n              <IssueCard key={error.id} issue={error} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Warnings section */}\n      {validationResults.warnings.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u26a0\ufe0f</span>\n              Warnings\n            </div>\n            <span className=\"validation-section-count\">{validationResults.warnings.length}</span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.warnings.map((warning) => (\n              <IssueCard key={warning.id} issue={warning} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Dependency Viewer */}\n      {usageMap && (\n        <div className=\"mb-2xl\">\n          <DependencyViewer usageMap={usageMap} />\n        </div>\n      )}\n\n      {/* Naming Profile Mappings */}\n      {hasNamingProfiles && (\n        <div className=\"mb-2xl\">\n          <NamingProfileMappingViewer generators={generators} schema={schema} />\n        </div>\n      )}\n\n      {/* Rule info */}\n      <div className=\"validation-rule-info\">\n        <div className=\"validation-rule-title\">\n          Active Validation Rules ({Object.keys(validationRules).length})\n        </div>\n        <ul className=\"validation-rule-list\">\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-danger\">\u25cf</span>\n            <strong>Reference Validation:</strong> Entity kinds (generators, pressures, systems),\n            relationship kinds (generators, pressures, systems), pressure IDs (generators, systems,\n            eras, actions), era\u2192generator/system references\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Balance Validation:</strong> Pressure sources/sinks (feedback, homeostasis,\n            generators, systems), orphan generators/systems (not in any era)\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Configuration Quality:</strong> Subtypes, statuses, cultures, tags, numeric\n            ranges\n          </li>\n        </ul>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}", "type": "{ schema?: Readonly<{ entityKinds: any[]; relationshipKinds: any[]; cultures: any[]; tagRegistry: any[]; }>; eras?: any[]; pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; usageMap?: any; onNavigateToGenerator: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "h1", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "p", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "IssueCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "IssueCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "DependencyViewer", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "NamingProfileMappingViewer", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "ul", "children": [{"tag": "li", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "strong", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "li", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "strong", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "li", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "strong", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 3}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/ActionsEditor.jsx::ActionsEditor", "name": "ActionsEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/ActionsEditor.jsx", "sourceCode": "export default function ActionsEditor({\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"actions:selected\");\n  const {\n    selectedItem: selectedAction,\n    handleItemChange: handleActionChange,\n    handleToggle,\n    handleDelete,\n    handleAdd: handleAddAction,\n    handleSelect,\n    handleClose,\n  } = useEditorState(actions, onChange, { createItem: createAction, persistKey: selectionKey });\n\n  // Collect unique pressures across all actions\n  const uniquePressures = new Set();\n  actions.forEach((action) => {\n    (action.probability?.pressureModifiers || []).forEach((mod) => {\n      if (mod.pressure) uniquePressures.add(mod.pressure);\n    });\n  });\n\n  return (\n    <div className=\"actions-editor\">\n      <div className=\"actions-header\">\n        <h1 className=\"actions-title\">Actions</h1>\n        <p className=\"actions-subtitle\">\n          Actions define what agents can do during the simulation via the universal catalyst system.\n          Click an action to edit.\n        </p>\n        <div className=\"actions-stats\">\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Total Actions</span>\n            <span className=\"actions-stat-value\">{actions.length}</span>\n          </div>\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Pressures Referenced</span>\n            <span className=\"actions-stat-value\">{uniquePressures.size}</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"actions-grid\">\n        {actions.map((action, index) => (\n          <ActionListCard\n            key={action.id}\n            action={action}\n            onClick={() => handleSelect(index)}\n            onToggle={() => handleToggle(action)}\n            usageMap={usageMap}\n          />\n        ))}\n\n        <div className=\"actions-add-card\" onClick={() => handleAddAction()} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n          <span className=\"text-2xl\">+</span>\n          <span>Add Action</span>\n        </div>\n      </div>\n\n      {selectedAction && (\n        <ActionModal\n          action={selectedAction}\n          onChange={handleActionChange}\n          onClose={handleClose}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; actions?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "h1", "children": [], "isMap": false, "isConditional": false}, {"tag": "p", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ActionListCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ActionModal", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useEditorState", "count": 1}], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../shared", "specifiers": ["useEditorState"], "category": "internal"}, {"source": "../../utils/persistence", "specifiers": ["buildStorageKey"], "category": "internal"}, {"source": "./cards", "specifiers": ["ActionListCard"], "category": "internal"}, {"source": "./modals", "specifiers": ["ActionModal"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/index.js::ActionsEditor", "name": "ActionsEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/index.js", "sourceCode": "export default function ActionsEditor({\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"actions:selected\");\n  const {\n    selectedItem: selectedAction,\n    handleItemChange: handleActionChange,\n    handleToggle,\n    handleDelete,\n    handleAdd: handleAddAction,\n    handleSelect,\n    handleClose,\n  } = useEditorState(actions, onChange, { createItem: createAction, persistKey: selectionKey });\n\n  // Collect unique pressures across all actions\n  const uniquePressures = new Set();\n  actions.forEach((action) => {\n    (action.probability?.pressureModifiers || []).forEach((mod) => {\n      if (mod.pressure) uniquePressures.add(mod.pressure);\n    });\n  });\n\n  return (\n    <div className=\"actions-editor\">\n      <div className=\"actions-header\">\n        <h1 className=\"actions-title\">Actions</h1>\n        <p className=\"actions-subtitle\">\n          Actions define what agents can do during the simulation via the universal catalyst system.\n          Click an action to edit.\n        </p>\n        <div className=\"actions-stats\">\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Total Actions</span>\n            <span className=\"actions-stat-value\">{actions.length}</span>\n          </div>\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Pressures Referenced</span>\n            <span className=\"actions-stat-value\">{uniquePressures.size}</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"actions-grid\">\n        {actions.map((action, index) => (\n          <ActionListCard\n            key={action.id}\n            action={action}\n            onClick={() => handleSelect(index)}\n            onToggle={() => handleToggle(action)}\n            usageMap={usageMap}\n          />\n        ))}\n\n        <div className=\"actions-add-card\" onClick={() => handleAddAction()} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n          <span className=\"text-2xl\">+</span>\n          <span>Add Action</span>\n        </div>\n      </div>\n\n      {selectedAction && (\n        <ActionModal\n          action={selectedAction}\n          onChange={handleActionChange}\n          onClose={handleClose}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; actions?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "h1", "children": [], "isMap": false, "isConditional": false}, {"tag": "p", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ActionListCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ActionModal", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useEditorState", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/causal-loop/CausalLoopEditor.jsx::CausalLoopEditor", "name": "CausalLoopEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/causal-loop/CausalLoopEditor.jsx", "sourceCode": "export default function CausalLoopEditor({\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}) {\n  const containerRef = useRef(null);\n  const graphRef = useRef(null);\n  const [dimensions, setDimensions] = useState({ width: 800, height: 600 });\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [showLegend, setShowLegend] = useState(true);\n  const [showDisabled, setShowDisabled] = useState(true);\n  const [hoverNode, setHoverNode] = useState(null);\n\n  // Resize observer\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const updateDimensions = () => {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDimensions({\n        width: rect.width || 800,\n        height: Math.max(500, window.innerHeight - rect.top - 100),\n      });\n    };\n\n    updateDimensions();\n    const observer = new ResizeObserver(updateDimensions);\n    observer.observe(containerRef.current);\n    window.addEventListener(\"resize\", updateDimensions);\n\n    return () => {\n      observer.disconnect();\n      window.removeEventListener(\"resize\", updateDimensions);\n    };\n  }, []);\n\n  // Extract graph data\n  const {\n    nodes: graphNodes,\n    links: graphLinks,\n    warnings,\n  } = useMemo(\n    () =>\n      extractCausalGraph(pressures, generators, systems, actions, schema, showDisabled, usageMap),\n    [pressures, generators, systems, actions, schema, showDisabled, usageMap]\n  );\n  const graphData = useMemo(\n    () => ({ nodes: graphNodes, links: graphLinks }),\n    [graphNodes, graphLinks]\n  );\n\n  // Count disabled nodes for UI\n  const disabledCount = useMemo(() => {\n    const allNodes = extractCausalGraph(\n      pressures,\n      generators,\n      systems,\n      actions,\n      schema,\n      true,\n      usageMap\n    ).nodes;\n    return allNodes.filter((n) => n.isDisabled).length;\n  }, [pressures, generators, systems, actions, schema, usageMap]);\n\n  // Detect loops\n  const loops = useMemo(() => detectLoops(graphData.nodes, graphData.links), [graphData]);\n\n  const reinforcingLoops = loops.filter((l) => l.type === \"reinforcing\");\n  const balancingLoops = loops.filter((l) => l.type === \"balancing\");\n\n  // Node styling\n  const nodeCanvasObject = useCallback(\n    (node, ctx, globalScale) => {\n      const label = node.label;\n      const fontSize = Math.max(10 / globalScale, 3);\n      const abbrevFontSize = Math.max(8 / globalScale, 3);\n      const nodeRadius = Math.sqrt(node.val) * 3;\n      const isDisabled = node.isDisabled;\n\n      // Draw node circle with opacity for disabled\n      ctx.beginPath();\n      ctx.arc(node.x, node.y, nodeRadius, 0, 2 * Math.PI);\n      ctx.fillStyle = isDisabled ? `${node.color}60` : node.color;\n      ctx.fill();\n\n      // Strikethrough pattern for disabled nodes\n      if (isDisabled) {\n        ctx.strokeStyle = \"#64748b\";\n        ctx.lineWidth = 1 / globalScale;\n        ctx.setLineDash([2 / globalScale, 2 / globalScale]);\n        ctx.stroke();\n        ctx.setLineDash([]);\n      }\n\n      // Highlight selected/hovered\n      if (selectedNode === node.id || hoverNode === node.id) {\n        ctx.strokeStyle = \"#ffffff\";\n        ctx.lineWidth = 2 / globalScale;\n        ctx.stroke();\n      }\n\n      // Draw abbreviation inside node\n      ctx.font = `bold ${abbrevFontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"middle\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#0a1929\";\n      ctx.fillText(node.abbrev || \"?\", node.x, node.y);\n\n      // Draw label below node\n      ctx.font = `${fontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"top\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#e2e8f0\";\n      const displayLabel = label.length > 15 ? label.slice(0, 13) + \"...\" : label;\n      ctx.fillText(displayLabel, node.x, node.y + nodeRadius + 2);\n    },\n    [selectedNode, hoverNode]\n  );\n\n  // Link styling\n  const linkColor = useCallback((link) => {\n    return EDGE_COLORS[link.polarity] || EDGE_COLORS.neutral;\n  }, []);\n\n  const linkWidth = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? 1 : 2;\n  }, []);\n\n  const linkLineDash = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? [4, 4] : [];\n  }, []);\n\n  // Handle node click\n  const handleNodeClick = useCallback(\n    (node) => {\n      setSelectedNode(selectedNode === node.id ? null : node.id);\n    },\n    [selectedNode]\n  );\n\n  // Zoom to fit on load\n  useEffect(() => {\n    if (graphRef.current && graphData.nodes.length > 0) {\n      setTimeout(() => {\n        graphRef.current.zoomToFit(400, 60);\n      }, 500);\n    }\n  }, [graphData.nodes.length]);\n\n  const selectedNodeData = selectedNode ? graphData.nodes.find((n) => n.id === selectedNode) : null;\n\n  // Get edges for selected node\n  const selectedNodeEdges = useMemo(() => {\n    if (!selectedNode) return { incoming: [], outgoing: [] };\n    return {\n      incoming: graphData.links.filter((l) => {\n        const targetId = typeof l.target === \"object\" ? l.target.id : l.target;\n        return targetId === selectedNode;\n      }),\n      outgoing: graphData.links.filter((l) => {\n        const sourceId = typeof l.source === \"object\" ? l.source.id : l.source;\n        return sourceId === selectedNode;\n      }),\n    };\n  }, [selectedNode, graphData.links]);\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Causal Loop Diagram</h1>\n        <p className=\"subtitle\">\n          Visualize feedback loops between pressures, generators, systems, and entity kinds.\n          {loops.length > 0 && (\n            <span className=\"cl-loop-count\">\n              <span className=\"cl-loop-reinforcing\">{reinforcingLoops.length} reinforcing</span>\n              {\" / \"}\n              <span className=\"cl-loop-balancing\">{balancingLoops.length} balancing</span>\n              {\" loops detected\"}\n            </span>\n          )}\n        </p>\n      </div>\n\n      <div className=\"cl-toolbar\">\n        <button className=\"button-secondary\" onClick={() => setShowLegend(!showLegend)}>\n          {showLegend ? \"Hide\" : \"Show\"} Legend\n        </button>\n        {disabledCount > 0 && (\n          <button\n            className=\"button-secondary\"\n            onClick={() => setShowDisabled(!showDisabled)}\n            // eslint-disable-next-line local/no-inline-styles -- dynamic opacity toggle\n            style={{ opacity: showDisabled ? 1 : 0.7 }}\n          >\n            {showDisabled ? \"Hide\" : \"Show\"} Disabled ({disabledCount})\n          </button>\n        )}\n        <button className=\"button-secondary\" onClick={() => graphRef.current?.zoomToFit(400, 60)}>\n          Fit to View\n        </button>\n        <div className=\"cl-stats\">\n          <span>{graphData.nodes.length} nodes</span>\n          <span>{graphData.links.length} edges</span>\n          {warnings.length > 0 && (\n            <span className=\"cl-stats-warning\">{warnings.length} warnings</span>\n          )}\n          <span className=\"cl-stats-hint\">Scroll to zoom, drag to pan</span>\n        </div>\n      </div>\n\n      {/* Warnings */}\n      {warnings.length > 0 && (\n        <div className=\"cl-warnings-box\">\n          <div className=\"cl-warnings-title\">\n            Referential Integrity Warnings\n          </div>\n          <div className=\"cl-warnings-list\">\n            {warnings.slice(0, 5).map((w, i) => (\n              <div key={i}>{w.message}</div>\n            ))}\n            {warnings.length > 5 && (\n              <div className=\"cl-warnings-more\">\n                ...and {warnings.length - 5} more warnings\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Legend */}\n      {showLegend && (\n        <div className=\"cl-legend\">\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Nodes:</span>\n            {Object.entries(NODE_TYPES).map(([type, config]) => (\n              <span key={type} className=\"cl-legend-item\">\n                <span\n                  className=\"cl-legend-node\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per node type\n                  style={{ '--cl-node-color': config.color, backgroundColor: 'var(--cl-node-color)' }}\n                >\n                  {config.abbrev}\n                </span>\n                <span className=\"cl-legend-node-label\">{config.label}</span>\n              </span>\n            ))}\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Edges:</span>\n            <span className=\"cl-legend-item cl-edge-positive\">+ Positive</span>\n            <span className=\"cl-legend-item cl-edge-negative\">- Negative</span>\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Loops:</span>\n            <span className=\"cl-legend-item cl-loop-reinforcing\">Reinforcing (unstable)</span>\n            <span className=\"cl-legend-item cl-loop-balancing\">Balancing (stable)</span>\n          </div>\n        </div>\n      )}\n\n      {/* Graph container */}\n      <div ref={containerRef} className=\"cl-graph-container\">\n        {graphData.nodes.length === 0 ? (\n          <div className=\"cl-empty-state\">\n            <div className=\"cl-empty-icon\">&#128260;</div>\n            <div className=\"cl-empty-title\">\n              No causal relationships found\n            </div>\n            <div className=\"cl-empty-desc\">\n              Add pressures with feedback factors, generators with state updates, or systems with\n              pressure changes to see the causal loop diagram.\n            </div>\n          </div>\n        ) : (\n          <ForceGraph2D\n            ref={graphRef}\n            graphData={graphData}\n            width={dimensions.width}\n            height={dimensions.height}\n            backgroundColor=\"#0f172a\"\n            nodeCanvasObject={nodeCanvasObject}\n            nodePointerAreaPaint={(node, color, ctx) => {\n              const nodeRadius = Math.sqrt(node.val) * 3;\n              ctx.beginPath();\n              ctx.arc(node.x, node.y, nodeRadius + 5, 0, 2 * Math.PI);\n              ctx.fillStyle = color;\n              ctx.fill();\n            }}\n            linkColor={linkColor}\n            linkWidth={linkWidth}\n            linkLineDash={linkLineDash}\n            linkDirectionalArrowLength={6}\n            linkDirectionalArrowRelPos={0.9}\n            linkCurvature={0.2}\n            onNodeClick={handleNodeClick}\n            onNodeHover={(node) => setHoverNode(node?.id || null)}\n// ... (truncated)", "parameters": [{"name": "{\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}", "type": "{ pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; schema?: {}; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "h1", "children": [], "isMap": false, "isConditional": false}, {"tag": "p", "children": [{"tag": "span", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "ForceGraph2D", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "h3", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useRef", "count": 2}, {"name": "useState", "count": 5}, {"name": "useEffect", "count": 2}, {"name": "useMemo", "count": 5}, {"name": "useCallback", "count": 5}], "imports": [{"source": "react", "specifiers": ["React", "useMemo", "useState", "useRef", "useCallback", "useEffect"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "react-force-graph-2d", "specifiers": ["ForceGraph2D"], "category": "external"}, {"source": "./CausalLoopEditor.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/causal-loop/index.js::CausalLoopEditor", "name": "CausalLoopEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/causal-loop/index.js", "sourceCode": "export default function CausalLoopEditor({\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}) {\n  const containerRef = useRef(null);\n  const graphRef = useRef(null);\n  const [dimensions, setDimensions] = useState({ width: 800, height: 600 });\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [showLegend, setShowLegend] = useState(true);\n  const [showDisabled, setShowDisabled] = useState(true);\n  const [hoverNode, setHoverNode] = useState(null);\n\n  // Resize observer\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const updateDimensions = () => {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDimensions({\n        width: rect.width || 800,\n        height: Math.max(500, window.innerHeight - rect.top - 100),\n      });\n    };\n\n    updateDimensions();\n    const observer = new ResizeObserver(updateDimensions);\n    observer.observe(containerRef.current);\n    window.addEventListener(\"resize\", updateDimensions);\n\n    return () => {\n      observer.disconnect();\n      window.removeEventListener(\"resize\", updateDimensions);\n    };\n  }, []);\n\n  // Extract graph data\n  const {\n    nodes: graphNodes,\n    links: graphLinks,\n    warnings,\n  } = useMemo(\n    () =>\n      extractCausalGraph(pressures, generators, systems, actions, schema, showDisabled, usageMap),\n    [pressures, generators, systems, actions, schema, showDisabled, usageMap]\n  );\n  const graphData = useMemo(\n    () => ({ nodes: graphNodes, links: graphLinks }),\n    [graphNodes, graphLinks]\n  );\n\n  // Count disabled nodes for UI\n  const disabledCount = useMemo(() => {\n    const allNodes = extractCausalGraph(\n      pressures,\n      generators,\n      systems,\n      actions,\n      schema,\n      true,\n      usageMap\n    ).nodes;\n    return allNodes.filter((n) => n.isDisabled).length;\n  }, [pressures, generators, systems, actions, schema, usageMap]);\n\n  // Detect loops\n  const loops = useMemo(() => detectLoops(graphData.nodes, graphData.links), [graphData]);\n\n  const reinforcingLoops = loops.filter((l) => l.type === \"reinforcing\");\n  const balancingLoops = loops.filter((l) => l.type === \"balancing\");\n\n  // Node styling\n  const nodeCanvasObject = useCallback(\n    (node, ctx, globalScale) => {\n      const label = node.label;\n      const fontSize = Math.max(10 / globalScale, 3);\n      const abbrevFontSize = Math.max(8 / globalScale, 3);\n      const nodeRadius = Math.sqrt(node.val) * 3;\n      const isDisabled = node.isDisabled;\n\n      // Draw node circle with opacity for disabled\n      ctx.beginPath();\n      ctx.arc(node.x, node.y, nodeRadius, 0, 2 * Math.PI);\n      ctx.fillStyle = isDisabled ? `${node.color}60` : node.color;\n      ctx.fill();\n\n      // Strikethrough pattern for disabled nodes\n      if (isDisabled) {\n        ctx.strokeStyle = \"#64748b\";\n        ctx.lineWidth = 1 / globalScale;\n        ctx.setLineDash([2 / globalScale, 2 / globalScale]);\n        ctx.stroke();\n        ctx.setLineDash([]);\n      }\n\n      // Highlight selected/hovered\n      if (selectedNode === node.id || hoverNode === node.id) {\n        ctx.strokeStyle = \"#ffffff\";\n        ctx.lineWidth = 2 / globalScale;\n        ctx.stroke();\n      }\n\n      // Draw abbreviation inside node\n      ctx.font = `bold ${abbrevFontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"middle\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#0a1929\";\n      ctx.fillText(node.abbrev || \"?\", node.x, node.y);\n\n      // Draw label below node\n      ctx.font = `${fontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"top\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#e2e8f0\";\n      const displayLabel = label.length > 15 ? label.slice(0, 13) + \"...\" : label;\n      ctx.fillText(displayLabel, node.x, node.y + nodeRadius + 2);\n    },\n    [selectedNode, hoverNode]\n  );\n\n  // Link styling\n  const linkColor = useCallback((link) => {\n    return EDGE_COLORS[link.polarity] || EDGE_COLORS.neutral;\n  }, []);\n\n  const linkWidth = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? 1 : 2;\n  }, []);\n\n  const linkLineDash = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? [4, 4] : [];\n  }, []);\n\n  // Handle node click\n  const handleNodeClick = useCallback(\n    (node) => {\n      setSelectedNode(selectedNode === node.id ? null : node.id);\n    },\n    [selectedNode]\n  );\n\n  // Zoom to fit on load\n  useEffect(() => {\n    if (graphRef.current && graphData.nodes.length > 0) {\n      setTimeout(() => {\n        graphRef.current.zoomToFit(400, 60);\n      }, 500);\n    }\n  }, [graphData.nodes.length]);\n\n  const selectedNodeData = selectedNode ? graphData.nodes.find((n) => n.id === selectedNode) : null;\n\n  // Get edges for selected node\n  const selectedNodeEdges = useMemo(() => {\n    if (!selectedNode) return { incoming: [], outgoing: [] };\n    return {\n      incoming: graphData.links.filter((l) => {\n        const targetId = typeof l.target === \"object\" ? l.target.id : l.target;\n        return targetId === selectedNode;\n      }),\n      outgoing: graphData.links.filter((l) => {\n        const sourceId = typeof l.source === \"object\" ? l.source.id : l.source;\n        return sourceId === selectedNode;\n      }),\n    };\n  }, [selectedNode, graphData.links]);\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Causal Loop Diagram</h1>\n        <p className=\"subtitle\">\n          Visualize feedback loops between pressures, generators, systems, and entity kinds.\n          {loops.length > 0 && (\n            <span className=\"cl-loop-count\">\n              <span className=\"cl-loop-reinforcing\">{reinforcingLoops.length} reinforcing</span>\n              {\" / \"}\n              <span className=\"cl-loop-balancing\">{balancingLoops.length} balancing</span>\n              {\" loops detected\"}\n            </span>\n          )}\n        </p>\n      </div>\n\n      <div className=\"cl-toolbar\">\n        <button className=\"button-secondary\" onClick={() => setShowLegend(!showLegend)}>\n          {showLegend ? \"Hide\" : \"Show\"} Legend\n        </button>\n        {disabledCount > 0 && (\n          <button\n            className=\"button-secondary\"\n            onClick={() => setShowDisabled(!showDisabled)}\n            // eslint-disable-next-line local/no-inline-styles -- dynamic opacity toggle\n            style={{ opacity: showDisabled ? 1 : 0.7 }}\n          >\n            {showDisabled ? \"Hide\" : \"Show\"} Disabled ({disabledCount})\n          </button>\n        )}\n        <button className=\"button-secondary\" onClick={() => graphRef.current?.zoomToFit(400, 60)}>\n          Fit to View\n        </button>\n        <div className=\"cl-stats\">\n          <span>{graphData.nodes.length} nodes</span>\n          <span>{graphData.links.length} edges</span>\n          {warnings.length > 0 && (\n            <span className=\"cl-stats-warning\">{warnings.length} warnings</span>\n          )}\n          <span className=\"cl-stats-hint\">Scroll to zoom, drag to pan</span>\n        </div>\n      </div>\n\n      {/* Warnings */}\n      {warnings.length > 0 && (\n        <div className=\"cl-warnings-box\">\n          <div className=\"cl-warnings-title\">\n            Referential Integrity Warnings\n          </div>\n          <div className=\"cl-warnings-list\">\n            {warnings.slice(0, 5).map((w, i) => (\n              <div key={i}>{w.message}</div>\n            ))}\n            {warnings.length > 5 && (\n              <div className=\"cl-warnings-more\">\n                ...and {warnings.length - 5} more warnings\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Legend */}\n      {showLegend && (\n        <div className=\"cl-legend\">\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Nodes:</span>\n            {Object.entries(NODE_TYPES).map(([type, config]) => (\n              <span key={type} className=\"cl-legend-item\">\n                <span\n                  className=\"cl-legend-node\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per node type\n                  style={{ '--cl-node-color': config.color, backgroundColor: 'var(--cl-node-color)' }}\n                >\n                  {config.abbrev}\n                </span>\n                <span className=\"cl-legend-node-label\">{config.label}</span>\n              </span>\n            ))}\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Edges:</span>\n            <span className=\"cl-legend-item cl-edge-positive\">+ Positive</span>\n            <span className=\"cl-legend-item cl-edge-negative\">- Negative</span>\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Loops:</span>\n            <span className=\"cl-legend-item cl-loop-reinforcing\">Reinforcing (unstable)</span>\n            <span className=\"cl-legend-item cl-loop-balancing\">Balancing (stable)</span>\n          </div>\n        </div>\n      )}\n\n      {/* Graph container */}\n      <div ref={containerRef} className=\"cl-graph-container\">\n        {graphData.nodes.length === 0 ? (\n          <div className=\"cl-empty-state\">\n            <div className=\"cl-empty-icon\">&#128260;</div>\n            <div className=\"cl-empty-title\">\n              No causal relationships found\n            </div>\n            <div className=\"cl-empty-desc\">\n              Add pressures with feedback factors, generators with state updates, or systems with\n              pressure changes to see the causal loop diagram.\n            </div>\n          </div>\n        ) : (\n          <ForceGraph2D\n            ref={graphRef}\n            graphData={graphData}\n            width={dimensions.width}\n            height={dimensions.height}\n            backgroundColor=\"#0f172a\"\n            nodeCanvasObject={nodeCanvasObject}\n            nodePointerAreaPaint={(node, color, ctx) => {\n              const nodeRadius = Math.sqrt(node.val) * 3;\n              ctx.beginPath();\n              ctx.arc(node.x, node.y, nodeRadius + 5, 0, 2 * Math.PI);\n              ctx.fillStyle = color;\n              ctx.fill();\n            }}\n            linkColor={linkColor}\n            linkWidth={linkWidth}\n            linkLineDash={linkLineDash}\n            linkDirectionalArrowLength={6}\n            linkDirectionalArrowRelPos={0.9}\n            linkCurvature={0.2}\n            onNodeClick={handleNodeClick}\n            onNodeHover={(node) => setHoverNode(node?.id || null)}\n// ... (truncated)", "parameters": [{"name": "{\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}", "type": "{ pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; schema?: {}; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "h1", "children": [], "isMap": false, "isConditional": false}, {"tag": "p", "children": [{"tag": "span", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "ForceGraph2D", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "h3", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useRef", "count": 2}, {"name": "useState", "count": 5}, {"name": "useEffect", "count": 2}, {"name": "useMemo", "count": 5}, {"name": "useCallback", "count": 5}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/DependencyViewer.jsx::DependencyViewer", "name": "DependencyViewer", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/DependencyViewer.jsx", "sourceCode": "export default function DependencyViewer({ usageMap }) {\n  // Prepare entity kinds data\n  const entityKindsData = useMemo(() => {\n    if (!usageMap?.entityKinds) return [];\n    return Object.entries(usageMap.entityKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare relationship kinds data\n  const relationshipKindsData = useMemo(() => {\n    if (!usageMap?.relationshipKinds) return [];\n    return Object.entries(usageMap.relationshipKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare pressures data\n  const pressuresData = useMemo(() => {\n    if (!usageMap?.pressures) return [];\n    return Object.entries(usageMap.pressures)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare generators data\n  const generatorsData = useMemo(() => {\n    if (!usageMap?.generators) return [];\n    return Object.entries(usageMap.generators)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare systems data\n  const systemsData = useMemo(() => {\n    if (!usageMap?.systems) return [];\n    return Object.entries(usageMap.systems)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare tags data\n  const tagsData = useMemo(() => {\n    if (!usageMap?.tags) return [];\n    return Object.entries(usageMap.tags)\n      .map(([tag, usage]) => ({\n        id: tag,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  if (!usageMap) {\n    return (\n      <div className=\"dependency-viewer-container\">\n        <div className=\"dependency-empty-state\">Loading dependency data...</div>\n      </div>\n    );\n  }\n\n  const renderSchemaItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      <UsageBadges usage={item.usage} />\n    </div>\n  );\n\n  const renderEraItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      {item.eraCount > 0 ? (\n        <div className=\"dependency-used-by-list\">\n          <span className=\"dependency-badge dependency-badge-era\">\n            {item.eraCount} era{item.eraCount !== 1 ? \"s\" : \"\"}\n          </span>\n        </div>\n      ) : (\n        <span className=\"dependency-orphan-badge\">Not in any era</span>\n      )}\n    </div>\n  );\n\n  return (\n    <div className=\"dependency-viewer-container\">\n      <div className=\"dependency-viewer-header\">\n        <div className=\"dependency-viewer-title\">\n          <span>\ud83d\udd17</span>\n          <span>Dependencies</span>\n        </div>\n        <div className=\"dependency-viewer-legend\">\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-generators\" />\n            <span>Generators</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-systems\" />\n            <span>Systems</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-actions\" />\n            <span>Actions</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-eras\" />\n            <span>Eras</span>\n          </div>\n        </div>\n      </div>\n\n      <DependencySection\n        title=\"Entity Kinds\"\n        icon=\"\ud83d\udce6\"\n        items={entityKindsData}\n        renderItem={renderSchemaItem}\n        defaultExpanded={true}\n      />\n\n      <DependencySection\n        title=\"Relationship Kinds\"\n        icon=\"\ud83d\udd17\"\n        items={relationshipKindsData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection title=\"Tags\" icon=\"\ud83c\udff7\ufe0f\" items={tagsData} renderItem={renderSchemaItem} />\n\n      <DependencySection\n        title=\"Pressures\"\n        icon=\"\ud83d\udcca\"\n        items={pressuresData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection\n        title=\"Generators \u2192 Eras\"\n        icon=\"\u2728\"\n        items={generatorsData}\n        renderItem={renderEraItem}\n      />\n\n      <DependencySection\n        title=\"Systems \u2192 Eras\"\n        icon=\"\u2699\ufe0f\"\n        items={systemsData}\n        renderItem={renderEraItem}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{ usageMap }", "type": "{ usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 6}], "imports": [{"source": "react", "specifiers": ["React", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./dependency-viewer.css", "specifiers": [], "category": "internal"}, {"source": "./components", "specifiers": ["DependencySection", "UsageBadges"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/index.js::DependencyViewer", "name": "DependencyViewer", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/index.js", "sourceCode": "export default function DependencyViewer({ usageMap }) {\n  // Prepare entity kinds data\n  const entityKindsData = useMemo(() => {\n    if (!usageMap?.entityKinds) return [];\n    return Object.entries(usageMap.entityKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare relationship kinds data\n  const relationshipKindsData = useMemo(() => {\n    if (!usageMap?.relationshipKinds) return [];\n    return Object.entries(usageMap.relationshipKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare pressures data\n  const pressuresData = useMemo(() => {\n    if (!usageMap?.pressures) return [];\n    return Object.entries(usageMap.pressures)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare generators data\n  const generatorsData = useMemo(() => {\n    if (!usageMap?.generators) return [];\n    return Object.entries(usageMap.generators)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare systems data\n  const systemsData = useMemo(() => {\n    if (!usageMap?.systems) return [];\n    return Object.entries(usageMap.systems)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare tags data\n  const tagsData = useMemo(() => {\n    if (!usageMap?.tags) return [];\n    return Object.entries(usageMap.tags)\n      .map(([tag, usage]) => ({\n        id: tag,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  if (!usageMap) {\n    return (\n      <div className=\"dependency-viewer-container\">\n        <div className=\"dependency-empty-state\">Loading dependency data...</div>\n      </div>\n    );\n  }\n\n  const renderSchemaItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      <UsageBadges usage={item.usage} />\n    </div>\n  );\n\n  const renderEraItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      {item.eraCount > 0 ? (\n        <div className=\"dependency-used-by-list\">\n          <span className=\"dependency-badge dependency-badge-era\">\n            {item.eraCount} era{item.eraCount !== 1 ? \"s\" : \"\"}\n          </span>\n        </div>\n      ) : (\n        <span className=\"dependency-orphan-badge\">Not in any era</span>\n      )}\n    </div>\n  );\n\n  return (\n    <div className=\"dependency-viewer-container\">\n      <div className=\"dependency-viewer-header\">\n        <div className=\"dependency-viewer-title\">\n          <span>\ud83d\udd17</span>\n          <span>Dependencies</span>\n        </div>\n        <div className=\"dependency-viewer-legend\">\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-generators\" />\n            <span>Generators</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-systems\" />\n            <span>Systems</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-actions\" />\n            <span>Actions</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-eras\" />\n            <span>Eras</span>\n          </div>\n        </div>\n      </div>\n\n      <DependencySection\n        title=\"Entity Kinds\"\n        icon=\"\ud83d\udce6\"\n        items={entityKindsData}\n        renderItem={renderSchemaItem}\n        defaultExpanded={true}\n      />\n\n      <DependencySection\n        title=\"Relationship Kinds\"\n        icon=\"\ud83d\udd17\"\n        items={relationshipKindsData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection title=\"Tags\" icon=\"\ud83c\udff7\ufe0f\" items={tagsData} renderItem={renderSchemaItem} />\n\n      <DependencySection\n        title=\"Pressures\"\n        icon=\"\ud83d\udcca\"\n        items={pressuresData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection\n        title=\"Generators \u2192 Eras\"\n        icon=\"\u2728\"\n        items={generatorsData}\n        renderItem={renderEraItem}\n      />\n\n      <DependencySection\n        title=\"Systems \u2192 Eras\"\n        icon=\"\u2699\ufe0f\"\n        items={systemsData}\n        renderItem={renderEraItem}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{ usageMap }", "type": "{ usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 6}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/EraCard.jsx::EraCard", "name": "EraCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/EraCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.era - The era object\n * @param {boolean} props.expanded - Whether the card is expanded\n * @param {Function} props.onToggle - Called to toggle expansion\n * @param {Function} props.onChange - Called when era changes\n * @param {Function} props.onDelete - Called to delete the era\n * @param {Array} props.pressures - Available pressures\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.allEras - All eras for nextEra selection\n */\nexport function EraCard({\n  era,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  pressures,\n  schema,\n  allEras,\n}) {\n  const [, setHovering] = useState(false);\n\n  // Field change handler\n  const handleFieldChange = useCallback(\n    (field, value) => {\n      onChange({ ...era, [field]: value });\n    },\n    [era, onChange]\n  );\n\n  // Entry condition handlers\n  const handleAddEntryCondition = useCallback(() => {\n    const newRule = createNewRule(\"pressure\", pressures);\n    onChange({\n      ...era,\n      entryConditions: [...(era.entryConditions || []), newRule],\n    });\n  }, [era, onChange, pressures]);\n\n  const handleUpdateEntryCondition = useCallback(\n    (index, updated) => {\n      const newConditions = [...(era.entryConditions || [])];\n      newConditions[index] = updated;\n      onChange({ ...era, entryConditions: newConditions });\n    },\n    [era, onChange]\n  );\n\n  const handleRemoveEntryCondition = useCallback(\n    (index) => {\n      onChange({\n        ...era,\n        entryConditions: (era.entryConditions || []).filter((_, i) => i !== index),\n      });\n    },\n    [era, onChange]\n  );\n\n  // Exit condition handlers\n  const handleAddExitCondition = useCallback(() => {\n    const newRule = createNewRule(\"growth_phases_complete\", pressures);\n    onChange({\n      ...era,\n      exitConditions: [...(era.exitConditions || []), newRule],\n    });\n  }, [era, onChange, pressures]);\n\n  const handleUpdateExitCondition = useCallback(\n    (index, updated) => {\n      const newConditions = [...(era.exitConditions || [])];\n      newConditions[index] = updated;\n      onChange({ ...era, exitConditions: newConditions });\n    },\n    [era, onChange]\n  );\n\n  const handleRemoveExitCondition = useCallback(\n    (index) => {\n      onChange({\n        ...era,\n        exitConditions: (era.exitConditions || []).filter((_, i) => i !== index),\n      });\n    },\n    [era, onChange]\n  );\n\n  const updateEffectMutations = useCallback(\n    (key, nextMutations) => {\n      onChange({\n        ...era,\n        [key]: { ...(era[key] || {}), mutations: nextMutations },\n      });\n    },\n    [era, onChange]\n  );\n\n  // Entry effect handlers\n  const handleAddEntryEffect = useCallback(\n    (pressureId) => {\n      const existing = era.entryEffects?.mutations || [];\n      const hasExisting = existing.some(\n        (m) => m.type === \"modify_pressure\" && m.pressureId === pressureId\n      );\n      if (hasExisting) return;\n      updateEffectMutations(\"entryEffects\", [\n        ...existing,\n        { type: \"modify_pressure\", pressureId, delta: 10 },\n      ]);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleUpdateEntryEffect = useCallback(\n    (pressureId, value) => {\n      const existing = era.entryEffects?.mutations || [];\n      const next = existing.map((mutation) =>\n        mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId\n          ? { ...mutation, delta: value }\n          : mutation\n      );\n      updateEffectMutations(\"entryEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleRemoveEntryEffect = useCallback(\n    (pressureId) => {\n      const existing = era.entryEffects?.mutations || [];\n      const next = existing.filter(\n        (mutation) => !(mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId)\n      );\n      updateEffectMutations(\"entryEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  // Exit effect handlers\n  const handleAddExitEffect = useCallback(\n    (pressureId) => {\n      const existing = era.exitEffects?.mutations || [];\n      const hasExisting = existing.some(\n        (m) => m.type === \"modify_pressure\" && m.pressureId === pressureId\n      );\n      if (hasExisting) return;\n      updateEffectMutations(\"exitEffects\", [\n        ...existing,\n        { type: \"modify_pressure\", pressureId, delta: 10 },\n      ]);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleUpdateExitEffect = useCallback(\n    (pressureId, value) => {\n      const existing = era.exitEffects?.mutations || [];\n      const next = existing.map((mutation) =>\n        mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId\n          ? { ...mutation, delta: value }\n          : mutation\n      );\n      updateEffectMutations(\"exitEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleRemoveExitEffect = useCallback(\n    (pressureId) => {\n      const existing = era.exitEffects?.mutations || [];\n      const next = existing.filter(\n        (mutation) => !(mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId)\n      );\n      updateEffectMutations(\"exitEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const entryMutations = useMemo(\n    () => (era.entryEffects?.mutations || []).filter((m) => m.type === \"modify_pressure\"),\n    [era.entryEffects]\n  );\n  const exitMutations = useMemo(\n    () => (era.exitEffects?.mutations || []).filter((m) => m.type === \"modify_pressure\"),\n    [era.exitEffects]\n  );\n\n  const availablePressuresForEntry = useMemo(() => {\n    const currentIds = new Set(entryMutations.map((mutation) => mutation.pressureId));\n    return (pressures || [])\n      .filter((p) => !currentIds.has(p.id))\n      .map((p) => ({ id: p.id, name: p.name || p.id }));\n  }, [pressures, entryMutations]);\n\n  const availablePressuresForExit = useMemo(() => {\n    const currentIds = new Set(exitMutations.map((mutation) => mutation.pressureId));\n    return (pressures || [])\n      .filter((p) => !currentIds.has(p.id))\n      .map((p) => ({ id: p.id, name: p.name || p.id }));\n  }, [pressures, exitMutations]);\n\n  // Counts\n  const entryConditions = era.entryConditions || [];\n  const exitConditions = era.exitConditions || [];\n  const entryPressureChanges = entryMutations.map((mutation) => [\n    mutation.pressureId,\n    mutation.delta,\n  ]);\n  const exitPressureChanges = exitMutations.map((mutation) => [\n    mutation.pressureId,\n    mutation.delta,\n  ]);\n\n  return (\n    <div className=\"expandable-card\">\n      {/* Header */}\n      <div\n        className=\"expandable-card-header\"\n        onClick={onToggle}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onToggle(e); }}\n      >\n        <div className=\"expandable-card-left\">\n          <div className=\"expandable-card-title\">\n            <span className=\"expandable-card-name\">{era.name}</span>\n            <span className=\"expandable-card-id\">{era.id}</span>\n          </div>\n          <div className=\"expandable-card-desc\">{era.summary}</div>\n        </div>\n        <div className=\"expandable-card-stats\">\n          <div className=\"stat\">\n            <span className=\"stat-label\">Entry</span>\n            <span className=\"stat-value\">{entryConditions.length}</span>\n          </div>\n          <div className=\"stat\">\n            <span className=\"stat-label\">Exit</span>\n            <span className=\"stat-value\">{exitConditions.length}</span>\n          </div>\n          <span className={`expand-icon ${expanded ? \"open\" : \"\"}`}>\u25bc</span>\n        </div>\n      </div>\n\n      {/* Expanded Content */}\n      {expanded && (\n        <div className=\"expandable-card-content\">\n          <BasicInfoSection era={era} onFieldChange={handleFieldChange} />\n\n          {/* Two-column transitions grid: Entry (left) | Exit (right) */}\n          <TransitionsGrid\n            entryConditions={entryConditions}\n            exitConditions={exitConditions}\n            entryPressureChanges={entryPressureChanges}\n            exitPressureChanges={exitPressureChanges}\n            onUpdateEntryCondition={handleUpdateEntryCondition}\n            onRemoveEntryCondition={handleRemoveEntryCondition}\n            onAddEntryCondition={handleAddEntryCondition}\n            onUpdateExitCondition={handleUpdateExitCondition}\n            onRemoveExitCondition={handleRemoveExitCondition}\n            onAddExitCondition={handleAddExitCondition}\n            onUpdateEntryEffect={handleUpdateEntryEffect}\n            onRemoveEntryEffect={handleRemoveEntryEffect}\n            onAddEntryEffect={handleAddEntryEffect}\n            onUpdateExitEffect={handleUpdateExitEffect}\n            onRemoveExitEffect={handleRemoveExitEffect}\n            onAddExitEffect={handleAddExitEffect}\n            availablePressuresForEntry={availablePressuresForEntry}\n            availablePressuresForExit={availablePressuresForExit}\n            pressures={pressures}\n            schema={schema}\n            eras={allEras}\n          />\n\n          {/* Delete button */}\n          <div className=\"card-footer\">\n            <button className=\"btn btn-danger\" onClick={onDelete}>\n              Delete Era\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  era,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  pressures,\n  schema,\n  allEras,\n}", "type": "{ era: any; expanded: boolean; onToggle: Function; onChange: Function; onDelete: Function; pressures: any[]; schema: any; allEras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "BasicInfoSection", "children": [], "isMap": false, "isConditional": false}, {"tag": "TransitionsGrid", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}, {"name": "useCallback", "count": 14}, {"name": "useMemo", "count": 4}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useCallback", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../generators/applicability/createNewRule", "specifiers": ["createNewRule"], "category": "internal"}, {"source": "./sections", "specifiers": ["BasicInfoSection", "TransitionsGrid"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/index.js::ErasEditor", "name": "ErasEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.eras - Array of era objects\n * @param {Function} props.onChange - Called when eras change\n * @param {Array} props.pressures - Available pressures\n * @param {Object} props.schema - Domain schema\n */\nexport default function ErasEditor({ eras = [], onChange, pressures = [], schema }) {\n  const [expandedEra, setExpandedEra] = useState(null);\n\n  const handleEraChange = useCallback(\n    (index, updatedEra) => {\n      const newEras = [...eras];\n      newEras[index] = updatedEra;\n      onChange(newEras);\n    },\n    [eras, onChange]\n  );\n\n  const handleDeleteEra = useCallback(\n    (index) => {\n      if (confirm(`Delete era \"${eras[index].name}\"?`)) {\n        const newEras = eras.filter((_, i) => i !== index);\n        onChange(newEras);\n        if (expandedEra === index) {\n          setExpandedEra(null);\n        }\n      }\n    },\n    [eras, onChange, expandedEra]\n  );\n\n  const handleAddEra = useCallback(() => {\n    const newEra = {\n      id: `era_${Date.now()}`,\n      name: \"New Era\",\n      description: \"A new period in world history\",\n      templateWeights: {},\n      systemModifiers: {},\n      entryConditions: [],\n      entryEffects: { mutations: [] },\n      exitConditions: [{ type: \"growth_phases_complete\", minPhases: 2 }],\n      exitEffects: { mutations: [] },\n    };\n    onChange([...eras, newEra]);\n    setExpandedEra(eras.length);\n  }, [eras, onChange]);\n\n  if (eras.length === 0) {\n    return (\n      <div className=\"editor-container\">\n        <div className=\"header\">\n          <h1 className=\"title\">Eras</h1>\n          <p className=\"subtitle\">Define historical eras that structure world generation</p>\n        </div>\n        <div className=\"empty-state\">\n          <div className=\"empty-state-icon\">\ud83d\udd70\ufe0f</div>\n          <div className=\"empty-state-title\">No eras defined</div>\n          <div className=\"empty-state-desc\">\n            Eras control which generators and systems are active during different phases of world\n            history.\n          </div>\n          <button\n            className=\"btn btn-primary ee-create-btn\"\n            onClick={handleAddEra}\n          >\n            + Create First Era\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Eras</h1>\n        <p className=\"subtitle\">\n          Define historical eras that structure world generation. Each era controls which generators\n          and systems are active and at what strength.\n        </p>\n      </div>\n\n      <div className=\"list-stack\">\n        {eras.map((era, index) => (\n          <EraCard\n            key={era.id}\n            era={era}\n            expanded={expandedEra === index}\n            onToggle={() => setExpandedEra(expandedEra === index ? null : index)}\n            onChange={(updatedEra) => handleEraChange(index, updatedEra)}\n            onDelete={() => handleDeleteEra(index)}\n            pressures={pressures}\n            schema={schema}\n            allEras={eras}\n          />\n        ))}\n\n        <button className=\"btn btn-add\" onClick={handleAddEra}>\n          + Add Era\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ eras = [], onChange, pressures = [], schema }", "type": "{ eras: any[]; onChange: Function; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "h1", "children": [], "isMap": false, "isConditional": false}, {"tag": "p", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}, {"name": "useCallback", "count": 3}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/index.js::EraCard", "name": "EraCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.era - The era object\n * @param {boolean} props.expanded - Whether the card is expanded\n * @param {Function} props.onToggle - Called to toggle expansion\n * @param {Function} props.onChange - Called when era changes\n * @param {Function} props.onDelete - Called to delete the era\n * @param {Array} props.pressures - Available pressures\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.allEras - All eras for nextEra selection\n */\nexport function EraCard({\n  era,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  pressures,\n  schema,\n  allEras,\n}) {\n  const [, setHovering] = useState(false);\n\n  // Field change handler\n  const handleFieldChange = useCallback(\n    (field, value) => {\n      onChange({ ...era, [field]: value });\n    },\n    [era, onChange]\n  );\n\n  // Entry condition handlers\n  const handleAddEntryCondition = useCallback(() => {\n    const newRule = createNewRule(\"pressure\", pressures);\n    onChange({\n      ...era,\n      entryConditions: [...(era.entryConditions || []), newRule],\n    });\n  }, [era, onChange, pressures]);\n\n  const handleUpdateEntryCondition = useCallback(\n    (index, updated) => {\n      const newConditions = [...(era.entryConditions || [])];\n      newConditions[index] = updated;\n      onChange({ ...era, entryConditions: newConditions });\n    },\n    [era, onChange]\n  );\n\n  const handleRemoveEntryCondition = useCallback(\n    (index) => {\n      onChange({\n        ...era,\n        entryConditions: (era.entryConditions || []).filter((_, i) => i !== index),\n      });\n    },\n    [era, onChange]\n  );\n\n  // Exit condition handlers\n  const handleAddExitCondition = useCallback(() => {\n    const newRule = createNewRule(\"growth_phases_complete\", pressures);\n    onChange({\n      ...era,\n      exitConditions: [...(era.exitConditions || []), newRule],\n    });\n  }, [era, onChange, pressures]);\n\n  const handleUpdateExitCondition = useCallback(\n    (index, updated) => {\n      const newConditions = [...(era.exitConditions || [])];\n      newConditions[index] = updated;\n      onChange({ ...era, exitConditions: newConditions });\n    },\n    [era, onChange]\n  );\n\n  const handleRemoveExitCondition = useCallback(\n    (index) => {\n      onChange({\n        ...era,\n        exitConditions: (era.exitConditions || []).filter((_, i) => i !== index),\n      });\n    },\n    [era, onChange]\n  );\n\n  const updateEffectMutations = useCallback(\n    (key, nextMutations) => {\n      onChange({\n        ...era,\n        [key]: { ...(era[key] || {}), mutations: nextMutations },\n      });\n    },\n    [era, onChange]\n  );\n\n  // Entry effect handlers\n  const handleAddEntryEffect = useCallback(\n    (pressureId) => {\n      const existing = era.entryEffects?.mutations || [];\n      const hasExisting = existing.some(\n        (m) => m.type === \"modify_pressure\" && m.pressureId === pressureId\n      );\n      if (hasExisting) return;\n      updateEffectMutations(\"entryEffects\", [\n        ...existing,\n        { type: \"modify_pressure\", pressureId, delta: 10 },\n      ]);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleUpdateEntryEffect = useCallback(\n    (pressureId, value) => {\n      const existing = era.entryEffects?.mutations || [];\n      const next = existing.map((mutation) =>\n        mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId\n          ? { ...mutation, delta: value }\n          : mutation\n      );\n      updateEffectMutations(\"entryEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleRemoveEntryEffect = useCallback(\n    (pressureId) => {\n      const existing = era.entryEffects?.mutations || [];\n      const next = existing.filter(\n        (mutation) => !(mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId)\n      );\n      updateEffectMutations(\"entryEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  // Exit effect handlers\n  const handleAddExitEffect = useCallback(\n    (pressureId) => {\n      const existing = era.exitEffects?.mutations || [];\n      const hasExisting = existing.some(\n        (m) => m.type === \"modify_pressure\" && m.pressureId === pressureId\n      );\n      if (hasExisting) return;\n      updateEffectMutations(\"exitEffects\", [\n        ...existing,\n        { type: \"modify_pressure\", pressureId, delta: 10 },\n      ]);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleUpdateExitEffect = useCallback(\n    (pressureId, value) => {\n      const existing = era.exitEffects?.mutations || [];\n      const next = existing.map((mutation) =>\n        mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId\n          ? { ...mutation, delta: value }\n          : mutation\n      );\n      updateEffectMutations(\"exitEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleRemoveExitEffect = useCallback(\n    (pressureId) => {\n      const existing = era.exitEffects?.mutations || [];\n      const next = existing.filter(\n        (mutation) => !(mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId)\n      );\n      updateEffectMutations(\"exitEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const entryMutations = useMemo(\n    () => (era.entryEffects?.mutations || []).filter((m) => m.type === \"modify_pressure\"),\n    [era.entryEffects]\n  );\n  const exitMutations = useMemo(\n    () => (era.exitEffects?.mutations || []).filter((m) => m.type === \"modify_pressure\"),\n    [era.exitEffects]\n  );\n\n  const availablePressuresForEntry = useMemo(() => {\n    const currentIds = new Set(entryMutations.map((mutation) => mutation.pressureId));\n    return (pressures || [])\n      .filter((p) => !currentIds.has(p.id))\n      .map((p) => ({ id: p.id, name: p.name || p.id }));\n  }, [pressures, entryMutations]);\n\n  const availablePressuresForExit = useMemo(() => {\n    const currentIds = new Set(exitMutations.map((mutation) => mutation.pressureId));\n    return (pressures || [])\n      .filter((p) => !currentIds.has(p.id))\n      .map((p) => ({ id: p.id, name: p.name || p.id }));\n  }, [pressures, exitMutations]);\n\n  // Counts\n  const entryConditions = era.entryConditions || [];\n  const exitConditions = era.exitConditions || [];\n  const entryPressureChanges = entryMutations.map((mutation) => [\n    mutation.pressureId,\n    mutation.delta,\n  ]);\n  const exitPressureChanges = exitMutations.map((mutation) => [\n    mutation.pressureId,\n    mutation.delta,\n  ]);\n\n  return (\n    <div className=\"expandable-card\">\n      {/* Header */}\n      <div\n        className=\"expandable-card-header\"\n        onClick={onToggle}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onToggle(e); }}\n      >\n        <div className=\"expandable-card-left\">\n          <div className=\"expandable-card-title\">\n            <span className=\"expandable-card-name\">{era.name}</span>\n            <span className=\"expandable-card-id\">{era.id}</span>\n          </div>\n          <div className=\"expandable-card-desc\">{era.summary}</div>\n        </div>\n        <div className=\"expandable-card-stats\">\n          <div className=\"stat\">\n            <span className=\"stat-label\">Entry</span>\n            <span className=\"stat-value\">{entryConditions.length}</span>\n          </div>\n          <div className=\"stat\">\n            <span className=\"stat-label\">Exit</span>\n            <span className=\"stat-value\">{exitConditions.length}</span>\n          </div>\n          <span className={`expand-icon ${expanded ? \"open\" : \"\"}`}>\u25bc</span>\n        </div>\n      </div>\n\n      {/* Expanded Content */}\n      {expanded && (\n        <div className=\"expandable-card-content\">\n          <BasicInfoSection era={era} onFieldChange={handleFieldChange} />\n\n          {/* Two-column transitions grid: Entry (left) | Exit (right) */}\n          <TransitionsGrid\n            entryConditions={entryConditions}\n            exitConditions={exitConditions}\n            entryPressureChanges={entryPressureChanges}\n            exitPressureChanges={exitPressureChanges}\n            onUpdateEntryCondition={handleUpdateEntryCondition}\n            onRemoveEntryCondition={handleRemoveEntryCondition}\n            onAddEntryCondition={handleAddEntryCondition}\n            onUpdateExitCondition={handleUpdateExitCondition}\n            onRemoveExitCondition={handleRemoveExitCondition}\n            onAddExitCondition={handleAddExitCondition}\n            onUpdateEntryEffect={handleUpdateEntryEffect}\n            onRemoveEntryEffect={handleRemoveEntryEffect}\n            onAddEntryEffect={handleAddEntryEffect}\n            onUpdateExitEffect={handleUpdateExitEffect}\n            onRemoveExitEffect={handleRemoveExitEffect}\n            onAddExitEffect={handleAddExitEffect}\n            availablePressuresForEntry={availablePressuresForEntry}\n            availablePressuresForExit={availablePressuresForExit}\n            pressures={pressures}\n            schema={schema}\n            eras={allEras}\n          />\n\n          {/* Delete button */}\n          <div className=\"card-footer\">\n            <button className=\"btn btn-danger\" onClick={onDelete}>\n              Delete Era\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  era,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  pressures,\n  schema,\n  allEras,\n}", "type": "{ era: any; expanded: boolean; onToggle: Function; onChange: Function; onDelete: Function; pressures: any[]; schema: any; allEras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "BasicInfoSection", "children": [], "isMap": false, "isConditional": false}, {"tag": "TransitionsGrid", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}, {"name": "useCallback", "count": 14}, {"name": "useMemo", "count": 4}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/GeneratorModal.jsx::GeneratorModal", "name": "GeneratorModal", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/GeneratorModal.jsx", "sourceCode": "export function GeneratorModal({\n  generator,\n  onChange,\n  onClose,\n  onDelete,\n  onDuplicate,\n  schema,\n  pressures,\n  eras,\n  usageMap,\n  tagRegistry = [],\n}) {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  const tabValidation = useMemo(\n    () => computeTabValidation(generator, usageMap),\n    [generator, usageMap]\n  );\n\n  const renderTabBadge = useCallback(\n    (tabId) => {\n      return <TabValidationBadge count={tabValidation.tabErrors[tabId]} />;\n    },\n    [tabValidation.tabErrors]\n  );\n\n  const sidebarFooter = tabValidation.isOrphan ? (\n    <div className=\"orphan-badge-container\">\n      <OrphanBadge isOrphan={true} />\n    </div>\n  ) : null;\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case \"overview\":\n        return (\n          <OverviewTab\n            generator={generator}\n            onChange={onChange}\n            onDelete={onDelete}\n            onDuplicate={onDuplicate}\n          />\n        );\n      case \"applicability\":\n        return (\n          <ApplicabilityTab\n            generator={generator}\n            onChange={onChange}\n            schema={schema}\n            pressures={pressures}\n            eras={eras}\n          />\n        );\n      case \"target\":\n        return <TargetTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"variables\":\n        return <VariablesTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"creation\":\n        return (\n          <CreationTab\n            generator={generator}\n            onChange={onChange}\n            schema={schema}\n            tagRegistry={tagRegistry}\n            pressures={pressures}\n          />\n        );\n      case \"relationships\":\n        return <RelationshipsTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"effects\":\n        return (\n          <EffectsTab\n            generator={generator}\n            onChange={onChange}\n            pressures={pressures}\n            schema={schema}\n          />\n        );\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <ModalShell\n      onClose={onClose}\n      icon=\"\u2699\ufe0f\"\n      title={generator.name || generator.id}\n      disabled={generator.enabled === false}\n      tabs={TABS}\n      activeTab={activeTab}\n      onTabChange={setActiveTab}\n      renderTabBadge={renderTabBadge}\n      sidebarFooter={sidebarFooter}\n    >\n      {renderTabContent()}\n    </ModalShell>\n  );\n}", "parameters": [{"name": "{\n  generator,\n  onChange,\n  onClose,\n  onDelete,\n  onDuplicate,\n  schema,\n  pressures,\n  eras,\n  usageMap,\n  tagRegistry = [],\n}", "type": "{ generator: any; onChange: any; onClose: any; onDelete: any; onDuplicate: any; schema: any; pressures: any; eras: any; usageMap: any; tagRegistry?: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "TabValidationBadge", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}, {"name": "useMemo", "count": 1}, {"name": "useCallback", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useMemo", "useCallback"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "@the-canonry/shared-components", "specifiers": ["getElementValidation"], "category": "external"}, {"source": "./constants", "specifiers": ["TABS"], "category": "internal"}, {"source": "../shared", "specifiers": ["ModalShell", "TabValidationBadge", "OrphanBadge"], "category": "internal"}, {"source": "./tabs", "specifiers": ["OverviewTab", "TargetTab", "VariablesTab", "CreationTab", "RelationshipsTab", "EffectsTab", "ApplicabilityTab"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/GeneratorsEditor.jsx::GeneratorsEditor", "name": "GeneratorsEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/GeneratorsEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.generators - Array of generator configurations\n * @param {Function} props.onChange - Callback when generators change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport default function GeneratorsEditor({\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"generators:selected\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [expandedCategories, setExpandedCategories] = useState({});\n\n  // Derive selected generator from index - this ensures we always have the latest data\n  const resolvedIndex = selectedId ? generators.findIndex((g) => g.id === selectedId) : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedGenerator = selectedIndex !== null ? generators[selectedIndex] : null;\n\n  // Build entity kind info map for icons and labels\n  const entityKindInfo = useMemo(() => {\n    const info = {};\n    (schema?.entityKinds || []).forEach((ek) => {\n      info[ek.kind] = {\n        label: ek.description || ek.name || ek.kind,\n        icon: ek.icon || DEFAULT_KIND_ICONS[ek.kind] || \"\ud83d\udce6\",\n      };\n    });\n    return info;\n  }, [schema]);\n\n  // Group generators by the primary entity kind they create\n  const groupedGenerators = useMemo(() => {\n    const groups = {};\n\n    generators.forEach((generator) => {\n      // Get primary creation kind (first entity created, or target kind if no creation)\n      const createdKinds = (generator.creation || []).map((c) => c.kind).filter(Boolean);\n      const primaryKind = createdKinds[0] || generator.selection?.kind || \"uncategorized\";\n\n      if (!groups[primaryKind]) {\n        groups[primaryKind] = [];\n      }\n      groups[primaryKind].push(generator);\n    });\n\n    return groups;\n  }, [generators]);\n\n  // Get ordered list of categories\n  const categories = useMemo(() => {\n    // Order by schema entity kinds first, then any uncategorized\n    const schemaKinds = (schema?.entityKinds || []).map((ek) => ek.kind);\n    const usedKinds = Object.keys(groupedGenerators);\n\n    // Sort: schema kinds in order, then others alphabetically\n    return usedKinds.sort((a, b) => {\n      const aIdx = schemaKinds.indexOf(a);\n      const bIdx = schemaKinds.indexOf(b);\n      if (aIdx >= 0 && bIdx >= 0) return aIdx - bIdx;\n      if (aIdx >= 0) return -1;\n      if (bIdx >= 0) return 1;\n      return a.localeCompare(b);\n    });\n  }, [groupedGenerators, schema]);\n\n  // Initialize expanded state for new categories\n  useEffect(() => {\n    const needsUpdate = categories.some((cat) => expandedCategories[cat] === undefined);\n    if (!needsUpdate) return;\n    const updated = { ...expandedCategories };\n    categories.forEach((cat) => {\n      if (updated[cat] === undefined) {\n        updated[cat] = true;\n      }\n    });\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync category expansion defaults when categories change\n    setExpandedCategories(updated);\n  }, [categories, expandedCategories]);\n\n  // Restore selectedId from storage when selectionKey changes\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted selection when key changes\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  // Persist selectedId to storage\n  useEffect(() => {\n    if (!selectionKey) return;\n    if (selectedId) {\n      saveStoredValue(selectionKey, selectedId);\n    } else {\n      clearStoredValue(selectionKey);\n    }\n  }, [selectionKey, selectedId]);\n\n  // Clear invalid selectedId (during render)\n  if (selectedId && selectedIndex === null) {\n    setSelectedId(null);\n    clearStoredValue(selectionKey);\n  }\n\n  const handleGeneratorChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex < generators.length) {\n        const newGenerators = [...generators];\n        newGenerators[selectedIndex] = updated;\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (generator) => {\n      const index = generators.findIndex((g) => g.id === generator.id);\n      if (index >= 0) {\n        const newGenerators = [...generators];\n        newGenerators[index] = {\n          ...generator,\n          enabled: generator.enabled === false ? true : false,\n        };\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedGenerator &&\n      confirm(`Delete generator \"${selectedGenerator.name || selectedGenerator.id}\"?`)\n    ) {\n      const newGenerators = [...generators];\n      newGenerators.splice(selectedIndex, 1);\n      onChange(newGenerators);\n      setSelectedId(null);\n    }\n  }, [generators, onChange, selectedIndex, selectedGenerator]);\n\n  const handleAdd = useCallback(() => {\n    const newGenerator = {\n      id: `generator_${Date.now()}`,\n      name: \"New Generator\",\n      applicability: [],\n      selection: { strategy: \"by_kind\", kind: \"location\", pickStrategy: \"random\" },\n      creation: [],\n      relationships: [],\n      stateUpdates: [],\n      variables: {},\n    };\n    onChange([...generators, newGenerator]);\n    setSelectedId(newGenerator.id);\n  }, [generators, onChange]);\n\n  const handleDuplicate = useCallback(() => {\n    if (!selectedGenerator) return;\n    const duplicated = {\n      ...JSON.parse(JSON.stringify(selectedGenerator)), // Deep clone\n      id: `${selectedGenerator.id}_copy_${Date.now()}`,\n      name: `${selectedGenerator.name || selectedGenerator.id} (Copy)`,\n    };\n    onChange([...generators, duplicated]);\n    setSelectedId(duplicated.id);\n  }, [generators, onChange, selectedGenerator]);\n\n  const toggleCategoryExpand = useCallback((kind) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [kind]: !prev[kind],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (kind) => {\n      const categoryItems = groupedGenerators[kind] || [];\n      const allEnabled = categoryItems.every((g) => g.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of generators in this category\n      const categoryIds = new Set(categoryItems.map((g) => g.id));\n\n      const newGenerators = generators.map((g) => {\n        if (categoryIds.has(g.id)) {\n          return { ...g, enabled: newEnabled };\n        }\n        return g;\n      });\n      onChange(newGenerators);\n    },\n    [generators, groupedGenerators, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Generators</h1>\n        <p className=\"subtitle\">\n          Configure entity generators that populate your world. Click a generator to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((kind) => {\n        const kindInfo = entityKindInfo[kind] || {\n          label: kind.charAt(0).toUpperCase() + kind.slice(1),\n          icon: DEFAULT_KIND_ICONS[kind] || \"\ud83d\udce6\",\n        };\n        const categoryItems = groupedGenerators[kind] || [];\n        const allEnabled = categoryItems.every((g) => g.enabled !== false);\n\n        return (\n          <CategorySection\n            key={kind}\n            id={kind}\n            icon={kindInfo.icon}\n            label={`${kindInfo.label} Generators`}\n            items={categoryItems}\n            expanded={expandedCategories[kind] !== false}\n            onToggleExpand={() => toggleCategoryExpand(kind)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(kind)}\n            renderItem={(generator) => (\n              <GeneratorListCard\n                key={generator.id}\n                generator={generator}\n                onClick={() => setSelectedId(generator.id)}\n                onToggle={() => handleToggle(generator)}\n                usageMap={usageMap}\n              />\n            )}\n          />\n        );\n      })}\n\n      {/* Add Generator button */}\n      <div className=\"mt-lg\">\n        <AddCard onClick={handleAdd} label=\"Add Generator\" />\n      </div>\n\n      {selectedGenerator && (\n        <GeneratorModal\n          generator={selectedGenerator}\n          onChange={handleGeneratorChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          onDuplicate={handleDuplicate}\n          schema={schema}\n          pressures={pressures}\n          eras={eras}\n          usageMap={usageMap}\n          tagRegistry={schema.tagRegistry || []}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}", "type": "{ generators: any[]; onChange: Function; schema: any; pressures: any[]; eras: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "h1", "children": [], "isMap": false, "isConditional": false}, {"tag": "p", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "CategorySection", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "AddCard", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "GeneratorModal", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useMemo", "count": 3}, {"name": "useEffect", "count": 3}, {"name": "useCallback", "count": 7}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useCallback", "useMemo", "useEffect"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../shared", "specifiers": ["CategorySection", "AddCard"], "category": "internal"}, {"source": "./GeneratorModal", "specifiers": ["GeneratorModal"], "category": "internal"}, {"source": "./cards", "specifiers": ["GeneratorListCard"], "category": "internal"}, {"source": "../../utils/persistence", "specifiers": ["buildStorageKey", "clearStoredValue", "loadStoredValue", "saveStoredValue"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::GeneratorsEditor", "name": "GeneratorsEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.generators - Array of generator configurations\n * @param {Function} props.onChange - Callback when generators change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport default function GeneratorsEditor({\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"generators:selected\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [expandedCategories, setExpandedCategories] = useState({});\n\n  // Derive selected generator from index - this ensures we always have the latest data\n  const resolvedIndex = selectedId ? generators.findIndex((g) => g.id === selectedId) : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedGenerator = selectedIndex !== null ? generators[selectedIndex] : null;\n\n  // Build entity kind info map for icons and labels\n  const entityKindInfo = useMemo(() => {\n    const info = {};\n    (schema?.entityKinds || []).forEach((ek) => {\n      info[ek.kind] = {\n        label: ek.description || ek.name || ek.kind,\n        icon: ek.icon || DEFAULT_KIND_ICONS[ek.kind] || \"\ud83d\udce6\",\n      };\n    });\n    return info;\n  }, [schema]);\n\n  // Group generators by the primary entity kind they create\n  const groupedGenerators = useMemo(() => {\n    const groups = {};\n\n    generators.forEach((generator) => {\n      // Get primary creation kind (first entity created, or target kind if no creation)\n      const createdKinds = (generator.creation || []).map((c) => c.kind).filter(Boolean);\n      const primaryKind = createdKinds[0] || generator.selection?.kind || \"uncategorized\";\n\n      if (!groups[primaryKind]) {\n        groups[primaryKind] = [];\n      }\n      groups[primaryKind].push(generator);\n    });\n\n    return groups;\n  }, [generators]);\n\n  // Get ordered list of categories\n  const categories = useMemo(() => {\n    // Order by schema entity kinds first, then any uncategorized\n    const schemaKinds = (schema?.entityKinds || []).map((ek) => ek.kind);\n    const usedKinds = Object.keys(groupedGenerators);\n\n    // Sort: schema kinds in order, then others alphabetically\n    return usedKinds.sort((a, b) => {\n      const aIdx = schemaKinds.indexOf(a);\n      const bIdx = schemaKinds.indexOf(b);\n      if (aIdx >= 0 && bIdx >= 0) return aIdx - bIdx;\n      if (aIdx >= 0) return -1;\n      if (bIdx >= 0) return 1;\n      return a.localeCompare(b);\n    });\n  }, [groupedGenerators, schema]);\n\n  // Initialize expanded state for new categories\n  useEffect(() => {\n    const needsUpdate = categories.some((cat) => expandedCategories[cat] === undefined);\n    if (!needsUpdate) return;\n    const updated = { ...expandedCategories };\n    categories.forEach((cat) => {\n      if (updated[cat] === undefined) {\n        updated[cat] = true;\n      }\n    });\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync category expansion defaults when categories change\n    setExpandedCategories(updated);\n  }, [categories, expandedCategories]);\n\n  // Restore selectedId from storage when selectionKey changes\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted selection when key changes\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  // Persist selectedId to storage\n  useEffect(() => {\n    if (!selectionKey) return;\n    if (selectedId) {\n      saveStoredValue(selectionKey, selectedId);\n    } else {\n      clearStoredValue(selectionKey);\n    }\n  }, [selectionKey, selectedId]);\n\n  // Clear invalid selectedId (during render)\n  if (selectedId && selectedIndex === null) {\n    setSelectedId(null);\n    clearStoredValue(selectionKey);\n  }\n\n  const handleGeneratorChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex < generators.length) {\n        const newGenerators = [...generators];\n        newGenerators[selectedIndex] = updated;\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (generator) => {\n      const index = generators.findIndex((g) => g.id === generator.id);\n      if (index >= 0) {\n        const newGenerators = [...generators];\n        newGenerators[index] = {\n          ...generator,\n          enabled: generator.enabled === false ? true : false,\n        };\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedGenerator &&\n      confirm(`Delete generator \"${selectedGenerator.name || selectedGenerator.id}\"?`)\n    ) {\n      const newGenerators = [...generators];\n      newGenerators.splice(selectedIndex, 1);\n      onChange(newGenerators);\n      setSelectedId(null);\n    }\n  }, [generators, onChange, selectedIndex, selectedGenerator]);\n\n  const handleAdd = useCallback(() => {\n    const newGenerator = {\n      id: `generator_${Date.now()}`,\n      name: \"New Generator\",\n      applicability: [],\n      selection: { strategy: \"by_kind\", kind: \"location\", pickStrategy: \"random\" },\n      creation: [],\n      relationships: [],\n      stateUpdates: [],\n      variables: {},\n    };\n    onChange([...generators, newGenerator]);\n    setSelectedId(newGenerator.id);\n  }, [generators, onChange]);\n\n  const handleDuplicate = useCallback(() => {\n    if (!selectedGenerator) return;\n    const duplicated = {\n      ...JSON.parse(JSON.stringify(selectedGenerator)), // Deep clone\n      id: `${selectedGenerator.id}_copy_${Date.now()}`,\n      name: `${selectedGenerator.name || selectedGenerator.id} (Copy)`,\n    };\n    onChange([...generators, duplicated]);\n    setSelectedId(duplicated.id);\n  }, [generators, onChange, selectedGenerator]);\n\n  const toggleCategoryExpand = useCallback((kind) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [kind]: !prev[kind],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (kind) => {\n      const categoryItems = groupedGenerators[kind] || [];\n      const allEnabled = categoryItems.every((g) => g.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of generators in this category\n      const categoryIds = new Set(categoryItems.map((g) => g.id));\n\n      const newGenerators = generators.map((g) => {\n        if (categoryIds.has(g.id)) {\n          return { ...g, enabled: newEnabled };\n        }\n        return g;\n      });\n      onChange(newGenerators);\n    },\n    [generators, groupedGenerators, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Generators</h1>\n        <p className=\"subtitle\">\n          Configure entity generators that populate your world. Click a generator to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((kind) => {\n        const kindInfo = entityKindInfo[kind] || {\n          label: kind.charAt(0).toUpperCase() + kind.slice(1),\n          icon: DEFAULT_KIND_ICONS[kind] || \"\ud83d\udce6\",\n        };\n        const categoryItems = groupedGenerators[kind] || [];\n        const allEnabled = categoryItems.every((g) => g.enabled !== false);\n\n        return (\n          <CategorySection\n            key={kind}\n            id={kind}\n            icon={kindInfo.icon}\n            label={`${kindInfo.label} Generators`}\n            items={categoryItems}\n            expanded={expandedCategories[kind] !== false}\n            onToggleExpand={() => toggleCategoryExpand(kind)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(kind)}\n            renderItem={(generator) => (\n              <GeneratorListCard\n                key={generator.id}\n                generator={generator}\n                onClick={() => setSelectedId(generator.id)}\n                onToggle={() => handleToggle(generator)}\n                usageMap={usageMap}\n              />\n            )}\n          />\n        );\n      })}\n\n      {/* Add Generator button */}\n      <div className=\"mt-lg\">\n        <AddCard onClick={handleAdd} label=\"Add Generator\" />\n      </div>\n\n      {selectedGenerator && (\n        <GeneratorModal\n          generator={selectedGenerator}\n          onChange={handleGeneratorChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          onDuplicate={handleDuplicate}\n          schema={schema}\n          pressures={pressures}\n          eras={eras}\n          usageMap={usageMap}\n          tagRegistry={schema.tagRegistry || []}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}", "type": "{ generators: any[]; onChange: Function; schema: any; pressures: any[]; eras: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "h1", "children": [], "isMap": false, "isConditional": false}, {"tag": "p", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "CategorySection", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "AddCard", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "GeneratorModal", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useMemo", "count": 3}, {"name": "useEffect", "count": 3}, {"name": "useCallback", "count": 7}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::GeneratorModal", "name": "GeneratorModal", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "export function GeneratorModal({\n  generator,\n  onChange,\n  onClose,\n  onDelete,\n  onDuplicate,\n  schema,\n  pressures,\n  eras,\n  usageMap,\n  tagRegistry = [],\n}) {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  const tabValidation = useMemo(\n    () => computeTabValidation(generator, usageMap),\n    [generator, usageMap]\n  );\n\n  const renderTabBadge = useCallback(\n    (tabId) => {\n      return <TabValidationBadge count={tabValidation.tabErrors[tabId]} />;\n    },\n    [tabValidation.tabErrors]\n  );\n\n  const sidebarFooter = tabValidation.isOrphan ? (\n    <div className=\"orphan-badge-container\">\n      <OrphanBadge isOrphan={true} />\n    </div>\n  ) : null;\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case \"overview\":\n        return (\n          <OverviewTab\n            generator={generator}\n            onChange={onChange}\n            onDelete={onDelete}\n            onDuplicate={onDuplicate}\n          />\n        );\n      case \"applicability\":\n        return (\n          <ApplicabilityTab\n            generator={generator}\n            onChange={onChange}\n            schema={schema}\n            pressures={pressures}\n            eras={eras}\n          />\n        );\n      case \"target\":\n        return <TargetTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"variables\":\n        return <VariablesTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"creation\":\n        return (\n          <CreationTab\n            generator={generator}\n            onChange={onChange}\n            schema={schema}\n            tagRegistry={tagRegistry}\n            pressures={pressures}\n          />\n        );\n      case \"relationships\":\n        return <RelationshipsTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"effects\":\n        return (\n          <EffectsTab\n            generator={generator}\n            onChange={onChange}\n            pressures={pressures}\n            schema={schema}\n          />\n        );\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <ModalShell\n      onClose={onClose}\n      icon=\"\u2699\ufe0f\"\n      title={generator.name || generator.id}\n      disabled={generator.enabled === false}\n      tabs={TABS}\n      activeTab={activeTab}\n      onTabChange={setActiveTab}\n      renderTabBadge={renderTabBadge}\n      sidebarFooter={sidebarFooter}\n    >\n      {renderTabContent()}\n    </ModalShell>\n  );\n}", "parameters": [{"name": "{\n  generator,\n  onChange,\n  onClose,\n  onDelete,\n  onDuplicate,\n  schema,\n  pressures,\n  eras,\n  usageMap,\n  tagRegistry = [],\n}", "type": "{ generator: any; onChange: any; onClose: any; onDelete: any; onDuplicate: any; schema: any; pressures: any; eras: any; usageMap: any; tagRegistry?: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "TabValidationBadge", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}, {"name": "useMemo", "count": 1}, {"name": "useCallback", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::GeneratorListCard", "name": "GeneratorListCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator to display\n * @param {Function} props.onClick - Callback when card is clicked\n * @param {Function} props.onToggle - Callback to toggle enabled state\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport function GeneratorListCard({ generator, onClick, onToggle, usageMap }) {\n  const isEnabled = generator.enabled !== false;\n\n  const summary = useMemo(() => {\n    const creates =\n      generator.creation?.map((c) => c.kind).filter((v, i, a) => a.indexOf(v) === i) || [];\n    const rels = generator.relationships?.length || 0;\n    const effects = generator.stateUpdates?.length || 0;\n    return { creates, rels, effects };\n  }, [generator]);\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"generator\", generator.id)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, generator.id]\n  );\n\n  const eraUsage = useMemo(() => {\n    if (!usageMap?.generators?.[generator.id]) return [];\n    return usageMap.generators[generator.id].eras || [];\n  }, [usageMap, generator.id]);\n\n  const errorCount = validation.invalidRefs.length;\n  const hasErrors = errorCount > 0;\n  const isOrphan = validation.isOrphan;\n\n  return (\n    <div\n      className={`card card-clickable ${!isEnabled ? \"card-disabled\" : \"\"} ${hasErrors ? \"card-error\" : \"\"} ${isOrphan && !hasErrors ? \"card-warning\" : \"\"}`}\n      onClick={onClick}\n      role=\"button\"\n      tabIndex={0}\n      onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }}\n    >\n      <div className=\"card-header\">\n        <div>\n          <div className=\"flex items-center gap-md\">\n            <span className=\"card-title\">{generator.name || generator.id}</span>\n            <ErrorBadge count={errorCount} />\n          </div>\n          <div className=\"card-id\">{generator.id}</div>\n        </div>\n        <EnableToggle\n          enabled={isEnabled}\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n        />\n      </div>\n\n      <div className=\"card-stats\">\n        <div className=\"card-stat\">\n          <span>\u2728</span> {generator.creation?.length || 0} creates\n        </div>\n        <div className=\"card-stat\">\n          <span>\ud83d\udd17</span> {summary.rels} rels\n        </div>\n        <div className=\"card-stat\">\n          <span>\u26a1</span> {summary.effects} effects\n        </div>\n      </div>\n\n      <div className=\"card-badges\">\n        {summary.creates.slice(0, 3).map((kind) => (\n          <span key={kind} className=\"badge badge-entity-kind\">\n            + {kind}\n          </span>\n        ))}\n      </div>\n\n      <EraBadges eras={eraUsage} />\n      {isOrphan && (\n        <div className=\"mt-md\">\n          <OrphanBadge isOrphan={isOrphan} />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onClick, onToggle, usageMap }", "type": "{ generator: any; onClick: Function; onToggle: Function; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "ErrorBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "EraBadges", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "OrphanBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 3}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::PathStepEditor", "name": "PathStepEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.step - The path step configuration\n * @param {Function} props.onChange - Callback when step changes\n * @param {Function} props.onRemove - Callback to remove this step\n * @param {Object} props.schema - Domain schema\n * @param {number} props.stepIndex - Index of this step in the path\n */\nexport function PathStepEditor({ step, onChange, onRemove, schema, stepIndex }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKindOptions = [\n    { value: \"any\", label: \"Any kind\" },\n    ...(schema?.entityKinds || []).map((ek) => ({\n      value: ek.kind,\n      label: ek.description || ek.kind,\n    })),\n  ];\n\n  const getSubtypeOptions = (kind) => {\n    if (!kind || kind === \"any\") return [{ value: \"any\", label: \"Any subtype\" }];\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [{ value: \"any\", label: \"Any subtype\" }];\n    return [\n      { value: \"any\", label: \"Any subtype\" },\n      ...ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id })),\n    ];\n  };\n\n  const updateStep = (field, value) => {\n    onChange({ ...step, [field]: value });\n  };\n\n  return (\n    <div className=\"path-step-card\">\n      <div className=\"path-step-header\">\n        <span className=\"path-step-label\">Step {stepIndex + 1}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      <div className=\"path-step-grid\">\n        <div>\n          <label className=\"label label-micro\">Via Relationship\n          <ReferenceDropdown\n            value={step.via || \"\"}\n            onChange={(v) => updateStep(\"via\", v)}\n            options={relationshipKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Direction\n          <ReferenceDropdown\n            value={step.direction || \"any\"}\n            onChange={(v) => updateStep(\"direction\", v)}\n            options={PATH_DIRECTIONS}\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Kind\n          <ReferenceDropdown\n            value={step.targetKind}\n            onChange={(v) => updateStep(\"targetKind\", v)}\n            options={entityKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Subtype\n          <ReferenceDropdown\n            value={step.targetSubtype}\n            onChange={(v) => updateStep(\"targetSubtype\", v)}\n            options={getSubtypeOptions(step.targetKind)}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div className=\"path-step-full-width\">\n          <label htmlFor=\"store-as-variable-optional\" className=\"label label-micro\">Store As Variable (optional)</label>\n          <input id=\"store-as-variable-optional\"\n            type=\"text\"\n            value={step.as || \"\"}\n            onChange={(e) => updateStep(\"as\", e.target.value)}\n            className=\"input input-micro\"\n            placeholder=\"e.g. $allies\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ step, onChange, onRemove, schema, stepIndex }", "type": "{ step: any; onChange: Function; onRemove: Function; schema: any; stepIndex: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::PathConstraintEditor", "name": "PathConstraintEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.constraint - The path constraint configuration\n * @param {Function} props.onChange - Callback when constraint changes\n * @param {Function} props.onRemove - Callback to remove this constraint\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function PathConstraintEditor({ constraint, onChange, onRemove, schema, availableRefs }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  // Gather all subtypes from all entity kinds for subtype_equals constraint\n  const allSubtypeOptions = entityKinds.flatMap((ek) =>\n    (ek.subtypes || []).map((st) => ({\n      value: st.id,\n      label: `${st.name || st.id} (${ek.kind})`,\n    }))\n  );\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateConstraint = (field, value) => {\n    onChange({ ...constraint, [field]: value || undefined });\n  };\n\n  const renderConstraintFields = () => {\n    switch (constraint.type) {\n      case \"not_self\":\n        return <span className=\"text-muted text-small\">Target cannot be the starting entity</span>;\n\n      case \"not_in\":\n      case \"in\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Set Variable\n            <ReferenceDropdown\n              value={constraint.set || \"\"}\n              onChange={(v) => updateConstraint(\"set\", v)}\n              options={refOptions}\n              placeholder=\"e.g. $allies\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"kind_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Entity Kind\n            <ReferenceDropdown\n              value={constraint.kind || \"\"}\n              onChange={(v) => updateConstraint(\"kind\", v)}\n              options={entityKindOptions}\n            />\n            </label>\n          </div>\n        );\n\n      case \"subtype_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Subtype\n            <ReferenceDropdown\n              value={constraint.subtype || \"\"}\n              onChange={(v) => updateConstraint(\"subtype\", v)}\n              options={allSubtypeOptions}\n              placeholder=\"Select subtype...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"constraint-fields-grid\">\n            <div>\n              <label className=\"label label-micro\">Kind\n              <ReferenceDropdown\n                value={constraint.kind || \"\"}\n                onChange={(v) => updateConstraint(\"kind\", v)}\n                options={relationshipKindOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">With\n              <ReferenceDropdown\n                value={constraint.with || \"\"}\n                onChange={(v) => updateConstraint(\"with\", v)}\n                options={refOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">Direction\n              <ReferenceDropdown\n                value={constraint.direction || \"any\"}\n                onChange={(v) => updateConstraint(\"direction\", v)}\n                options={PATH_DIRECTIONS}\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  const constraintLabel =\n    PATH_CONSTRAINT_TYPES.find((c) => c.value === constraint.type)?.label || constraint.type;\n\n  return (\n    <div className=\"path-constraint-card\">\n      <div className=\"path-constraint-header\">\n        <span className=\"path-constraint-label\">{constraintLabel}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      {renderConstraintFields()}\n    </div>\n  );\n}", "parameters": [{"name": "{ constraint, onChange, onRemove, schema, availableRefs }", "type": "{ constraint: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "span", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::GraphPathEditor", "name": "GraphPathEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.assert - The path assertion configuration\n * @param {Function} props.onChange - Callback when assertion changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function GraphPathEditor({ assert, onChange, schema, availableRefs }) {\n  const [showConstraintMenu, setShowConstraintMenu] = useState(false);\n\n  const assertion = assert || { check: \"exists\", path: [] };\n\n  const updateAssertion = (field, value) => {\n    onChange({ ...assertion, [field]: value });\n  };\n\n  const addStep = () => {\n    // Create with empty required fields - validation will flag them\n    const newStep = { via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" };\n    updateAssertion(\"path\", [...(assertion.path || []), newStep]);\n  };\n\n  const updateStep = (index, updated) => {\n    const newPath = [...(assertion.path || [])];\n    newPath[index] = updated;\n    updateAssertion(\"path\", newPath);\n  };\n\n  const removeStep = (index) => {\n    updateAssertion(\n      \"path\",\n      (assertion.path || []).filter((_, i) => i !== index)\n    );\n  };\n\n  const addConstraint = (type) => {\n    const newConstraint = { type };\n    if (type === \"has_relationship\" || type === \"lacks_relationship\") {\n      newConstraint.direction = \"any\";\n    }\n    updateAssertion(\"where\", [...(assertion.where || []), newConstraint]);\n    setShowConstraintMenu(false);\n  };\n\n  const updateConstraint = (index, updated) => {\n    const newWhere = [...(assertion.where || [])];\n    newWhere[index] = updated;\n    updateAssertion(\"where\", newWhere);\n  };\n\n  const removeConstraint = (index) => {\n    const newWhere = (assertion.where || []).filter((_, i) => i !== index);\n    updateAssertion(\"where\", newWhere.length > 0 ? newWhere : undefined);\n  };\n\n  // Collect variables from path steps for constraint references\n  const pathVars = (assertion.path || []).filter((s) => s.as).map((s) => s.as);\n  const allRefs = [...(availableRefs || []), ...pathVars];\n\n  return (\n    <div className=\"graph-path-editor\">\n      {/* Check type and count */}\n      <div className=\"path-editor-grid\">\n        <div>\n          <label className=\"label label-tiny\">Check Type\n          <ReferenceDropdown\n            value={assertion.check || \"exists\"}\n            onChange={(v) => updateAssertion(\"check\", v)}\n            options={PATH_CHECK_TYPES}\n          />\n          </label>\n        </div>\n        {(assertion.check === \"count_min\" || assertion.check === \"count_max\") && (\n          <div>\n            <label className=\"label label-tiny\">Count\n            <NumberInput\n              value={assertion.count ?? 1}\n              onChange={(v) => updateAssertion(\"count\", v ?? 1)}\n              min={0}\n              integer\n              className=\"input input-compact\"\n            />\n            </label>\n          </div>\n        )}\n      </div>\n\n      {/* Path steps */}\n      <div>\n        <span className=\"label label-tiny\">Path Steps (traverse relationships)</span>\n        <div className=\"path-steps-list\">\n          {(assertion.path || []).map((step, index) => (\n            <PathStepEditor\n              key={index}\n              step={step}\n              onChange={(updated) => updateStep(index, updated)}\n              onRemove={() => removeStep(index)}\n              schema={schema}\n              stepIndex={index}\n            />\n          ))}\n          {(assertion.path || []).length < 2 && (\n            <button onClick={addStep} className=\"button button-add-step\">\n              + Add Step {(assertion.path || []).length === 0 ? \"(required)\" : \"(optional)\"}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Where constraints */}\n      <div>\n        <span className=\"label label-tiny\">Where Constraints (optional)</span>\n        <div className=\"path-constraints-list\">\n          {(assertion.where || []).map((constraint, index) => (\n            <PathConstraintEditor\n              key={index}\n              constraint={constraint}\n              onChange={(updated) => updateConstraint(index, updated)}\n              onRemove={() => removeConstraint(index)}\n              schema={schema}\n              availableRefs={allRefs}\n            />\n          ))}\n          <div className=\"relative\">\n            <button\n              onClick={() => setShowConstraintMenu(!showConstraintMenu)}\n              className=\"button button-add-constraint\"\n            >\n              + Add Constraint\n            </button>\n            {showConstraintMenu && (\n              <div className=\"dropdown-menu\">\n                {PATH_CONSTRAINT_TYPES.map(({ value, label }) => (\n                  <div\n                    key={value}\n                    onClick={() => addConstraint(value)}\n                    className=\"dropdown-menu-item\"\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    {label}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ assert, onChange, schema, availableRefs }", "type": "{ assert: any; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "PathStepEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "PathConstraintEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::SelectionFilterCard", "name": "SelectionFilterCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.filter - The filter configuration\n * @param {Function} props.onChange - Callback when filter changes\n * @param {Function} props.onRemove - Callback to remove this filter\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFilterCard({ filter, onChange, onRemove, schema, availableRefs }) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = FILTER_TYPES[filter.type] || {\n    label: filter.type,\n    icon: \"\u2753\",\n    color: \"#6b7280\",\n  };\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateFilter = (field, value) => {\n    onChange({ ...filter, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (filter.type) {\n      case \"has_tag\": {\n        const valueSuffix = filter.value !== undefined ? ` = ${filter.value}` : \"\";\n        return `${filter.tag || \"?\"}${valueSuffix}`;\n      }\n      case \"has_tags\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"lacks_tag\":\n        return filter.tag || \"tag?\";\n      case \"lacks_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_culture\":\n        return filter.culture || \"culture?\";\n      case \"matches_culture\":\n        return `with ${filter.with || \"?\"}`;\n      case \"has_status\":\n        return filter.status || \"status?\";\n      case \"has_prominence\":\n        return filter.minProminence || \"prominence?\";\n      case \"has_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        const direction = filter.direction ? ` [${filter.direction}]` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}${direction}`;\n      }\n      case \"lacks_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}`;\n      }\n      case \"exclude\":\n        return `${(filter.entities || []).length} excluded`;\n      case \"shares_related\":\n        return `${filter.relationshipKind || \"?\"} with ${filter.with || \"?\"}`;\n      case \"graph_path\":\n        return `graph path (${filter.assert?.check || \"exists\"})`;\n      default:\n        return \"\";\n    }\n  };\n\n  const summary = getSummary();\n\n  const renderFilterFields = () => {\n    switch (filter.type) {\n      case \"has_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"has_tags\":\n      case \"has_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">\n              {filter.type === \"has_tags\" ? \"Tags (must have ALL)\" : \"Tags (must have at least ONE)\"}\n            </label>\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n          </div>\n        );\n\n      case \"lacks_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"lacks_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">Tags (exclude if has ANY)\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n        );\n\n\n      case \"has_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Culture\n            <ReferenceDropdown\n              value={filter.culture || \"\"}\n              onChange={(v) => updateFilter(\"culture\", v)}\n              options={(schema?.cultures || []).map((c) => ({\n                value: c.id,\n                label: c.name || c.id,\n              }))}\n              placeholder=\"Select culture...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"matches_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Same Culture As\n            <ReferenceDropdown\n              value={filter.with || \"\"}\n              onChange={(v) => updateFilter(\"with\", v)}\n              options={refOptions}\n              placeholder=\"Select variable...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_status\":\n        return (\n          <div>\n            <label htmlFor=\"status\" className=\"label label-small\">Status</label>\n            <input id=\"status\"\n              type=\"text\"\n              value={filter.status || \"\"}\n              onChange={(e) => updateFilter(\"status\", e.target.value)}\n              className=\"input input-compact\"\n              placeholder=\"e.g., active, historical\"\n            />\n          </div>\n        );\n\n      case \"has_prominence\":\n        return (\n          <div>\n            <label className=\"label label-small\">Minimum Prominence\n            <ReferenceDropdown\n              value={filter.minProminence || \"\"}\n              onChange={(v) => updateFilter(\"minProminence\", v)}\n              options={PROMINENCE_LEVELS.map((p) => ({ value: p.value, label: p.label }))}\n              placeholder=\"Select prominence...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Relationship Kind\n              <ReferenceDropdown\n                value={filter.kind || \"\"}\n                onChange={(v) => updateFilter(\"kind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity (optional)\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v || undefined)}\n                options={refOptions}\n                placeholder=\"Any entity\"\n              />\n              </label>\n            </div>\n            {filter.type === \"has_relationship\" && (\n              <div className=\"sfc-flex-field-tiny\">\n                <label className=\"label label-small\">Direction\n                <ReferenceDropdown\n                  value={filter.direction || \"both\"}\n                  onChange={(v) => updateFilter(\"direction\", v)}\n                  options={[\n                    { value: \"both\", label: \"Both\" },\n                    { value: \"src\", label: \"Outgoing\" },\n                    { value: \"dst\", label: \"Incoming\" },\n                  ]}\n                />\n                </label>\n              </div>\n            )}\n          </div>\n        );\n\n      case \"exclude\":\n        return (\n          <ChipSelect\n            label=\"Entities to Exclude\"\n            value={filter.entities || []}\n            onChange={(v) => updateFilter(\"entities\", v)}\n            options={refOptions}\n            placeholder=\"+ Add variable...\"\n          />\n        );\n\n      case \"shares_related\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Via Relationship\n              <ReferenceDropdown\n                value={filter.relationshipKind || \"\"}\n                onChange={(v) => updateFilter(\"relationshipKind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v)}\n                options={refOptions}\n                placeholder=\"Select variable...\"\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      case \"graph_path\":\n// ... (truncated)", "parameters": [{"name": "{ filter, onChange, onRemove, schema, availableRefs }", "type": "{ filter: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::SelectionFiltersEditor", "name": "SelectionFiltersEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.filters - Array of filter configurations\n * @param {Function} props.onChange - Callback when filters change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFiltersEditor({ filters, onChange, schema, availableRefs }) {\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const containerRef = useRef(null);\n\n  // Calculate dropdown position when opening (like TagSelector)\n  useLayoutEffect(() => {\n    if (showTypeMenu && containerRef.current) {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  const handleAddFilter = (type) => {\n    // Create with empty required fields - validation will flag them\n    const newFilter = { type };\n    // Tag filters\n    if (type === \"has_tag\") newFilter.tag = \"\";\n    if (type === \"has_tags\") newFilter.tags = [];\n    if (type === \"has_any_tag\") newFilter.tags = [];\n    if (type === \"lacks_tag\") newFilter.tag = \"\";\n    if (type === \"lacks_any_tag\") newFilter.tags = [];\n    // Attribute filters\n    if (type === \"has_culture\") newFilter.culture = \"\";\n    if (type === \"matches_culture\") newFilter.with = \"\";\n    if (type === \"has_status\") newFilter.status = \"\";\n    if (type === \"has_prominence\") newFilter.minProminence = \"\";\n    // Relationship filters\n    if (type === \"has_relationship\") newFilter.kind = \"\";\n    if (type === \"lacks_relationship\") newFilter.kind = \"\";\n    if (type === \"shares_related\") {\n      newFilter.relationshipKind = \"\";\n      newFilter.with = \"\";\n    }\n    // Other\n    if (type === \"exclude\") newFilter.entities = [];\n    if (type === \"graph_path\")\n      newFilter.assert = {\n        check: \"\",\n        path: [{ via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" }],\n      };\n    onChange([...(filters || []), newFilter]);\n    setShowTypeMenu(false);\n  };\n\n  const handleUpdateFilter = (index, updated) => {\n    const newFilters = [...(filters || [])];\n    newFilters[index] = updated;\n    onChange(newFilters);\n  };\n\n  const handleRemoveFilter = (index) => {\n    onChange((filters || []).filter((_, i) => i !== index));\n  };\n\n  return (\n    <div>\n      {(filters || []).length === 0 ? (\n        <div className=\"empty-state-compact\">\n          No filters defined. Filters narrow down which entities can be selected as targets.\n        </div>\n      ) : (\n        <div className=\"condition-list\">\n          {(filters || []).map((filter, index) => (\n            <SelectionFilterCard\n              key={index}\n              filter={filter}\n              onChange={(updated) => handleUpdateFilter(index, updated)}\n              onRemove={() => handleRemoveFilter(index)}\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))}\n        </div>\n      )}\n\n      <div ref={containerRef} className=\"relative mt-lg\">\n        <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n          + Add Filter\n        </button>\n\n        {showTypeMenu && (\n          <div\n            className=\"dropdown-menu sfe-dropdown-fixed\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n            style={{ '--sfe-dd-top': `${dropdownPos.top}px`, '--sfe-dd-left': `${dropdownPos.left}px`, '--sfe-dd-width': `${dropdownPos.width}px`, top: 'var(--sfe-dd-top)', left: 'var(--sfe-dd-left)', width: 'var(--sfe-dd-width)' }}\n          >\n            {Object.entries(FILTER_TYPES).map(([type, config]) => (\n              <div key={type} onClick={() => handleAddFilter(type)} className=\"dropdown-menu-item\" role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n                <span\n                  className=\"dropdown-menu-icon\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per filter type\n                  style={{ '--sfe-icon-bg': `${config.color}20`, backgroundColor: 'var(--sfe-icon-bg)' }}\n                >\n                  {config.icon}\n                </span>\n                <span className=\"dropdown-menu-label\">{config.label}</span>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ filters, onChange, schema, availableRefs }", "type": "{ filters: any[]; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "SelectionFilterCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::AddRuleButton", "name": "AddRuleButton", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Function} props.onAdd - Callback when a rule type is selected\n * @param {number} props.depth - Nesting depth (limits nested rule types at depth >= 2)\n */\nexport function AddRuleButton({ onAdd, depth = 0 }) {\n  const [showPicker, setShowPicker] = useState(false);\n\n  return (\n    <div className=\"dropdown\">\n      <button className=\"btn-add\" onClick={() => setShowPicker(!showPicker)}>\n        + Add Rule\n      </button>\n\n      {showPicker && (\n        <div className=\"dropdown-menu arb-dropdown\">\n          <div className=\"dropdown-options\">\n            {Object.entries(APPLICABILITY_TYPES)\n              .filter(([type]) => depth < 2 || (type !== \"or\" && type !== \"and\"))\n              .map(([type, config]) => (\n                <div\n                  key={type}\n                  className=\"dropdown-menu-item\"\n                  onClick={() => {\n                    onAdd(type);\n                    setShowPicker(false);\n                  }}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <div\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n                    style={{ '--arb-icon-bg': `${config.color}20`, backgroundColor: 'var(--arb-icon-bg)' }}\n                  >\n                    {config.icon}\n                  </div>\n                  <div>\n                    <div className=\"dropdown-menu-label\">{config.label}</div>\n                    <div className=\"arb-desc\">\n                      {config.desc}\n                    </div>\n                  </div>\n                </div>\n              ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ onAdd, depth = 0 }", "type": "{ onAdd: Function; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::ApplicabilityRuleCard", "name": "ApplicabilityRuleCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.rule - The rule configuration\n * @param {Function} props.onChange - Callback when rule changes\n * @param {Function} props.onRemove - Callback to remove this rule\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {number} props.depth - Nesting depth for nested rules\n */\nexport function ApplicabilityRuleCard({\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = APPLICABILITY_TYPES[rule.type] || {};\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const getSubtypesForKind = (kind) => {\n    const ek = entityKinds.find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const pressureOptions = (pressures || []).map((p) => ({\n    value: p.id,\n    label: p.name || p.id,\n  }));\n\n  const eraOptions = (eras || []).map((e) => ({\n    value: e.id,\n    label: e.name || e.id,\n  }));\n\n  const updateField = (field, value) => {\n    onChange({ ...rule, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (rule.type) {\n      case \"entity_count\": {\n        const kindSpec = `${rule.kind || \"?\"}${rule.subtype ? \":\" + rule.subtype : \"\"}`;\n        const minPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const maxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${kindSpec} ${minPart}${maxPart}`;\n      }\n      case \"pressure\":\n        return `${rule.pressureId || \"?\"} in [${rule.min ?? \"-\\u221E\"}, ${rule.max ?? \"\\u221E\"}]`;\n      case \"pressure_any_above\":\n        return `Any of [${rule.pressureIds?.join(\", \") || \"?\"}] > ${rule.threshold ?? \"?\"}`;\n      case \"pressure_compare\":\n        return `${rule.pressureA || \"?\"} ${rule.operator || \">\"} ${rule.pressureB || \"?\"}`;\n      case \"relationship_count\": {\n        const relMinPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const relMaxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${rule.relationshipKind || \"any\"} count ${relMinPart}${relMaxPart}`;\n      }\n      case \"relationship_exists\": {\n        const targetSuffix = rule.targetKind ? ` to ${rule.targetKind}` : \"\";\n        return `${rule.relationshipKind || \"?\"} exists${targetSuffix}`;\n      }\n      case \"tag_exists\":\n        return `has tag \"${rule.tag || \"?\"}\"`;\n      case \"tag_absent\":\n        return `missing tag \"${rule.tag || \"?\"}\"`;\n      case \"status\":\n        return rule.not ? `status != ${rule.status || \"?\"}` : `status = ${rule.status || \"?\"}`;\n      case \"prominence\":\n        return `prominence ${rule.min || \"?\"}-${rule.max || \"?\"}`;\n      case \"time_elapsed\":\n        return `${rule.minTicks || \"?\"} ticks since ${rule.since || \"updated\"}`;\n      case \"growth_phases_complete\": {\n        const eraSuffix = rule.eraId ? ` in ${rule.eraId}` : \"\";\n        return `${rule.minPhases ?? \"?\"} growth phases${eraSuffix}`;\n      }\n      case \"era_match\":\n        return rule.eras?.length ? rule.eras.join(\", \") : \"No eras selected\";\n      case \"random_chance\":\n        return `${Math.round((rule.chance ?? 0.5) * 100)}% chance`;\n      case \"cooldown_elapsed\":\n        return `${rule.cooldownTicks ?? \"?\"} ticks since last run`;\n      case \"creations_per_epoch\":\n        return `max ${rule.maxPerEpoch ?? \"?\"} per epoch`;\n      case \"graph_path\":\n        return `graph path (${rule.assert?.check || \"exists\"})`;\n      case \"entity_exists\":\n        return `entity ${rule.entity || \"?\"} exists`;\n      case \"entity_has_relationship\":\n        return `${rule.entity || \"?\"} has ${rule.relationshipKind || \"?\"} relationship`;\n      case \"or\":\n      case \"and\":\n        return `${rule.conditions?.length || 0} sub-rules`;\n      case \"always\":\n        return \"always\";\n      default:\n        return rule.type;\n    }\n  };\n\n  const isNested = rule.type === \"or\" || rule.type === \"and\";\n\n  return (\n    <div className=\"condition-card\">\n      <div className=\"condition-card-header\">\n        <div className=\"condition-card-type\">\n          <div\n            className=\"condition-card-icon\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n            style={{ '--arc-icon-bg': `${typeConfig.color || \"#3b82f6\"}20`, backgroundColor: 'var(--arc-icon-bg)' }}\n          >\n            {typeConfig.icon || \"\ud83d\udccb\"}\n          </div>\n          <div>\n            <div className=\"condition-card-label\">{typeConfig.label || rule.type}</div>\n            <div className=\"condition-card-summary\">{getSummary()}</div>\n          </div>\n        </div>\n        <div className=\"condition-card-actions\">\n          <button className=\"btn-icon\" onClick={() => setExpanded(!expanded)}>\n            {expanded ? \"^\" : \"v\"}\n          </button>\n          <button className=\"btn-icon btn-icon-danger\" onClick={onRemove}>\n            x\n          </button>\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"mt-lg\">\n          <div className=\"form-grid\">\n            {rule.type === \"entity_count\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={rule.kind}\n                  onChange={(v) => {\n                    updateField(\"kind\", v);\n                    if (rule.subtype) updateField(\"subtype\", undefined);\n                  }}\n                  options={entityKindOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Subtype (optional)\"\n                  value={rule.subtype || \"\"}\n                  onChange={(v) => updateField(\"subtype\", v || undefined)}\n                  options={[{ value: \"\", label: \"Any\" }, ...getSubtypesForKind(rule.kind)]}\n                  placeholder=\"Any\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure\"\n                  value={rule.pressureId}\n                  onChange={(v) => updateField(\"pressureId\", v)}\n                  options={pressureOptions}\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min Value\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"0\"\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max Value\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"100\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_any_above\" && (\n              <>\n                <div className=\"grid-col-full\">\n                  <ChipSelect\n                    label=\"Pressures\"\n                    value={rule.pressureIds || []}\n                    onChange={(v) => updateField(\"pressureIds\", v)}\n                    options={pressureOptions}\n                    placeholder=\"+ Add pressure\"\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Threshold\n                  <NumberInput\n                    value={rule.threshold}\n                    onChange={(v) => updateField(\"threshold\", v ?? 0)}\n                    min={-100}\n                    max={100}\n                    integer\n                    placeholder=\"50\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_compare\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure A\"\n                  value={rule.pressureA}\n                  onChange={(v) => updateField(\"pressureA\", v)}\n                  options={pressureOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Operator\"\n                  value={rule.operator || \">\"}\n                  onChange={(v) => updateField(\"operator\", v)}\n                  options={[\n                    { value: \">\", label: \">\" },\n                    { value: \">=\", label: \">=\" },\n                    { value: \"<\", label: \"<\" },\n                    { value: \"<=\", label: \"<=\" },\n                    { value: \"==\", label: \"==\" },\n                    { value: \"!=\", label: \"!=\" },\n                  ]}\n                />\n                <ReferenceDropdown\n                  label=\"Pressure B\"\n                  value={rule.pressureB}\n                  onChange={(v) => updateField(\"pressureB\", v)}\n                  options={pressureOptions}\n                />\n              </>\n            )}\n\n\n            {rule.type === \"era_match\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Eras\"\n                  value={rule.eras || []}\n                  onChange={(v) => updateField(\"eras\", v)}\n                  options={eraOptions}\n                  placeholder=\"+ Add era\"\n                />\n              </div>\n            )}\n\n            {rule.type === \"random_chance\" && (\n              <div className=\"form-group grid-col-full\">\n                <span className=\"label\">Chance (%)</span>\n                <div className=\"flex items-center gap-lg\">\n// ... (truncated)", "parameters": [{"name": "{\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}", "type": "{ rule: any; onChange: Function; onRemove: Function; schema: any; pressures: any[]; eras: any[]; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}, {"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "GraphPathEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ApplicabilityRuleCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::ApplicabilityTab", "name": "ApplicabilityTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n */\nexport function ApplicabilityTab({ generator, onChange, schema, pressures, eras }) {\n  const rules = generator.applicability || [];\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Applicability Rules</div>\n        <div className=\"section-desc\">\n          Define when this generator is eligible to run. If no rules are defined, the generator will\n          always be eligible. Multiple top-level rules are combined with AND logic.\n        </div>\n\n        {rules.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2713</div>\n            <div className=\"empty-state-title\">No applicability rules</div>\n            <div className=\"empty-state-desc\">\n              This generator will always be eligible to run. Add rules to control when it activates.\n            </div>\n          </div>\n        ) : (\n          rules.map((rule, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={rule}\n              onChange={(updated) => {\n                const newRules = [...rules];\n                newRules[index] = updated;\n                onChange({ ...generator, applicability: newRules });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, applicability: rules.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              pressures={pressures}\n              eras={eras}\n            />\n          ))\n        )}\n\n        <AddRuleButton\n          onAdd={(type) => {\n            const newRule = createNewRule(type, pressures);\n            onChange({ ...generator, applicability: [...rules, newRule] });\n          }}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema, pressures, eras }", "type": "{ generator: any; onChange: Function; schema: any; pressures: any[]; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Function} props.onDelete - Callback to delete the generator\n * @param {Function} props.onDuplicate - Callback to duplicate the generator\n */\nexport function OverviewTab({ generator, onChange, onDelete, onDuplicate }) {\n  const updateField = (field, value) => {\n    onChange({ ...generator, [field]: value });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(generator.id, (value) =>\n    updateField(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(generator.name, (value) =>\n    updateField(\"name\", value)\n  );\n\n  const summary = useMemo(() => {\n    return {\n      rules: generator.applicability?.length || 0,\n      variables: Object.keys(generator.variables || {}).length,\n      creates: generator.creation?.length || 0,\n      relationships: generator.relationships?.length || 0,\n      effects: generator.stateUpdates?.length || 0,\n    };\n  }, [generator]);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"generator-id\" className=\"label\">Generator ID</label>\n            <input id=\"generator-id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"display-name\" className=\"label\">Display Name</label>\n            <input id=\"display-name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n              placeholder=\"Optional friendly name\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Enabled\n          <EnableToggle\n            enabled={generator.enabled !== false}\n            onChange={(enabled) => updateField(\"enabled\", enabled)}\n            label={generator.enabled !== false ? \"Generator is active\" : \"Generator is disabled\"}\n          />\n          </label>\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">Narration Template</span>\n          <div className=\"section-desc mb-md\">\n            Syntax: {\"{$target.field}\"}, {\"{$var.field}\"}, {\"{count:kind}\"}, {\"{list:created}\"},{\" \"}\n            {\"{field|fallback}\"}.\n          </div>\n          <LocalTextArea\n            value={generator.narrationTemplate || \"\"}\n            onChange={(value) => updateField(\"narrationTemplate\", value || undefined)}\n            placeholder=\"e.g., From {$target.name}, {count:npc} new souls emerged to shape the realm.\"\n            rows={2}\n          />\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Summary</div>\n        <div className=\"summary-stats-grid\">\n          {[\n            { label: \"Rules\", value: summary.rules, icon: \"\u2713\" },\n            { label: \"Variables\", value: summary.variables, icon: \"\ud83d\udce6\" },\n            { label: \"Creates\", value: summary.creates, icon: \"\u2728\" },\n            { label: \"Connects\", value: summary.relationships, icon: \"\ud83d\udd17\" },\n            { label: \"Effects\", value: summary.effects, icon: \"\u26a1\" },\n          ].map((stat) => (\n            <div key={stat.label} className=\"summary-stat\">\n              <div className=\"summary-stat-icon\">{stat.icon}</div>\n              <div className=\"summary-stat-value\">{stat.value}</div>\n              <div className=\"summary-stat-label\">{stat.label}</div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"danger-zone\">\n        <button className=\"btn btn-secondary\" onClick={onDuplicate}>\n          Duplicate Generator\n        </button>\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete Generator\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, onDelete, onDuplicate }", "type": "{ generator: any; onChange: Function; onDelete: Function; onDuplicate: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useLocalInputState", "count": 2}, {"name": "useMemo", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::TargetTab", "name": "TargetTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema with entity/relationship kinds\n */\nexport function TargetTab({ generator, onChange, schema }) {\n  const selection = generator.selection || { strategy: \"by_kind\" };\n\n  // Get the kind of the first created entity for saturation limit inference\n  const firstCreatedKind = (generator.creation || [])[0]?.kind;\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Target Selection</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What is $target?</div>\n          <div className=\"info-box-text\">\n            The <code className=\"inline-code\">$target</code> is the primary entity this generator\n            operates on. It&apos;s selected from the world graph based on the rules you define here. Once\n            selected, you can reference it in creation rules (e.g., inherit culture from $target)\n            and relationships (e.g., connect new entity to $target).\n          </div>\n        </div>\n\n        <SelectionRuleEditor\n          value={selection}\n          onChange={(updated) => onChange({ ...generator, selection: updated })}\n          schema={schema}\n          availableRefs={[\"$target\", ...Object.keys(generator.variables || {})]}\n        />\n\n        {/* Saturation Limits */}\n        <div className=\"mt-2xl\">\n          <span className=\"label\">Saturation Limits</span>\n          <div className=\"info-box-text mb-lg text-sm\">\n            Limit targets based on existing relationship counts. Only targets with fewer than the\n            max count of relationships will be selected.\n          </div>\n          <SaturationLimitsEditor\n            limits={selection.saturationLimits || []}\n            onChange={(limits) =>\n              onChange({\n                ...generator,\n                selection: {\n                  ...selection,\n                  saturationLimits: limits.length > 0 ? limits : undefined,\n                },\n              })\n            }\n            schema={schema}\n            createdKind={firstCreatedKind}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "SelectionRuleEditor", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SaturationLimitsEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::VariablesTab", "name": "VariablesTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "// ============================================================================\n// VariablesTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n */\nexport function VariablesTab({ generator, onChange, schema }) {\n  const variables = generator.variables || {};\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  // Build available refs for relationship queries (target + other vars + creation refs)\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$target\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    // Ensure the name starts with $\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    // Create with empty required fields - validation will flag them\n    onChange({\n      ...generator,\n      variables: {\n        ...variables,\n        [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"\" } },\n      },\n    });\n    setNewVarName(\"\");\n    setShowAddForm(false);\n  };\n\n  const varEntries = Object.entries(variables);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Variables</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What are variables?</div>\n          <div className=\"info-box-text\">\n            Variables let you select additional entities from the graph to use in creation and\n            relationships. For example, you might select a{\" \"}\n            <code className=\"inline-code\">$faction</code> to make a new NPC a member of, or an{\" \"}\n            <code className=\"inline-code\">$ability</code> for them to practice. Variables are\n            selected after <code className=\"inline-code\">$target</code> is chosen.\n          </div>\n        </div>\n\n        {varEntries.length === 0 && !showAddForm ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udce6</div>\n            <div className=\"empty-state-title\">No variables defined</div>\n            <div className=\"empty-state-desc\">\n              Add variables to select additional entities for use in creation and relationships.\n            </div>\n          </div>\n        ) : (\n          varEntries.map(([name, config]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={config}\n              onChange={(updated) =>\n                onChange({ ...generator, variables: { ...variables, [name]: updated } })\n              }\n              onRemove={() => {\n                const newVars = { ...variables };\n                delete newVars[name];\n                onChange({ ...generator, variables: newVars });\n              }}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::CreationTab", "name": "CreationTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "// ============================================================================\n// CreationTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.tagRegistry - Available tags\n * @param {Function} props.onAddToRegistry - Callback to add new tag to registry\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function CreationTab({\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}) {\n  const creation = generator.creation || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    creation.forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, creation]);\n\n  const culturesById = useMemo(() => {\n    const map = {};\n    (schema?.cultures || []).forEach((culture) => {\n      map[culture.id] = culture;\n    });\n    return map;\n  }, [schema?.cultures]);\n\n  const cultureIds = useMemo(() => Object.keys(culturesById), [culturesById]);\n\n  const handleAdd = () => {\n    const nextNum = creation.length + 1;\n    onChange({\n      ...generator,\n      creation: [\n        ...creation,\n        { entityRef: `$entity${nextNum}`, kind: \"npc\", prominence: \"marginal\" },\n      ],\n    });\n  };\n\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Entity Creation</div>\n        <div className=\"section-desc\">\n          Define entities that this generator creates. Each entity gets a reference (like{\" \"}\n          <code className=\"inline-code\">$hero</code>) that can be used in relationships.\n        </div>\n\n        {creation.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2728</div>\n            <div className=\"empty-state-title\">No entities created</div>\n            <div className=\"empty-state-desc\">\n              This generator only modifies existing entities. Add creation rules to spawn new\n              entities.\n            </div>\n          </div>\n        ) : (\n          creation.map((item, index) => (\n            <CreationCard\n              key={index}\n              item={item}\n              onChange={(updated) => {\n                const newCreation = [...creation];\n                newCreation[index] = updated;\n                onChange({ ...generator, creation: newCreation });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, creation: creation.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n              culturesById={culturesById}\n              cultureIds={cultureIds}\n              generator={generator}\n              tagRegistry={tagRegistry}\n              onAddToRegistry={onAddToRegistry}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Entity Creation\n        </button>\n      </div>\n\n      <VariantsSection\n        generator={generator}\n        onChange={onChange}\n        pressures={pressures}\n        schema={schema}\n        tagRegistry={tagRegistry}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}", "type": "{ generator: any; onChange: Function; schema: any; tagRegistry: any[]; onAddToRegistry: Function; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "VariantsSection", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 3}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::RelationshipsTab", "name": "RelationshipsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n */\nexport function RelationshipsTab({ generator, onChange, schema }) {\n  const relationships = generator.relationships || [];\n  const saturationLimits = generator.selection?.saturationLimits || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, generator.creation]);\n\n  // Find the first created entity ref for implied relationships\n  const firstCreatedRef = useMemo(() => {\n    const creation = generator.creation || [];\n    return creation.length > 0 ? creation[0].entityRef : \"$created\";\n  }, [generator.creation]);\n\n  const handleAdd = () => {\n    onChange({\n      ...generator,\n      relationships: [\n        ...relationships,\n        {\n          kind: schema?.relationshipKinds?.[0]?.kind || \"ally_of\",\n          src: availableRefs[1] || \"$entity1\",\n          dst: \"$target\",\n          strength: 0.8,\n        },\n      ],\n    });\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Relationships</div>\n        <div className=\"section-desc\">\n          Define relationships created between entities. Use entity references like{\" \"}\n          <code className=\"inline-code\">$target</code>, created entities like{\" \"}\n          <code className=\"inline-code\">$hero</code>, or variables like{\" \"}\n          <code className=\"inline-code\">$faction</code>.\n        </div>\n\n        {/* Implied relationships from saturation limits */}\n        {saturationLimits.length > 0 && (\n          <div className=\"mb-xl\">\n            {saturationLimits.map((limit, index) => (\n              <ImpliedRelationshipCard\n                key={`implied-${index}`}\n                saturationLimit={limit}\n                schema={schema}\n                createdEntityRef={firstCreatedRef}\n              />\n            ))}\n          </div>\n        )}\n\n        {relationships.length === 0 && saturationLimits.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udd17</div>\n            <div className=\"empty-state-title\">No relationships</div>\n            <div className=\"empty-state-desc\">\n              This generator doesn&apos;t create any relationships. Add relationships to connect\n              entities.\n            </div>\n          </div>\n        ) : (\n          relationships.map((rel, index) => (\n            <RelationshipCard\n              key={index}\n              rel={rel}\n              onChange={(updated) => {\n                const newRels = [...relationships];\n                newRels[index] = updated;\n                onChange({ ...generator, relationships: newRels });\n              }}\n              onRemove={() =>\n                onChange({\n                  ...generator,\n                  relationships: relationships.filter((_, i) => i !== index),\n                })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Relationship\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ImpliedRelationshipCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::EffectsTab", "name": "EffectsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Object} props.schema - Domain schema\n */\nexport function EffectsTab({ generator, onChange, pressures, schema }) {\n  const stateUpdates = generator.stateUpdates || [];\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const addButtonRef = useRef(null);\n\n  // Build available entity references from target + variables + created entities\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, generator.creation]);\n\n  const createMutation = (type) => {\n    let newUpdate;\n    switch (type) {\n      case \"modify_pressure\":\n        newUpdate = { type: \"modify_pressure\", pressureId: pressures?.[0]?.id || \"\", delta: 0 };\n        break;\n      case \"archive_relationship\":\n        newUpdate = {\n          type: \"archive_relationship\",\n          entity: \"$target\",\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n        break;\n      case \"change_status\":\n        newUpdate = { type: \"change_status\", entity: \"$target\", newStatus: \"\" };\n        break;\n      case \"set_tag\":\n        newUpdate = { type: \"set_tag\", entity: \"$target\", tag: \"\", value: true };\n        break;\n      case \"remove_tag\":\n        newUpdate = { type: \"remove_tag\", entity: \"$target\", tag: \"\" };\n        break;\n      case \"update_rate_limit\":\n        newUpdate = { type: \"update_rate_limit\" };\n        break;\n      default:\n        return null;\n    }\n    return newUpdate;\n  };\n\n  const addMutation = (type) => {\n    const next = createMutation(type);\n    if (!next) return;\n    onChange({ ...generator, stateUpdates: [...stateUpdates, next] });\n  };\n\n  const updateMutation = (index, updated) => {\n    const newUpdates = [...stateUpdates];\n    newUpdates[index] = updated;\n    onChange({ ...generator, stateUpdates: newUpdates });\n  };\n\n  const removeMutation = (index) => {\n    onChange({ ...generator, stateUpdates: stateUpdates.filter((_, i) => i !== index) });\n  };\n\n  const knownTypes = new Set(DEFAULT_MUTATION_TYPES.map((type) => type.value));\n  const unrecognizedUpdates = stateUpdates\n    .map((update, index) => (knownTypes.has(update.type) ? null : { update, index }))\n    .filter(Boolean);\n\n  useLayoutEffect(() => {\n    if (showTypeMenu && addButtonRef.current) {\n      const rect = addButtonRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (event) => {\n      if (addButtonRef.current && !addButtonRef.current.contains(event.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  return (\n    <div>\n      {/* Unrecognized Effects - shown first to draw attention */}\n      {unrecognizedUpdates.length > 0 && (\n        <div className=\"section et-unrecognized-section\">\n          <div className=\"section-title et-unrecognized-title\">\n            <span>\u26a0\ufe0f</span> Unrecognized Effects\n          </div>\n          <div className=\"section-desc mb-lg\">\n            These state updates have unrecognized types and may be from an older version. Remove\n            them to clear validation errors.\n          </div>\n\n          {unrecognizedUpdates.map((entry) => {\n            const globalIdx = entry.index;\n            const update = entry.update;\n            return (\n              <div\n                key={globalIdx}\n                className=\"item-card et-unrecognized-card\"\n              >\n                <div className=\"et-unrecognized-body\">\n                  <div className=\"et-unrecognized-layout\">\n                    <div className=\"flex-1\">\n                      <div className=\"et-unrecognized-type\">\n                        Unknown type: &quot;{update.type || \"(no type)\"}&quot;\n                      </div>\n                      <pre className=\"et-unrecognized-json\">\n                        {JSON.stringify(update, null, 2)}\n                      </pre>\n                    </div>\n                    <button\n                      className=\"btn btn-danger flex-shrink-0\"\n                      onClick={() => removeMutation(globalIdx)}\n                    >\n                      Remove\n                    </button>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u26a1 Effects ({stateUpdates.length})</div>\n        <div className=\"section-desc\">\n          Apply state updates when this generator runs. Effects use the unified mutation library.\n        </div>\n\n        {stateUpdates.map((update, index) => {\n          if (!knownTypes.has(update.type)) return null;\n          return (\n            <MutationCard\n              key={index}\n              mutation={update}\n              onChange={(updated) => updateMutation(index, updated)}\n              onRemove={() => removeMutation(index)}\n              schema={schema}\n              pressures={pressures}\n              entityOptions={availableRefs}\n              typeOptions={DEFAULT_MUTATION_TYPES}\n              createMutation={createMutation}\n            />\n          );\n        })}\n\n        <div ref={addButtonRef} className=\"relative mt-lg\">\n          <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n            + Add Effect\n          </button>\n\n          {showTypeMenu && (\n            <div\n              className=\"dropdown-menu et-dropdown-fixed\"\n              // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n              style={{ '--et-dd-top': `${dropdownPos.top}px`, '--et-dd-left': `${dropdownPos.left}px`, '--et-dd-width': `${dropdownPos.width}px`, top: 'var(--et-dd-top)', left: 'var(--et-dd-left)', width: 'var(--et-dd-width)' }}\n            >\n              {MUTATION_TYPE_OPTIONS.map((opt) => (\n                <div\n                  key={opt.value}\n                  onClick={() => {\n                    addMutation(opt.value);\n                    setShowTypeMenu(false);\n                  }}\n                  className=\"dropdown-menu-item\"\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <span\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per mutation type\n                    style={{ '--et-icon-bg': `${opt.color}20`, backgroundColor: 'var(--et-icon-bg)' }}\n                  >\n                    {opt.icon}\n                  </span>\n                  <span className=\"dropdown-menu-label\">{opt.label}</span>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, pressures, schema }", "type": "{ generator: any; onChange: Function; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "pre", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "MutationCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useMemo", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/naming-profile-viewer/index.js::NamingProfileMappingViewer", "name": "NamingProfileMappingViewer", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/naming-profile-viewer/index.js", "sourceCode": "export default function NamingProfileMappingViewer({ generators = [], schema = {} }) {\n  const [showInherited, setShowInherited] = useState(false);\n\n  const { mappings, warnings } = useMemo(\n    () => analyzeNamingMappings(generators, schema),\n    [generators, schema]\n  );\n\n  // Group by generator for display\n  const groupedMappings = useMemo(() => {\n    const groups = {};\n    for (const m of mappings) {\n      if (!groups[m.generatorId]) {\n        groups[m.generatorId] = {\n          generatorId: m.generatorId,\n          generatorName: m.generatorName,\n          items: [],\n        };\n      }\n      groups[m.generatorId].items.push(m);\n    }\n    return Object.values(groups);\n  }, [mappings]);\n\n  // Filter warnings - show all by default, but can filter to just explicit cultures\n  const displayWarnings = showInherited\n    ? warnings\n    : warnings.filter(\n        (w) => w.cultureSource === \"explicit\" || w.reason === \"No matching strategy group\"\n      );\n\n  const successCount = mappings.filter((m) => m.match).length;\n  const warningCount = warnings.filter((w) => w.reason === \"No matching strategy group\").length;\n\n  if (mappings.length === 0) {\n    return (\n      <div className=\"naming-profile-container\">\n        <div className=\"naming-profile-header\">\n          <div className=\"naming-profile-title\">\n            <span>Naming Profile Mappings</span>\n          </div>\n        </div>\n        <div className=\"naming-profile-empty-state\">\n          No generators with entity creation defined. Add generators to see naming profile mappings.\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"naming-profile-container\">\n      <div className=\"naming-profile-header\">\n        <div className=\"naming-profile-title\">\n          <span>Naming Profile Mappings</span>\n        </div>\n        <div className=\"naming-profile-stats\">\n          <div className=\"naming-profile-stat-item\">\n            <span className=\"naming-profile-stat-value text-success\">{successCount}</span>\n            <span>matched</span>\n          </div>\n          <div className=\"naming-profile-stat-item\">\n            <span\n              className={`naming-profile-stat-value ${warningCount > 0 ? \"text-danger\" : \"text-muted\"}`}\n            >\n              {warningCount}\n            </span>\n            <span>missing</span>\n          </div>\n          <label className=\"cursor-pointer flex items-center gap-xs\">\n            <input\n              type=\"checkbox\"\n              checked={showInherited}\n              onChange={(e) => setShowInherited(e.target.checked)}\n            />\n            <span>Show inherited cultures</span>\n          </label>\n        </div>\n      </div>\n\n      <div className=\"naming-profile-content\">\n        {/* Warnings section */}\n        {displayWarnings.length > 0 && (\n          <div className=\"naming-profile-section\">\n            <div className=\"naming-profile-section-title\">\n              <span className=\"naming-profile-warning-icon\">Warning</span>\n              <span>Naming May Fail ({displayWarnings.length})</span>\n            </div>\n            <div className=\"naming-profile-warning-list\">\n              {displayWarnings.slice(0, 10).map((w, i) => (\n                <div\n                  key={`${w.generatorId}-${w.cultureId}-${i}`}\n                  className=\"naming-profile-warning-item\"\n                >\n                  <span className=\"naming-profile-warning-icon\">!</span>\n                  <span>\n                    <strong>{w.generatorName}</strong> creates <strong>{w.entityKind}</strong>\n                    {w.subtype && `:${w.subtype}`} for culture <strong>{w.cultureName}</strong> -{\" \"}\n                    {w.reason}\n                  </span>\n                </div>\n              ))}\n              {displayWarnings.length > 10 && (\n                <div\n                  className=\"text-muted py-md px-lg\"\n                >\n                  ... and {displayWarnings.length - 10} more\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Mappings table */}\n        <div className=\"naming-profile-section\">\n          <div className=\"naming-profile-section-title\">\n            <span>Entity Creation to Naming Profile</span>\n          </div>\n          <table className=\"naming-profile-mapping-table\">\n            <thead>\n              <tr>\n                <th className=\"naming-profile-table-header\">Generator</th>\n                <th className=\"naming-profile-table-header\">Entity Kind</th>\n                <th className=\"naming-profile-table-header\">Culture</th>\n                <th className=\"naming-profile-table-header\">Naming Profile</th>\n              </tr>\n            </thead>\n            <tbody>\n              {groupedMappings.slice(0, 20).flatMap((group) => {\n                // Filter items based on showInherited toggle\n                const filteredItems = showInherited\n                  ? group.items\n                  : group.items.filter(\n                      (m) => m.cultureSource === \"explicit\" || m.cultureSource === \"any\"\n                    );\n                // If no explicit cultures, show first inherited one as representative\n                const displayItems =\n                  filteredItems.length > 0 ? filteredItems : group.items.slice(0, 1);\n                return displayItems.map((m, idx) => (\n                  <tr\n                    key={`${m.generatorId}-${m.cultureId}-${m.entityKind}-${idx}`}\n                    className={`naming-profile-table-row ${!m.match && m.hasNamingProfile ? \"naming-profile-warning-row\" : \"\"}`}\n                  >\n                    <td className=\"naming-profile-table-cell naming-profile-generator-cell\">\n                      {idx === 0 ? m.generatorName : \"\"}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <span className=\"naming-profile-kind-badge\">{m.entityKind}</span>\n                      {m.subtype && (\n                        <span\n                          className=\"naming-profile-kind-badge naming-profile-kind-badge-transparent\"\n                        >\n                          {m.subtype}\n                        </span>\n                      )}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <div className=\"naming-profile-culture-cell\">\n                        {/* eslint-disable-next-line local/no-inline-styles -- dynamic culture color */}\n                        <span\n                          className=\"naming-profile-culture-dot\"\n                          style={{ '--npm-culture-color': m.cultureColor, backgroundColor: 'var(--npm-culture-color)' }}\n                        />\n                        <span>{m.cultureName}</span>\n                        {m.cultureSource === \"inherited\" && (\n                          <span className=\"naming-profile-badge naming-profile-badge-inherited\">\n                            inherited\n                          </span>\n                        )}\n                      </div>\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      {m.match && (\n                        <span className=\"naming-profile-badge naming-profile-badge-match\">\n                          {m.match.profileName || m.match.profileId}\n                          {m.match.groupName && ` / ${m.match.groupName}`}\n                        </span>\n                      )}\n                      {!m.match && !m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No profiles configured\n                        </span>\n                      )}\n                      {!m.match && m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No matching group\n                        </span>\n                      )}\n                    </td>\n                  </tr>\n                ));\n              })}\n            </tbody>\n          </table>\n          {groupedMappings.length > 20 && (\n            <div className=\"text-muted text-center text-xs p-md\">\n              Showing first 20 generators. Total: {groupedMappings.length}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generators = [], schema = {} }", "type": "{ generators?: any[]; schema?: {}; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}, {"name": "useMemo", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/naming-profile-viewer/NamingProfileMappingViewer.jsx::NamingProfileMappingViewer", "name": "NamingProfileMappingViewer", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/naming-profile-viewer/NamingProfileMappingViewer.jsx", "sourceCode": "export default function NamingProfileMappingViewer({ generators = [], schema = {} }) {\n  const [showInherited, setShowInherited] = useState(false);\n\n  const { mappings, warnings } = useMemo(\n    () => analyzeNamingMappings(generators, schema),\n    [generators, schema]\n  );\n\n  // Group by generator for display\n  const groupedMappings = useMemo(() => {\n    const groups = {};\n    for (const m of mappings) {\n      if (!groups[m.generatorId]) {\n        groups[m.generatorId] = {\n          generatorId: m.generatorId,\n          generatorName: m.generatorName,\n          items: [],\n        };\n      }\n      groups[m.generatorId].items.push(m);\n    }\n    return Object.values(groups);\n  }, [mappings]);\n\n  // Filter warnings - show all by default, but can filter to just explicit cultures\n  const displayWarnings = showInherited\n    ? warnings\n    : warnings.filter(\n        (w) => w.cultureSource === \"explicit\" || w.reason === \"No matching strategy group\"\n      );\n\n  const successCount = mappings.filter((m) => m.match).length;\n  const warningCount = warnings.filter((w) => w.reason === \"No matching strategy group\").length;\n\n  if (mappings.length === 0) {\n    return (\n      <div className=\"naming-profile-container\">\n        <div className=\"naming-profile-header\">\n          <div className=\"naming-profile-title\">\n            <span>Naming Profile Mappings</span>\n          </div>\n        </div>\n        <div className=\"naming-profile-empty-state\">\n          No generators with entity creation defined. Add generators to see naming profile mappings.\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"naming-profile-container\">\n      <div className=\"naming-profile-header\">\n        <div className=\"naming-profile-title\">\n          <span>Naming Profile Mappings</span>\n        </div>\n        <div className=\"naming-profile-stats\">\n          <div className=\"naming-profile-stat-item\">\n            <span className=\"naming-profile-stat-value text-success\">{successCount}</span>\n            <span>matched</span>\n          </div>\n          <div className=\"naming-profile-stat-item\">\n            <span\n              className={`naming-profile-stat-value ${warningCount > 0 ? \"text-danger\" : \"text-muted\"}`}\n            >\n              {warningCount}\n            </span>\n            <span>missing</span>\n          </div>\n          <label className=\"cursor-pointer flex items-center gap-xs\">\n            <input\n              type=\"checkbox\"\n              checked={showInherited}\n              onChange={(e) => setShowInherited(e.target.checked)}\n            />\n            <span>Show inherited cultures</span>\n          </label>\n        </div>\n      </div>\n\n      <div className=\"naming-profile-content\">\n        {/* Warnings section */}\n        {displayWarnings.length > 0 && (\n          <div className=\"naming-profile-section\">\n            <div className=\"naming-profile-section-title\">\n              <span className=\"naming-profile-warning-icon\">Warning</span>\n              <span>Naming May Fail ({displayWarnings.length})</span>\n            </div>\n            <div className=\"naming-profile-warning-list\">\n              {displayWarnings.slice(0, 10).map((w, i) => (\n                <div\n                  key={`${w.generatorId}-${w.cultureId}-${i}`}\n                  className=\"naming-profile-warning-item\"\n                >\n                  <span className=\"naming-profile-warning-icon\">!</span>\n                  <span>\n                    <strong>{w.generatorName}</strong> creates <strong>{w.entityKind}</strong>\n                    {w.subtype && `:${w.subtype}`} for culture <strong>{w.cultureName}</strong> -{\" \"}\n                    {w.reason}\n                  </span>\n                </div>\n              ))}\n              {displayWarnings.length > 10 && (\n                <div\n                  className=\"text-muted py-md px-lg\"\n                >\n                  ... and {displayWarnings.length - 10} more\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Mappings table */}\n        <div className=\"naming-profile-section\">\n          <div className=\"naming-profile-section-title\">\n            <span>Entity Creation to Naming Profile</span>\n          </div>\n          <table className=\"naming-profile-mapping-table\">\n            <thead>\n              <tr>\n                <th className=\"naming-profile-table-header\">Generator</th>\n                <th className=\"naming-profile-table-header\">Entity Kind</th>\n                <th className=\"naming-profile-table-header\">Culture</th>\n                <th className=\"naming-profile-table-header\">Naming Profile</th>\n              </tr>\n            </thead>\n            <tbody>\n              {groupedMappings.slice(0, 20).flatMap((group) => {\n                // Filter items based on showInherited toggle\n                const filteredItems = showInherited\n                  ? group.items\n                  : group.items.filter(\n                      (m) => m.cultureSource === \"explicit\" || m.cultureSource === \"any\"\n                    );\n                // If no explicit cultures, show first inherited one as representative\n                const displayItems =\n                  filteredItems.length > 0 ? filteredItems : group.items.slice(0, 1);\n                return displayItems.map((m, idx) => (\n                  <tr\n                    key={`${m.generatorId}-${m.cultureId}-${m.entityKind}-${idx}`}\n                    className={`naming-profile-table-row ${!m.match && m.hasNamingProfile ? \"naming-profile-warning-row\" : \"\"}`}\n                  >\n                    <td className=\"naming-profile-table-cell naming-profile-generator-cell\">\n                      {idx === 0 ? m.generatorName : \"\"}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <span className=\"naming-profile-kind-badge\">{m.entityKind}</span>\n                      {m.subtype && (\n                        <span\n                          className=\"naming-profile-kind-badge naming-profile-kind-badge-transparent\"\n                        >\n                          {m.subtype}\n                        </span>\n                      )}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <div className=\"naming-profile-culture-cell\">\n                        {/* eslint-disable-next-line local/no-inline-styles -- dynamic culture color */}\n                        <span\n                          className=\"naming-profile-culture-dot\"\n                          style={{ '--npm-culture-color': m.cultureColor, backgroundColor: 'var(--npm-culture-color)' }}\n                        />\n                        <span>{m.cultureName}</span>\n                        {m.cultureSource === \"inherited\" && (\n                          <span className=\"naming-profile-badge naming-profile-badge-inherited\">\n                            inherited\n                          </span>\n                        )}\n                      </div>\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      {m.match && (\n                        <span className=\"naming-profile-badge naming-profile-badge-match\">\n                          {m.match.profileName || m.match.profileId}\n                          {m.match.groupName && ` / ${m.match.groupName}`}\n                        </span>\n                      )}\n                      {!m.match && !m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No profiles configured\n                        </span>\n                      )}\n                      {!m.match && m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No matching group\n                        </span>\n                      )}\n                    </td>\n                  </tr>\n                ));\n              })}\n            </tbody>\n          </table>\n          {groupedMappings.length > 20 && (\n            <div className=\"text-muted text-center text-xs p-md\">\n              Showing first 20 generators. Total: {groupedMappings.length}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generators = [], schema = {} }", "type": "{ generators?: any[]; schema?: {}; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}, {"name": "useMemo", "count": 2}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./naming-profile-viewer.css", "specifiers": [], "category": "internal"}, {"source": "./utils", "specifiers": ["analyzeNamingMappings"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/pressures/index.js::PressuresEditor", "name": "PressuresEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/index.js", "sourceCode": "export default function PressuresEditor({ projectId, pressures = [], onChange, schema, usageMap }) {\n  const [expandedPressure, setExpandedPressure] = useState(null);\n  const factorModalKey = buildStorageKey(projectId, \"pressures:factorModal\");\n  const restoredRef = useRef(false);\n\n  useEffect(() => {\n    restoredRef.current = false;\n  }, [factorModalKey]);\n\n  // Restore expanded pressure from storage (one-time per modal key)\n  useEffect(() => {\n    if (restoredRef.current || !factorModalKey || pressures.length === 0) return;\n\n    const stored = loadStoredValue(factorModalKey);\n    if (stored?.pressureId) {\n      const index = pressures.findIndex((pressure) => pressure.id === stored.pressureId);\n      if (index >= 0) {\n        // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted UI expansion state\n        setExpandedPressure(index);\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    }\n    restoredRef.current = true;\n  }, [factorModalKey, pressures]);\n\n  const handlePressureChange = useCallback(\n    (index, updatedPressure) => {\n      const newPressures = [...pressures];\n      newPressures[index] = updatedPressure;\n      onChange(newPressures);\n    },\n    [pressures, onChange]\n  );\n\n  const handleDeletePressure = useCallback(\n    (index) => {\n      if (confirm(`Delete \"${pressures[index].name}\"?`)) {\n        const newPressures = pressures.filter((_, i) => i !== index);\n        onChange(newPressures);\n        if (expandedPressure === index) {\n          setExpandedPressure(null);\n        }\n      }\n    },\n    [pressures, onChange, expandedPressure]\n  );\n\n  const handleAddPressure = useCallback(() => {\n    const newPressure = {\n      id: `pressure_${Date.now()}`,\n      name: \"New Pressure\",\n      initialValue: 0,\n      homeostasis: 0.05,\n      description: \"\",\n      growth: {\n        positiveFeedback: [],\n        negativeFeedback: [],\n      },\n    };\n    onChange([...pressures, newPressure]);\n    setExpandedPressure(pressures.length);\n  }, [pressures, onChange]);\n\n  if (pressures.length === 0) {\n    return (\n      <div className=\"editor-container\">\n        <div className=\"header\">\n          <h1 className=\"title\">Pressures</h1>\n          <p className=\"subtitle\">\n            Configure environmental and social pressures that drive world evolution\n          </p>\n        </div>\n        <div className=\"empty-state\">\n          <div className=\"empty-state-icon\">\ud83c\udf21\ufe0f</div>\n          <div className=\"pe-empty-title\">\n            No pressures defined\n          </div>\n          <div className=\"pe-empty-desc\">\n            Pressures respond to world state with feedback and a pull toward equilibrium, driving\n            the narrative forward.\n          </div>\n          <button\n            className=\"btn btn-primary pe-create-btn\"\n            onClick={handleAddPressure}\n          >\n            + Create First Pressure\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Pressures</h1>\n        <p className=\"subtitle\">\n          Configure environmental and social pressures that drive world evolution. Each pressure has\n          feedback factors that make it grow or shrink based on world state plus a homeostatic pull\n          toward equilibrium.\n        </p>\n      </div>\n\n      <div className=\"list-stack\">\n        {pressures.map((pressure, index) => (\n          <PressureCard\n            key={index}\n            pressure={pressure}\n            expanded={expandedPressure === index}\n            onToggle={() => setExpandedPressure(expandedPressure === index ? null : index)}\n            onChange={(updatedPressure) => handlePressureChange(index, updatedPressure)}\n            onDelete={() => handleDeletePressure(index)}\n            schema={schema}\n            usageMap={usageMap}\n            projectId={projectId}\n          />\n        ))}\n\n        <button className=\"btn btn-add\" onClick={handleAddPressure}>\n          + Add Pressure\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ projectId, pressures = [], onChange, schema, usageMap }", "type": "{ projectId: any; pressures?: any[]; onChange: any; schema: any; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "h1", "children": [], "isMap": false, "isConditional": false}, {"tag": "p", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}, {"name": "useRef", "count": 1}, {"name": "useEffect", "count": 2}, {"name": "useCallback", "count": 3}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/pressures/PressuresEditor.jsx::PressuresEditor", "name": "PressuresEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/PressuresEditor.jsx", "sourceCode": "export default function PressuresEditor({ projectId, pressures = [], onChange, schema, usageMap }) {\n  const [expandedPressure, setExpandedPressure] = useState(null);\n  const factorModalKey = buildStorageKey(projectId, \"pressures:factorModal\");\n  const restoredRef = useRef(false);\n\n  useEffect(() => {\n    restoredRef.current = false;\n  }, [factorModalKey]);\n\n  // Restore expanded pressure from storage (one-time per modal key)\n  useEffect(() => {\n    if (restoredRef.current || !factorModalKey || pressures.length === 0) return;\n\n    const stored = loadStoredValue(factorModalKey);\n    if (stored?.pressureId) {\n      const index = pressures.findIndex((pressure) => pressure.id === stored.pressureId);\n      if (index >= 0) {\n        // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted UI expansion state\n        setExpandedPressure(index);\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    }\n    restoredRef.current = true;\n  }, [factorModalKey, pressures]);\n\n  const handlePressureChange = useCallback(\n    (index, updatedPressure) => {\n      const newPressures = [...pressures];\n      newPressures[index] = updatedPressure;\n      onChange(newPressures);\n    },\n    [pressures, onChange]\n  );\n\n  const handleDeletePressure = useCallback(\n    (index) => {\n      if (confirm(`Delete \"${pressures[index].name}\"?`)) {\n        const newPressures = pressures.filter((_, i) => i !== index);\n        onChange(newPressures);\n        if (expandedPressure === index) {\n          setExpandedPressure(null);\n        }\n      }\n    },\n    [pressures, onChange, expandedPressure]\n  );\n\n  const handleAddPressure = useCallback(() => {\n    const newPressure = {\n      id: `pressure_${Date.now()}`,\n      name: \"New Pressure\",\n      initialValue: 0,\n      homeostasis: 0.05,\n      description: \"\",\n      growth: {\n        positiveFeedback: [],\n        negativeFeedback: [],\n      },\n    };\n    onChange([...pressures, newPressure]);\n    setExpandedPressure(pressures.length);\n  }, [pressures, onChange]);\n\n  if (pressures.length === 0) {\n    return (\n      <div className=\"editor-container\">\n        <div className=\"header\">\n          <h1 className=\"title\">Pressures</h1>\n          <p className=\"subtitle\">\n            Configure environmental and social pressures that drive world evolution\n          </p>\n        </div>\n        <div className=\"empty-state\">\n          <div className=\"empty-state-icon\">\ud83c\udf21\ufe0f</div>\n          <div className=\"pe-empty-title\">\n            No pressures defined\n          </div>\n          <div className=\"pe-empty-desc\">\n            Pressures respond to world state with feedback and a pull toward equilibrium, driving\n            the narrative forward.\n          </div>\n          <button\n            className=\"btn btn-primary pe-create-btn\"\n            onClick={handleAddPressure}\n          >\n            + Create First Pressure\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Pressures</h1>\n        <p className=\"subtitle\">\n          Configure environmental and social pressures that drive world evolution. Each pressure has\n          feedback factors that make it grow or shrink based on world state plus a homeostatic pull\n          toward equilibrium.\n        </p>\n      </div>\n\n      <div className=\"list-stack\">\n        {pressures.map((pressure, index) => (\n          <PressureCard\n            key={index}\n            pressure={pressure}\n            expanded={expandedPressure === index}\n            onToggle={() => setExpandedPressure(expandedPressure === index ? null : index)}\n            onChange={(updatedPressure) => handlePressureChange(index, updatedPressure)}\n            onDelete={() => handleDeletePressure(index)}\n            schema={schema}\n            usageMap={usageMap}\n            projectId={projectId}\n          />\n        ))}\n\n        <button className=\"btn btn-add\" onClick={handleAddPressure}>\n          + Add Pressure\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ projectId, pressures = [], onChange, schema, usageMap }", "type": "{ projectId: any; pressures?: any[]; onChange: any; schema: any; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "h1", "children": [], "isMap": false, "isConditional": false}, {"tag": "p", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}, {"name": "useRef", "count": 1}, {"name": "useEffect", "count": 2}, {"name": "useCallback", "count": 3}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useCallback", "useEffect", "useRef"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./cards", "specifiers": ["PressureCard"], "category": "internal"}, {"source": "../../utils/persistence", "specifiers": ["buildStorageKey", "clearStoredValue", "loadStoredValue"], "category": "internal"}, {"source": "./PressuresEditor.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::ReferenceDropdown", "name": "ReferenceDropdown", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.value - Current selected value\n * @param {Function} props.onChange - Callback when selection changes\n * @param {Array<{value: string, label?: string, meta?: string}>} props.options - Array of options\n * @param {string} [props.placeholder] - Placeholder text for empty selection\n * @param {string} [props.label] - Optional label above the dropdown\n * @param {boolean} [props.searchable] - Enable searchable popover mode (default: false)\n * @param {string} [props.className] - Additional class names\n */\nexport function ReferenceDropdown({\n  value,\n  onChange,\n  options,\n  placeholder,\n  label,\n  searchable = false,\n  className = '',\n}) {\n  const generatedId = useId();\n  // Searchable mode state\n  const [isOpen, setIsOpen] = useState(false);\n  const [search, setSearch] = useState('');\n  const containerRef = useRef(null);\n\n  // Close on outside click (searchable mode)\n  useEffect(() => {\n    if (!searchable) return;\n\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, [searchable]);\n\n  // Filter options in searchable mode\n  const filteredOptions = useMemo(() => {\n    if (!searchable || !search) return options;\n    const lower = search.toLowerCase();\n    return options.filter(\n      (opt) =>\n        opt.value.toLowerCase().includes(lower) ||\n        opt.label?.toLowerCase().includes(lower)\n    );\n  }, [options, search, searchable]);\n\n  const selectedOption = options.find((opt) => opt.value === value);\n\n  // Simple mode: render a standard <select>\n  if (!searchable) {\n    return (\n      <div className={`form-group ${className}`.trim()}>\n        {label && <label htmlFor={generatedId} className=\"label\">{label}</label>}\n        <select id={generatedId}\n          className=\"select\"\n          value={value || ''}\n          onChange={(e) => onChange(e.target.value || undefined)}\n        >\n          <option value=\"\">{placeholder || 'Select...'}</option>\n          {options.map((opt) => (\n            <option key={opt.value} value={opt.value}>\n              {opt.label || opt.value}\n            </option>\n          ))}\n        </select>\n      </div>\n    );\n  }\n\n  // Searchable mode: render popover with search\n  return (\n    <div className={`form-group ${className}`.trim()}>\n      {label && <label className=\"label\">{label}</label>}\n      <div ref={containerRef} className=\"dropdown\">\n        <div\n          className=\"dropdown-trigger\"\n          onClick={() => setIsOpen(!isOpen)}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n        >\n          <span className={selectedOption ? '' : 'dropdown-trigger-placeholder'}>\n            {selectedOption?.label ||\n              selectedOption?.value ||\n              placeholder ||\n              'Select...'}\n          </span>\n          <span className=\"dropdown-arrow\">\u25bc</span>\n        </div>\n        {isOpen && (\n          <div className=\"dropdown-menu\">\n            <div className=\"dropdown-search\">\n              <input\n                type=\"text\"\n                className=\"dropdown-search-input\"\n                placeholder=\"Search...\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n                onClick={(e) => e.stopPropagation()}\n                // eslint-disable-next-line jsx-a11y/no-autofocus\n                autoFocus\n              />\n            </div>\n            <div className=\"dropdown-options\">\n              {filteredOptions.length === 0 ? (\n                <div className=\"dropdown-empty\">No options found</div>\n              ) : (\n                filteredOptions.map((opt) => (\n                  <div\n                    key={opt.value}\n                    className={`dropdown-option ${value === opt.value ? 'dropdown-option-selected' : ''}`}\n                    onClick={() => {\n                      onChange(opt.value);\n                      setIsOpen(false);\n                      setSearch('');\n                    }}\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    <span>{opt.label || opt.value}</span>\n                    {opt.meta && (\n                      <span className=\"dropdown-option-meta\">{opt.meta}</span>\n                    )}\n                  </div>\n                ))\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  value,\n  onChange,\n  options,\n  placeholder,\n  label,\n  searchable = false,\n  className = '',\n}", "type": "{ value: string; onChange: Function; options: Array<{ value: string; label?: string; meta?: string; }>; placeholder?: string; label?: string; searchable?: boolean; className?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": true}, {"tag": "select", "children": [{"tag": "option", "children": [], "isMap": false, "isConditional": false}, {"tag": "option", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useId", "count": 1}, {"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useEffect", "count": 1}, {"name": "useMemo", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::ChipSelect", "name": "ChipSelect", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {string[]} props.value - Array of selected values\n * @param {Function} props.onChange - Callback when selection changes\n * @param {Array<{value: string, label?: string}>} props.options - Available options\n * @param {string} [props.placeholder] - Placeholder text when empty\n * @param {string} [props.label] - Optional label above the component\n */\nexport function ChipSelect({\n  value = [],\n  onChange,\n  options,\n  placeholder = 'Add...',\n  label,\n}) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [search, setSearch] = useState('');\n  const containerRef = useRef(null);\n  const inputRef = useRef(null);\n\n  useEffect(() => {\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const availableOptions = useMemo(() => {\n    return options.filter(opt => !value.includes(opt.value));\n  }, [options, value]);\n\n  const filteredOptions = useMemo(() => {\n    if (!search) return availableOptions;\n    const lower = search.toLowerCase();\n    return availableOptions.filter(opt =>\n      opt.value.toLowerCase().includes(lower) ||\n      opt.label?.toLowerCase().includes(lower)\n    );\n  }, [availableOptions, search]);\n\n  const handleSelect = (optValue) => {\n    onChange([...value, optValue]);\n    setSearch('');\n    inputRef.current?.focus();\n  };\n\n  const handleRemove = (optValue) => {\n    onChange(value.filter(v => v !== optValue));\n  };\n\n  const getLabel = (val) => {\n    const opt = options.find(o => o.value === val);\n    return opt?.label || val;\n  };\n\n  return (\n    <div className=\"form-group\">\n      {label && <label className=\"label\">{label}</label>}\n      <div ref={containerRef} className=\"dropdown\">\n        <div\n          className=\"chip-container chip-container-input\"\n          onClick={() => {\n            setIsOpen(true);\n            inputRef.current?.focus();\n          }}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n        >\n          {value.map(v => (\n            <span key={v} className=\"chip\">\n              {getLabel(v)}\n              <button\n                type=\"button\"\n                className=\"chip-remove\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  handleRemove(v);\n                }}\n              >\n                \u00d7\n              </button>\n            </span>\n          ))}\n          <input\n            ref={inputRef}\n            type=\"text\"\n            placeholder={value.length === 0 ? placeholder : ''}\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            onFocus={() => setIsOpen(true)}\n            className=\"chip-input\"\n          />\n        </div>\n        {isOpen && filteredOptions.length > 0 && (\n          <div className=\"dropdown-menu\">\n            {filteredOptions.map((opt) => (\n              <div\n                key={opt.value}\n                onClick={() => handleSelect(opt.value)}\n                className=\"dropdown-item\"\n                role=\"button\"\n                tabIndex={0}\n                onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n              >\n                {opt.label || opt.value}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  value = [],\n  onChange,\n  options,\n  placeholder = 'Add...',\n  label,\n}", "type": "{ value: string[]; onChange: Function; options: Array<{ value: string; label?: string; }>; placeholder?: string; label?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 2}, {"name": "useEffect", "count": 1}, {"name": "useMemo", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::SearchableDropdown", "name": "SearchableDropdown", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array<{id: string, name?: string}>} props.items - Items to select from\n * @param {Function} props.onSelect - Called with item ID when selected\n * @param {string} [props.placeholder] - Placeholder text for trigger\n * @param {string} [props.emptyMessage] - Message when no items available\n * @param {string} [props.noMatchMessage] - Message when search has no matches\n * @param {boolean} [props.searchable] - Whether to show search input (default true)\n * @param {string} [props.className] - Additional class names\n */\nexport function SearchableDropdown({\n  items,\n  onSelect,\n  placeholder = 'Select...',\n  emptyMessage = 'No items available',\n  noMatchMessage = 'No matches found',\n  searchable = true,\n  className = '',\n}) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [search, setSearch] = useState('');\n  const containerRef = useRef(null);\n\n  useEffect(() => {\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const filteredItems = useMemo(() => {\n    if (!search) return items;\n    const lower = search.toLowerCase();\n    return items.filter(item =>\n      item.id.toLowerCase().includes(lower) ||\n      item.name?.toLowerCase().includes(lower)\n    );\n  }, [items, search]);\n\n  const handleSelect = (item) => {\n    onSelect(item.id);\n    setIsOpen(false);\n    setSearch('');\n  };\n\n  if (items.length === 0) {\n    return (\n      <div className={`dropdown-trigger dropdown-trigger-disabled ${className}`.trim()}>\n        <span>{emptyMessage}</span>\n      </div>\n    );\n  }\n\n  return (\n    <div ref={containerRef} className={`dropdown ${className}`.trim()}>\n      <div className=\"dropdown-trigger\" onClick={() => setIsOpen(!isOpen)} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n        <span>{placeholder}</span>\n        <span className=\"dropdown-arrow\">\u25bc</span>\n      </div>\n      {isOpen && (\n        <div className=\"dropdown-menu\">\n          {searchable && (\n            <div className=\"dropdown-search\">\n              <input\n                type=\"text\"\n                className=\"dropdown-search-input\"\n                placeholder=\"Search...\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n                onClick={(e) => e.stopPropagation()}\n                // eslint-disable-next-line jsx-a11y/no-autofocus\n                autoFocus\n              />\n            </div>\n          )}\n          <div className=\"dropdown-options\">\n            {filteredItems.length === 0 ? (\n              <div className=\"dropdown-empty\">{noMatchMessage}</div>\n            ) : (\n              filteredItems.map((item) => (\n                <div\n                  key={item.id}\n                  className=\"dropdown-option\"\n                  onClick={() => handleSelect(item)}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  {item.name || item.id}\n                </div>\n              ))\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  items,\n  onSelect,\n  placeholder = 'Select...',\n  emptyMessage = 'No items available',\n  noMatchMessage = 'No matches found',\n  searchable = true,\n  className = '',\n}", "type": "{ items: Array<{ id: string; name?: string; }>; onSelect: Function; placeholder?: string; emptyMessage?: string; noMatchMessage?: string; searchable?: boolean; className?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useEffect", "count": 1}, {"name": "useMemo", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::LevelSelector", "name": "LevelSelector", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {number|string} props.value - Current value\n * @param {Function} props.onChange - Called when value changes\n * @param {Array<{value: number|string, label: string, color: string}>} props.levels - Level definitions\n * @param {boolean} [props.showNumeric] - Show numeric input (default false, only for numeric values)\n * @param {number} [props.min] - Minimum value for numeric input (default 0)\n * @param {number} [props.max] - Maximum value for numeric input (default 10)\n * @param {number} [props.step] - Step for numeric input (default 0.1)\n * @param {string} [props.className] - Additional class names\n */\nexport function LevelSelector({\n  value,\n  onChange,\n  levels,\n  showNumeric = false,\n  min = 0,\n  max = 10,\n  step = 0.1,\n  className = '',\n}) {\n  const [hoveredLevel, setHoveredLevel] = useState(null);\n\n  // Detect if using numeric or string mode\n  const isNumeric = typeof levels[0]?.value === 'number';\n\n  // Get level index based on value\n  const getLevelIndex = (val) => {\n    if (isNumeric) {\n      for (let i = levels.length - 1; i >= 0; i--) {\n        if (val >= levels[i].value) return i;\n      }\n      return 0;\n    } else {\n      const idx = levels.findIndex(l => l.value === val);\n      return idx >= 0 ? idx : 0;\n    }\n  };\n\n  const levelIndex = getLevelIndex(value);\n  const currentLevel = levels[levelIndex];\n  const hoverLevel = hoveredLevel !== null ? levels[hoveredLevel] : null;\n\n  // Calculate partial fill for each dot (only meaningful for numeric mode)\n  const getPartialFill = (idx) => {\n    if (!isNumeric) {\n      // String mode: full fill up to and including current level\n      return idx <= levelIndex ? 1 : 0;\n    }\n    if (idx < levelIndex) return 1;\n    if (idx > levelIndex) return 0;\n    // Current level - calculate partial based on value position\n    const levelStart = levels[idx].value;\n    const levelEnd = idx < levels.length - 1 ? levels[idx + 1].value : max;\n    const progress = (value - levelStart) / (levelEnd - levelStart);\n    return Math.max(0, Math.min(1, progress));\n  };\n\n  return (\n    <div className={`level-selector ${className}`.trim()}>\n      <div className=\"level-selector-dots\">\n        {levels.map((level, idx) => {\n          const isHovered = hoveredLevel !== null && idx <= hoveredLevel;\n          const fill = getPartialFill(idx);\n          const baseColor = isHovered ? hoverLevel.color : currentLevel.color;\n\n          return (\n            <div\n              key={idx}\n              className={`level-selector-dot ${hoveredLevel === idx ? 'level-selector-dot-active' : ''}`.trim()}\n              onClick={() => onChange(level.value)}\n              onMouseEnter={() => setHoveredLevel(idx)}\n              onMouseLeave={() => setHoveredLevel(null)}\n              title={`${level.label}`}\n              role=\"button\"\n              tabIndex={0}\n              onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n            >\n              <svg className=\"level-selector-dot-fill-svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\" aria-hidden=\"true\">\n                <rect\n                  x=\"0\"\n                  y={100 - (fill * 100)}\n                  width=\"100\"\n                  height={fill * 100}\n                  fill={baseColor}\n                />\n              </svg>\n            </div>\n          );\n        })}\n      </div>\n      {showNumeric && isNumeric && (\n        <input\n          type=\"number\"\n          className=\"level-selector-input\"\n          value={value}\n          onChange={(e) => {\n            const newVal = parseFloat(e.target.value);\n            if (!isNaN(newVal)) {\n              onChange(Math.max(min, Math.min(max, newVal)));\n            }\n          }}\n          step={step}\n          min={min}\n          max={max}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  value,\n  onChange,\n  levels,\n  showNumeric = false,\n  min = 0,\n  max = 10,\n  step = 0.1,\n  className = '',\n}", "type": "{ value: number | string; onChange: Function; levels: Array<{ value: number | string; label: string; color: string; }>; showNumeric?: boolean; min?: number; max?: number; step?: number; className?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "svg", "children": [{"tag": "rect", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::NumberInput", "name": "NumberInput", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {number|undefined|null} props.value - The numeric value\r\n * @param {Function} props.onChange - Called with the parsed number when valid\r\n * @param {string} [props.className] - CSS class for the input\r\n * @param {number} [props.min] - Minimum value\r\n * @param {number} [props.max] - Maximum value\r\n * @param {number|string} [props.step] - Step value for increment/decrement\r\n * @param {string} [props.placeholder] - Placeholder text\r\n * @param {boolean} [props.allowEmpty] - If true, empty string calls onChange(undefined)\r\n * @param {boolean} [props.integer] - If true, only allow integers\r\n * @param {boolean} [props.disabled] - Disable the input\r\n */\r\nexport function NumberInput({\r\n  value,\r\n  onChange,\r\n  className = 'input',\r\n  min,\r\n  max,\r\n  step: _step,\r\n  placeholder,\r\n  allowEmpty = false,\r\n  integer = false,\r\n  disabled = false,\r\n  ...rest\n}) {\n  const externalDisplayValue = formatValue(value);\n  // Internal string state for editing\n  const [localValue, setLocalValue] = useState(() => externalDisplayValue);\n  // Track focus in state so render can safely choose draft vs external value\n  const [isFocused, setIsFocused] = useState(false);\n\r\n  const parseValue = useCallback((str) => {\r\n    if (str === '' || str === '-' || str === '.' || str === '-.') {\r\n      return null; // Intermediate state, not a valid number yet\r\n    }\r\n    const parsed = integer ? parseInt(str, 10) : parseFloat(str);\r\n    if (isNaN(parsed)) return null;\r\n    return parsed;\r\n  }, [integer]);\r\n\r\n  const handleFocus = useCallback(() => {\n    setLocalValue(externalDisplayValue);\n    setIsFocused(true);\n  }, [externalDisplayValue]);\n\r\n  const handleChange = useCallback((e) => {\r\n    const newValue = e.target.value;\r\n\r\n    // Allow empty, minus sign, decimal point, or any numeric pattern\r\n    // This regex allows intermediate states like \"-\", \".\", \"-.\", \"1.\", \"-1.\"\r\n    /* eslint-disable sonarjs/slow-regex -- short user input (single number field value) */\r\n    const validPattern = integer\r\n      ? /^-?\\d*$/  // Integer: optional minus, digits only\r\n      : /^-?\\d*\\.?\\d*$/; // Float: optional minus, digits, optional decimal, more digits\r\n    /* eslint-enable sonarjs/slow-regex */\r\n\r\n    if (!validPattern.test(newValue)) {\r\n      return; // Reject invalid characters\r\n    }\r\n\r\n    setLocalValue(newValue);\r\n\r\n    // Try to parse and update parent if it's a complete valid number\r\n    const parsed = parseValue(newValue);\r\n    if (parsed !== null) {\r\n      // Apply min/max constraints\r\n      let constrained = parsed;\r\n      if (min !== undefined && constrained < min) constrained = min;\r\n      if (max !== undefined && constrained > max) constrained = max;\r\n      onChange(constrained);\r\n    } else if (allowEmpty && newValue === '') {\r\n      onChange(undefined);\r\n    }\r\n  }, [onChange, min, max, allowEmpty, integer, parseValue]);\r\n\r\n  const handleBlur = useCallback(() => {\n    setIsFocused(false);\n\n    // On blur, ensure the display value matches the actual value\n    const parsed = parseValue(localValue);\n    if (parsed !== null) {\r\n      // Apply constraints and update\r\n      let constrained = parsed;\r\n      if (min !== undefined && constrained < min) constrained = min;\r\n      if (max !== undefined && constrained > max) constrained = max;\r\n      setLocalValue(formatValue(constrained));\r\n      onChange(constrained);\r\n    } else if (allowEmpty && localValue === '') {\r\n      onChange(undefined);\r\n    } else {\r\n      // Revert to the parent's value if local is invalid\r\n      setLocalValue(externalDisplayValue);\n    }\n  }, [allowEmpty, externalDisplayValue, localValue, max, min, onChange, parseValue]);\n\r\n  return (\r\n    <input\r\n      type=\"text\"\r\n      inputMode=\"numeric\"\r\n      value={isFocused ? localValue : externalDisplayValue}\n      onChange={handleChange}\r\n      onFocus={handleFocus}\r\n      onBlur={handleBlur}\r\n      className={className}\r\n      placeholder={placeholder}\r\n      disabled={disabled}\r\n      {...rest}\r\n    />\r\n  );\r\n}", "parameters": [{"name": "{\r\n  value,\r\n  onChange,\r\n  className = 'input',\r\n  min,\r\n  max,\r\n  step: _step,\r\n  placeholder,\r\n  allowEmpty = false,\r\n  integer = false,\r\n  disabled = false,\r\n  ...rest\n}", "type": "{ value: number | undefined | null; onChange: Function; className?: string; min?: number; max?: number; step?: number | string; placeholder?: string; allowEmpty?: boolean; integer?: boolean; disabled?: boolean; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "input", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useCallback", "count": 4}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::LocalTextArea", "name": "LocalTextArea", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "export function LocalTextArea({\r\n  value,\r\n  onChange,\r\n  className = 'textarea',\n  placeholder,\n  rows,\n  ...rest\n}) {\n  const externalValue = value || '';\n  const [localValue, setLocalValue] = useState(externalValue);\n  // Track focus in state so render can safely choose between local draft vs external value\n  const [isFocused, setIsFocused] = useState(false);\n\n  const handleFocus = useCallback(() => {\n    setLocalValue(externalValue);\n    setIsFocused(true);\n  }, [externalValue]);\n\n  // Call onChange on blur if value changed\n  const handleBlur = useCallback(() => {\n    setIsFocused(false);\n    if (localValue !== externalValue) {\n      onChange(localValue);\n    }\n  }, [externalValue, localValue, onChange]);\n\n  return (\n    <textarea\n      value={isFocused ? localValue : externalValue}\n      onChange={(e) => setLocalValue(e.target.value)}\r\n      onFocus={handleFocus}\r\n      onBlur={handleBlur}\r\n      className={className}\n      placeholder={placeholder}\n      rows={rows}\n      {...rest}\n    />\n  );\n}", "parameters": [{"name": "{\r\n  value,\r\n  onChange,\r\n  className = 'textarea',\n  placeholder,\n  rows,\n  ...rest\n}", "type": "{ [x: string]: any; value: any; onChange: any; className?: string; placeholder: any; rows: any; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "textarea", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useCallback", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::EnableToggle", "name": "EnableToggle", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {boolean} props.enabled - Current toggle state\n * @param {Function} props.onChange - Callback when toggle changes (receives new value)\n * @param {Function} [props.onClick] - Optional raw click handler (receives event, takes priority)\n * @param {string} [props.label] - Optional label beside the toggle\n * @param {string} [props.className] - Optional additional class names\n */\nexport function EnableToggle({ enabled, onChange, onClick, label, className = '' }) {\n  const handleClick = (e) => {\n    if (onClick) {\n      onClick(e);\n    } else if (onChange) {\n      onChange(!enabled);\n    }\n  };\n\n  return (\n    <div className={`flex items-center gap-lg ${className}`.trim()}>\n      <div\n        onClick={handleClick}\n        className={`toggle ${enabled ? 'toggle-on' : ''}`}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleClick(e); }}\n      >\n        <div className=\"toggle-knob\" />\n      </div>\n      {label && (\n        <span className=\"text-md text-muted\">{label}</span>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ enabled, onChange, onClick, label, className = '' }", "type": "{ enabled: boolean; onChange: Function; onClick?: Function; label?: string; className?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::IconButton", "name": "IconButton", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {string} props.icon - Icon content (emoji or text)\r\n * @param {Function} props.onClick - Callback when button is clicked\r\n * @param {boolean} [props.danger] - Apply danger styling\r\n * @param {string} [props.title] - Tooltip text\r\n * @param {string} [props.className] - Optional additional class names\r\n */\r\nexport function IconButton({ icon, onClick, danger, title, className = '' }) {\r\n  const classes = [\r\n    'btn-icon',\r\n    danger ? 'btn-icon-danger' : '',\r\n    className,\r\n  ].filter(Boolean).join(' ');\r\n\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      className={classes}\r\n      onClick={onClick}\r\n      title={title}\r\n    >\r\n      {icon}\r\n    </button>\r\n  );\r\n}", "parameters": [{"name": "{ icon, onClick, danger, title, className = '' }", "type": "{ icon: string; onClick: Function; danger?: boolean; title?: string; className?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "button", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::InfoBox", "name": "InfoBox", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {string} [props.title] - Optional title for the info box\r\n * @param {React.ReactNode} props.children - Content of the info box\r\n * @param {string} [props.className] - Optional additional class names\r\n */\r\nexport function InfoBox({ title, children, className = '' }) {\r\n  return (\r\n    <div className={`info-box ${className}`.trim()}>\r\n      {title && <div className=\"info-box-title\">{title}</div>}\r\n      <div className=\"info-box-text\">{children}</div>\r\n    </div>\r\n  );\r\n}", "parameters": [{"name": "{ title, children, className = '' }", "type": "{ title?: string; children: React.ReactNode; className?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::SectionHeader", "name": "SectionHeader", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {string} props.title - Section title\r\n * @param {string} [props.description] - Optional description text\r\n * @param {string} [props.icon] - Optional emoji icon\r\n * @param {string} [props.count] - Optional count badge text (e.g. \"3 active / 5 total\")\r\n * @param {React.ReactNode} [props.actions] - Optional action buttons on the right\r\n * @param {string} [props.className] - Optional additional class names\r\n */\r\nexport function SectionHeader({\r\n  title,\r\n  description,\r\n  icon,\r\n  count,\r\n  actions,\r\n  className = '',\r\n}) {\r\n  return (\r\n    <>\r\n      <div className={`flex-between mb-lg ${className}`.trim()}>\r\n        <div className=\"section-title mb-0\">\r\n          {icon && <span className=\"section-title-icon\">{icon}</span>}\r\n          {title}\r\n          {count && <span className=\"badge-count\">{count}</span>}\r\n        </div>\r\n        {actions}\r\n      </div>\r\n      {description && <div className=\"section-desc\">{description}</div>}\r\n    </>\r\n  );\r\n}", "parameters": [{"name": "{\r\n  title,\r\n  description,\r\n  icon,\r\n  count,\r\n  actions,\r\n  className = '',\r\n}", "type": "{ title: string; description?: string; icon?: string; count?: string; actions?: React.ReactNode; className?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::EmptyState", "name": "EmptyState", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {string} [props.icon] - Emoji icon to display\r\n * @param {string} props.title - Title text\r\n * @param {string} [props.description] - Description text\r\n * @param {React.ReactNode} [props.children] - Additional content (e.g., action button)\r\n * @param {string} [props.className] - Optional additional class names\r\n */\r\nexport function EmptyState({ icon, title, description, children, className = '' }) {\r\n  return (\r\n    <div className={`empty-state ${className}`.trim()}>\r\n      {icon && <div className=\"empty-state-icon\">{icon}</div>}\r\n      <div className=\"empty-state-title\">{title}</div>\r\n      {description && <div className=\"empty-state-desc\">{description}</div>}\r\n      {children}\r\n    </div>\r\n  );\r\n}", "parameters": [{"name": "{ icon, title, description, children, className = '' }", "type": "{ icon?: string; title: string; description?: string; children?: React.ReactNode; className?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::CategorySection", "name": "CategorySection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {string} [props.id] - Optional category identifier\n * @param {string} props.icon - Emoji icon for the category\n * @param {string} props.label - Category label\n * @param {Array} props.items - Items in this category\n * @param {boolean} props.expanded - Whether the section is expanded\n * @param {Function} props.onToggleExpand - Callback to toggle expansion\n * @param {boolean} props.allEnabled - Whether all items are enabled\n * @param {Function} props.onToggleAll - Callback to toggle all items\n * @param {Function} props.renderItem - Render function for each item\n * @param {string} [props.gridClassName] - Custom grid class name\n * @param {string} [props.className] - Additional class names\n */\nexport function CategorySection({\n  id: _id,\n  icon,\n  label,\n  items,\n  expanded,\n  onToggleExpand,\n  allEnabled,\n  onToggleAll,\n  renderItem,\n  gridClassName = 'list-grid',\n  className = '',\n}) {\n  return (\n    <div className={`category-section ${className}`.trim()}>\n      <div className=\"category-header\" onClick={onToggleExpand} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onToggleExpand(e); }} >\n        <span className={`category-expand ${expanded ? 'category-expand-open' : ''}`}>\n          &gt;\n        </span>\n        <span className=\"category-icon\">{icon}</span>\n        <span className=\"category-title\">{label}</span>\n        <span className=\"badge-count\">{items.length}</span>\n        <button\n          className={`btn-toggle-category ${allEnabled ? 'btn-toggle-category-active' : ''}`}\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggleAll();\n          }}\n        >\n          {allEnabled ? 'All On' : 'All Off'}\n        </button>\n      </div>\n      {expanded && (\n        <div className={gridClassName}>\n          {items.map(renderItem)}\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  id: _id,\n  icon,\n  label,\n  items,\n  expanded,\n  onToggleExpand,\n  allEnabled,\n  onToggleAll,\n  renderItem,\n  gridClassName = 'list-grid',\n  className = '',\n}", "type": "{ id?: string; icon: string; label: string; items: any[]; expanded: boolean; onToggleExpand: Function; allEnabled: boolean; onToggleAll: Function; renderItem: Function; gridClassName?: string; className?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::AddCard", "name": "AddCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Function} props.onClick - Callback when card is clicked\n * @param {string} props.label - Button label (default \"Add Item\")\n * @param {string} props.className - Optional CSS class name\n */\nexport function AddCard({ onClick, label = 'Add Item', className = '' }) {\n  return (\n    <div\n      className={`add-card ${className}`.trim()}\n      onClick={onClick}\n      role=\"button\"\n      tabIndex={0}\n      onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }}\n    >\n      <span className=\"add-card-icon\">+</span>\n      <span>{label}</span>\n    </div>\n  );\n}", "parameters": [{"name": "{ onClick, label = 'Add Item', className = '' }", "type": "{ onClick: Function; label: string; className: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::AddItemButton", "name": "AddItemButton", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {Function} props.onClick - Callback when button is clicked\r\n * @param {string} props.label - Button label text (default \"Add Item\")\r\n * @param {string} props.className - Optional CSS class name\r\n */\r\nexport function AddItemButton({ onClick, label = 'Add Item', className = '' }) {\r\n  return (\r\n    <button\r\n      className={`btn-add ${className}`.trim()}\r\n      onClick={onClick}\r\n    >\r\n      + {label}\r\n    </button>\r\n  );\r\n}", "parameters": [{"name": "{ onClick, label = 'Add Item', className = '' }", "type": "{ onClick: Function; label: string; className: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "button", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::ModalShell", "name": "ModalShell", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Function} props.onClose - Called when overlay or close button is clicked\n * @param {string} props.icon - Icon to show in header\n * @param {string} props.title - Modal title\n * @param {boolean} [props.disabled] - Whether to show disabled badge\n * @param {Array<{id: string, icon: string, label: string}>} [props.tabs] - Tab definitions (optional)\n * @param {string} [props.activeTab] - Currently active tab ID\n * @param {Function} [props.onTabChange] - Called when tab changes\n * @param {Function} [props.renderTabBadge] - Optional function to render badge for each tab: (tabId) => ReactNode\n * @param {React.ReactNode} [props.sidebarFooter] - Optional content to render at bottom of sidebar\n * @param {React.ReactNode} props.children - Modal content (tab content if tabs provided, otherwise full body)\n * @param {string} [props.className] - Additional class for modal container\n * @param {boolean} [props.preventOverlayClose] - Disable overlay click and Escape key close\n * @param {React.ReactNode} [props.footer] - Optional footer content\n */\nexport function ModalShell({\n  onClose,\n  icon,\n  title,\n  disabled,\n  tabs,\n  activeTab,\n  onTabChange,\n  renderTabBadge,\n  sidebarFooter,\n  children,\n  className = '',\n  preventOverlayClose = false,\n  footer,\n}) {\n  const hasTabs = tabs && tabs.length > 0;\n  const mouseDownOnOverlay = useRef(false);\n\n  // Escape key handler\n  const handleKeyDown = useCallback((e) => {\n    if (e.key === 'Escape' && !preventOverlayClose) {\n      onClose();\n    }\n  }, [onClose, preventOverlayClose]);\n\n  useEffect(() => {\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [handleKeyDown]);\n\n  // Body scroll lock\n  useEffect(() => {\n    const prev = document.body.style.overflow;\n    document.body.style.overflow = 'hidden';\n    return () => { document.body.style.overflow = prev; };\n  }, []);\n\n  const handleOverlayMouseDown = (e) => {\n    mouseDownOnOverlay.current = e.target === e.currentTarget;\n  };\n\n  const handleOverlayClick = (e) => {\n    if (!preventOverlayClose && mouseDownOnOverlay.current && e.target === e.currentTarget) {\n      onClose();\n    }\n  };\n\n  return (\n    <div className=\"modal-overlay\" onMouseDown={handleOverlayMouseDown} onClick={handleOverlayClick} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }} >\n      <div className={`modal ${className}`.trim()} onClick={(e) => e.stopPropagation()} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n        <div className=\"modal-header\">\n          <div className=\"modal-title\">\n            {icon && <span className=\"modal-title-icon\">{icon}</span>}\n            <span>{title}</span>\n            {disabled && <span className=\"badge badge-orphan\">Disabled</span>}\n          </div>\n          <button className=\"btn-close\" onClick={onClose}>\u00d7</button>\n        </div>\n        <div className=\"modal-body\">\n          {hasTabs ? (\n            <>\n              <div className=\"modal-sidebar\">\n                {tabs.map((tab) => (\n                  <button\n                    key={tab.id}\n                    className={`btn-tab ${activeTab === tab.id ? 'btn-tab-active' : ''}`}\n                    onClick={() => onTabChange?.(tab.id)}\n                  >\n                    <span className=\"btn-tab-icon\">{tab.icon}</span>\n                    <span>{tab.label}</span>\n                    {renderTabBadge?.(tab.id)}\n                  </button>\n                ))}\n                {sidebarFooter}\n              </div>\n              <div className=\"modal-content\">{children}</div>\n            </>\n          ) : (\n            children\n          )}\n        </div>\n        {footer && <div className=\"modal-footer\">{footer}</div>}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  onClose,\n  icon,\n  title,\n  disabled,\n  tabs,\n  activeTab,\n  onTabChange,\n  renderTabBadge,\n  sidebarFooter,\n  children,\n  className = '',\n  preventOverlayClose = false,\n  footer,\n}", "type": "{ onClose: Function; icon: string; title: string; disabled?: boolean; tabs?: Array<{ id: string; icon: string; label: string; }>; activeTab?: string; onTabChange?: Function; renderTabBadge?: Function; sidebarFooter?: React.ReactNode; children: React.ReactNode; className?: string; preventOverlayClose?: boolean; footer?: React.ReactNode; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "button", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useRef", "count": 1}, {"name": "useCallback", "count": 1}, {"name": "useEffect", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::ItemRow", "name": "ItemRow", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {string} props.name - Display name\r\n * @param {boolean} [props.muted] - Apply muted styling to name\r\n * @param {Function} [props.onRemove] - Called when remove button clicked\r\n * @param {string} [props.removeTitle] - Tooltip for remove button\r\n * @param {React.ReactNode} props.children - Controls to render between name and remove\r\n * @param {string} [props.className] - Additional class names\r\n */\r\nexport function ItemRow({\r\n  name,\r\n  muted,\r\n  onRemove,\r\n  removeTitle = 'Remove',\r\n  children,\r\n  className = '',\r\n}) {\r\n  return (\r\n    <div className={`item-row ${className}`.trim()}>\r\n      <span className={`item-row-name ${muted ? 'item-row-name-muted' : ''}`}>\r\n        {name}\r\n      </span>\r\n      {children}\r\n      {onRemove && (\r\n        <button\r\n          className=\"item-row-remove\"\r\n          onClick={onRemove}\r\n          title={removeTitle}\r\n        >\r\n          \u00d7\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n}", "parameters": [{"name": "{\r\n  name,\r\n  muted,\r\n  onRemove,\r\n  removeTitle = 'Remove',\r\n  children,\r\n  className = '',\r\n}", "type": "{ name: string; muted?: boolean; onRemove?: Function; removeTitle?: string; children: React.ReactNode; className?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::PressureChangesEditor", "name": "PressureChangesEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object<string, number>} props.value - Map of pressure ID to delta value\n * @param {Function} props.onChange - Called when values change\n * @param {Array<{id: string, name?: string}>} props.pressures - Available pressure definitions\n * @param {string} [props.label] - Optional custom label (default: \"Pressure Changes\")\n * @param {string} [props.className] - Additional class names\n */\nexport function PressureChangesEditor({\n  value = {},\n  onChange,\n  pressures,\n  label = 'Pressure Changes',\n  className = '',\n}) {\n  const entries = Object.entries(value);\n\n  const addPressure = (pressureId) => {\n    if (pressureId && !(pressureId in value)) {\n      onChange({ ...value, [pressureId]: 0 });\n    }\n  };\n\n  const updateDelta = (pressureId, delta) => {\n    onChange({ ...value, [pressureId]: parseInt(delta) || 0 });\n  };\n\n  const removePressure = (pressureId) => {\n    const newValue = { ...value };\n    delete newValue[pressureId];\n    onChange(newValue);\n  };\n\n  const availablePressures = (pressures || []).filter((p) => !(p.id in value));\n\n  return (\n    <div className={`form-group mb-xl ${className}`.trim()}>\n      <label className=\"label\">{label}</label>\n      <div className=\"flex flex-col gap-md\">\n        {entries.map(([pressureId, delta]) => (\n          <div key={pressureId} className=\"item-row\">\n            <span className=\"item-row-name\">{pressureId}</span>\n            <input\n              type=\"number\"\n              className=\"input pressure-changes-delta-input\"\n              value={delta}\n              onChange={(e) => updateDelta(pressureId, e.target.value)}\n            />\n            <button\n              className=\"btn-icon btn-icon-danger\"\n              onClick={() => removePressure(pressureId)}\n            >\n              \u00d7\n            </button>\n          </div>\n        ))}\n      </div>\n      {availablePressures.length > 0 && (\n        <select\n          className=\"select mt-md pressure-changes-add-select\"\n          value=\"\"\n          onChange={(e) => addPressure(e.target.value)}\n        >\n          <option value=\"\">+ Add pressure change...</option>\n          {availablePressures.map((p) => (\n            <option key={p.id} value={p.id}>\n              {p.name || p.id}\n            </option>\n          ))}\n        </select>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  value = {},\n  onChange,\n  pressures,\n  label = 'Pressure Changes',\n  className = '',\n}", "type": "{ value: {    [x: string]: number;}; onChange: Function; pressures: Array<{ id: string; name?: string; }>; label?: string; className?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "select", "children": [{"tag": "option", "children": [], "isMap": false, "isConditional": false}, {"tag": "option", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::ErrorBadge", "name": "ErrorBadge", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * Badge for showing error counts\r\n * @param {Object} props\r\n * @param {number} props.count - Number of errors\r\n * @param {string} [props.className] - Additional class names\r\n */\r\nexport function ErrorBadge({ count, className = '' }) {\r\n  if (!count) return null;\r\n  return (\r\n    <span className={`badge badge-validation badge-error ${className}`.trim()}>\r\n      {count} error{count !== 1 ? 's' : ''}\r\n    </span>\r\n  );\r\n}", "parameters": [{"name": "{ count, className = '' }", "type": "{ count: number; className?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "span", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::OrphanBadge", "name": "OrphanBadge", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * Badge for showing orphan status (not in any era)\r\n * @param {Object} props\r\n * @param {boolean} props.isOrphan - Whether the item is orphaned\r\n * @param {string} [props.className] - Additional class names\r\n */\r\nexport function OrphanBadge({ isOrphan, className = '' }) {\r\n  if (!isOrphan) return null;\r\n  return (\r\n    <span className={`badge badge-validation badge-orphan ${className}`.trim()}>\r\n      Not in any era\r\n    </span>\r\n  );\r\n}", "parameters": [{"name": "{ isOrphan, className = '' }", "type": "{ isOrphan: boolean; className?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "span", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::TabValidationBadge", "name": "TabValidationBadge", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * Badge for showing validation count in tabs\r\n * @param {Object} props\r\n * @param {number} props.count - Number of validation issues\r\n * @param {string} [props.className] - Additional class names\r\n */\r\nexport function TabValidationBadge({ count, className = '' }) {\r\n  if (!count) return null;\r\n  return (\r\n    <span className={`badge badge-validation badge-error ${className}`.trim()}>\r\n      {count}\r\n    </span>\r\n  );\r\n}", "parameters": [{"name": "{ count, className = '' }", "type": "{ count: number; className?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "span", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::EraBadges", "name": "EraBadges", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {Array} props.eras - Array of era objects with id and name\r\n * @param {number} props.maxVisible - Maximum number of badges to show (default 3)\r\n * @param {string} [props.className] - Additional class names\r\n */\r\nexport function EraBadges({ eras = [], maxVisible = 3, className = '' }) {\n  if (!eras.length) return null;\r\n\r\n  const visible = eras.slice(0, maxVisible);\r\n  const remaining = eras.length - maxVisible;\r\n\r\n  return (\r\n    <div className={`chip-container mt-md ${className}`.trim()}>\r\n      {visible.map((era) => (\r\n        <span key={era.id} className=\"badge badge-era\">\n          <span className=\"badge-era-icon\">{ERA_ICON}</span> {era.name || era.id}\n        </span>\n      ))}\n      {remaining > 0 && (\n        <span className=\"badge badge-era badge-era-remaining\">\n          +{remaining} more\n        </span>\n      )}\n    </div>\r\n  );\r\n}", "parameters": [{"name": "{ eras = [], maxVisible = 3, className = '' }", "type": "{ eras: any[]; maxVisible: number; className?: string; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "div", "children": [{"tag": "span", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::useLocalInputState", "name": "useLocalInputState", "kind": "hook", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "export function useLocalInputState(externalValue, onUpdate) {\n  const [localValue, setLocalValue] = useState(externalValue || '');\n\n  // Sync local value when external value changes\n  useEffect(() => {\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- intentional prop->draft sync for controlled inputs\n    setLocalValue(externalValue || '');\n  }, [externalValue]);\n\n  // Call onUpdate if value changed\n  const handleBlur = useCallback(() => {\n    if (localValue !== externalValue) {\n      onUpdate(localValue);\n    }\n  }, [localValue, externalValue, onUpdate]);\n\n  return [localValue, setLocalValue, handleBlur];\n}", "parameters": [{"name": "externalValue", "type": "any", "optional": false}, {"name": "onUpdate", "type": "any", "optional": false}], "returnType": "any[]", "jsxTree": null, "hookCalls": [{"name": "useState", "count": 1}, {"name": "useEffect", "count": 1}, {"name": "useCallback", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::useEditorState", "name": "useEditorState", "kind": "hook", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "export function useEditorState(items, onChange, options = {}) {\n  const {\n    idField = 'id',\n    nameField = 'name',\n    createItem,\n    persistKey,\n  } = options;\n\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStored(persistKey);\n    return typeof stored === 'string' ? stored : null;\n  });\n\n  // Restore selectedId from storage when persistKey changes\n  useEffect(() => {\n    const stored = loadStored(persistKey);\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted selection when key changes\n    setSelectedId(typeof stored === 'string' ? stored : null);\n  }, [persistKey]);\n\n  const resolvedIndex = selectedId ? items.findIndex((item) => item[idField] === selectedId) : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n\n  // Derive selected item from index\n  const selectedItem = selectedIndex !== null && selectedIndex < items.length\n    ? items[selectedIndex]\n    : null;\n\n  // Persist selectedId to storage\n  useEffect(() => {\n    if (!persistKey) return;\n    if (selectedId) {\n      saveStored(persistKey, selectedId);\n    } else {\n      clearStored(persistKey);\n    }\n  }, [persistKey, selectedId]);\n\n  // Clear invalid selectedId\n  if (selectedId && selectedIndex === null) {\n    setSelectedId(null);\n  }\n\n  // Update the currently selected item\n  const handleItemChange = useCallback((updated) => {\n    if (selectedIndex !== null && selectedIndex < items.length) {\n      const newItems = [...items];\n      newItems[selectedIndex] = updated;\n      onChange(newItems);\n    }\n  }, [items, onChange, selectedIndex]);\n\n  // Toggle the enabled state of an item\n  const handleToggle = useCallback((item) => {\n    const index = items.findIndex((i) => i[idField] === item[idField]);\n    if (index >= 0) {\n      const newItems = [...items];\n      newItems[index] = { ...item, enabled: item.enabled === false ? true : false };\n      onChange(newItems);\n    }\n  }, [items, onChange, idField]);\n\n  // Delete the currently selected item (with confirmation)\n  const handleDelete = useCallback(() => {\n    if (selectedIndex !== null && selectedItem) {\n      const itemName = selectedItem[nameField] || selectedItem[idField];\n      if (confirm(`Delete \"${itemName}\"?`)) {\n        const newItems = [...items];\n        newItems.splice(selectedIndex, 1);\n        onChange(newItems);\n        setSelectedId(null);\n      }\n    }\n  }, [items, onChange, selectedIndex, selectedItem, idField, nameField]);\n\n  // Add a new item (using createItem factory if provided)\n  const handleAdd = useCallback((newItem) => {\n    const itemToAdd = newItem || (createItem ? createItem() : { [idField]: `item_${Date.now()}` });\n    onChange([...items, itemToAdd]);\n    setSelectedId(itemToAdd[idField] || null);\n  }, [items, onChange, createItem, idField]);\n\n  // Select an item by index\n  const handleSelect = useCallback((index) => {\n    const item = items[index];\n    setSelectedId(item ? item[idField] : null);\n  }, [items, idField]);\n\n  // Close the selection (deselect)\n  const handleClose = useCallback(() => {\n    setSelectedId(null);\n  }, []);\n\n  return {\n    selectedIndex,\n    selectedItem,\n    handleItemChange,\n    handleToggle,\n    handleDelete,\n    handleAdd,\n    handleSelect,\n    handleClose,\n  };\n}", "parameters": [{"name": "items", "type": "any", "optional": false}, {"name": "onChange", "type": "any", "optional": false}, {"name": "options", "type": "{}", "optional": true}], "returnType": "{ selectedIndex: any; selectedItem: any; handleItemChange: any; handleToggle: any; handleDelete: any; handleAdd: any; handleSelect: any; handleClose: any; }", "jsxTree": null, "hookCalls": [{"name": "useState", "count": 1}, {"name": "useEffect", "count": 2}, {"name": "useCallback", "count": 6}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/MutationCard.jsx::MutationCard", "name": "MutationCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/MutationCard.jsx", "sourceCode": "export function MutationCard({\n  mutation,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  entityOptions,\n  typeOptions,\n  createMutation,\n  titlePrefix,\n}) {\n  const [expanded, setExpanded] = useState(false);\n  const types = typeOptions || DEFAULT_MUTATION_TYPES;\n  const entityRefs = normalizeOptions(entityOptions);\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n  const pressureOptions = (pressures || []).map((p) => ({\n    value: p.id,\n    label: p.name || p.id,\n  }));\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const update = (field, value) => {\n    onChange({ ...mutation, [field]: value });\n  };\n\n  const updateType = (value) => {\n    if (createMutation) {\n      onChange(createMutation(value));\n      return;\n    }\n    update(\"type\", value);\n  };\n\n  const fallbackLabel =\n    types.find((t) => t.value === mutation.type)?.label ||\n    MUTATION_TYPE_META[mutation.type]?.label ||\n    mutation.type;\n  const typeMeta = MUTATION_TYPE_META[mutation.type] || { icon: \"?\", color: \"#6b7280\" };\n  const headerLabel = titlePrefix ? `${titlePrefix}: ${fallbackLabel}` : fallbackLabel;\n\n  const getSummary = () => {\n    switch (mutation.type) {\n      case \"modify_pressure\":\n        return `${mutation.pressureId || \"?\"} ${formatDelta(mutation.delta)}`;\n      case \"set_tag\": {\n        const value = mutation.value !== undefined ? ` = ${mutation.value}` : \"\";\n        return `${mutation.entity || \"?\"} tag ${mutation.tag || \"?\"}${value}`;\n      }\n      case \"remove_tag\":\n        return `${mutation.entity || \"?\"} remove ${mutation.tag || \"?\"}`;\n      case \"change_status\":\n        return `${mutation.entity || \"?\"} -> ${mutation.newStatus || \"?\"}`;\n      case \"adjust_prominence\":\n        return `${mutation.entity || \"?\"} ${formatDelta(mutation.delta)}`;\n      case \"archive_relationship\": {\n        return `${mutation.entity || \"?\"} ${mutation.relationshipKind || \"?\"} with ${mutation.with || \"?\"}`;\n      }\n      case \"archive_all_relationships\": {\n        const dirLabel =\n          mutation.direction && mutation.direction !== \"both\" ? ` (${mutation.direction})` : \"\";\n        return `${mutation.entity || \"?\"} all ${mutation.relationshipKind || \"?\"}${dirLabel}`;\n      }\n      case \"adjust_relationship_strength\":\n        return `${mutation.kind || \"?\"} ${mutation.src || \"?\"} -> ${mutation.dst || \"?\"} ${formatDelta(mutation.delta)}`;\n      case \"create_relationship\": {\n        const arrow = mutation.bidirectional ? \"<->\" : \"->\";\n        return `${mutation.kind || \"?\"} ${mutation.src || \"?\"} ${arrow} ${mutation.dst || \"?\"}`;\n      }\n      case \"update_rate_limit\":\n        return \"track execution\";\n      case \"transfer_relationship\":\n        return `${mutation.entity || \"?\"} ${mutation.relationshipKind || \"?\"} from ${mutation.from || \"?\"} to ${mutation.to || \"?\"}`;\n      case \"for_each_related\": {\n        const actionCount = (mutation.actions || []).length;\n        return `${mutation.relationship || \"?\"} (${actionCount} action${actionCount !== 1 ? \"s\" : \"\"})`;\n      }\n      case \"conditional\": {\n        const thenCount = (mutation.thenActions || []).length;\n        const elseCount = (mutation.elseActions || []).length;\n        return `then: ${thenCount}, else: ${elseCount}`;\n      }\n      default:\n        return \"\";\n    }\n  };\n\n  const summary = getSummary();\n\n  return (\n    <div className=\"condition-card\">\n      <div className={`condition-card-header ${expanded ? \"\" : \"mb-0\"}`}>\n        <div className=\"condition-card-type\">\n          {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color */}\n          <div className=\"condition-card-icon\" style={{ '--mc-icon-bg': `${typeMeta.color}20`, backgroundColor: 'var(--mc-icon-bg)' }}>\n            {typeMeta.icon}\n          </div>\n          <div>\n            <div className=\"condition-card-label\">{headerLabel}</div>\n            {summary && <div className=\"condition-card-summary\">{summary}</div>}\n          </div>\n        </div>\n        <div className=\"condition-card-actions\">\n          <button className=\"btn-icon\" onClick={() => setExpanded(!expanded)}>\n            {expanded ? \"^\" : \"v\"}\n          </button>\n          {onRemove && (\n            <button className=\"btn-icon btn-icon-danger\" onClick={onRemove}>\n              x\n            </button>\n          )}\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"condition-card-fields\">\n          <div className=\"form-grid mc-fields-full\">\n            <ReferenceDropdown\n              label=\"Type\"\n              value={mutation.type}\n              onChange={updateType}\n              options={types}\n            />\n\n            {mutation.type === \"modify_pressure\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure\"\n                  value={mutation.pressureId || \"\"}\n                  onChange={(v) => update(\"pressureId\", v)}\n                  options={pressureOptions}\n                  placeholder=\"Select pressure...\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Delta\n                  <NumberInput value={mutation.delta} onChange={(v) => update(\"delta\", v ?? 0)} />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {(mutation.type === \"set_tag\" || mutation.type === \"remove_tag\") && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity\"\n                  value={mutation.entity || \"\"}\n                  onChange={(v) => update(\"entity\", v)}\n                  options={entityRefs}\n                  placeholder=\"Select entity...\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Tag\n                  <TagSelector\n                    value={mutation.tag ? [mutation.tag] : []}\n                    onChange={(tags) => update(\"tag\", tags[0] || \"\")}\n                    tagRegistry={tagRegistry}\n                    placeholder=\"Select tag...\"\n                    singleSelect\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {mutation.type === \"set_tag\" && (\n              <>\n                <div className=\"form-group\">\n                  <label htmlFor=\"value-optional\" className=\"label\">Value (optional)</label>\n                  <input id=\"value-optional\"\n                    type=\"text\"\n                    value={mutation.value !== undefined ? String(mutation.value) : \"\"}\n                    onChange={(e) => update(\"value\", parseTagValue(e.target.value))}\n                    className=\"input\"\n                    placeholder=\"true\"\n                    disabled={Boolean(mutation.valueFrom)}\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label htmlFor=\"value-source-optional\" className=\"label\">Value Source (optional)</label>\n                  <input id=\"value-source-optional\"\n                    type=\"text\"\n                    value={mutation.valueFrom || \"\"}\n                    onChange={(e) => update(\"valueFrom\", e.target.value || undefined)}\n                    className=\"input\"\n                    placeholder=\"e.g., cluster_id\"\n                  />\n                </div>\n              </>\n            )}\n\n            {mutation.type === \"change_status\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity\"\n                  value={mutation.entity || \"\"}\n                  onChange={(v) => update(\"entity\", v)}\n                  options={entityRefs}\n                  placeholder=\"Select entity...\"\n                />\n                <div className=\"form-group\">\n                  <label htmlFor=\"new-status\" className=\"label\">New Status</label>\n                  <input id=\"new-status\"\n                    type=\"text\"\n                    value={mutation.newStatus || \"\"}\n                    onChange={(e) => update(\"newStatus\", e.target.value || undefined)}\n                    className=\"input\"\n                    placeholder=\"e.g., active\"\n                  />\n                </div>\n              </>\n            )}\n\n            {mutation.type === \"adjust_prominence\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity\"\n                  value={mutation.entity || \"\"}\n                  onChange={(v) => update(\"entity\", v)}\n                  options={entityRefs}\n                  placeholder=\"Select entity...\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Delta\n                  <NumberInput\n                    value={mutation.delta}\n                    onChange={(v) => update(\"delta\", v ?? 0)}\n                    placeholder=\"e.g., 0.25 or -0.15\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {mutation.type === \"create_relationship\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Relationship Kind\"\n                  value={mutation.kind || \"\"}\n                  onChange={(v) => update(\"kind\", v)}\n                  options={relationshipKindOptions}\n                  placeholder=\"Select relationship...\"\n                />\n                <ReferenceDropdown\n                  label=\"Source\"\n                  value={mutation.src || \"\"}\n                  onChange={(v) => update(\"src\", v)}\n                  options={entityRefs}\n                  placeholder=\"Select source...\"\n                />\n                <ReferenceDropdown\n                  label=\"Destination\"\n                  value={mutation.dst || \"\"}\n                  onChange={(v) => update(\"dst\", v)}\n                  options={entityRefs}\n                  placeholder=\"Select destination...\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Strength\n                  <NumberInput\n                    value={mutation.strength}\n                    onChange={(v) => update(\"strength\", v)}\n                    min={0}\n                    max={1}\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label htmlFor=\"category-optional\" className=\"label\">Category (optional)</label>\n                  <input id=\"category-optional\"\n                    type=\"text\"\n                    value={mutation.category || \"\"}\n                    onChange={(e) => update(\"category\", e.target.value || undefined)}\n                    className=\"input\"\n                    placeholder=\"Optional\"\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"checkbox-label\">\n                    <input\n                      type=\"checkbox\"\n                      checked={mutation.bidirectional || false}\n                      onChange={(e) => update(\"bidirectional\", e.target.checked || undefined)}\n                      className=\"checkbox\"\n                    />\n                    Bidirectional\n                  </label>\n                </div>\n              </>\n            )}\n\n            {mutation.type === \"adjust_relationship_strength\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Relationship Kind\"\n                  value={mutation.kind || \"\"}\n                  onChange={(v) => update(\"kind\", v)}\n                  options={relationshipKindOptions}\n// ... (truncated)", "parameters": [{"name": "{\n  mutation,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  entityOptions,\n  typeOptions,\n  createMutation,\n  titlePrefix,\n}", "type": "{ mutation: any; onChange: any; onRemove: any; schema: any; pressures: any; entityOptions: any; typeOptions: any; createMutation: any; titlePrefix: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "MutationCard", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "MutationCard", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "MutationCard", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./index", "specifiers": ["ReferenceDropdown", "NumberInput"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}, {"source": "../actions/constants", "specifiers": ["MUTATION_TYPE_META", "MUTATION_TYPE_ORDER"], "category": "internal"}, {"source": "./MutationCard.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/SelectionRuleEditor.jsx::SelectionRuleEditor", "name": "SelectionRuleEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/SelectionRuleEditor.jsx", "sourceCode": "export function SelectionRuleEditor({\n  value,\n  onChange,\n  schema,\n  availableRefs = [],\n  showPickStrategy = true,\n  showMaxResults = true,\n  showFilters = true,\n  allowAnyKind = false,\n  showExcludeSubtypes = false,\n}) {\n  const selection = value || { strategy: \"by_kind\" };\n\n  const baseKindOptions = (schema?.entityKinds || []).map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n  const entityKindOptions = allowAnyKind\n    ? [{ value: \"any\", label: \"Any kind\" }, ...baseKindOptions]\n    : baseKindOptions;\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const getSubtypeOptions = (kind) => {\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const updateSelection = (field, fieldValue) => {\n    onChange({ ...selection, [field]: fieldValue });\n  };\n\n  const updateSelectionMultiple = (updates) => {\n    onChange({ ...selection, ...updates });\n  };\n\n  const referenceOptions = (availableRefs.length > 0 ? availableRefs : [\"$target\"]).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  return (\n    <div>\n      <div className=\"form-grid\">\n        <ReferenceDropdown\n          label=\"Selection Strategy\"\n          value={selection.strategy || \"by_kind\"}\n          onChange={(v) => updateSelection(\"strategy\", v)}\n          options={[\n            { value: \"by_kind\", label: \"By Entity Kind\" },\n            { value: \"by_preference_order\", label: \"By Subtype Preference\" },\n            { value: \"by_relationship\", label: \"By Relationship Presence\" },\n            { value: \"by_proximity\", label: \"By Proximity\" },\n            { value: \"by_prominence\", label: \"By Prominence\" },\n          ]}\n        />\n\n        {showPickStrategy && (\n          <ReferenceDropdown\n            label=\"Pick Strategy\"\n            value={selection.pickStrategy || \"random\"}\n            onChange={(v) => updateSelection(\"pickStrategy\", v)}\n            options={PICK_STRATEGIES}\n          />\n        )}\n\n        {showMaxResults && (\n          <div className=\"form-group\">\n            <label className=\"label\">Max Results\n            <NumberInput\n              value={selection.maxResults}\n              onChange={(v) => updateSelection(\"maxResults\", v)}\n              min={1}\n              integer\n              allowEmpty\n              placeholder=\"1\"\n            />\n            </label>\n          </div>\n        )}\n      </div>\n\n      <div className=\"form-grid mt-xl\">\n        <ReferenceDropdown\n          label=\"Entity Kind\"\n          value={selection.kind || \"\"}\n          onChange={(v) =>\n            updateSelectionMultiple({\n              kind: v || undefined,\n              subtypes: undefined,\n              excludeSubtypes: undefined,\n            })\n          }\n          options={entityKindOptions}\n          placeholder=\"Any kind\"\n        />\n        <div className=\"form-group\">\n          <label htmlFor=\"status-optional\" className=\"label\">Status (optional)</label>\n          <input id=\"status-optional\"\n            type=\"text\"\n            value={selection.status || \"\"}\n            onChange={(e) => updateSelection(\"status\", e.target.value || undefined)}\n            className=\"input\"\n            placeholder=\"e.g., active\"\n          />\n        </div>\n        <div className=\"form-group\">\n          <label htmlFor=\"not-status-optional\" className=\"label\">Not Status (optional)</label>\n          <input id=\"not-status-optional\"\n            type=\"text\"\n            value={selection.notStatus || \"\"}\n            onChange={(e) => updateSelection(\"notStatus\", e.target.value || undefined)}\n            className=\"input\"\n            placeholder=\"e.g., dead\"\n          />\n        </div>\n      </div>\n\n      {selection.kind && selection.kind !== \"any\" && (\n        <div className=\"mt-xl\">\n          <ChipSelect\n            label=\"Subtypes (optional)\"\n            value={selection.subtypes || []}\n            onChange={(v) => updateSelection(\"subtypes\", v.length > 0 ? v : undefined)}\n            options={getSubtypeOptions(selection.kind)}\n            placeholder=\"Any subtype\"\n          />\n        </div>\n      )}\n\n      {selection.kind && selection.kind !== \"any\" && showExcludeSubtypes && (\n        <div className=\"mt-xl\">\n          <ChipSelect\n            label=\"Exclude Subtypes (optional)\"\n            value={selection.excludeSubtypes || []}\n            onChange={(v) => updateSelection(\"excludeSubtypes\", v.length > 0 ? v : undefined)}\n            options={getSubtypeOptions(selection.kind)}\n            placeholder=\"None\"\n          />\n        </div>\n      )}\n\n      {selection.strategy === \"by_preference_order\" && (\n        <div className=\"mt-xl\">\n          <label htmlFor=\"subtype-preferences-comma-separated\" className=\"label\">Subtype Preferences (comma-separated)</label>\n          <input id=\"subtype-preferences-comma-separated\"\n            type=\"text\"\n            value={(selection.subtypePreferences || []).join(\", \")}\n            onChange={(e) => {\n              const prefs = e.target.value\n                .split(\",\")\n                .map((s) => s.trim())\n                .filter(Boolean);\n              updateSelection(\"subtypePreferences\", prefs.length > 0 ? prefs : undefined);\n            }}\n            className=\"input\"\n            placeholder=\"e.g., noble, commoner\"\n          />\n        </div>\n      )}\n\n      {selection.strategy === \"by_relationship\" && (\n        <div className=\"form-grid mt-xl\">\n          <ReferenceDropdown\n            label=\"Relationship Kind\"\n            value={selection.relationshipKind || \"\"}\n            onChange={(v) => updateSelection(\"relationshipKind\", v)}\n            options={relationshipKindOptions}\n            placeholder=\"Select relationship...\"\n          />\n          <ReferenceDropdown\n            label=\"Direction\"\n            value={selection.direction || \"both\"}\n            onChange={(v) => updateSelection(\"direction\", v)}\n            options={[\n              { value: \"both\", label: \"Both\" },\n              { value: \"src\", label: \"Source (outgoing)\" },\n              { value: \"dst\", label: \"Destination (incoming)\" },\n            ]}\n          />\n          <div className=\"form-group\">\n            <label className=\"checkbox-label\">\n              <input\n                type=\"checkbox\"\n                checked={selection.mustHave !== false}\n                onChange={(e) => updateSelection(\"mustHave\", e.target.checked)}\n                className=\"checkbox\"\n              />\n              Must Have Relationship\n            </label>\n          </div>\n        </div>\n      )}\n\n      {selection.strategy === \"by_proximity\" && (\n        <div className=\"form-grid mt-xl\">\n          <ReferenceDropdown\n            label=\"Reference Entity\"\n            value={selection.referenceEntity || \"\"}\n            onChange={(v) => updateSelection(\"referenceEntity\", v || undefined)}\n            options={referenceOptions}\n            placeholder={referenceOptions[0]?.value || \"\"}\n          />\n          <div className=\"form-group\">\n            <label className=\"label\">Max Distance\n            <NumberInput\n              value={selection.maxDistance}\n              onChange={(v) => updateSelection(\"maxDistance\", v)}\n              min={0}\n              allowEmpty\n              placeholder=\"50\"\n            />\n            </label>\n          </div>\n        </div>\n      )}\n\n      {selection.strategy === \"by_prominence\" && (\n        <div className=\"mt-xl\">\n          <ReferenceDropdown\n            label=\"Minimum Prominence\"\n            value={selection.minProminence || \"\"}\n            onChange={(v) => updateSelection(\"minProminence\", v || undefined)}\n            options={PROMINENCE_LEVELS.map((p) => ({ value: p.value, label: p.label }))}\n            placeholder=\"Any\"\n          />\n        </div>\n      )}\n\n      {showFilters && (\n        <div className=\"mt-2xl\">\n          <span className=\"label\">Selection Filters</span>\n          <div className=\"info-box-text mb-lg text-sm\">\n            Optional filters to narrow down which entities can be selected. All filters must pass.\n          </div>\n          <SelectionFiltersEditor\n            filters={selection.filters}\n            onChange={(filters) =>\n              updateSelection(\"filters\", filters.length > 0 ? filters : undefined)\n            }\n            schema={schema}\n            availableRefs={availableRefs}\n          />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  value,\n  onChange,\n  schema,\n  availableRefs = [],\n  showPickStrategy = true,\n  showMaxResults = true,\n  showFilters = true,\n  allowAnyKind = false,\n  showExcludeSubtypes = false,\n}", "type": "{ value: any; onChange: any; schema: any; availableRefs?: any[]; showPickStrategy?: boolean; showMaxResults?: boolean; showFilters?: boolean; allowAnyKind?: boolean; showExcludeSubtypes?: boolean; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SelectionFiltersEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./index", "specifiers": ["ReferenceDropdown", "ChipSelect", "NumberInput", "PROMINENCE_LEVELS"], "category": "internal"}, {"source": "../generators/constants", "specifiers": ["PICK_STRATEGIES"], "category": "internal"}, {"source": "../generators/filters", "specifiers": ["SelectionFiltersEditor"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/shared/VariableSelectionEditor.jsx::VariableSelectionEditor", "name": "VariableSelectionEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/VariableSelectionEditor.jsx", "sourceCode": "export function VariableSelectionEditor({\n  value,\n  onChange,\n  schema,\n  availableRefs = [],\n  showPickStrategy = true,\n  showMaxResults = true,\n  allowPreferFilters = true,\n}) {\n  const select = value || {};\n  const selectionMode = getSelectionMode(select);\n  const isRelatedMode = selectionMode === \"related\";\n  const isPathMode = selectionMode === \"path\";\n  const fromSpec = isRelatedMode ? select.from : null;\n  const pathSpec = isPathMode ? select.from : null;\n\n  const entityKindOptions = (schema?.entityKinds || []).map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const getSubtypeOptions = (kind) => {\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const updateSelect = (field, fieldValue) => {\n    onChange({ ...select, [field]: fieldValue });\n  };\n\n  const updateSelectMultiple = (updates) => {\n    onChange({ ...select, ...updates });\n  };\n\n  const setMode = (mode) => {\n    if (mode === \"graph\") {\n      onChange({ ...select, from: \"graph\" });\n      return;\n    }\n    if (mode === \"path\") {\n      const startRef = availableRefs[0] || \"$self\";\n      onChange({\n        ...select,\n        from: {\n          path: [{ from: startRef, via: \"\", direction: \"both\" }],\n        },\n      });\n      return;\n    }\n    const relatedTo = availableRefs[0] || \"$target\";\n    onChange({\n      ...select,\n      from: { relatedTo, relationshipKind: \"\", direction: \"both\" },\n    });\n  };\n\n  const updatePathStep = (index, step) => {\n    const path = [...(pathSpec?.path || [])];\n    path[index] = step;\n    updateSelect(\"from\", { path });\n  };\n\n  const addPathStep = () => {\n    const path = [...(pathSpec?.path || [])];\n    path.push({ via: \"\", direction: \"both\" });\n    updateSelect(\"from\", { path });\n  };\n\n  const removePathStep = (index) => {\n    const path = (pathSpec?.path || []).filter((_, i) => i !== index);\n    if (path.length === 0) {\n      // Switch back to graph mode if no steps left\n      setMode(\"graph\");\n    } else {\n      updateSelect(\"from\", { path });\n    }\n  };\n\n  const updateFrom = (field, fieldValue) => {\n    const nextFrom = {\n      ...(fromSpec || {\n        relatedTo: availableRefs[0] || \"$target\",\n        relationshipKind: \"\",\n        direction: \"both\",\n      }),\n      [field]: fieldValue,\n    };\n    updateSelect(\"from\", nextFrom);\n  };\n\n  return (\n    <div>\n      <div className=\"form-grid\">\n        <ReferenceDropdown\n          label=\"Select From\"\n          value={selectionMode}\n          onChange={(v) => setMode(v)}\n          options={[\n            { value: \"graph\", label: \"Graph (by entity kind)\" },\n            { value: \"related\", label: \"Related Entities (single hop)\" },\n            { value: \"path\", label: \"Path Traversal (multi-hop)\" },\n          ]}\n        />\n\n        {selectionMode === \"graph\" && (\n          <ReferenceDropdown\n            label=\"Entity Kind\"\n            value={select.kind || \"\"}\n            onChange={(v) => updateSelectMultiple({ kind: v || undefined, subtypes: undefined })}\n            options={entityKindOptions}\n            placeholder=\"Any kind\"\n          />\n        )}\n\n        {isRelatedMode && (\n          <>\n            <ReferenceDropdown\n              label=\"Related To\"\n              value={fromSpec?.relatedTo || availableRefs[0] || \"$target\"}\n              onChange={(v) => updateFrom(\"relatedTo\", v)}\n              options={availableRefs.map((r) => ({ value: r, label: r }))}\n              placeholder=\"Select entity...\"\n            />\n            <ReferenceDropdown\n              label=\"Relationship Kind\"\n              value={fromSpec?.relationshipKind || \"\"}\n              onChange={(v) => updateFrom(\"relationshipKind\", v)}\n              options={relationshipKindOptions}\n              placeholder=\"Select relationship...\"\n            />\n            <ReferenceDropdown\n              label=\"Direction\"\n              value={fromSpec?.direction || \"both\"}\n              onChange={(v) => updateFrom(\"direction\", v)}\n              options={[\n                { value: \"both\", label: \"Both\" },\n                { value: \"src\", label: \"Source (outgoing)\" },\n                { value: \"dst\", label: \"Destination (incoming)\" },\n              ]}\n            />\n          </>\n        )}\n\n        {isPathMode && (\n          <div className=\"grid-col-full\">\n            <span className=\"label\">Path Steps</span>\n            <div className=\"info-box-text mb-lg text-sm\">\n              Multi-hop traversal from the starting entity through relationships.\n            </div>\n          </div>\n        )}\n\n        {showPickStrategy && (\n          <ReferenceDropdown\n            label=\"Pick Strategy\"\n            value={select.pickStrategy || \"\"}\n            onChange={(v) => updateSelect(\"pickStrategy\", v || undefined)}\n            options={VARIABLE_PICK_STRATEGIES}\n            placeholder=\"Select...\"\n          />\n        )}\n\n        {showMaxResults && (\n          <div className=\"form-group\">\n            <label className=\"label\">Max Results\n            <NumberInput\n              value={select.maxResults}\n              onChange={(v) => updateSelect(\"maxResults\", v)}\n              min={1}\n              integer\n              allowEmpty\n              placeholder=\"1\"\n            />\n            </label>\n          </div>\n        )}\n      </div>\n\n      {isPathMode && (\n        <div className=\"mt-xl\">\n          {(pathSpec?.path || []).map((step, index) => (\n            <div key={index} className=\"item-card mb-lg\">\n              <div className=\"item-card-header p-lg\">\n                <div className=\"item-card-icon\">\ud83d\udd17</div>\n                <div className=\"item-card-info\">\n                  <div className=\"item-card-title\">Step {index + 1}</div>\n                </div>\n                <button\n                  className=\"btn-icon btn-icon-danger\"\n                  onClick={() => removePathStep(index)}\n                  title=\"Remove step\"\n                >\n                  \u00d7\n                </button>\n              </div>\n              <div className=\"item-card-body\">\n                <div className=\"form-grid\">\n                  {index === 0 && (\n                    <ReferenceDropdown\n                      label=\"Start From\"\n                      value={step.from || availableRefs[0] || \"$self\"}\n                      onChange={(v) => updatePathStep(index, { ...step, from: v })}\n                      options={availableRefs.map((r) => ({ value: r, label: r }))}\n                      placeholder=\"Select entity...\"\n                    />\n                  )}\n                  <ReferenceDropdown\n                    label=\"Via Relationship\"\n                    value={step.via || \"\"}\n                    onChange={(v) => updatePathStep(index, { ...step, via: v })}\n                    options={relationshipKindOptions}\n                    placeholder=\"Select relationship...\"\n                  />\n                  <ReferenceDropdown\n                    label=\"Direction\"\n                    value={step.direction || \"both\"}\n                    onChange={(v) => updatePathStep(index, { ...step, direction: v })}\n                    options={[\n                      { value: \"both\", label: \"Both\" },\n                      { value: \"src\", label: \"Source (outgoing)\" },\n                      { value: \"dst\", label: \"Destination (incoming)\" },\n                    ]}\n                  />\n                  <ReferenceDropdown\n                    label=\"Target Kind (optional)\"\n                    value={step.targetKind || \"\"}\n                    onChange={(v) => updatePathStep(index, { ...step, targetKind: v || undefined })}\n                    options={entityKindOptions}\n                    placeholder=\"Any kind\"\n                  />\n                </div>\n              </div>\n            </div>\n          ))}\n          <button className=\"btn-add\" onClick={addPathStep}>\n            + Add Step\n          </button>\n        </div>\n      )}\n\n      {(isRelatedMode || isPathMode) && (\n        <div className=\"mt-xl\">\n          <ReferenceDropdown\n            label=\"Filter by Entity Kind (optional)\"\n            value={select.kind || \"\"}\n            onChange={(v) => updateSelectMultiple({ kind: v || undefined, subtypes: undefined })}\n            options={entityKindOptions}\n            placeholder=\"Any kind\"\n          />\n        </div>\n      )}\n\n      {select.kind && (\n        <div className=\"mt-xl\">\n          <ChipSelect\n            label=\"Subtypes (optional)\"\n            value={select.subtypes || []}\n            onChange={(v) => updateSelect(\"subtypes\", v.length > 0 ? v : undefined)}\n            options={getSubtypeOptions(select.kind)}\n            placeholder=\"Any subtype\"\n          />\n        </div>\n      )}\n\n      <div className=\"mt-xl\">\n        <label htmlFor=\"status-filter-optional\" className=\"label\">Status Filter (optional)</label>\n        <input id=\"status-filter-optional\"\n          type=\"text\"\n          value={select.status || \"\"}\n          onChange={(e) => updateSelect(\"status\", e.target.value || undefined)}\n          className=\"input\"\n          placeholder=\"e.g., active\"\n        />\n      </div>\n\n      <div className=\"mt-xl\">\n        <label htmlFor=\"not-status-optional\" className=\"label\">Not Status (optional)</label>\n        <input id=\"not-status-optional\"\n          type=\"text\"\n          value={select.notStatus || \"\"}\n          onChange={(e) => updateSelect(\"notStatus\", e.target.value || undefined)}\n          className=\"input\"\n          placeholder=\"e.g., dead\"\n        />\n      </div>\n\n      <div className=\"mt-2xl\">\n        <span className=\"label\">Selection Filters</span>\n        <div className=\"info-box-text mb-lg text-sm\">\n          Optional filters to narrow down which entities can be selected. All filters must pass.\n        </div>\n        <SelectionFiltersEditor\n          filters={select.filters}\n          onChange={(filters) => updateSelect(\"filters\", filters.length > 0 ? filters : undefined)}\n// ... (truncated)", "parameters": [{"name": "{\n  value,\n  onChange,\n  schema,\n  availableRefs = [],\n  showPickStrategy = true,\n  showMaxResults = true,\n  allowPreferFilters = true,\n}", "type": "{ value: any; onChange: any; schema: any; availableRefs?: any[]; showPickStrategy?: boolean; showMaxResults?: boolean; allowPreferFilters?: boolean; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SelectionFiltersEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SelectionFiltersEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./index", "specifiers": ["ReferenceDropdown", "ChipSelect", "NumberInput"], "category": "internal"}, {"source": "../generators/constants", "specifiers": ["VARIABLE_PICK_STRATEGIES"], "category": "internal"}, {"source": "../generators/filters", "specifiers": ["SelectionFiltersEditor"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/index.js::SystemsEditor", "name": "SystemsEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/index.js", "sourceCode": "export default function SystemsEditor({\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"systems:selected\");\n  const typePickerKey = buildStorageKey(projectId, \"systems:typePicker\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [showTypePicker, setShowTypePicker] = useState(\n    () => loadStoredValue(typePickerKey) === true\n  );\n\n  // Derive selectedSystem from index\n  const resolvedIndex = selectedId\n    ? systems.findIndex((system) => system.config?.id === selectedId)\n    : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedSystem = selectedIndex !== null ? systems[selectedIndex] : null;\n  const [expandedCategories, setExpandedCategories] = useState(() => {\n    // Start with all categories expanded\n    return Object.keys(SYSTEM_CATEGORIES).reduce((acc, cat) => {\n      acc[cat] = true;\n      return acc;\n    }, {});\n  });\n  const mouseDownOnOverlay = useRef(false);\n\n  const handleOverlayMouseDown = useCallback((e) => {\n    mouseDownOnOverlay.current = e.target === e.currentTarget;\n  }, []);\n\n  const handleOverlayClick = useCallback((e) => {\n    if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n      setShowTypePicker(false);\n    }\n  }, []);\n\n  // Group systems by category (framework systems grouped together)\n  const groupedSystems = useMemo(() => {\n    const groups = {};\n    systems.forEach((system) => {\n      const category = getSystemCategory(system.systemType || \"unknown\");\n      if (!groups[category]) {\n        groups[category] = [];\n      }\n      groups[category].push(system);\n    });\n    return groups;\n  }, [systems]);\n\n  // Get ordered list of categories that have systems\n  const categories = useMemo(() => {\n    const usedCategories = Object.keys(groupedSystems);\n    // Sort by defined order in SYSTEM_CATEGORIES\n    return usedCategories.sort((a, b) => {\n      const orderA = SYSTEM_CATEGORIES[a]?.order ?? 999;\n      const orderB = SYSTEM_CATEGORIES[b]?.order ?? 999;\n      return orderA - orderB;\n    });\n  }, [groupedSystems]);\n\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  useEffect(() => {\n    setShowTypePicker(loadStoredValue(typePickerKey) === true);\n  }, [typePickerKey]);\n\n  useEffect(() => {\n    if (selectionKey) {\n      if (selectedId) {\n        saveStoredValue(selectionKey, selectedId);\n      } else {\n        clearStoredValue(selectionKey);\n      }\n    }\n  }, [selectionKey, selectedId]);\n\n  useEffect(() => {\n    if (typePickerKey) {\n      if (showTypePicker) {\n        saveStoredValue(typePickerKey, true);\n      } else {\n        clearStoredValue(typePickerKey);\n      }\n    }\n  }, [typePickerKey, showTypePicker]);\n\n  useEffect(() => {\n    if (selectedId && selectedIndex === null) {\n      setSelectedId(null);\n      clearStoredValue(selectionKey);\n    }\n  }, [selectedId, selectedIndex, selectionKey]);\n\n  const handleSystemChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex >= 0 && selectedIndex < systems.length) {\n        const newSystems = [...systems];\n        newSystems[selectedIndex] = updated;\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (system) => {\n      const index = systems.findIndex((s) => s.config?.id === system.config?.id);\n      if (index >= 0) {\n        const newSystems = [...systems];\n        newSystems[index] = { ...system, enabled: system.enabled === false ? true : false };\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedSystem &&\n      confirm(`Delete system \"${selectedSystem.config?.name || selectedSystem.config?.id}\"?`)\n    ) {\n      const newSystems = systems.filter((_, i) => i !== selectedIndex);\n      onChange(newSystems);\n      setSelectedId(null);\n    }\n  }, [systems, onChange, selectedIndex, selectedSystem]);\n\n  const handleAddSystem = useCallback(\n    (type) => {\n      const needsSelection = [\n        \"graphContagion\",\n        \"connectionEvolution\",\n        \"thresholdTrigger\",\n        \"clusterFormation\",\n        \"tagDiffusion\",\n        \"planeDiffusion\",\n      ].includes(type);\n      const newSystem = {\n        systemType: type,\n        config: {\n          id: `system_${Date.now()}`,\n          name: `New ${SYSTEM_TYPES[type]?.label || type}`,\n          description: \"\",\n          ...(needsSelection ? { selection: { strategy: \"by_kind\", kind: \"any\" } } : {}),\n        },\n      };\n      onChange([...systems, newSystem]);\n      setSelectedId(newSystem.config.id);\n      setShowTypePicker(false);\n    },\n    [systems, onChange]\n  );\n\n  const toggleCategoryExpand = useCallback((type) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [type]: !prev[type],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (category) => {\n      const categoryItems = groupedSystems[category] || [];\n      const allEnabled = categoryItems.every((s) => s.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of systems in this category\n      const categoryIds = new Set(categoryItems.map((s) => s.config?.id));\n\n      const newSystems = systems.map((s) => {\n        if (categoryIds.has(s.config?.id)) {\n          return { ...s, enabled: newEnabled };\n        }\n        return s;\n      });\n      onChange(newSystems);\n    },\n    [systems, groupedSystems, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Systems</h1>\n        <p className=\"subtitle\">\n          Configure simulation systems that run during the simulation phase. Click a system to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((category) => {\n        const categoryConfig = SYSTEM_CATEGORIES[category] || { icon: \"\u2699\ufe0f\", label: category };\n        const categoryItems = groupedSystems[category] || [];\n        const allEnabled = categoryItems.every((s) => s.enabled !== false);\n\n        return (\n          <CategorySection\n            key={category}\n            id={category}\n            icon={categoryConfig.icon}\n            label={categoryConfig.label}\n            items={categoryItems}\n            expanded={expandedCategories[category] !== false}\n            onToggleExpand={() => toggleCategoryExpand(category)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(category)}\n            gridClassName=\"list-grid\"\n            renderItem={(system) => {\n              const flatIndex = systems.findIndex((s) => s.config?.id === system.config?.id);\n              return (\n                <SystemListCard\n                  key={flatIndex}\n                  system={system}\n                  onClick={() => setSelectedId(system.config.id)}\n                  onToggle={() => handleToggle(system)}\n                  usageMap={usageMap}\n                />\n              );\n            }}\n          />\n        );\n      })}\n\n      {/* Add System button */}\n      <div className=\"mt-xl\">\n        <div\n          className=\"add-card se-add-card-wrap\"\n          onClick={() => setShowTypePicker(true)}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n        >\n          <span className=\"se-add-icon\">+</span>\n          <span>Add System</span>\n        </div>\n      </div>\n\n      {showTypePicker && (\n        <div\n          className=\"modal-overlay\"\n          onMouseDown={handleOverlayMouseDown}\n          onClick={handleOverlayClick}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n        >\n          <div className=\"modal se-type-picker-modal\">\n            <div className=\"modal-header\">\n              <div className=\"modal-title\">Choose System Type</div>\n              <button className=\"close-btn\" onClick={() => setShowTypePicker(false)}>\n                \u00d7\n              </button>\n            </div>\n            <div className=\"se-type-picker-content\">\n              <div className=\"type-picker\">\n                {Object.entries(SYSTEM_TYPES).map(([type, config]) => (\n                  <div\n                    key={type}\n                    className=\"se-type-option type-option\"\n                    onClick={() => handleAddSystem(type)}\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    <div className=\"type-option-icon\">{config.icon}</div>\n                    <div className=\"type-option-label\">{config.label}</div>\n                    <div className=\"type-option-desc\">{config.desc}</div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {selectedSystem && (\n        <SystemModal\n          system={selectedSystem}\n          onChange={handleSystemChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; systems?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "h1", "children": [], "isMap": false, "isConditional": false}, {"tag": "p", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "CategorySection", "children": [], "isMap": true, "isConditional": false}, {"tag": "SystemListCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "SystemModal", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 3}, {"name": "useRef", "count": 1}, {"name": "useCallback", "count": 8}, {"name": "useMemo", "count": 2}, {"name": "useEffect", "count": 5}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/SystemModal.jsx::SystemModal", "name": "SystemModal", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/SystemModal.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Function} props.onClose - Called to close the modal\n * @param {Function} props.onDelete - Called to delete the system\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function SystemModal({ system, onChange, onClose, onDelete, schema, pressures }) {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n  const typeConfig = SYSTEM_TYPES[system.systemType] || {};\n\n  const isFrameworkSystem = [\n    \"eraSpawner\",\n    \"eraTransition\",\n    \"universalCatalyst\",\n    \"relationshipMaintenance\",\n  ].includes(system.systemType);\n\n  // Build tabs dynamically based on system type\n  const tabs = useMemo(() => {\n    const result = [\n      { id: \"overview\", label: \"Overview\", icon: \"\ud83d\udccb\" },\n      { id: \"common\", label: \"Settings\", icon: \"\u2699\ufe0f\" },\n    ];\n\n    // Add type-specific tab\n    if (!isFrameworkSystem) {\n      switch (system.systemType) {\n        case \"graphContagion\":\n          result.push({ id: \"type\", label: \"Contagion\", icon: \"\ud83e\udda0\" });\n          break;\n        case \"connectionEvolution\":\n          result.push({ id: \"type\", label: \"Evolution\", icon: \"\ud83d\udd04\" });\n          break;\n        case \"thresholdTrigger\":\n          result.push({ id: \"type\", label: \"Trigger\", icon: \"\u26a1\" });\n          break;\n        case \"clusterFormation\":\n          result.push({ id: \"type\", label: \"Clustering\", icon: \"\ud83d\udd32\" });\n          break;\n        case \"tagDiffusion\":\n          result.push({ id: \"type\", label: \"Diffusion\", icon: \"\ud83c\udff7\ufe0f\" });\n          break;\n        case \"planeDiffusion\":\n          result.push({ id: \"type\", label: \"Plane\", icon: \"\ud83d\uddfa\ufe0f\" });\n          break;\n      }\n    } else {\n      result.push({ id: \"type\", label: \"Framework\", icon: \"\ud83d\udd27\" });\n    }\n\n    return result;\n  }, [system.systemType, isFrameworkSystem]);\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case \"overview\":\n        return <OverviewTab system={system} onChange={onChange} onDelete={onDelete} />;\n      case \"common\":\n        return (\n          <CommonSettingsTab\n            system={system}\n            onChange={onChange}\n            schema={schema}\n            pressures={pressures}\n          />\n        );\n      case \"type\":\n        if (isFrameworkSystem) {\n          return <FrameworkSystemTab system={system} onChange={onChange} />;\n        }\n        switch (system.systemType) {\n          case \"graphContagion\":\n            return <GraphContagionTab system={system} onChange={onChange} schema={schema} />;\n          case \"connectionEvolution\":\n            return <ConnectionEvolutionTab system={system} onChange={onChange} schema={schema} />;\n          case \"thresholdTrigger\":\n            return (\n              <ThresholdTriggerTab\n                system={system}\n                onChange={onChange}\n                schema={schema}\n                pressures={pressures}\n              />\n            );\n          case \"clusterFormation\":\n            return <ClusterFormationTab system={system} onChange={onChange} schema={schema} />;\n          case \"tagDiffusion\":\n            return <TagDiffusionTab system={system} onChange={onChange} schema={schema} />;\n          case \"planeDiffusion\":\n            return <PlaneDiffusionTab system={system} onChange={onChange} schema={schema} />;\n          default:\n            return null;\n        }\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <ModalShell\n      onClose={onClose}\n      icon={typeConfig.icon}\n      title={system.config?.name || system.config?.id}\n      disabled={system.enabled === false}\n      tabs={tabs}\n      activeTab={activeTab}\n      onTabChange={setActiveTab}\n      tabClassName=\"se-tab-btn\"\n    >\n      {renderTabContent()}\n    </ModalShell>\n  );\n}", "parameters": [{"name": "{ system, onChange, onClose, onDelete, schema, pressures }", "type": "{ system: any; onChange: Function; onClose: Function; onDelete: Function; schema: any; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "OverviewTab", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}, {"name": "useMemo", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./constants", "specifiers": ["SYSTEM_TYPES"], "category": "internal"}, {"source": "../shared", "specifiers": ["ModalShell"], "category": "internal"}, {"source": "./tabs", "specifiers": ["OverviewTab", "CommonSettingsTab", "GraphContagionTab", "ConnectionEvolutionTab", "ThresholdTriggerTab", "ClusterFormationTab", "TagDiffusionTab", "PlaneDiffusionTab", "FrameworkSystemTab"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/SystemsEditor.jsx::SystemsEditor", "name": "SystemsEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/SystemsEditor.jsx", "sourceCode": "export default function SystemsEditor({\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"systems:selected\");\n  const typePickerKey = buildStorageKey(projectId, \"systems:typePicker\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [showTypePicker, setShowTypePicker] = useState(\n    () => loadStoredValue(typePickerKey) === true\n  );\n\n  // Derive selectedSystem from index\n  const resolvedIndex = selectedId\n    ? systems.findIndex((system) => system.config?.id === selectedId)\n    : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedSystem = selectedIndex !== null ? systems[selectedIndex] : null;\n  const [expandedCategories, setExpandedCategories] = useState(() => {\n    // Start with all categories expanded\n    return Object.keys(SYSTEM_CATEGORIES).reduce((acc, cat) => {\n      acc[cat] = true;\n      return acc;\n    }, {});\n  });\n  const mouseDownOnOverlay = useRef(false);\n\n  const handleOverlayMouseDown = useCallback((e) => {\n    mouseDownOnOverlay.current = e.target === e.currentTarget;\n  }, []);\n\n  const handleOverlayClick = useCallback((e) => {\n    if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n      setShowTypePicker(false);\n    }\n  }, []);\n\n  // Group systems by category (framework systems grouped together)\n  const groupedSystems = useMemo(() => {\n    const groups = {};\n    systems.forEach((system) => {\n      const category = getSystemCategory(system.systemType || \"unknown\");\n      if (!groups[category]) {\n        groups[category] = [];\n      }\n      groups[category].push(system);\n    });\n    return groups;\n  }, [systems]);\n\n  // Get ordered list of categories that have systems\n  const categories = useMemo(() => {\n    const usedCategories = Object.keys(groupedSystems);\n    // Sort by defined order in SYSTEM_CATEGORIES\n    return usedCategories.sort((a, b) => {\n      const orderA = SYSTEM_CATEGORIES[a]?.order ?? 999;\n      const orderB = SYSTEM_CATEGORIES[b]?.order ?? 999;\n      return orderA - orderB;\n    });\n  }, [groupedSystems]);\n\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  useEffect(() => {\n    setShowTypePicker(loadStoredValue(typePickerKey) === true);\n  }, [typePickerKey]);\n\n  useEffect(() => {\n    if (selectionKey) {\n      if (selectedId) {\n        saveStoredValue(selectionKey, selectedId);\n      } else {\n        clearStoredValue(selectionKey);\n      }\n    }\n  }, [selectionKey, selectedId]);\n\n  useEffect(() => {\n    if (typePickerKey) {\n      if (showTypePicker) {\n        saveStoredValue(typePickerKey, true);\n      } else {\n        clearStoredValue(typePickerKey);\n      }\n    }\n  }, [typePickerKey, showTypePicker]);\n\n  useEffect(() => {\n    if (selectedId && selectedIndex === null) {\n      setSelectedId(null);\n      clearStoredValue(selectionKey);\n    }\n  }, [selectedId, selectedIndex, selectionKey]);\n\n  const handleSystemChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex >= 0 && selectedIndex < systems.length) {\n        const newSystems = [...systems];\n        newSystems[selectedIndex] = updated;\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (system) => {\n      const index = systems.findIndex((s) => s.config?.id === system.config?.id);\n      if (index >= 0) {\n        const newSystems = [...systems];\n        newSystems[index] = { ...system, enabled: system.enabled === false ? true : false };\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedSystem &&\n      confirm(`Delete system \"${selectedSystem.config?.name || selectedSystem.config?.id}\"?`)\n    ) {\n      const newSystems = systems.filter((_, i) => i !== selectedIndex);\n      onChange(newSystems);\n      setSelectedId(null);\n    }\n  }, [systems, onChange, selectedIndex, selectedSystem]);\n\n  const handleAddSystem = useCallback(\n    (type) => {\n      const needsSelection = [\n        \"graphContagion\",\n        \"connectionEvolution\",\n        \"thresholdTrigger\",\n        \"clusterFormation\",\n        \"tagDiffusion\",\n        \"planeDiffusion\",\n      ].includes(type);\n      const newSystem = {\n        systemType: type,\n        config: {\n          id: `system_${Date.now()}`,\n          name: `New ${SYSTEM_TYPES[type]?.label || type}`,\n          description: \"\",\n          ...(needsSelection ? { selection: { strategy: \"by_kind\", kind: \"any\" } } : {}),\n        },\n      };\n      onChange([...systems, newSystem]);\n      setSelectedId(newSystem.config.id);\n      setShowTypePicker(false);\n    },\n    [systems, onChange]\n  );\n\n  const toggleCategoryExpand = useCallback((type) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [type]: !prev[type],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (category) => {\n      const categoryItems = groupedSystems[category] || [];\n      const allEnabled = categoryItems.every((s) => s.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of systems in this category\n      const categoryIds = new Set(categoryItems.map((s) => s.config?.id));\n\n      const newSystems = systems.map((s) => {\n        if (categoryIds.has(s.config?.id)) {\n          return { ...s, enabled: newEnabled };\n        }\n        return s;\n      });\n      onChange(newSystems);\n    },\n    [systems, groupedSystems, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Systems</h1>\n        <p className=\"subtitle\">\n          Configure simulation systems that run during the simulation phase. Click a system to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((category) => {\n        const categoryConfig = SYSTEM_CATEGORIES[category] || { icon: \"\u2699\ufe0f\", label: category };\n        const categoryItems = groupedSystems[category] || [];\n        const allEnabled = categoryItems.every((s) => s.enabled !== false);\n\n        return (\n          <CategorySection\n            key={category}\n            id={category}\n            icon={categoryConfig.icon}\n            label={categoryConfig.label}\n            items={categoryItems}\n            expanded={expandedCategories[category] !== false}\n            onToggleExpand={() => toggleCategoryExpand(category)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(category)}\n            gridClassName=\"list-grid\"\n            renderItem={(system) => {\n              const flatIndex = systems.findIndex((s) => s.config?.id === system.config?.id);\n              return (\n                <SystemListCard\n                  key={flatIndex}\n                  system={system}\n                  onClick={() => setSelectedId(system.config.id)}\n                  onToggle={() => handleToggle(system)}\n                  usageMap={usageMap}\n                />\n              );\n            }}\n          />\n        );\n      })}\n\n      {/* Add System button */}\n      <div className=\"mt-xl\">\n        <div\n          className=\"add-card se-add-card-wrap\"\n          onClick={() => setShowTypePicker(true)}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n        >\n          <span className=\"se-add-icon\">+</span>\n          <span>Add System</span>\n        </div>\n      </div>\n\n      {showTypePicker && (\n        <div\n          className=\"modal-overlay\"\n          onMouseDown={handleOverlayMouseDown}\n          onClick={handleOverlayClick}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n        >\n          <div className=\"modal se-type-picker-modal\">\n            <div className=\"modal-header\">\n              <div className=\"modal-title\">Choose System Type</div>\n              <button className=\"close-btn\" onClick={() => setShowTypePicker(false)}>\n                \u00d7\n              </button>\n            </div>\n            <div className=\"se-type-picker-content\">\n              <div className=\"type-picker\">\n                {Object.entries(SYSTEM_TYPES).map(([type, config]) => (\n                  <div\n                    key={type}\n                    className=\"se-type-option type-option\"\n                    onClick={() => handleAddSystem(type)}\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    <div className=\"type-option-icon\">{config.icon}</div>\n                    <div className=\"type-option-label\">{config.label}</div>\n                    <div className=\"type-option-desc\">{config.desc}</div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {selectedSystem && (\n        <SystemModal\n          system={selectedSystem}\n          onChange={handleSystemChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; systems?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "h1", "children": [], "isMap": false, "isConditional": false}, {"tag": "p", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "CategorySection", "children": [], "isMap": true, "isConditional": false}, {"tag": "SystemListCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "SystemModal", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 3}, {"name": "useRef", "count": 1}, {"name": "useCallback", "count": 8}, {"name": "useMemo", "count": 2}, {"name": "useEffect", "count": 5}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useCallback", "useMemo", "useEffect", "useRef"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./constants", "specifiers": ["SYSTEM_TYPES", "SYSTEM_CATEGORIES", "getSystemCategory"], "category": "internal"}, {"source": "../shared", "specifiers": ["CategorySection"], "category": "internal"}, {"source": "./cards/SystemListCard", "specifiers": ["SystemListCard"], "category": "internal"}, {"source": "./SystemModal", "specifiers": ["SystemModal"], "category": "internal"}, {"source": "../../utils/persistence", "specifiers": ["buildStorageKey", "clearStoredValue", "loadStoredValue", "saveStoredValue"], "category": "internal"}, {"source": "./SystemsEditor.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/validation/index.js::ValidationEditor", "name": "ValidationEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/validation/index.js", "sourceCode": "export default function ValidationEditor({\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}) {\n  const validationResults = useMemo(\n    () => runValidations(usageMap, schema, eras, pressures, generators, systems),\n    [usageMap, schema, eras, pressures, generators, systems]\n  );\n\n  // Count orphans from usageMap for summary\n  const orphanCounts = useMemo(() => {\n    if (!usageMap?.validation?.orphans)\n      return { generators: 0, systems: 0, pressures: 0, total: 0 };\n    const orphans = usageMap.validation.orphans;\n    const generators = orphans.filter((o) => o.type === \"generator\").length;\n    const systems = orphans.filter((o) => o.type === \"system\").length;\n    const pressures = orphans.filter((o) => o.type === \"pressure\").length;\n    return { generators, systems, pressures, total: generators + systems + pressures };\n  }, [usageMap]);\n\n  const overallStatus = getOverallStatus(validationResults);\n  const totalIssues = validationResults.errors.length + validationResults.warnings.length;\n  const hasNamingProfiles = useMemo(\n    () => (schema.cultures || []).some((culture) => culture.naming?.profiles?.length),\n    [schema]\n  );\n\n  let statusModifier;\n  if (overallStatus === \"clean\") {\n    statusModifier = \"validation-status-clean\";\n  } else if (overallStatus === \"warning\") {\n    statusModifier = \"validation-status-warning\";\n  } else {\n    statusModifier = \"validation-status-error\";\n  }\n  const statusBadgeClass = `validation-status-badge ${statusModifier}`;\n\n  const handleItemClick = (itemId) => {\n    if (onNavigateToGenerator) {\n      onNavigateToGenerator(itemId);\n    }\n  };\n\n  // Count total affected items\n  const totalAffectedItems = [...validationResults.errors, ...validationResults.warnings].reduce(\n    (sum, issue) => sum + issue.affectedItems.length,\n    0\n  );\n\n  return (\n    <div className=\"validation-container\">\n      <div className=\"validation-header\">\n        <div className=\"flex-between items-start\">\n          <div>\n            <h1 className=\"validation-title\">\n              Validation\n              <span className={statusBadgeClass}>\n                {(() => {\n                  if (overallStatus === \"clean\") return \"All Clear\";\n                  const issueWord = totalIssues === 1 ? \"Issue\" : \"Issues\";\n                  return `${totalIssues} ${issueWord}`;\n                })()}\n              </span>\n            </h1>\n            <p className=\"validation-subtitle\">\n              Semantic validation: reference integrity, pressure balance, and dead code detection.\n              Structure validation runs automatically as a gate before simulation.\n            </p>\n          </div>\n          {totalIssues > 0 && (\n            <div className=\"validation-export-row\">\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsJson(validationResults)}\n                title=\"Export validation report as JSON\"\n              >\n                Export JSON\n              </button>\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsCsv(validationResults)}\n                title=\"Export validation report as CSV\"\n              >\n                Export CSV\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"validation-summary-cards validation-summary-cards-4\">\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-danger\">\n            {validationResults.errors.length}\n          </div>\n          <div className=\"validation-summary-label\">Errors</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-warning\">\n            {validationResults.warnings.length}\n          </div>\n          <div className=\"validation-summary-label\">Warnings</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div\n            className={`validation-summary-value ${orphanCounts.total > 0 ? \"text-muted\" : \"text-info\"}`}\n          >\n            {orphanCounts.total}\n          </div>\n          <div className=\"validation-summary-label\">Unused</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-info\">\n            {totalAffectedItems}\n          </div>\n          <div className=\"validation-summary-label\">Affected Items</div>\n        </div>\n      </div>\n\n      {/* Clean state */}\n      {overallStatus === \"clean\" && (\n        <div className=\"validation-clean-state\">\n          <div className=\"validation-clean-icon\">\u2713</div>\n          <div className=\"validation-clean-title\">All Validations Passed</div>\n          <div className=\"validation-clean-message\">\n            Your configuration looks good. No issues detected.\n          </div>\n        </div>\n      )}\n\n      {/* Errors section */}\n      {validationResults.errors.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u274c</span>\n              Errors\n            </div>\n            <span className=\"validation-section-count validation-status-error\">\n              {validationResults.errors.length}\n            </span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.errors.map((error) => (\n              <IssueCard key={error.id} issue={error} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Warnings section */}\n      {validationResults.warnings.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u26a0\ufe0f</span>\n              Warnings\n            </div>\n            <span className=\"validation-section-count\">{validationResults.warnings.length}</span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.warnings.map((warning) => (\n              <IssueCard key={warning.id} issue={warning} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Dependency Viewer */}\n      {usageMap && (\n        <div className=\"mb-2xl\">\n          <DependencyViewer usageMap={usageMap} />\n        </div>\n      )}\n\n      {/* Naming Profile Mappings */}\n      {hasNamingProfiles && (\n        <div className=\"mb-2xl\">\n          <NamingProfileMappingViewer generators={generators} schema={schema} />\n        </div>\n      )}\n\n      {/* Rule info */}\n      <div className=\"validation-rule-info\">\n        <div className=\"validation-rule-title\">\n          Active Validation Rules ({Object.keys(validationRules).length})\n        </div>\n        <ul className=\"validation-rule-list\">\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-danger\">\u25cf</span>\n            <strong>Reference Validation:</strong> Entity kinds (generators, pressures, systems),\n            relationship kinds (generators, pressures, systems), pressure IDs (generators, systems,\n            eras, actions), era\u2192generator/system references\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Balance Validation:</strong> Pressure sources/sinks (feedback, homeostasis,\n            generators, systems), orphan generators/systems (not in any era)\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Configuration Quality:</strong> Subtypes, statuses, cultures, tags, numeric\n            ranges\n          </li>\n        </ul>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}", "type": "{ schema?: Readonly<{ entityKinds: any[]; relationshipKinds: any[]; cultures: any[]; tagRegistry: any[]; }>; eras?: any[]; pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; usageMap?: any; onNavigateToGenerator: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "h1", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "p", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "IssueCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "IssueCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "DependencyViewer", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "NamingProfileMappingViewer", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "ul", "children": [{"tag": "li", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "strong", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "li", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "strong", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "li", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "strong", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 3}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/validation/ValidationEditor.jsx::ValidationEditor", "name": "ValidationEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/validation/ValidationEditor.jsx", "sourceCode": "export default function ValidationEditor({\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}) {\n  const validationResults = useMemo(\n    () => runValidations(usageMap, schema, eras, pressures, generators, systems),\n    [usageMap, schema, eras, pressures, generators, systems]\n  );\n\n  // Count orphans from usageMap for summary\n  const orphanCounts = useMemo(() => {\n    if (!usageMap?.validation?.orphans)\n      return { generators: 0, systems: 0, pressures: 0, total: 0 };\n    const orphans = usageMap.validation.orphans;\n    const generators = orphans.filter((o) => o.type === \"generator\").length;\n    const systems = orphans.filter((o) => o.type === \"system\").length;\n    const pressures = orphans.filter((o) => o.type === \"pressure\").length;\n    return { generators, systems, pressures, total: generators + systems + pressures };\n  }, [usageMap]);\n\n  const overallStatus = getOverallStatus(validationResults);\n  const totalIssues = validationResults.errors.length + validationResults.warnings.length;\n  const hasNamingProfiles = useMemo(\n    () => (schema.cultures || []).some((culture) => culture.naming?.profiles?.length),\n    [schema]\n  );\n\n  let statusModifier;\n  if (overallStatus === \"clean\") {\n    statusModifier = \"validation-status-clean\";\n  } else if (overallStatus === \"warning\") {\n    statusModifier = \"validation-status-warning\";\n  } else {\n    statusModifier = \"validation-status-error\";\n  }\n  const statusBadgeClass = `validation-status-badge ${statusModifier}`;\n\n  const handleItemClick = (itemId) => {\n    if (onNavigateToGenerator) {\n      onNavigateToGenerator(itemId);\n    }\n  };\n\n  // Count total affected items\n  const totalAffectedItems = [...validationResults.errors, ...validationResults.warnings].reduce(\n    (sum, issue) => sum + issue.affectedItems.length,\n    0\n  );\n\n  return (\n    <div className=\"validation-container\">\n      <div className=\"validation-header\">\n        <div className=\"flex-between items-start\">\n          <div>\n            <h1 className=\"validation-title\">\n              Validation\n              <span className={statusBadgeClass}>\n                {(() => {\n                  if (overallStatus === \"clean\") return \"All Clear\";\n                  const issueWord = totalIssues === 1 ? \"Issue\" : \"Issues\";\n                  return `${totalIssues} ${issueWord}`;\n                })()}\n              </span>\n            </h1>\n            <p className=\"validation-subtitle\">\n              Semantic validation: reference integrity, pressure balance, and dead code detection.\n              Structure validation runs automatically as a gate before simulation.\n            </p>\n          </div>\n          {totalIssues > 0 && (\n            <div className=\"validation-export-row\">\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsJson(validationResults)}\n                title=\"Export validation report as JSON\"\n              >\n                Export JSON\n              </button>\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsCsv(validationResults)}\n                title=\"Export validation report as CSV\"\n              >\n                Export CSV\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"validation-summary-cards validation-summary-cards-4\">\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-danger\">\n            {validationResults.errors.length}\n          </div>\n          <div className=\"validation-summary-label\">Errors</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-warning\">\n            {validationResults.warnings.length}\n          </div>\n          <div className=\"validation-summary-label\">Warnings</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div\n            className={`validation-summary-value ${orphanCounts.total > 0 ? \"text-muted\" : \"text-info\"}`}\n          >\n            {orphanCounts.total}\n          </div>\n          <div className=\"validation-summary-label\">Unused</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-info\">\n            {totalAffectedItems}\n          </div>\n          <div className=\"validation-summary-label\">Affected Items</div>\n        </div>\n      </div>\n\n      {/* Clean state */}\n      {overallStatus === \"clean\" && (\n        <div className=\"validation-clean-state\">\n          <div className=\"validation-clean-icon\">\u2713</div>\n          <div className=\"validation-clean-title\">All Validations Passed</div>\n          <div className=\"validation-clean-message\">\n            Your configuration looks good. No issues detected.\n          </div>\n        </div>\n      )}\n\n      {/* Errors section */}\n      {validationResults.errors.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u274c</span>\n              Errors\n            </div>\n            <span className=\"validation-section-count validation-status-error\">\n              {validationResults.errors.length}\n            </span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.errors.map((error) => (\n              <IssueCard key={error.id} issue={error} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Warnings section */}\n      {validationResults.warnings.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u26a0\ufe0f</span>\n              Warnings\n            </div>\n            <span className=\"validation-section-count\">{validationResults.warnings.length}</span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.warnings.map((warning) => (\n              <IssueCard key={warning.id} issue={warning} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Dependency Viewer */}\n      {usageMap && (\n        <div className=\"mb-2xl\">\n          <DependencyViewer usageMap={usageMap} />\n        </div>\n      )}\n\n      {/* Naming Profile Mappings */}\n      {hasNamingProfiles && (\n        <div className=\"mb-2xl\">\n          <NamingProfileMappingViewer generators={generators} schema={schema} />\n        </div>\n      )}\n\n      {/* Rule info */}\n      <div className=\"validation-rule-info\">\n        <div className=\"validation-rule-title\">\n          Active Validation Rules ({Object.keys(validationRules).length})\n        </div>\n        <ul className=\"validation-rule-list\">\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-danger\">\u25cf</span>\n            <strong>Reference Validation:</strong> Entity kinds (generators, pressures, systems),\n            relationship kinds (generators, pressures, systems), pressure IDs (generators, systems,\n            eras, actions), era\u2192generator/system references\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Balance Validation:</strong> Pressure sources/sinks (feedback, homeostasis,\n            generators, systems), orphan generators/systems (not in any era)\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Configuration Quality:</strong> Subtypes, statuses, cultures, tags, numeric\n            ranges\n          </li>\n        </ul>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}", "type": "{ schema?: Readonly<{ entityKinds: any[]; relationshipKinds: any[]; cultures: any[]; tagRegistry: any[]; }>; eras?: any[]; pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; usageMap?: any; onNavigateToGenerator: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "h1", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "p", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "IssueCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "IssueCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "DependencyViewer", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "NamingProfileMappingViewer", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "ul", "children": [{"tag": "li", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "strong", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "li", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "strong", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "li", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "strong", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 3}], "imports": [{"source": "react", "specifiers": ["React", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../DependencyViewer", "specifiers": ["DependencyViewer"], "category": "internal"}, {"source": "../NamingProfileMappingViewer", "specifiers": ["NamingProfileMappingViewer"], "category": "internal"}, {"source": "./validation.css", "specifiers": [], "category": "internal"}, {"source": "./utils", "specifiers": ["exportAsJson", "exportAsCsv", "runValidations", "getOverallStatus", "validationRules"], "category": "internal"}, {"source": "./cards", "specifiers": ["IssueCard"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/weight-matrix/index.js::WeightMatrixEditor", "name": "WeightMatrixEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/weight-matrix/index.js", "sourceCode": "export default function WeightMatrixEditor({\n  generators = [],\n  systems = [],\n  eras = [],\n  onErasChange\n}) {\n  const [viewMode, setViewMode] = useState(\"generators\"); // 'generators' | 'systems'\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [editingCell, setEditingCell] = useState(null); // shape: rowId + eraId\n  const [editValue, setEditValue] = useState(\"\");\n  const [selectedRows, setSelectedRows] = useState(new Set());\n  const [copiedRow, setCopiedRow] = useState(null); // { id, weights: { eraId: value } }\n  const inputRef = useRef(null);\n\n  // Get current items based on view mode\n  const items = useMemo(() => {\n    const source = viewMode === \"generators\" ? generators : systems;\n    return source.map(item => ({\n      id: viewMode === \"generators\" ? item.id : item.config.id,\n      name: viewMode === \"generators\" ? item.name || item.id : item.config.name || item.config.id,\n      type: viewMode === \"generators\" ? \"generator\" : item.systemType\n    }));\n  }, [viewMode, generators, systems]);\n\n  // Detect orphaned references - IDs in eras that don't exist in generators/systems\n  const orphanedReferences = useMemo(() => {\n    const generatorIds = new Set(generators.map(g => g.id));\n    const systemIds = new Set(systems.map(s => s.config.id));\n    const orphanedGenerators = [];\n    const orphanedSystems = [];\n    eras.forEach(era => {\n      // Check template weights\n      Object.keys(era.templateWeights || {}).forEach(id => {\n        if (!generatorIds.has(id)) {\n          orphanedGenerators.push({\n            id,\n            eraId: era.id,\n            eraName: era.name\n          });\n        }\n      });\n\n      // Check system modifiers\n      Object.keys(era.systemModifiers || {}).forEach(id => {\n        if (!systemIds.has(id)) {\n          orphanedSystems.push({\n            id,\n            eraId: era.id,\n            eraName: era.name\n          });\n        }\n      });\n    });\n    return {\n      generators: orphanedGenerators,\n      systems: orphanedSystems\n    };\n  }, [eras, generators, systems]);\n\n  // Count total orphans\n  const totalOrphans = orphanedReferences.generators.length + orphanedReferences.systems.length;\n\n  // Clean up all orphaned references\n  const cleanupOrphanedReferences = useCallback(() => {\n    const generatorIds = new Set(generators.map(g => g.id));\n    const systemIds = new Set(systems.map(s => s.config.id));\n    const newEras = eras.map(era => {\n      const newTemplateWeights = {\n        ...era.templateWeights\n      };\n      const newSystemModifiers = {\n        ...era.systemModifiers\n      };\n\n      // Remove orphaned generator references\n      Object.keys(newTemplateWeights).forEach(id => {\n        if (!generatorIds.has(id)) {\n          delete newTemplateWeights[id];\n        }\n      });\n\n      // Remove orphaned system references\n      Object.keys(newSystemModifiers).forEach(id => {\n        if (!systemIds.has(id)) {\n          delete newSystemModifiers[id];\n        }\n      });\n      return {\n        ...era,\n        templateWeights: newTemplateWeights,\n        systemModifiers: newSystemModifiers\n      };\n    });\n    onErasChange(newEras);\n  }, [eras, generators, systems, onErasChange]);\n\n  // Filter items by search\n  const filteredItems = useMemo(() => {\n    if (!searchQuery) return items;\n    const query = searchQuery.toLowerCase();\n    return items.filter(item => item.id.toLowerCase().includes(query) || item.name.toLowerCase().includes(query));\n  }, [items, searchQuery]);\n\n  // Get weight for an item in an era\n  const getWeight = useCallback((itemId, eraId) => {\n    const era = eras.find(e => e.id === eraId);\n    if (!era) return null;\n    const weights = viewMode === \"generators\" ? era.templateWeights : era.systemModifiers;\n    return weights?.[itemId] ?? null;\n  }, [eras, viewMode]);\n\n  // Set weight for an item in an era\n  const setWeight = useCallback((itemId, eraId, value) => {\n    const newEras = eras.map(era => {\n      if (era.id !== eraId) return era;\n      const weightsKey = viewMode === \"generators\" ? \"templateWeights\" : \"systemModifiers\";\n      const weights = {\n        ...era[weightsKey]\n      };\n      if (value === null || value === \"\" || value === undefined) {\n        delete weights[itemId];\n      } else {\n        weights[itemId] = parseFloat(value) || 0;\n      }\n      return {\n        ...era,\n        [weightsKey]: weights\n      };\n    });\n    onErasChange(newEras);\n  }, [eras, viewMode, onErasChange]);\n\n  // Handle cell click to start editing\n  const handleCellClick = (rowId, eraId) => {\n    const currentValue = getWeight(rowId, eraId);\n    setEditingCell({\n      rowId,\n      eraId\n    });\n    setEditValue(currentValue !== null ? String(currentValue) : \"\");\n    setTimeout(() => inputRef.current?.select(), 0);\n  };\n\n  // Handle cell edit completion\n  const handleCellBlur = () => {\n    if (editingCell) {\n      const value = editValue.trim();\n      if (value === \"\") {\n        setWeight(editingCell.rowId, editingCell.eraId, null);\n      } else {\n        const numValue = parseFloat(value);\n        if (!isNaN(numValue)) {\n          setWeight(editingCell.rowId, editingCell.eraId, numValue);\n        }\n      }\n      setEditingCell(null);\n    }\n  };\n\n  // Handle keyboard navigation\n  const handleKeyDown = e => {\n    if (e.key === \"Enter\" || e.key === \"Tab\") {\n      e.preventDefault();\n      handleCellBlur();\n    } else if (e.key === \"Escape\") {\n      setEditingCell(null);\n    }\n  };\n\n  // Apply weight to all eras for a row\n  const applyToAllEras = (itemId, value) => {\n    const newEras = eras.map(era => {\n      const weightsKey = viewMode === \"generators\" ? \"templateWeights\" : \"systemModifiers\";\n      const weights = {\n        ...era[weightsKey]\n      };\n      if (value === null || value === 0) {\n        delete weights[itemId];\n      } else {\n        weights[itemId] = value;\n      }\n      return {\n        ...era,\n        [weightsKey]: weights\n      };\n    });\n    onErasChange(newEras);\n  };\n\n  // Copy row weights\n  const copyRow = itemId => {\n    const weights = {};\n    eras.forEach(era => {\n      const value = getWeight(itemId, era.id);\n      if (value !== null) {\n        weights[era.id] = value;\n      }\n    });\n    setCopiedRow({\n      id: itemId,\n      weights\n    });\n  };\n\n  // Paste row weights\n  const pasteRow = targetItemId => {\n    if (!copiedRow) return;\n    const newEras = eras.map(era => {\n      const weightsKey = viewMode === \"generators\" ? \"templateWeights\" : \"systemModifiers\";\n      const weights = {\n        ...era[weightsKey]\n      };\n      if (copiedRow.weights[era.id] !== undefined) {\n        weights[targetItemId] = copiedRow.weights[era.id];\n      } else {\n        delete weights[targetItemId];\n      }\n      return {\n        ...era,\n        [weightsKey]: weights\n      };\n    });\n    onErasChange(newEras);\n  };\n\n  // Remove from all eras\n  const removeFromAllEras = itemId => {\n    const newEras = eras.map(era => {\n      const weightsKey = viewMode === \"generators\" ? \"templateWeights\" : \"systemModifiers\";\n      const weights = {\n        ...era[weightsKey]\n      };\n      delete weights[itemId];\n      return {\n        ...era,\n        [weightsKey]: weights\n      };\n    });\n    onErasChange(newEras);\n  };\n\n  // Check if item is used in any era\n  const isUsedInAnyEra = itemId => {\n    return eras.some(era => {\n      const weights = viewMode === \"generators\" ? era.templateWeights : era.systemModifiers;\n      return weights?.[itemId] !== undefined && weights[itemId] !== null;\n    });\n  };\n\n  // Count eras where item is active\n  const countActiveEras = itemId => {\n    return eras.filter(era => {\n      const weights = viewMode === \"generators\" ? era.templateWeights : era.systemModifiers;\n      return weights?.[itemId] > 0;\n    }).length;\n  };\n\n  // Quick set weight for bulk operations\n  const [quickSetValue, setQuickSetValue] = useState(1);\n  const handleQuickSetSelected = () => {\n    const value = quickSetValue ?? 0;\n    selectedRows.forEach(itemId => {\n      applyToAllEras(itemId, value);\n    });\n    setSelectedRows(new Set());\n  };\n  const toggleRowSelection = itemId => {\n    const newSelection = new Set(selectedRows);\n    if (newSelection.has(itemId)) {\n      newSelection.delete(itemId);\n    } else {\n      newSelection.add(itemId);\n    }\n    setSelectedRows(newSelection);\n  };\n  const selectAllRows = () => {\n    if (selectedRows.size === filteredItems.length) {\n      setSelectedRows(new Set());\n    } else {\n      setSelectedRows(new Set(filteredItems.map(i => i.id)));\n    }\n  };\n  return <div className=\"weight-matrix-editor\">\n      <div className=\"header\">\n        <h1 className=\"title\">Weight Matrix</h1>\n        <p className=\"subtitle\">\n          Manage {viewMode} weights across all eras in a spreadsheet view. Click any cell to edit,\n          or use row actions for bulk operations.\n        </p>\n      </div>\n\n      {/* Orphaned References Warning */}\n      {totalOrphans > 0 && <div className=\"orphan-warning\">\n          <div className=\"orphan-warning-content\">\n            <span className=\"orphan-warning-icon\">\u26a0\ufe0f</span>\n            <div className=\"orphan-warning-text\">\n              <strong>\n                {totalOrphans} orphaned reference{totalOrphans !== 1 ? \"s\" : \"\"} detected\n              </strong>\n              <span className=\"orphan-warning-details\">\n// ... (truncated)", "parameters": [{"name": "{\n  generators = [],\n  systems = [],\n  eras = [],\n  onErasChange\n}", "type": "{ generators?: any[]; systems?: any[]; eras?: any[]; onErasChange: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "h1", "children": [], "isMap": false, "isConditional": false}, {"tag": "p", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "strong", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "button", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "table", "children": [{"tag": "thead", "children": [{"tag": "tr", "children": [{"tag": "th", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "th", "children": [], "isMap": false, "isConditional": false}, {"tag": "th", "children": [], "isMap": false, "isConditional": false}, {"tag": "th", "children": [], "isMap": true, "isConditional": false}, {"tag": "th", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "tbody", "children": [{"tag": "tr", "children": [{"tag": "td", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 7}, {"name": "useRef", "count": 1}, {"name": "useMemo", "count": 3}, {"name": "useCallback", "count": 3}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/cards/ActionListCard.jsx::ActionListCard", "name": "ActionListCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/cards/ActionListCard.jsx", "sourceCode": "export function ActionListCard({ action, onClick, onToggle, usageMap }) {\n  const isEnabled = action.enabled !== false;\n  const pressureMods = action.probability?.pressureModifiers || [];\n\n  // Get validation info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"action\", action.id)\n        : { invalidRefs: [], compatibility: [], isOrphan: false },\n    [usageMap, action.id]\n  );\n\n  const hasErrors = validation.invalidRefs.length > 0;\n  const hasCompatibilityIssues = validation.compatibility?.length > 0;\n\n  const formatActorKinds = () => {\n    const selection = action.actor?.selection;\n    if (!selection) return \"any\";\n    if (selection.kind) return selection.kind;\n    if (selection.kinds?.length) return selection.kinds.join(\", \");\n    return selection.strategy || \"any\";\n  };\n\n  const formatTargetKind = () => {\n    const targeting = action.targeting;\n    if (!targeting) return \"none\";\n    if (targeting.kind) return targeting.kind;\n    if (targeting.kinds?.length) return targeting.kinds.join(\", \");\n    return targeting.strategy || \"none\";\n  };\n\n  const cardClasses = [\n    \"card card-clickable\",\n    !isEnabled && \"card-disabled\",\n    hasErrors && \"card-error\",\n    hasCompatibilityIssues && !hasErrors && \"card-warning\",\n  ]\n    .filter(Boolean)\n    .join(\" \");\n\n  return (\n    <div className={cardClasses} onClick={onClick} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }} >\n      <div className=\"card-header\">\n        <div>\n          <div className=\"flex items-center gap-md\">\n            <span className=\"card-title\">{action.name || action.id}</span>\n            {hasErrors && (\n              <span className=\"badge badge-validation badge-error\">\n                {validation.invalidRefs.length} error\n                {validation.invalidRefs.length !== 1 ? \"s\" : \"\"}\n              </span>\n            )}\n            {hasCompatibilityIssues && !hasErrors && (\n              <span className=\"badge badge-validation badge-compatibility\">\n                {validation.compatibility.length} warning\n                {validation.compatibility.length !== 1 ? \"s\" : \"\"}\n              </span>\n            )}\n          </div>\n          <div className=\"card-id\">{action.id}</div>\n        </div>\n        <div\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n          className={isEnabled ? \"toggle toggle-on\" : \"toggle\"}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n        >\n          <div className=\"toggle-knob\" />\n        </div>\n      </div>\n\n      <div className=\"card-badges\">\n        <span className=\"badge badge-actor\">{formatActorKinds()}</span>\n        <span className=\"badge badge-target\">\u2192 {formatTargetKind()}</span>\n        {pressureMods.length > 0 && (\n          <span className=\"badge badge-pressure\">\n            {pressureMods.length} pressure{pressureMods.length !== 1 ? \"s\" : \"\"}\n          </span>\n        )}\n      </div>\n\n      {action.description && <div className=\"card-desc\">{action.description}</div>}\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onClick, onToggle, usageMap }", "type": "{ action: any; onClick: any; onToggle: any; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["getElementValidation"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/cards/index.js::ActionListCard", "name": "ActionListCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/cards/index.js", "sourceCode": "export function ActionListCard({ action, onClick, onToggle, usageMap }) {\n  const isEnabled = action.enabled !== false;\n  const pressureMods = action.probability?.pressureModifiers || [];\n\n  // Get validation info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"action\", action.id)\n        : { invalidRefs: [], compatibility: [], isOrphan: false },\n    [usageMap, action.id]\n  );\n\n  const hasErrors = validation.invalidRefs.length > 0;\n  const hasCompatibilityIssues = validation.compatibility?.length > 0;\n\n  const formatActorKinds = () => {\n    const selection = action.actor?.selection;\n    if (!selection) return \"any\";\n    if (selection.kind) return selection.kind;\n    if (selection.kinds?.length) return selection.kinds.join(\", \");\n    return selection.strategy || \"any\";\n  };\n\n  const formatTargetKind = () => {\n    const targeting = action.targeting;\n    if (!targeting) return \"none\";\n    if (targeting.kind) return targeting.kind;\n    if (targeting.kinds?.length) return targeting.kinds.join(\", \");\n    return targeting.strategy || \"none\";\n  };\n\n  const cardClasses = [\n    \"card card-clickable\",\n    !isEnabled && \"card-disabled\",\n    hasErrors && \"card-error\",\n    hasCompatibilityIssues && !hasErrors && \"card-warning\",\n  ]\n    .filter(Boolean)\n    .join(\" \");\n\n  return (\n    <div className={cardClasses} onClick={onClick} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }} >\n      <div className=\"card-header\">\n        <div>\n          <div className=\"flex items-center gap-md\">\n            <span className=\"card-title\">{action.name || action.id}</span>\n            {hasErrors && (\n              <span className=\"badge badge-validation badge-error\">\n                {validation.invalidRefs.length} error\n                {validation.invalidRefs.length !== 1 ? \"s\" : \"\"}\n              </span>\n            )}\n            {hasCompatibilityIssues && !hasErrors && (\n              <span className=\"badge badge-validation badge-compatibility\">\n                {validation.compatibility.length} warning\n                {validation.compatibility.length !== 1 ? \"s\" : \"\"}\n              </span>\n            )}\n          </div>\n          <div className=\"card-id\">{action.id}</div>\n        </div>\n        <div\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n          className={isEnabled ? \"toggle toggle-on\" : \"toggle\"}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n        >\n          <div className=\"toggle-knob\" />\n        </div>\n      </div>\n\n      <div className=\"card-badges\">\n        <span className=\"badge badge-actor\">{formatActorKinds()}</span>\n        <span className=\"badge badge-target\">\u2192 {formatTargetKind()}</span>\n        {pressureMods.length > 0 && (\n          <span className=\"badge badge-pressure\">\n            {pressureMods.length} pressure{pressureMods.length !== 1 ? \"s\" : \"\"}\n          </span>\n        )}\n      </div>\n\n      {action.description && <div className=\"card-desc\">{action.description}</div>}\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onClick, onToggle, usageMap }", "type": "{ action: any; onClick: any; onToggle: any; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/modals/ActionModal.jsx::ActionModal", "name": "ActionModal", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/modals/ActionModal.jsx", "sourceCode": "export function ActionModal({ action, onChange, onClose, onDelete, schema, pressures }) {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case \"overview\":\n        return <OverviewTab action={action} onChange={onChange} onDelete={onDelete} />;\n      case \"actor\":\n        return (\n          <ActorTab action={action} onChange={onChange} schema={schema} pressures={pressures} />\n        );\n      case \"instigator\":\n        return <InstigatorTab action={action} onChange={onChange} schema={schema} />;\n      case \"targeting\":\n        return <TargetingTab action={action} onChange={onChange} schema={schema} />;\n      case \"variables\":\n        return <VariablesTab action={action} onChange={onChange} schema={schema} />;\n      case \"outcome\":\n        return (\n          <OutcomeTab action={action} onChange={onChange} schema={schema} pressures={pressures} />\n        );\n      case \"probability\":\n        return <ProbabilityTab action={action} onChange={onChange} pressures={pressures} />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <ModalShell\n      onClose={onClose}\n      icon=\"\ud83c\udfad\"\n      title={action.name || action.id}\n      disabled={action.enabled === false}\n      tabs={TABS}\n      activeTab={activeTab}\n      onTabChange={setActiveTab}\n      tabClassName=\"ae-tab-btn\"\n    >\n      {renderTabContent()}\n    </ModalShell>\n  );\n}", "parameters": [{"name": "{ action, onChange, onClose, onDelete, schema, pressures }", "type": "{ action: any; onChange: any; onClose: any; onDelete: any; schema: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "OverviewTab", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["TABS"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ModalShell"], "category": "internal"}, {"source": "../tabs", "specifiers": ["OverviewTab", "ActorTab", "InstigatorTab", "TargetingTab", "VariablesTab", "OutcomeTab", "ProbabilityTab"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/modals/index.js::ActionModal", "name": "ActionModal", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/modals/index.js", "sourceCode": "export function ActionModal({ action, onChange, onClose, onDelete, schema, pressures }) {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case \"overview\":\n        return <OverviewTab action={action} onChange={onChange} onDelete={onDelete} />;\n      case \"actor\":\n        return (\n          <ActorTab action={action} onChange={onChange} schema={schema} pressures={pressures} />\n        );\n      case \"instigator\":\n        return <InstigatorTab action={action} onChange={onChange} schema={schema} />;\n      case \"targeting\":\n        return <TargetingTab action={action} onChange={onChange} schema={schema} />;\n      case \"variables\":\n        return <VariablesTab action={action} onChange={onChange} schema={schema} />;\n      case \"outcome\":\n        return (\n          <OutcomeTab action={action} onChange={onChange} schema={schema} pressures={pressures} />\n        );\n      case \"probability\":\n        return <ProbabilityTab action={action} onChange={onChange} pressures={pressures} />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <ModalShell\n      onClose={onClose}\n      icon=\"\ud83c\udfad\"\n      title={action.name || action.id}\n      disabled={action.enabled === false}\n      tabs={TABS}\n      activeTab={activeTab}\n      onTabChange={setActiveTab}\n      tabClassName=\"ae-tab-btn\"\n    >\n      {renderTabContent()}\n    </ModalShell>\n  );\n}", "parameters": [{"name": "{ action, onChange, onClose, onDelete, schema, pressures }", "type": "{ action: any; onChange: any; onClose: any; onDelete: any; schema: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "OverviewTab", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/ActorTab.jsx::ActorTab", "name": "ActorTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/ActorTab.jsx", "sourceCode": "export function ActorTab({ action, onChange, schema, pressures }) {\n  const actor = action.actor || {};\n  const selection = actor.selection || { strategy: \"by_kind\" };\n  const conditions = actor.conditions || [];\n\n  const updateActor = (field, value) => {\n    onChange({\n      ...action,\n      actor: { ...actor, [field]: value },\n    });\n  };\n\n  const availableRefs = [\"$actor\"];\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Actor Configuration</div>\n        <div className=\"info-box-text\">\n          The actor is the primary entity that performs the action on the target. Optional\n          instigator rules can provide richer context.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83c\udfad Actor Selection</div>\n        <SelectionRuleEditor\n          value={selection}\n          onChange={(updated) => updateActor(\"selection\", updated)}\n          schema={schema}\n          availableRefs={availableRefs}\n          showPickStrategy={false}\n          showMaxResults={false}\n        />\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2705 Actor Conditions ({conditions.length})</div>\n        <div className=\"section-desc\">\n          Additional rules that must pass for the actor to perform this action.\n        </div>\n\n        {conditions.length === 0 ? (\n          <div className=\"empty-state-compact\">No conditions defined.</div>\n        ) : (\n          conditions.map((condition, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={condition}\n              onChange={(updated) => {\n                const next = [...conditions];\n                next[index] = updated;\n                updateActor(\"conditions\", next);\n              }}\n              onRemove={() =>\n                updateActor(\n                  \"conditions\",\n                  conditions.filter((_, i) => i !== index)\n                )\n              }\n              schema={schema}\n              pressures={pressures}\n            />\n          ))\n        )}\n\n        <AddRuleButton\n          onAdd={(type) => {\n            const newRule = createNewRule(type, pressures);\n            updateActor(\"conditions\", [...conditions, newRule]);\n          }}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema, pressures }", "type": "{ action: any; onChange: any; schema: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SelectionRuleEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../generators/applicability/AddRuleButton", "specifiers": ["AddRuleButton"], "category": "internal"}, {"source": "../../generators/applicability/ApplicabilityRuleCard", "specifiers": ["ApplicabilityRuleCard"], "category": "internal"}, {"source": "../../generators/applicability/createNewRule", "specifiers": ["createNewRule"], "category": "internal"}, {"source": "../../shared/SelectionRuleEditor", "specifiers": ["SelectionRuleEditor"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/index.js::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/index.js", "sourceCode": "export function OverviewTab({ action, onChange, onDelete }) {\n  const updateAction = (field, value) => {\n    onChange({ ...action, [field]: value });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(action.id, (value) =>\n    updateAction(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(action.name, (value) =>\n    updateAction(\"name\", value)\n  );\n\n  const isEnabled = action.enabled !== false;\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udccb Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"id\" className=\"label\">ID</label>\n            <input id=\"id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n              placeholder=\"unique_action_id\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"name\" className=\"label\">Name</label>\n            <input id=\"name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n              placeholder=\"Action Name\"\n            />\n          </div>\n          <div className=\"form-group form-group-wide\">\n            <label className=\"label\">Description\n            <LocalTextArea\n              value={action.description || \"\"}\n              onChange={(value) => updateAction(\"description\", value)}\n              placeholder=\"What does this action do?\"\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2699\ufe0f Status</div>\n        <label className=\"checkbox-label\">\n          <input\n            type=\"checkbox\"\n            checked={isEnabled}\n            onChange={(e) => updateAction(\"enabled\", e.target.checked)}\n            className=\"checkbox\"\n          />\n          Action Enabled\n        </label>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\uddd1\ufe0f Danger Zone</div>\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete Action\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, onDelete }", "type": "{ action: any; onChange: any; onDelete: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useLocalInputState", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/index.js::ActorTab", "name": "ActorTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/index.js", "sourceCode": "export function ActorTab({ action, onChange, schema, pressures }) {\n  const actor = action.actor || {};\n  const selection = actor.selection || { strategy: \"by_kind\" };\n  const conditions = actor.conditions || [];\n\n  const updateActor = (field, value) => {\n    onChange({\n      ...action,\n      actor: { ...actor, [field]: value },\n    });\n  };\n\n  const availableRefs = [\"$actor\"];\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Actor Configuration</div>\n        <div className=\"info-box-text\">\n          The actor is the primary entity that performs the action on the target. Optional\n          instigator rules can provide richer context.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83c\udfad Actor Selection</div>\n        <SelectionRuleEditor\n          value={selection}\n          onChange={(updated) => updateActor(\"selection\", updated)}\n          schema={schema}\n          availableRefs={availableRefs}\n          showPickStrategy={false}\n          showMaxResults={false}\n        />\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2705 Actor Conditions ({conditions.length})</div>\n        <div className=\"section-desc\">\n          Additional rules that must pass for the actor to perform this action.\n        </div>\n\n        {conditions.length === 0 ? (\n          <div className=\"empty-state-compact\">No conditions defined.</div>\n        ) : (\n          conditions.map((condition, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={condition}\n              onChange={(updated) => {\n                const next = [...conditions];\n                next[index] = updated;\n                updateActor(\"conditions\", next);\n              }}\n              onRemove={() =>\n                updateActor(\n                  \"conditions\",\n                  conditions.filter((_, i) => i !== index)\n                )\n              }\n              schema={schema}\n              pressures={pressures}\n            />\n          ))\n        )}\n\n        <AddRuleButton\n          onAdd={(type) => {\n            const newRule = createNewRule(type, pressures);\n            updateActor(\"conditions\", [...conditions, newRule]);\n          }}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema, pressures }", "type": "{ action: any; onChange: any; schema: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SelectionRuleEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/index.js::InstigatorTab", "name": "InstigatorTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/index.js", "sourceCode": "export function InstigatorTab({ action, onChange, schema }) {\n  const actor = action.actor || {};\n\n  const updateActor = (field, value) => {\n    onChange({\n      ...action,\n      actor: { ...actor, [field]: value },\n    });\n  };\n\n  const instigator = actor.instigator;\n  const hasInstigator = Boolean(instigator);\n\n  const addInstigator = () => {\n    updateActor(\"instigator\", { from: \"graph\", kind: \"\", pickStrategy: \"random\", required: false });\n  };\n\n  const updateInstigator = (updated) => {\n    updateActor(\"instigator\", updated);\n  };\n\n  const removeInstigator = () => {\n    updateActor(\"instigator\", undefined);\n  };\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Instigator</div>\n        <div className=\"info-box-text\">\n          Configure optional instigator selection for this action.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udc64 Instigator (Optional)</div>\n        <div className=\"section-desc\">\n          An instigator can trigger the action on behalf of the actor (e.g., NPC leader acts for\n          their faction).\n        </div>\n\n        {!hasInstigator ? (\n          <div>\n            <div className=\"text-muted text-small mb-md\">\n              No instigator configured. The actor performs the action directly.\n            </div>\n            <button className=\"btn btn-add\" onClick={addInstigator}>\n              + Add Instigator\n            </button>\n          </div>\n        ) : (\n          <div>\n            <label className=\"checkbox-label mb-lg\">\n              <input\n                type=\"checkbox\"\n                checked={instigator.required || false}\n                onChange={(e) =>\n                  updateInstigator({ ...instigator, required: e.target.checked || undefined })\n                }\n                className=\"checkbox\"\n              />\n              Instigator required\n            </label>\n            <VariableSelectionEditor\n              value={instigator}\n              onChange={(updated) =>\n                updateInstigator({ ...updated, required: instigator.required })\n              }\n              schema={schema}\n              availableRefs={[\"$actor\"]}\n            />\n            <button\n              className=\"btn btn-danger-outline mt-lg\"\n              onClick={removeInstigator}\n            >\n              Remove Instigator\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "VariableSelectionEditor", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/index.js::TargetingTab", "name": "TargetingTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/index.js", "sourceCode": "export function TargetingTab({ action, onChange, schema }) {\n  const targeting = action.targeting || { strategy: \"by_kind\" };\n\n  const updateTargeting = (updated) => {\n    onChange({\n      ...action,\n      targeting: updated,\n    });\n  };\n\n  // Available refs for selection filters (action context)\n  const availableRefs = [\"$actor\", \"$instigator\"];\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Target Selection</div>\n        <div className=\"info-box-text\">Define how valid targets are selected for this action.</div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83c\udfaf Target Selection</div>\n        <SelectionRuleEditor\n          value={targeting}\n          onChange={updateTargeting}\n          schema={schema}\n          availableRefs={availableRefs}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SelectionRuleEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/index.js::VariablesTab", "name": "VariablesTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/index.js", "sourceCode": "// ============================================================================\n// VariablesTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.action - The action being edited\n * @param {Function} props.onChange - Callback when action changes\n * @param {Object} props.schema - Domain schema\n */\nexport function VariablesTab({ action, onChange, schema }) {\n  const variables = action.variables || {};\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  // Build available refs for relationship queries (actor, instigator, target, target2 + other vars)\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$actor\", \"$instigator\", \"$target\", \"$target2\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    // Ensure the name starts with $\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    // Create with empty required fields - validation will flag them\n    onChange({\n      ...action,\n      variables: {\n        ...variables,\n        [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"\" } },\n      },\n    });\n    setNewVarName(\"\");\n    setShowAddForm(false);\n  };\n\n  const varEntries = Object.entries(variables);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Variables</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What are variables?</div>\n          <div className=\"info-box-text\">\n            Variables let you select additional entities from the graph to use in mutations. For\n            example, you might select a <code className=\"inline-code\">$victimFaction</code> to\n            create an enemy relationship with, or an <code className=\"inline-code\">$artifact</code>{\" \"}\n            to modify. Variables are resolved after <code className=\"inline-code\">$actor</code> and{\" \"}\n            <code className=\"inline-code\">$target</code> are chosen.\n          </div>\n        </div>\n\n        {varEntries.length === 0 && !showAddForm ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udce6</div>\n            <div className=\"empty-state-title\">No variables defined</div>\n            <div className=\"empty-state-desc\">\n              Add variables to select additional entities for use in mutations.\n            </div>\n          </div>\n        ) : (\n          varEntries.map(([name, config]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={config}\n              onChange={(updated) =>\n                onChange({ ...action, variables: { ...variables, [name]: updated } })\n              }\n              onRemove={() => {\n                const newVars = { ...variables };\n                delete newVars[name];\n                onChange({ ...action, variables: newVars });\n              }}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/index.js::OutcomeTab", "name": "OutcomeTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/index.js", "sourceCode": "export function OutcomeTab({ action, onChange, schema, pressures }) {\n  const outcome = action.outcome || {};\n  const mutations = outcome.mutations || [];\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const addButtonRef = useRef(null);\n\n  const updateOutcome = (field, value) => {\n    onChange({\n      ...action,\n      outcome: { ...outcome, [field]: value },\n    });\n  };\n\n  const createMutation = (type) => {\n    const defaultPressure = pressures?.[0]?.id || \"\";\n    const defaultEntity = \"$actor\";\n    const defaultTarget = \"$target\";\n    const defaultOther = \"$target2\";\n\n    switch (type) {\n      case \"modify_pressure\":\n        return { type: \"modify_pressure\", pressureId: defaultPressure, delta: 0 };\n      case \"set_tag\":\n        return { type: \"set_tag\", entity: defaultTarget, tag: \"\", value: true };\n      case \"remove_tag\":\n        return { type: \"remove_tag\", entity: defaultTarget, tag: \"\" };\n      case \"change_status\":\n        return { type: \"change_status\", entity: defaultTarget, newStatus: \"\" };\n      case \"adjust_prominence\":\n        return { type: \"adjust_prominence\", entity: defaultEntity, delta: 0.1 };\n      case \"archive_relationship\":\n        return {\n          type: \"archive_relationship\",\n          entity: defaultEntity,\n          relationshipKind: \"\",\n          with: defaultTarget,\n          direction: \"both\",\n        };\n      case \"archive_all_relationships\":\n        return {\n          type: \"archive_all_relationships\",\n          entity: defaultEntity,\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n      case \"adjust_relationship_strength\":\n        return {\n          type: \"adjust_relationship_strength\",\n          kind: \"\",\n          src: defaultEntity,\n          dst: defaultTarget,\n          delta: 0.1,\n        };\n      case \"update_rate_limit\":\n        return { type: \"update_rate_limit\" };\n      case \"create_relationship\":\n      default:\n        return {\n          type: \"create_relationship\",\n          kind: \"\",\n          src: defaultEntity,\n          dst: defaultTarget || defaultOther,\n          strength: 0.5,\n        };\n    }\n  };\n\n  const addMutation = (type) => {\n    updateOutcome(\"mutations\", [...mutations, createMutation(type)]);\n  };\n\n  const updateMutation = (index, mutation) => {\n    const next = [...mutations];\n    next[index] = mutation;\n    updateOutcome(\"mutations\", next);\n  };\n\n  const removeMutation = (index) => {\n    updateOutcome(\n      \"mutations\",\n      mutations.filter((_, i) => i !== index)\n    );\n  };\n\n  useLayoutEffect(() => {\n    if (showTypeMenu && addButtonRef.current) {\n      const rect = addButtonRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (event) => {\n      if (addButtonRef.current && !addButtonRef.current.contains(event.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Action Outcome</div>\n        <div className=\"info-box-text\">\n          Define what happens when this action succeeds. Create relationships, change statuses,\n          modify pressures, or strengthen existing connections.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2699\ufe0f Mutations ({mutations.length})</div>\n        <div className=\"section-desc\">\n          Apply mutations when the action succeeds. Each mutation uses the unified rules library.\n        </div>\n\n        {mutations.map((mutation, index) => (\n          <MutationCard\n            key={index}\n            mutation={mutation}\n            onChange={(updated) => updateMutation(index, updated)}\n            onRemove={() => removeMutation(index)}\n            schema={schema}\n            pressures={pressures}\n            entityOptions={RELATIONSHIP_REFS}\n            typeOptions={ACTION_MUTATION_TYPES}\n            createMutation={createMutation}\n          />\n        ))}\n\n        <div ref={addButtonRef} className=\"ot-add-btn-wrap mt-lg\">\n          <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n            + Add Mutation\n          </button>\n\n          {showTypeMenu && (\n            {/* eslint-disable-next-line local/no-inline-styles -- dynamic position from JS measurement */}\n            <div\n              className=\"dropdown-menu ot-dropdown-fixed\"\n              style={{\n                '--ot-dd-top': `${dropdownPos.top}px`,\n                '--ot-dd-left': `${dropdownPos.left}px`,\n                '--ot-dd-width': `${dropdownPos.width}px`,\n                top: 'var(--ot-dd-top)',\n                left: 'var(--ot-dd-left)',\n                width: 'var(--ot-dd-width)',\n              }}\n            >\n              {MUTATION_TYPE_OPTIONS.map((opt) => (\n                <div\n                  key={opt.value}\n                  onClick={() => {\n                    addMutation(opt.value);\n                    setShowTypeMenu(false);\n                  }}\n                  className=\"dropdown-menu-item\"\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color */}\n                  <span\n                    className=\"dropdown-menu-icon\"\n                    style={{ '--ot-menu-icon-bg': `${opt.color}20`, backgroundColor: 'var(--ot-menu-icon-bg)' }}\n                  >\n                    {opt.icon}\n                  </span>\n                  <span className=\"dropdown-menu-label\">{opt.label}</span>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2b50 Prominence Changes</div>\n        <div className=\"section-desc\">\n          Apply prominence changes to actor or target on action success/failure. Values are numeric\n          deltas (e.g., 0.1 or -0.05).\n        </div>\n\n        <div className=\"mb-xl\">\n          <div className=\"label mb-md\">\n            Actor Prominence Delta\n          </div>\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Success\n              <NumberInput\n                value={outcome.actorProminenceDelta?.onSuccess}\n                onChange={(v) => {\n                  const current = outcome.actorProminenceDelta || {};\n                  const updated = { ...current, onSuccess: v };\n                  if (updated.onSuccess === undefined) delete updated.onSuccess;\n                  updateOutcome(\n                    \"actorProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., 0.1\"\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Failure\n              <NumberInput\n                value={outcome.actorProminenceDelta?.onFailure}\n                onChange={(v) => {\n                  const current = outcome.actorProminenceDelta || {};\n                  const updated = { ...current, onFailure: v };\n                  if (updated.onFailure === undefined) delete updated.onFailure;\n                  updateOutcome(\n                    \"actorProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., -0.05\"\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        </div>\n\n        <div>\n          <div className=\"label mb-md\">\n            Target Prominence Delta\n          </div>\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Success\n              <NumberInput\n                value={outcome.targetProminenceDelta?.onSuccess}\n                onChange={(v) => {\n                  const current = outcome.targetProminenceDelta || {};\n                  const updated = { ...current, onSuccess: v };\n                  if (updated.onSuccess === undefined) delete updated.onSuccess;\n                  updateOutcome(\n                    \"targetProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., 0.1\"\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Failure\n              <NumberInput\n                value={outcome.targetProminenceDelta?.onFailure}\n                onChange={(v) => {\n                  const current = outcome.targetProminenceDelta || {};\n                  const updated = { ...current, onFailure: v };\n                  if (updated.onFailure === undefined) delete updated.onFailure;\n                  updateOutcome(\n                    \"targetProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., -0.05\"\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udcdd Description Template</div>\n        <div className=\"section-desc\">\n          Template for generating occurrence descriptions. Use {\"{actor.name}\"},{\" \"}\n          {\"{instigator.name}\"}, {\"{target.name}\"}, etc.\n        </div>\n        <LocalTextArea\n          value={outcome.descriptionTemplate || \"\"}\n          onChange={(value) => updateOutcome(\"descriptionTemplate\", value || undefined)}\n          placeholder=\"e.g., declared war on {target.name}\"\n        />\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udcd6 Narration Template</div>\n        <div className=\"section-desc\">\n          Domain-controlled narrative text. Syntax: {\"{entity.field}\"}, {\"{$var.field}\"},{\" \"}\n          {\"{field|fallback}\"}, {\"{list:entities}\"}.\n        </div>\n        <LocalTextArea\n          value={outcome.narrationTemplate || \"\"}\n          onChange={(value) => updateOutcome(\"narrationTemplate\", value || undefined)}\n// ... (truncated)", "parameters": [{"name": "{ action, onChange, schema, pressures }", "type": "{ action: any; onChange: any; schema: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": null, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/index.js::ProbabilityTab", "name": "ProbabilityTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/index.js", "sourceCode": "export function ProbabilityTab({ action, onChange, pressures }) {\n  const probability = action.probability || {};\n\n  const updateProbability = (field, value) => {\n    onChange({\n      ...action,\n      probability: { ...probability, [field]: value },\n    });\n  };\n\n  const pressureModifiers = probability.pressureModifiers || [];\n  const baseSuccessChance = probability.baseSuccessChance ?? 0.5;\n  const baseWeight = probability.baseWeight ?? 1.0;\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Probability Configuration</div>\n        <div className=\"info-box-text\">\n          Control how likely this action is to be selected and succeed. Pressure modifiers\n          dynamically adjust weight based on world state.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83c\udfaf Base Success Chance</div>\n        <div className=\"section-desc\">Probability that this action succeeds when attempted.</div>\n        <div className=\"slider-row\">\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.05\"\n            value={baseSuccessChance}\n            onChange={(e) => updateProbability(\"baseSuccessChance\", parseFloat(e.target.value))}\n            className=\"slider\"\n          />\n          <span className=\"slider-value\">{(baseSuccessChance * 100).toFixed(0)}%</span>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2696\ufe0f Base Weight</div>\n        <div className=\"section-desc\">\n          Relative weight for action selection. Higher weight means more likely to be chosen.\n        </div>\n        <div className=\"form-group\">\n          <NumberInput\n            value={baseWeight}\n            onChange={(v) => updateProbability(\"baseWeight\", v ?? 1.0)}\n            min={0}\n          />\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udcca Pressure Modifiers ({pressureModifiers.length})</div>\n        <div className=\"section-desc\">\n          Pressures that affect the weight of this action. Formula: weight = baseWeight \u00d7 (1 +\n          \u03a3(pressure/100 \u00d7 multiplier))\n        </div>\n        <PressureModifiersEditor\n          value={pressureModifiers}\n          onChange={(v) => updateProbability(\"pressureModifiers\", v.length > 0 ? v : undefined)}\n          pressures={pressures}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, pressures }", "type": "{ action: any; onChange: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "PressureModifiersEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/InstigatorTab.jsx::InstigatorTab", "name": "InstigatorTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/InstigatorTab.jsx", "sourceCode": "export function InstigatorTab({ action, onChange, schema }) {\n  const actor = action.actor || {};\n\n  const updateActor = (field, value) => {\n    onChange({\n      ...action,\n      actor: { ...actor, [field]: value },\n    });\n  };\n\n  const instigator = actor.instigator;\n  const hasInstigator = Boolean(instigator);\n\n  const addInstigator = () => {\n    updateActor(\"instigator\", { from: \"graph\", kind: \"\", pickStrategy: \"random\", required: false });\n  };\n\n  const updateInstigator = (updated) => {\n    updateActor(\"instigator\", updated);\n  };\n\n  const removeInstigator = () => {\n    updateActor(\"instigator\", undefined);\n  };\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Instigator</div>\n        <div className=\"info-box-text\">\n          Configure optional instigator selection for this action.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udc64 Instigator (Optional)</div>\n        <div className=\"section-desc\">\n          An instigator can trigger the action on behalf of the actor (e.g., NPC leader acts for\n          their faction).\n        </div>\n\n        {!hasInstigator ? (\n          <div>\n            <div className=\"text-muted text-small mb-md\">\n              No instigator configured. The actor performs the action directly.\n            </div>\n            <button className=\"btn btn-add\" onClick={addInstigator}>\n              + Add Instigator\n            </button>\n          </div>\n        ) : (\n          <div>\n            <label className=\"checkbox-label mb-lg\">\n              <input\n                type=\"checkbox\"\n                checked={instigator.required || false}\n                onChange={(e) =>\n                  updateInstigator({ ...instigator, required: e.target.checked || undefined })\n                }\n                className=\"checkbox\"\n              />\n              Instigator required\n            </label>\n            <VariableSelectionEditor\n              value={instigator}\n              onChange={(updated) =>\n                updateInstigator({ ...updated, required: instigator.required })\n              }\n              schema={schema}\n              availableRefs={[\"$actor\"]}\n            />\n            <button\n              className=\"btn btn-danger-outline mt-lg\"\n              onClick={removeInstigator}\n            >\n              Remove Instigator\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "VariableSelectionEditor", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared/VariableSelectionEditor", "specifiers": ["VariableSelectionEditor"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/OutcomeTab.jsx::OutcomeTab", "name": "OutcomeTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/OutcomeTab.jsx", "sourceCode": "export function OutcomeTab({ action, onChange, schema, pressures }) {\n  const outcome = action.outcome || {};\n  const mutations = outcome.mutations || [];\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const addButtonRef = useRef(null);\n\n  const updateOutcome = (field, value) => {\n    onChange({\n      ...action,\n      outcome: { ...outcome, [field]: value },\n    });\n  };\n\n  const createMutation = (type) => {\n    const defaultPressure = pressures?.[0]?.id || \"\";\n    const defaultEntity = \"$actor\";\n    const defaultTarget = \"$target\";\n    const defaultOther = \"$target2\";\n\n    switch (type) {\n      case \"modify_pressure\":\n        return { type: \"modify_pressure\", pressureId: defaultPressure, delta: 0 };\n      case \"set_tag\":\n        return { type: \"set_tag\", entity: defaultTarget, tag: \"\", value: true };\n      case \"remove_tag\":\n        return { type: \"remove_tag\", entity: defaultTarget, tag: \"\" };\n      case \"change_status\":\n        return { type: \"change_status\", entity: defaultTarget, newStatus: \"\" };\n      case \"adjust_prominence\":\n        return { type: \"adjust_prominence\", entity: defaultEntity, delta: 0.1 };\n      case \"archive_relationship\":\n        return {\n          type: \"archive_relationship\",\n          entity: defaultEntity,\n          relationshipKind: \"\",\n          with: defaultTarget,\n          direction: \"both\",\n        };\n      case \"archive_all_relationships\":\n        return {\n          type: \"archive_all_relationships\",\n          entity: defaultEntity,\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n      case \"adjust_relationship_strength\":\n        return {\n          type: \"adjust_relationship_strength\",\n          kind: \"\",\n          src: defaultEntity,\n          dst: defaultTarget,\n          delta: 0.1,\n        };\n      case \"update_rate_limit\":\n        return { type: \"update_rate_limit\" };\n      case \"create_relationship\":\n      default:\n        return {\n          type: \"create_relationship\",\n          kind: \"\",\n          src: defaultEntity,\n          dst: defaultTarget || defaultOther,\n          strength: 0.5,\n        };\n    }\n  };\n\n  const addMutation = (type) => {\n    updateOutcome(\"mutations\", [...mutations, createMutation(type)]);\n  };\n\n  const updateMutation = (index, mutation) => {\n    const next = [...mutations];\n    next[index] = mutation;\n    updateOutcome(\"mutations\", next);\n  };\n\n  const removeMutation = (index) => {\n    updateOutcome(\n      \"mutations\",\n      mutations.filter((_, i) => i !== index)\n    );\n  };\n\n  useLayoutEffect(() => {\n    if (showTypeMenu && addButtonRef.current) {\n      const rect = addButtonRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (event) => {\n      if (addButtonRef.current && !addButtonRef.current.contains(event.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Action Outcome</div>\n        <div className=\"info-box-text\">\n          Define what happens when this action succeeds. Create relationships, change statuses,\n          modify pressures, or strengthen existing connections.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2699\ufe0f Mutations ({mutations.length})</div>\n        <div className=\"section-desc\">\n          Apply mutations when the action succeeds. Each mutation uses the unified rules library.\n        </div>\n\n        {mutations.map((mutation, index) => (\n          <MutationCard\n            key={index}\n            mutation={mutation}\n            onChange={(updated) => updateMutation(index, updated)}\n            onRemove={() => removeMutation(index)}\n            schema={schema}\n            pressures={pressures}\n            entityOptions={RELATIONSHIP_REFS}\n            typeOptions={ACTION_MUTATION_TYPES}\n            createMutation={createMutation}\n          />\n        ))}\n\n        <div ref={addButtonRef} className=\"ot-add-btn-wrap mt-lg\">\n          <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n            + Add Mutation\n          </button>\n\n          {showTypeMenu && (\n            {/* eslint-disable-next-line local/no-inline-styles -- dynamic position from JS measurement */}\n            <div\n              className=\"dropdown-menu ot-dropdown-fixed\"\n              style={{\n                '--ot-dd-top': `${dropdownPos.top}px`,\n                '--ot-dd-left': `${dropdownPos.left}px`,\n                '--ot-dd-width': `${dropdownPos.width}px`,\n                top: 'var(--ot-dd-top)',\n                left: 'var(--ot-dd-left)',\n                width: 'var(--ot-dd-width)',\n              }}\n            >\n              {MUTATION_TYPE_OPTIONS.map((opt) => (\n                <div\n                  key={opt.value}\n                  onClick={() => {\n                    addMutation(opt.value);\n                    setShowTypeMenu(false);\n                  }}\n                  className=\"dropdown-menu-item\"\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color */}\n                  <span\n                    className=\"dropdown-menu-icon\"\n                    style={{ '--ot-menu-icon-bg': `${opt.color}20`, backgroundColor: 'var(--ot-menu-icon-bg)' }}\n                  >\n                    {opt.icon}\n                  </span>\n                  <span className=\"dropdown-menu-label\">{opt.label}</span>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2b50 Prominence Changes</div>\n        <div className=\"section-desc\">\n          Apply prominence changes to actor or target on action success/failure. Values are numeric\n          deltas (e.g., 0.1 or -0.05).\n        </div>\n\n        <div className=\"mb-xl\">\n          <div className=\"label mb-md\">\n            Actor Prominence Delta\n          </div>\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Success\n              <NumberInput\n                value={outcome.actorProminenceDelta?.onSuccess}\n                onChange={(v) => {\n                  const current = outcome.actorProminenceDelta || {};\n                  const updated = { ...current, onSuccess: v };\n                  if (updated.onSuccess === undefined) delete updated.onSuccess;\n                  updateOutcome(\n                    \"actorProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., 0.1\"\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Failure\n              <NumberInput\n                value={outcome.actorProminenceDelta?.onFailure}\n                onChange={(v) => {\n                  const current = outcome.actorProminenceDelta || {};\n                  const updated = { ...current, onFailure: v };\n                  if (updated.onFailure === undefined) delete updated.onFailure;\n                  updateOutcome(\n                    \"actorProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., -0.05\"\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        </div>\n\n        <div>\n          <div className=\"label mb-md\">\n            Target Prominence Delta\n          </div>\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Success\n              <NumberInput\n                value={outcome.targetProminenceDelta?.onSuccess}\n                onChange={(v) => {\n                  const current = outcome.targetProminenceDelta || {};\n                  const updated = { ...current, onSuccess: v };\n                  if (updated.onSuccess === undefined) delete updated.onSuccess;\n                  updateOutcome(\n                    \"targetProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., 0.1\"\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label-micro\">On Failure\n              <NumberInput\n                value={outcome.targetProminenceDelta?.onFailure}\n                onChange={(v) => {\n                  const current = outcome.targetProminenceDelta || {};\n                  const updated = { ...current, onFailure: v };\n                  if (updated.onFailure === undefined) delete updated.onFailure;\n                  updateOutcome(\n                    \"targetProminenceDelta\",\n                    Object.keys(updated).length > 0 ? updated : undefined\n                  );\n                }}\n                placeholder=\"e.g., -0.05\"\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udcdd Description Template</div>\n        <div className=\"section-desc\">\n          Template for generating occurrence descriptions. Use {\"{actor.name}\"},{\" \"}\n          {\"{instigator.name}\"}, {\"{target.name}\"}, etc.\n        </div>\n        <LocalTextArea\n          value={outcome.descriptionTemplate || \"\"}\n          onChange={(value) => updateOutcome(\"descriptionTemplate\", value || undefined)}\n          placeholder=\"e.g., declared war on {target.name}\"\n        />\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udcd6 Narration Template</div>\n        <div className=\"section-desc\">\n          Domain-controlled narrative text. Syntax: {\"{entity.field}\"}, {\"{$var.field}\"},{\" \"}\n          {\"{field|fallback}\"}, {\"{list:entities}\"}.\n        </div>\n        <LocalTextArea\n          value={outcome.narrationTemplate || \"\"}\n          onChange={(value) => updateOutcome(\"narrationTemplate\", value || undefined)}\n// ... (truncated)", "parameters": [{"name": "{ action, onChange, schema, pressures }", "type": "{ action: any; onChange: any; schema: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": null, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useEffect", "useLayoutEffect", "useRef", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["RELATIONSHIP_REFS", "MUTATION_TYPE_OPTIONS"], "category": "internal"}, {"source": "../../shared/MutationCard", "specifiers": ["MutationCard", "DEFAULT_MUTATION_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["NumberInput", "LocalTextArea"], "category": "internal"}, {"source": "./OutcomeTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/OverviewTab.jsx::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/OverviewTab.jsx", "sourceCode": "export function OverviewTab({ action, onChange, onDelete }) {\n  const updateAction = (field, value) => {\n    onChange({ ...action, [field]: value });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(action.id, (value) =>\n    updateAction(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(action.name, (value) =>\n    updateAction(\"name\", value)\n  );\n\n  const isEnabled = action.enabled !== false;\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udccb Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"id\" className=\"label\">ID</label>\n            <input id=\"id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n              placeholder=\"unique_action_id\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"name\" className=\"label\">Name</label>\n            <input id=\"name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n              placeholder=\"Action Name\"\n            />\n          </div>\n          <div className=\"form-group form-group-wide\">\n            <label className=\"label\">Description\n            <LocalTextArea\n              value={action.description || \"\"}\n              onChange={(value) => updateAction(\"description\", value)}\n              placeholder=\"What does this action do?\"\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2699\ufe0f Status</div>\n        <label className=\"checkbox-label\">\n          <input\n            type=\"checkbox\"\n            checked={isEnabled}\n            onChange={(e) => updateAction(\"enabled\", e.target.checked)}\n            className=\"checkbox\"\n          />\n          Action Enabled\n        </label>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\uddd1\ufe0f Danger Zone</div>\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete Action\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, onDelete }", "type": "{ action: any; onChange: any; onDelete: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useLocalInputState", "count": 2}], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["useLocalInputState", "LocalTextArea"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/ProbabilityTab.jsx::ProbabilityTab", "name": "ProbabilityTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/ProbabilityTab.jsx", "sourceCode": "export function ProbabilityTab({ action, onChange, pressures }) {\n  const probability = action.probability || {};\n\n  const updateProbability = (field, value) => {\n    onChange({\n      ...action,\n      probability: { ...probability, [field]: value },\n    });\n  };\n\n  const pressureModifiers = probability.pressureModifiers || [];\n  const baseSuccessChance = probability.baseSuccessChance ?? 0.5;\n  const baseWeight = probability.baseWeight ?? 1.0;\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Probability Configuration</div>\n        <div className=\"info-box-text\">\n          Control how likely this action is to be selected and succeed. Pressure modifiers\n          dynamically adjust weight based on world state.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83c\udfaf Base Success Chance</div>\n        <div className=\"section-desc\">Probability that this action succeeds when attempted.</div>\n        <div className=\"slider-row\">\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.05\"\n            value={baseSuccessChance}\n            onChange={(e) => updateProbability(\"baseSuccessChance\", parseFloat(e.target.value))}\n            className=\"slider\"\n          />\n          <span className=\"slider-value\">{(baseSuccessChance * 100).toFixed(0)}%</span>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u2696\ufe0f Base Weight</div>\n        <div className=\"section-desc\">\n          Relative weight for action selection. Higher weight means more likely to be chosen.\n        </div>\n        <div className=\"form-group\">\n          <NumberInput\n            value={baseWeight}\n            onChange={(v) => updateProbability(\"baseWeight\", v ?? 1.0)}\n            min={0}\n          />\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83d\udcca Pressure Modifiers ({pressureModifiers.length})</div>\n        <div className=\"section-desc\">\n          Pressures that affect the weight of this action. Formula: weight = baseWeight \u00d7 (1 +\n          \u03a3(pressure/100 \u00d7 multiplier))\n        </div>\n        <PressureModifiersEditor\n          value={pressureModifiers}\n          onChange={(v) => updateProbability(\"pressureModifiers\", v.length > 0 ? v : undefined)}\n          pressures={pressures}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, pressures }", "type": "{ action: any; onChange: any; pressures: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "PressureModifiersEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["NumberInput"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/TargetingTab.jsx::TargetingTab", "name": "TargetingTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/TargetingTab.jsx", "sourceCode": "export function TargetingTab({ action, onChange, schema }) {\n  const targeting = action.targeting || { strategy: \"by_kind\" };\n\n  const updateTargeting = (updated) => {\n    onChange({\n      ...action,\n      targeting: updated,\n    });\n  };\n\n  // Available refs for selection filters (action context)\n  const availableRefs = [\"$actor\", \"$instigator\"];\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Target Selection</div>\n        <div className=\"info-box-text\">Define how valid targets are selected for this action.</div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">\ud83c\udfaf Target Selection</div>\n        <SelectionRuleEditor\n          value={targeting}\n          onChange={updateTargeting}\n          schema={schema}\n          availableRefs={availableRefs}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SelectionRuleEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared/SelectionRuleEditor", "specifiers": ["SelectionRuleEditor"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/actions/tabs/VariablesTab.jsx::VariablesTab", "name": "VariablesTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/tabs/VariablesTab.jsx", "sourceCode": "// ============================================================================\n// VariablesTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.action - The action being edited\n * @param {Function} props.onChange - Callback when action changes\n * @param {Object} props.schema - Domain schema\n */\nexport function VariablesTab({ action, onChange, schema }) {\n  const variables = action.variables || {};\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  // Build available refs for relationship queries (actor, instigator, target, target2 + other vars)\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$actor\", \"$instigator\", \"$target\", \"$target2\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    // Ensure the name starts with $\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    // Create with empty required fields - validation will flag them\n    onChange({\n      ...action,\n      variables: {\n        ...variables,\n        [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"\" } },\n      },\n    });\n    setNewVarName(\"\");\n    setShowAddForm(false);\n  };\n\n  const varEntries = Object.entries(variables);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Variables</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What are variables?</div>\n          <div className=\"info-box-text\">\n            Variables let you select additional entities from the graph to use in mutations. For\n            example, you might select a <code className=\"inline-code\">$victimFaction</code> to\n            create an enemy relationship with, or an <code className=\"inline-code\">$artifact</code>{\" \"}\n            to modify. Variables are resolved after <code className=\"inline-code\">$actor</code> and{\" \"}\n            <code className=\"inline-code\">$target</code> are chosen.\n          </div>\n        </div>\n\n        {varEntries.length === 0 && !showAddForm ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udce6</div>\n            <div className=\"empty-state-title\">No variables defined</div>\n            <div className=\"empty-state-desc\">\n              Add variables to select additional entities for use in mutations.\n            </div>\n          </div>\n        ) : (\n          varEntries.map(([name, config]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={config}\n              onChange={(updated) =>\n                onChange({ ...action, variables: { ...variables, [name]: updated } })\n              }\n              onRemove={() => {\n                const newVars = { ...variables };\n                delete newVars[name];\n                onChange({ ...action, variables: newVars });\n              }}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ action, onChange, schema }", "type": "{ action: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared/VariableSelectionEditor", "specifiers": ["VariableSelectionEditor"], "category": "internal"}, {"source": "./VariablesTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/components/DependencySection.jsx::DependencySection", "name": "DependencySection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/components/DependencySection.jsx", "sourceCode": "export function DependencySection({ title, icon, items, renderItem, defaultExpanded = false }) {\n  const [expanded, setExpanded] = useState(defaultExpanded);\n  const [, setHovering] = useState(false);\n\n  if (items.length === 0) return null;\n\n  return (\n    <div className=\"dependency-viewer-section\">\n      <div\n        className=\"dependency-section-header\"\n        onClick={() => setExpanded(!expanded)}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n      >\n        <div className=\"dependency-section-title\">\n          <span>{icon}</span>\n          <span>{title}</span>\n          <span className=\"dependency-section-count\">{items.length}</span>\n        </div>\n        <span className={`dependency-expand-icon ${expanded ? \"dependency-expand-icon-open\" : \"\"}`}>\n          \u25bc\n        </span>\n      </div>\n      {expanded && (\n        <div className=\"dependency-section-content\">\n          {items.map((item, index) => renderItem(item, index))}\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ title, icon, items, renderItem, defaultExpanded = false }", "type": "{ title: any; icon: any; items: any; renderItem: any; defaultExpanded?: boolean; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../dependency-viewer.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/components/index.js::DependencySection", "name": "DependencySection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/components/index.js", "sourceCode": "export function DependencySection({ title, icon, items, renderItem, defaultExpanded = false }) {\n  const [expanded, setExpanded] = useState(defaultExpanded);\n  const [, setHovering] = useState(false);\n\n  if (items.length === 0) return null;\n\n  return (\n    <div className=\"dependency-viewer-section\">\n      <div\n        className=\"dependency-section-header\"\n        onClick={() => setExpanded(!expanded)}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n      >\n        <div className=\"dependency-section-title\">\n          <span>{icon}</span>\n          <span>{title}</span>\n          <span className=\"dependency-section-count\">{items.length}</span>\n        </div>\n        <span className={`dependency-expand-icon ${expanded ? \"dependency-expand-icon-open\" : \"\"}`}>\n          \u25bc\n        </span>\n      </div>\n      {expanded && (\n        <div className=\"dependency-section-content\">\n          {items.map((item, index) => renderItem(item, index))}\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ title, icon, items, renderItem, defaultExpanded = false }", "type": "{ title: any; icon: any; items: any; renderItem: any; defaultExpanded?: boolean; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/components/index.js::UsageBadges", "name": "UsageBadges", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/components/index.js", "sourceCode": "/**\n * DetailUsageBadges component\n *\n * @param {Object} props\n * @param {Object} props.usage - Object with arrays of referencing items\n *   e.g., { generators: ['gen1', 'gen2'], systems: ['sys1'] }\n * @param {boolean} props.showOrphan - If true, show \"Not used\" when no usage (default: true)\n */\nexport function DetailUsageBadges({ usage = {}, showOrphan = true }) {\n  const badges = [];\n\n  for (const [type, config] of Object.entries(BADGE_CONFIG)) {\n    const items = usage[type];\n    if (items?.length > 0) {\n      const count = items.length;\n      const label = type === 'eras' && count !== 1 ? config.labelPlural : config.label;\n      badges.push(\n        <span\n          key={type}\n          className={`detail-badge ${config.className}`}\n          title={`${config.tooltip}: ${items.join(', ')}`}\n        >\n          {count} {label}\n        </span>\n      );\n    }\n  }\n\n  if (badges.length === 0) {\n    if (showOrphan) {\n      return <span className=\"detail-badge detail-badge-orphan\">Not used</span>;\n    }\n    return null;\n  }\n\n  return <div className=\"detail-badge-container\">{badges}</div>;\n}", "parameters": [{"name": "{ usage = {}, showOrphan = true }", "type": "{ usage: any; showOrphan: boolean; }", "optional": false}], "returnType": "any", "jsxTree": {"tag": "span", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/BasicInfoSection.jsx::BasicInfoSection", "name": "BasicInfoSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/BasicInfoSection.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.era - The era object\n * @param {Function} props.onFieldChange - Called when a field changes\n */\nexport function BasicInfoSection({ era, onFieldChange }) {\n  return (\n    <div className=\"section\">\n      <SectionHeader icon=\"\ud83d\udcdd\" title=\"Basic Information\" />\n      <div className=\"input-grid\">\n        <div className=\"form-group\">\n          <label htmlFor=\"id\" className=\"label\">ID</label>\n          <input id=\"id\"\n            type=\"text\"\n            value={era.id}\n            onChange={(e) => onFieldChange(\"id\", e.target.value)}\n            className=\"input\"\n          />\n        </div>\n        <div className=\"form-group\">\n          <label htmlFor=\"name\" className=\"label\">Name</label>\n          <input id=\"name\"\n            type=\"text\"\n            value={era.name}\n            onChange={(e) => onFieldChange(\"name\", e.target.value)}\n            className=\"input\"\n          />\n        </div>\n      </div>\n      <div className=\"form-group mt-xl\">\n        <label className=\"label\">Summary\n        <LocalTextArea value={era.summary} onChange={(value) => onFieldChange(\"summary\", value)} />\n        </label>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ era, onFieldChange }", "type": "{ era: any; onFieldChange: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "SectionHeader", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["SectionHeader", "LocalTextArea"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/ConditionsSection.jsx::ConditionsSection", "name": "ConditionsSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/ConditionsSection.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.title - Section title\n * @param {string} props.icon - Section icon\n * @param {string} props.description - Section description\n * @param {string} props.emptyMessage - Message when no conditions\n * @param {Array} props.conditions - Array of condition objects\n * @param {Function} props.onUpdate - Called when a condition is updated\n * @param {Function} props.onRemove - Called to remove a condition\n * @param {Function} props.onAdd - Called to add a new condition\n * @param {string} props.addLabel - Label for add button\n * @param {Array} props.pressures - Available pressures\n * @param {Object} props.schema - Domain schema\n */\nexport function ConditionsSection({\n  title,\n  icon,\n  description,\n  emptyMessage,\n  conditions,\n  onUpdate,\n  onRemove,\n  onAdd,\n  addLabel,\n  pressures,\n  schema,\n}) {\n  return (\n    <div className=\"section\">\n      <SectionHeader\n        icon={icon}\n        title={title}\n        count={`${conditions.length} condition${conditions.length !== 1 ? \"s\" : \"\"}`}\n        description={description}\n      />\n      <div className=\"items-grid\">\n        {conditions.length === 0 ? (\n          <EmptyState title={emptyMessage} styles={EMPTY_STATE_STYLES} />\n        ) : (\n          conditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdate(index, updated)}\n              onRemove={() => onRemove(index)}\n              pressures={pressures || []}\n              schema={schema}\n            />\n          ))\n        )}\n      </div>\n      <AddItemButton onClick={onAdd} label={addLabel} styles={ADD_ITEM_STYLES} />\n    </div>\n  );\n}", "parameters": [{"name": "{\n  title,\n  icon,\n  description,\n  emptyMessage,\n  conditions,\n  onUpdate,\n  onRemove,\n  onAdd,\n  addLabel,\n  pressures,\n  schema,\n}", "type": "{ title: string; icon: string; description: string; emptyMessage: string; conditions: any[]; onUpdate: Function; onRemove: Function; onAdd: Function; addLabel: string; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "SectionHeader", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "EmptyState", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "AddItemButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["SectionHeader", "EmptyState", "AddItemButton"], "category": "internal"}, {"source": "../shared", "specifiers": ["TransitionConditionEditor"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/EffectsSection.jsx::EffectsSection", "name": "EffectsSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/EffectsSection.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.title - Section title\n * @param {string} props.icon - Section icon\n * @param {string} props.description - Section description\n * @param {string} props.emptyMessage - Message when no effects\n * @param {Array} props.pressureChanges - Array of [pressureId, value] tuples\n * @param {Function} props.onUpdate - Called when an effect value changes\n * @param {Function} props.onRemove - Called to remove an effect\n * @param {Array} props.availablePressures - Pressures that can be added\n * @param {Function} props.onAdd - Called to add an effect\n * @param {string} props.addPlaceholder - Placeholder for add dropdown\n * @param {Array} props.pressures - All pressure definitions for display\n */\nexport function EffectsSection({\n  title,\n  icon,\n  description,\n  emptyMessage,\n  pressureChanges,\n  onUpdate,\n  onRemove,\n  availablePressures,\n  onAdd,\n  addPlaceholder,\n  pressures,\n}) {\n  return (\n    <div className=\"section\">\n      <SectionHeader\n        icon={icon}\n        title={title}\n        count={`${pressureChanges.length} effect${pressureChanges.length !== 1 ? \"s\" : \"\"}`}\n        description={description}\n      />\n      <div className=\"items-grid\">\n        {pressureChanges.length === 0 ? (\n          <EmptyState title={emptyMessage} styles={EMPTY_STATE_STYLES} />\n        ) : (\n          pressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdate(pressureId, newValue)}\n              onRemove={() => onRemove(pressureId)}\n              pressures={pressures || []}\n            />\n          ))\n        )}\n      </div>\n      <div className=\"add-container\">\n        <SearchableDropdown\n          items={availablePressures}\n          onSelect={onAdd}\n          placeholder={addPlaceholder}\n          emptyMessage=\"All pressures added\"\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  title,\n  icon,\n  description,\n  emptyMessage,\n  pressureChanges,\n  onUpdate,\n  onRemove,\n  availablePressures,\n  onAdd,\n  addPlaceholder,\n  pressures,\n}", "type": "{ title: string; icon: string; description: string; emptyMessage: string; pressureChanges: any[]; onUpdate: Function; onRemove: Function; availablePressures: any[]; onAdd: Function; addPlaceholder: string; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "SectionHeader", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "EmptyState", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "SearchableDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["SectionHeader", "EmptyState", "SearchableDropdown"], "category": "internal"}, {"source": "../shared", "specifiers": ["TransitionEffectItem"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/index.js::BasicInfoSection", "name": "BasicInfoSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.era - The era object\n * @param {Function} props.onFieldChange - Called when a field changes\n */\nexport function BasicInfoSection({ era, onFieldChange }) {\n  return (\n    <div className=\"section\">\n      <SectionHeader icon=\"\ud83d\udcdd\" title=\"Basic Information\" />\n      <div className=\"input-grid\">\n        <div className=\"form-group\">\n          <label htmlFor=\"id\" className=\"label\">ID</label>\n          <input id=\"id\"\n            type=\"text\"\n            value={era.id}\n            onChange={(e) => onFieldChange(\"id\", e.target.value)}\n            className=\"input\"\n          />\n        </div>\n        <div className=\"form-group\">\n          <label htmlFor=\"name\" className=\"label\">Name</label>\n          <input id=\"name\"\n            type=\"text\"\n            value={era.name}\n            onChange={(e) => onFieldChange(\"name\", e.target.value)}\n            className=\"input\"\n          />\n        </div>\n      </div>\n      <div className=\"form-group mt-xl\">\n        <label className=\"label\">Summary\n        <LocalTextArea value={era.summary} onChange={(value) => onFieldChange(\"summary\", value)} />\n        </label>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ era, onFieldChange }", "type": "{ era: any; onFieldChange: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "SectionHeader", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/index.js::ConditionsSection", "name": "ConditionsSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.title - Section title\n * @param {string} props.icon - Section icon\n * @param {string} props.description - Section description\n * @param {string} props.emptyMessage - Message when no conditions\n * @param {Array} props.conditions - Array of condition objects\n * @param {Function} props.onUpdate - Called when a condition is updated\n * @param {Function} props.onRemove - Called to remove a condition\n * @param {Function} props.onAdd - Called to add a new condition\n * @param {string} props.addLabel - Label for add button\n * @param {Array} props.pressures - Available pressures\n * @param {Object} props.schema - Domain schema\n */\nexport function ConditionsSection({\n  title,\n  icon,\n  description,\n  emptyMessage,\n  conditions,\n  onUpdate,\n  onRemove,\n  onAdd,\n  addLabel,\n  pressures,\n  schema,\n}) {\n  return (\n    <div className=\"section\">\n      <SectionHeader\n        icon={icon}\n        title={title}\n        count={`${conditions.length} condition${conditions.length !== 1 ? \"s\" : \"\"}`}\n        description={description}\n      />\n      <div className=\"items-grid\">\n        {conditions.length === 0 ? (\n          <EmptyState title={emptyMessage} styles={EMPTY_STATE_STYLES} />\n        ) : (\n          conditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdate(index, updated)}\n              onRemove={() => onRemove(index)}\n              pressures={pressures || []}\n              schema={schema}\n            />\n          ))\n        )}\n      </div>\n      <AddItemButton onClick={onAdd} label={addLabel} styles={ADD_ITEM_STYLES} />\n    </div>\n  );\n}", "parameters": [{"name": "{\n  title,\n  icon,\n  description,\n  emptyMessage,\n  conditions,\n  onUpdate,\n  onRemove,\n  onAdd,\n  addLabel,\n  pressures,\n  schema,\n}", "type": "{ title: string; icon: string; description: string; emptyMessage: string; conditions: any[]; onUpdate: Function; onRemove: Function; onAdd: Function; addLabel: string; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "SectionHeader", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "EmptyState", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "AddItemButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/index.js::EffectsSection", "name": "EffectsSection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.title - Section title\n * @param {string} props.icon - Section icon\n * @param {string} props.description - Section description\n * @param {string} props.emptyMessage - Message when no effects\n * @param {Array} props.pressureChanges - Array of [pressureId, value] tuples\n * @param {Function} props.onUpdate - Called when an effect value changes\n * @param {Function} props.onRemove - Called to remove an effect\n * @param {Array} props.availablePressures - Pressures that can be added\n * @param {Function} props.onAdd - Called to add an effect\n * @param {string} props.addPlaceholder - Placeholder for add dropdown\n * @param {Array} props.pressures - All pressure definitions for display\n */\nexport function EffectsSection({\n  title,\n  icon,\n  description,\n  emptyMessage,\n  pressureChanges,\n  onUpdate,\n  onRemove,\n  availablePressures,\n  onAdd,\n  addPlaceholder,\n  pressures,\n}) {\n  return (\n    <div className=\"section\">\n      <SectionHeader\n        icon={icon}\n        title={title}\n        count={`${pressureChanges.length} effect${pressureChanges.length !== 1 ? \"s\" : \"\"}`}\n        description={description}\n      />\n      <div className=\"items-grid\">\n        {pressureChanges.length === 0 ? (\n          <EmptyState title={emptyMessage} styles={EMPTY_STATE_STYLES} />\n        ) : (\n          pressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdate(pressureId, newValue)}\n              onRemove={() => onRemove(pressureId)}\n              pressures={pressures || []}\n            />\n          ))\n        )}\n      </div>\n      <div className=\"add-container\">\n        <SearchableDropdown\n          items={availablePressures}\n          onSelect={onAdd}\n          placeholder={addPlaceholder}\n          emptyMessage=\"All pressures added\"\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  title,\n  icon,\n  description,\n  emptyMessage,\n  pressureChanges,\n  onUpdate,\n  onRemove,\n  availablePressures,\n  onAdd,\n  addPlaceholder,\n  pressures,\n}", "type": "{ title: string; icon: string; description: string; emptyMessage: string; pressureChanges: any[]; onUpdate: Function; onRemove: Function; availablePressures: any[]; onAdd: Function; addPlaceholder: string; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "SectionHeader", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "EmptyState", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "SearchableDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/index.js::TransitionsGrid", "name": "TransitionsGrid", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.entryConditions - Entry condition array\n * @param {Array} props.exitConditions - Exit condition array\n * @param {Array} props.entryPressureChanges - Entry effect tuples\n * @param {Array} props.exitPressureChanges - Exit effect tuples\n * @param {Function} props.onUpdateEntryCondition\n * @param {Function} props.onRemoveEntryCondition\n * @param {Function} props.onAddEntryCondition\n * @param {Function} props.onUpdateExitCondition\n * @param {Function} props.onRemoveExitCondition\n * @param {Function} props.onAddExitCondition\n * @param {Function} props.onUpdateEntryEffect\n * @param {Function} props.onRemoveEntryEffect\n * @param {Function} props.onAddEntryEffect\n * @param {Function} props.onUpdateExitEffect\n * @param {Function} props.onRemoveExitEffect\n * @param {Function} props.onAddExitEffect\n * @param {Array} props.availablePressuresForEntry\n * @param {Array} props.availablePressuresForExit\n * @param {Array} props.pressures - All pressures for display\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.eras - All eras for era-specific conditions\n */\nexport function TransitionsGrid({\n  entryConditions = [],\n  exitConditions = [],\n  entryPressureChanges = [],\n  exitPressureChanges = [],\n  onUpdateEntryCondition,\n  onRemoveEntryCondition,\n  onAddEntryCondition,\n  onUpdateExitCondition,\n  onRemoveExitCondition,\n  onAddExitCondition,\n  onUpdateEntryEffect,\n  onRemoveEntryEffect,\n  onAddEntryEffect,\n  onUpdateExitEffect,\n  onRemoveExitEffect,\n  onAddExitEffect,\n  availablePressuresForEntry = [],\n  availablePressuresForExit = [],\n  pressures = [],\n  schema,\n  eras = [],\n}) {\n  return (\n    <div className=\"transitions-grid\">\n      {/* Entry Column */}\n      <div className=\"transitions-column transitions-entry\">\n        <div className=\"transitions-column-header\">\n          <span className=\"transitions-column-icon\">\ud83d\udeaa</span>\n          <span className=\"transitions-column-title\">Entry</span>\n          <span className=\"transitions-column-subtitle\">When era starts</span>\n        </div>\n\n        <MiniSection\n          title=\"Conditions\"\n          icon=\"?\"\n          count={entryConditions.length}\n          isEmpty={entryConditions.length === 0}\n          emptyMessage=\"No entry conditions \u2014 starts immediately\"\n        >\n          {entryConditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdateEntryCondition(index, updated)}\n              onRemove={() => onRemoveEntryCondition(index)}\n              pressures={pressures}\n              schema={schema}\n              eras={eras}\n            />\n          ))}\n          <AddItemButton\n            onClick={onAddEntryCondition}\n            label=\"+ Condition\"\n            styles={ADD_ITEM_STYLES}\n          />\n        </MiniSection>\n\n        <MiniSection\n          title=\"Effects\"\n          icon=\"\u2728\"\n          count={entryPressureChanges.length}\n          isEmpty={entryPressureChanges.length === 0}\n          emptyMessage=\"No pressure changes on entry\"\n        >\n          {entryPressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdateEntryEffect(pressureId, newValue)}\n              onRemove={() => onRemoveEntryEffect(pressureId)}\n              pressures={pressures}\n            />\n          ))}\n          <div className=\"transitions-add-effect\">\n            <SearchableDropdown\n              items={availablePressuresForEntry}\n              onSelect={onAddEntryEffect}\n              placeholder=\"+ Add effect...\"\n              emptyMessage=\"All pressures added\"\n            />\n          </div>\n        </MiniSection>\n      </div>\n\n      {/* Arrow divider */}\n      <div className=\"transitions-divider\">\n        <span className=\"transitions-arrow\">\u2192</span>\n      </div>\n\n      {/* Exit Column */}\n      <div className=\"transitions-column transitions-exit\">\n        <div className=\"transitions-column-header\">\n          <span className=\"transitions-column-icon\">\ud83d\udd04</span>\n          <span className=\"transitions-column-title\">Exit</span>\n          <span className=\"transitions-column-subtitle\">When era ends</span>\n        </div>\n\n        <MiniSection\n          title=\"Conditions\"\n          icon=\"?\"\n          count={exitConditions.length}\n          isEmpty={exitConditions.length === 0}\n          emptyMessage=\"No exit conditions \u2014 transitions immediately\"\n        >\n          {exitConditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdateExitCondition(index, updated)}\n              onRemove={() => onRemoveExitCondition(index)}\n              pressures={pressures}\n              schema={schema}\n              eras={eras}\n            />\n          ))}\n          <AddItemButton\n            onClick={onAddExitCondition}\n            label=\"+ Condition\"\n            styles={ADD_ITEM_STYLES}\n          />\n        </MiniSection>\n\n        <MiniSection\n          title=\"Effects\"\n          icon=\"\ud83d\udcab\"\n          count={exitPressureChanges.length}\n          isEmpty={exitPressureChanges.length === 0}\n          emptyMessage=\"No pressure changes on exit\"\n        >\n          {exitPressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdateExitEffect(pressureId, newValue)}\n              onRemove={() => onRemoveExitEffect(pressureId)}\n              pressures={pressures}\n            />\n          ))}\n          <div className=\"transitions-add-effect\">\n            <SearchableDropdown\n              items={availablePressuresForExit}\n              onSelect={onAddExitEffect}\n              placeholder=\"+ Add effect...\"\n              emptyMessage=\"All pressures added\"\n            />\n          </div>\n        </MiniSection>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  entryConditions = [],\n  exitConditions = [],\n  entryPressureChanges = [],\n  exitPressureChanges = [],\n  onUpdateEntryCondition,\n  onRemoveEntryCondition,\n  onAddEntryCondition,\n  onUpdateExitCondition,\n  onRemoveExitCondition,\n  onAddExitCondition,\n  onUpdateEntryEffect,\n  onRemoveEntryEffect,\n  onAddEntryEffect,\n  onUpdateExitEffect,\n  onRemoveExitEffect,\n  onAddExitEffect,\n  availablePressuresForEntry = [],\n  availablePressuresForExit = [],\n  pressures = [],\n  schema,\n  eras = [],\n}", "type": "{ entryConditions: any[]; exitConditions: any[]; entryPressureChanges: any[]; exitPressureChanges: any[]; onUpdateEntryCondition: Function; onRemoveEntryCondition: Function; onAddEntryCondition: Function; onUpdateExitCondition: Function; onRemoveExitCondition: Function; onAddExitCondition: Function; onUpdateEntryEffect: Function; onRemoveEntryEffect: Function; onAddEntryEffect: Function; onUpdateExitEffect: Function; onRemoveExitEffect: Function; onAddExitEffect: Function; availablePressuresF...", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionConditionEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "AddItemButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionEffectItem", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "SearchableDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionConditionEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "AddItemButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionEffectItem", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "SearchableDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/sections/TransitionsGrid.jsx::TransitionsGrid", "name": "TransitionsGrid", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/sections/TransitionsGrid.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.entryConditions - Entry condition array\n * @param {Array} props.exitConditions - Exit condition array\n * @param {Array} props.entryPressureChanges - Entry effect tuples\n * @param {Array} props.exitPressureChanges - Exit effect tuples\n * @param {Function} props.onUpdateEntryCondition\n * @param {Function} props.onRemoveEntryCondition\n * @param {Function} props.onAddEntryCondition\n * @param {Function} props.onUpdateExitCondition\n * @param {Function} props.onRemoveExitCondition\n * @param {Function} props.onAddExitCondition\n * @param {Function} props.onUpdateEntryEffect\n * @param {Function} props.onRemoveEntryEffect\n * @param {Function} props.onAddEntryEffect\n * @param {Function} props.onUpdateExitEffect\n * @param {Function} props.onRemoveExitEffect\n * @param {Function} props.onAddExitEffect\n * @param {Array} props.availablePressuresForEntry\n * @param {Array} props.availablePressuresForExit\n * @param {Array} props.pressures - All pressures for display\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.eras - All eras for era-specific conditions\n */\nexport function TransitionsGrid({\n  entryConditions = [],\n  exitConditions = [],\n  entryPressureChanges = [],\n  exitPressureChanges = [],\n  onUpdateEntryCondition,\n  onRemoveEntryCondition,\n  onAddEntryCondition,\n  onUpdateExitCondition,\n  onRemoveExitCondition,\n  onAddExitCondition,\n  onUpdateEntryEffect,\n  onRemoveEntryEffect,\n  onAddEntryEffect,\n  onUpdateExitEffect,\n  onRemoveExitEffect,\n  onAddExitEffect,\n  availablePressuresForEntry = [],\n  availablePressuresForExit = [],\n  pressures = [],\n  schema,\n  eras = [],\n}) {\n  return (\n    <div className=\"transitions-grid\">\n      {/* Entry Column */}\n      <div className=\"transitions-column transitions-entry\">\n        <div className=\"transitions-column-header\">\n          <span className=\"transitions-column-icon\">\ud83d\udeaa</span>\n          <span className=\"transitions-column-title\">Entry</span>\n          <span className=\"transitions-column-subtitle\">When era starts</span>\n        </div>\n\n        <MiniSection\n          title=\"Conditions\"\n          icon=\"?\"\n          count={entryConditions.length}\n          isEmpty={entryConditions.length === 0}\n          emptyMessage=\"No entry conditions \u2014 starts immediately\"\n        >\n          {entryConditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdateEntryCondition(index, updated)}\n              onRemove={() => onRemoveEntryCondition(index)}\n              pressures={pressures}\n              schema={schema}\n              eras={eras}\n            />\n          ))}\n          <AddItemButton\n            onClick={onAddEntryCondition}\n            label=\"+ Condition\"\n            styles={ADD_ITEM_STYLES}\n          />\n        </MiniSection>\n\n        <MiniSection\n          title=\"Effects\"\n          icon=\"\u2728\"\n          count={entryPressureChanges.length}\n          isEmpty={entryPressureChanges.length === 0}\n          emptyMessage=\"No pressure changes on entry\"\n        >\n          {entryPressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdateEntryEffect(pressureId, newValue)}\n              onRemove={() => onRemoveEntryEffect(pressureId)}\n              pressures={pressures}\n            />\n          ))}\n          <div className=\"transitions-add-effect\">\n            <SearchableDropdown\n              items={availablePressuresForEntry}\n              onSelect={onAddEntryEffect}\n              placeholder=\"+ Add effect...\"\n              emptyMessage=\"All pressures added\"\n            />\n          </div>\n        </MiniSection>\n      </div>\n\n      {/* Arrow divider */}\n      <div className=\"transitions-divider\">\n        <span className=\"transitions-arrow\">\u2192</span>\n      </div>\n\n      {/* Exit Column */}\n      <div className=\"transitions-column transitions-exit\">\n        <div className=\"transitions-column-header\">\n          <span className=\"transitions-column-icon\">\ud83d\udd04</span>\n          <span className=\"transitions-column-title\">Exit</span>\n          <span className=\"transitions-column-subtitle\">When era ends</span>\n        </div>\n\n        <MiniSection\n          title=\"Conditions\"\n          icon=\"?\"\n          count={exitConditions.length}\n          isEmpty={exitConditions.length === 0}\n          emptyMessage=\"No exit conditions \u2014 transitions immediately\"\n        >\n          {exitConditions.map((condition, index) => (\n            <TransitionConditionEditor\n              key={index}\n              condition={condition}\n              index={index}\n              onChange={(updated) => onUpdateExitCondition(index, updated)}\n              onRemove={() => onRemoveExitCondition(index)}\n              pressures={pressures}\n              schema={schema}\n              eras={eras}\n            />\n          ))}\n          <AddItemButton\n            onClick={onAddExitCondition}\n            label=\"+ Condition\"\n            styles={ADD_ITEM_STYLES}\n          />\n        </MiniSection>\n\n        <MiniSection\n          title=\"Effects\"\n          icon=\"\ud83d\udcab\"\n          count={exitPressureChanges.length}\n          isEmpty={exitPressureChanges.length === 0}\n          emptyMessage=\"No pressure changes on exit\"\n        >\n          {exitPressureChanges.map(([pressureId, value]) => (\n            <TransitionEffectItem\n              key={pressureId}\n              pressureId={pressureId}\n              value={value}\n              onChange={(newValue) => onUpdateExitEffect(pressureId, newValue)}\n              onRemove={() => onRemoveExitEffect(pressureId)}\n              pressures={pressures}\n            />\n          ))}\n          <div className=\"transitions-add-effect\">\n            <SearchableDropdown\n              items={availablePressuresForExit}\n              onSelect={onAddExitEffect}\n              placeholder=\"+ Add effect...\"\n              emptyMessage=\"All pressures added\"\n            />\n          </div>\n        </MiniSection>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  entryConditions = [],\n  exitConditions = [],\n  entryPressureChanges = [],\n  exitPressureChanges = [],\n  onUpdateEntryCondition,\n  onRemoveEntryCondition,\n  onAddEntryCondition,\n  onUpdateExitCondition,\n  onRemoveExitCondition,\n  onAddExitCondition,\n  onUpdateEntryEffect,\n  onRemoveEntryEffect,\n  onAddEntryEffect,\n  onUpdateExitEffect,\n  onRemoveExitEffect,\n  onAddExitEffect,\n  availablePressuresForEntry = [],\n  availablePressuresForExit = [],\n  pressures = [],\n  schema,\n  eras = [],\n}", "type": "{ entryConditions: any[]; exitConditions: any[]; entryPressureChanges: any[]; exitPressureChanges: any[]; onUpdateEntryCondition: Function; onRemoveEntryCondition: Function; onAddEntryCondition: Function; onUpdateExitCondition: Function; onRemoveExitCondition: Function; onAddExitCondition: Function; onUpdateEntryEffect: Function; onRemoveEntryEffect: Function; onAddEntryEffect: Function; onUpdateExitEffect: Function; onRemoveExitEffect: Function; onAddExitEffect: Function; availablePressuresF...", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionConditionEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "AddItemButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionEffectItem", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "SearchableDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionConditionEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "AddItemButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "MiniSection", "children": [{"tag": "TransitionEffectItem", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "SearchableDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["AddItemButton", "SearchableDropdown"], "category": "internal"}, {"source": "../shared", "specifiers": ["TransitionConditionEditor", "TransitionEffectItem"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/shared/index.js::TransitionConditionEditor", "name": "TransitionConditionEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.condition - The condition object\n * @param {number} props.index - Index in the conditions array\n * @param {Function} props.onChange - Called when condition changes\n * @param {Function} props.onRemove - Called to remove condition\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.eras - Era definitions (optional)\n */\nexport function TransitionConditionEditor({\n  condition,\n  index: _index,\n  onChange,\n  onRemove,\n  pressures,\n  schema,\n  eras,\n}) {\n  return (\n    <ApplicabilityRuleCard\n      rule={condition}\n      onChange={(updated) => onChange(updated)}\n      onRemove={onRemove}\n      schema={schema}\n      pressures={pressures}\n      eras={eras}\n      depth={0}\n    />\n  );\n}", "parameters": [{"name": "{\n  condition,\n  index: _index,\n  onChange,\n  onRemove,\n  pressures,\n  schema,\n  eras,\n}", "type": "{ condition: any; index: number; onChange: Function; onRemove: Function; pressures: any[]; schema: any; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "ApplicabilityRuleCard", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/shared/index.js::TransitionEffectItem", "name": "TransitionEffectItem", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.pressureId - The pressure ID\n * @param {number} props.value - The delta value\n * @param {Function} props.onChange - Called when value changes\n * @param {Function} props.onRemove - Called to remove effect\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function TransitionEffectItem({ pressureId, value, onChange, onRemove, pressures }) {\n  const pressure = pressures.find((p) => p.id === pressureId);\n\n  return (\n    <ItemRow name={pressure?.name || pressureId} onRemove={onRemove} removeTitle=\"Remove effect\">\n      <NumberInput\n        value={value}\n        onChange={(v) => onChange(v ?? 0)}\n        className={`input input-compact input-centered ${value >= 0 ? \"text-success\" : \"text-danger\"}`}\n        integer\n      />\n      <span className=\"text-dim text-sm tei-pressure-label\">\n        {value >= 0 ? \"+\" : \"\"}\n        {value} pressure\n      </span>\n    </ItemRow>\n  );\n}", "parameters": [{"name": "{ pressureId, value, onChange, onRemove, pressures }", "type": "{ pressureId: string; value: number; onChange: Function; onRemove: Function; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "ItemRow", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/shared/TransitionConditionEditor.jsx::TransitionConditionEditor", "name": "TransitionConditionEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/shared/TransitionConditionEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.condition - The condition object\n * @param {number} props.index - Index in the conditions array\n * @param {Function} props.onChange - Called when condition changes\n * @param {Function} props.onRemove - Called to remove condition\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.eras - Era definitions (optional)\n */\nexport function TransitionConditionEditor({\n  condition,\n  index: _index,\n  onChange,\n  onRemove,\n  pressures,\n  schema,\n  eras,\n}) {\n  return (\n    <ApplicabilityRuleCard\n      rule={condition}\n      onChange={(updated) => onChange(updated)}\n      onRemove={onRemove}\n      schema={schema}\n      pressures={pressures}\n      eras={eras}\n      depth={0}\n    />\n  );\n}", "parameters": [{"name": "{\n  condition,\n  index: _index,\n  onChange,\n  onRemove,\n  pressures,\n  schema,\n  eras,\n}", "type": "{ condition: any; index: number; onChange: Function; onRemove: Function; pressures: any[]; schema: any; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "ApplicabilityRuleCard", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../generators/applicability/ApplicabilityRuleCard", "specifiers": ["ApplicabilityRuleCard"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/eras/shared/TransitionEffectItem.jsx::TransitionEffectItem", "name": "TransitionEffectItem", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/shared/TransitionEffectItem.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.pressureId - The pressure ID\n * @param {number} props.value - The delta value\n * @param {Function} props.onChange - Called when value changes\n * @param {Function} props.onRemove - Called to remove effect\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function TransitionEffectItem({ pressureId, value, onChange, onRemove, pressures }) {\n  const pressure = pressures.find((p) => p.id === pressureId);\n\n  return (\n    <ItemRow name={pressure?.name || pressureId} onRemove={onRemove} removeTitle=\"Remove effect\">\n      <NumberInput\n        value={value}\n        onChange={(v) => onChange(v ?? 0)}\n        className={`input input-compact input-centered ${value >= 0 ? \"text-success\" : \"text-danger\"}`}\n        integer\n      />\n      <span className=\"text-dim text-sm tei-pressure-label\">\n        {value >= 0 ? \"+\" : \"\"}\n        {value} pressure\n      </span>\n    </ItemRow>\n  );\n}", "parameters": [{"name": "{ pressureId, value, onChange, onRemove, pressures }", "type": "{ pressureId: string; value: number; onChange: Function; onRemove: Function; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "ItemRow", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["ItemRow", "NumberInput"], "category": "internal"}, {"source": "./TransitionEffectItem.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/AddRuleButton.jsx::AddRuleButton", "name": "AddRuleButton", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/AddRuleButton.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Function} props.onAdd - Callback when a rule type is selected\n * @param {number} props.depth - Nesting depth (limits nested rule types at depth >= 2)\n */\nexport function AddRuleButton({ onAdd, depth = 0 }) {\n  const [showPicker, setShowPicker] = useState(false);\n\n  return (\n    <div className=\"dropdown\">\n      <button className=\"btn-add\" onClick={() => setShowPicker(!showPicker)}>\n        + Add Rule\n      </button>\n\n      {showPicker && (\n        <div className=\"dropdown-menu arb-dropdown\">\n          <div className=\"dropdown-options\">\n            {Object.entries(APPLICABILITY_TYPES)\n              .filter(([type]) => depth < 2 || (type !== \"or\" && type !== \"and\"))\n              .map(([type, config]) => (\n                <div\n                  key={type}\n                  className=\"dropdown-menu-item\"\n                  onClick={() => {\n                    onAdd(type);\n                    setShowPicker(false);\n                  }}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <div\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n                    style={{ '--arb-icon-bg': `${config.color}20`, backgroundColor: 'var(--arb-icon-bg)' }}\n                  >\n                    {config.icon}\n                  </div>\n                  <div>\n                    <div className=\"dropdown-menu-label\">{config.label}</div>\n                    <div className=\"arb-desc\">\n                      {config.desc}\n                    </div>\n                  </div>\n                </div>\n              ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ onAdd, depth = 0 }", "type": "{ onAdd: Function; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["APPLICABILITY_TYPES"], "category": "internal"}, {"source": "./AddRuleButton.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityRuleCard.jsx::ApplicabilityRuleCard", "name": "ApplicabilityRuleCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityRuleCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.rule - The rule configuration\n * @param {Function} props.onChange - Callback when rule changes\n * @param {Function} props.onRemove - Callback to remove this rule\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {number} props.depth - Nesting depth for nested rules\n */\nexport function ApplicabilityRuleCard({\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = APPLICABILITY_TYPES[rule.type] || {};\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const getSubtypesForKind = (kind) => {\n    const ek = entityKinds.find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const pressureOptions = (pressures || []).map((p) => ({\n    value: p.id,\n    label: p.name || p.id,\n  }));\n\n  const eraOptions = (eras || []).map((e) => ({\n    value: e.id,\n    label: e.name || e.id,\n  }));\n\n  const updateField = (field, value) => {\n    onChange({ ...rule, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (rule.type) {\n      case \"entity_count\": {\n        const kindSpec = `${rule.kind || \"?\"}${rule.subtype ? \":\" + rule.subtype : \"\"}`;\n        const minPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const maxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${kindSpec} ${minPart}${maxPart}`;\n      }\n      case \"pressure\":\n        return `${rule.pressureId || \"?\"} in [${rule.min ?? \"-\\u221E\"}, ${rule.max ?? \"\\u221E\"}]`;\n      case \"pressure_any_above\":\n        return `Any of [${rule.pressureIds?.join(\", \") || \"?\"}] > ${rule.threshold ?? \"?\"}`;\n      case \"pressure_compare\":\n        return `${rule.pressureA || \"?\"} ${rule.operator || \">\"} ${rule.pressureB || \"?\"}`;\n      case \"relationship_count\": {\n        const relMinPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const relMaxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${rule.relationshipKind || \"any\"} count ${relMinPart}${relMaxPart}`;\n      }\n      case \"relationship_exists\": {\n        const targetSuffix = rule.targetKind ? ` to ${rule.targetKind}` : \"\";\n        return `${rule.relationshipKind || \"?\"} exists${targetSuffix}`;\n      }\n      case \"tag_exists\":\n        return `has tag \"${rule.tag || \"?\"}\"`;\n      case \"tag_absent\":\n        return `missing tag \"${rule.tag || \"?\"}\"`;\n      case \"status\":\n        return rule.not ? `status != ${rule.status || \"?\"}` : `status = ${rule.status || \"?\"}`;\n      case \"prominence\":\n        return `prominence ${rule.min || \"?\"}-${rule.max || \"?\"}`;\n      case \"time_elapsed\":\n        return `${rule.minTicks || \"?\"} ticks since ${rule.since || \"updated\"}`;\n      case \"growth_phases_complete\": {\n        const eraSuffix = rule.eraId ? ` in ${rule.eraId}` : \"\";\n        return `${rule.minPhases ?? \"?\"} growth phases${eraSuffix}`;\n      }\n      case \"era_match\":\n        return rule.eras?.length ? rule.eras.join(\", \") : \"No eras selected\";\n      case \"random_chance\":\n        return `${Math.round((rule.chance ?? 0.5) * 100)}% chance`;\n      case \"cooldown_elapsed\":\n        return `${rule.cooldownTicks ?? \"?\"} ticks since last run`;\n      case \"creations_per_epoch\":\n        return `max ${rule.maxPerEpoch ?? \"?\"} per epoch`;\n      case \"graph_path\":\n        return `graph path (${rule.assert?.check || \"exists\"})`;\n      case \"entity_exists\":\n        return `entity ${rule.entity || \"?\"} exists`;\n      case \"entity_has_relationship\":\n        return `${rule.entity || \"?\"} has ${rule.relationshipKind || \"?\"} relationship`;\n      case \"or\":\n      case \"and\":\n        return `${rule.conditions?.length || 0} sub-rules`;\n      case \"always\":\n        return \"always\";\n      default:\n        return rule.type;\n    }\n  };\n\n  const isNested = rule.type === \"or\" || rule.type === \"and\";\n\n  return (\n    <div className=\"condition-card\">\n      <div className=\"condition-card-header\">\n        <div className=\"condition-card-type\">\n          <div\n            className=\"condition-card-icon\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n            style={{ '--arc-icon-bg': `${typeConfig.color || \"#3b82f6\"}20`, backgroundColor: 'var(--arc-icon-bg)' }}\n          >\n            {typeConfig.icon || \"\ud83d\udccb\"}\n          </div>\n          <div>\n            <div className=\"condition-card-label\">{typeConfig.label || rule.type}</div>\n            <div className=\"condition-card-summary\">{getSummary()}</div>\n          </div>\n        </div>\n        <div className=\"condition-card-actions\">\n          <button className=\"btn-icon\" onClick={() => setExpanded(!expanded)}>\n            {expanded ? \"^\" : \"v\"}\n          </button>\n          <button className=\"btn-icon btn-icon-danger\" onClick={onRemove}>\n            x\n          </button>\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"mt-lg\">\n          <div className=\"form-grid\">\n            {rule.type === \"entity_count\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={rule.kind}\n                  onChange={(v) => {\n                    updateField(\"kind\", v);\n                    if (rule.subtype) updateField(\"subtype\", undefined);\n                  }}\n                  options={entityKindOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Subtype (optional)\"\n                  value={rule.subtype || \"\"}\n                  onChange={(v) => updateField(\"subtype\", v || undefined)}\n                  options={[{ value: \"\", label: \"Any\" }, ...getSubtypesForKind(rule.kind)]}\n                  placeholder=\"Any\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure\"\n                  value={rule.pressureId}\n                  onChange={(v) => updateField(\"pressureId\", v)}\n                  options={pressureOptions}\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min Value\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"0\"\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max Value\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"100\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_any_above\" && (\n              <>\n                <div className=\"grid-col-full\">\n                  <ChipSelect\n                    label=\"Pressures\"\n                    value={rule.pressureIds || []}\n                    onChange={(v) => updateField(\"pressureIds\", v)}\n                    options={pressureOptions}\n                    placeholder=\"+ Add pressure\"\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Threshold\n                  <NumberInput\n                    value={rule.threshold}\n                    onChange={(v) => updateField(\"threshold\", v ?? 0)}\n                    min={-100}\n                    max={100}\n                    integer\n                    placeholder=\"50\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_compare\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure A\"\n                  value={rule.pressureA}\n                  onChange={(v) => updateField(\"pressureA\", v)}\n                  options={pressureOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Operator\"\n                  value={rule.operator || \">\"}\n                  onChange={(v) => updateField(\"operator\", v)}\n                  options={[\n                    { value: \">\", label: \">\" },\n                    { value: \">=\", label: \">=\" },\n                    { value: \"<\", label: \"<\" },\n                    { value: \"<=\", label: \"<=\" },\n                    { value: \"==\", label: \"==\" },\n                    { value: \"!=\", label: \"!=\" },\n                  ]}\n                />\n                <ReferenceDropdown\n                  label=\"Pressure B\"\n                  value={rule.pressureB}\n                  onChange={(v) => updateField(\"pressureB\", v)}\n                  options={pressureOptions}\n                />\n              </>\n            )}\n\n\n            {rule.type === \"era_match\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Eras\"\n                  value={rule.eras || []}\n                  onChange={(v) => updateField(\"eras\", v)}\n                  options={eraOptions}\n                  placeholder=\"+ Add era\"\n                />\n              </div>\n            )}\n\n            {rule.type === \"random_chance\" && (\n              <div className=\"form-group grid-col-full\">\n                <span className=\"label\">Chance (%)</span>\n                <div className=\"flex items-center gap-lg\">\n// ... (truncated)", "parameters": [{"name": "{\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}", "type": "{ rule: any; onChange: Function; onRemove: Function; schema: any; pressures: any[]; eras: any[]; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}, {"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "GraphPathEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ApplicabilityRuleCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["APPLICABILITY_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "ChipSelect", "NumberInput", "PROMINENCE_LEVELS"], "category": "internal"}, {"source": "./AddRuleButton", "specifiers": ["AddRuleButton"], "category": "internal"}, {"source": "./createNewRule", "specifiers": ["createNewRule"], "category": "internal"}, {"source": "../filters/GraphPathEditor", "specifiers": ["GraphPathEditor"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityTab.jsx::ApplicabilityTab", "name": "ApplicabilityTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n */\nexport function ApplicabilityTab({ generator, onChange, schema, pressures, eras }) {\n  const rules = generator.applicability || [];\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Applicability Rules</div>\n        <div className=\"section-desc\">\n          Define when this generator is eligible to run. If no rules are defined, the generator will\n          always be eligible. Multiple top-level rules are combined with AND logic.\n        </div>\n\n        {rules.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2713</div>\n            <div className=\"empty-state-title\">No applicability rules</div>\n            <div className=\"empty-state-desc\">\n              This generator will always be eligible to run. Add rules to control when it activates.\n            </div>\n          </div>\n        ) : (\n          rules.map((rule, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={rule}\n              onChange={(updated) => {\n                const newRules = [...rules];\n                newRules[index] = updated;\n                onChange({ ...generator, applicability: newRules });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, applicability: rules.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              pressures={pressures}\n              eras={eras}\n            />\n          ))\n        )}\n\n        <AddRuleButton\n          onAdd={(type) => {\n            const newRule = createNewRule(type, pressures);\n            onChange({ ...generator, applicability: [...rules, newRule] });\n          }}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema, pressures, eras }", "type": "{ generator: any; onChange: Function; schema: any; pressures: any[]; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./ApplicabilityRuleCard", "specifiers": ["ApplicabilityRuleCard"], "category": "internal"}, {"source": "./AddRuleButton", "specifiers": ["AddRuleButton"], "category": "internal"}, {"source": "./createNewRule", "specifiers": ["createNewRule"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/index.js::AddRuleButton", "name": "AddRuleButton", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Function} props.onAdd - Callback when a rule type is selected\n * @param {number} props.depth - Nesting depth (limits nested rule types at depth >= 2)\n */\nexport function AddRuleButton({ onAdd, depth = 0 }) {\n  const [showPicker, setShowPicker] = useState(false);\n\n  return (\n    <div className=\"dropdown\">\n      <button className=\"btn-add\" onClick={() => setShowPicker(!showPicker)}>\n        + Add Rule\n      </button>\n\n      {showPicker && (\n        <div className=\"dropdown-menu arb-dropdown\">\n          <div className=\"dropdown-options\">\n            {Object.entries(APPLICABILITY_TYPES)\n              .filter(([type]) => depth < 2 || (type !== \"or\" && type !== \"and\"))\n              .map(([type, config]) => (\n                <div\n                  key={type}\n                  className=\"dropdown-menu-item\"\n                  onClick={() => {\n                    onAdd(type);\n                    setShowPicker(false);\n                  }}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <div\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n                    style={{ '--arb-icon-bg': `${config.color}20`, backgroundColor: 'var(--arb-icon-bg)' }}\n                  >\n                    {config.icon}\n                  </div>\n                  <div>\n                    <div className=\"dropdown-menu-label\">{config.label}</div>\n                    <div className=\"arb-desc\">\n                      {config.desc}\n                    </div>\n                  </div>\n                </div>\n              ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ onAdd, depth = 0 }", "type": "{ onAdd: Function; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/index.js::ApplicabilityRuleCard", "name": "ApplicabilityRuleCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.rule - The rule configuration\n * @param {Function} props.onChange - Callback when rule changes\n * @param {Function} props.onRemove - Callback to remove this rule\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {number} props.depth - Nesting depth for nested rules\n */\nexport function ApplicabilityRuleCard({\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = APPLICABILITY_TYPES[rule.type] || {};\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const getSubtypesForKind = (kind) => {\n    const ek = entityKinds.find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const pressureOptions = (pressures || []).map((p) => ({\n    value: p.id,\n    label: p.name || p.id,\n  }));\n\n  const eraOptions = (eras || []).map((e) => ({\n    value: e.id,\n    label: e.name || e.id,\n  }));\n\n  const updateField = (field, value) => {\n    onChange({ ...rule, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (rule.type) {\n      case \"entity_count\": {\n        const kindSpec = `${rule.kind || \"?\"}${rule.subtype ? \":\" + rule.subtype : \"\"}`;\n        const minPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const maxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${kindSpec} ${minPart}${maxPart}`;\n      }\n      case \"pressure\":\n        return `${rule.pressureId || \"?\"} in [${rule.min ?? \"-\\u221E\"}, ${rule.max ?? \"\\u221E\"}]`;\n      case \"pressure_any_above\":\n        return `Any of [${rule.pressureIds?.join(\", \") || \"?\"}] > ${rule.threshold ?? \"?\"}`;\n      case \"pressure_compare\":\n        return `${rule.pressureA || \"?\"} ${rule.operator || \">\"} ${rule.pressureB || \"?\"}`;\n      case \"relationship_count\": {\n        const relMinPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const relMaxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${rule.relationshipKind || \"any\"} count ${relMinPart}${relMaxPart}`;\n      }\n      case \"relationship_exists\": {\n        const targetSuffix = rule.targetKind ? ` to ${rule.targetKind}` : \"\";\n        return `${rule.relationshipKind || \"?\"} exists${targetSuffix}`;\n      }\n      case \"tag_exists\":\n        return `has tag \"${rule.tag || \"?\"}\"`;\n      case \"tag_absent\":\n        return `missing tag \"${rule.tag || \"?\"}\"`;\n      case \"status\":\n        return rule.not ? `status != ${rule.status || \"?\"}` : `status = ${rule.status || \"?\"}`;\n      case \"prominence\":\n        return `prominence ${rule.min || \"?\"}-${rule.max || \"?\"}`;\n      case \"time_elapsed\":\n        return `${rule.minTicks || \"?\"} ticks since ${rule.since || \"updated\"}`;\n      case \"growth_phases_complete\": {\n        const eraSuffix = rule.eraId ? ` in ${rule.eraId}` : \"\";\n        return `${rule.minPhases ?? \"?\"} growth phases${eraSuffix}`;\n      }\n      case \"era_match\":\n        return rule.eras?.length ? rule.eras.join(\", \") : \"No eras selected\";\n      case \"random_chance\":\n        return `${Math.round((rule.chance ?? 0.5) * 100)}% chance`;\n      case \"cooldown_elapsed\":\n        return `${rule.cooldownTicks ?? \"?\"} ticks since last run`;\n      case \"creations_per_epoch\":\n        return `max ${rule.maxPerEpoch ?? \"?\"} per epoch`;\n      case \"graph_path\":\n        return `graph path (${rule.assert?.check || \"exists\"})`;\n      case \"entity_exists\":\n        return `entity ${rule.entity || \"?\"} exists`;\n      case \"entity_has_relationship\":\n        return `${rule.entity || \"?\"} has ${rule.relationshipKind || \"?\"} relationship`;\n      case \"or\":\n      case \"and\":\n        return `${rule.conditions?.length || 0} sub-rules`;\n      case \"always\":\n        return \"always\";\n      default:\n        return rule.type;\n    }\n  };\n\n  const isNested = rule.type === \"or\" || rule.type === \"and\";\n\n  return (\n    <div className=\"condition-card\">\n      <div className=\"condition-card-header\">\n        <div className=\"condition-card-type\">\n          <div\n            className=\"condition-card-icon\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n            style={{ '--arc-icon-bg': `${typeConfig.color || \"#3b82f6\"}20`, backgroundColor: 'var(--arc-icon-bg)' }}\n          >\n            {typeConfig.icon || \"\ud83d\udccb\"}\n          </div>\n          <div>\n            <div className=\"condition-card-label\">{typeConfig.label || rule.type}</div>\n            <div className=\"condition-card-summary\">{getSummary()}</div>\n          </div>\n        </div>\n        <div className=\"condition-card-actions\">\n          <button className=\"btn-icon\" onClick={() => setExpanded(!expanded)}>\n            {expanded ? \"^\" : \"v\"}\n          </button>\n          <button className=\"btn-icon btn-icon-danger\" onClick={onRemove}>\n            x\n          </button>\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"mt-lg\">\n          <div className=\"form-grid\">\n            {rule.type === \"entity_count\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={rule.kind}\n                  onChange={(v) => {\n                    updateField(\"kind\", v);\n                    if (rule.subtype) updateField(\"subtype\", undefined);\n                  }}\n                  options={entityKindOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Subtype (optional)\"\n                  value={rule.subtype || \"\"}\n                  onChange={(v) => updateField(\"subtype\", v || undefined)}\n                  options={[{ value: \"\", label: \"Any\" }, ...getSubtypesForKind(rule.kind)]}\n                  placeholder=\"Any\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure\"\n                  value={rule.pressureId}\n                  onChange={(v) => updateField(\"pressureId\", v)}\n                  options={pressureOptions}\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min Value\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"0\"\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max Value\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"100\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_any_above\" && (\n              <>\n                <div className=\"grid-col-full\">\n                  <ChipSelect\n                    label=\"Pressures\"\n                    value={rule.pressureIds || []}\n                    onChange={(v) => updateField(\"pressureIds\", v)}\n                    options={pressureOptions}\n                    placeholder=\"+ Add pressure\"\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Threshold\n                  <NumberInput\n                    value={rule.threshold}\n                    onChange={(v) => updateField(\"threshold\", v ?? 0)}\n                    min={-100}\n                    max={100}\n                    integer\n                    placeholder=\"50\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_compare\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure A\"\n                  value={rule.pressureA}\n                  onChange={(v) => updateField(\"pressureA\", v)}\n                  options={pressureOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Operator\"\n                  value={rule.operator || \">\"}\n                  onChange={(v) => updateField(\"operator\", v)}\n                  options={[\n                    { value: \">\", label: \">\" },\n                    { value: \">=\", label: \">=\" },\n                    { value: \"<\", label: \"<\" },\n                    { value: \"<=\", label: \"<=\" },\n                    { value: \"==\", label: \"==\" },\n                    { value: \"!=\", label: \"!=\" },\n                  ]}\n                />\n                <ReferenceDropdown\n                  label=\"Pressure B\"\n                  value={rule.pressureB}\n                  onChange={(v) => updateField(\"pressureB\", v)}\n                  options={pressureOptions}\n                />\n              </>\n            )}\n\n\n            {rule.type === \"era_match\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Eras\"\n                  value={rule.eras || []}\n                  onChange={(v) => updateField(\"eras\", v)}\n                  options={eraOptions}\n                  placeholder=\"+ Add era\"\n                />\n              </div>\n            )}\n\n            {rule.type === \"random_chance\" && (\n              <div className=\"form-group grid-col-full\">\n                <span className=\"label\">Chance (%)</span>\n                <div className=\"flex items-center gap-lg\">\n// ... (truncated)", "parameters": [{"name": "{\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}", "type": "{ rule: any; onChange: Function; onRemove: Function; schema: any; pressures: any[]; eras: any[]; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}, {"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "GraphPathEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "ApplicabilityRuleCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/applicability/index.js::ApplicabilityTab", "name": "ApplicabilityTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/applicability/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n */\nexport function ApplicabilityTab({ generator, onChange, schema, pressures, eras }) {\n  const rules = generator.applicability || [];\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Applicability Rules</div>\n        <div className=\"section-desc\">\n          Define when this generator is eligible to run. If no rules are defined, the generator will\n          always be eligible. Multiple top-level rules are combined with AND logic.\n        </div>\n\n        {rules.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2713</div>\n            <div className=\"empty-state-title\">No applicability rules</div>\n            <div className=\"empty-state-desc\">\n              This generator will always be eligible to run. Add rules to control when it activates.\n            </div>\n          </div>\n        ) : (\n          rules.map((rule, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={rule}\n              onChange={(updated) => {\n                const newRules = [...rules];\n                newRules[index] = updated;\n                onChange({ ...generator, applicability: newRules });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, applicability: rules.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              pressures={pressures}\n              eras={eras}\n            />\n          ))\n        )}\n\n        <AddRuleButton\n          onAdd={(type) => {\n            const newRule = createNewRule(type, pressures);\n            onChange({ ...generator, applicability: [...rules, newRule] });\n          }}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema, pressures, eras }", "type": "{ generator: any; onChange: Function; schema: any; pressures: any[]; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/cards/GeneratorListCard.jsx::GeneratorListCard", "name": "GeneratorListCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/cards/GeneratorListCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator to display\n * @param {Function} props.onClick - Callback when card is clicked\n * @param {Function} props.onToggle - Callback to toggle enabled state\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport function GeneratorListCard({ generator, onClick, onToggle, usageMap }) {\n  const isEnabled = generator.enabled !== false;\n\n  const summary = useMemo(() => {\n    const creates =\n      generator.creation?.map((c) => c.kind).filter((v, i, a) => a.indexOf(v) === i) || [];\n    const rels = generator.relationships?.length || 0;\n    const effects = generator.stateUpdates?.length || 0;\n    return { creates, rels, effects };\n  }, [generator]);\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"generator\", generator.id)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, generator.id]\n  );\n\n  const eraUsage = useMemo(() => {\n    if (!usageMap?.generators?.[generator.id]) return [];\n    return usageMap.generators[generator.id].eras || [];\n  }, [usageMap, generator.id]);\n\n  const errorCount = validation.invalidRefs.length;\n  const hasErrors = errorCount > 0;\n  const isOrphan = validation.isOrphan;\n\n  return (\n    <div\n      className={`card card-clickable ${!isEnabled ? \"card-disabled\" : \"\"} ${hasErrors ? \"card-error\" : \"\"} ${isOrphan && !hasErrors ? \"card-warning\" : \"\"}`}\n      onClick={onClick}\n      role=\"button\"\n      tabIndex={0}\n      onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }}\n    >\n      <div className=\"card-header\">\n        <div>\n          <div className=\"flex items-center gap-md\">\n            <span className=\"card-title\">{generator.name || generator.id}</span>\n            <ErrorBadge count={errorCount} />\n          </div>\n          <div className=\"card-id\">{generator.id}</div>\n        </div>\n        <EnableToggle\n          enabled={isEnabled}\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n        />\n      </div>\n\n      <div className=\"card-stats\">\n        <div className=\"card-stat\">\n          <span>\u2728</span> {generator.creation?.length || 0} creates\n        </div>\n        <div className=\"card-stat\">\n          <span>\ud83d\udd17</span> {summary.rels} rels\n        </div>\n        <div className=\"card-stat\">\n          <span>\u26a1</span> {summary.effects} effects\n        </div>\n      </div>\n\n      <div className=\"card-badges\">\n        {summary.creates.slice(0, 3).map((kind) => (\n          <span key={kind} className=\"badge badge-entity-kind\">\n            + {kind}\n          </span>\n        ))}\n      </div>\n\n      <EraBadges eras={eraUsage} />\n      {isOrphan && (\n        <div className=\"mt-md\">\n          <OrphanBadge isOrphan={isOrphan} />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onClick, onToggle, usageMap }", "type": "{ generator: any; onClick: Function; onToggle: Function; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "ErrorBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "EraBadges", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "OrphanBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 3}], "imports": [{"source": "react", "specifiers": ["React", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "@the-canonry/shared-components", "specifiers": ["getElementValidation"], "category": "external"}, {"source": "../../shared", "specifiers": ["ErrorBadge", "OrphanBadge", "EraBadges", "EnableToggle"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/cards/index.js::GeneratorListCard", "name": "GeneratorListCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/cards/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator to display\n * @param {Function} props.onClick - Callback when card is clicked\n * @param {Function} props.onToggle - Callback to toggle enabled state\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport function GeneratorListCard({ generator, onClick, onToggle, usageMap }) {\n  const isEnabled = generator.enabled !== false;\n\n  const summary = useMemo(() => {\n    const creates =\n      generator.creation?.map((c) => c.kind).filter((v, i, a) => a.indexOf(v) === i) || [];\n    const rels = generator.relationships?.length || 0;\n    const effects = generator.stateUpdates?.length || 0;\n    return { creates, rels, effects };\n  }, [generator]);\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"generator\", generator.id)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, generator.id]\n  );\n\n  const eraUsage = useMemo(() => {\n    if (!usageMap?.generators?.[generator.id]) return [];\n    return usageMap.generators[generator.id].eras || [];\n  }, [usageMap, generator.id]);\n\n  const errorCount = validation.invalidRefs.length;\n  const hasErrors = errorCount > 0;\n  const isOrphan = validation.isOrphan;\n\n  return (\n    <div\n      className={`card card-clickable ${!isEnabled ? \"card-disabled\" : \"\"} ${hasErrors ? \"card-error\" : \"\"} ${isOrphan && !hasErrors ? \"card-warning\" : \"\"}`}\n      onClick={onClick}\n      role=\"button\"\n      tabIndex={0}\n      onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }}\n    >\n      <div className=\"card-header\">\n        <div>\n          <div className=\"flex items-center gap-md\">\n            <span className=\"card-title\">{generator.name || generator.id}</span>\n            <ErrorBadge count={errorCount} />\n          </div>\n          <div className=\"card-id\">{generator.id}</div>\n        </div>\n        <EnableToggle\n          enabled={isEnabled}\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n        />\n      </div>\n\n      <div className=\"card-stats\">\n        <div className=\"card-stat\">\n          <span>\u2728</span> {generator.creation?.length || 0} creates\n        </div>\n        <div className=\"card-stat\">\n          <span>\ud83d\udd17</span> {summary.rels} rels\n        </div>\n        <div className=\"card-stat\">\n          <span>\u26a1</span> {summary.effects} effects\n        </div>\n      </div>\n\n      <div className=\"card-badges\">\n        {summary.creates.slice(0, 3).map((kind) => (\n          <span key={kind} className=\"badge badge-entity-kind\">\n            + {kind}\n          </span>\n        ))}\n      </div>\n\n      <EraBadges eras={eraUsage} />\n      {isOrphan && (\n        <div className=\"mt-md\">\n          <OrphanBadge isOrphan={isOrphan} />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onClick, onToggle, usageMap }", "type": "{ generator: any; onClick: Function; onToggle: Function; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "ErrorBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "EraBadges", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "OrphanBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 3}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/GraphPathEditor.jsx::GraphPathEditor", "name": "GraphPathEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/GraphPathEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.assert - The path assertion configuration\n * @param {Function} props.onChange - Callback when assertion changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function GraphPathEditor({ assert, onChange, schema, availableRefs }) {\n  const [showConstraintMenu, setShowConstraintMenu] = useState(false);\n\n  const assertion = assert || { check: \"exists\", path: [] };\n\n  const updateAssertion = (field, value) => {\n    onChange({ ...assertion, [field]: value });\n  };\n\n  const addStep = () => {\n    // Create with empty required fields - validation will flag them\n    const newStep = { via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" };\n    updateAssertion(\"path\", [...(assertion.path || []), newStep]);\n  };\n\n  const updateStep = (index, updated) => {\n    const newPath = [...(assertion.path || [])];\n    newPath[index] = updated;\n    updateAssertion(\"path\", newPath);\n  };\n\n  const removeStep = (index) => {\n    updateAssertion(\n      \"path\",\n      (assertion.path || []).filter((_, i) => i !== index)\n    );\n  };\n\n  const addConstraint = (type) => {\n    const newConstraint = { type };\n    if (type === \"has_relationship\" || type === \"lacks_relationship\") {\n      newConstraint.direction = \"any\";\n    }\n    updateAssertion(\"where\", [...(assertion.where || []), newConstraint]);\n    setShowConstraintMenu(false);\n  };\n\n  const updateConstraint = (index, updated) => {\n    const newWhere = [...(assertion.where || [])];\n    newWhere[index] = updated;\n    updateAssertion(\"where\", newWhere);\n  };\n\n  const removeConstraint = (index) => {\n    const newWhere = (assertion.where || []).filter((_, i) => i !== index);\n    updateAssertion(\"where\", newWhere.length > 0 ? newWhere : undefined);\n  };\n\n  // Collect variables from path steps for constraint references\n  const pathVars = (assertion.path || []).filter((s) => s.as).map((s) => s.as);\n  const allRefs = [...(availableRefs || []), ...pathVars];\n\n  return (\n    <div className=\"graph-path-editor\">\n      {/* Check type and count */}\n      <div className=\"path-editor-grid\">\n        <div>\n          <label className=\"label label-tiny\">Check Type\n          <ReferenceDropdown\n            value={assertion.check || \"exists\"}\n            onChange={(v) => updateAssertion(\"check\", v)}\n            options={PATH_CHECK_TYPES}\n          />\n          </label>\n        </div>\n        {(assertion.check === \"count_min\" || assertion.check === \"count_max\") && (\n          <div>\n            <label className=\"label label-tiny\">Count\n            <NumberInput\n              value={assertion.count ?? 1}\n              onChange={(v) => updateAssertion(\"count\", v ?? 1)}\n              min={0}\n              integer\n              className=\"input input-compact\"\n            />\n            </label>\n          </div>\n        )}\n      </div>\n\n      {/* Path steps */}\n      <div>\n        <span className=\"label label-tiny\">Path Steps (traverse relationships)</span>\n        <div className=\"path-steps-list\">\n          {(assertion.path || []).map((step, index) => (\n            <PathStepEditor\n              key={index}\n              step={step}\n              onChange={(updated) => updateStep(index, updated)}\n              onRemove={() => removeStep(index)}\n              schema={schema}\n              stepIndex={index}\n            />\n          ))}\n          {(assertion.path || []).length < 2 && (\n            <button onClick={addStep} className=\"button button-add-step\">\n              + Add Step {(assertion.path || []).length === 0 ? \"(required)\" : \"(optional)\"}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Where constraints */}\n      <div>\n        <span className=\"label label-tiny\">Where Constraints (optional)</span>\n        <div className=\"path-constraints-list\">\n          {(assertion.where || []).map((constraint, index) => (\n            <PathConstraintEditor\n              key={index}\n              constraint={constraint}\n              onChange={(updated) => updateConstraint(index, updated)}\n              onRemove={() => removeConstraint(index)}\n              schema={schema}\n              availableRefs={allRefs}\n            />\n          ))}\n          <div className=\"relative\">\n            <button\n              onClick={() => setShowConstraintMenu(!showConstraintMenu)}\n              className=\"button button-add-constraint\"\n            >\n              + Add Constraint\n            </button>\n            {showConstraintMenu && (\n              <div className=\"dropdown-menu\">\n                {PATH_CONSTRAINT_TYPES.map(({ value, label }) => (\n                  <div\n                    key={value}\n                    onClick={() => addConstraint(value)}\n                    className=\"dropdown-menu-item\"\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    {label}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ assert, onChange, schema, availableRefs }", "type": "{ assert: any; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "PathStepEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "PathConstraintEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["PATH_CHECK_TYPES", "PATH_CONSTRAINT_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput"], "category": "internal"}, {"source": "./PathStepEditor", "specifiers": ["PathStepEditor"], "category": "internal"}, {"source": "./PathConstraintEditor", "specifiers": ["PathConstraintEditor"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/index.js::PathStepEditor", "name": "PathStepEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.step - The path step configuration\n * @param {Function} props.onChange - Callback when step changes\n * @param {Function} props.onRemove - Callback to remove this step\n * @param {Object} props.schema - Domain schema\n * @param {number} props.stepIndex - Index of this step in the path\n */\nexport function PathStepEditor({ step, onChange, onRemove, schema, stepIndex }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKindOptions = [\n    { value: \"any\", label: \"Any kind\" },\n    ...(schema?.entityKinds || []).map((ek) => ({\n      value: ek.kind,\n      label: ek.description || ek.kind,\n    })),\n  ];\n\n  const getSubtypeOptions = (kind) => {\n    if (!kind || kind === \"any\") return [{ value: \"any\", label: \"Any subtype\" }];\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [{ value: \"any\", label: \"Any subtype\" }];\n    return [\n      { value: \"any\", label: \"Any subtype\" },\n      ...ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id })),\n    ];\n  };\n\n  const updateStep = (field, value) => {\n    onChange({ ...step, [field]: value });\n  };\n\n  return (\n    <div className=\"path-step-card\">\n      <div className=\"path-step-header\">\n        <span className=\"path-step-label\">Step {stepIndex + 1}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      <div className=\"path-step-grid\">\n        <div>\n          <label className=\"label label-micro\">Via Relationship\n          <ReferenceDropdown\n            value={step.via || \"\"}\n            onChange={(v) => updateStep(\"via\", v)}\n            options={relationshipKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Direction\n          <ReferenceDropdown\n            value={step.direction || \"any\"}\n            onChange={(v) => updateStep(\"direction\", v)}\n            options={PATH_DIRECTIONS}\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Kind\n          <ReferenceDropdown\n            value={step.targetKind}\n            onChange={(v) => updateStep(\"targetKind\", v)}\n            options={entityKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Subtype\n          <ReferenceDropdown\n            value={step.targetSubtype}\n            onChange={(v) => updateStep(\"targetSubtype\", v)}\n            options={getSubtypeOptions(step.targetKind)}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div className=\"path-step-full-width\">\n          <label htmlFor=\"store-as-variable-optional\" className=\"label label-micro\">Store As Variable (optional)</label>\n          <input id=\"store-as-variable-optional\"\n            type=\"text\"\n            value={step.as || \"\"}\n            onChange={(e) => updateStep(\"as\", e.target.value)}\n            className=\"input input-micro\"\n            placeholder=\"e.g. $allies\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ step, onChange, onRemove, schema, stepIndex }", "type": "{ step: any; onChange: Function; onRemove: Function; schema: any; stepIndex: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/index.js::PathConstraintEditor", "name": "PathConstraintEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.constraint - The path constraint configuration\n * @param {Function} props.onChange - Callback when constraint changes\n * @param {Function} props.onRemove - Callback to remove this constraint\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function PathConstraintEditor({ constraint, onChange, onRemove, schema, availableRefs }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  // Gather all subtypes from all entity kinds for subtype_equals constraint\n  const allSubtypeOptions = entityKinds.flatMap((ek) =>\n    (ek.subtypes || []).map((st) => ({\n      value: st.id,\n      label: `${st.name || st.id} (${ek.kind})`,\n    }))\n  );\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateConstraint = (field, value) => {\n    onChange({ ...constraint, [field]: value || undefined });\n  };\n\n  const renderConstraintFields = () => {\n    switch (constraint.type) {\n      case \"not_self\":\n        return <span className=\"text-muted text-small\">Target cannot be the starting entity</span>;\n\n      case \"not_in\":\n      case \"in\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Set Variable\n            <ReferenceDropdown\n              value={constraint.set || \"\"}\n              onChange={(v) => updateConstraint(\"set\", v)}\n              options={refOptions}\n              placeholder=\"e.g. $allies\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"kind_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Entity Kind\n            <ReferenceDropdown\n              value={constraint.kind || \"\"}\n              onChange={(v) => updateConstraint(\"kind\", v)}\n              options={entityKindOptions}\n            />\n            </label>\n          </div>\n        );\n\n      case \"subtype_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Subtype\n            <ReferenceDropdown\n              value={constraint.subtype || \"\"}\n              onChange={(v) => updateConstraint(\"subtype\", v)}\n              options={allSubtypeOptions}\n              placeholder=\"Select subtype...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"constraint-fields-grid\">\n            <div>\n              <label className=\"label label-micro\">Kind\n              <ReferenceDropdown\n                value={constraint.kind || \"\"}\n                onChange={(v) => updateConstraint(\"kind\", v)}\n                options={relationshipKindOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">With\n              <ReferenceDropdown\n                value={constraint.with || \"\"}\n                onChange={(v) => updateConstraint(\"with\", v)}\n                options={refOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">Direction\n              <ReferenceDropdown\n                value={constraint.direction || \"any\"}\n                onChange={(v) => updateConstraint(\"direction\", v)}\n                options={PATH_DIRECTIONS}\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  const constraintLabel =\n    PATH_CONSTRAINT_TYPES.find((c) => c.value === constraint.type)?.label || constraint.type;\n\n  return (\n    <div className=\"path-constraint-card\">\n      <div className=\"path-constraint-header\">\n        <span className=\"path-constraint-label\">{constraintLabel}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      {renderConstraintFields()}\n    </div>\n  );\n}", "parameters": [{"name": "{ constraint, onChange, onRemove, schema, availableRefs }", "type": "{ constraint: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "span", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/index.js::GraphPathEditor", "name": "GraphPathEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.assert - The path assertion configuration\n * @param {Function} props.onChange - Callback when assertion changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function GraphPathEditor({ assert, onChange, schema, availableRefs }) {\n  const [showConstraintMenu, setShowConstraintMenu] = useState(false);\n\n  const assertion = assert || { check: \"exists\", path: [] };\n\n  const updateAssertion = (field, value) => {\n    onChange({ ...assertion, [field]: value });\n  };\n\n  const addStep = () => {\n    // Create with empty required fields - validation will flag them\n    const newStep = { via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" };\n    updateAssertion(\"path\", [...(assertion.path || []), newStep]);\n  };\n\n  const updateStep = (index, updated) => {\n    const newPath = [...(assertion.path || [])];\n    newPath[index] = updated;\n    updateAssertion(\"path\", newPath);\n  };\n\n  const removeStep = (index) => {\n    updateAssertion(\n      \"path\",\n      (assertion.path || []).filter((_, i) => i !== index)\n    );\n  };\n\n  const addConstraint = (type) => {\n    const newConstraint = { type };\n    if (type === \"has_relationship\" || type === \"lacks_relationship\") {\n      newConstraint.direction = \"any\";\n    }\n    updateAssertion(\"where\", [...(assertion.where || []), newConstraint]);\n    setShowConstraintMenu(false);\n  };\n\n  const updateConstraint = (index, updated) => {\n    const newWhere = [...(assertion.where || [])];\n    newWhere[index] = updated;\n    updateAssertion(\"where\", newWhere);\n  };\n\n  const removeConstraint = (index) => {\n    const newWhere = (assertion.where || []).filter((_, i) => i !== index);\n    updateAssertion(\"where\", newWhere.length > 0 ? newWhere : undefined);\n  };\n\n  // Collect variables from path steps for constraint references\n  const pathVars = (assertion.path || []).filter((s) => s.as).map((s) => s.as);\n  const allRefs = [...(availableRefs || []), ...pathVars];\n\n  return (\n    <div className=\"graph-path-editor\">\n      {/* Check type and count */}\n      <div className=\"path-editor-grid\">\n        <div>\n          <label className=\"label label-tiny\">Check Type\n          <ReferenceDropdown\n            value={assertion.check || \"exists\"}\n            onChange={(v) => updateAssertion(\"check\", v)}\n            options={PATH_CHECK_TYPES}\n          />\n          </label>\n        </div>\n        {(assertion.check === \"count_min\" || assertion.check === \"count_max\") && (\n          <div>\n            <label className=\"label label-tiny\">Count\n            <NumberInput\n              value={assertion.count ?? 1}\n              onChange={(v) => updateAssertion(\"count\", v ?? 1)}\n              min={0}\n              integer\n              className=\"input input-compact\"\n            />\n            </label>\n          </div>\n        )}\n      </div>\n\n      {/* Path steps */}\n      <div>\n        <span className=\"label label-tiny\">Path Steps (traverse relationships)</span>\n        <div className=\"path-steps-list\">\n          {(assertion.path || []).map((step, index) => (\n            <PathStepEditor\n              key={index}\n              step={step}\n              onChange={(updated) => updateStep(index, updated)}\n              onRemove={() => removeStep(index)}\n              schema={schema}\n              stepIndex={index}\n            />\n          ))}\n          {(assertion.path || []).length < 2 && (\n            <button onClick={addStep} className=\"button button-add-step\">\n              + Add Step {(assertion.path || []).length === 0 ? \"(required)\" : \"(optional)\"}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Where constraints */}\n      <div>\n        <span className=\"label label-tiny\">Where Constraints (optional)</span>\n        <div className=\"path-constraints-list\">\n          {(assertion.where || []).map((constraint, index) => (\n            <PathConstraintEditor\n              key={index}\n              constraint={constraint}\n              onChange={(updated) => updateConstraint(index, updated)}\n              onRemove={() => removeConstraint(index)}\n              schema={schema}\n              availableRefs={allRefs}\n            />\n          ))}\n          <div className=\"relative\">\n            <button\n              onClick={() => setShowConstraintMenu(!showConstraintMenu)}\n              className=\"button button-add-constraint\"\n            >\n              + Add Constraint\n            </button>\n            {showConstraintMenu && (\n              <div className=\"dropdown-menu\">\n                {PATH_CONSTRAINT_TYPES.map(({ value, label }) => (\n                  <div\n                    key={value}\n                    onClick={() => addConstraint(value)}\n                    className=\"dropdown-menu-item\"\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    {label}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ assert, onChange, schema, availableRefs }", "type": "{ assert: any; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "PathStepEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "PathConstraintEditor", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/index.js::SelectionFilterCard", "name": "SelectionFilterCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.filter - The filter configuration\n * @param {Function} props.onChange - Callback when filter changes\n * @param {Function} props.onRemove - Callback to remove this filter\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFilterCard({ filter, onChange, onRemove, schema, availableRefs }) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = FILTER_TYPES[filter.type] || {\n    label: filter.type,\n    icon: \"\u2753\",\n    color: \"#6b7280\",\n  };\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateFilter = (field, value) => {\n    onChange({ ...filter, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (filter.type) {\n      case \"has_tag\": {\n        const valueSuffix = filter.value !== undefined ? ` = ${filter.value}` : \"\";\n        return `${filter.tag || \"?\"}${valueSuffix}`;\n      }\n      case \"has_tags\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"lacks_tag\":\n        return filter.tag || \"tag?\";\n      case \"lacks_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_culture\":\n        return filter.culture || \"culture?\";\n      case \"matches_culture\":\n        return `with ${filter.with || \"?\"}`;\n      case \"has_status\":\n        return filter.status || \"status?\";\n      case \"has_prominence\":\n        return filter.minProminence || \"prominence?\";\n      case \"has_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        const direction = filter.direction ? ` [${filter.direction}]` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}${direction}`;\n      }\n      case \"lacks_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}`;\n      }\n      case \"exclude\":\n        return `${(filter.entities || []).length} excluded`;\n      case \"shares_related\":\n        return `${filter.relationshipKind || \"?\"} with ${filter.with || \"?\"}`;\n      case \"graph_path\":\n        return `graph path (${filter.assert?.check || \"exists\"})`;\n      default:\n        return \"\";\n    }\n  };\n\n  const summary = getSummary();\n\n  const renderFilterFields = () => {\n    switch (filter.type) {\n      case \"has_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"has_tags\":\n      case \"has_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">\n              {filter.type === \"has_tags\" ? \"Tags (must have ALL)\" : \"Tags (must have at least ONE)\"}\n            </label>\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n          </div>\n        );\n\n      case \"lacks_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"lacks_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">Tags (exclude if has ANY)\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n        );\n\n\n      case \"has_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Culture\n            <ReferenceDropdown\n              value={filter.culture || \"\"}\n              onChange={(v) => updateFilter(\"culture\", v)}\n              options={(schema?.cultures || []).map((c) => ({\n                value: c.id,\n                label: c.name || c.id,\n              }))}\n              placeholder=\"Select culture...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"matches_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Same Culture As\n            <ReferenceDropdown\n              value={filter.with || \"\"}\n              onChange={(v) => updateFilter(\"with\", v)}\n              options={refOptions}\n              placeholder=\"Select variable...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_status\":\n        return (\n          <div>\n            <label htmlFor=\"status\" className=\"label label-small\">Status</label>\n            <input id=\"status\"\n              type=\"text\"\n              value={filter.status || \"\"}\n              onChange={(e) => updateFilter(\"status\", e.target.value)}\n              className=\"input input-compact\"\n              placeholder=\"e.g., active, historical\"\n            />\n          </div>\n        );\n\n      case \"has_prominence\":\n        return (\n          <div>\n            <label className=\"label label-small\">Minimum Prominence\n            <ReferenceDropdown\n              value={filter.minProminence || \"\"}\n              onChange={(v) => updateFilter(\"minProminence\", v)}\n              options={PROMINENCE_LEVELS.map((p) => ({ value: p.value, label: p.label }))}\n              placeholder=\"Select prominence...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Relationship Kind\n              <ReferenceDropdown\n                value={filter.kind || \"\"}\n                onChange={(v) => updateFilter(\"kind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity (optional)\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v || undefined)}\n                options={refOptions}\n                placeholder=\"Any entity\"\n              />\n              </label>\n            </div>\n            {filter.type === \"has_relationship\" && (\n              <div className=\"sfc-flex-field-tiny\">\n                <label className=\"label label-small\">Direction\n                <ReferenceDropdown\n                  value={filter.direction || \"both\"}\n                  onChange={(v) => updateFilter(\"direction\", v)}\n                  options={[\n                    { value: \"both\", label: \"Both\" },\n                    { value: \"src\", label: \"Outgoing\" },\n                    { value: \"dst\", label: \"Incoming\" },\n                  ]}\n                />\n                </label>\n              </div>\n            )}\n          </div>\n        );\n\n      case \"exclude\":\n        return (\n          <ChipSelect\n            label=\"Entities to Exclude\"\n            value={filter.entities || []}\n            onChange={(v) => updateFilter(\"entities\", v)}\n            options={refOptions}\n            placeholder=\"+ Add variable...\"\n          />\n        );\n\n      case \"shares_related\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Via Relationship\n              <ReferenceDropdown\n                value={filter.relationshipKind || \"\"}\n                onChange={(v) => updateFilter(\"relationshipKind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v)}\n                options={refOptions}\n                placeholder=\"Select variable...\"\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      case \"graph_path\":\n// ... (truncated)", "parameters": [{"name": "{ filter, onChange, onRemove, schema, availableRefs }", "type": "{ filter: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/index.js::SelectionFiltersEditor", "name": "SelectionFiltersEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.filters - Array of filter configurations\n * @param {Function} props.onChange - Callback when filters change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFiltersEditor({ filters, onChange, schema, availableRefs }) {\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const containerRef = useRef(null);\n\n  // Calculate dropdown position when opening (like TagSelector)\n  useLayoutEffect(() => {\n    if (showTypeMenu && containerRef.current) {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  const handleAddFilter = (type) => {\n    // Create with empty required fields - validation will flag them\n    const newFilter = { type };\n    // Tag filters\n    if (type === \"has_tag\") newFilter.tag = \"\";\n    if (type === \"has_tags\") newFilter.tags = [];\n    if (type === \"has_any_tag\") newFilter.tags = [];\n    if (type === \"lacks_tag\") newFilter.tag = \"\";\n    if (type === \"lacks_any_tag\") newFilter.tags = [];\n    // Attribute filters\n    if (type === \"has_culture\") newFilter.culture = \"\";\n    if (type === \"matches_culture\") newFilter.with = \"\";\n    if (type === \"has_status\") newFilter.status = \"\";\n    if (type === \"has_prominence\") newFilter.minProminence = \"\";\n    // Relationship filters\n    if (type === \"has_relationship\") newFilter.kind = \"\";\n    if (type === \"lacks_relationship\") newFilter.kind = \"\";\n    if (type === \"shares_related\") {\n      newFilter.relationshipKind = \"\";\n      newFilter.with = \"\";\n    }\n    // Other\n    if (type === \"exclude\") newFilter.entities = [];\n    if (type === \"graph_path\")\n      newFilter.assert = {\n        check: \"\",\n        path: [{ via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" }],\n      };\n    onChange([...(filters || []), newFilter]);\n    setShowTypeMenu(false);\n  };\n\n  const handleUpdateFilter = (index, updated) => {\n    const newFilters = [...(filters || [])];\n    newFilters[index] = updated;\n    onChange(newFilters);\n  };\n\n  const handleRemoveFilter = (index) => {\n    onChange((filters || []).filter((_, i) => i !== index));\n  };\n\n  return (\n    <div>\n      {(filters || []).length === 0 ? (\n        <div className=\"empty-state-compact\">\n          No filters defined. Filters narrow down which entities can be selected as targets.\n        </div>\n      ) : (\n        <div className=\"condition-list\">\n          {(filters || []).map((filter, index) => (\n            <SelectionFilterCard\n              key={index}\n              filter={filter}\n              onChange={(updated) => handleUpdateFilter(index, updated)}\n              onRemove={() => handleRemoveFilter(index)}\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))}\n        </div>\n      )}\n\n      <div ref={containerRef} className=\"relative mt-lg\">\n        <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n          + Add Filter\n        </button>\n\n        {showTypeMenu && (\n          <div\n            className=\"dropdown-menu sfe-dropdown-fixed\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n            style={{ '--sfe-dd-top': `${dropdownPos.top}px`, '--sfe-dd-left': `${dropdownPos.left}px`, '--sfe-dd-width': `${dropdownPos.width}px`, top: 'var(--sfe-dd-top)', left: 'var(--sfe-dd-left)', width: 'var(--sfe-dd-width)' }}\n          >\n            {Object.entries(FILTER_TYPES).map(([type, config]) => (\n              <div key={type} onClick={() => handleAddFilter(type)} className=\"dropdown-menu-item\" role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n                <span\n                  className=\"dropdown-menu-icon\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per filter type\n                  style={{ '--sfe-icon-bg': `${config.color}20`, backgroundColor: 'var(--sfe-icon-bg)' }}\n                >\n                  {config.icon}\n                </span>\n                <span className=\"dropdown-menu-label\">{config.label}</span>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ filters, onChange, schema, availableRefs }", "type": "{ filters: any[]; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "SelectionFilterCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/PathConstraintEditor.jsx::PathConstraintEditor", "name": "PathConstraintEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/PathConstraintEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.constraint - The path constraint configuration\n * @param {Function} props.onChange - Callback when constraint changes\n * @param {Function} props.onRemove - Callback to remove this constraint\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function PathConstraintEditor({ constraint, onChange, onRemove, schema, availableRefs }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  // Gather all subtypes from all entity kinds for subtype_equals constraint\n  const allSubtypeOptions = entityKinds.flatMap((ek) =>\n    (ek.subtypes || []).map((st) => ({\n      value: st.id,\n      label: `${st.name || st.id} (${ek.kind})`,\n    }))\n  );\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateConstraint = (field, value) => {\n    onChange({ ...constraint, [field]: value || undefined });\n  };\n\n  const renderConstraintFields = () => {\n    switch (constraint.type) {\n      case \"not_self\":\n        return <span className=\"text-muted text-small\">Target cannot be the starting entity</span>;\n\n      case \"not_in\":\n      case \"in\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Set Variable\n            <ReferenceDropdown\n              value={constraint.set || \"\"}\n              onChange={(v) => updateConstraint(\"set\", v)}\n              options={refOptions}\n              placeholder=\"e.g. $allies\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"kind_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Entity Kind\n            <ReferenceDropdown\n              value={constraint.kind || \"\"}\n              onChange={(v) => updateConstraint(\"kind\", v)}\n              options={entityKindOptions}\n            />\n            </label>\n          </div>\n        );\n\n      case \"subtype_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Subtype\n            <ReferenceDropdown\n              value={constraint.subtype || \"\"}\n              onChange={(v) => updateConstraint(\"subtype\", v)}\n              options={allSubtypeOptions}\n              placeholder=\"Select subtype...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"constraint-fields-grid\">\n            <div>\n              <label className=\"label label-micro\">Kind\n              <ReferenceDropdown\n                value={constraint.kind || \"\"}\n                onChange={(v) => updateConstraint(\"kind\", v)}\n                options={relationshipKindOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">With\n              <ReferenceDropdown\n                value={constraint.with || \"\"}\n                onChange={(v) => updateConstraint(\"with\", v)}\n                options={refOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">Direction\n              <ReferenceDropdown\n                value={constraint.direction || \"any\"}\n                onChange={(v) => updateConstraint(\"direction\", v)}\n                options={PATH_DIRECTIONS}\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  const constraintLabel =\n    PATH_CONSTRAINT_TYPES.find((c) => c.value === constraint.type)?.label || constraint.type;\n\n  return (\n    <div className=\"path-constraint-card\">\n      <div className=\"path-constraint-header\">\n        <span className=\"path-constraint-label\">{constraintLabel}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      {renderConstraintFields()}\n    </div>\n  );\n}", "parameters": [{"name": "{ constraint, onChange, onRemove, schema, availableRefs }", "type": "{ constraint: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "span", "children": [], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["PATH_DIRECTIONS", "PATH_CONSTRAINT_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/PathStepEditor.jsx::PathStepEditor", "name": "PathStepEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/PathStepEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.step - The path step configuration\n * @param {Function} props.onChange - Callback when step changes\n * @param {Function} props.onRemove - Callback to remove this step\n * @param {Object} props.schema - Domain schema\n * @param {number} props.stepIndex - Index of this step in the path\n */\nexport function PathStepEditor({ step, onChange, onRemove, schema, stepIndex }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKindOptions = [\n    { value: \"any\", label: \"Any kind\" },\n    ...(schema?.entityKinds || []).map((ek) => ({\n      value: ek.kind,\n      label: ek.description || ek.kind,\n    })),\n  ];\n\n  const getSubtypeOptions = (kind) => {\n    if (!kind || kind === \"any\") return [{ value: \"any\", label: \"Any subtype\" }];\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [{ value: \"any\", label: \"Any subtype\" }];\n    return [\n      { value: \"any\", label: \"Any subtype\" },\n      ...ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id })),\n    ];\n  };\n\n  const updateStep = (field, value) => {\n    onChange({ ...step, [field]: value });\n  };\n\n  return (\n    <div className=\"path-step-card\">\n      <div className=\"path-step-header\">\n        <span className=\"path-step-label\">Step {stepIndex + 1}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      <div className=\"path-step-grid\">\n        <div>\n          <label className=\"label label-micro\">Via Relationship\n          <ReferenceDropdown\n            value={step.via || \"\"}\n            onChange={(v) => updateStep(\"via\", v)}\n            options={relationshipKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Direction\n          <ReferenceDropdown\n            value={step.direction || \"any\"}\n            onChange={(v) => updateStep(\"direction\", v)}\n            options={PATH_DIRECTIONS}\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Kind\n          <ReferenceDropdown\n            value={step.targetKind}\n            onChange={(v) => updateStep(\"targetKind\", v)}\n            options={entityKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Subtype\n          <ReferenceDropdown\n            value={step.targetSubtype}\n            onChange={(v) => updateStep(\"targetSubtype\", v)}\n            options={getSubtypeOptions(step.targetKind)}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div className=\"path-step-full-width\">\n          <label htmlFor=\"store-as-variable-optional\" className=\"label label-micro\">Store As Variable (optional)</label>\n          <input id=\"store-as-variable-optional\"\n            type=\"text\"\n            value={step.as || \"\"}\n            onChange={(e) => updateStep(\"as\", e.target.value)}\n            className=\"input input-micro\"\n            placeholder=\"e.g. $allies\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ step, onChange, onRemove, schema, stepIndex }", "type": "{ step: any; onChange: Function; onRemove: Function; schema: any; stepIndex: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["PATH_DIRECTIONS"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFilterCard.jsx::SelectionFilterCard", "name": "SelectionFilterCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFilterCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.filter - The filter configuration\n * @param {Function} props.onChange - Callback when filter changes\n * @param {Function} props.onRemove - Callback to remove this filter\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFilterCard({ filter, onChange, onRemove, schema, availableRefs }) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = FILTER_TYPES[filter.type] || {\n    label: filter.type,\n    icon: \"\u2753\",\n    color: \"#6b7280\",\n  };\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateFilter = (field, value) => {\n    onChange({ ...filter, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (filter.type) {\n      case \"has_tag\": {\n        const valueSuffix = filter.value !== undefined ? ` = ${filter.value}` : \"\";\n        return `${filter.tag || \"?\"}${valueSuffix}`;\n      }\n      case \"has_tags\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"lacks_tag\":\n        return filter.tag || \"tag?\";\n      case \"lacks_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_culture\":\n        return filter.culture || \"culture?\";\n      case \"matches_culture\":\n        return `with ${filter.with || \"?\"}`;\n      case \"has_status\":\n        return filter.status || \"status?\";\n      case \"has_prominence\":\n        return filter.minProminence || \"prominence?\";\n      case \"has_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        const direction = filter.direction ? ` [${filter.direction}]` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}${direction}`;\n      }\n      case \"lacks_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}`;\n      }\n      case \"exclude\":\n        return `${(filter.entities || []).length} excluded`;\n      case \"shares_related\":\n        return `${filter.relationshipKind || \"?\"} with ${filter.with || \"?\"}`;\n      case \"graph_path\":\n        return `graph path (${filter.assert?.check || \"exists\"})`;\n      default:\n        return \"\";\n    }\n  };\n\n  const summary = getSummary();\n\n  const renderFilterFields = () => {\n    switch (filter.type) {\n      case \"has_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"has_tags\":\n      case \"has_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">\n              {filter.type === \"has_tags\" ? \"Tags (must have ALL)\" : \"Tags (must have at least ONE)\"}\n            </label>\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n          </div>\n        );\n\n      case \"lacks_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"lacks_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">Tags (exclude if has ANY)\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n        );\n\n\n      case \"has_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Culture\n            <ReferenceDropdown\n              value={filter.culture || \"\"}\n              onChange={(v) => updateFilter(\"culture\", v)}\n              options={(schema?.cultures || []).map((c) => ({\n                value: c.id,\n                label: c.name || c.id,\n              }))}\n              placeholder=\"Select culture...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"matches_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Same Culture As\n            <ReferenceDropdown\n              value={filter.with || \"\"}\n              onChange={(v) => updateFilter(\"with\", v)}\n              options={refOptions}\n              placeholder=\"Select variable...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_status\":\n        return (\n          <div>\n            <label htmlFor=\"status\" className=\"label label-small\">Status</label>\n            <input id=\"status\"\n              type=\"text\"\n              value={filter.status || \"\"}\n              onChange={(e) => updateFilter(\"status\", e.target.value)}\n              className=\"input input-compact\"\n              placeholder=\"e.g., active, historical\"\n            />\n          </div>\n        );\n\n      case \"has_prominence\":\n        return (\n          <div>\n            <label className=\"label label-small\">Minimum Prominence\n            <ReferenceDropdown\n              value={filter.minProminence || \"\"}\n              onChange={(v) => updateFilter(\"minProminence\", v)}\n              options={PROMINENCE_LEVELS.map((p) => ({ value: p.value, label: p.label }))}\n              placeholder=\"Select prominence...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Relationship Kind\n              <ReferenceDropdown\n                value={filter.kind || \"\"}\n                onChange={(v) => updateFilter(\"kind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity (optional)\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v || undefined)}\n                options={refOptions}\n                placeholder=\"Any entity\"\n              />\n              </label>\n            </div>\n            {filter.type === \"has_relationship\" && (\n              <div className=\"sfc-flex-field-tiny\">\n                <label className=\"label label-small\">Direction\n                <ReferenceDropdown\n                  value={filter.direction || \"both\"}\n                  onChange={(v) => updateFilter(\"direction\", v)}\n                  options={[\n                    { value: \"both\", label: \"Both\" },\n                    { value: \"src\", label: \"Outgoing\" },\n                    { value: \"dst\", label: \"Incoming\" },\n                  ]}\n                />\n                </label>\n              </div>\n            )}\n          </div>\n        );\n\n      case \"exclude\":\n        return (\n          <ChipSelect\n            label=\"Entities to Exclude\"\n            value={filter.entities || []}\n            onChange={(v) => updateFilter(\"entities\", v)}\n            options={refOptions}\n            placeholder=\"+ Add variable...\"\n          />\n        );\n\n      case \"shares_related\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Via Relationship\n              <ReferenceDropdown\n                value={filter.relationshipKind || \"\"}\n                onChange={(v) => updateFilter(\"relationshipKind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v)}\n                options={refOptions}\n                placeholder=\"Select variable...\"\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      case \"graph_path\":\n// ... (truncated)", "parameters": [{"name": "{ filter, onChange, onRemove, schema, availableRefs }", "type": "{ filter: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["FILTER_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "ChipSelect", "PROMINENCE_LEVELS"], "category": "internal"}, {"source": "./GraphPathEditor", "specifiers": ["GraphPathEditor"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}, {"source": "./SelectionFilterCard.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFiltersEditor.jsx::SelectionFiltersEditor", "name": "SelectionFiltersEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/filters/SelectionFiltersEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.filters - Array of filter configurations\n * @param {Function} props.onChange - Callback when filters change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFiltersEditor({ filters, onChange, schema, availableRefs }) {\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const containerRef = useRef(null);\n\n  // Calculate dropdown position when opening (like TagSelector)\n  useLayoutEffect(() => {\n    if (showTypeMenu && containerRef.current) {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  const handleAddFilter = (type) => {\n    // Create with empty required fields - validation will flag them\n    const newFilter = { type };\n    // Tag filters\n    if (type === \"has_tag\") newFilter.tag = \"\";\n    if (type === \"has_tags\") newFilter.tags = [];\n    if (type === \"has_any_tag\") newFilter.tags = [];\n    if (type === \"lacks_tag\") newFilter.tag = \"\";\n    if (type === \"lacks_any_tag\") newFilter.tags = [];\n    // Attribute filters\n    if (type === \"has_culture\") newFilter.culture = \"\";\n    if (type === \"matches_culture\") newFilter.with = \"\";\n    if (type === \"has_status\") newFilter.status = \"\";\n    if (type === \"has_prominence\") newFilter.minProminence = \"\";\n    // Relationship filters\n    if (type === \"has_relationship\") newFilter.kind = \"\";\n    if (type === \"lacks_relationship\") newFilter.kind = \"\";\n    if (type === \"shares_related\") {\n      newFilter.relationshipKind = \"\";\n      newFilter.with = \"\";\n    }\n    // Other\n    if (type === \"exclude\") newFilter.entities = [];\n    if (type === \"graph_path\")\n      newFilter.assert = {\n        check: \"\",\n        path: [{ via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" }],\n      };\n    onChange([...(filters || []), newFilter]);\n    setShowTypeMenu(false);\n  };\n\n  const handleUpdateFilter = (index, updated) => {\n    const newFilters = [...(filters || [])];\n    newFilters[index] = updated;\n    onChange(newFilters);\n  };\n\n  const handleRemoveFilter = (index) => {\n    onChange((filters || []).filter((_, i) => i !== index));\n  };\n\n  return (\n    <div>\n      {(filters || []).length === 0 ? (\n        <div className=\"empty-state-compact\">\n          No filters defined. Filters narrow down which entities can be selected as targets.\n        </div>\n      ) : (\n        <div className=\"condition-list\">\n          {(filters || []).map((filter, index) => (\n            <SelectionFilterCard\n              key={index}\n              filter={filter}\n              onChange={(updated) => handleUpdateFilter(index, updated)}\n              onRemove={() => handleRemoveFilter(index)}\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))}\n        </div>\n      )}\n\n      <div ref={containerRef} className=\"relative mt-lg\">\n        <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n          + Add Filter\n        </button>\n\n        {showTypeMenu && (\n          <div\n            className=\"dropdown-menu sfe-dropdown-fixed\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n            style={{ '--sfe-dd-top': `${dropdownPos.top}px`, '--sfe-dd-left': `${dropdownPos.left}px`, '--sfe-dd-width': `${dropdownPos.width}px`, top: 'var(--sfe-dd-top)', left: 'var(--sfe-dd-left)', width: 'var(--sfe-dd-width)' }}\n          >\n            {Object.entries(FILTER_TYPES).map(([type, config]) => (\n              <div key={type} onClick={() => handleAddFilter(type)} className=\"dropdown-menu-item\" role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n                <span\n                  className=\"dropdown-menu-icon\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per filter type\n                  style={{ '--sfe-icon-bg': `${config.color}20`, backgroundColor: 'var(--sfe-icon-bg)' }}\n                >\n                  {config.icon}\n                </span>\n                <span className=\"dropdown-menu-label\">{config.label}</span>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ filters, onChange, schema, availableRefs }", "type": "{ filters: any[]; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "SelectionFilterCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useRef", "useLayoutEffect", "useEffect"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["FILTER_TYPES"], "category": "internal"}, {"source": "./SelectionFilterCard", "specifiers": ["SelectionFilterCard"], "category": "internal"}, {"source": "./SelectionFiltersEditor.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx::CreationTab", "name": "CreationTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx", "sourceCode": "// ============================================================================\n// CreationTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.tagRegistry - Available tags\n * @param {Function} props.onAddToRegistry - Callback to add new tag to registry\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function CreationTab({\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}) {\n  const creation = generator.creation || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    creation.forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, creation]);\n\n  const culturesById = useMemo(() => {\n    const map = {};\n    (schema?.cultures || []).forEach((culture) => {\n      map[culture.id] = culture;\n    });\n    return map;\n  }, [schema?.cultures]);\n\n  const cultureIds = useMemo(() => Object.keys(culturesById), [culturesById]);\n\n  const handleAdd = () => {\n    const nextNum = creation.length + 1;\n    onChange({\n      ...generator,\n      creation: [\n        ...creation,\n        { entityRef: `$entity${nextNum}`, kind: \"npc\", prominence: \"marginal\" },\n      ],\n    });\n  };\n\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Entity Creation</div>\n        <div className=\"section-desc\">\n          Define entities that this generator creates. Each entity gets a reference (like{\" \"}\n          <code className=\"inline-code\">$hero</code>) that can be used in relationships.\n        </div>\n\n        {creation.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2728</div>\n            <div className=\"empty-state-title\">No entities created</div>\n            <div className=\"empty-state-desc\">\n              This generator only modifies existing entities. Add creation rules to spawn new\n              entities.\n            </div>\n          </div>\n        ) : (\n          creation.map((item, index) => (\n            <CreationCard\n              key={index}\n              item={item}\n              onChange={(updated) => {\n                const newCreation = [...creation];\n                newCreation[index] = updated;\n                onChange({ ...generator, creation: newCreation });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, creation: creation.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n              culturesById={culturesById}\n              cultureIds={cultureIds}\n              generator={generator}\n              tagRegistry={tagRegistry}\n              onAddToRegistry={onAddToRegistry}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Entity Creation\n        </button>\n      </div>\n\n      <VariantsSection\n        generator={generator}\n        onChange={onChange}\n        pressures={pressures}\n        schema={schema}\n        tagRegistry={tagRegistry}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}", "type": "{ generator: any; onChange: Function; schema: any; tagRegistry: any[]; onAddToRegistry: Function; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "VariantsSection", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 3}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useMemo", "useCallback"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "LevelSelector", "PROMINENCE_LEVELS", "ChipSelect", "NumberInput", "LocalTextArea"], "category": "internal"}, {"source": "./CreationTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/EffectsTab.jsx::EffectsTab", "name": "EffectsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/EffectsTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Object} props.schema - Domain schema\n */\nexport function EffectsTab({ generator, onChange, pressures, schema }) {\n  const stateUpdates = generator.stateUpdates || [];\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const addButtonRef = useRef(null);\n\n  // Build available entity references from target + variables + created entities\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, generator.creation]);\n\n  const createMutation = (type) => {\n    let newUpdate;\n    switch (type) {\n      case \"modify_pressure\":\n        newUpdate = { type: \"modify_pressure\", pressureId: pressures?.[0]?.id || \"\", delta: 0 };\n        break;\n      case \"archive_relationship\":\n        newUpdate = {\n          type: \"archive_relationship\",\n          entity: \"$target\",\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n        break;\n      case \"change_status\":\n        newUpdate = { type: \"change_status\", entity: \"$target\", newStatus: \"\" };\n        break;\n      case \"set_tag\":\n        newUpdate = { type: \"set_tag\", entity: \"$target\", tag: \"\", value: true };\n        break;\n      case \"remove_tag\":\n        newUpdate = { type: \"remove_tag\", entity: \"$target\", tag: \"\" };\n        break;\n      case \"update_rate_limit\":\n        newUpdate = { type: \"update_rate_limit\" };\n        break;\n      default:\n        return null;\n    }\n    return newUpdate;\n  };\n\n  const addMutation = (type) => {\n    const next = createMutation(type);\n    if (!next) return;\n    onChange({ ...generator, stateUpdates: [...stateUpdates, next] });\n  };\n\n  const updateMutation = (index, updated) => {\n    const newUpdates = [...stateUpdates];\n    newUpdates[index] = updated;\n    onChange({ ...generator, stateUpdates: newUpdates });\n  };\n\n  const removeMutation = (index) => {\n    onChange({ ...generator, stateUpdates: stateUpdates.filter((_, i) => i !== index) });\n  };\n\n  const knownTypes = new Set(DEFAULT_MUTATION_TYPES.map((type) => type.value));\n  const unrecognizedUpdates = stateUpdates\n    .map((update, index) => (knownTypes.has(update.type) ? null : { update, index }))\n    .filter(Boolean);\n\n  useLayoutEffect(() => {\n    if (showTypeMenu && addButtonRef.current) {\n      const rect = addButtonRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (event) => {\n      if (addButtonRef.current && !addButtonRef.current.contains(event.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  return (\n    <div>\n      {/* Unrecognized Effects - shown first to draw attention */}\n      {unrecognizedUpdates.length > 0 && (\n        <div className=\"section et-unrecognized-section\">\n          <div className=\"section-title et-unrecognized-title\">\n            <span>\u26a0\ufe0f</span> Unrecognized Effects\n          </div>\n          <div className=\"section-desc mb-lg\">\n            These state updates have unrecognized types and may be from an older version. Remove\n            them to clear validation errors.\n          </div>\n\n          {unrecognizedUpdates.map((entry) => {\n            const globalIdx = entry.index;\n            const update = entry.update;\n            return (\n              <div\n                key={globalIdx}\n                className=\"item-card et-unrecognized-card\"\n              >\n                <div className=\"et-unrecognized-body\">\n                  <div className=\"et-unrecognized-layout\">\n                    <div className=\"flex-1\">\n                      <div className=\"et-unrecognized-type\">\n                        Unknown type: &quot;{update.type || \"(no type)\"}&quot;\n                      </div>\n                      <pre className=\"et-unrecognized-json\">\n                        {JSON.stringify(update, null, 2)}\n                      </pre>\n                    </div>\n                    <button\n                      className=\"btn btn-danger flex-shrink-0\"\n                      onClick={() => removeMutation(globalIdx)}\n                    >\n                      Remove\n                    </button>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u26a1 Effects ({stateUpdates.length})</div>\n        <div className=\"section-desc\">\n          Apply state updates when this generator runs. Effects use the unified mutation library.\n        </div>\n\n        {stateUpdates.map((update, index) => {\n          if (!knownTypes.has(update.type)) return null;\n          return (\n            <MutationCard\n              key={index}\n              mutation={update}\n              onChange={(updated) => updateMutation(index, updated)}\n              onRemove={() => removeMutation(index)}\n              schema={schema}\n              pressures={pressures}\n              entityOptions={availableRefs}\n              typeOptions={DEFAULT_MUTATION_TYPES}\n              createMutation={createMutation}\n            />\n          );\n        })}\n\n        <div ref={addButtonRef} className=\"relative mt-lg\">\n          <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n            + Add Effect\n          </button>\n\n          {showTypeMenu && (\n            <div\n              className=\"dropdown-menu et-dropdown-fixed\"\n              // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n              style={{ '--et-dd-top': `${dropdownPos.top}px`, '--et-dd-left': `${dropdownPos.left}px`, '--et-dd-width': `${dropdownPos.width}px`, top: 'var(--et-dd-top)', left: 'var(--et-dd-left)', width: 'var(--et-dd-width)' }}\n            >\n              {MUTATION_TYPE_OPTIONS.map((opt) => (\n                <div\n                  key={opt.value}\n                  onClick={() => {\n                    addMutation(opt.value);\n                    setShowTypeMenu(false);\n                  }}\n                  className=\"dropdown-menu-item\"\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <span\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per mutation type\n                    style={{ '--et-icon-bg': `${opt.color}20`, backgroundColor: 'var(--et-icon-bg)' }}\n                  >\n                    {opt.icon}\n                  </span>\n                  <span className=\"dropdown-menu-label\">{opt.label}</span>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, pressures, schema }", "type": "{ generator: any; onChange: Function; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "pre", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "MutationCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useMemo", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useEffect", "useLayoutEffect", "useMemo", "useRef", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared/MutationCard", "specifiers": ["MutationCard", "DEFAULT_MUTATION_TYPES"], "category": "internal"}, {"source": "../../actions/constants", "specifiers": ["MUTATION_TYPE_OPTIONS"], "category": "internal"}, {"source": "./EffectsTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Function} props.onDelete - Callback to delete the generator\n * @param {Function} props.onDuplicate - Callback to duplicate the generator\n */\nexport function OverviewTab({ generator, onChange, onDelete, onDuplicate }) {\n  const updateField = (field, value) => {\n    onChange({ ...generator, [field]: value });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(generator.id, (value) =>\n    updateField(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(generator.name, (value) =>\n    updateField(\"name\", value)\n  );\n\n  const summary = useMemo(() => {\n    return {\n      rules: generator.applicability?.length || 0,\n      variables: Object.keys(generator.variables || {}).length,\n      creates: generator.creation?.length || 0,\n      relationships: generator.relationships?.length || 0,\n      effects: generator.stateUpdates?.length || 0,\n    };\n  }, [generator]);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"generator-id\" className=\"label\">Generator ID</label>\n            <input id=\"generator-id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"display-name\" className=\"label\">Display Name</label>\n            <input id=\"display-name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n              placeholder=\"Optional friendly name\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Enabled\n          <EnableToggle\n            enabled={generator.enabled !== false}\n            onChange={(enabled) => updateField(\"enabled\", enabled)}\n            label={generator.enabled !== false ? \"Generator is active\" : \"Generator is disabled\"}\n          />\n          </label>\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">Narration Template</span>\n          <div className=\"section-desc mb-md\">\n            Syntax: {\"{$target.field}\"}, {\"{$var.field}\"}, {\"{count:kind}\"}, {\"{list:created}\"},{\" \"}\n            {\"{field|fallback}\"}.\n          </div>\n          <LocalTextArea\n            value={generator.narrationTemplate || \"\"}\n            onChange={(value) => updateField(\"narrationTemplate\", value || undefined)}\n            placeholder=\"e.g., From {$target.name}, {count:npc} new souls emerged to shape the realm.\"\n            rows={2}\n          />\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Summary</div>\n        <div className=\"summary-stats-grid\">\n          {[\n            { label: \"Rules\", value: summary.rules, icon: \"\u2713\" },\n            { label: \"Variables\", value: summary.variables, icon: \"\ud83d\udce6\" },\n            { label: \"Creates\", value: summary.creates, icon: \"\u2728\" },\n            { label: \"Connects\", value: summary.relationships, icon: \"\ud83d\udd17\" },\n            { label: \"Effects\", value: summary.effects, icon: \"\u26a1\" },\n          ].map((stat) => (\n            <div key={stat.label} className=\"summary-stat\">\n              <div className=\"summary-stat-icon\">{stat.icon}</div>\n              <div className=\"summary-stat-value\">{stat.value}</div>\n              <div className=\"summary-stat-label\">{stat.label}</div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"danger-zone\">\n        <button className=\"btn btn-secondary\" onClick={onDuplicate}>\n          Duplicate Generator\n        </button>\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete Generator\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, onDelete, onDuplicate }", "type": "{ generator: any; onChange: Function; onDelete: Function; onDuplicate: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useLocalInputState", "count": 2}, {"name": "useMemo", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::TargetTab", "name": "TargetTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema with entity/relationship kinds\n */\nexport function TargetTab({ generator, onChange, schema }) {\n  const selection = generator.selection || { strategy: \"by_kind\" };\n\n  // Get the kind of the first created entity for saturation limit inference\n  const firstCreatedKind = (generator.creation || [])[0]?.kind;\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Target Selection</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What is $target?</div>\n          <div className=\"info-box-text\">\n            The <code className=\"inline-code\">$target</code> is the primary entity this generator\n            operates on. It&apos;s selected from the world graph based on the rules you define here. Once\n            selected, you can reference it in creation rules (e.g., inherit culture from $target)\n            and relationships (e.g., connect new entity to $target).\n          </div>\n        </div>\n\n        <SelectionRuleEditor\n          value={selection}\n          onChange={(updated) => onChange({ ...generator, selection: updated })}\n          schema={schema}\n          availableRefs={[\"$target\", ...Object.keys(generator.variables || {})]}\n        />\n\n        {/* Saturation Limits */}\n        <div className=\"mt-2xl\">\n          <span className=\"label\">Saturation Limits</span>\n          <div className=\"info-box-text mb-lg text-sm\">\n            Limit targets based on existing relationship counts. Only targets with fewer than the\n            max count of relationships will be selected.\n          </div>\n          <SaturationLimitsEditor\n            limits={selection.saturationLimits || []}\n            onChange={(limits) =>\n              onChange({\n                ...generator,\n                selection: {\n                  ...selection,\n                  saturationLimits: limits.length > 0 ? limits : undefined,\n                },\n              })\n            }\n            schema={schema}\n            createdKind={firstCreatedKind}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "SelectionRuleEditor", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SaturationLimitsEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::VariablesTab", "name": "VariablesTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "// ============================================================================\n// VariablesTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n */\nexport function VariablesTab({ generator, onChange, schema }) {\n  const variables = generator.variables || {};\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  // Build available refs for relationship queries (target + other vars + creation refs)\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$target\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    // Ensure the name starts with $\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    // Create with empty required fields - validation will flag them\n    onChange({\n      ...generator,\n      variables: {\n        ...variables,\n        [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"\" } },\n      },\n    });\n    setNewVarName(\"\");\n    setShowAddForm(false);\n  };\n\n  const varEntries = Object.entries(variables);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Variables</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What are variables?</div>\n          <div className=\"info-box-text\">\n            Variables let you select additional entities from the graph to use in creation and\n            relationships. For example, you might select a{\" \"}\n            <code className=\"inline-code\">$faction</code> to make a new NPC a member of, or an{\" \"}\n            <code className=\"inline-code\">$ability</code> for them to practice. Variables are\n            selected after <code className=\"inline-code\">$target</code> is chosen.\n          </div>\n        </div>\n\n        {varEntries.length === 0 && !showAddForm ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udce6</div>\n            <div className=\"empty-state-title\">No variables defined</div>\n            <div className=\"empty-state-desc\">\n              Add variables to select additional entities for use in creation and relationships.\n            </div>\n          </div>\n        ) : (\n          varEntries.map(([name, config]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={config}\n              onChange={(updated) =>\n                onChange({ ...generator, variables: { ...variables, [name]: updated } })\n              }\n              onRemove={() => {\n                const newVars = { ...variables };\n                delete newVars[name];\n                onChange({ ...generator, variables: newVars });\n              }}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::CreationTab", "name": "CreationTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "// ============================================================================\n// CreationTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.tagRegistry - Available tags\n * @param {Function} props.onAddToRegistry - Callback to add new tag to registry\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function CreationTab({\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}) {\n  const creation = generator.creation || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    creation.forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, creation]);\n\n  const culturesById = useMemo(() => {\n    const map = {};\n    (schema?.cultures || []).forEach((culture) => {\n      map[culture.id] = culture;\n    });\n    return map;\n  }, [schema?.cultures]);\n\n  const cultureIds = useMemo(() => Object.keys(culturesById), [culturesById]);\n\n  const handleAdd = () => {\n    const nextNum = creation.length + 1;\n    onChange({\n      ...generator,\n      creation: [\n        ...creation,\n        { entityRef: `$entity${nextNum}`, kind: \"npc\", prominence: \"marginal\" },\n      ],\n    });\n  };\n\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Entity Creation</div>\n        <div className=\"section-desc\">\n          Define entities that this generator creates. Each entity gets a reference (like{\" \"}\n          <code className=\"inline-code\">$hero</code>) that can be used in relationships.\n        </div>\n\n        {creation.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2728</div>\n            <div className=\"empty-state-title\">No entities created</div>\n            <div className=\"empty-state-desc\">\n              This generator only modifies existing entities. Add creation rules to spawn new\n              entities.\n            </div>\n          </div>\n        ) : (\n          creation.map((item, index) => (\n            <CreationCard\n              key={index}\n              item={item}\n              onChange={(updated) => {\n                const newCreation = [...creation];\n                newCreation[index] = updated;\n                onChange({ ...generator, creation: newCreation });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, creation: creation.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n              culturesById={culturesById}\n              cultureIds={cultureIds}\n              generator={generator}\n              tagRegistry={tagRegistry}\n              onAddToRegistry={onAddToRegistry}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Entity Creation\n        </button>\n      </div>\n\n      <VariantsSection\n        generator={generator}\n        onChange={onChange}\n        pressures={pressures}\n        schema={schema}\n        tagRegistry={tagRegistry}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}", "type": "{ generator: any; onChange: Function; schema: any; tagRegistry: any[]; onAddToRegistry: Function; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "VariantsSection", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 3}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::RelationshipsTab", "name": "RelationshipsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n */\nexport function RelationshipsTab({ generator, onChange, schema }) {\n  const relationships = generator.relationships || [];\n  const saturationLimits = generator.selection?.saturationLimits || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, generator.creation]);\n\n  // Find the first created entity ref for implied relationships\n  const firstCreatedRef = useMemo(() => {\n    const creation = generator.creation || [];\n    return creation.length > 0 ? creation[0].entityRef : \"$created\";\n  }, [generator.creation]);\n\n  const handleAdd = () => {\n    onChange({\n      ...generator,\n      relationships: [\n        ...relationships,\n        {\n          kind: schema?.relationshipKinds?.[0]?.kind || \"ally_of\",\n          src: availableRefs[1] || \"$entity1\",\n          dst: \"$target\",\n          strength: 0.8,\n        },\n      ],\n    });\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Relationships</div>\n        <div className=\"section-desc\">\n          Define relationships created between entities. Use entity references like{\" \"}\n          <code className=\"inline-code\">$target</code>, created entities like{\" \"}\n          <code className=\"inline-code\">$hero</code>, or variables like{\" \"}\n          <code className=\"inline-code\">$faction</code>.\n        </div>\n\n        {/* Implied relationships from saturation limits */}\n        {saturationLimits.length > 0 && (\n          <div className=\"mb-xl\">\n            {saturationLimits.map((limit, index) => (\n              <ImpliedRelationshipCard\n                key={`implied-${index}`}\n                saturationLimit={limit}\n                schema={schema}\n                createdEntityRef={firstCreatedRef}\n              />\n            ))}\n          </div>\n        )}\n\n        {relationships.length === 0 && saturationLimits.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udd17</div>\n            <div className=\"empty-state-title\">No relationships</div>\n            <div className=\"empty-state-desc\">\n              This generator doesn&apos;t create any relationships. Add relationships to connect\n              entities.\n            </div>\n          </div>\n        ) : (\n          relationships.map((rel, index) => (\n            <RelationshipCard\n              key={index}\n              rel={rel}\n              onChange={(updated) => {\n                const newRels = [...relationships];\n                newRels[index] = updated;\n                onChange({ ...generator, relationships: newRels });\n              }}\n              onRemove={() =>\n                onChange({\n                  ...generator,\n                  relationships: relationships.filter((_, i) => i !== index),\n                })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Relationship\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ImpliedRelationshipCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::EffectsTab", "name": "EffectsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Object} props.schema - Domain schema\n */\nexport function EffectsTab({ generator, onChange, pressures, schema }) {\n  const stateUpdates = generator.stateUpdates || [];\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const addButtonRef = useRef(null);\n\n  // Build available entity references from target + variables + created entities\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, generator.creation]);\n\n  const createMutation = (type) => {\n    let newUpdate;\n    switch (type) {\n      case \"modify_pressure\":\n        newUpdate = { type: \"modify_pressure\", pressureId: pressures?.[0]?.id || \"\", delta: 0 };\n        break;\n      case \"archive_relationship\":\n        newUpdate = {\n          type: \"archive_relationship\",\n          entity: \"$target\",\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n        break;\n      case \"change_status\":\n        newUpdate = { type: \"change_status\", entity: \"$target\", newStatus: \"\" };\n        break;\n      case \"set_tag\":\n        newUpdate = { type: \"set_tag\", entity: \"$target\", tag: \"\", value: true };\n        break;\n      case \"remove_tag\":\n        newUpdate = { type: \"remove_tag\", entity: \"$target\", tag: \"\" };\n        break;\n      case \"update_rate_limit\":\n        newUpdate = { type: \"update_rate_limit\" };\n        break;\n      default:\n        return null;\n    }\n    return newUpdate;\n  };\n\n  const addMutation = (type) => {\n    const next = createMutation(type);\n    if (!next) return;\n    onChange({ ...generator, stateUpdates: [...stateUpdates, next] });\n  };\n\n  const updateMutation = (index, updated) => {\n    const newUpdates = [...stateUpdates];\n    newUpdates[index] = updated;\n    onChange({ ...generator, stateUpdates: newUpdates });\n  };\n\n  const removeMutation = (index) => {\n    onChange({ ...generator, stateUpdates: stateUpdates.filter((_, i) => i !== index) });\n  };\n\n  const knownTypes = new Set(DEFAULT_MUTATION_TYPES.map((type) => type.value));\n  const unrecognizedUpdates = stateUpdates\n    .map((update, index) => (knownTypes.has(update.type) ? null : { update, index }))\n    .filter(Boolean);\n\n  useLayoutEffect(() => {\n    if (showTypeMenu && addButtonRef.current) {\n      const rect = addButtonRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (event) => {\n      if (addButtonRef.current && !addButtonRef.current.contains(event.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  return (\n    <div>\n      {/* Unrecognized Effects - shown first to draw attention */}\n      {unrecognizedUpdates.length > 0 && (\n        <div className=\"section et-unrecognized-section\">\n          <div className=\"section-title et-unrecognized-title\">\n            <span>\u26a0\ufe0f</span> Unrecognized Effects\n          </div>\n          <div className=\"section-desc mb-lg\">\n            These state updates have unrecognized types and may be from an older version. Remove\n            them to clear validation errors.\n          </div>\n\n          {unrecognizedUpdates.map((entry) => {\n            const globalIdx = entry.index;\n            const update = entry.update;\n            return (\n              <div\n                key={globalIdx}\n                className=\"item-card et-unrecognized-card\"\n              >\n                <div className=\"et-unrecognized-body\">\n                  <div className=\"et-unrecognized-layout\">\n                    <div className=\"flex-1\">\n                      <div className=\"et-unrecognized-type\">\n                        Unknown type: &quot;{update.type || \"(no type)\"}&quot;\n                      </div>\n                      <pre className=\"et-unrecognized-json\">\n                        {JSON.stringify(update, null, 2)}\n                      </pre>\n                    </div>\n                    <button\n                      className=\"btn btn-danger flex-shrink-0\"\n                      onClick={() => removeMutation(globalIdx)}\n                    >\n                      Remove\n                    </button>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u26a1 Effects ({stateUpdates.length})</div>\n        <div className=\"section-desc\">\n          Apply state updates when this generator runs. Effects use the unified mutation library.\n        </div>\n\n        {stateUpdates.map((update, index) => {\n          if (!knownTypes.has(update.type)) return null;\n          return (\n            <MutationCard\n              key={index}\n              mutation={update}\n              onChange={(updated) => updateMutation(index, updated)}\n              onRemove={() => removeMutation(index)}\n              schema={schema}\n              pressures={pressures}\n              entityOptions={availableRefs}\n              typeOptions={DEFAULT_MUTATION_TYPES}\n              createMutation={createMutation}\n            />\n          );\n        })}\n\n        <div ref={addButtonRef} className=\"relative mt-lg\">\n          <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n            + Add Effect\n          </button>\n\n          {showTypeMenu && (\n            <div\n              className=\"dropdown-menu et-dropdown-fixed\"\n              // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n              style={{ '--et-dd-top': `${dropdownPos.top}px`, '--et-dd-left': `${dropdownPos.left}px`, '--et-dd-width': `${dropdownPos.width}px`, top: 'var(--et-dd-top)', left: 'var(--et-dd-left)', width: 'var(--et-dd-width)' }}\n            >\n              {MUTATION_TYPE_OPTIONS.map((opt) => (\n                <div\n                  key={opt.value}\n                  onClick={() => {\n                    addMutation(opt.value);\n                    setShowTypeMenu(false);\n                  }}\n                  className=\"dropdown-menu-item\"\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <span\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per mutation type\n                    style={{ '--et-icon-bg': `${opt.color}20`, backgroundColor: 'var(--et-icon-bg)' }}\n                  >\n                    {opt.icon}\n                  </span>\n                  <span className=\"dropdown-menu-label\">{opt.label}</span>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, pressures, schema }", "type": "{ generator: any; onChange: Function; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "pre", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "MutationCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useMemo", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/index.js::ApplicabilityTab", "name": "ApplicabilityTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n */\nexport function ApplicabilityTab({ generator, onChange, schema, pressures, eras }) {\n  const rules = generator.applicability || [];\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Applicability Rules</div>\n        <div className=\"section-desc\">\n          Define when this generator is eligible to run. If no rules are defined, the generator will\n          always be eligible. Multiple top-level rules are combined with AND logic.\n        </div>\n\n        {rules.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2713</div>\n            <div className=\"empty-state-title\">No applicability rules</div>\n            <div className=\"empty-state-desc\">\n              This generator will always be eligible to run. Add rules to control when it activates.\n            </div>\n          </div>\n        ) : (\n          rules.map((rule, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={rule}\n              onChange={(updated) => {\n                const newRules = [...rules];\n                newRules[index] = updated;\n                onChange({ ...generator, applicability: newRules });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, applicability: rules.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              pressures={pressures}\n              eras={eras}\n            />\n          ))\n        )}\n\n        <AddRuleButton\n          onAdd={(type) => {\n            const newRule = createNewRule(type, pressures);\n            onChange({ ...generator, applicability: [...rules, newRule] });\n          }}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema, pressures, eras }", "type": "{ generator: any; onChange: Function; schema: any; pressures: any[]; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Function} props.onDelete - Callback to delete the generator\n * @param {Function} props.onDuplicate - Callback to duplicate the generator\n */\nexport function OverviewTab({ generator, onChange, onDelete, onDuplicate }) {\n  const updateField = (field, value) => {\n    onChange({ ...generator, [field]: value });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(generator.id, (value) =>\n    updateField(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(generator.name, (value) =>\n    updateField(\"name\", value)\n  );\n\n  const summary = useMemo(() => {\n    return {\n      rules: generator.applicability?.length || 0,\n      variables: Object.keys(generator.variables || {}).length,\n      creates: generator.creation?.length || 0,\n      relationships: generator.relationships?.length || 0,\n      effects: generator.stateUpdates?.length || 0,\n    };\n  }, [generator]);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"generator-id\" className=\"label\">Generator ID</label>\n            <input id=\"generator-id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"display-name\" className=\"label\">Display Name</label>\n            <input id=\"display-name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n              placeholder=\"Optional friendly name\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Enabled\n          <EnableToggle\n            enabled={generator.enabled !== false}\n            onChange={(enabled) => updateField(\"enabled\", enabled)}\n            label={generator.enabled !== false ? \"Generator is active\" : \"Generator is disabled\"}\n          />\n          </label>\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">Narration Template</span>\n          <div className=\"section-desc mb-md\">\n            Syntax: {\"{$target.field}\"}, {\"{$var.field}\"}, {\"{count:kind}\"}, {\"{list:created}\"},{\" \"}\n            {\"{field|fallback}\"}.\n          </div>\n          <LocalTextArea\n            value={generator.narrationTemplate || \"\"}\n            onChange={(value) => updateField(\"narrationTemplate\", value || undefined)}\n            placeholder=\"e.g., From {$target.name}, {count:npc} new souls emerged to shape the realm.\"\n            rows={2}\n          />\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Summary</div>\n        <div className=\"summary-stats-grid\">\n          {[\n            { label: \"Rules\", value: summary.rules, icon: \"\u2713\" },\n            { label: \"Variables\", value: summary.variables, icon: \"\ud83d\udce6\" },\n            { label: \"Creates\", value: summary.creates, icon: \"\u2728\" },\n            { label: \"Connects\", value: summary.relationships, icon: \"\ud83d\udd17\" },\n            { label: \"Effects\", value: summary.effects, icon: \"\u26a1\" },\n          ].map((stat) => (\n            <div key={stat.label} className=\"summary-stat\">\n              <div className=\"summary-stat-icon\">{stat.icon}</div>\n              <div className=\"summary-stat-value\">{stat.value}</div>\n              <div className=\"summary-stat-label\">{stat.label}</div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"danger-zone\">\n        <button className=\"btn btn-secondary\" onClick={onDuplicate}>\n          Duplicate Generator\n        </button>\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete Generator\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, onDelete, onDuplicate }", "type": "{ generator: any; onChange: Function; onDelete: Function; onDuplicate: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useLocalInputState", "count": 2}, {"name": "useMemo", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["EnableToggle", "useLocalInputState", "LocalTextArea"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/RelationshipsTab.jsx::RelationshipsTab", "name": "RelationshipsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/RelationshipsTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n */\nexport function RelationshipsTab({ generator, onChange, schema }) {\n  const relationships = generator.relationships || [];\n  const saturationLimits = generator.selection?.saturationLimits || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, generator.creation]);\n\n  // Find the first created entity ref for implied relationships\n  const firstCreatedRef = useMemo(() => {\n    const creation = generator.creation || [];\n    return creation.length > 0 ? creation[0].entityRef : \"$created\";\n  }, [generator.creation]);\n\n  const handleAdd = () => {\n    onChange({\n      ...generator,\n      relationships: [\n        ...relationships,\n        {\n          kind: schema?.relationshipKinds?.[0]?.kind || \"ally_of\",\n          src: availableRefs[1] || \"$entity1\",\n          dst: \"$target\",\n          strength: 0.8,\n        },\n      ],\n    });\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Relationships</div>\n        <div className=\"section-desc\">\n          Define relationships created between entities. Use entity references like{\" \"}\n          <code className=\"inline-code\">$target</code>, created entities like{\" \"}\n          <code className=\"inline-code\">$hero</code>, or variables like{\" \"}\n          <code className=\"inline-code\">$faction</code>.\n        </div>\n\n        {/* Implied relationships from saturation limits */}\n        {saturationLimits.length > 0 && (\n          <div className=\"mb-xl\">\n            {saturationLimits.map((limit, index) => (\n              <ImpliedRelationshipCard\n                key={`implied-${index}`}\n                saturationLimit={limit}\n                schema={schema}\n                createdEntityRef={firstCreatedRef}\n              />\n            ))}\n          </div>\n        )}\n\n        {relationships.length === 0 && saturationLimits.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udd17</div>\n            <div className=\"empty-state-title\">No relationships</div>\n            <div className=\"empty-state-desc\">\n              This generator doesn&apos;t create any relationships. Add relationships to connect\n              entities.\n            </div>\n          </div>\n        ) : (\n          relationships.map((rel, index) => (\n            <RelationshipCard\n              key={index}\n              rel={rel}\n              onChange={(updated) => {\n                const newRels = [...relationships];\n                newRels[index] = updated;\n                onChange({ ...generator, relationships: newRels });\n              }}\n              onRemove={() =>\n                onChange({\n                  ...generator,\n                  relationships: relationships.filter((_, i) => i !== index),\n                })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Relationship\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ImpliedRelationshipCard", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 2}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput"], "category": "internal"}, {"source": "./RelationshipsTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/TargetTab.jsx::TargetTab", "name": "TargetTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/TargetTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema with entity/relationship kinds\n */\nexport function TargetTab({ generator, onChange, schema }) {\n  const selection = generator.selection || { strategy: \"by_kind\" };\n\n  // Get the kind of the first created entity for saturation limit inference\n  const firstCreatedKind = (generator.creation || [])[0]?.kind;\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Target Selection</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What is $target?</div>\n          <div className=\"info-box-text\">\n            The <code className=\"inline-code\">$target</code> is the primary entity this generator\n            operates on. It&apos;s selected from the world graph based on the rules you define here. Once\n            selected, you can reference it in creation rules (e.g., inherit culture from $target)\n            and relationships (e.g., connect new entity to $target).\n          </div>\n        </div>\n\n        <SelectionRuleEditor\n          value={selection}\n          onChange={(updated) => onChange({ ...generator, selection: updated })}\n          schema={schema}\n          availableRefs={[\"$target\", ...Object.keys(generator.variables || {})]}\n        />\n\n        {/* Saturation Limits */}\n        <div className=\"mt-2xl\">\n          <span className=\"label\">Saturation Limits</span>\n          <div className=\"info-box-text mb-lg text-sm\">\n            Limit targets based on existing relationship counts. Only targets with fewer than the\n            max count of relationships will be selected.\n          </div>\n          <SaturationLimitsEditor\n            limits={selection.saturationLimits || []}\n            onChange={(limits) =>\n              onChange({\n                ...generator,\n                selection: {\n                  ...selection,\n                  saturationLimits: limits.length > 0 ? limits : undefined,\n                },\n              })\n            }\n            schema={schema}\n            createdKind={firstCreatedKind}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "SelectionRuleEditor", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SaturationLimitsEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput"], "category": "internal"}, {"source": "../../shared/SelectionRuleEditor", "specifiers": ["SelectionRuleEditor"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/generators/tabs/VariablesTab.jsx::VariablesTab", "name": "VariablesTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/tabs/VariablesTab.jsx", "sourceCode": "// ============================================================================\n// VariablesTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n */\nexport function VariablesTab({ generator, onChange, schema }) {\n  const variables = generator.variables || {};\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  // Build available refs for relationship queries (target + other vars + creation refs)\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$target\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    // Ensure the name starts with $\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    // Create with empty required fields - validation will flag them\n    onChange({\n      ...generator,\n      variables: {\n        ...variables,\n        [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"\" } },\n      },\n    });\n    setNewVarName(\"\");\n    setShowAddForm(false);\n  };\n\n  const varEntries = Object.entries(variables);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Variables</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What are variables?</div>\n          <div className=\"info-box-text\">\n            Variables let you select additional entities from the graph to use in creation and\n            relationships. For example, you might select a{\" \"}\n            <code className=\"inline-code\">$faction</code> to make a new NPC a member of, or an{\" \"}\n            <code className=\"inline-code\">$ability</code> for them to practice. Variables are\n            selected after <code className=\"inline-code\">$target</code> is chosen.\n          </div>\n        </div>\n\n        {varEntries.length === 0 && !showAddForm ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udce6</div>\n            <div className=\"empty-state-title\">No variables defined</div>\n            <div className=\"empty-state-desc\">\n              Add variables to select additional entities for use in creation and relationships.\n            </div>\n          </div>\n        ) : (\n          varEntries.map(([name, config]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={config}\n              onChange={(updated) =>\n                onChange({ ...generator, variables: { ...variables, [name]: updated } })\n              }\n              onRemove={() => {\n                const newVars = { ...variables };\n                delete newVars[name];\n                onChange({ ...generator, variables: newVars });\n              }}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}, {"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared/VariableSelectionEditor", "specifiers": ["VariableSelectionEditor"], "category": "internal"}, {"source": "./VariablesTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/pressures/cards/FactorCard.jsx::FactorCard", "name": "FactorCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/cards/FactorCard.jsx", "sourceCode": "export function FactorCard({\n  factor,\n  feedbackType,\n  onEdit,\n  onDelete,\n  schema: _schema\n}) {\n  const typeConfig = FACTOR_TYPES[factor.type] || {};\n\n  // Generate summary based on factor type\n  const getSummary = () => {\n    switch (factor.type) {\n      case \"entity_count\":\n        {\n          const entityKindSpec = `${factor.kind}${factor.subtype ? \":\" + factor.subtype : \"\"}`;\n          const statusSuffix = factor.status ? ` (${factor.status})` : \"\";\n          return `${entityKindSpec}${statusSuffix}`;\n        }\n      case \"relationship_count\":\n        return factor.relationshipKinds?.join(\", \") || \"No relationships selected\";\n      case \"tag_count\":\n        return factor.tags?.join(\", \") || \"No tags selected\";\n      case \"ratio\":\n        {\n          const num = factor.numerator?.kind || factor.numerator?.relationshipKinds?.join(\",\") || \"?\";\n          const den = factor.denominator?.kind || factor.denominator?.relationshipKinds?.join(\",\") || factor.denominator?.type || \"?\";\n          return `${num} / ${den}`;\n        }\n      case \"status_ratio\":\n        {\n          const statusKindSpec = `${factor.kind}${factor.subtype ? \":\" + factor.subtype : \"\"}`;\n          return `${statusKindSpec} (${factor.aliveStatus})`;\n        }\n      case \"cross_culture_ratio\":\n        return factor.relationshipKinds?.join(\", \") || \"No relationships selected\";\n      default:\n        return \"Unknown factor\";\n    }\n  };\n  return <div className=\"nested-card\">\n      <div className=\"nested-card-header\" onClick={onEdit} role=\"button\" tabIndex={0} onKeyDown={e => {\n      if (e.key === \"Enter\" || e.key === \" \") onEdit(e);\n    }}>\n        {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color */}\n        <div className=\"nested-card-icon\" style={{\n        '--fc-icon-bg': `${typeConfig.color}20`, backgroundColor: 'var(--fc-icon-bg)'\n      }}>\n          {typeConfig.icon}\n        </div>\n        <div className=\"nested-card-info\">\n          <div className=\"nested-card-type\">{typeConfig.label}</div>\n          <div className=\"nested-card-summary\">{getSummary()}</div>\n        </div>\n        <div className={`nested-card-coefficient ${feedbackType === \"positive\" ? \"pc-factor-positive\" : \"pc-factor-negative\"}`}>\n          {feedbackType === \"positive\" ? \"+\" : \"\u2212\"}\n          {Math.abs(factor.coefficient)}\n          {factor.cap ? ` (cap: ${factor.cap})` : \"\"}\n        </div>\n        <div className=\"nested-card-actions\">\n          <button className=\"icon-button\" onClick={e => {\n          e.stopPropagation();\n          onEdit();\n        }} title=\"Edit\">\n            \u270f\ufe0f\n          </button>\n          <button className=\"icon-button delete-button\" onClick={e => {\n          e.stopPropagation();\n          onDelete();\n        }} title=\"Remove\">\n            \ud83d\uddd1\ufe0f\n          </button>\n        </div>\n      </div>\n    </div>;\n}", "parameters": [{"name": "{\n  factor,\n  feedbackType,\n  onEdit,\n  onDelete,\n  schema: _schema\n}", "type": "{ factor: any; feedbackType: any; onEdit: any; onDelete: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["FACTOR_TYPES"], "category": "internal"}, {"source": "./PressureCard.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/pressures/cards/index.js::FactorCard", "name": "FactorCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/cards/index.js", "sourceCode": "export function FactorCard({\n  factor,\n  feedbackType,\n  onEdit,\n  onDelete,\n  schema: _schema\n}) {\n  const typeConfig = FACTOR_TYPES[factor.type] || {};\n\n  // Generate summary based on factor type\n  const getSummary = () => {\n    switch (factor.type) {\n      case \"entity_count\":\n        {\n          const entityKindSpec = `${factor.kind}${factor.subtype ? \":\" + factor.subtype : \"\"}`;\n          const statusSuffix = factor.status ? ` (${factor.status})` : \"\";\n          return `${entityKindSpec}${statusSuffix}`;\n        }\n      case \"relationship_count\":\n        return factor.relationshipKinds?.join(\", \") || \"No relationships selected\";\n      case \"tag_count\":\n        return factor.tags?.join(\", \") || \"No tags selected\";\n      case \"ratio\":\n        {\n          const num = factor.numerator?.kind || factor.numerator?.relationshipKinds?.join(\",\") || \"?\";\n          const den = factor.denominator?.kind || factor.denominator?.relationshipKinds?.join(\",\") || factor.denominator?.type || \"?\";\n          return `${num} / ${den}`;\n        }\n      case \"status_ratio\":\n        {\n          const statusKindSpec = `${factor.kind}${factor.subtype ? \":\" + factor.subtype : \"\"}`;\n          return `${statusKindSpec} (${factor.aliveStatus})`;\n        }\n      case \"cross_culture_ratio\":\n        return factor.relationshipKinds?.join(\", \") || \"No relationships selected\";\n      default:\n        return \"Unknown factor\";\n    }\n  };\n  return <div className=\"nested-card\">\n      <div className=\"nested-card-header\" onClick={onEdit} role=\"button\" tabIndex={0} onKeyDown={e => {\n      if (e.key === \"Enter\" || e.key === \" \") onEdit(e);\n    }}>\n        {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color */}\n        <div className=\"nested-card-icon\" style={{\n        '--fc-icon-bg': `${typeConfig.color}20`, backgroundColor: 'var(--fc-icon-bg)'\n      }}>\n          {typeConfig.icon}\n        </div>\n        <div className=\"nested-card-info\">\n          <div className=\"nested-card-type\">{typeConfig.label}</div>\n          <div className=\"nested-card-summary\">{getSummary()}</div>\n        </div>\n        <div className={`nested-card-coefficient ${feedbackType === \"positive\" ? \"pc-factor-positive\" : \"pc-factor-negative\"}`}>\n          {feedbackType === \"positive\" ? \"+\" : \"\u2212\"}\n          {Math.abs(factor.coefficient)}\n          {factor.cap ? ` (cap: ${factor.cap})` : \"\"}\n        </div>\n        <div className=\"nested-card-actions\">\n          <button className=\"icon-button\" onClick={e => {\n          e.stopPropagation();\n          onEdit();\n        }} title=\"Edit\">\n            \u270f\ufe0f\n          </button>\n          <button className=\"icon-button delete-button\" onClick={e => {\n          e.stopPropagation();\n          onDelete();\n        }} title=\"Remove\">\n            \ud83d\uddd1\ufe0f\n          </button>\n        </div>\n      </div>\n    </div>;\n}", "parameters": [{"name": "{\n  factor,\n  feedbackType,\n  onEdit,\n  onDelete,\n  schema: _schema\n}", "type": "{ factor: any; feedbackType: any; onEdit: any; onDelete: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/pressures/cards/index.js::PressureCard", "name": "PressureCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/cards/index.js", "sourceCode": "export function PressureCard({\n  pressure,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  schema,\n  usageMap,\n  projectId,\n}) {\n  const [, setHovering] = useState(false);\n  const [editingFactor, setEditingFactor] = useState(null);\n  const [addingFactorType, setAddingFactorType] = useState(null);\n  const factorModalKey = buildStorageKey(projectId, \"pressures:factorModal\");\n\n  const handleFieldChange = useCallback(\n    (field, value) => {\n      onChange({\n        ...pressure,\n        [field]: value,\n      });\n    },\n    [pressure, onChange]\n  );\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(pressure.id, (value) =>\n    handleFieldChange(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(pressure.name, (value) =>\n    handleFieldChange(\"name\", value)\n  );\n  const [localDescription, setLocalDescription, handleDescriptionBlur] = useLocalInputState(\n    pressure.description || \"\",\n    (value) => handleFieldChange(\"description\", value)\n  );\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"pressure\", pressure.id)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, pressure.id]\n  );\n\n  const usage = useMemo(() => {\n    if (!usageMap?.pressures?.[pressure.id]) return null;\n    return usageMap.pressures[pressure.id];\n  }, [usageMap, pressure.id]);\n\n  const hasErrors = validation.invalidRefs.length > 0;\n  const isOrphan = validation.isOrphan;\n  const usedByCount = usage\n    ? (usage.generators?.length || 0) + (usage.systems?.length || 0) + (usage.actions?.length || 0)\n    : 0;\n\n  const handleGrowthChange = useCallback(\n    (field, value) => {\n      onChange({\n        ...pressure,\n        growth: {\n          ...pressure.growth,\n          [field]: value,\n        },\n      });\n    },\n    [pressure, onChange]\n  );\n\n  const persistFactorModal = useCallback(\n    (payload) => {\n      if (!factorModalKey) return;\n      if (payload) {\n        saveStoredValue(factorModalKey, payload);\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    },\n    [factorModalKey]\n  );\n\n  const handleAddFactor = useCallback(\n    (feedbackType) => {\n      setAddingFactorType(feedbackType);\n      persistFactorModal({\n        pressureId: pressure.id,\n        mode: \"add\",\n        feedbackType,\n      });\n    },\n    [pressure.id, persistFactorModal]\n  );\n\n  const handleSaveFactor = useCallback(\n    (factor, feedbackType, index) => {\n      const feedbackKey = feedbackType === \"positive\" ? \"positiveFeedback\" : \"negativeFeedback\";\n      const currentFactors = [...(pressure.growth?.[feedbackKey] || [])];\n\n      if (index !== undefined && index >= 0) {\n        currentFactors[index] = factor;\n      } else {\n        currentFactors.push(factor);\n      }\n\n      handleGrowthChange(feedbackKey, currentFactors);\n      setEditingFactor(null);\n      setAddingFactorType(null);\n      persistFactorModal(null);\n    },\n    [pressure, handleGrowthChange, persistFactorModal]\n  );\n\n  const handleEditFactor = useCallback(\n    (factor, feedbackType, index) => {\n      setEditingFactor({ factor, feedbackType, index });\n      persistFactorModal({\n        pressureId: pressure.id,\n        mode: \"edit\",\n        feedbackType,\n        factorIndex: index,\n      });\n    },\n    [pressure.id, persistFactorModal]\n  );\n\n  const handleCloseFactorModal = useCallback(() => {\n    setEditingFactor(null);\n    setAddingFactorType(null);\n    persistFactorModal(null);\n  }, [persistFactorModal]);\n\n  const handleRemoveFactor = useCallback(\n    (feedbackType, index) => {\n      const feedbackKey = feedbackType === \"positive\" ? \"positiveFeedback\" : \"negativeFeedback\";\n      const newFactors = [...(pressure.growth?.[feedbackKey] || [])];\n      newFactors.splice(index, 1);\n      handleGrowthChange(feedbackKey, newFactors);\n    },\n    [pressure, handleGrowthChange]\n  );\n\n  const positiveFeedback = pressure.growth?.positiveFeedback || [];\n  const negativeFeedback = pressure.growth?.negativeFeedback || [];\n  // Compute feedback loop balance status\n  const feedbackStatus = useMemo(() => {\n    const hasPositive = positiveFeedback.length > 0;\n    const hasNegative = negativeFeedback.length > 0;\n    const hasHomeostasis = (pressure.homeostasis || 0) !== 0;\n\n    if (!hasPositive && !hasNegative && !hasHomeostasis) {\n      return {\n        icon: \"\u26aa\",\n        color: \"#9ca3af\",\n        label: \"Static\",\n        description: \"No feedback or homeostasis\",\n      };\n    }\n    if (!hasPositive && !hasNegative && hasHomeostasis) {\n      return {\n        icon: \"\ud83e\udded\",\n        color: \"#22c55e\",\n        label: \"Centering\",\n        description: \"Homeostasis will pull toward equilibrium\",\n      };\n    }\n    if (hasPositive && !hasNegative) {\n      return {\n        icon: \"\ud83d\udcc8\",\n        color: \"#f59e0b\",\n        label: \"Runaway\",\n        description: \"May grow unbounded - consider adding negative feedback\",\n      };\n    }\n    if (!hasPositive && hasNegative && !hasHomeostasis) {\n      return {\n        icon: \"\ud83d\udcc9\",\n        color: \"#3b82f6\",\n        label: \"Diminishing\",\n        description: \"Will trend downward from feedback alone\",\n      };\n    }\n    // Both present - self-correcting\n    return {\n      icon: \"\u2696\ufe0f\",\n      color: \"#22c55e\",\n      label: \"Balanced\",\n      description: \"Feedback plus homeostasis provide stabilization\",\n    };\n  }, [positiveFeedback.length, negativeFeedback.length, pressure.homeostasis]);\n\n  // Restore factor modal state from storage (guarded)\n  const restoredModalKeyRef = useRef(null);\n  useEffect(() => {\n    if (!factorModalKey || editingFactor || addingFactorType || restoredModalKeyRef.current === factorModalKey) {\n      return;\n    }\n\n    restoredModalKeyRef.current = factorModalKey;\n    const stored = loadStoredValue(factorModalKey);\n    if (!(stored && stored.pressureId === pressure.id)) {\n      return;\n    }\n\n    if (stored.mode === \"add\") {\n      // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted factor modal state\n      setAddingFactorType(stored.feedbackType);\n      return;\n    }\n\n    if (stored.mode === \"edit\") {\n      const feedbackKey =\n        stored.feedbackType === \"positive\" ? \"positiveFeedback\" : \"negativeFeedback\";\n      const factor = pressure.growth?.[feedbackKey]?.[stored.factorIndex];\n      if (factor) {\n        // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted factor modal state\n        setEditingFactor({ factor, feedbackType: stored.feedbackType, index: stored.factorIndex });\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    }\n  }, [addingFactorType, editingFactor, factorModalKey, pressure]);\n\n  return (\n    <div className=\"expandable-card\">\n      <div\n        className=\"expandable-card-header\"\n        onClick={onToggle}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onToggle(e); }}\n      >\n        <div\n          className=\"expandable-card-title pc-title-layout\"\n        >\n          <div className=\"pc-title-row\">\n            <span className=\"expandable-card-name\">{pressure.name}</span>\n            <span className=\"expandable-card-id\">{pressure.id}</span>\n            {hasErrors && (\n              <span className=\"card-error-badge\">\n                {validation.invalidRefs.length} error\n                {validation.invalidRefs.length !== 1 ? \"s\" : \"\"}\n              </span>\n            )}\n            {usedByCount > 0 && <span className=\"card-usage-badge\">Used by {usedByCount}</span>}\n            {isOrphan && !hasErrors && <span className=\"card-orphan-badge\">Not used</span>}\n          </div>\n          {pressure.description && (\n            <div className=\"expandable-card-subtitle\">{pressure.description}</div>\n          )}\n        </div>\n        <div className=\"pc-header-right\">\n          <div className=\"expandable-card-stats\">\n            <div className=\"stat\">\n              <span className=\"stat-label\">Initial</span>\n              <span className=\"stat-value\">{pressure.initialValue}</span>\n              <div className=\"stat-bar\">\n                <div\n                  className=\"stat-bar-fill pc-stat-bar-fill\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic width from pressure value\n                  style={{\n                    '--pc-bar-width': `${Math.min(100, Math.max(0, ((pressure.initialValue || 0) + 100) / 2))}%`,\n                    width: 'var(--pc-bar-width)',\n                  }}\n                />\n              </div>\n            </div>\n            <div className=\"stat\">\n              <span className=\"stat-label\">Homeostasis</span>\n              <span className=\"stat-value\">{pressure.homeostasis}</span>\n            </div>\n            <div className=\"stat\">\n              <span className=\"stat-label\">Factors</span>\n              <span className=\"stat-value\">\n                <span className=\"pc-factor-positive\">+{positiveFeedback.length}</span>\n                {\" / \"}\n                <span className=\"pc-factor-negative\">-{negativeFeedback.length}</span>\n              </span>\n            </div>\n            <div className=\"stat\" title={feedbackStatus.description}>\n              <span className=\"stat-label\">Balance</span>\n              {/* eslint-disable-next-line local/no-inline-styles -- dynamic feedback color */}\n              <span\n                className=\"stat-value pc-balance-value\"\n                style={{ '--pc-balance-color': feedbackStatus.color, color: 'var(--pc-balance-color)' }}\n              >\n                <span>{feedbackStatus.icon}</span>\n                <span className=\"pc-balance-label\">{feedbackStatus.label}</span>\n              </span>\n            </div>\n          </div>\n          <span className={`expand-icon ${expanded ? \"expand-icon-open\" : \"\"}`}>\u25bc</span>\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"expandable-card-content\">\n          {/* Basic Info */}\n          <div className=\"section\">\n// ... (truncated)", "parameters": [{"name": "{\n  pressure,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  schema,\n  usageMap,\n  projectId,\n}", "type": "{ pressure: any; expanded: any; onToggle: any; onChange: any; onDelete: any; schema: any; usageMap: any; projectId: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "textarea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "FactorEditorModal", "children": [], "isMap": false, "isConditional": true}, {"tag": "FactorEditorModal", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 3}, {"name": "useCallback", "count": 8}, {"name": "useLocalInputState", "count": 3}, {"name": "useMemo", "count": 3}, {"name": "useRef", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/pressures/cards/PressureCard.jsx::PressureCard", "name": "PressureCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/cards/PressureCard.jsx", "sourceCode": "export function PressureCard({\n  pressure,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  schema,\n  usageMap,\n  projectId,\n}) {\n  const [, setHovering] = useState(false);\n  const [editingFactor, setEditingFactor] = useState(null);\n  const [addingFactorType, setAddingFactorType] = useState(null);\n  const factorModalKey = buildStorageKey(projectId, \"pressures:factorModal\");\n\n  const handleFieldChange = useCallback(\n    (field, value) => {\n      onChange({\n        ...pressure,\n        [field]: value,\n      });\n    },\n    [pressure, onChange]\n  );\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(pressure.id, (value) =>\n    handleFieldChange(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(pressure.name, (value) =>\n    handleFieldChange(\"name\", value)\n  );\n  const [localDescription, setLocalDescription, handleDescriptionBlur] = useLocalInputState(\n    pressure.description || \"\",\n    (value) => handleFieldChange(\"description\", value)\n  );\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"pressure\", pressure.id)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, pressure.id]\n  );\n\n  const usage = useMemo(() => {\n    if (!usageMap?.pressures?.[pressure.id]) return null;\n    return usageMap.pressures[pressure.id];\n  }, [usageMap, pressure.id]);\n\n  const hasErrors = validation.invalidRefs.length > 0;\n  const isOrphan = validation.isOrphan;\n  const usedByCount = usage\n    ? (usage.generators?.length || 0) + (usage.systems?.length || 0) + (usage.actions?.length || 0)\n    : 0;\n\n  const handleGrowthChange = useCallback(\n    (field, value) => {\n      onChange({\n        ...pressure,\n        growth: {\n          ...pressure.growth,\n          [field]: value,\n        },\n      });\n    },\n    [pressure, onChange]\n  );\n\n  const persistFactorModal = useCallback(\n    (payload) => {\n      if (!factorModalKey) return;\n      if (payload) {\n        saveStoredValue(factorModalKey, payload);\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    },\n    [factorModalKey]\n  );\n\n  const handleAddFactor = useCallback(\n    (feedbackType) => {\n      setAddingFactorType(feedbackType);\n      persistFactorModal({\n        pressureId: pressure.id,\n        mode: \"add\",\n        feedbackType,\n      });\n    },\n    [pressure.id, persistFactorModal]\n  );\n\n  const handleSaveFactor = useCallback(\n    (factor, feedbackType, index) => {\n      const feedbackKey = feedbackType === \"positive\" ? \"positiveFeedback\" : \"negativeFeedback\";\n      const currentFactors = [...(pressure.growth?.[feedbackKey] || [])];\n\n      if (index !== undefined && index >= 0) {\n        currentFactors[index] = factor;\n      } else {\n        currentFactors.push(factor);\n      }\n\n      handleGrowthChange(feedbackKey, currentFactors);\n      setEditingFactor(null);\n      setAddingFactorType(null);\n      persistFactorModal(null);\n    },\n    [pressure, handleGrowthChange, persistFactorModal]\n  );\n\n  const handleEditFactor = useCallback(\n    (factor, feedbackType, index) => {\n      setEditingFactor({ factor, feedbackType, index });\n      persistFactorModal({\n        pressureId: pressure.id,\n        mode: \"edit\",\n        feedbackType,\n        factorIndex: index,\n      });\n    },\n    [pressure.id, persistFactorModal]\n  );\n\n  const handleCloseFactorModal = useCallback(() => {\n    setEditingFactor(null);\n    setAddingFactorType(null);\n    persistFactorModal(null);\n  }, [persistFactorModal]);\n\n  const handleRemoveFactor = useCallback(\n    (feedbackType, index) => {\n      const feedbackKey = feedbackType === \"positive\" ? \"positiveFeedback\" : \"negativeFeedback\";\n      const newFactors = [...(pressure.growth?.[feedbackKey] || [])];\n      newFactors.splice(index, 1);\n      handleGrowthChange(feedbackKey, newFactors);\n    },\n    [pressure, handleGrowthChange]\n  );\n\n  const positiveFeedback = pressure.growth?.positiveFeedback || [];\n  const negativeFeedback = pressure.growth?.negativeFeedback || [];\n  // Compute feedback loop balance status\n  const feedbackStatus = useMemo(() => {\n    const hasPositive = positiveFeedback.length > 0;\n    const hasNegative = negativeFeedback.length > 0;\n    const hasHomeostasis = (pressure.homeostasis || 0) !== 0;\n\n    if (!hasPositive && !hasNegative && !hasHomeostasis) {\n      return {\n        icon: \"\u26aa\",\n        color: \"#9ca3af\",\n        label: \"Static\",\n        description: \"No feedback or homeostasis\",\n      };\n    }\n    if (!hasPositive && !hasNegative && hasHomeostasis) {\n      return {\n        icon: \"\ud83e\udded\",\n        color: \"#22c55e\",\n        label: \"Centering\",\n        description: \"Homeostasis will pull toward equilibrium\",\n      };\n    }\n    if (hasPositive && !hasNegative) {\n      return {\n        icon: \"\ud83d\udcc8\",\n        color: \"#f59e0b\",\n        label: \"Runaway\",\n        description: \"May grow unbounded - consider adding negative feedback\",\n      };\n    }\n    if (!hasPositive && hasNegative && !hasHomeostasis) {\n      return {\n        icon: \"\ud83d\udcc9\",\n        color: \"#3b82f6\",\n        label: \"Diminishing\",\n        description: \"Will trend downward from feedback alone\",\n      };\n    }\n    // Both present - self-correcting\n    return {\n      icon: \"\u2696\ufe0f\",\n      color: \"#22c55e\",\n      label: \"Balanced\",\n      description: \"Feedback plus homeostasis provide stabilization\",\n    };\n  }, [positiveFeedback.length, negativeFeedback.length, pressure.homeostasis]);\n\n  // Restore factor modal state from storage (guarded)\n  const restoredModalKeyRef = useRef(null);\n  useEffect(() => {\n    if (!factorModalKey || editingFactor || addingFactorType || restoredModalKeyRef.current === factorModalKey) {\n      return;\n    }\n\n    restoredModalKeyRef.current = factorModalKey;\n    const stored = loadStoredValue(factorModalKey);\n    if (!(stored && stored.pressureId === pressure.id)) {\n      return;\n    }\n\n    if (stored.mode === \"add\") {\n      // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted factor modal state\n      setAddingFactorType(stored.feedbackType);\n      return;\n    }\n\n    if (stored.mode === \"edit\") {\n      const feedbackKey =\n        stored.feedbackType === \"positive\" ? \"positiveFeedback\" : \"negativeFeedback\";\n      const factor = pressure.growth?.[feedbackKey]?.[stored.factorIndex];\n      if (factor) {\n        // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted factor modal state\n        setEditingFactor({ factor, feedbackType: stored.feedbackType, index: stored.factorIndex });\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    }\n  }, [addingFactorType, editingFactor, factorModalKey, pressure]);\n\n  return (\n    <div className=\"expandable-card\">\n      <div\n        className=\"expandable-card-header\"\n        onClick={onToggle}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onToggle(e); }}\n      >\n        <div\n          className=\"expandable-card-title pc-title-layout\"\n        >\n          <div className=\"pc-title-row\">\n            <span className=\"expandable-card-name\">{pressure.name}</span>\n            <span className=\"expandable-card-id\">{pressure.id}</span>\n            {hasErrors && (\n              <span className=\"card-error-badge\">\n                {validation.invalidRefs.length} error\n                {validation.invalidRefs.length !== 1 ? \"s\" : \"\"}\n              </span>\n            )}\n            {usedByCount > 0 && <span className=\"card-usage-badge\">Used by {usedByCount}</span>}\n            {isOrphan && !hasErrors && <span className=\"card-orphan-badge\">Not used</span>}\n          </div>\n          {pressure.description && (\n            <div className=\"expandable-card-subtitle\">{pressure.description}</div>\n          )}\n        </div>\n        <div className=\"pc-header-right\">\n          <div className=\"expandable-card-stats\">\n            <div className=\"stat\">\n              <span className=\"stat-label\">Initial</span>\n              <span className=\"stat-value\">{pressure.initialValue}</span>\n              <div className=\"stat-bar\">\n                <div\n                  className=\"stat-bar-fill pc-stat-bar-fill\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic width from pressure value\n                  style={{\n                    '--pc-bar-width': `${Math.min(100, Math.max(0, ((pressure.initialValue || 0) + 100) / 2))}%`,\n                    width: 'var(--pc-bar-width)',\n                  }}\n                />\n              </div>\n            </div>\n            <div className=\"stat\">\n              <span className=\"stat-label\">Homeostasis</span>\n              <span className=\"stat-value\">{pressure.homeostasis}</span>\n            </div>\n            <div className=\"stat\">\n              <span className=\"stat-label\">Factors</span>\n              <span className=\"stat-value\">\n                <span className=\"pc-factor-positive\">+{positiveFeedback.length}</span>\n                {\" / \"}\n                <span className=\"pc-factor-negative\">-{negativeFeedback.length}</span>\n              </span>\n            </div>\n            <div className=\"stat\" title={feedbackStatus.description}>\n              <span className=\"stat-label\">Balance</span>\n              {/* eslint-disable-next-line local/no-inline-styles -- dynamic feedback color */}\n              <span\n                className=\"stat-value pc-balance-value\"\n                style={{ '--pc-balance-color': feedbackStatus.color, color: 'var(--pc-balance-color)' }}\n              >\n                <span>{feedbackStatus.icon}</span>\n                <span className=\"pc-balance-label\">{feedbackStatus.label}</span>\n              </span>\n            </div>\n          </div>\n          <span className={`expand-icon ${expanded ? \"expand-icon-open\" : \"\"}`}>\u25bc</span>\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"expandable-card-content\">\n          {/* Basic Info */}\n          <div className=\"section\">\n// ... (truncated)", "parameters": [{"name": "{\n  pressure,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  schema,\n  usageMap,\n  projectId,\n}", "type": "{ pressure: any; expanded: any; onToggle: any; onChange: any; onDelete: any; schema: any; usageMap: any; projectId: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "textarea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "FactorEditorModal", "children": [], "isMap": false, "isConditional": true}, {"tag": "FactorEditorModal", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 3}, {"name": "useCallback", "count": 8}, {"name": "useLocalInputState", "count": 3}, {"name": "useMemo", "count": 3}, {"name": "useRef", "count": 1}, {"name": "useEffect", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useCallback", "useMemo", "useRef", "useEffect"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./FactorCard", "specifiers": ["FactorCard"], "category": "internal"}, {"source": "../modals/FactorEditorModal", "specifiers": ["FactorEditorModal"], "category": "internal"}, {"source": "../../shared", "specifiers": ["getElementValidation", "useLocalInputState", "NumberInput"], "category": "internal"}, {"source": "../../../utils/persistence", "specifiers": ["buildStorageKey", "clearStoredValue", "loadStoredValue", "saveStoredValue"], "category": "internal"}, {"source": "./PressureCard.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/pressures/modals/FactorEditorModal.jsx::FactorEditorModal", "name": "FactorEditorModal", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/modals/FactorEditorModal.jsx", "sourceCode": "export function FactorEditorModal({ isOpen, onClose, factor, onChange, feedbackType, schema }) {\n  const [localFactor, setLocalFactor] = useState(factor || { type: \"entity_count\" });\n  const [selectedType, setSelectedType] = useState(factor?.type || \"entity_count\");\n\n  // Build options from schema\n  const entityKindOptions = useMemo(() => {\n    return (schema?.entityKinds || []).map((ek) => ({\n      value: ek.kind,\n      label: ek.description || ek.kind,\n    }));\n  }, [schema]);\n\n  const getSubtypeOptions = useCallback(\n    (kind) => {\n      const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n      if (!ek?.subtypes) return [];\n      return ek.subtypes.map((st) => ({\n        value: st.id,\n        label: st.name || st.id,\n      }));\n    },\n    [schema]\n  );\n\n  const getStatusOptions = useCallback(\n    (kind) => {\n      const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n      if (!ek?.statuses) return [];\n      return ek.statuses.map((st) => ({\n        value: st.id,\n        label: st.name || st.id,\n        meta: st.isTerminal ? \"terminal\" : \"\",\n      }));\n    },\n    [schema]\n  );\n\n  const relationshipKindOptions = useMemo(() => {\n    return (schema?.relationshipKinds || []).map((rk) => ({\n      value: rk.kind,\n      label: rk.description || rk.kind,\n    }));\n  }, [schema]);\n\n  // Sync local state when factor or isOpen changes\n  useEffect(() => {\n    if (factor) {\n      // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n      setLocalFactor(factor);\n      // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n      setSelectedType(factor.type);\n      return;\n    }\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n    setLocalFactor({ type: \"entity_count\", coefficient: 1 });\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n    setSelectedType(\"entity_count\");\n  }, [factor, isOpen]);\n\n  const handleTypeChange = (type) => {\n    setSelectedType(type);\n    // Reset factor to defaults for new type\n    const defaults = { type, coefficient: 1 };\n    if (type === \"ratio\") {\n      defaults.numerator = { type: \"entity_count\" };\n      defaults.denominator = { type: \"entity_count\" };\n      defaults.fallbackValue = 0;\n    }\n    setLocalFactor(defaults);\n  };\n\n  const updateField = (field, value) => {\n    setLocalFactor((prev) => ({ ...prev, [field]: value }));\n  };\n\n  const handleSave = () => {\n    onChange(localFactor);\n    onClose();\n  };\n\n  const mouseDownOnOverlay = useRef(false);\n\n  const handleOverlayMouseDown = (e) => {\n    mouseDownOnOverlay.current = e.target === e.currentTarget;\n  };\n\n  const handleOverlayClick = (e) => {\n    if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n      onClose();\n    }\n  };\n\n  if (!isOpen) return null;\n\n  const typeConfig = FACTOR_TYPES[selectedType];\n\n  // Render numerator/denominator editor for ratio type\n  const renderCountEditor = (countObj, onCountChange, label) => {\n    const countType = countObj?.type || \"entity_count\";\n    return (\n      <div className=\"nested-section\">\n        <div className=\"nested-title\">{label}</div>\n        <div className=\"input-grid\">\n          <ReferenceDropdown\n            label=\"Count Type\"\n            value={countType}\n            onChange={(v) => onCountChange({ ...countObj, type: v })}\n            options={[\n              { value: \"entity_count\", label: \"Entity Count\" },\n              { value: \"relationship_count\", label: \"Relationship Count\" },\n              { value: \"total_entities\", label: \"Total Entities\" },\n            ]}\n          />\n          {countType === \"entity_count\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Entity Kind\"\n                value={countObj?.kind || \"\"}\n                onChange={(v) => onCountChange({ ...countObj, kind: v, subtype: undefined })}\n                options={entityKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              {countObj?.kind && (\n                <ReferenceDropdown\n                  label=\"Subtype (optional)\"\n                  value={countObj?.subtype || \"\"}\n                  onChange={(v) => onCountChange({ ...countObj, subtype: v || undefined })}\n                  options={getSubtypeOptions(countObj.kind)}\n                  placeholder=\"Any subtype\"\n                />\n              )}\n            </>\n          )}\n          {countType === \"relationship_count\" && (\n            <ChipSelect\n              label=\"Relationship Kinds\"\n              value={countObj?.relationshipKinds || []}\n              onChange={(v) => onCountChange({ ...countObj, relationshipKinds: v })}\n              options={relationshipKindOptions}\n              placeholder=\"Select relationships...\"\n            />\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div\n      className=\"modal-overlay\"\n      onMouseDown={handleOverlayMouseDown}\n      onClick={handleOverlayClick}\n      role=\"button\"\n      tabIndex={0}\n      onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n    >\n      <div className=\"modal\">\n        <div className=\"modal-header\">\n          <div className=\"modal-title\">\n            <span>{typeConfig?.icon}</span>\n            {factor ? \"Edit Factor\" : \"Add Factor\"}\n            <span\n              className={feedbackType === \"positive\" ? \"fem-feedback-badge-positive\" : \"fem-feedback-badge-negative\"}\n            >\n              {feedbackType === \"positive\" ? \"+ Positive\" : \"- Negative\"}\n            </span>\n          </div>\n          <button className=\"btn-close\" onClick={onClose}>\n            \u00d7\n          </button>\n        </div>\n\n        <div className=\"modal-content\">\n          {/* Type selector - compact pills */}\n          <div className=\"mb-2xl\">\n            <span className=\"label\">Factor Type</span>\n            <div className=\"type-selector\">\n              {Object.entries(FACTOR_TYPES).map(([type, config]) => (\n                <div\n                  key={type}\n                  onClick={() => handleTypeChange(type)}\n                  className={`type-pill ${selectedType === type ? \"type-pill-selected\" : \"\"}`}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <span className=\"type-pill-icon\">{config.icon}</span>\n                  <span>{config.label}</span>\n                </div>\n              ))}\n            </div>\n            {typeConfig && <div className=\"type-description\">{typeConfig.description}</div>}\n          </div>\n\n          {/* Type-specific fields */}\n          <div className=\"input-grid\">\n            {/* Entity Count fields */}\n            {selectedType === \"entity_count\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={localFactor.kind || \"\"}\n                  onChange={(v) => updateField(\"kind\", v)}\n                  options={entityKindOptions}\n                  placeholder=\"Select kind...\"\n                />\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Subtype (optional)\"\n                    value={localFactor.subtype || \"\"}\n                    onChange={(v) => updateField(\"subtype\", v || undefined)}\n                    options={getSubtypeOptions(localFactor.kind)}\n                    placeholder=\"Any subtype\"\n                  />\n                )}\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Status (optional)\"\n                    value={localFactor.status || \"\"}\n                    onChange={(v) => updateField(\"status\", v || undefined)}\n                    options={getStatusOptions(localFactor.kind)}\n                    placeholder=\"Any status\"\n                  />\n                )}\n              </>\n            )}\n\n            {/* Relationship Count fields */}\n            {selectedType === \"relationship_count\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Relationship Kinds\"\n                  value={localFactor.relationshipKinds || []}\n                  onChange={(v) => updateField(\"relationshipKinds\", v)}\n                  options={relationshipKindOptions}\n                  placeholder=\"Select relationship types...\"\n                />\n              </div>\n            )}\n\n            {/* Tag Count fields */}\n            {selectedType === \"tag_count\" && (\n              <div className=\"grid-col-full\">\n                <label className=\"label\">Tags\n                <TagSelector\n                  value={localFactor.tags || []}\n                  onChange={(v) => updateField(\"tags\", v)}\n                  tagRegistry={schema?.tagRegistry || []}\n                  placeholder=\"Select tags...\"\n                />\n                </label>\n              </div>\n            )}\n\n            {/* Status Ratio fields */}\n            {selectedType === \"status_ratio\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={localFactor.kind || \"\"}\n                  onChange={(v) => {\n                    updateField(\"kind\", v);\n                    updateField(\"subtype\", undefined);\n                    updateField(\"aliveStatus\", undefined);\n                  }}\n                  options={entityKindOptions}\n                  placeholder=\"Select kind...\"\n                />\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Subtype (optional)\"\n                    value={localFactor.subtype || \"\"}\n                    onChange={(v) => updateField(\"subtype\", v || undefined)}\n                    options={getSubtypeOptions(localFactor.kind)}\n                    placeholder=\"Any subtype\"\n                  />\n                )}\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Alive Status\"\n                    value={localFactor.aliveStatus || \"\"}\n                    onChange={(v) => updateField(\"aliveStatus\", v)}\n                    options={getStatusOptions(localFactor.kind)}\n                    placeholder=\"Select status...\"\n                  />\n                )}\n              </>\n            )}\n\n            {/* Cross-Culture Ratio fields */}\n            {selectedType === \"cross_culture_ratio\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Relationship Kinds\"\n                  value={localFactor.relationshipKinds || []}\n                  onChange={(v) => updateField(\"relationshipKinds\", v)}\n                  options={relationshipKindOptions}\n                  placeholder=\"Select relationship types...\"\n                />\n              </div>\n// ... (truncated)", "parameters": [{"name": "{ isOpen, onClose, factor, onChange, feedbackType, schema }", "type": "{ isOpen: any; onClose: any; factor: any; onChange: any; feedbackType: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": true}, {"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useMemo", "count": 2}, {"name": "useCallback", "count": 2}, {"name": "useEffect", "count": 1}, {"name": "useRef", "count": 1}], "imports": [{"source": "react", "specifiers": ["React", "useState", "useMemo", "useCallback", "useRef", "useEffect"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["FACTOR_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "ChipSelect", "NumberInput"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}, {"source": "./FactorEditorModal.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/pressures/modals/index.js::FactorEditorModal", "name": "FactorEditorModal", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/modals/index.js", "sourceCode": "export function FactorEditorModal({ isOpen, onClose, factor, onChange, feedbackType, schema }) {\n  const [localFactor, setLocalFactor] = useState(factor || { type: \"entity_count\" });\n  const [selectedType, setSelectedType] = useState(factor?.type || \"entity_count\");\n\n  // Build options from schema\n  const entityKindOptions = useMemo(() => {\n    return (schema?.entityKinds || []).map((ek) => ({\n      value: ek.kind,\n      label: ek.description || ek.kind,\n    }));\n  }, [schema]);\n\n  const getSubtypeOptions = useCallback(\n    (kind) => {\n      const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n      if (!ek?.subtypes) return [];\n      return ek.subtypes.map((st) => ({\n        value: st.id,\n        label: st.name || st.id,\n      }));\n    },\n    [schema]\n  );\n\n  const getStatusOptions = useCallback(\n    (kind) => {\n      const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n      if (!ek?.statuses) return [];\n      return ek.statuses.map((st) => ({\n        value: st.id,\n        label: st.name || st.id,\n        meta: st.isTerminal ? \"terminal\" : \"\",\n      }));\n    },\n    [schema]\n  );\n\n  const relationshipKindOptions = useMemo(() => {\n    return (schema?.relationshipKinds || []).map((rk) => ({\n      value: rk.kind,\n      label: rk.description || rk.kind,\n    }));\n  }, [schema]);\n\n  // Sync local state when factor or isOpen changes\n  useEffect(() => {\n    if (factor) {\n      // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n      setLocalFactor(factor);\n      // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n      setSelectedType(factor.type);\n      return;\n    }\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n    setLocalFactor({ type: \"entity_count\", coefficient: 1 });\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync modal draft from props on open/change\n    setSelectedType(\"entity_count\");\n  }, [factor, isOpen]);\n\n  const handleTypeChange = (type) => {\n    setSelectedType(type);\n    // Reset factor to defaults for new type\n    const defaults = { type, coefficient: 1 };\n    if (type === \"ratio\") {\n      defaults.numerator = { type: \"entity_count\" };\n      defaults.denominator = { type: \"entity_count\" };\n      defaults.fallbackValue = 0;\n    }\n    setLocalFactor(defaults);\n  };\n\n  const updateField = (field, value) => {\n    setLocalFactor((prev) => ({ ...prev, [field]: value }));\n  };\n\n  const handleSave = () => {\n    onChange(localFactor);\n    onClose();\n  };\n\n  const mouseDownOnOverlay = useRef(false);\n\n  const handleOverlayMouseDown = (e) => {\n    mouseDownOnOverlay.current = e.target === e.currentTarget;\n  };\n\n  const handleOverlayClick = (e) => {\n    if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n      onClose();\n    }\n  };\n\n  if (!isOpen) return null;\n\n  const typeConfig = FACTOR_TYPES[selectedType];\n\n  // Render numerator/denominator editor for ratio type\n  const renderCountEditor = (countObj, onCountChange, label) => {\n    const countType = countObj?.type || \"entity_count\";\n    return (\n      <div className=\"nested-section\">\n        <div className=\"nested-title\">{label}</div>\n        <div className=\"input-grid\">\n          <ReferenceDropdown\n            label=\"Count Type\"\n            value={countType}\n            onChange={(v) => onCountChange({ ...countObj, type: v })}\n            options={[\n              { value: \"entity_count\", label: \"Entity Count\" },\n              { value: \"relationship_count\", label: \"Relationship Count\" },\n              { value: \"total_entities\", label: \"Total Entities\" },\n            ]}\n          />\n          {countType === \"entity_count\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Entity Kind\"\n                value={countObj?.kind || \"\"}\n                onChange={(v) => onCountChange({ ...countObj, kind: v, subtype: undefined })}\n                options={entityKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              {countObj?.kind && (\n                <ReferenceDropdown\n                  label=\"Subtype (optional)\"\n                  value={countObj?.subtype || \"\"}\n                  onChange={(v) => onCountChange({ ...countObj, subtype: v || undefined })}\n                  options={getSubtypeOptions(countObj.kind)}\n                  placeholder=\"Any subtype\"\n                />\n              )}\n            </>\n          )}\n          {countType === \"relationship_count\" && (\n            <ChipSelect\n              label=\"Relationship Kinds\"\n              value={countObj?.relationshipKinds || []}\n              onChange={(v) => onCountChange({ ...countObj, relationshipKinds: v })}\n              options={relationshipKindOptions}\n              placeholder=\"Select relationships...\"\n            />\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div\n      className=\"modal-overlay\"\n      onMouseDown={handleOverlayMouseDown}\n      onClick={handleOverlayClick}\n      role=\"button\"\n      tabIndex={0}\n      onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n    >\n      <div className=\"modal\">\n        <div className=\"modal-header\">\n          <div className=\"modal-title\">\n            <span>{typeConfig?.icon}</span>\n            {factor ? \"Edit Factor\" : \"Add Factor\"}\n            <span\n              className={feedbackType === \"positive\" ? \"fem-feedback-badge-positive\" : \"fem-feedback-badge-negative\"}\n            >\n              {feedbackType === \"positive\" ? \"+ Positive\" : \"- Negative\"}\n            </span>\n          </div>\n          <button className=\"btn-close\" onClick={onClose}>\n            \u00d7\n          </button>\n        </div>\n\n        <div className=\"modal-content\">\n          {/* Type selector - compact pills */}\n          <div className=\"mb-2xl\">\n            <span className=\"label\">Factor Type</span>\n            <div className=\"type-selector\">\n              {Object.entries(FACTOR_TYPES).map(([type, config]) => (\n                <div\n                  key={type}\n                  onClick={() => handleTypeChange(type)}\n                  className={`type-pill ${selectedType === type ? \"type-pill-selected\" : \"\"}`}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <span className=\"type-pill-icon\">{config.icon}</span>\n                  <span>{config.label}</span>\n                </div>\n              ))}\n            </div>\n            {typeConfig && <div className=\"type-description\">{typeConfig.description}</div>}\n          </div>\n\n          {/* Type-specific fields */}\n          <div className=\"input-grid\">\n            {/* Entity Count fields */}\n            {selectedType === \"entity_count\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={localFactor.kind || \"\"}\n                  onChange={(v) => updateField(\"kind\", v)}\n                  options={entityKindOptions}\n                  placeholder=\"Select kind...\"\n                />\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Subtype (optional)\"\n                    value={localFactor.subtype || \"\"}\n                    onChange={(v) => updateField(\"subtype\", v || undefined)}\n                    options={getSubtypeOptions(localFactor.kind)}\n                    placeholder=\"Any subtype\"\n                  />\n                )}\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Status (optional)\"\n                    value={localFactor.status || \"\"}\n                    onChange={(v) => updateField(\"status\", v || undefined)}\n                    options={getStatusOptions(localFactor.kind)}\n                    placeholder=\"Any status\"\n                  />\n                )}\n              </>\n            )}\n\n            {/* Relationship Count fields */}\n            {selectedType === \"relationship_count\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Relationship Kinds\"\n                  value={localFactor.relationshipKinds || []}\n                  onChange={(v) => updateField(\"relationshipKinds\", v)}\n                  options={relationshipKindOptions}\n                  placeholder=\"Select relationship types...\"\n                />\n              </div>\n            )}\n\n            {/* Tag Count fields */}\n            {selectedType === \"tag_count\" && (\n              <div className=\"grid-col-full\">\n                <label className=\"label\">Tags\n                <TagSelector\n                  value={localFactor.tags || []}\n                  onChange={(v) => updateField(\"tags\", v)}\n                  tagRegistry={schema?.tagRegistry || []}\n                  placeholder=\"Select tags...\"\n                />\n                </label>\n              </div>\n            )}\n\n            {/* Status Ratio fields */}\n            {selectedType === \"status_ratio\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={localFactor.kind || \"\"}\n                  onChange={(v) => {\n                    updateField(\"kind\", v);\n                    updateField(\"subtype\", undefined);\n                    updateField(\"aliveStatus\", undefined);\n                  }}\n                  options={entityKindOptions}\n                  placeholder=\"Select kind...\"\n                />\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Subtype (optional)\"\n                    value={localFactor.subtype || \"\"}\n                    onChange={(v) => updateField(\"subtype\", v || undefined)}\n                    options={getSubtypeOptions(localFactor.kind)}\n                    placeholder=\"Any subtype\"\n                  />\n                )}\n                {localFactor.kind && (\n                  <ReferenceDropdown\n                    label=\"Alive Status\"\n                    value={localFactor.aliveStatus || \"\"}\n                    onChange={(v) => updateField(\"aliveStatus\", v)}\n                    options={getStatusOptions(localFactor.kind)}\n                    placeholder=\"Select status...\"\n                  />\n                )}\n              </>\n            )}\n\n            {/* Cross-Culture Ratio fields */}\n            {selectedType === \"cross_culture_ratio\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Relationship Kinds\"\n                  value={localFactor.relationshipKinds || []}\n                  onChange={(v) => updateField(\"relationshipKinds\", v)}\n                  options={relationshipKindOptions}\n                  placeholder=\"Select relationship types...\"\n                />\n              </div>\n// ... (truncated)", "parameters": [{"name": "{ isOpen, onClose, factor, onChange, feedbackType, schema }", "type": "{ isOpen: any; onClose: any; factor: any; onChange: any; feedbackType: any; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": true}, {"tag": "ChipSelect", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}, {"name": "useMemo", "count": 2}, {"name": "useCallback", "count": 2}, {"name": "useEffect", "count": 1}, {"name": "useRef", "count": 1}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/cards/index.js::SystemListCard", "name": "SystemListCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/cards/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system to display\n * @param {Function} props.onClick - Called when card is clicked\n * @param {Function} props.onToggle - Called to toggle enabled state\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport function SystemListCard({ system, onClick, onToggle, usageMap }) {\n  const config = system.config;\n  const sysId = config.id;\n  const isEnabled = system.enabled !== false;\n  const typeConfig = SYSTEM_TYPES[system.systemType] || {};\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"system\", sysId)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, sysId]\n  );\n\n  const eraUsage = useMemo(() => {\n    if (!usageMap?.systems?.[sysId]) return [];\n    return usageMap.systems[sysId].eras || [];\n  }, [usageMap, sysId]);\n\n  const errorCount = validation.invalidRefs.length;\n  const hasErrors = errorCount > 0;\n  const isOrphan = validation.isOrphan;\n\n  const cardClassName = [\n    \"card card-clickable\",\n    !isEnabled && \"card-disabled\",\n    hasErrors && \"card-error\",\n    isOrphan && !hasErrors && \"card-warning\",\n  ]\n    .filter(Boolean)\n    .join(\" \");\n\n  return (\n    <div className={cardClassName} onClick={onClick} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }} >\n      <div className=\"card-header\">\n        <div>\n          <div className=\"flex items-center gap-md\">\n            <span className=\"card-title\">{config.name || config.id}</span>\n            <ErrorBadge count={errorCount} />\n          </div>\n          <div className=\"card-id\">{config.id}</div>\n        </div>\n        <EnableToggle\n          enabled={isEnabled}\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n        />\n      </div>\n\n      <div className=\"card-badges\">\n        {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color from config */}\n        <span\n          className=\"type-badge\"\n          style={{ '--slc-type-bg': `${typeConfig.color}30`, '--slc-type-color': typeConfig.color, backgroundColor: 'var(--slc-type-bg)', color: 'var(--slc-type-color)' }}\n        >\n          {typeConfig.icon} {typeConfig.label}\n        </span>\n      </div>\n\n      {config.description && <div className=\"card-desc\">{config.description}</div>}\n\n      <EraBadges eras={eraUsage} />\n      {isOrphan && (\n        <div className=\"mt-md\">\n          <OrphanBadge isOrphan={isOrphan} />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onClick, onToggle, usageMap }", "type": "{ system: any; onClick: Function; onToggle: Function; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "ErrorBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "EraBadges", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "OrphanBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/cards/SystemListCard.jsx::SystemListCard", "name": "SystemListCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/cards/SystemListCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system to display\n * @param {Function} props.onClick - Called when card is clicked\n * @param {Function} props.onToggle - Called to toggle enabled state\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport function SystemListCard({ system, onClick, onToggle, usageMap }) {\n  const config = system.config;\n  const sysId = config.id;\n  const isEnabled = system.enabled !== false;\n  const typeConfig = SYSTEM_TYPES[system.systemType] || {};\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"system\", sysId)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, sysId]\n  );\n\n  const eraUsage = useMemo(() => {\n    if (!usageMap?.systems?.[sysId]) return [];\n    return usageMap.systems[sysId].eras || [];\n  }, [usageMap, sysId]);\n\n  const errorCount = validation.invalidRefs.length;\n  const hasErrors = errorCount > 0;\n  const isOrphan = validation.isOrphan;\n\n  const cardClassName = [\n    \"card card-clickable\",\n    !isEnabled && \"card-disabled\",\n    hasErrors && \"card-error\",\n    isOrphan && !hasErrors && \"card-warning\",\n  ]\n    .filter(Boolean)\n    .join(\" \");\n\n  return (\n    <div className={cardClassName} onClick={onClick} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }} >\n      <div className=\"card-header\">\n        <div>\n          <div className=\"flex items-center gap-md\">\n            <span className=\"card-title\">{config.name || config.id}</span>\n            <ErrorBadge count={errorCount} />\n          </div>\n          <div className=\"card-id\">{config.id}</div>\n        </div>\n        <EnableToggle\n          enabled={isEnabled}\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n        />\n      </div>\n\n      <div className=\"card-badges\">\n        {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color from config */}\n        <span\n          className=\"type-badge\"\n          style={{ '--slc-type-bg': `${typeConfig.color}30`, '--slc-type-color': typeConfig.color, backgroundColor: 'var(--slc-type-bg)', color: 'var(--slc-type-color)' }}\n        >\n          {typeConfig.icon} {typeConfig.label}\n        </span>\n      </div>\n\n      {config.description && <div className=\"card-desc\">{config.description}</div>}\n\n      <EraBadges eras={eraUsage} />\n      {isOrphan && (\n        <div className=\"mt-md\">\n          <OrphanBadge isOrphan={isOrphan} />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onClick, onToggle, usageMap }", "type": "{ system: any; onClick: Function; onToggle: Function; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "ErrorBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "EraBadges", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "OrphanBadge", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useMemo", "count": 2}], "imports": [{"source": "react", "specifiers": ["React", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["SYSTEM_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ErrorBadge", "OrphanBadge", "EraBadges", "EnableToggle"], "category": "internal"}, {"source": "../../shared", "specifiers": ["getElementValidation"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/ClusterFormationTab.jsx::ClusterFormationTab", "name": "ClusterFormationTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/ClusterFormationTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function ClusterFormationTab({ system, onChange, schema }) {\n  const config = system.config;\n\n  const entityKindOptions = (schema?.entityKinds || []).map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateClustering = (field, value) => {\n    updateConfig(\"clustering\", { ...config.clustering, [field]: value });\n  };\n\n  const updateMetaEntity = (field, value) => {\n    updateConfig(\"metaEntity\", { ...config.metaEntity, [field]: value });\n  };\n\n  // Criteria\n  const criteria = config.clustering?.criteria || [];\n\n  const addCriterion = () => {\n    updateClustering(\"criteria\", [...criteria, { type: \"same_culture\", weight: 1.0 }]);\n  };\n\n  const updateCriterion = (index, crit) => {\n    const newCriteria = [...criteria];\n    newCriteria[index] = crit;\n    updateClustering(\"criteria\", newCriteria);\n  };\n\n  const removeCriterion = (index) => {\n    updateClustering(\n      \"criteria\",\n      criteria.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Clustering Configuration</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Min Size\n            <NumberInput\n              value={config.clustering?.minSize}\n              onChange={(v) => updateClustering(\"minSize\", v)}\n              min={2}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Max Size\n            <NumberInput\n              value={config.clustering?.maxSize}\n              onChange={(v) => updateClustering(\"maxSize\", v)}\n              min={2}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Minimum Score\n            <NumberInput\n              value={config.clustering?.minimumScore}\n              onChange={(v) => updateClustering(\"minimumScore\", v)}\n              min={0}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Clustering Criteria ({criteria.length})</label>\n        </div>\n\n        {criteria.map((crit, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"py-lg px-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <ReferenceDropdown\n                    label=\"Type\"\n                    value={crit.type}\n                    onChange={(v) => updateCriterion(index, { ...crit, type: v })}\n                    options={CLUSTERING_CRITERIA_TYPES}\n                  />\n                  <div className=\"form-group\">\n                    <label className=\"label\">Weight\n                    <NumberInput\n                      value={crit.weight}\n                      onChange={(v) => updateCriterion(index, { ...crit, weight: v ?? 0 })}\n                      min={0}\n                    />\n                    </label>\n                  </div>\n                  {crit.type === \"shared_relationship\" && (\n                    <ReferenceDropdown\n                      label=\"Relationship Kind\"\n                      value={crit.relationshipKind}\n                      onChange={(v) => updateCriterion(index, { ...crit, relationshipKind: v })}\n                      options={relationshipKindOptions}\n                    />\n                  )}\n                </div>\n                <button className=\"btn-icon btn-icon-danger\" onClick={() => removeCriterion(index)}>\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addCriterion}>\n          + Add Criterion\n        </button>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Meta Entity</div>\n        <div className=\"section-desc\">Configuration for the meta-entity created from clusters.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Kind\"\n            value={config.metaEntity?.kind}\n            onChange={(v) => updateMetaEntity(\"kind\", v)}\n            options={entityKindOptions}\n          />\n          <div className=\"form-group\">\n            <label htmlFor=\"status\" className=\"label\">Status</label>\n            <input id=\"status\"\n              type=\"text\"\n              value={config.metaEntity?.status || \"\"}\n              onChange={(e) => updateMetaEntity(\"status\", e.target.value)}\n              className=\"input\"\n            />\n          </div>\n        </div>\n        <div className=\"mt-xl\">\n          <div className=\"form-group\">\n            <label className=\"label\">Description Template\n            <LocalTextArea\n              value={config.metaEntity?.descriptionTemplate || \"\"}\n              onChange={(value) => updateMetaEntity(\"descriptionTemplate\", value)}\n              placeholder=\"Use {names}, {count} placeholders\"\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Narration Template</div>\n        <div className=\"section-desc mb-md text-xs\">\n          Syntax: {\"{list:members}\"}, {\"{count}\"}, {\"{field|fallback}\"}.\n        </div>\n        <LocalTextArea\n          value={config.narrationTemplate || \"\"}\n          onChange={(value) => updateConfig(\"narrationTemplate\", value || undefined)}\n          placeholder=\"e.g., {list:members} united to form a new alliance.\"\n          rows={2}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["CLUSTERING_CRITERIA_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput", "LocalTextArea"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/CommonSettingsTab.jsx::CommonSettingsTab", "name": "CommonSettingsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/CommonSettingsTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function CommonSettingsTab({ system, onChange, schema, pressures }) {\n  const config = system.config;\n  const selection = config.selection || DEFAULT_SELECTION;\n  const supportsSelection = [\n    \"graphContagion\",\n    \"connectionEvolution\",\n    \"thresholdTrigger\",\n    \"clusterFormation\",\n    \"tagDiffusion\",\n    \"planeDiffusion\",\n  ].includes(system.systemType);\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  return (\n    <div>\n      {supportsSelection && (\n        <div className=\"section\">\n          <div className=\"section-title\">Entity Selection</div>\n          <div className=\"section-desc\">Define which entities this system operates on.</div>\n          <SelectionRuleEditor\n            value={selection}\n            onChange={(next) => updateConfig(\"selection\", next)}\n            schema={schema}\n            availableRefs={[]}\n            showPickStrategy={false}\n            showMaxResults={false}\n            showFilters\n            allowAnyKind\n            showExcludeSubtypes\n          />\n        </div>\n      )}\n\n      <div className=\"section\">\n        <div className=\"section-title\">Throttling</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Throttle Chance (0-1)\n            <NumberInput\n              value={config.throttleChance}\n              onChange={(v) => updateConfig(\"throttleChance\", v)}\n              className=\"input\"\n              min={0}\n              max={1}\n              step={0.1}\n              placeholder=\"0.2\"\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Cooldown (ticks)\n            <NumberInput\n              value={config.cooldown}\n              onChange={(v) => updateConfig(\"cooldown\", v)}\n              className=\"input\"\n              min={0}\n              placeholder=\"0\"\n              allowEmpty\n              integer\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <PressureChangesEditor\n          value={config.pressureChanges || EMPTY_PRESSURE_CHANGES}\n          onChange={(v) =>\n            updateConfig(\"pressureChanges\", Object.keys(v).length > 0 ? v : undefined)\n          }\n          pressures={pressures}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema, pressures }", "type": "{ system: any; onChange: Function; schema: any; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SelectionRuleEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "PressureChangesEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["PressureChangesEditor", "NumberInput"], "category": "internal"}, {"source": "../../shared/SelectionRuleEditor", "specifiers": ["SelectionRuleEditor"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/ConnectionEvolutionTab.jsx::ConnectionEvolutionTab", "name": "ConnectionEvolutionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/ConnectionEvolutionTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function ConnectionEvolutionTab({ system, onChange, schema }) {\n  const config = system.config;\n  const selectionKind =\n    config.selection?.kind && config.selection.kind !== \"any\" ? config.selection.kind : undefined;\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const getSubtypeOptions = (kind) => {\n    if (!kind) return [];\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateMetric = (field, value) => {\n    updateConfig(\"metric\", { ...config.metric, [field]: value });\n  };\n\n  // Rules\n  const rules = config.rules || [];\n\n  const addRule = () => {\n    updateConfig(\"rules\", [\n      ...rules,\n      {\n        condition: { operator: \">=\", threshold: 1 },\n        probability: 0.1,\n        action: { type: \"adjust_prominence\", entity: \"$self\", delta: 0.2 },\n      },\n    ]);\n  };\n\n  const updateRule = (index, rule) => {\n    const newRules = [...rules];\n    newRules[index] = rule;\n    updateConfig(\"rules\", newRules);\n  };\n\n  const removeRule = (index) => {\n    updateConfig(\n      \"rules\",\n      rules.filter((_, i) => i !== index)\n    );\n  };\n\n  // Subtype bonuses\n  const subtypeBonuses = config.subtypeBonuses || [];\n\n  const addSubtypeBonus = () => {\n    updateConfig(\"subtypeBonuses\", [...subtypeBonuses, { subtype: \"\", bonus: 0 }]);\n  };\n\n  const updateSubtypeBonus = (index, bonus) => {\n    const newBonuses = [...subtypeBonuses];\n    newBonuses[index] = bonus;\n    updateConfig(\"subtypeBonuses\", newBonuses);\n  };\n\n  const removeSubtypeBonus = (index) => {\n    updateConfig(\n      \"subtypeBonuses\",\n      subtypeBonuses.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Metric</div>\n        <div className=\"section-desc\">How entities are measured for rule evaluation.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Metric Type\"\n            value={config.metric?.type || \"connection_count\"}\n            onChange={(v) => updateMetric(\"type\", v)}\n            options={METRIC_TYPES}\n          />\n          <ReferenceDropdown\n            label=\"Direction\"\n            value={config.metric?.direction || \"both\"}\n            onChange={(v) => updateMetric(\"direction\", v)}\n            options={DIRECTIONS}\n          />\n          {(config.metric?.type === \"connection_count\" ||\n            config.metric?.type === \"relationship_count\") && (\n            <div className=\"form-group\">\n              <label htmlFor=\"filter-by-relationship-kinds-optional\" className=\"label\">Filter by Relationship Kinds (optional)</label>\n              <input id=\"filter-by-relationship-kinds-optional\"\n                type=\"text\"\n                value={(config.metric?.relationshipKinds || []).join(\", \")}\n                onChange={(e) => {\n                  const kinds = e.target.value\n                    .split(\",\")\n                    .map((s) => s.trim())\n                    .filter(Boolean);\n                  updateMetric(\"relationshipKinds\", kinds.length > 0 ? kinds : undefined);\n                }}\n                className=\"input\"\n                placeholder=\"Leave empty for all kinds\"\n              />\n            </div>\n          )}\n          {config.metric?.type === \"shared_relationship\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Shared Relationship Kind\"\n                value={config.metric?.sharedRelationshipKind}\n                onChange={(v) => updateMetric(\"sharedRelationshipKind\", v)}\n                options={relationshipKindOptions}\n              />\n              <ReferenceDropdown\n                label=\"Shared Direction\"\n                value={config.metric?.sharedDirection || \"src\"}\n                onChange={(v) => updateMetric(\"sharedDirection\", v)}\n                options={[\n                  { value: \"src\", label: \"Source (outgoing)\" },\n                  { value: \"dst\", label: \"Destination (incoming)\" },\n                ]}\n              />\n            </>\n          )}\n          <div className=\"form-group\">\n            <label className=\"label\">Min Strength\n            <NumberInput\n              value={config.metric?.minStrength}\n              onChange={(v) => updateMetric(\"minStrength\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n              placeholder=\"0\"\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Rules ({rules.length})</div>\n        <div className=\"section-desc\">Conditions and actions based on the metric.</div>\n\n        {rules.map((rule, index) => (\n          <RuleCard\n            key={index}\n            rule={rule}\n            onChange={(r) => updateRule(index, r)}\n            onRemove={() => removeRule(index)}\n            schema={schema}\n          />\n        ))}\n\n        <button className=\"btn-add\" onClick={addRule}>\n          + Add Rule\n        </button>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Subtype Bonuses ({subtypeBonuses.length})</div>\n        <div className=\"section-desc\">Bonuses added to metric value based on entity subtype.</div>\n\n        {subtypeBonuses.map((bonus, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"py-lg px-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <ReferenceDropdown\n                    label=\"Subtype\"\n                    value={bonus.subtype}\n                    onChange={(v) => updateSubtypeBonus(index, { ...bonus, subtype: v })}\n                    options={getSubtypeOptions(selectionKind)}\n                  />\n                  <div className=\"form-group\">\n                    <label className=\"label\">Bonus\n                    <NumberInput\n                      value={bonus.bonus}\n                      onChange={(v) => updateSubtypeBonus(index, { ...bonus, bonus: v ?? 0 })}\n                    />\n                    </label>\n                  </div>\n                </div>\n                <button\n                  className=\"btn-icon btn-icon-danger\"\n                  onClick={() => removeSubtypeBonus(index)}\n                >\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addSubtypeBonus}>\n          + Add Subtype Bonus\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "RuleCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["METRIC_TYPES", "DIRECTIONS"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput", "LocalTextArea"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}, {"source": "./ConnectionEvolutionTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/FrameworkSystemTab.jsx::FrameworkSystemTab", "name": "FrameworkSystemTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/FrameworkSystemTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n */\nexport function FrameworkSystemTab({ system, onChange }) {\n  const config = system.config;\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Framework System</div>\n        <div className=\"info-box-text\">\n          This is a framework-level system with specific configuration options.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Configuration</div>\n\n        {system.systemType === \"eraTransition\" && (\n          <div className=\"form-grid\">\n            <p className=\"label grid-col-full text-dim\">\n              Era transition timing is controlled by per-era exitConditions in eras.json. Add a time\n              condition (e.g., {`{ type: 'time_elapsed', minTicks: 25 }`}) to control minimum era\n              length.\n            </p>\n          </div>\n        )}\n\n        {system.systemType === \"universalCatalyst\" && (\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label\">Action Attempt Rate\n              <NumberInput\n                value={config.actionAttemptRate}\n                onChange={(v) => updateConfig(\"actionAttemptRate\", v)}\n                className=\"input\"\n                step={0.1}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Pressure Multiplier\n              <NumberInput\n                value={config.pressureMultiplier}\n                onChange={(v) => updateConfig(\"pressureMultiplier\", v)}\n                className=\"input\"\n                step={0.1}\n                min={0}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Prominence Up % on Success\n              <NumberInput\n                value={config.prominenceUpChanceOnSuccess}\n                onChange={(v) => updateConfig(\"prominenceUpChanceOnSuccess\", v)}\n                className=\"input\"\n                step={0.05}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Prominence Down % on Failure\n              <NumberInput\n                value={config.prominenceDownChanceOnFailure}\n                onChange={(v) => updateConfig(\"prominenceDownChanceOnFailure\", v)}\n                className=\"input\"\n                step={0.05}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        )}\n\n        {system.systemType === \"relationshipMaintenance\" && (\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label\">Maintenance Frequency\n              <NumberInput\n                value={config.maintenanceFrequency}\n                onChange={(v) => updateConfig(\"maintenanceFrequency\", v)}\n                className=\"input\"\n                min={1}\n                allowEmpty\n                integer\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Cull Threshold\n              <NumberInput\n                value={config.cullThreshold}\n                onChange={(v) => updateConfig(\"cullThreshold\", v)}\n                className=\"input\"\n                step={0.05}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Grace Period\n              <NumberInput\n                value={config.gracePeriod}\n                onChange={(v) => updateConfig(\"gracePeriod\", v)}\n                className=\"input\"\n                min={0}\n                allowEmpty\n                integer\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Reinforcement Bonus\n              <NumberInput\n                value={config.reinforcementBonus}\n                onChange={(v) => updateConfig(\"reinforcementBonus\", v)}\n                className=\"input\"\n                step={0.01}\n                min={0}\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange }", "type": "{ system: any; onChange: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "p", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["NumberInput"], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/GraphContagionTab.jsx::GraphContagionTab", "name": "GraphContagionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/GraphContagionTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function GraphContagionTab({ system, onChange, schema }) {\n  const config = system.config;\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateContagion = (field, value) => {\n    updateConfig(\"contagion\", { ...config.contagion, [field]: value });\n  };\n\n  const updateTransmission = (field, value) => {\n    updateConfig(\"transmission\", { ...config.transmission, [field]: value });\n  };\n\n  const updateInfectionAction = (field, value) => {\n    updateConfig(\"infectionAction\", { ...config.infectionAction, [field]: value });\n  };\n\n  // Vectors\n  const vectors = config.vectors || [];\n\n  const addVector = () => {\n    updateConfig(\"vectors\", [\n      ...vectors,\n      { relationshipKind: \"\", direction: \"both\", minStrength: 0.5 },\n    ]);\n  };\n\n  const updateVector = (index, field, value) => {\n    const newVectors = [...vectors];\n    newVectors[index] = { ...newVectors[index], [field]: value };\n    updateConfig(\"vectors\", newVectors);\n  };\n\n  const removeVector = (index) => {\n    updateConfig(\n      \"vectors\",\n      vectors.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Contagion Source</div>\n        <div className=\"section-desc\">What is being spread through the network.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Type\"\n            value={config.contagion?.type || \"relationship\"}\n            onChange={(v) => updateContagion(\"type\", v)}\n            options={[\n              { value: \"relationship\", label: \"Relationship\" },\n              { value: \"tag\", label: \"Tag\" },\n            ]}\n          />\n          {config.contagion?.type === \"relationship\" && (\n            <ReferenceDropdown\n              label=\"Relationship Kind\"\n              value={config.contagion?.relationshipKind}\n              onChange={(v) => updateContagion(\"relationshipKind\", v)}\n              options={relationshipKindOptions}\n            />\n          )}\n          {config.contagion?.type === \"tag\" && (\n            <div className=\"form-group\">\n              <label htmlFor=\"tag\" className=\"label\">Tag</label>\n              <input id=\"tag\"\n                type=\"text\"\n                value={config.contagion?.tagPattern || \"\"}\n                onChange={(e) => updateContagion(\"tagPattern\", e.target.value)}\n                className=\"input\"\n              />\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Transmission Vectors ({vectors.length})</div>\n        <div className=\"section-desc\">Relationships through which the contagion spreads.</div>\n\n        {vectors.map((vector, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"p-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <ReferenceDropdown\n                    label=\"Relationship Kind\"\n                    value={vector.relationshipKind}\n                    onChange={(v) => updateVector(index, \"relationshipKind\", v)}\n                    options={relationshipKindOptions}\n                  />\n                  <ReferenceDropdown\n                    label=\"Direction\"\n                    value={vector.direction || \"both\"}\n                    onChange={(v) => updateVector(index, \"direction\", v)}\n                    options={DIRECTIONS}\n                  />\n                  <div className=\"form-group\">\n                    <label className=\"label\">Min Strength\n                    <NumberInput\n                      value={vector.minStrength}\n                      onChange={(v) => updateVector(index, \"minStrength\", v)}\n                      className=\"input\"\n                      step={0.1}\n                      min={0}\n                      max={1}\n                      allowEmpty\n                    />\n                    </label>\n                  </div>\n                </div>\n                <button className=\"btn-icon btn-icon-danger\" onClick={() => removeVector(index)}>\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addVector}>\n          + Add Vector\n        </button>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Transmission Rates</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Base Rate\n            <NumberInput\n              value={config.transmission?.baseRate}\n              onChange={(v) => updateTransmission(\"baseRate\", v)}\n              className=\"input\"\n              step={0.05}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Contact Multiplier\n            <NumberInput\n              value={config.transmission?.contactMultiplier}\n              onChange={(v) => updateTransmission(\"contactMultiplier\", v)}\n              className=\"input\"\n              step={0.05}\n              min={0}\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Max Probability\n            <NumberInput\n              value={config.transmission?.maxProbability}\n              onChange={(v) => updateTransmission(\"maxProbability\", v)}\n              className=\"input\"\n              step={0.05}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Infection Action</div>\n        <div className=\"section-desc\">What happens when an entity gets infected.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Action Type\"\n            value={config.infectionAction?.type || \"create_relationship\"}\n            onChange={(v) => updateInfectionAction(\"type\", v)}\n            options={[\n              { value: \"create_relationship\", label: \"Create Relationship\" },\n              { value: \"set_tag\", label: \"Set Tag\" },\n            ]}\n          />\n          {config.infectionAction?.type === \"create_relationship\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Relationship Kind\"\n                value={config.infectionAction?.kind}\n                onChange={(v) => updateInfectionAction(\"kind\", v)}\n                options={relationshipKindOptions}\n              />\n              <ReferenceDropdown\n                label=\"Source\"\n                value={config.infectionAction?.src || \"$self\"}\n                onChange={(v) => updateInfectionAction(\"src\", v)}\n                options={[\n                  { value: \"$self\", label: \"$self\" },\n                  { value: \"$source\", label: \"$source\" },\n                  { value: \"$contagion_source\", label: \"$contagion_source\" },\n                ]}\n              />\n              <ReferenceDropdown\n                label=\"Destination\"\n                value={config.infectionAction?.dst || \"$source\"}\n                onChange={(v) => updateInfectionAction(\"dst\", v)}\n                options={[\n                  { value: \"$self\", label: \"$self\" },\n                  { value: \"$source\", label: \"$source\" },\n                  { value: \"$contagion_source\", label: \"$contagion_source\" },\n                ]}\n              />\n              <div className=\"form-group\">\n                <label className=\"label\">Strength\n                <NumberInput\n                  value={config.infectionAction?.strength}\n                  onChange={(v) => updateInfectionAction(\"strength\", v)}\n                  className=\"input\"\n                  step={0.1}\n                  min={0}\n                  max={1}\n                  allowEmpty\n                />\n                </label>\n              </div>\n              <div className=\"form-group\">\n                <label className=\"checkbox-label\">\n                  <input\n                    type=\"checkbox\"\n                    checked={config.infectionAction?.bidirectional || false}\n                    onChange={(e) =>\n                      updateInfectionAction(\"bidirectional\", e.target.checked || undefined)\n                    }\n                    className=\"checkbox\"\n                  />\n                  Bidirectional\n                </label>\n              </div>\n            </>\n          )}\n          {config.infectionAction?.type === \"set_tag\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Entity\"\n                value={config.infectionAction?.entity || \"$self\"}\n                onChange={(v) => updateInfectionAction(\"entity\", v)}\n                options={[\n                  { value: \"$self\", label: \"$self\" },\n                  { value: \"$source\", label: \"$source\" },\n                  { value: \"$contagion_source\", label: \"$contagion_source\" },\n                ]}\n              />\n              <div className=\"form-group\">\n                <label className=\"label\">Tag\n                <TagSelector\n                  value={config.infectionAction?.tag ? [config.infectionAction.tag] : []}\n                  onChange={(tags) => updateInfectionAction(\"tag\", tags[0] || \"\")}\n                  tagRegistry={schema?.tagRegistry || []}\n                  placeholder=\"Select tag...\"\n                  singleSelect\n                />\n                </label>\n              </div>\n              <div className=\"form-group\">\n                <label htmlFor=\"value-optional\" className=\"label\">Value (optional)</label>\n                <input id=\"value-optional\"\n                  type=\"text\"\n                  value={\n                    config.infectionAction?.value !== undefined\n                      ? String(config.infectionAction.value)\n                      : \"\"\n                  }\n                  onChange={(e) => updateInfectionAction(\"value\", e.target.value || undefined)}\n                  className=\"input\"\n                  placeholder=\"true\"\n                />\n              </div>\n            </>\n          )}\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">Narration Template</span>\n          <div className=\"section-desc mb-xs text-xs\">\n            Syntax: {\"{$self.field}\"}, {\"{$source.field}\"}, {\"{$contagion_source.field}\"},{\" \"}\n            {\"{field|fallback}\"}.\n          </div>\n          <LocalTextArea\n            value={config.narrationTemplate || \"\"}\n// ... (truncated)", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["DIRECTIONS"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput", "LocalTextArea"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Function} props.onDelete - Called to delete the system\n */\nexport function OverviewTab({ system, onChange, onDelete }) {\n  const config = system.config;\n  const typeConfig = SYSTEM_TYPES[system.systemType] || {};\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(config.id, (value) =>\n    updateConfig(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(config.name, (value) =>\n    updateConfig(\"name\", value)\n  );\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"system-id\" className=\"label\">System ID</label>\n            <input id=\"system-id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"display-name\" className=\"label\">Display Name</label>\n            <input id=\"display-name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <div className=\"form-group\">\n            <label className=\"label\">Description\n            <LocalTextArea\n              value={config.description || \"\"}\n              onChange={(value) => updateConfig(\"description\", value)}\n              className=\"ot-description-textarea\"\n              placeholder=\"Describe what this system does...\"\n            />\n            </label>\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">System Type</span>\n          <div className=\"flex items-center gap-lg\">\n            {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color from config */}\n            <span\n              className=\"type-badge\"\n              style={{ '--ot-type-bg': `${typeConfig.color}30`, '--ot-type-color': typeConfig.color, backgroundColor: 'var(--ot-type-bg)', color: 'var(--ot-type-color)' }}\n            >\n              {typeConfig.icon} {typeConfig.label}\n            </span>\n            <span className=\"text-muted ot-type-desc\">\n              {typeConfig.desc}\n            </span>\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Enabled\n          <EnableToggle\n            enabled={system.enabled !== false}\n            onChange={(enabled) => onChange({ ...system, enabled })}\n            label={system.enabled !== false ? \"System is active\" : \"System is disabled\"}\n          />\n          </label>\n        </div>\n      </div>\n\n      <div className=\"danger-zone\">\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete System\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, onDelete }", "type": "{ system: any; onChange: Function; onDelete: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useLocalInputState", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::CommonSettingsTab", "name": "CommonSettingsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function CommonSettingsTab({ system, onChange, schema, pressures }) {\n  const config = system.config;\n  const selection = config.selection || DEFAULT_SELECTION;\n  const supportsSelection = [\n    \"graphContagion\",\n    \"connectionEvolution\",\n    \"thresholdTrigger\",\n    \"clusterFormation\",\n    \"tagDiffusion\",\n    \"planeDiffusion\",\n  ].includes(system.systemType);\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  return (\n    <div>\n      {supportsSelection && (\n        <div className=\"section\">\n          <div className=\"section-title\">Entity Selection</div>\n          <div className=\"section-desc\">Define which entities this system operates on.</div>\n          <SelectionRuleEditor\n            value={selection}\n            onChange={(next) => updateConfig(\"selection\", next)}\n            schema={schema}\n            availableRefs={[]}\n            showPickStrategy={false}\n            showMaxResults={false}\n            showFilters\n            allowAnyKind\n            showExcludeSubtypes\n          />\n        </div>\n      )}\n\n      <div className=\"section\">\n        <div className=\"section-title\">Throttling</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Throttle Chance (0-1)\n            <NumberInput\n              value={config.throttleChance}\n              onChange={(v) => updateConfig(\"throttleChance\", v)}\n              className=\"input\"\n              min={0}\n              max={1}\n              step={0.1}\n              placeholder=\"0.2\"\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Cooldown (ticks)\n            <NumberInput\n              value={config.cooldown}\n              onChange={(v) => updateConfig(\"cooldown\", v)}\n              className=\"input\"\n              min={0}\n              placeholder=\"0\"\n              allowEmpty\n              integer\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <PressureChangesEditor\n          value={config.pressureChanges || EMPTY_PRESSURE_CHANGES}\n          onChange={(v) =>\n            updateConfig(\"pressureChanges\", Object.keys(v).length > 0 ? v : undefined)\n          }\n          pressures={pressures}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema, pressures }", "type": "{ system: any; onChange: Function; schema: any; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "SelectionRuleEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "PressureChangesEditor", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::GraphContagionTab", "name": "GraphContagionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function GraphContagionTab({ system, onChange, schema }) {\n  const config = system.config;\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateContagion = (field, value) => {\n    updateConfig(\"contagion\", { ...config.contagion, [field]: value });\n  };\n\n  const updateTransmission = (field, value) => {\n    updateConfig(\"transmission\", { ...config.transmission, [field]: value });\n  };\n\n  const updateInfectionAction = (field, value) => {\n    updateConfig(\"infectionAction\", { ...config.infectionAction, [field]: value });\n  };\n\n  // Vectors\n  const vectors = config.vectors || [];\n\n  const addVector = () => {\n    updateConfig(\"vectors\", [\n      ...vectors,\n      { relationshipKind: \"\", direction: \"both\", minStrength: 0.5 },\n    ]);\n  };\n\n  const updateVector = (index, field, value) => {\n    const newVectors = [...vectors];\n    newVectors[index] = { ...newVectors[index], [field]: value };\n    updateConfig(\"vectors\", newVectors);\n  };\n\n  const removeVector = (index) => {\n    updateConfig(\n      \"vectors\",\n      vectors.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Contagion Source</div>\n        <div className=\"section-desc\">What is being spread through the network.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Type\"\n            value={config.contagion?.type || \"relationship\"}\n            onChange={(v) => updateContagion(\"type\", v)}\n            options={[\n              { value: \"relationship\", label: \"Relationship\" },\n              { value: \"tag\", label: \"Tag\" },\n            ]}\n          />\n          {config.contagion?.type === \"relationship\" && (\n            <ReferenceDropdown\n              label=\"Relationship Kind\"\n              value={config.contagion?.relationshipKind}\n              onChange={(v) => updateContagion(\"relationshipKind\", v)}\n              options={relationshipKindOptions}\n            />\n          )}\n          {config.contagion?.type === \"tag\" && (\n            <div className=\"form-group\">\n              <label htmlFor=\"tag\" className=\"label\">Tag</label>\n              <input id=\"tag\"\n                type=\"text\"\n                value={config.contagion?.tagPattern || \"\"}\n                onChange={(e) => updateContagion(\"tagPattern\", e.target.value)}\n                className=\"input\"\n              />\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Transmission Vectors ({vectors.length})</div>\n        <div className=\"section-desc\">Relationships through which the contagion spreads.</div>\n\n        {vectors.map((vector, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"p-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <ReferenceDropdown\n                    label=\"Relationship Kind\"\n                    value={vector.relationshipKind}\n                    onChange={(v) => updateVector(index, \"relationshipKind\", v)}\n                    options={relationshipKindOptions}\n                  />\n                  <ReferenceDropdown\n                    label=\"Direction\"\n                    value={vector.direction || \"both\"}\n                    onChange={(v) => updateVector(index, \"direction\", v)}\n                    options={DIRECTIONS}\n                  />\n                  <div className=\"form-group\">\n                    <label className=\"label\">Min Strength\n                    <NumberInput\n                      value={vector.minStrength}\n                      onChange={(v) => updateVector(index, \"minStrength\", v)}\n                      className=\"input\"\n                      step={0.1}\n                      min={0}\n                      max={1}\n                      allowEmpty\n                    />\n                    </label>\n                  </div>\n                </div>\n                <button className=\"btn-icon btn-icon-danger\" onClick={() => removeVector(index)}>\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addVector}>\n          + Add Vector\n        </button>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Transmission Rates</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Base Rate\n            <NumberInput\n              value={config.transmission?.baseRate}\n              onChange={(v) => updateTransmission(\"baseRate\", v)}\n              className=\"input\"\n              step={0.05}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Contact Multiplier\n            <NumberInput\n              value={config.transmission?.contactMultiplier}\n              onChange={(v) => updateTransmission(\"contactMultiplier\", v)}\n              className=\"input\"\n              step={0.05}\n              min={0}\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Max Probability\n            <NumberInput\n              value={config.transmission?.maxProbability}\n              onChange={(v) => updateTransmission(\"maxProbability\", v)}\n              className=\"input\"\n              step={0.05}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Infection Action</div>\n        <div className=\"section-desc\">What happens when an entity gets infected.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Action Type\"\n            value={config.infectionAction?.type || \"create_relationship\"}\n            onChange={(v) => updateInfectionAction(\"type\", v)}\n            options={[\n              { value: \"create_relationship\", label: \"Create Relationship\" },\n              { value: \"set_tag\", label: \"Set Tag\" },\n            ]}\n          />\n          {config.infectionAction?.type === \"create_relationship\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Relationship Kind\"\n                value={config.infectionAction?.kind}\n                onChange={(v) => updateInfectionAction(\"kind\", v)}\n                options={relationshipKindOptions}\n              />\n              <ReferenceDropdown\n                label=\"Source\"\n                value={config.infectionAction?.src || \"$self\"}\n                onChange={(v) => updateInfectionAction(\"src\", v)}\n                options={[\n                  { value: \"$self\", label: \"$self\" },\n                  { value: \"$source\", label: \"$source\" },\n                  { value: \"$contagion_source\", label: \"$contagion_source\" },\n                ]}\n              />\n              <ReferenceDropdown\n                label=\"Destination\"\n                value={config.infectionAction?.dst || \"$source\"}\n                onChange={(v) => updateInfectionAction(\"dst\", v)}\n                options={[\n                  { value: \"$self\", label: \"$self\" },\n                  { value: \"$source\", label: \"$source\" },\n                  { value: \"$contagion_source\", label: \"$contagion_source\" },\n                ]}\n              />\n              <div className=\"form-group\">\n                <label className=\"label\">Strength\n                <NumberInput\n                  value={config.infectionAction?.strength}\n                  onChange={(v) => updateInfectionAction(\"strength\", v)}\n                  className=\"input\"\n                  step={0.1}\n                  min={0}\n                  max={1}\n                  allowEmpty\n                />\n                </label>\n              </div>\n              <div className=\"form-group\">\n                <label className=\"checkbox-label\">\n                  <input\n                    type=\"checkbox\"\n                    checked={config.infectionAction?.bidirectional || false}\n                    onChange={(e) =>\n                      updateInfectionAction(\"bidirectional\", e.target.checked || undefined)\n                    }\n                    className=\"checkbox\"\n                  />\n                  Bidirectional\n                </label>\n              </div>\n            </>\n          )}\n          {config.infectionAction?.type === \"set_tag\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Entity\"\n                value={config.infectionAction?.entity || \"$self\"}\n                onChange={(v) => updateInfectionAction(\"entity\", v)}\n                options={[\n                  { value: \"$self\", label: \"$self\" },\n                  { value: \"$source\", label: \"$source\" },\n                  { value: \"$contagion_source\", label: \"$contagion_source\" },\n                ]}\n              />\n              <div className=\"form-group\">\n                <label className=\"label\">Tag\n                <TagSelector\n                  value={config.infectionAction?.tag ? [config.infectionAction.tag] : []}\n                  onChange={(tags) => updateInfectionAction(\"tag\", tags[0] || \"\")}\n                  tagRegistry={schema?.tagRegistry || []}\n                  placeholder=\"Select tag...\"\n                  singleSelect\n                />\n                </label>\n              </div>\n              <div className=\"form-group\">\n                <label htmlFor=\"value-optional\" className=\"label\">Value (optional)</label>\n                <input id=\"value-optional\"\n                  type=\"text\"\n                  value={\n                    config.infectionAction?.value !== undefined\n                      ? String(config.infectionAction.value)\n                      : \"\"\n                  }\n                  onChange={(e) => updateInfectionAction(\"value\", e.target.value || undefined)}\n                  className=\"input\"\n                  placeholder=\"true\"\n                />\n              </div>\n            </>\n          )}\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">Narration Template</span>\n          <div className=\"section-desc mb-xs text-xs\">\n            Syntax: {\"{$self.field}\"}, {\"{$source.field}\"}, {\"{$contagion_source.field}\"},{\" \"}\n            {\"{field|fallback}\"}.\n          </div>\n          <LocalTextArea\n            value={config.narrationTemplate || \"\"}\n// ... (truncated)", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::ConnectionEvolutionTab", "name": "ConnectionEvolutionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function ConnectionEvolutionTab({ system, onChange, schema }) {\n  const config = system.config;\n  const selectionKind =\n    config.selection?.kind && config.selection.kind !== \"any\" ? config.selection.kind : undefined;\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const getSubtypeOptions = (kind) => {\n    if (!kind) return [];\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateMetric = (field, value) => {\n    updateConfig(\"metric\", { ...config.metric, [field]: value });\n  };\n\n  // Rules\n  const rules = config.rules || [];\n\n  const addRule = () => {\n    updateConfig(\"rules\", [\n      ...rules,\n      {\n        condition: { operator: \">=\", threshold: 1 },\n        probability: 0.1,\n        action: { type: \"adjust_prominence\", entity: \"$self\", delta: 0.2 },\n      },\n    ]);\n  };\n\n  const updateRule = (index, rule) => {\n    const newRules = [...rules];\n    newRules[index] = rule;\n    updateConfig(\"rules\", newRules);\n  };\n\n  const removeRule = (index) => {\n    updateConfig(\n      \"rules\",\n      rules.filter((_, i) => i !== index)\n    );\n  };\n\n  // Subtype bonuses\n  const subtypeBonuses = config.subtypeBonuses || [];\n\n  const addSubtypeBonus = () => {\n    updateConfig(\"subtypeBonuses\", [...subtypeBonuses, { subtype: \"\", bonus: 0 }]);\n  };\n\n  const updateSubtypeBonus = (index, bonus) => {\n    const newBonuses = [...subtypeBonuses];\n    newBonuses[index] = bonus;\n    updateConfig(\"subtypeBonuses\", newBonuses);\n  };\n\n  const removeSubtypeBonus = (index) => {\n    updateConfig(\n      \"subtypeBonuses\",\n      subtypeBonuses.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Metric</div>\n        <div className=\"section-desc\">How entities are measured for rule evaluation.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Metric Type\"\n            value={config.metric?.type || \"connection_count\"}\n            onChange={(v) => updateMetric(\"type\", v)}\n            options={METRIC_TYPES}\n          />\n          <ReferenceDropdown\n            label=\"Direction\"\n            value={config.metric?.direction || \"both\"}\n            onChange={(v) => updateMetric(\"direction\", v)}\n            options={DIRECTIONS}\n          />\n          {(config.metric?.type === \"connection_count\" ||\n            config.metric?.type === \"relationship_count\") && (\n            <div className=\"form-group\">\n              <label htmlFor=\"filter-by-relationship-kinds-optional\" className=\"label\">Filter by Relationship Kinds (optional)</label>\n              <input id=\"filter-by-relationship-kinds-optional\"\n                type=\"text\"\n                value={(config.metric?.relationshipKinds || []).join(\", \")}\n                onChange={(e) => {\n                  const kinds = e.target.value\n                    .split(\",\")\n                    .map((s) => s.trim())\n                    .filter(Boolean);\n                  updateMetric(\"relationshipKinds\", kinds.length > 0 ? kinds : undefined);\n                }}\n                className=\"input\"\n                placeholder=\"Leave empty for all kinds\"\n              />\n            </div>\n          )}\n          {config.metric?.type === \"shared_relationship\" && (\n            <>\n              <ReferenceDropdown\n                label=\"Shared Relationship Kind\"\n                value={config.metric?.sharedRelationshipKind}\n                onChange={(v) => updateMetric(\"sharedRelationshipKind\", v)}\n                options={relationshipKindOptions}\n              />\n              <ReferenceDropdown\n                label=\"Shared Direction\"\n                value={config.metric?.sharedDirection || \"src\"}\n                onChange={(v) => updateMetric(\"sharedDirection\", v)}\n                options={[\n                  { value: \"src\", label: \"Source (outgoing)\" },\n                  { value: \"dst\", label: \"Destination (incoming)\" },\n                ]}\n              />\n            </>\n          )}\n          <div className=\"form-group\">\n            <label className=\"label\">Min Strength\n            <NumberInput\n              value={config.metric?.minStrength}\n              onChange={(v) => updateMetric(\"minStrength\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n              placeholder=\"0\"\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Rules ({rules.length})</div>\n        <div className=\"section-desc\">Conditions and actions based on the metric.</div>\n\n        {rules.map((rule, index) => (\n          <RuleCard\n            key={index}\n            rule={rule}\n            onChange={(r) => updateRule(index, r)}\n            onRemove={() => removeRule(index)}\n            schema={schema}\n          />\n        ))}\n\n        <button className=\"btn-add\" onClick={addRule}>\n          + Add Rule\n        </button>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Subtype Bonuses ({subtypeBonuses.length})</div>\n        <div className=\"section-desc\">Bonuses added to metric value based on entity subtype.</div>\n\n        {subtypeBonuses.map((bonus, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"py-lg px-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <ReferenceDropdown\n                    label=\"Subtype\"\n                    value={bonus.subtype}\n                    onChange={(v) => updateSubtypeBonus(index, { ...bonus, subtype: v })}\n                    options={getSubtypeOptions(selectionKind)}\n                  />\n                  <div className=\"form-group\">\n                    <label className=\"label\">Bonus\n                    <NumberInput\n                      value={bonus.bonus}\n                      onChange={(v) => updateSubtypeBonus(index, { ...bonus, bonus: v ?? 0 })}\n                    />\n                    </label>\n                  </div>\n                </div>\n                <button\n                  className=\"btn-icon btn-icon-danger\"\n                  onClick={() => removeSubtypeBonus(index)}\n                >\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addSubtypeBonus}>\n          + Add Subtype Bonus\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "RuleCard", "children": [], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::ThresholdTriggerTab", "name": "ThresholdTriggerTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Pressure definitions\n */\nexport function ThresholdTriggerTab({ system, onChange, schema, pressures }) {\n  const config = system.config;\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddVarForm, setShowAddVarForm] = useState(false);\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  // Conditions\n  const conditions = config.conditions || [];\n\n  const addCondition = (type) => {\n    const newRule = createNewRule(type, pressures);\n    updateConfig(\"conditions\", [...conditions, newRule]);\n  };\n\n  const updateCondition = (index, cond) => {\n    const newConditions = [...conditions];\n    newConditions[index] = cond;\n    updateConfig(\"conditions\", newConditions);\n  };\n\n  const removeCondition = (index) => {\n    updateConfig(\n      \"conditions\",\n      conditions.filter((_, i) => i !== index)\n    );\n  };\n\n  // Variables\n  const variables = config.variables || {};\n\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$self\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    updateConfig(\"variables\", {\n      ...variables,\n      [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"random\" } },\n    });\n    setNewVarName(\"\");\n    setShowAddVarForm(false);\n  };\n\n  const updateVariable = (name, config) => {\n    updateConfig(\"variables\", { ...variables, [name]: config });\n  };\n\n  const removeVariable = (name) => {\n    const newVars = { ...variables };\n    delete newVars[name];\n    updateConfig(\"variables\", newVars);\n  };\n\n  // Build entity options for actions (include defined variables)\n  const entityOptions = [\n    { value: \"$self\", label: \"$self\" },\n    { value: \"$member\", label: \"$member\" },\n    { value: \"$member2\", label: \"$member2\" },\n    ...Object.keys(variables).map((v) => ({ value: v, label: v })),\n  ];\n\n  // Actions (mutations)\n  const actions = config.actions || [];\n\n  const createAction = (type) => {\n    const defaultPressure = pressures?.[0]?.id || \"\";\n    switch (type) {\n      case \"modify_pressure\":\n        return { type: \"modify_pressure\", pressureId: defaultPressure, delta: 0 };\n      case \"set_tag\":\n        return { type: \"set_tag\", entity: \"$self\", tag: \"\", value: true };\n      case \"remove_tag\":\n        return { type: \"remove_tag\", entity: \"$self\", tag: \"\" };\n      case \"change_status\":\n        return { type: \"change_status\", entity: \"$self\", newStatus: \"\" };\n      case \"adjust_prominence\":\n        return { type: \"adjust_prominence\", entity: \"$self\", delta: 0.25 };\n      case \"archive_relationship\":\n        return {\n          type: \"archive_relationship\",\n          entity: \"$self\",\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n      case \"adjust_relationship_strength\":\n        return {\n          type: \"adjust_relationship_strength\",\n          kind: \"\",\n          src: \"$self\",\n          dst: \"$self\",\n          delta: 0.1,\n        };\n      case \"transfer_relationship\":\n        return {\n          type: \"transfer_relationship\",\n          entity: \"$self\",\n          relationshipKind: \"\",\n          from: \"$self\",\n          to: \"$self\",\n        };\n      case \"update_rate_limit\":\n        return { type: \"update_rate_limit\" };\n      case \"for_each_related\":\n        return { type: \"for_each_related\", relationship: \"\", direction: \"both\", actions: [] };\n      case \"conditional\":\n        return {\n          type: \"conditional\",\n          condition: { type: \"random_chance\", chance: 0.5 },\n          thenActions: [],\n          elseActions: [],\n        };\n      case \"create_relationship\":\n      default:\n        return { type: \"create_relationship\", kind: \"\", src: \"$self\", dst: \"$self\", strength: 0.5 };\n    }\n  };\n\n  const addAction = (type) => {\n    updateConfig(\"actions\", [...actions, createAction(type)]);\n  };\n\n  const updateAction = (index, action) => {\n    const newActions = [...actions];\n    newActions[index] = action;\n    updateConfig(\"actions\", newActions);\n  };\n\n  const removeAction = (index) => {\n    updateConfig(\n      \"actions\",\n      actions.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Conditions ({conditions.length})</div>\n        <div className=\"section-desc\">\n          All conditions must pass for an entity to be included in the trigger.\n        </div>\n\n        {conditions.length === 0 ? (\n          <div className=\"empty-state-compact\">No conditions defined.</div>\n        ) : (\n          conditions.map((cond, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={cond}\n              onChange={(c) => updateCondition(index, c)}\n              onRemove={() => removeCondition(index)}\n              schema={schema}\n              pressures={pressures}\n            />\n          ))\n        )}\n\n        <AddRuleButton onAdd={addCondition} />\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Variables ({Object.keys(variables).length})</div>\n        <div className=\"section-desc\">\n          Variables select additional entities from the graph to use in actions. Referenced as{\" \"}\n          <code className=\"inline-code\">$varName</code> in action entity fields.\n        </div>\n\n        {Object.keys(variables).length === 0 && !showAddVarForm ? (\n          <div className=\"empty-state-compact\">No variables defined.</div>\n        ) : (\n          Object.entries(variables).map(([name, varConfig]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={varConfig}\n              onChange={(updated) => updateVariable(name, updated)}\n              onRemove={() => removeVariable(name)}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddVarForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddVarForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddVarForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Actions ({actions.length})</div>\n        <div className=\"section-desc\">\n          Mutations applied to each matching entity (or clusters when configured).\n        </div>\n\n        {actions.map((actionItem, index) => (\n          <div key={index} className=\"mb-lg\">\n            <MutationCard\n              mutation={actionItem}\n              onChange={(a) => updateAction(index, a)}\n              onRemove={() => removeAction(index)}\n              schema={schema}\n              pressures={pressures}\n              entityOptions={entityOptions}\n              typeOptions={TRIGGER_MUTATION_TYPES}\n              createMutation={createAction}\n              titlePrefix=\"Action\"\n            />\n            {actionItem.type === \"create_relationship\" && (\n              <label className=\"checkbox-label mt-md\">\n                <input\n                  type=\"checkbox\"\n                  checked={actionItem.betweenMatching || false}\n                  onChange={(e) =>\n                    updateAction(index, { ...actionItem, betweenMatching: e.target.checked })\n                  }\n                  className=\"checkbox\"\n                />\n                Between matching entities\n              </label>\n            )}\n          </div>\n        ))}\n\n        <div className=\"form-group mt-lg\">\n          <select\n            className=\"select\"\n            value=\"\"\n            onChange={(e) => {\n              if (!e.target.value) return;\n              addAction(e.target.value);\n            }}\n          >\n            <option value=\"\">+ Add action...</option>\n            {TRIGGER_MUTATION_TYPES.map((opt) => (\n              <option key={opt.value} value={opt.value}>\n                {opt.label}\n              </option>\n            ))}\n          </select>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Clustering</div>\n// ... (truncated)", "parameters": [{"name": "{ system, onChange, schema, pressures }", "type": "{ system: any; onChange: Function; schema: any; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "MutationCard", "children": [], "isMap": false, "isConditional": false}, {"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "select", "children": [{"tag": "option", "children": [], "isMap": false, "isConditional": false}, {"tag": "option", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::ClusterFormationTab", "name": "ClusterFormationTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function ClusterFormationTab({ system, onChange, schema }) {\n  const config = system.config;\n\n  const entityKindOptions = (schema?.entityKinds || []).map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateClustering = (field, value) => {\n    updateConfig(\"clustering\", { ...config.clustering, [field]: value });\n  };\n\n  const updateMetaEntity = (field, value) => {\n    updateConfig(\"metaEntity\", { ...config.metaEntity, [field]: value });\n  };\n\n  // Criteria\n  const criteria = config.clustering?.criteria || [];\n\n  const addCriterion = () => {\n    updateClustering(\"criteria\", [...criteria, { type: \"same_culture\", weight: 1.0 }]);\n  };\n\n  const updateCriterion = (index, crit) => {\n    const newCriteria = [...criteria];\n    newCriteria[index] = crit;\n    updateClustering(\"criteria\", newCriteria);\n  };\n\n  const removeCriterion = (index) => {\n    updateClustering(\n      \"criteria\",\n      criteria.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Clustering Configuration</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Min Size\n            <NumberInput\n              value={config.clustering?.minSize}\n              onChange={(v) => updateClustering(\"minSize\", v)}\n              min={2}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Max Size\n            <NumberInput\n              value={config.clustering?.maxSize}\n              onChange={(v) => updateClustering(\"maxSize\", v)}\n              min={2}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Minimum Score\n            <NumberInput\n              value={config.clustering?.minimumScore}\n              onChange={(v) => updateClustering(\"minimumScore\", v)}\n              min={0}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Clustering Criteria ({criteria.length})</label>\n        </div>\n\n        {criteria.map((crit, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"py-lg px-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <ReferenceDropdown\n                    label=\"Type\"\n                    value={crit.type}\n                    onChange={(v) => updateCriterion(index, { ...crit, type: v })}\n                    options={CLUSTERING_CRITERIA_TYPES}\n                  />\n                  <div className=\"form-group\">\n                    <label className=\"label\">Weight\n                    <NumberInput\n                      value={crit.weight}\n                      onChange={(v) => updateCriterion(index, { ...crit, weight: v ?? 0 })}\n                      min={0}\n                    />\n                    </label>\n                  </div>\n                  {crit.type === \"shared_relationship\" && (\n                    <ReferenceDropdown\n                      label=\"Relationship Kind\"\n                      value={crit.relationshipKind}\n                      onChange={(v) => updateCriterion(index, { ...crit, relationshipKind: v })}\n                      options={relationshipKindOptions}\n                    />\n                  )}\n                </div>\n                <button className=\"btn-icon btn-icon-danger\" onClick={() => removeCriterion(index)}>\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addCriterion}>\n          + Add Criterion\n        </button>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Meta Entity</div>\n        <div className=\"section-desc\">Configuration for the meta-entity created from clusters.</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Kind\"\n            value={config.metaEntity?.kind}\n            onChange={(v) => updateMetaEntity(\"kind\", v)}\n            options={entityKindOptions}\n          />\n          <div className=\"form-group\">\n            <label htmlFor=\"status\" className=\"label\">Status</label>\n            <input id=\"status\"\n              type=\"text\"\n              value={config.metaEntity?.status || \"\"}\n              onChange={(e) => updateMetaEntity(\"status\", e.target.value)}\n              className=\"input\"\n            />\n          </div>\n        </div>\n        <div className=\"mt-xl\">\n          <div className=\"form-group\">\n            <label className=\"label\">Description Template\n            <LocalTextArea\n              value={config.metaEntity?.descriptionTemplate || \"\"}\n              onChange={(value) => updateMetaEntity(\"descriptionTemplate\", value)}\n              placeholder=\"Use {names}, {count} placeholders\"\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Narration Template</div>\n        <div className=\"section-desc mb-md text-xs\">\n          Syntax: {\"{list:members}\"}, {\"{count}\"}, {\"{field|fallback}\"}.\n        </div>\n        <LocalTextArea\n          value={config.narrationTemplate || \"\"}\n          onChange={(value) => updateConfig(\"narrationTemplate\", value || undefined)}\n          placeholder=\"e.g., {list:members} united to form a new alliance.\"\n          rows={2}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::TagDiffusionTab", "name": "TagDiffusionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function TagDiffusionTab({ system, onChange, schema }) {\n  const config = system.config;\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateConvergence = (field, value) => {\n    updateConfig(\"convergence\", { ...config.convergence, [field]: value });\n  };\n\n  const updateDivergence = (field, value) => {\n    updateConfig(\"divergence\", { ...config.divergence, [field]: value });\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Connection</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Connection Kind\"\n            value={config.connectionKind}\n            onChange={(v) => updateConfig(\"connectionKind\", v)}\n            options={relationshipKindOptions}\n          />\n          <ReferenceDropdown\n            label=\"Direction\"\n            value={config.connectionDirection || \"both\"}\n            onChange={(v) => updateConfig(\"connectionDirection\", v)}\n            options={DIRECTIONS}\n          />\n          <div className=\"form-group\">\n            <label className=\"label\">Max Tags\n            <NumberInput\n              value={config.maxTags}\n              onChange={(v) => updateConfig(\"maxTags\", v)}\n              min={1}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Convergence</div>\n        <div className=\"section-desc\">Connected entities become more similar.</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tags\n            <TagSelector\n              value={config.convergence?.tags || []}\n              onChange={(tags) => updateConvergence(\"tags\", tags)}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Min Connections\n            <NumberInput\n              value={config.convergence?.minConnections}\n              onChange={(v) => updateConvergence(\"minConnections\", v)}\n              min={0}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Probability\n            <NumberInput\n              value={config.convergence?.probability}\n              onChange={(v) => updateConvergence(\"probability\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Divergence</div>\n        <div className=\"section-desc\">Isolated entities become more unique.</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tags\n            <TagSelector\n              value={config.divergence?.tags || []}\n              onChange={(tags) => updateDivergence(\"tags\", tags)}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Max Connections\n            <NumberInput\n              value={config.divergence?.maxConnections}\n              onChange={(v) => updateDivergence(\"maxConnections\", v)}\n              min={0}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Probability\n            <NumberInput\n              value={config.divergence?.probability}\n              onChange={(v) => updateDivergence(\"probability\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::PlaneDiffusionTab", "name": "PlaneDiffusionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema (for tag registry)\n */\nexport function PlaneDiffusionTab({ system, onChange, schema }) {\n  const config = system.config;\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateSources = (field, value) => {\n    updateConfig(\"sources\", { ...config.sources, [field]: value });\n  };\n\n  const updateSinks = (field, value) => {\n    updateConfig(\"sinks\", { ...config.sinks, [field]: value });\n  };\n\n  const updateDiffusion = (field, value) => {\n    updateConfig(\"diffusion\", { ...config.diffusion, [field]: value });\n  };\n\n  // Output tags\n  const outputTags = config.outputTags || [];\n\n  const addOutputTag = () => {\n    updateConfig(\"outputTags\", [...outputTags, { tag: \"\", minValue: 0 }]);\n  };\n\n  const updateOutputTag = (index, tag) => {\n    const newTags = [...outputTags];\n    newTags[index] = tag;\n    updateConfig(\"outputTags\", newTags);\n  };\n\n  const removeOutputTag = (index) => {\n    updateConfig(\n      \"outputTags\",\n      outputTags.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Sources</div>\n        <div className=\"pdt-section-hint\">\n          Entities that SET values into the diffusion field. Values are maintained at source\n          positions each tick (Dirichlet boundary condition).\n        </div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tag Filter\n            <TagSelector\n              value={config.sources?.tagFilter ? [config.sources.tagFilter] : []}\n              onChange={(tags) => updateSources(\"tagFilter\", tags[0] || \"\")}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tag...\"\n              singleSelect\n            />\n            </label>\n            <div className=\"pdt-hint\">Tag that marks an entity as a source</div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Default Strength\n            <NumberInput\n              value={config.sources?.defaultStrength}\n              onChange={(v) => updateSources(\"defaultStrength\", v)}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              Any number. Simulation is uncapped. Output tags clamp to -100/100.\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Sinks</div>\n        <div className=\"pdt-section-hint\">\n          Entities that SET negative values into the diffusion field.\n        </div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tag Filter\n            <TagSelector\n              value={config.sinks?.tagFilter ? [config.sinks.tagFilter] : []}\n              onChange={(tags) => updateSinks(\"tagFilter\", tags[0] || \"\")}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tag...\"\n              singleSelect\n            />\n            </label>\n            <div className=\"pdt-hint\">Tag that marks an entity as a sink</div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Default Strength\n            <NumberInput\n              value={config.sinks?.defaultStrength}\n              onChange={(v) => updateSinks(\"defaultStrength\", v)}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">Will be negated. Any number - simulation is uncapped.</div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Diffusion</div>\n        <div className=\"pdt-section-hint\">\n          Heat equation parameters. Each tick: sources/sinks SET values (fixed boundary), then\n          diffusion runs N iterations to spread values.\n        </div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Rate\n            <NumberInput\n              value={config.diffusion?.rate}\n              onChange={(v) => updateDiffusion(\"rate\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              0-1. Recommended 0.1-0.25. Above 0.25 may cause oscillations.\n            </div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Source Radius\n            <NumberInput\n              value={config.diffusion?.sourceRadius}\n              onChange={(v) => updateDiffusion(\"sourceRadius\", v)}\n              min={0}\n              max={50}\n              integer\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">Grid cells where source/sink SET values. Default: 1.</div>\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"falloff-type\" className=\"label\">Falloff Type</label>\n            <select id=\"falloff-type\"\n              className=\"input\"\n              value={config.diffusion?.falloffType || \"absolute\"}\n              onChange={(e) => updateDiffusion(\"falloffType\", e.target.value)}\n            >\n              {FALLOFF_OPTIONS.map((opt) => (\n                <option key={opt.value} value={opt.value}>\n                  {opt.label}\n                </option>\n              ))}\n            </select>\n            <div className=\"pdt-hint\">How strength decreases within source radius.</div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Decay Rate\n            <NumberInput\n              value={config.diffusion?.decayRate}\n              onChange={(v) => updateDiffusion(\"decayRate\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              0-1. Default: 0 (no decay). Decay fights diffusion spreading.\n            </div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Iterations Per Tick\n            <NumberInput\n              value={config.diffusion?.iterationsPerTick}\n              onChange={(v) => updateDiffusion(\"iterationsPerTick\", v)}\n              min={1}\n              max={200}\n              integer\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              Default: 20. Higher = faster spreading. 20 achieves ~50 cells in 15 ticks.\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Output Tags ({outputTags.length})</div>\n        <div className=\"pdt-section-hint\">\n          Tags assigned to entities based on sampled field value (clamped to -100 to 100).\n        </div>\n\n        {outputTags.map((tag, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"py-lg px-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <div className=\"form-group\">\n                    <label className=\"label\">Tag\n                    <TagSelector\n                      value={tag.tag ? [tag.tag] : []}\n                      onChange={(tags) => updateOutputTag(index, { ...tag, tag: tags[0] || \"\" })}\n                      tagRegistry={tagRegistry}\n                      placeholder=\"Select tag...\"\n                      singleSelect\n                    />\n                    </label>\n                  </div>\n                  <div className=\"form-group\">\n                    <label className=\"label\">Min Value\n                    <NumberInput\n                      value={tag.minValue}\n                      onChange={(v) => updateOutputTag(index, { ...tag, minValue: v })}\n                      min={-100}\n                      max={100}\n                      allowEmpty\n                    />\n                    </label>\n                    <div className=\"pdt-hint\">-100 to 100</div>\n                  </div>\n                  <div className=\"form-group\">\n                    <label className=\"label\">Max Value\n                    <NumberInput\n                      value={tag.maxValue}\n                      onChange={(v) => updateOutputTag(index, { ...tag, maxValue: v })}\n                      min={-100}\n                      max={100}\n                      allowEmpty\n                    />\n                    </label>\n                    <div className=\"pdt-hint\">-100 to 100</div>\n                  </div>\n                </div>\n                <button className=\"btn-icon btn-icon-danger\" onClick={() => removeOutputTag(index)}>\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addOutputTag}>\n          + Add Output Tag\n        </button>\n\n        <div className=\"mt-xl\">\n          <div className=\"form-group\">\n            <label className=\"label\">Value Tag\n            <TagSelector\n              value={config.valueTag ? [config.valueTag] : []}\n              onChange={(tags) => updateConfig(\"valueTag\", tags[0] || \"\")}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tag...\"\n              singleSelect\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              Optional: Store clamped field value as tag (e.g., &quot;field_value:25.5&quot;)\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "select", "children": [{"tag": "option", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/index.js::FrameworkSystemTab", "name": "FrameworkSystemTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n */\nexport function FrameworkSystemTab({ system, onChange }) {\n  const config = system.config;\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  return (\n    <div>\n      <div className=\"info-box\">\n        <div className=\"info-box-title\">Framework System</div>\n        <div className=\"info-box-text\">\n          This is a framework-level system with specific configuration options.\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Configuration</div>\n\n        {system.systemType === \"eraTransition\" && (\n          <div className=\"form-grid\">\n            <p className=\"label grid-col-full text-dim\">\n              Era transition timing is controlled by per-era exitConditions in eras.json. Add a time\n              condition (e.g., {`{ type: 'time_elapsed', minTicks: 25 }`}) to control minimum era\n              length.\n            </p>\n          </div>\n        )}\n\n        {system.systemType === \"universalCatalyst\" && (\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label\">Action Attempt Rate\n              <NumberInput\n                value={config.actionAttemptRate}\n                onChange={(v) => updateConfig(\"actionAttemptRate\", v)}\n                className=\"input\"\n                step={0.1}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Pressure Multiplier\n              <NumberInput\n                value={config.pressureMultiplier}\n                onChange={(v) => updateConfig(\"pressureMultiplier\", v)}\n                className=\"input\"\n                step={0.1}\n                min={0}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Prominence Up % on Success\n              <NumberInput\n                value={config.prominenceUpChanceOnSuccess}\n                onChange={(v) => updateConfig(\"prominenceUpChanceOnSuccess\", v)}\n                className=\"input\"\n                step={0.05}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Prominence Down % on Failure\n              <NumberInput\n                value={config.prominenceDownChanceOnFailure}\n                onChange={(v) => updateConfig(\"prominenceDownChanceOnFailure\", v)}\n                className=\"input\"\n                step={0.05}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        )}\n\n        {system.systemType === \"relationshipMaintenance\" && (\n          <div className=\"form-grid\">\n            <div className=\"form-group\">\n              <label className=\"label\">Maintenance Frequency\n              <NumberInput\n                value={config.maintenanceFrequency}\n                onChange={(v) => updateConfig(\"maintenanceFrequency\", v)}\n                className=\"input\"\n                min={1}\n                allowEmpty\n                integer\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Cull Threshold\n              <NumberInput\n                value={config.cullThreshold}\n                onChange={(v) => updateConfig(\"cullThreshold\", v)}\n                className=\"input\"\n                step={0.05}\n                min={0}\n                max={1}\n                allowEmpty\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Grace Period\n              <NumberInput\n                value={config.gracePeriod}\n                onChange={(v) => updateConfig(\"gracePeriod\", v)}\n                className=\"input\"\n                min={0}\n                allowEmpty\n                integer\n              />\n              </label>\n            </div>\n            <div className=\"form-group\">\n              <label className=\"label\">Reinforcement Bonus\n              <NumberInput\n                value={config.reinforcementBonus}\n                onChange={(v) => updateConfig(\"reinforcementBonus\", v)}\n                className=\"input\"\n                step={0.01}\n                min={0}\n                allowEmpty\n              />\n              </label>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange }", "type": "{ system: any; onChange: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "p", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/OverviewTab.jsx::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/OverviewTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Function} props.onDelete - Called to delete the system\n */\nexport function OverviewTab({ system, onChange, onDelete }) {\n  const config = system.config;\n  const typeConfig = SYSTEM_TYPES[system.systemType] || {};\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(config.id, (value) =>\n    updateConfig(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(config.name, (value) =>\n    updateConfig(\"name\", value)\n  );\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"system-id\" className=\"label\">System ID</label>\n            <input id=\"system-id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"display-name\" className=\"label\">Display Name</label>\n            <input id=\"display-name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <div className=\"form-group\">\n            <label className=\"label\">Description\n            <LocalTextArea\n              value={config.description || \"\"}\n              onChange={(value) => updateConfig(\"description\", value)}\n              className=\"ot-description-textarea\"\n              placeholder=\"Describe what this system does...\"\n            />\n            </label>\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">System Type</span>\n          <div className=\"flex items-center gap-lg\">\n            {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color from config */}\n            <span\n              className=\"type-badge\"\n              style={{ '--ot-type-bg': `${typeConfig.color}30`, '--ot-type-color': typeConfig.color, backgroundColor: 'var(--ot-type-bg)', color: 'var(--ot-type-color)' }}\n            >\n              {typeConfig.icon} {typeConfig.label}\n            </span>\n            <span className=\"text-muted ot-type-desc\">\n              {typeConfig.desc}\n            </span>\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Enabled\n          <EnableToggle\n            enabled={system.enabled !== false}\n            onChange={(enabled) => onChange({ ...system, enabled })}\n            label={system.enabled !== false ? \"System is active\" : \"System is disabled\"}\n          />\n          </label>\n        </div>\n      </div>\n\n      <div className=\"danger-zone\">\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete System\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, onDelete }", "type": "{ system: any; onChange: Function; onDelete: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "EnableToggle", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useLocalInputState", "count": 2}], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["SYSTEM_TYPES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["EnableToggle", "useLocalInputState", "LocalTextArea"], "category": "internal"}, {"source": "./OverviewTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/PlaneDiffusionTab.jsx::PlaneDiffusionTab", "name": "PlaneDiffusionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/PlaneDiffusionTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema (for tag registry)\n */\nexport function PlaneDiffusionTab({ system, onChange, schema }) {\n  const config = system.config;\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateSources = (field, value) => {\n    updateConfig(\"sources\", { ...config.sources, [field]: value });\n  };\n\n  const updateSinks = (field, value) => {\n    updateConfig(\"sinks\", { ...config.sinks, [field]: value });\n  };\n\n  const updateDiffusion = (field, value) => {\n    updateConfig(\"diffusion\", { ...config.diffusion, [field]: value });\n  };\n\n  // Output tags\n  const outputTags = config.outputTags || [];\n\n  const addOutputTag = () => {\n    updateConfig(\"outputTags\", [...outputTags, { tag: \"\", minValue: 0 }]);\n  };\n\n  const updateOutputTag = (index, tag) => {\n    const newTags = [...outputTags];\n    newTags[index] = tag;\n    updateConfig(\"outputTags\", newTags);\n  };\n\n  const removeOutputTag = (index) => {\n    updateConfig(\n      \"outputTags\",\n      outputTags.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Sources</div>\n        <div className=\"pdt-section-hint\">\n          Entities that SET values into the diffusion field. Values are maintained at source\n          positions each tick (Dirichlet boundary condition).\n        </div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tag Filter\n            <TagSelector\n              value={config.sources?.tagFilter ? [config.sources.tagFilter] : []}\n              onChange={(tags) => updateSources(\"tagFilter\", tags[0] || \"\")}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tag...\"\n              singleSelect\n            />\n            </label>\n            <div className=\"pdt-hint\">Tag that marks an entity as a source</div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Default Strength\n            <NumberInput\n              value={config.sources?.defaultStrength}\n              onChange={(v) => updateSources(\"defaultStrength\", v)}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              Any number. Simulation is uncapped. Output tags clamp to -100/100.\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Sinks</div>\n        <div className=\"pdt-section-hint\">\n          Entities that SET negative values into the diffusion field.\n        </div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tag Filter\n            <TagSelector\n              value={config.sinks?.tagFilter ? [config.sinks.tagFilter] : []}\n              onChange={(tags) => updateSinks(\"tagFilter\", tags[0] || \"\")}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tag...\"\n              singleSelect\n            />\n            </label>\n            <div className=\"pdt-hint\">Tag that marks an entity as a sink</div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Default Strength\n            <NumberInput\n              value={config.sinks?.defaultStrength}\n              onChange={(v) => updateSinks(\"defaultStrength\", v)}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">Will be negated. Any number - simulation is uncapped.</div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Diffusion</div>\n        <div className=\"pdt-section-hint\">\n          Heat equation parameters. Each tick: sources/sinks SET values (fixed boundary), then\n          diffusion runs N iterations to spread values.\n        </div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Rate\n            <NumberInput\n              value={config.diffusion?.rate}\n              onChange={(v) => updateDiffusion(\"rate\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              0-1. Recommended 0.1-0.25. Above 0.25 may cause oscillations.\n            </div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Source Radius\n            <NumberInput\n              value={config.diffusion?.sourceRadius}\n              onChange={(v) => updateDiffusion(\"sourceRadius\", v)}\n              min={0}\n              max={50}\n              integer\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">Grid cells where source/sink SET values. Default: 1.</div>\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"falloff-type\" className=\"label\">Falloff Type</label>\n            <select id=\"falloff-type\"\n              className=\"input\"\n              value={config.diffusion?.falloffType || \"absolute\"}\n              onChange={(e) => updateDiffusion(\"falloffType\", e.target.value)}\n            >\n              {FALLOFF_OPTIONS.map((opt) => (\n                <option key={opt.value} value={opt.value}>\n                  {opt.label}\n                </option>\n              ))}\n            </select>\n            <div className=\"pdt-hint\">How strength decreases within source radius.</div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Decay Rate\n            <NumberInput\n              value={config.diffusion?.decayRate}\n              onChange={(v) => updateDiffusion(\"decayRate\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              0-1. Default: 0 (no decay). Decay fights diffusion spreading.\n            </div>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Iterations Per Tick\n            <NumberInput\n              value={config.diffusion?.iterationsPerTick}\n              onChange={(v) => updateDiffusion(\"iterationsPerTick\", v)}\n              min={1}\n              max={200}\n              integer\n              allowEmpty\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              Default: 20. Higher = faster spreading. 20 achieves ~50 cells in 15 ticks.\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Output Tags ({outputTags.length})</div>\n        <div className=\"pdt-section-hint\">\n          Tags assigned to entities based on sampled field value (clamped to -100 to 100).\n        </div>\n\n        {outputTags.map((tag, index) => (\n          <div key={index} className=\"item-card\">\n            <div className=\"py-lg px-xl\">\n              <div className=\"form-row-with-delete\">\n                <div className=\"form-row-fields\">\n                  <div className=\"form-group\">\n                    <label className=\"label\">Tag\n                    <TagSelector\n                      value={tag.tag ? [tag.tag] : []}\n                      onChange={(tags) => updateOutputTag(index, { ...tag, tag: tags[0] || \"\" })}\n                      tagRegistry={tagRegistry}\n                      placeholder=\"Select tag...\"\n                      singleSelect\n                    />\n                    </label>\n                  </div>\n                  <div className=\"form-group\">\n                    <label className=\"label\">Min Value\n                    <NumberInput\n                      value={tag.minValue}\n                      onChange={(v) => updateOutputTag(index, { ...tag, minValue: v })}\n                      min={-100}\n                      max={100}\n                      allowEmpty\n                    />\n                    </label>\n                    <div className=\"pdt-hint\">-100 to 100</div>\n                  </div>\n                  <div className=\"form-group\">\n                    <label className=\"label\">Max Value\n                    <NumberInput\n                      value={tag.maxValue}\n                      onChange={(v) => updateOutputTag(index, { ...tag, maxValue: v })}\n                      min={-100}\n                      max={100}\n                      allowEmpty\n                    />\n                    </label>\n                    <div className=\"pdt-hint\">-100 to 100</div>\n                  </div>\n                </div>\n                <button className=\"btn-icon btn-icon-danger\" onClick={() => removeOutputTag(index)}>\n                  \u00d7\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        <button className=\"btn-add\" onClick={addOutputTag}>\n          + Add Output Tag\n        </button>\n\n        <div className=\"mt-xl\">\n          <div className=\"form-group\">\n            <label className=\"label\">Value Tag\n            <TagSelector\n              value={config.valueTag ? [config.valueTag] : []}\n              onChange={(tags) => updateConfig(\"valueTag\", tags[0] || \"\")}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tag...\"\n              singleSelect\n            />\n            </label>\n            <div className=\"pdt-hint\">\n              Optional: Store clamped field value as tag (e.g., &quot;field_value:25.5&quot;)\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "select", "children": [{"tag": "option", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": true, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../../shared", "specifiers": ["NumberInput"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}, {"source": "./PlaneDiffusionTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/TagDiffusionTab.jsx::TagDiffusionTab", "name": "TagDiffusionTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/TagDiffusionTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n */\nexport function TagDiffusionTab({ system, onChange, schema }) {\n  const config = system.config;\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  const updateConvergence = (field, value) => {\n    updateConfig(\"convergence\", { ...config.convergence, [field]: value });\n  };\n\n  const updateDivergence = (field, value) => {\n    updateConfig(\"divergence\", { ...config.divergence, [field]: value });\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Connection</div>\n        <div className=\"form-grid\">\n          <ReferenceDropdown\n            label=\"Connection Kind\"\n            value={config.connectionKind}\n            onChange={(v) => updateConfig(\"connectionKind\", v)}\n            options={relationshipKindOptions}\n          />\n          <ReferenceDropdown\n            label=\"Direction\"\n            value={config.connectionDirection || \"both\"}\n            onChange={(v) => updateConfig(\"connectionDirection\", v)}\n            options={DIRECTIONS}\n          />\n          <div className=\"form-group\">\n            <label className=\"label\">Max Tags\n            <NumberInput\n              value={config.maxTags}\n              onChange={(v) => updateConfig(\"maxTags\", v)}\n              min={1}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Convergence</div>\n        <div className=\"section-desc\">Connected entities become more similar.</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tags\n            <TagSelector\n              value={config.convergence?.tags || []}\n              onChange={(tags) => updateConvergence(\"tags\", tags)}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Min Connections\n            <NumberInput\n              value={config.convergence?.minConnections}\n              onChange={(v) => updateConvergence(\"minConnections\", v)}\n              min={0}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Probability\n            <NumberInput\n              value={config.convergence?.probability}\n              onChange={(v) => updateConvergence(\"probability\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Divergence</div>\n        <div className=\"section-desc\">Isolated entities become more unique.</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label className=\"label\">Tags\n            <TagSelector\n              value={config.divergence?.tags || []}\n              onChange={(tags) => updateDivergence(\"tags\", tags)}\n              tagRegistry={tagRegistry}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Max Connections\n            <NumberInput\n              value={config.divergence?.maxConnections}\n              onChange={(v) => updateDivergence(\"maxConnections\", v)}\n              min={0}\n              integer\n              allowEmpty\n            />\n            </label>\n          </div>\n          <div className=\"form-group\">\n            <label className=\"label\">Probability\n            <NumberInput\n              value={config.divergence?.probability}\n              onChange={(v) => updateDivergence(\"probability\", v)}\n              min={0}\n              max={1}\n              allowEmpty\n            />\n            </label>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ system, onChange, schema }", "type": "{ system: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [{"tag": "TagSelector", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["DIRECTIONS"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput"], "category": "internal"}, {"source": "@the-canonry/shared-components/TagSelector", "specifiers": ["TagSelector"], "category": "external"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/systems/tabs/ThresholdTriggerTab.jsx::ThresholdTriggerTab", "name": "ThresholdTriggerTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/systems/tabs/ThresholdTriggerTab.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.system - The system being edited\n * @param {Function} props.onChange - Called when system changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Pressure definitions\n */\nexport function ThresholdTriggerTab({ system, onChange, schema, pressures }) {\n  const config = system.config;\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddVarForm, setShowAddVarForm] = useState(false);\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const updateConfig = (field, value) => {\n    onChange({ ...system, config: { ...config, [field]: value } });\n  };\n\n  // Conditions\n  const conditions = config.conditions || [];\n\n  const addCondition = (type) => {\n    const newRule = createNewRule(type, pressures);\n    updateConfig(\"conditions\", [...conditions, newRule]);\n  };\n\n  const updateCondition = (index, cond) => {\n    const newConditions = [...conditions];\n    newConditions[index] = cond;\n    updateConfig(\"conditions\", newConditions);\n  };\n\n  const removeCondition = (index) => {\n    updateConfig(\n      \"conditions\",\n      conditions.filter((_, i) => i !== index)\n    );\n  };\n\n  // Variables\n  const variables = config.variables || {};\n\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$self\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    updateConfig(\"variables\", {\n      ...variables,\n      [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"random\" } },\n    });\n    setNewVarName(\"\");\n    setShowAddVarForm(false);\n  };\n\n  const updateVariable = (name, config) => {\n    updateConfig(\"variables\", { ...variables, [name]: config });\n  };\n\n  const removeVariable = (name) => {\n    const newVars = { ...variables };\n    delete newVars[name];\n    updateConfig(\"variables\", newVars);\n  };\n\n  // Build entity options for actions (include defined variables)\n  const entityOptions = [\n    { value: \"$self\", label: \"$self\" },\n    { value: \"$member\", label: \"$member\" },\n    { value: \"$member2\", label: \"$member2\" },\n    ...Object.keys(variables).map((v) => ({ value: v, label: v })),\n  ];\n\n  // Actions (mutations)\n  const actions = config.actions || [];\n\n  const createAction = (type) => {\n    const defaultPressure = pressures?.[0]?.id || \"\";\n    switch (type) {\n      case \"modify_pressure\":\n        return { type: \"modify_pressure\", pressureId: defaultPressure, delta: 0 };\n      case \"set_tag\":\n        return { type: \"set_tag\", entity: \"$self\", tag: \"\", value: true };\n      case \"remove_tag\":\n        return { type: \"remove_tag\", entity: \"$self\", tag: \"\" };\n      case \"change_status\":\n        return { type: \"change_status\", entity: \"$self\", newStatus: \"\" };\n      case \"adjust_prominence\":\n        return { type: \"adjust_prominence\", entity: \"$self\", delta: 0.25 };\n      case \"archive_relationship\":\n        return {\n          type: \"archive_relationship\",\n          entity: \"$self\",\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n      case \"adjust_relationship_strength\":\n        return {\n          type: \"adjust_relationship_strength\",\n          kind: \"\",\n          src: \"$self\",\n          dst: \"$self\",\n          delta: 0.1,\n        };\n      case \"transfer_relationship\":\n        return {\n          type: \"transfer_relationship\",\n          entity: \"$self\",\n          relationshipKind: \"\",\n          from: \"$self\",\n          to: \"$self\",\n        };\n      case \"update_rate_limit\":\n        return { type: \"update_rate_limit\" };\n      case \"for_each_related\":\n        return { type: \"for_each_related\", relationship: \"\", direction: \"both\", actions: [] };\n      case \"conditional\":\n        return {\n          type: \"conditional\",\n          condition: { type: \"random_chance\", chance: 0.5 },\n          thenActions: [],\n          elseActions: [],\n        };\n      case \"create_relationship\":\n      default:\n        return { type: \"create_relationship\", kind: \"\", src: \"$self\", dst: \"$self\", strength: 0.5 };\n    }\n  };\n\n  const addAction = (type) => {\n    updateConfig(\"actions\", [...actions, createAction(type)]);\n  };\n\n  const updateAction = (index, action) => {\n    const newActions = [...actions];\n    newActions[index] = action;\n    updateConfig(\"actions\", newActions);\n  };\n\n  const removeAction = (index) => {\n    updateConfig(\n      \"actions\",\n      actions.filter((_, i) => i !== index)\n    );\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Conditions ({conditions.length})</div>\n        <div className=\"section-desc\">\n          All conditions must pass for an entity to be included in the trigger.\n        </div>\n\n        {conditions.length === 0 ? (\n          <div className=\"empty-state-compact\">No conditions defined.</div>\n        ) : (\n          conditions.map((cond, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={cond}\n              onChange={(c) => updateCondition(index, c)}\n              onRemove={() => removeCondition(index)}\n              schema={schema}\n              pressures={pressures}\n            />\n          ))\n        )}\n\n        <AddRuleButton onAdd={addCondition} />\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Variables ({Object.keys(variables).length})</div>\n        <div className=\"section-desc\">\n          Variables select additional entities from the graph to use in actions. Referenced as{\" \"}\n          <code className=\"inline-code\">$varName</code> in action entity fields.\n        </div>\n\n        {Object.keys(variables).length === 0 && !showAddVarForm ? (\n          <div className=\"empty-state-compact\">No variables defined.</div>\n        ) : (\n          Object.entries(variables).map(([name, varConfig]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={varConfig}\n              onChange={(updated) => updateVariable(name, updated)}\n              onRemove={() => removeVariable(name)}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddVarForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddVarForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddVarForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Actions ({actions.length})</div>\n        <div className=\"section-desc\">\n          Mutations applied to each matching entity (or clusters when configured).\n        </div>\n\n        {actions.map((actionItem, index) => (\n          <div key={index} className=\"mb-lg\">\n            <MutationCard\n              mutation={actionItem}\n              onChange={(a) => updateAction(index, a)}\n              onRemove={() => removeAction(index)}\n              schema={schema}\n              pressures={pressures}\n              entityOptions={entityOptions}\n              typeOptions={TRIGGER_MUTATION_TYPES}\n              createMutation={createAction}\n              titlePrefix=\"Action\"\n            />\n            {actionItem.type === \"create_relationship\" && (\n              <label className=\"checkbox-label mt-md\">\n                <input\n                  type=\"checkbox\"\n                  checked={actionItem.betweenMatching || false}\n                  onChange={(e) =>\n                    updateAction(index, { ...actionItem, betweenMatching: e.target.checked })\n                  }\n                  className=\"checkbox\"\n                />\n                Between matching entities\n              </label>\n            )}\n          </div>\n        ))}\n\n        <div className=\"form-group mt-lg\">\n          <select\n            className=\"select\"\n            value=\"\"\n            onChange={(e) => {\n              if (!e.target.value) return;\n              addAction(e.target.value);\n            }}\n          >\n            <option value=\"\">+ Add action...</option>\n            {TRIGGER_MUTATION_TYPES.map((opt) => (\n              <option key={opt.value} value={opt.value}>\n                {opt.label}\n              </option>\n            ))}\n          </select>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Clustering</div>\n// ... (truncated)", "parameters": [{"name": "{ system, onChange, schema, pressures }", "type": "{ system: any; onChange: Function; schema: any; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "AddRuleButton", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "code", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": true}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "div", "children": [{"tag": "label", "children": [], "isMap": false, "isConditional": false}, {"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}, {"tag": "button", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}, {"tag": "button", "children": [], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "MutationCard", "children": [], "isMap": false, "isConditional": false}, {"tag": "label", "children": [{"tag": "input", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": true, "isConditional": false}, {"tag": "div", "children": [{"tag": "select", "children": [{"tag": "option", "children": [], "isMap": false, "isConditional": false}, {"tag": "option", "children": [], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "<>", "children": [{"tag": "ReferenceDropdown", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "label", "children": [{"tag": "NumberInput", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "LocalTextArea", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 2}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../constants", "specifiers": ["CLUSTER_MODES"], "category": "internal"}, {"source": "../../shared", "specifiers": ["ReferenceDropdown", "NumberInput", "LocalTextArea"], "category": "internal"}, {"source": "../../shared/VariableSelectionEditor", "specifiers": ["VariableSelectionEditor"], "category": "internal"}, {"source": "../../generators/applicability/ApplicabilityRuleCard", "specifiers": ["ApplicabilityRuleCard"], "category": "internal"}, {"source": "../../generators/applicability/AddRuleButton", "specifiers": ["AddRuleButton"], "category": "internal"}, {"source": "../../generators/applicability/createNewRule", "specifiers": ["createNewRule"], "category": "internal"}, {"source": "../../shared/MutationCard", "specifiers": ["MutationCard", "DEFAULT_MUTATION_TYPES"], "category": "internal"}, {"source": "./ThresholdTriggerTab.css", "specifiers": [], "category": "internal"}], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/validation/cards/index.js::IssueCard", "name": "IssueCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/validation/cards/index.js", "sourceCode": "export function IssueCard({ issue, onItemClick }) {\n  const [expanded, setExpanded] = useState(false);\n  const [, setHovering] = useState(false);\n  const [, setHoveredItem] = useState(null);\n\n  const severityClass =\n    issue.severity === \"error\"\n      ? \"validation-issue-severity validation-status-error\"\n      : \"validation-issue-severity validation-status-warning\";\n\n  const icons = {\n    error: \"\u274c\",\n    warning: \"\u26a0\ufe0f\",\n  };\n\n  return (\n    <div className=\"validation-issue-card\">\n      <div\n        className=\"validation-issue-header\"\n        onClick={() => setExpanded(!expanded)}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n      >\n        <span className=\"validation-issue-icon\">{icons[issue.severity]}</span>\n        <span className=\"validation-issue-title\">{issue.title}</span>\n        <span className=\"validation-issue-count\">{issue.affectedItems.length}</span>\n        <span className={severityClass}>{issue.severity.toUpperCase()}</span>\n        <span\n          className={`validation-issue-expand-icon ${expanded ? \"ic-expand-rotated\" : \"\"}`}\n        >\n          \u25bc\n        </span>\n      </div>\n      {expanded && (\n        <div className=\"validation-issue-content\">\n          <div className=\"validation-issue-message\">{issue.message}</div>\n          <div className=\"validation-affected-items\">\n            {issue.affectedItems.map((item) => (\n              <div key={item.id} className=\"flex-col ic-affected-item-row\">\n                <span\n                  className=\"validation-affected-item\"\n                  title={item.detail}\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    onItemClick?.(item.id);\n                  }}\n                  onMouseEnter={() => setHoveredItem(item.id)}\n                  onMouseLeave={() => setHoveredItem(null)}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  {item.label}\n                </span>\n                {item.detail && <span className=\"validation-detail-row\">{item.detail}</span>}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ issue, onItemClick }", "type": "{ issue: any; onItemClick: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 3}], "imports": [], "storeAccess": []}, {"id": "apps/coherence-engine/webui/src/components/validation/cards/IssueCard.jsx::IssueCard", "name": "IssueCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/validation/cards/IssueCard.jsx", "sourceCode": "export function IssueCard({ issue, onItemClick }) {\n  const [expanded, setExpanded] = useState(false);\n  const [, setHovering] = useState(false);\n  const [, setHoveredItem] = useState(null);\n\n  const severityClass =\n    issue.severity === \"error\"\n      ? \"validation-issue-severity validation-status-error\"\n      : \"validation-issue-severity validation-status-warning\";\n\n  const icons = {\n    error: \"\u274c\",\n    warning: \"\u26a0\ufe0f\",\n  };\n\n  return (\n    <div className=\"validation-issue-card\">\n      <div\n        className=\"validation-issue-header\"\n        onClick={() => setExpanded(!expanded)}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n      >\n        <span className=\"validation-issue-icon\">{icons[issue.severity]}</span>\n        <span className=\"validation-issue-title\">{issue.title}</span>\n        <span className=\"validation-issue-count\">{issue.affectedItems.length}</span>\n        <span className={severityClass}>{issue.severity.toUpperCase()}</span>\n        <span\n          className={`validation-issue-expand-icon ${expanded ? \"ic-expand-rotated\" : \"\"}`}\n        >\n          \u25bc\n        </span>\n      </div>\n      {expanded && (\n        <div className=\"validation-issue-content\">\n          <div className=\"validation-issue-message\">{issue.message}</div>\n          <div className=\"validation-affected-items\">\n            {issue.affectedItems.map((item) => (\n              <div key={item.id} className=\"flex-col ic-affected-item-row\">\n                <span\n                  className=\"validation-affected-item\"\n                  title={item.detail}\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    onItemClick?.(item.id);\n                  }}\n                  onMouseEnter={() => setHoveredItem(item.id)}\n                  onMouseLeave={() => setHoveredItem(null)}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  {item.label}\n                </span>\n                {item.detail && <span className=\"validation-detail-row\">{item.detail}</span>}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ issue, onItemClick }", "type": "{ issue: any; onItemClick: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxTree": {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [], "isMap": false, "isConditional": false}, {"tag": "div", "children": [{"tag": "div", "children": [{"tag": "span", "children": [], "isMap": false, "isConditional": false}, {"tag": "span", "children": [], "isMap": false, "isConditional": true}], "isMap": true, "isConditional": false}], "isMap": false, "isConditional": false}], "isMap": false, "isConditional": true}], "isMap": false, "isConditional": false}, "hookCalls": [{"name": "useState", "count": 3}], "imports": [{"source": "react", "specifiers": ["React", "useState"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../validation.css", "specifiers": [], "category": "internal"}, {"source": "./IssueCard.css", "specifiers": [], "category": "internal"}], "storeAccess": []}]