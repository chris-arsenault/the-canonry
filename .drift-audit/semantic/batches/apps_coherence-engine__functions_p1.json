[{"id": "apps/coherence-engine/webui/src/CoherenceEngineRemote.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/CoherenceEngineRemote.jsx", "sourceCode": "export default function CoherenceEngineRemote({\n  projectId,\n  schema,\n  eras = [],\n  onErasChange,\n  pressures = [],\n  onPressuresChange,\n  generators = [],\n  onGeneratorsChange,\n  actions = [],\n  onActionsChange,\n  systems = [],\n  onSystemsChange,\n  activeSection,\n  onSectionChange,\n}) {\n  // Use passed-in section or default to 'validation'\n  const activeTab = activeSection || \"validation\";\n  const setActiveTab = onSectionChange || (() => {});\n\n  const currentSection = SECTION_INFO[activeTab] || SECTION_INFO.validation;\n\n  // Compute usage map for cross-reference tracking and validation (must be before validationStatus)\n  const usageMap = useMemo(\n    () => computeUsageMap(schema, pressures, eras, generators, systems, actions),\n    [schema, pressures, eras, generators, systems, actions]\n  );\n\n  // Calculate validation status for the nav indicator (uses usageMap)\n  const validationStatus = useMemo(\n    () => getValidationStatus(usageMap, schema, eras, pressures, generators, systems),\n    [usageMap, schema, eras, pressures, generators, systems]\n  );\n\n  // Navigate to generators tab and optionally select a specific generator\n  const handleNavigateToGenerator = (_generatorId) => {\n    setActiveTab(\"generators\");\n    // NOOP: generator expansion not yet implemented\n  };\n\n  const renderContent = () => {\n    switch (activeTab) {\n      case \"validation\":\n        return (\n          <ValidationEditor\n            schema={schema}\n            eras={eras}\n            pressures={pressures}\n            generators={generators}\n            systems={systems}\n            actions={actions}\n            usageMap={usageMap}\n            onNavigateToGenerator={handleNavigateToGenerator}\n          />\n        );\n      case \"causal\":\n        return (\n          <CausalLoopEditor\n            pressures={pressures}\n            generators={generators}\n            systems={systems}\n            actions={actions}\n            schema={schema}\n            usageMap={usageMap}\n          />\n        );\n      case \"pressures\":\n        return (\n          <PressuresEditor\n            projectId={projectId}\n            pressures={pressures}\n            onChange={onPressuresChange || (() => {})}\n            schema={schema}\n            usageMap={usageMap}\n          />\n        );\n      case \"eras\":\n        return (\n          <ErasEditor\n            eras={eras}\n            onChange={onErasChange || (() => {})}\n            generators={generators}\n            systems={systems}\n            pressures={pressures}\n            schema={schema}\n            usageMap={usageMap}\n          />\n        );\n      case \"matrix\":\n        return (\n          <WeightMatrixEditor\n            generators={generators}\n            systems={systems}\n            eras={eras}\n            onErasChange={onErasChange || (() => {})}\n          />\n        );\n      case \"generators\":\n        return (\n          <GeneratorsEditor\n            projectId={projectId}\n            generators={generators}\n            onChange={onGeneratorsChange || (() => {})}\n            schema={schema}\n            pressures={pressures}\n            eras={eras}\n            usageMap={usageMap}\n          />\n        );\n      case \"actions\":\n        return (\n          <ActionsEditor\n            projectId={projectId}\n            actions={actions}\n            onChange={onActionsChange || (() => {})}\n            schema={schema}\n            pressures={pressures}\n            usageMap={usageMap}\n          />\n        );\n      case \"systems\":\n        return (\n          <SystemsEditor\n            projectId={projectId}\n            systems={systems}\n            onChange={onSystemsChange || (() => {})}\n            schema={schema}\n            pressures={pressures}\n            usageMap={usageMap}\n          />\n        );\n      default:\n        return (\n          <div className=\"cer-placeholder\">\n            <div className=\"cer-placeholder-icon\"></div>\n            <div className=\"cer-placeholder-title\">{currentSection.title}</div>\n            <div className=\"cer-placeholder-desc\">{currentSection.description}</div>\n          </div>\n        );\n    }\n  };\n\n  return (\n    <div className=\"cer-container\">\n      {/* Left sidebar with nav */}\n      <div className=\"cer-sidebar\">\n        <nav className=\"cer-nav\">\n          {TABS.map((tab) => {\n            // Show status indicator for validation tab\n            const showStatus = tab.id === \"validation\";\n            const statusColor = STATUS_COLORS[validationStatus.status];\n\n            return (\n              <button\n                key={tab.id}\n                onClick={() => setActiveTab(tab.id)}\n                className={`cer-nav-button ${activeTab === tab.id ? \"cer-nav-button-active\" : \"cer-nav-button-inactive\"}`}\n              >\n                <span className=\"cer-nav-button-content\">\n                  <span>{tab.label}</span>\n                  {showStatus && (\n                    <span\n                      className=\"cer-status-dot\"\n                      // eslint-disable-next-line local/no-inline-styles -- dynamic color from validation status\n                      style={{ '--cer-status-color': statusColor, backgroundColor: 'var(--cer-status-color)' }}\n                      title={(() => {\n                        if (validationStatus.status === \"clean\") return \"All validations passed\";\n                        const plural = validationStatus.totalIssues === 1 ? \"\" : \"s\";\n                        return `${validationStatus.totalIssues} issue${plural}`;\n                      })()}\n                    />\n                  )}\n                </span>\n              </button>\n            );\n          })}\n        </nav>\n      </div>\n\n      {/* Main content area */}\n      <div className=\"cer-main\">\n        <div className=\"cer-content\">{renderContent()}</div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  schema,\n  eras = [],\n  onErasChange,\n  pressures = [],\n  onPressuresChange,\n  generators = [],\n  onGeneratorsChange,\n  actions = [],\n  onActionsChange,\n  systems = [],\n  onSystemsChange,\n  activeSection,\n  onSectionChange,\n}", "type": "{ projectId: any; schema: any; eras?: any[]; onErasChange: any; pressures?: any[]; onPressuresChange: any; generators?: any[]; onGeneratorsChange: any; actions?: any[]; onActionsChange: any; systems?: any[]; onSystemsChange: any; activeSection: any; onSectionChange: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/ActionsEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/ActionsEditor.jsx", "sourceCode": "export default function ActionsEditor({\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"actions:selected\");\n  const {\n    selectedItem: selectedAction,\n    handleItemChange: handleActionChange,\n    handleToggle,\n    handleDelete,\n    handleAdd: handleAddAction,\n    handleSelect,\n    handleClose,\n  } = useEditorState(actions, onChange, { createItem: createAction, persistKey: selectionKey });\n\n  // Collect unique pressures across all actions\n  const uniquePressures = new Set();\n  actions.forEach((action) => {\n    (action.probability?.pressureModifiers || []).forEach((mod) => {\n      if (mod.pressure) uniquePressures.add(mod.pressure);\n    });\n  });\n\n  return (\n    <div className=\"actions-editor\">\n      <div className=\"actions-header\">\n        <h1 className=\"actions-title\">Actions</h1>\n        <p className=\"actions-subtitle\">\n          Actions define what agents can do during the simulation via the universal catalyst system.\n          Click an action to edit.\n        </p>\n        <div className=\"actions-stats\">\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Total Actions</span>\n            <span className=\"actions-stat-value\">{actions.length}</span>\n          </div>\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Pressures Referenced</span>\n            <span className=\"actions-stat-value\">{uniquePressures.size}</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"actions-grid\">\n        {actions.map((action, index) => (\n          <ActionListCard\n            key={action.id}\n            action={action}\n            onClick={() => handleSelect(index)}\n            onToggle={() => handleToggle(action)}\n            usageMap={usageMap}\n          />\n        ))}\n\n        <div className=\"actions-add-card\" onClick={() => handleAddAction()} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n          <span className=\"text-2xl\">+</span>\n          <span>Add Action</span>\n        </div>\n      </div>\n\n      {selectedAction && (\n        <ActionModal\n          action={selectedAction}\n          onChange={handleActionChange}\n          onClose={handleClose}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; actions?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/CausalLoopEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/CausalLoopEditor.jsx", "sourceCode": "export default function CausalLoopEditor({\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}) {\n  const containerRef = useRef(null);\n  const graphRef = useRef(null);\n  const [dimensions, setDimensions] = useState({ width: 800, height: 600 });\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [showLegend, setShowLegend] = useState(true);\n  const [showDisabled, setShowDisabled] = useState(true);\n  const [hoverNode, setHoverNode] = useState(null);\n\n  // Resize observer\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const updateDimensions = () => {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDimensions({\n        width: rect.width || 800,\n        height: Math.max(500, window.innerHeight - rect.top - 100),\n      });\n    };\n\n    updateDimensions();\n    const observer = new ResizeObserver(updateDimensions);\n    observer.observe(containerRef.current);\n    window.addEventListener(\"resize\", updateDimensions);\n\n    return () => {\n      observer.disconnect();\n      window.removeEventListener(\"resize\", updateDimensions);\n    };\n  }, []);\n\n  // Extract graph data\n  const {\n    nodes: graphNodes,\n    links: graphLinks,\n    warnings,\n  } = useMemo(\n    () =>\n      extractCausalGraph(pressures, generators, systems, actions, schema, showDisabled, usageMap),\n    [pressures, generators, systems, actions, schema, showDisabled, usageMap]\n  );\n  const graphData = useMemo(\n    () => ({ nodes: graphNodes, links: graphLinks }),\n    [graphNodes, graphLinks]\n  );\n\n  // Count disabled nodes for UI\n  const disabledCount = useMemo(() => {\n    const allNodes = extractCausalGraph(\n      pressures,\n      generators,\n      systems,\n      actions,\n      schema,\n      true,\n      usageMap\n    ).nodes;\n    return allNodes.filter((n) => n.isDisabled).length;\n  }, [pressures, generators, systems, actions, schema, usageMap]);\n\n  // Detect loops\n  const loops = useMemo(() => detectLoops(graphData.nodes, graphData.links), [graphData]);\n\n  const reinforcingLoops = loops.filter((l) => l.type === \"reinforcing\");\n  const balancingLoops = loops.filter((l) => l.type === \"balancing\");\n\n  // Node styling\n  const nodeCanvasObject = useCallback(\n    (node, ctx, globalScale) => {\n      const label = node.label;\n      const fontSize = Math.max(10 / globalScale, 3);\n      const abbrevFontSize = Math.max(8 / globalScale, 3);\n      const nodeRadius = Math.sqrt(node.val) * 3;\n      const isDisabled = node.isDisabled;\n\n      // Draw node circle with opacity for disabled\n      ctx.beginPath();\n      ctx.arc(node.x, node.y, nodeRadius, 0, 2 * Math.PI);\n      ctx.fillStyle = isDisabled ? `${node.color}60` : node.color;\n      ctx.fill();\n\n      // Strikethrough pattern for disabled nodes\n      if (isDisabled) {\n        ctx.strokeStyle = \"#64748b\";\n        ctx.lineWidth = 1 / globalScale;\n        ctx.setLineDash([2 / globalScale, 2 / globalScale]);\n        ctx.stroke();\n        ctx.setLineDash([]);\n      }\n\n      // Highlight selected/hovered\n      if (selectedNode === node.id || hoverNode === node.id) {\n        ctx.strokeStyle = \"#ffffff\";\n        ctx.lineWidth = 2 / globalScale;\n        ctx.stroke();\n      }\n\n      // Draw abbreviation inside node\n      ctx.font = `bold ${abbrevFontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"middle\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#0a1929\";\n      ctx.fillText(node.abbrev || \"?\", node.x, node.y);\n\n      // Draw label below node\n      ctx.font = `${fontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"top\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#e2e8f0\";\n      const displayLabel = label.length > 15 ? label.slice(0, 13) + \"...\" : label;\n      ctx.fillText(displayLabel, node.x, node.y + nodeRadius + 2);\n    },\n    [selectedNode, hoverNode]\n  );\n\n  // Link styling\n  const linkColor = useCallback((link) => {\n    return EDGE_COLORS[link.polarity] || EDGE_COLORS.neutral;\n  }, []);\n\n  const linkWidth = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? 1 : 2;\n  }, []);\n\n  const linkLineDash = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? [4, 4] : [];\n  }, []);\n\n  // Handle node click\n  const handleNodeClick = useCallback(\n    (node) => {\n      setSelectedNode(selectedNode === node.id ? null : node.id);\n    },\n    [selectedNode]\n  );\n\n  // Zoom to fit on load\n  useEffect(() => {\n    if (graphRef.current && graphData.nodes.length > 0) {\n      setTimeout(() => {\n        graphRef.current.zoomToFit(400, 60);\n      }, 500);\n    }\n  }, [graphData.nodes.length]);\n\n  const selectedNodeData = selectedNode ? graphData.nodes.find((n) => n.id === selectedNode) : null;\n\n  // Get edges for selected node\n  const selectedNodeEdges = useMemo(() => {\n    if (!selectedNode) return { incoming: [], outgoing: [] };\n    return {\n      incoming: graphData.links.filter((l) => {\n        const targetId = typeof l.target === \"object\" ? l.target.id : l.target;\n        return targetId === selectedNode;\n      }),\n      outgoing: graphData.links.filter((l) => {\n        const sourceId = typeof l.source === \"object\" ? l.source.id : l.source;\n        return sourceId === selectedNode;\n      }),\n    };\n  }, [selectedNode, graphData.links]);\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Causal Loop Diagram</h1>\n        <p className=\"subtitle\">\n          Visualize feedback loops between pressures, generators, systems, and entity kinds.\n          {loops.length > 0 && (\n            <span className=\"cl-loop-count\">\n              <span className=\"cl-loop-reinforcing\">{reinforcingLoops.length} reinforcing</span>\n              {\" / \"}\n              <span className=\"cl-loop-balancing\">{balancingLoops.length} balancing</span>\n              {\" loops detected\"}\n            </span>\n          )}\n        </p>\n      </div>\n\n      <div className=\"cl-toolbar\">\n        <button className=\"button-secondary\" onClick={() => setShowLegend(!showLegend)}>\n          {showLegend ? \"Hide\" : \"Show\"} Legend\n        </button>\n        {disabledCount > 0 && (\n          <button\n            className=\"button-secondary\"\n            onClick={() => setShowDisabled(!showDisabled)}\n            // eslint-disable-next-line local/no-inline-styles -- dynamic opacity toggle\n            style={{ opacity: showDisabled ? 1 : 0.7 }}\n          >\n            {showDisabled ? \"Hide\" : \"Show\"} Disabled ({disabledCount})\n          </button>\n        )}\n        <button className=\"button-secondary\" onClick={() => graphRef.current?.zoomToFit(400, 60)}>\n          Fit to View\n        </button>\n        <div className=\"cl-stats\">\n          <span>{graphData.nodes.length} nodes</span>\n          <span>{graphData.links.length} edges</span>\n          {warnings.length > 0 && (\n            <span className=\"cl-stats-warning\">{warnings.length} warnings</span>\n          )}\n          <span className=\"cl-stats-hint\">Scroll to zoom, drag to pan</span>\n        </div>\n      </div>\n\n      {/* Warnings */}\n      {warnings.length > 0 && (\n        <div className=\"cl-warnings-box\">\n          <div className=\"cl-warnings-title\">\n            Referential Integrity Warnings\n          </div>\n          <div className=\"cl-warnings-list\">\n            {warnings.slice(0, 5).map((w, i) => (\n              <div key={i}>{w.message}</div>\n            ))}\n            {warnings.length > 5 && (\n              <div className=\"cl-warnings-more\">\n                ...and {warnings.length - 5} more warnings\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Legend */}\n      {showLegend && (\n        <div className=\"cl-legend\">\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Nodes:</span>\n            {Object.entries(NODE_TYPES).map(([type, config]) => (\n              <span key={type} className=\"cl-legend-item\">\n                <span\n                  className=\"cl-legend-node\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per node type\n                  style={{ '--cl-node-color': config.color, backgroundColor: 'var(--cl-node-color)' }}\n                >\n                  {config.abbrev}\n                </span>\n                <span className=\"cl-legend-node-label\">{config.label}</span>\n              </span>\n            ))}\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Edges:</span>\n            <span className=\"cl-legend-item cl-edge-positive\">+ Positive</span>\n            <span className=\"cl-legend-item cl-edge-negative\">- Negative</span>\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Loops:</span>\n            <span className=\"cl-legend-item cl-loop-reinforcing\">Reinforcing (unstable)</span>\n            <span className=\"cl-legend-item cl-loop-balancing\">Balancing (stable)</span>\n          </div>\n        </div>\n      )}\n\n      {/* Graph container */}\n      <div ref={containerRef} className=\"cl-graph-container\">\n        {graphData.nodes.length === 0 ? (\n          <div className=\"cl-empty-state\">\n            <div className=\"cl-empty-icon\">&#128260;</div>\n            <div className=\"cl-empty-title\">\n              No causal relationships found\n            </div>\n            <div className=\"cl-empty-desc\">\n              Add pressures with feedback factors, generators with state updates, or systems with\n              pressure changes to see the causal loop diagram.\n            </div>\n          </div>\n        ) : (\n          <ForceGraph2D\n            ref={graphRef}\n            graphData={graphData}\n            width={dimensions.width}\n            height={dimensions.height}\n            backgroundColor=\"#0f172a\"\n            nodeCanvasObject={nodeCanvasObject}\n            nodePointerAreaPaint={(node, color, ctx) => {\n              const nodeRadius = Math.sqrt(node.val) * 3;\n              ctx.beginPath();\n              ctx.arc(node.x, node.y, nodeRadius + 5, 0, 2 * Math.PI);\n              ctx.fillStyle = color;\n              ctx.fill();\n            }}\n            linkColor={linkColor}\n            linkWidth={linkWidth}\n            linkLineDash={linkLineDash}\n            linkDirectionalArrowLength={6}\n            linkDirectionalArrowRelPos={0.9}\n            linkCurvature={0.2}\n            onNodeClick={handleNodeClick}\n            onNodeHover={(node) => setHoverNode(node?.id || null)}\n// ... (truncated)", "parameters": [{"name": "{\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}", "type": "{ pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; schema?: {}; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/DependencyViewer.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/DependencyViewer.jsx", "sourceCode": "export default function DependencyViewer({ usageMap }) {\n  // Prepare entity kinds data\n  const entityKindsData = useMemo(() => {\n    if (!usageMap?.entityKinds) return [];\n    return Object.entries(usageMap.entityKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare relationship kinds data\n  const relationshipKindsData = useMemo(() => {\n    if (!usageMap?.relationshipKinds) return [];\n    return Object.entries(usageMap.relationshipKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare pressures data\n  const pressuresData = useMemo(() => {\n    if (!usageMap?.pressures) return [];\n    return Object.entries(usageMap.pressures)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare generators data\n  const generatorsData = useMemo(() => {\n    if (!usageMap?.generators) return [];\n    return Object.entries(usageMap.generators)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare systems data\n  const systemsData = useMemo(() => {\n    if (!usageMap?.systems) return [];\n    return Object.entries(usageMap.systems)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare tags data\n  const tagsData = useMemo(() => {\n    if (!usageMap?.tags) return [];\n    return Object.entries(usageMap.tags)\n      .map(([tag, usage]) => ({\n        id: tag,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  if (!usageMap) {\n    return (\n      <div className=\"dependency-viewer-container\">\n        <div className=\"dependency-empty-state\">Loading dependency data...</div>\n      </div>\n    );\n  }\n\n  const renderSchemaItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      <UsageBadges usage={item.usage} />\n    </div>\n  );\n\n  const renderEraItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      {item.eraCount > 0 ? (\n        <div className=\"dependency-used-by-list\">\n          <span className=\"dependency-badge dependency-badge-era\">\n            {item.eraCount} era{item.eraCount !== 1 ? \"s\" : \"\"}\n          </span>\n        </div>\n      ) : (\n        <span className=\"dependency-orphan-badge\">Not in any era</span>\n      )}\n    </div>\n  );\n\n  return (\n    <div className=\"dependency-viewer-container\">\n      <div className=\"dependency-viewer-header\">\n        <div className=\"dependency-viewer-title\">\n          <span>\ud83d\udd17</span>\n          <span>Dependencies</span>\n        </div>\n        <div className=\"dependency-viewer-legend\">\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-generators\" />\n            <span>Generators</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-systems\" />\n            <span>Systems</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-actions\" />\n            <span>Actions</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-eras\" />\n            <span>Eras</span>\n          </div>\n        </div>\n      </div>\n\n      <DependencySection\n        title=\"Entity Kinds\"\n        icon=\"\ud83d\udce6\"\n        items={entityKindsData}\n        renderItem={renderSchemaItem}\n        defaultExpanded={true}\n      />\n\n      <DependencySection\n        title=\"Relationship Kinds\"\n        icon=\"\ud83d\udd17\"\n        items={relationshipKindsData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection title=\"Tags\" icon=\"\ud83c\udff7\ufe0f\" items={tagsData} renderItem={renderSchemaItem} />\n\n      <DependencySection\n        title=\"Pressures\"\n        icon=\"\ud83d\udcca\"\n        items={pressuresData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection\n        title=\"Generators \u2192 Eras\"\n        icon=\"\u2728\"\n        items={generatorsData}\n        renderItem={renderEraItem}\n      />\n\n      <DependencySection\n        title=\"Systems \u2192 Eras\"\n        icon=\"\u2699\ufe0f\"\n        items={systemsData}\n        renderItem={renderEraItem}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{ usageMap }", "type": "{ usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/GeneratorsEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/GeneratorsEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.generators - Array of generator configurations\n * @param {Function} props.onChange - Callback when generators change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport default function GeneratorsEditor({\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"generators:selected\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [expandedCategories, setExpandedCategories] = useState({});\n\n  // Derive selected generator from index - this ensures we always have the latest data\n  const resolvedIndex = selectedId ? generators.findIndex((g) => g.id === selectedId) : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedGenerator = selectedIndex !== null ? generators[selectedIndex] : null;\n\n  // Build entity kind info map for icons and labels\n  const entityKindInfo = useMemo(() => {\n    const info = {};\n    (schema?.entityKinds || []).forEach((ek) => {\n      info[ek.kind] = {\n        label: ek.description || ek.name || ek.kind,\n        icon: ek.icon || DEFAULT_KIND_ICONS[ek.kind] || \"\ud83d\udce6\",\n      };\n    });\n    return info;\n  }, [schema]);\n\n  // Group generators by the primary entity kind they create\n  const groupedGenerators = useMemo(() => {\n    const groups = {};\n\n    generators.forEach((generator) => {\n      // Get primary creation kind (first entity created, or target kind if no creation)\n      const createdKinds = (generator.creation || []).map((c) => c.kind).filter(Boolean);\n      const primaryKind = createdKinds[0] || generator.selection?.kind || \"uncategorized\";\n\n      if (!groups[primaryKind]) {\n        groups[primaryKind] = [];\n      }\n      groups[primaryKind].push(generator);\n    });\n\n    return groups;\n  }, [generators]);\n\n  // Get ordered list of categories\n  const categories = useMemo(() => {\n    // Order by schema entity kinds first, then any uncategorized\n    const schemaKinds = (schema?.entityKinds || []).map((ek) => ek.kind);\n    const usedKinds = Object.keys(groupedGenerators);\n\n    // Sort: schema kinds in order, then others alphabetically\n    return usedKinds.sort((a, b) => {\n      const aIdx = schemaKinds.indexOf(a);\n      const bIdx = schemaKinds.indexOf(b);\n      if (aIdx >= 0 && bIdx >= 0) return aIdx - bIdx;\n      if (aIdx >= 0) return -1;\n      if (bIdx >= 0) return 1;\n      return a.localeCompare(b);\n    });\n  }, [groupedGenerators, schema]);\n\n  // Initialize expanded state for new categories\n  useEffect(() => {\n    const needsUpdate = categories.some((cat) => expandedCategories[cat] === undefined);\n    if (!needsUpdate) return;\n    const updated = { ...expandedCategories };\n    categories.forEach((cat) => {\n      if (updated[cat] === undefined) {\n        updated[cat] = true;\n      }\n    });\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync category expansion defaults when categories change\n    setExpandedCategories(updated);\n  }, [categories, expandedCategories]);\n\n  // Restore selectedId from storage when selectionKey changes\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted selection when key changes\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  // Persist selectedId to storage\n  useEffect(() => {\n    if (!selectionKey) return;\n    if (selectedId) {\n      saveStoredValue(selectionKey, selectedId);\n    } else {\n      clearStoredValue(selectionKey);\n    }\n  }, [selectionKey, selectedId]);\n\n  // Clear invalid selectedId (during render)\n  if (selectedId && selectedIndex === null) {\n    setSelectedId(null);\n    clearStoredValue(selectionKey);\n  }\n\n  const handleGeneratorChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex < generators.length) {\n        const newGenerators = [...generators];\n        newGenerators[selectedIndex] = updated;\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (generator) => {\n      const index = generators.findIndex((g) => g.id === generator.id);\n      if (index >= 0) {\n        const newGenerators = [...generators];\n        newGenerators[index] = {\n          ...generator,\n          enabled: generator.enabled === false ? true : false,\n        };\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedGenerator &&\n      confirm(`Delete generator \"${selectedGenerator.name || selectedGenerator.id}\"?`)\n    ) {\n      const newGenerators = [...generators];\n      newGenerators.splice(selectedIndex, 1);\n      onChange(newGenerators);\n      setSelectedId(null);\n    }\n  }, [generators, onChange, selectedIndex, selectedGenerator]);\n\n  const handleAdd = useCallback(() => {\n    const newGenerator = {\n      id: `generator_${Date.now()}`,\n      name: \"New Generator\",\n      applicability: [],\n      selection: { strategy: \"by_kind\", kind: \"location\", pickStrategy: \"random\" },\n      creation: [],\n      relationships: [],\n      stateUpdates: [],\n      variables: {},\n    };\n    onChange([...generators, newGenerator]);\n    setSelectedId(newGenerator.id);\n  }, [generators, onChange]);\n\n  const handleDuplicate = useCallback(() => {\n    if (!selectedGenerator) return;\n    const duplicated = {\n      ...JSON.parse(JSON.stringify(selectedGenerator)), // Deep clone\n      id: `${selectedGenerator.id}_copy_${Date.now()}`,\n      name: `${selectedGenerator.name || selectedGenerator.id} (Copy)`,\n    };\n    onChange([...generators, duplicated]);\n    setSelectedId(duplicated.id);\n  }, [generators, onChange, selectedGenerator]);\n\n  const toggleCategoryExpand = useCallback((kind) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [kind]: !prev[kind],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (kind) => {\n      const categoryItems = groupedGenerators[kind] || [];\n      const allEnabled = categoryItems.every((g) => g.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of generators in this category\n      const categoryIds = new Set(categoryItems.map((g) => g.id));\n\n      const newGenerators = generators.map((g) => {\n        if (categoryIds.has(g.id)) {\n          return { ...g, enabled: newEnabled };\n        }\n        return g;\n      });\n      onChange(newGenerators);\n    },\n    [generators, groupedGenerators, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Generators</h1>\n        <p className=\"subtitle\">\n          Configure entity generators that populate your world. Click a generator to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((kind) => {\n        const kindInfo = entityKindInfo[kind] || {\n          label: kind.charAt(0).toUpperCase() + kind.slice(1),\n          icon: DEFAULT_KIND_ICONS[kind] || \"\ud83d\udce6\",\n        };\n        const categoryItems = groupedGenerators[kind] || [];\n        const allEnabled = categoryItems.every((g) => g.enabled !== false);\n\n        return (\n          <CategorySection\n            key={kind}\n            id={kind}\n            icon={kindInfo.icon}\n            label={`${kindInfo.label} Generators`}\n            items={categoryItems}\n            expanded={expandedCategories[kind] !== false}\n            onToggleExpand={() => toggleCategoryExpand(kind)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(kind)}\n            renderItem={(generator) => (\n              <GeneratorListCard\n                key={generator.id}\n                generator={generator}\n                onClick={() => setSelectedId(generator.id)}\n                onToggle={() => handleToggle(generator)}\n                usageMap={usageMap}\n              />\n            )}\n          />\n        );\n      })}\n\n      {/* Add Generator button */}\n      <div className=\"mt-lg\">\n        <AddCard onClick={handleAdd} label=\"Add Generator\" />\n      </div>\n\n      {selectedGenerator && (\n        <GeneratorModal\n          generator={selectedGenerator}\n          onChange={handleGeneratorChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          onDuplicate={handleDuplicate}\n          schema={schema}\n          pressures={pressures}\n          eras={eras}\n          usageMap={usageMap}\n          tagRegistry={schema.tagRegistry || []}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}", "type": "{ generators: any[]; onChange: Function; schema: any; pressures: any[]; eras: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/NamingProfileMappingViewer.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/NamingProfileMappingViewer.jsx", "sourceCode": "export default function NamingProfileMappingViewer({ generators = [], schema = {} }) {\n  const [showInherited, setShowInherited] = useState(false);\n\n  const { mappings, warnings } = useMemo(\n    () => analyzeNamingMappings(generators, schema),\n    [generators, schema]\n  );\n\n  // Group by generator for display\n  const groupedMappings = useMemo(() => {\n    const groups = {};\n    for (const m of mappings) {\n      if (!groups[m.generatorId]) {\n        groups[m.generatorId] = {\n          generatorId: m.generatorId,\n          generatorName: m.generatorName,\n          items: [],\n        };\n      }\n      groups[m.generatorId].items.push(m);\n    }\n    return Object.values(groups);\n  }, [mappings]);\n\n  // Filter warnings - show all by default, but can filter to just explicit cultures\n  const displayWarnings = showInherited\n    ? warnings\n    : warnings.filter(\n        (w) => w.cultureSource === \"explicit\" || w.reason === \"No matching strategy group\"\n      );\n\n  const successCount = mappings.filter((m) => m.match).length;\n  const warningCount = warnings.filter((w) => w.reason === \"No matching strategy group\").length;\n\n  if (mappings.length === 0) {\n    return (\n      <div className=\"naming-profile-container\">\n        <div className=\"naming-profile-header\">\n          <div className=\"naming-profile-title\">\n            <span>Naming Profile Mappings</span>\n          </div>\n        </div>\n        <div className=\"naming-profile-empty-state\">\n          No generators with entity creation defined. Add generators to see naming profile mappings.\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"naming-profile-container\">\n      <div className=\"naming-profile-header\">\n        <div className=\"naming-profile-title\">\n          <span>Naming Profile Mappings</span>\n        </div>\n        <div className=\"naming-profile-stats\">\n          <div className=\"naming-profile-stat-item\">\n            <span className=\"naming-profile-stat-value text-success\">{successCount}</span>\n            <span>matched</span>\n          </div>\n          <div className=\"naming-profile-stat-item\">\n            <span\n              className={`naming-profile-stat-value ${warningCount > 0 ? \"text-danger\" : \"text-muted\"}`}\n            >\n              {warningCount}\n            </span>\n            <span>missing</span>\n          </div>\n          <label className=\"cursor-pointer flex items-center gap-xs\">\n            <input\n              type=\"checkbox\"\n              checked={showInherited}\n              onChange={(e) => setShowInherited(e.target.checked)}\n            />\n            <span>Show inherited cultures</span>\n          </label>\n        </div>\n      </div>\n\n      <div className=\"naming-profile-content\">\n        {/* Warnings section */}\n        {displayWarnings.length > 0 && (\n          <div className=\"naming-profile-section\">\n            <div className=\"naming-profile-section-title\">\n              <span className=\"naming-profile-warning-icon\">Warning</span>\n              <span>Naming May Fail ({displayWarnings.length})</span>\n            </div>\n            <div className=\"naming-profile-warning-list\">\n              {displayWarnings.slice(0, 10).map((w, i) => (\n                <div\n                  key={`${w.generatorId}-${w.cultureId}-${i}`}\n                  className=\"naming-profile-warning-item\"\n                >\n                  <span className=\"naming-profile-warning-icon\">!</span>\n                  <span>\n                    <strong>{w.generatorName}</strong> creates <strong>{w.entityKind}</strong>\n                    {w.subtype && `:${w.subtype}`} for culture <strong>{w.cultureName}</strong> -{\" \"}\n                    {w.reason}\n                  </span>\n                </div>\n              ))}\n              {displayWarnings.length > 10 && (\n                <div\n                  className=\"text-muted py-md px-lg\"\n                >\n                  ... and {displayWarnings.length - 10} more\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Mappings table */}\n        <div className=\"naming-profile-section\">\n          <div className=\"naming-profile-section-title\">\n            <span>Entity Creation to Naming Profile</span>\n          </div>\n          <table className=\"naming-profile-mapping-table\">\n            <thead>\n              <tr>\n                <th className=\"naming-profile-table-header\">Generator</th>\n                <th className=\"naming-profile-table-header\">Entity Kind</th>\n                <th className=\"naming-profile-table-header\">Culture</th>\n                <th className=\"naming-profile-table-header\">Naming Profile</th>\n              </tr>\n            </thead>\n            <tbody>\n              {groupedMappings.slice(0, 20).flatMap((group) => {\n                // Filter items based on showInherited toggle\n                const filteredItems = showInherited\n                  ? group.items\n                  : group.items.filter(\n                      (m) => m.cultureSource === \"explicit\" || m.cultureSource === \"any\"\n                    );\n                // If no explicit cultures, show first inherited one as representative\n                const displayItems =\n                  filteredItems.length > 0 ? filteredItems : group.items.slice(0, 1);\n                return displayItems.map((m, idx) => (\n                  <tr\n                    key={`${m.generatorId}-${m.cultureId}-${m.entityKind}-${idx}`}\n                    className={`naming-profile-table-row ${!m.match && m.hasNamingProfile ? \"naming-profile-warning-row\" : \"\"}`}\n                  >\n                    <td className=\"naming-profile-table-cell naming-profile-generator-cell\">\n                      {idx === 0 ? m.generatorName : \"\"}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <span className=\"naming-profile-kind-badge\">{m.entityKind}</span>\n                      {m.subtype && (\n                        <span\n                          className=\"naming-profile-kind-badge naming-profile-kind-badge-transparent\"\n                        >\n                          {m.subtype}\n                        </span>\n                      )}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <div className=\"naming-profile-culture-cell\">\n                        {/* eslint-disable-next-line local/no-inline-styles -- dynamic culture color */}\n                        <span\n                          className=\"naming-profile-culture-dot\"\n                          style={{ '--npm-culture-color': m.cultureColor, backgroundColor: 'var(--npm-culture-color)' }}\n                        />\n                        <span>{m.cultureName}</span>\n                        {m.cultureSource === \"inherited\" && (\n                          <span className=\"naming-profile-badge naming-profile-badge-inherited\">\n                            inherited\n                          </span>\n                        )}\n                      </div>\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      {m.match && (\n                        <span className=\"naming-profile-badge naming-profile-badge-match\">\n                          {m.match.profileName || m.match.profileId}\n                          {m.match.groupName && ` / ${m.match.groupName}`}\n                        </span>\n                      )}\n                      {!m.match && !m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No profiles configured\n                        </span>\n                      )}\n                      {!m.match && m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No matching group\n                        </span>\n                      )}\n                    </td>\n                  </tr>\n                ));\n              })}\n            </tbody>\n          </table>\n          {groupedMappings.length > 20 && (\n            <div className=\"text-muted text-center text-xs p-md\">\n              Showing first 20 generators. Total: {groupedMappings.length}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generators = [], schema = {} }", "type": "{ generators?: any[]; schema?: {}; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/PressuresEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/PressuresEditor.jsx", "sourceCode": "export default function PressuresEditor({ projectId, pressures = [], onChange, schema, usageMap }) {\n  const [expandedPressure, setExpandedPressure] = useState(null);\n  const factorModalKey = buildStorageKey(projectId, \"pressures:factorModal\");\n  const restoredRef = useRef(false);\n\n  useEffect(() => {\n    restoredRef.current = false;\n  }, [factorModalKey]);\n\n  // Restore expanded pressure from storage (one-time per modal key)\n  useEffect(() => {\n    if (restoredRef.current || !factorModalKey || pressures.length === 0) return;\n\n    const stored = loadStoredValue(factorModalKey);\n    if (stored?.pressureId) {\n      const index = pressures.findIndex((pressure) => pressure.id === stored.pressureId);\n      if (index >= 0) {\n        // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted UI expansion state\n        setExpandedPressure(index);\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    }\n    restoredRef.current = true;\n  }, [factorModalKey, pressures]);\n\n  const handlePressureChange = useCallback(\n    (index, updatedPressure) => {\n      const newPressures = [...pressures];\n      newPressures[index] = updatedPressure;\n      onChange(newPressures);\n    },\n    [pressures, onChange]\n  );\n\n  const handleDeletePressure = useCallback(\n    (index) => {\n      if (confirm(`Delete \"${pressures[index].name}\"?`)) {\n        const newPressures = pressures.filter((_, i) => i !== index);\n        onChange(newPressures);\n        if (expandedPressure === index) {\n          setExpandedPressure(null);\n        }\n      }\n    },\n    [pressures, onChange, expandedPressure]\n  );\n\n  const handleAddPressure = useCallback(() => {\n    const newPressure = {\n      id: `pressure_${Date.now()}`,\n      name: \"New Pressure\",\n      initialValue: 0,\n      homeostasis: 0.05,\n      description: \"\",\n      growth: {\n        positiveFeedback: [],\n        negativeFeedback: [],\n      },\n    };\n    onChange([...pressures, newPressure]);\n    setExpandedPressure(pressures.length);\n  }, [pressures, onChange]);\n\n  if (pressures.length === 0) {\n    return (\n      <div className=\"editor-container\">\n        <div className=\"header\">\n          <h1 className=\"title\">Pressures</h1>\n          <p className=\"subtitle\">\n            Configure environmental and social pressures that drive world evolution\n          </p>\n        </div>\n        <div className=\"empty-state\">\n          <div className=\"empty-state-icon\">\ud83c\udf21\ufe0f</div>\n          <div className=\"pe-empty-title\">\n            No pressures defined\n          </div>\n          <div className=\"pe-empty-desc\">\n            Pressures respond to world state with feedback and a pull toward equilibrium, driving\n            the narrative forward.\n          </div>\n          <button\n            className=\"btn btn-primary pe-create-btn\"\n            onClick={handleAddPressure}\n          >\n            + Create First Pressure\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Pressures</h1>\n        <p className=\"subtitle\">\n          Configure environmental and social pressures that drive world evolution. Each pressure has\n          feedback factors that make it grow or shrink based on world state plus a homeostatic pull\n          toward equilibrium.\n        </p>\n      </div>\n\n      <div className=\"list-stack\">\n        {pressures.map((pressure, index) => (\n          <PressureCard\n            key={index}\n            pressure={pressure}\n            expanded={expandedPressure === index}\n            onToggle={() => setExpandedPressure(expandedPressure === index ? null : index)}\n            onChange={(updatedPressure) => handlePressureChange(index, updatedPressure)}\n            onDelete={() => handleDeletePressure(index)}\n            schema={schema}\n            usageMap={usageMap}\n            projectId={projectId}\n          />\n        ))}\n\n        <button className=\"btn btn-add\" onClick={handleAddPressure}>\n          + Add Pressure\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ projectId, pressures = [], onChange, schema, usageMap }", "type": "{ projectId: any; pressures?: any[]; onChange: any; schema: any; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/SystemsEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/SystemsEditor.jsx", "sourceCode": "export default function SystemsEditor({\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"systems:selected\");\n  const typePickerKey = buildStorageKey(projectId, \"systems:typePicker\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [showTypePicker, setShowTypePicker] = useState(\n    () => loadStoredValue(typePickerKey) === true\n  );\n\n  // Derive selectedSystem from index\n  const resolvedIndex = selectedId\n    ? systems.findIndex((system) => system.config?.id === selectedId)\n    : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedSystem = selectedIndex !== null ? systems[selectedIndex] : null;\n  const [expandedCategories, setExpandedCategories] = useState(() => {\n    // Start with all categories expanded\n    return Object.keys(SYSTEM_CATEGORIES).reduce((acc, cat) => {\n      acc[cat] = true;\n      return acc;\n    }, {});\n  });\n  const mouseDownOnOverlay = useRef(false);\n\n  const handleOverlayMouseDown = useCallback((e) => {\n    mouseDownOnOverlay.current = e.target === e.currentTarget;\n  }, []);\n\n  const handleOverlayClick = useCallback((e) => {\n    if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n      setShowTypePicker(false);\n    }\n  }, []);\n\n  // Group systems by category (framework systems grouped together)\n  const groupedSystems = useMemo(() => {\n    const groups = {};\n    systems.forEach((system) => {\n      const category = getSystemCategory(system.systemType || \"unknown\");\n      if (!groups[category]) {\n        groups[category] = [];\n      }\n      groups[category].push(system);\n    });\n    return groups;\n  }, [systems]);\n\n  // Get ordered list of categories that have systems\n  const categories = useMemo(() => {\n    const usedCategories = Object.keys(groupedSystems);\n    // Sort by defined order in SYSTEM_CATEGORIES\n    return usedCategories.sort((a, b) => {\n      const orderA = SYSTEM_CATEGORIES[a]?.order ?? 999;\n      const orderB = SYSTEM_CATEGORIES[b]?.order ?? 999;\n      return orderA - orderB;\n    });\n  }, [groupedSystems]);\n\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  useEffect(() => {\n    setShowTypePicker(loadStoredValue(typePickerKey) === true);\n  }, [typePickerKey]);\n\n  useEffect(() => {\n    if (selectionKey) {\n      if (selectedId) {\n        saveStoredValue(selectionKey, selectedId);\n      } else {\n        clearStoredValue(selectionKey);\n      }\n    }\n  }, [selectionKey, selectedId]);\n\n  useEffect(() => {\n    if (typePickerKey) {\n      if (showTypePicker) {\n        saveStoredValue(typePickerKey, true);\n      } else {\n        clearStoredValue(typePickerKey);\n      }\n    }\n  }, [typePickerKey, showTypePicker]);\n\n  useEffect(() => {\n    if (selectedId && selectedIndex === null) {\n      setSelectedId(null);\n      clearStoredValue(selectionKey);\n    }\n  }, [selectedId, selectedIndex, selectionKey]);\n\n  const handleSystemChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex >= 0 && selectedIndex < systems.length) {\n        const newSystems = [...systems];\n        newSystems[selectedIndex] = updated;\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (system) => {\n      const index = systems.findIndex((s) => s.config?.id === system.config?.id);\n      if (index >= 0) {\n        const newSystems = [...systems];\n        newSystems[index] = { ...system, enabled: system.enabled === false ? true : false };\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedSystem &&\n      confirm(`Delete system \"${selectedSystem.config?.name || selectedSystem.config?.id}\"?`)\n    ) {\n      const newSystems = systems.filter((_, i) => i !== selectedIndex);\n      onChange(newSystems);\n      setSelectedId(null);\n    }\n  }, [systems, onChange, selectedIndex, selectedSystem]);\n\n  const handleAddSystem = useCallback(\n    (type) => {\n      const needsSelection = [\n        \"graphContagion\",\n        \"connectionEvolution\",\n        \"thresholdTrigger\",\n        \"clusterFormation\",\n        \"tagDiffusion\",\n        \"planeDiffusion\",\n      ].includes(type);\n      const newSystem = {\n        systemType: type,\n        config: {\n          id: `system_${Date.now()}`,\n          name: `New ${SYSTEM_TYPES[type]?.label || type}`,\n          description: \"\",\n          ...(needsSelection ? { selection: { strategy: \"by_kind\", kind: \"any\" } } : {}),\n        },\n      };\n      onChange([...systems, newSystem]);\n      setSelectedId(newSystem.config.id);\n      setShowTypePicker(false);\n    },\n    [systems, onChange]\n  );\n\n  const toggleCategoryExpand = useCallback((type) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [type]: !prev[type],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (category) => {\n      const categoryItems = groupedSystems[category] || [];\n      const allEnabled = categoryItems.every((s) => s.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of systems in this category\n      const categoryIds = new Set(categoryItems.map((s) => s.config?.id));\n\n      const newSystems = systems.map((s) => {\n        if (categoryIds.has(s.config?.id)) {\n          return { ...s, enabled: newEnabled };\n        }\n        return s;\n      });\n      onChange(newSystems);\n    },\n    [systems, groupedSystems, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Systems</h1>\n        <p className=\"subtitle\">\n          Configure simulation systems that run during the simulation phase. Click a system to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((category) => {\n        const categoryConfig = SYSTEM_CATEGORIES[category] || { icon: \"\u2699\ufe0f\", label: category };\n        const categoryItems = groupedSystems[category] || [];\n        const allEnabled = categoryItems.every((s) => s.enabled !== false);\n\n        return (\n          <CategorySection\n            key={category}\n            id={category}\n            icon={categoryConfig.icon}\n            label={categoryConfig.label}\n            items={categoryItems}\n            expanded={expandedCategories[category] !== false}\n            onToggleExpand={() => toggleCategoryExpand(category)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(category)}\n            gridClassName=\"list-grid\"\n            renderItem={(system) => {\n              const flatIndex = systems.findIndex((s) => s.config?.id === system.config?.id);\n              return (\n                <SystemListCard\n                  key={flatIndex}\n                  system={system}\n                  onClick={() => setSelectedId(system.config.id)}\n                  onToggle={() => handleToggle(system)}\n                  usageMap={usageMap}\n                />\n              );\n            }}\n          />\n        );\n      })}\n\n      {/* Add System button */}\n      <div className=\"mt-xl\">\n        <div\n          className=\"add-card se-add-card-wrap\"\n          onClick={() => setShowTypePicker(true)}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n        >\n          <span className=\"se-add-icon\">+</span>\n          <span>Add System</span>\n        </div>\n      </div>\n\n      {showTypePicker && (\n        <div\n          className=\"modal-overlay\"\n          onMouseDown={handleOverlayMouseDown}\n          onClick={handleOverlayClick}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n        >\n          <div className=\"modal se-type-picker-modal\">\n            <div className=\"modal-header\">\n              <div className=\"modal-title\">Choose System Type</div>\n              <button className=\"close-btn\" onClick={() => setShowTypePicker(false)}>\n                \u00d7\n              </button>\n            </div>\n            <div className=\"se-type-picker-content\">\n              <div className=\"type-picker\">\n                {Object.entries(SYSTEM_TYPES).map(([type, config]) => (\n                  <div\n                    key={type}\n                    className=\"se-type-option type-option\"\n                    onClick={() => handleAddSystem(type)}\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    <div className=\"type-option-icon\">{config.icon}</div>\n                    <div className=\"type-option-label\">{config.label}</div>\n                    <div className=\"type-option-desc\">{config.desc}</div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {selectedSystem && (\n        <SystemModal\n          system={selectedSystem}\n          onChange={handleSystemChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; systems?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/ValidationEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/ValidationEditor.jsx", "sourceCode": "export default function ValidationEditor({\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}) {\n  const validationResults = useMemo(\n    () => runValidations(usageMap, schema, eras, pressures, generators, systems),\n    [usageMap, schema, eras, pressures, generators, systems]\n  );\n\n  // Count orphans from usageMap for summary\n  const orphanCounts = useMemo(() => {\n    if (!usageMap?.validation?.orphans)\n      return { generators: 0, systems: 0, pressures: 0, total: 0 };\n    const orphans = usageMap.validation.orphans;\n    const generators = orphans.filter((o) => o.type === \"generator\").length;\n    const systems = orphans.filter((o) => o.type === \"system\").length;\n    const pressures = orphans.filter((o) => o.type === \"pressure\").length;\n    return { generators, systems, pressures, total: generators + systems + pressures };\n  }, [usageMap]);\n\n  const overallStatus = getOverallStatus(validationResults);\n  const totalIssues = validationResults.errors.length + validationResults.warnings.length;\n  const hasNamingProfiles = useMemo(\n    () => (schema.cultures || []).some((culture) => culture.naming?.profiles?.length),\n    [schema]\n  );\n\n  let statusModifier;\n  if (overallStatus === \"clean\") {\n    statusModifier = \"validation-status-clean\";\n  } else if (overallStatus === \"warning\") {\n    statusModifier = \"validation-status-warning\";\n  } else {\n    statusModifier = \"validation-status-error\";\n  }\n  const statusBadgeClass = `validation-status-badge ${statusModifier}`;\n\n  const handleItemClick = (itemId) => {\n    if (onNavigateToGenerator) {\n      onNavigateToGenerator(itemId);\n    }\n  };\n\n  // Count total affected items\n  const totalAffectedItems = [...validationResults.errors, ...validationResults.warnings].reduce(\n    (sum, issue) => sum + issue.affectedItems.length,\n    0\n  );\n\n  return (\n    <div className=\"validation-container\">\n      <div className=\"validation-header\">\n        <div className=\"flex-between items-start\">\n          <div>\n            <h1 className=\"validation-title\">\n              Validation\n              <span className={statusBadgeClass}>\n                {(() => {\n                  if (overallStatus === \"clean\") return \"All Clear\";\n                  const issueWord = totalIssues === 1 ? \"Issue\" : \"Issues\";\n                  return `${totalIssues} ${issueWord}`;\n                })()}\n              </span>\n            </h1>\n            <p className=\"validation-subtitle\">\n              Semantic validation: reference integrity, pressure balance, and dead code detection.\n              Structure validation runs automatically as a gate before simulation.\n            </p>\n          </div>\n          {totalIssues > 0 && (\n            <div className=\"validation-export-row\">\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsJson(validationResults)}\n                title=\"Export validation report as JSON\"\n              >\n                Export JSON\n              </button>\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsCsv(validationResults)}\n                title=\"Export validation report as CSV\"\n              >\n                Export CSV\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"validation-summary-cards validation-summary-cards-4\">\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-danger\">\n            {validationResults.errors.length}\n          </div>\n          <div className=\"validation-summary-label\">Errors</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-warning\">\n            {validationResults.warnings.length}\n          </div>\n          <div className=\"validation-summary-label\">Warnings</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div\n            className={`validation-summary-value ${orphanCounts.total > 0 ? \"text-muted\" : \"text-info\"}`}\n          >\n            {orphanCounts.total}\n          </div>\n          <div className=\"validation-summary-label\">Unused</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-info\">\n            {totalAffectedItems}\n          </div>\n          <div className=\"validation-summary-label\">Affected Items</div>\n        </div>\n      </div>\n\n      {/* Clean state */}\n      {overallStatus === \"clean\" && (\n        <div className=\"validation-clean-state\">\n          <div className=\"validation-clean-icon\">\u2713</div>\n          <div className=\"validation-clean-title\">All Validations Passed</div>\n          <div className=\"validation-clean-message\">\n            Your configuration looks good. No issues detected.\n          </div>\n        </div>\n      )}\n\n      {/* Errors section */}\n      {validationResults.errors.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u274c</span>\n              Errors\n            </div>\n            <span className=\"validation-section-count validation-status-error\">\n              {validationResults.errors.length}\n            </span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.errors.map((error) => (\n              <IssueCard key={error.id} issue={error} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Warnings section */}\n      {validationResults.warnings.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u26a0\ufe0f</span>\n              Warnings\n            </div>\n            <span className=\"validation-section-count\">{validationResults.warnings.length}</span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.warnings.map((warning) => (\n              <IssueCard key={warning.id} issue={warning} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Dependency Viewer */}\n      {usageMap && (\n        <div className=\"mb-2xl\">\n          <DependencyViewer usageMap={usageMap} />\n        </div>\n      )}\n\n      {/* Naming Profile Mappings */}\n      {hasNamingProfiles && (\n        <div className=\"mb-2xl\">\n          <NamingProfileMappingViewer generators={generators} schema={schema} />\n        </div>\n      )}\n\n      {/* Rule info */}\n      <div className=\"validation-rule-info\">\n        <div className=\"validation-rule-title\">\n          Active Validation Rules ({Object.keys(validationRules).length})\n        </div>\n        <ul className=\"validation-rule-list\">\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-danger\">\u25cf</span>\n            <strong>Reference Validation:</strong> Entity kinds (generators, pressures, systems),\n            relationship kinds (generators, pressures, systems), pressure IDs (generators, systems,\n            eras, actions), era\u2192generator/system references\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Balance Validation:</strong> Pressure sources/sinks (feedback, homeostasis,\n            generators, systems), orphan generators/systems (not in any era)\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Configuration Quality:</strong> Subtypes, statuses, cultures, tags, numeric\n            ranges\n          </li>\n        </ul>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}", "type": "{ schema?: Readonly<{ entityKinds: any[]; relationshipKinds: any[]; cultures: any[]; tagRegistry: any[]; }>; eras?: any[]; pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; usageMap?: any; onNavigateToGenerator: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/ValidationEditor.jsx::getValidationStatus", "name": "getValidationStatus", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/ValidationEditor.jsx", "sourceCode": "/**\n * Export validation status calculation for use by parent\n */\nexport function getValidationStatus(usageMap, schema, eras, pressures, generators, systems) {\n  const results = runValidations(\n    usageMap,\n    schema || { entityKinds: [], relationshipKinds: [], cultures: [], tagRegistry: [] },\n    eras || [],\n    pressures || [],\n    generators || [],\n    systems || []\n  );\n  return {\n    status: getOverallStatus(results),\n    errorCount: results.errors.length,\n    warningCount: results.warnings.length,\n    totalIssues: results.errors.length + results.warnings.length,\n  };\n}", "parameters": [{"name": "usageMap", "type": "any", "optional": false}, {"name": "schema", "type": "any", "optional": false}, {"name": "eras", "type": "any", "optional": false}, {"name": "pressures", "type": "any", "optional": false}, {"name": "generators", "type": "any", "optional": false}, {"name": "systems", "type": "any", "optional": false}], "returnType": "{ status: string; errorCount: number; warningCount: number; totalIssues: number; }"}, {"id": "apps/coherence-engine/webui/src/utils/persistence.js::buildStorageKey", "name": "buildStorageKey", "kind": "function", "filePath": "apps/coherence-engine/webui/src/utils/persistence.js", "sourceCode": "export function buildStorageKey(projectId, suffix) {\n  if (!projectId) return null;\n  return `${STORAGE_PREFIX}${projectId}:${suffix}`;\n}", "parameters": [{"name": "projectId", "type": "any", "optional": false}, {"name": "suffix", "type": "any", "optional": false}], "returnType": "string"}, {"id": "apps/coherence-engine/webui/src/utils/persistence.js::loadStoredValue", "name": "loadStoredValue", "kind": "function", "filePath": "apps/coherence-engine/webui/src/utils/persistence.js", "sourceCode": "export function loadStoredValue(key) {\n  if (!key || !canUseStorage()) return null;\n  try {\n    const raw = localStorage.getItem(key);\n    if (!raw) return null;\n    return JSON.parse(raw);\n  } catch {\n    return null;\n  }\n}", "parameters": [{"name": "key", "type": "any", "optional": false}], "returnType": "any"}, {"id": "apps/coherence-engine/webui/src/utils/persistence.js::saveStoredValue", "name": "saveStoredValue", "kind": "function", "filePath": "apps/coherence-engine/webui/src/utils/persistence.js", "sourceCode": "export function saveStoredValue(key, value) {\n  if (!key || !canUseStorage()) return;\n  try {\n    localStorage.setItem(key, JSON.stringify(value));\n  } catch {\n    // Best-effort only.\n  }\n}", "parameters": [{"name": "key", "type": "any", "optional": false}, {"name": "value", "type": "any", "optional": false}], "returnType": "void"}, {"id": "apps/coherence-engine/webui/src/utils/persistence.js::clearStoredValue", "name": "clearStoredValue", "kind": "function", "filePath": "apps/coherence-engine/webui/src/utils/persistence.js", "sourceCode": "export function clearStoredValue(key) {\n  if (!key || !canUseStorage()) return;\n  try {\n    localStorage.removeItem(key);\n  } catch {\n    // Best-effort only.\n  }\n}", "parameters": [{"name": "key", "type": "any", "optional": false}], "returnType": "void"}, {"id": "apps/coherence-engine/webui/src/components/actions/ActionsEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/actions/ActionsEditor.jsx", "sourceCode": "export default function ActionsEditor({\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"actions:selected\");\n  const {\n    selectedItem: selectedAction,\n    handleItemChange: handleActionChange,\n    handleToggle,\n    handleDelete,\n    handleAdd: handleAddAction,\n    handleSelect,\n    handleClose,\n  } = useEditorState(actions, onChange, { createItem: createAction, persistKey: selectionKey });\n\n  // Collect unique pressures across all actions\n  const uniquePressures = new Set();\n  actions.forEach((action) => {\n    (action.probability?.pressureModifiers || []).forEach((mod) => {\n      if (mod.pressure) uniquePressures.add(mod.pressure);\n    });\n  });\n\n  return (\n    <div className=\"actions-editor\">\n      <div className=\"actions-header\">\n        <h1 className=\"actions-title\">Actions</h1>\n        <p className=\"actions-subtitle\">\n          Actions define what agents can do during the simulation via the universal catalyst system.\n          Click an action to edit.\n        </p>\n        <div className=\"actions-stats\">\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Total Actions</span>\n            <span className=\"actions-stat-value\">{actions.length}</span>\n          </div>\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Pressures Referenced</span>\n            <span className=\"actions-stat-value\">{uniquePressures.size}</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"actions-grid\">\n        {actions.map((action, index) => (\n          <ActionListCard\n            key={action.id}\n            action={action}\n            onClick={() => handleSelect(index)}\n            onToggle={() => handleToggle(action)}\n            usageMap={usageMap}\n          />\n        ))}\n\n        <div className=\"actions-add-card\" onClick={() => handleAddAction()} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n          <span className=\"text-2xl\">+</span>\n          <span>Add Action</span>\n        </div>\n      </div>\n\n      {selectedAction && (\n        <ActionModal\n          action={selectedAction}\n          onChange={handleActionChange}\n          onClose={handleClose}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; actions?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/actions/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/actions/index.js", "sourceCode": "export default function ActionsEditor({\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"actions:selected\");\n  const {\n    selectedItem: selectedAction,\n    handleItemChange: handleActionChange,\n    handleToggle,\n    handleDelete,\n    handleAdd: handleAddAction,\n    handleSelect,\n    handleClose,\n  } = useEditorState(actions, onChange, { createItem: createAction, persistKey: selectionKey });\n\n  // Collect unique pressures across all actions\n  const uniquePressures = new Set();\n  actions.forEach((action) => {\n    (action.probability?.pressureModifiers || []).forEach((mod) => {\n      if (mod.pressure) uniquePressures.add(mod.pressure);\n    });\n  });\n\n  return (\n    <div className=\"actions-editor\">\n      <div className=\"actions-header\">\n        <h1 className=\"actions-title\">Actions</h1>\n        <p className=\"actions-subtitle\">\n          Actions define what agents can do during the simulation via the universal catalyst system.\n          Click an action to edit.\n        </p>\n        <div className=\"actions-stats\">\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Total Actions</span>\n            <span className=\"actions-stat-value\">{actions.length}</span>\n          </div>\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Pressures Referenced</span>\n            <span className=\"actions-stat-value\">{uniquePressures.size}</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"actions-grid\">\n        {actions.map((action, index) => (\n          <ActionListCard\n            key={action.id}\n            action={action}\n            onClick={() => handleSelect(index)}\n            onToggle={() => handleToggle(action)}\n            usageMap={usageMap}\n          />\n        ))}\n\n        <div className=\"actions-add-card\" onClick={() => handleAddAction()} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n          <span className=\"text-2xl\">+</span>\n          <span>Add Action</span>\n        </div>\n      </div>\n\n      {selectedAction && (\n        <ActionModal\n          action={selectedAction}\n          onChange={handleActionChange}\n          onClose={handleClose}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; actions?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/causal-loop/CausalLoopEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/causal-loop/CausalLoopEditor.jsx", "sourceCode": "export default function CausalLoopEditor({\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}) {\n  const containerRef = useRef(null);\n  const graphRef = useRef(null);\n  const [dimensions, setDimensions] = useState({ width: 800, height: 600 });\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [showLegend, setShowLegend] = useState(true);\n  const [showDisabled, setShowDisabled] = useState(true);\n  const [hoverNode, setHoverNode] = useState(null);\n\n  // Resize observer\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const updateDimensions = () => {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDimensions({\n        width: rect.width || 800,\n        height: Math.max(500, window.innerHeight - rect.top - 100),\n      });\n    };\n\n    updateDimensions();\n    const observer = new ResizeObserver(updateDimensions);\n    observer.observe(containerRef.current);\n    window.addEventListener(\"resize\", updateDimensions);\n\n    return () => {\n      observer.disconnect();\n      window.removeEventListener(\"resize\", updateDimensions);\n    };\n  }, []);\n\n  // Extract graph data\n  const {\n    nodes: graphNodes,\n    links: graphLinks,\n    warnings,\n  } = useMemo(\n    () =>\n      extractCausalGraph(pressures, generators, systems, actions, schema, showDisabled, usageMap),\n    [pressures, generators, systems, actions, schema, showDisabled, usageMap]\n  );\n  const graphData = useMemo(\n    () => ({ nodes: graphNodes, links: graphLinks }),\n    [graphNodes, graphLinks]\n  );\n\n  // Count disabled nodes for UI\n  const disabledCount = useMemo(() => {\n    const allNodes = extractCausalGraph(\n      pressures,\n      generators,\n      systems,\n      actions,\n      schema,\n      true,\n      usageMap\n    ).nodes;\n    return allNodes.filter((n) => n.isDisabled).length;\n  }, [pressures, generators, systems, actions, schema, usageMap]);\n\n  // Detect loops\n  const loops = useMemo(() => detectLoops(graphData.nodes, graphData.links), [graphData]);\n\n  const reinforcingLoops = loops.filter((l) => l.type === \"reinforcing\");\n  const balancingLoops = loops.filter((l) => l.type === \"balancing\");\n\n  // Node styling\n  const nodeCanvasObject = useCallback(\n    (node, ctx, globalScale) => {\n      const label = node.label;\n      const fontSize = Math.max(10 / globalScale, 3);\n      const abbrevFontSize = Math.max(8 / globalScale, 3);\n      const nodeRadius = Math.sqrt(node.val) * 3;\n      const isDisabled = node.isDisabled;\n\n      // Draw node circle with opacity for disabled\n      ctx.beginPath();\n      ctx.arc(node.x, node.y, nodeRadius, 0, 2 * Math.PI);\n      ctx.fillStyle = isDisabled ? `${node.color}60` : node.color;\n      ctx.fill();\n\n      // Strikethrough pattern for disabled nodes\n      if (isDisabled) {\n        ctx.strokeStyle = \"#64748b\";\n        ctx.lineWidth = 1 / globalScale;\n        ctx.setLineDash([2 / globalScale, 2 / globalScale]);\n        ctx.stroke();\n        ctx.setLineDash([]);\n      }\n\n      // Highlight selected/hovered\n      if (selectedNode === node.id || hoverNode === node.id) {\n        ctx.strokeStyle = \"#ffffff\";\n        ctx.lineWidth = 2 / globalScale;\n        ctx.stroke();\n      }\n\n      // Draw abbreviation inside node\n      ctx.font = `bold ${abbrevFontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"middle\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#0a1929\";\n      ctx.fillText(node.abbrev || \"?\", node.x, node.y);\n\n      // Draw label below node\n      ctx.font = `${fontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"top\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#e2e8f0\";\n      const displayLabel = label.length > 15 ? label.slice(0, 13) + \"...\" : label;\n      ctx.fillText(displayLabel, node.x, node.y + nodeRadius + 2);\n    },\n    [selectedNode, hoverNode]\n  );\n\n  // Link styling\n  const linkColor = useCallback((link) => {\n    return EDGE_COLORS[link.polarity] || EDGE_COLORS.neutral;\n  }, []);\n\n  const linkWidth = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? 1 : 2;\n  }, []);\n\n  const linkLineDash = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? [4, 4] : [];\n  }, []);\n\n  // Handle node click\n  const handleNodeClick = useCallback(\n    (node) => {\n      setSelectedNode(selectedNode === node.id ? null : node.id);\n    },\n    [selectedNode]\n  );\n\n  // Zoom to fit on load\n  useEffect(() => {\n    if (graphRef.current && graphData.nodes.length > 0) {\n      setTimeout(() => {\n        graphRef.current.zoomToFit(400, 60);\n      }, 500);\n    }\n  }, [graphData.nodes.length]);\n\n  const selectedNodeData = selectedNode ? graphData.nodes.find((n) => n.id === selectedNode) : null;\n\n  // Get edges for selected node\n  const selectedNodeEdges = useMemo(() => {\n    if (!selectedNode) return { incoming: [], outgoing: [] };\n    return {\n      incoming: graphData.links.filter((l) => {\n        const targetId = typeof l.target === \"object\" ? l.target.id : l.target;\n        return targetId === selectedNode;\n      }),\n      outgoing: graphData.links.filter((l) => {\n        const sourceId = typeof l.source === \"object\" ? l.source.id : l.source;\n        return sourceId === selectedNode;\n      }),\n    };\n  }, [selectedNode, graphData.links]);\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Causal Loop Diagram</h1>\n        <p className=\"subtitle\">\n          Visualize feedback loops between pressures, generators, systems, and entity kinds.\n          {loops.length > 0 && (\n            <span className=\"cl-loop-count\">\n              <span className=\"cl-loop-reinforcing\">{reinforcingLoops.length} reinforcing</span>\n              {\" / \"}\n              <span className=\"cl-loop-balancing\">{balancingLoops.length} balancing</span>\n              {\" loops detected\"}\n            </span>\n          )}\n        </p>\n      </div>\n\n      <div className=\"cl-toolbar\">\n        <button className=\"button-secondary\" onClick={() => setShowLegend(!showLegend)}>\n          {showLegend ? \"Hide\" : \"Show\"} Legend\n        </button>\n        {disabledCount > 0 && (\n          <button\n            className=\"button-secondary\"\n            onClick={() => setShowDisabled(!showDisabled)}\n            // eslint-disable-next-line local/no-inline-styles -- dynamic opacity toggle\n            style={{ opacity: showDisabled ? 1 : 0.7 }}\n          >\n            {showDisabled ? \"Hide\" : \"Show\"} Disabled ({disabledCount})\n          </button>\n        )}\n        <button className=\"button-secondary\" onClick={() => graphRef.current?.zoomToFit(400, 60)}>\n          Fit to View\n        </button>\n        <div className=\"cl-stats\">\n          <span>{graphData.nodes.length} nodes</span>\n          <span>{graphData.links.length} edges</span>\n          {warnings.length > 0 && (\n            <span className=\"cl-stats-warning\">{warnings.length} warnings</span>\n          )}\n          <span className=\"cl-stats-hint\">Scroll to zoom, drag to pan</span>\n        </div>\n      </div>\n\n      {/* Warnings */}\n      {warnings.length > 0 && (\n        <div className=\"cl-warnings-box\">\n          <div className=\"cl-warnings-title\">\n            Referential Integrity Warnings\n          </div>\n          <div className=\"cl-warnings-list\">\n            {warnings.slice(0, 5).map((w, i) => (\n              <div key={i}>{w.message}</div>\n            ))}\n            {warnings.length > 5 && (\n              <div className=\"cl-warnings-more\">\n                ...and {warnings.length - 5} more warnings\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Legend */}\n      {showLegend && (\n        <div className=\"cl-legend\">\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Nodes:</span>\n            {Object.entries(NODE_TYPES).map(([type, config]) => (\n              <span key={type} className=\"cl-legend-item\">\n                <span\n                  className=\"cl-legend-node\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per node type\n                  style={{ '--cl-node-color': config.color, backgroundColor: 'var(--cl-node-color)' }}\n                >\n                  {config.abbrev}\n                </span>\n                <span className=\"cl-legend-node-label\">{config.label}</span>\n              </span>\n            ))}\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Edges:</span>\n            <span className=\"cl-legend-item cl-edge-positive\">+ Positive</span>\n            <span className=\"cl-legend-item cl-edge-negative\">- Negative</span>\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Loops:</span>\n            <span className=\"cl-legend-item cl-loop-reinforcing\">Reinforcing (unstable)</span>\n            <span className=\"cl-legend-item cl-loop-balancing\">Balancing (stable)</span>\n          </div>\n        </div>\n      )}\n\n      {/* Graph container */}\n      <div ref={containerRef} className=\"cl-graph-container\">\n        {graphData.nodes.length === 0 ? (\n          <div className=\"cl-empty-state\">\n            <div className=\"cl-empty-icon\">&#128260;</div>\n            <div className=\"cl-empty-title\">\n              No causal relationships found\n            </div>\n            <div className=\"cl-empty-desc\">\n              Add pressures with feedback factors, generators with state updates, or systems with\n              pressure changes to see the causal loop diagram.\n            </div>\n          </div>\n        ) : (\n          <ForceGraph2D\n            ref={graphRef}\n            graphData={graphData}\n            width={dimensions.width}\n            height={dimensions.height}\n            backgroundColor=\"#0f172a\"\n            nodeCanvasObject={nodeCanvasObject}\n            nodePointerAreaPaint={(node, color, ctx) => {\n              const nodeRadius = Math.sqrt(node.val) * 3;\n              ctx.beginPath();\n              ctx.arc(node.x, node.y, nodeRadius + 5, 0, 2 * Math.PI);\n              ctx.fillStyle = color;\n              ctx.fill();\n            }}\n            linkColor={linkColor}\n            linkWidth={linkWidth}\n            linkLineDash={linkLineDash}\n            linkDirectionalArrowLength={6}\n            linkDirectionalArrowRelPos={0.9}\n            linkCurvature={0.2}\n            onNodeClick={handleNodeClick}\n            onNodeHover={(node) => setHoverNode(node?.id || null)}\n// ... (truncated)", "parameters": [{"name": "{\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}", "type": "{ pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; schema?: {}; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/causal-loop/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/causal-loop/index.js", "sourceCode": "export default function CausalLoopEditor({\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}) {\n  const containerRef = useRef(null);\n  const graphRef = useRef(null);\n  const [dimensions, setDimensions] = useState({ width: 800, height: 600 });\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [showLegend, setShowLegend] = useState(true);\n  const [showDisabled, setShowDisabled] = useState(true);\n  const [hoverNode, setHoverNode] = useState(null);\n\n  // Resize observer\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const updateDimensions = () => {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDimensions({\n        width: rect.width || 800,\n        height: Math.max(500, window.innerHeight - rect.top - 100),\n      });\n    };\n\n    updateDimensions();\n    const observer = new ResizeObserver(updateDimensions);\n    observer.observe(containerRef.current);\n    window.addEventListener(\"resize\", updateDimensions);\n\n    return () => {\n      observer.disconnect();\n      window.removeEventListener(\"resize\", updateDimensions);\n    };\n  }, []);\n\n  // Extract graph data\n  const {\n    nodes: graphNodes,\n    links: graphLinks,\n    warnings,\n  } = useMemo(\n    () =>\n      extractCausalGraph(pressures, generators, systems, actions, schema, showDisabled, usageMap),\n    [pressures, generators, systems, actions, schema, showDisabled, usageMap]\n  );\n  const graphData = useMemo(\n    () => ({ nodes: graphNodes, links: graphLinks }),\n    [graphNodes, graphLinks]\n  );\n\n  // Count disabled nodes for UI\n  const disabledCount = useMemo(() => {\n    const allNodes = extractCausalGraph(\n      pressures,\n      generators,\n      systems,\n      actions,\n      schema,\n      true,\n      usageMap\n    ).nodes;\n    return allNodes.filter((n) => n.isDisabled).length;\n  }, [pressures, generators, systems, actions, schema, usageMap]);\n\n  // Detect loops\n  const loops = useMemo(() => detectLoops(graphData.nodes, graphData.links), [graphData]);\n\n  const reinforcingLoops = loops.filter((l) => l.type === \"reinforcing\");\n  const balancingLoops = loops.filter((l) => l.type === \"balancing\");\n\n  // Node styling\n  const nodeCanvasObject = useCallback(\n    (node, ctx, globalScale) => {\n      const label = node.label;\n      const fontSize = Math.max(10 / globalScale, 3);\n      const abbrevFontSize = Math.max(8 / globalScale, 3);\n      const nodeRadius = Math.sqrt(node.val) * 3;\n      const isDisabled = node.isDisabled;\n\n      // Draw node circle with opacity for disabled\n      ctx.beginPath();\n      ctx.arc(node.x, node.y, nodeRadius, 0, 2 * Math.PI);\n      ctx.fillStyle = isDisabled ? `${node.color}60` : node.color;\n      ctx.fill();\n\n      // Strikethrough pattern for disabled nodes\n      if (isDisabled) {\n        ctx.strokeStyle = \"#64748b\";\n        ctx.lineWidth = 1 / globalScale;\n        ctx.setLineDash([2 / globalScale, 2 / globalScale]);\n        ctx.stroke();\n        ctx.setLineDash([]);\n      }\n\n      // Highlight selected/hovered\n      if (selectedNode === node.id || hoverNode === node.id) {\n        ctx.strokeStyle = \"#ffffff\";\n        ctx.lineWidth = 2 / globalScale;\n        ctx.stroke();\n      }\n\n      // Draw abbreviation inside node\n      ctx.font = `bold ${abbrevFontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"middle\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#0a1929\";\n      ctx.fillText(node.abbrev || \"?\", node.x, node.y);\n\n      // Draw label below node\n      ctx.font = `${fontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"top\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#e2e8f0\";\n      const displayLabel = label.length > 15 ? label.slice(0, 13) + \"...\" : label;\n      ctx.fillText(displayLabel, node.x, node.y + nodeRadius + 2);\n    },\n    [selectedNode, hoverNode]\n  );\n\n  // Link styling\n  const linkColor = useCallback((link) => {\n    return EDGE_COLORS[link.polarity] || EDGE_COLORS.neutral;\n  }, []);\n\n  const linkWidth = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? 1 : 2;\n  }, []);\n\n  const linkLineDash = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? [4, 4] : [];\n  }, []);\n\n  // Handle node click\n  const handleNodeClick = useCallback(\n    (node) => {\n      setSelectedNode(selectedNode === node.id ? null : node.id);\n    },\n    [selectedNode]\n  );\n\n  // Zoom to fit on load\n  useEffect(() => {\n    if (graphRef.current && graphData.nodes.length > 0) {\n      setTimeout(() => {\n        graphRef.current.zoomToFit(400, 60);\n      }, 500);\n    }\n  }, [graphData.nodes.length]);\n\n  const selectedNodeData = selectedNode ? graphData.nodes.find((n) => n.id === selectedNode) : null;\n\n  // Get edges for selected node\n  const selectedNodeEdges = useMemo(() => {\n    if (!selectedNode) return { incoming: [], outgoing: [] };\n    return {\n      incoming: graphData.links.filter((l) => {\n        const targetId = typeof l.target === \"object\" ? l.target.id : l.target;\n        return targetId === selectedNode;\n      }),\n      outgoing: graphData.links.filter((l) => {\n        const sourceId = typeof l.source === \"object\" ? l.source.id : l.source;\n        return sourceId === selectedNode;\n      }),\n    };\n  }, [selectedNode, graphData.links]);\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Causal Loop Diagram</h1>\n        <p className=\"subtitle\">\n          Visualize feedback loops between pressures, generators, systems, and entity kinds.\n          {loops.length > 0 && (\n            <span className=\"cl-loop-count\">\n              <span className=\"cl-loop-reinforcing\">{reinforcingLoops.length} reinforcing</span>\n              {\" / \"}\n              <span className=\"cl-loop-balancing\">{balancingLoops.length} balancing</span>\n              {\" loops detected\"}\n            </span>\n          )}\n        </p>\n      </div>\n\n      <div className=\"cl-toolbar\">\n        <button className=\"button-secondary\" onClick={() => setShowLegend(!showLegend)}>\n          {showLegend ? \"Hide\" : \"Show\"} Legend\n        </button>\n        {disabledCount > 0 && (\n          <button\n            className=\"button-secondary\"\n            onClick={() => setShowDisabled(!showDisabled)}\n            // eslint-disable-next-line local/no-inline-styles -- dynamic opacity toggle\n            style={{ opacity: showDisabled ? 1 : 0.7 }}\n          >\n            {showDisabled ? \"Hide\" : \"Show\"} Disabled ({disabledCount})\n          </button>\n        )}\n        <button className=\"button-secondary\" onClick={() => graphRef.current?.zoomToFit(400, 60)}>\n          Fit to View\n        </button>\n        <div className=\"cl-stats\">\n          <span>{graphData.nodes.length} nodes</span>\n          <span>{graphData.links.length} edges</span>\n          {warnings.length > 0 && (\n            <span className=\"cl-stats-warning\">{warnings.length} warnings</span>\n          )}\n          <span className=\"cl-stats-hint\">Scroll to zoom, drag to pan</span>\n        </div>\n      </div>\n\n      {/* Warnings */}\n      {warnings.length > 0 && (\n        <div className=\"cl-warnings-box\">\n          <div className=\"cl-warnings-title\">\n            Referential Integrity Warnings\n          </div>\n          <div className=\"cl-warnings-list\">\n            {warnings.slice(0, 5).map((w, i) => (\n              <div key={i}>{w.message}</div>\n            ))}\n            {warnings.length > 5 && (\n              <div className=\"cl-warnings-more\">\n                ...and {warnings.length - 5} more warnings\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Legend */}\n      {showLegend && (\n        <div className=\"cl-legend\">\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Nodes:</span>\n            {Object.entries(NODE_TYPES).map(([type, config]) => (\n              <span key={type} className=\"cl-legend-item\">\n                <span\n                  className=\"cl-legend-node\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per node type\n                  style={{ '--cl-node-color': config.color, backgroundColor: 'var(--cl-node-color)' }}\n                >\n                  {config.abbrev}\n                </span>\n                <span className=\"cl-legend-node-label\">{config.label}</span>\n              </span>\n            ))}\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Edges:</span>\n            <span className=\"cl-legend-item cl-edge-positive\">+ Positive</span>\n            <span className=\"cl-legend-item cl-edge-negative\">- Negative</span>\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Loops:</span>\n            <span className=\"cl-legend-item cl-loop-reinforcing\">Reinforcing (unstable)</span>\n            <span className=\"cl-legend-item cl-loop-balancing\">Balancing (stable)</span>\n          </div>\n        </div>\n      )}\n\n      {/* Graph container */}\n      <div ref={containerRef} className=\"cl-graph-container\">\n        {graphData.nodes.length === 0 ? (\n          <div className=\"cl-empty-state\">\n            <div className=\"cl-empty-icon\">&#128260;</div>\n            <div className=\"cl-empty-title\">\n              No causal relationships found\n            </div>\n            <div className=\"cl-empty-desc\">\n              Add pressures with feedback factors, generators with state updates, or systems with\n              pressure changes to see the causal loop diagram.\n            </div>\n          </div>\n        ) : (\n          <ForceGraph2D\n            ref={graphRef}\n            graphData={graphData}\n            width={dimensions.width}\n            height={dimensions.height}\n            backgroundColor=\"#0f172a\"\n            nodeCanvasObject={nodeCanvasObject}\n            nodePointerAreaPaint={(node, color, ctx) => {\n              const nodeRadius = Math.sqrt(node.val) * 3;\n              ctx.beginPath();\n              ctx.arc(node.x, node.y, nodeRadius + 5, 0, 2 * Math.PI);\n              ctx.fillStyle = color;\n              ctx.fill();\n            }}\n            linkColor={linkColor}\n            linkWidth={linkWidth}\n            linkLineDash={linkLineDash}\n            linkDirectionalArrowLength={6}\n            linkDirectionalArrowRelPos={0.9}\n            linkCurvature={0.2}\n            onNodeClick={handleNodeClick}\n            onNodeHover={(node) => setHoverNode(node?.id || null)}\n// ... (truncated)", "parameters": [{"name": "{\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}", "type": "{ pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; schema?: {}; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/DependencyViewer.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/DependencyViewer.jsx", "sourceCode": "export default function DependencyViewer({ usageMap }) {\n  // Prepare entity kinds data\n  const entityKindsData = useMemo(() => {\n    if (!usageMap?.entityKinds) return [];\n    return Object.entries(usageMap.entityKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare relationship kinds data\n  const relationshipKindsData = useMemo(() => {\n    if (!usageMap?.relationshipKinds) return [];\n    return Object.entries(usageMap.relationshipKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare pressures data\n  const pressuresData = useMemo(() => {\n    if (!usageMap?.pressures) return [];\n    return Object.entries(usageMap.pressures)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare generators data\n  const generatorsData = useMemo(() => {\n    if (!usageMap?.generators) return [];\n    return Object.entries(usageMap.generators)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare systems data\n  const systemsData = useMemo(() => {\n    if (!usageMap?.systems) return [];\n    return Object.entries(usageMap.systems)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare tags data\n  const tagsData = useMemo(() => {\n    if (!usageMap?.tags) return [];\n    return Object.entries(usageMap.tags)\n      .map(([tag, usage]) => ({\n        id: tag,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  if (!usageMap) {\n    return (\n      <div className=\"dependency-viewer-container\">\n        <div className=\"dependency-empty-state\">Loading dependency data...</div>\n      </div>\n    );\n  }\n\n  const renderSchemaItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      <UsageBadges usage={item.usage} />\n    </div>\n  );\n\n  const renderEraItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      {item.eraCount > 0 ? (\n        <div className=\"dependency-used-by-list\">\n          <span className=\"dependency-badge dependency-badge-era\">\n            {item.eraCount} era{item.eraCount !== 1 ? \"s\" : \"\"}\n          </span>\n        </div>\n      ) : (\n        <span className=\"dependency-orphan-badge\">Not in any era</span>\n      )}\n    </div>\n  );\n\n  return (\n    <div className=\"dependency-viewer-container\">\n      <div className=\"dependency-viewer-header\">\n        <div className=\"dependency-viewer-title\">\n          <span>\ud83d\udd17</span>\n          <span>Dependencies</span>\n        </div>\n        <div className=\"dependency-viewer-legend\">\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-generators\" />\n            <span>Generators</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-systems\" />\n            <span>Systems</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-actions\" />\n            <span>Actions</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-eras\" />\n            <span>Eras</span>\n          </div>\n        </div>\n      </div>\n\n      <DependencySection\n        title=\"Entity Kinds\"\n        icon=\"\ud83d\udce6\"\n        items={entityKindsData}\n        renderItem={renderSchemaItem}\n        defaultExpanded={true}\n      />\n\n      <DependencySection\n        title=\"Relationship Kinds\"\n        icon=\"\ud83d\udd17\"\n        items={relationshipKindsData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection title=\"Tags\" icon=\"\ud83c\udff7\ufe0f\" items={tagsData} renderItem={renderSchemaItem} />\n\n      <DependencySection\n        title=\"Pressures\"\n        icon=\"\ud83d\udcca\"\n        items={pressuresData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection\n        title=\"Generators \u2192 Eras\"\n        icon=\"\u2728\"\n        items={generatorsData}\n        renderItem={renderEraItem}\n      />\n\n      <DependencySection\n        title=\"Systems \u2192 Eras\"\n        icon=\"\u2699\ufe0f\"\n        items={systemsData}\n        renderItem={renderEraItem}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{ usageMap }", "type": "{ usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/index.js", "sourceCode": "export default function DependencyViewer({ usageMap }) {\n  // Prepare entity kinds data\n  const entityKindsData = useMemo(() => {\n    if (!usageMap?.entityKinds) return [];\n    return Object.entries(usageMap.entityKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare relationship kinds data\n  const relationshipKindsData = useMemo(() => {\n    if (!usageMap?.relationshipKinds) return [];\n    return Object.entries(usageMap.relationshipKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare pressures data\n  const pressuresData = useMemo(() => {\n    if (!usageMap?.pressures) return [];\n    return Object.entries(usageMap.pressures)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare generators data\n  const generatorsData = useMemo(() => {\n    if (!usageMap?.generators) return [];\n    return Object.entries(usageMap.generators)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare systems data\n  const systemsData = useMemo(() => {\n    if (!usageMap?.systems) return [];\n    return Object.entries(usageMap.systems)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare tags data\n  const tagsData = useMemo(() => {\n    if (!usageMap?.tags) return [];\n    return Object.entries(usageMap.tags)\n      .map(([tag, usage]) => ({\n        id: tag,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  if (!usageMap) {\n    return (\n      <div className=\"dependency-viewer-container\">\n        <div className=\"dependency-empty-state\">Loading dependency data...</div>\n      </div>\n    );\n  }\n\n  const renderSchemaItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      <UsageBadges usage={item.usage} />\n    </div>\n  );\n\n  const renderEraItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      {item.eraCount > 0 ? (\n        <div className=\"dependency-used-by-list\">\n          <span className=\"dependency-badge dependency-badge-era\">\n            {item.eraCount} era{item.eraCount !== 1 ? \"s\" : \"\"}\n          </span>\n        </div>\n      ) : (\n        <span className=\"dependency-orphan-badge\">Not in any era</span>\n      )}\n    </div>\n  );\n\n  return (\n    <div className=\"dependency-viewer-container\">\n      <div className=\"dependency-viewer-header\">\n        <div className=\"dependency-viewer-title\">\n          <span>\ud83d\udd17</span>\n          <span>Dependencies</span>\n        </div>\n        <div className=\"dependency-viewer-legend\">\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-generators\" />\n            <span>Generators</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-systems\" />\n            <span>Systems</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-actions\" />\n            <span>Actions</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-eras\" />\n            <span>Eras</span>\n          </div>\n        </div>\n      </div>\n\n      <DependencySection\n        title=\"Entity Kinds\"\n        icon=\"\ud83d\udce6\"\n        items={entityKindsData}\n        renderItem={renderSchemaItem}\n        defaultExpanded={true}\n      />\n\n      <DependencySection\n        title=\"Relationship Kinds\"\n        icon=\"\ud83d\udd17\"\n        items={relationshipKindsData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection title=\"Tags\" icon=\"\ud83c\udff7\ufe0f\" items={tagsData} renderItem={renderSchemaItem} />\n\n      <DependencySection\n        title=\"Pressures\"\n        icon=\"\ud83d\udcca\"\n        items={pressuresData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection\n        title=\"Generators \u2192 Eras\"\n        icon=\"\u2728\"\n        items={generatorsData}\n        renderItem={renderEraItem}\n      />\n\n      <DependencySection\n        title=\"Systems \u2192 Eras\"\n        icon=\"\u2699\ufe0f\"\n        items={systemsData}\n        renderItem={renderEraItem}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{ usageMap }", "type": "{ usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/eras/ErasEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/eras/ErasEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.eras - Array of era objects\n * @param {Function} props.onChange - Called when eras change\n * @param {Array} props.pressures - Available pressures\n * @param {Object} props.schema - Domain schema\n */\nexport default function ErasEditor({ eras = [], onChange, pressures = [], schema }) {\n  const [expandedEra, setExpandedEra] = useState(null);\n\n  const handleEraChange = useCallback(\n    (index, updatedEra) => {\n      const newEras = [...eras];\n      newEras[index] = updatedEra;\n      onChange(newEras);\n    },\n    [eras, onChange]\n  );\n\n  const handleDeleteEra = useCallback(\n    (index) => {\n      if (confirm(`Delete era \"${eras[index].name}\"?`)) {\n        const newEras = eras.filter((_, i) => i !== index);\n        onChange(newEras);\n        if (expandedEra === index) {\n          setExpandedEra(null);\n        }\n      }\n    },\n    [eras, onChange, expandedEra]\n  );\n\n  const handleAddEra = useCallback(() => {\n    const newEra = {\n      id: `era_${Date.now()}`,\n      name: \"New Era\",\n      description: \"A new period in world history\",\n      templateWeights: {},\n      systemModifiers: {},\n      entryConditions: [],\n      entryEffects: { mutations: [] },\n      exitConditions: [{ type: \"growth_phases_complete\", minPhases: 2 }],\n      exitEffects: { mutations: [] },\n    };\n    onChange([...eras, newEra]);\n    setExpandedEra(eras.length);\n  }, [eras, onChange]);\n\n  if (eras.length === 0) {\n    return (\n      <div className=\"editor-container\">\n        <div className=\"header\">\n          <h1 className=\"title\">Eras</h1>\n          <p className=\"subtitle\">Define historical eras that structure world generation</p>\n        </div>\n        <div className=\"empty-state\">\n          <div className=\"empty-state-icon\">\ud83d\udd70\ufe0f</div>\n          <div className=\"empty-state-title\">No eras defined</div>\n          <div className=\"empty-state-desc\">\n            Eras control which generators and systems are active during different phases of world\n            history.\n          </div>\n          <button\n            className=\"btn btn-primary ee-create-btn\"\n            onClick={handleAddEra}\n          >\n            + Create First Era\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Eras</h1>\n        <p className=\"subtitle\">\n          Define historical eras that structure world generation. Each era controls which generators\n          and systems are active and at what strength.\n        </p>\n      </div>\n\n      <div className=\"list-stack\">\n        {eras.map((era, index) => (\n          <EraCard\n            key={era.id}\n            era={era}\n            expanded={expandedEra === index}\n            onToggle={() => setExpandedEra(expandedEra === index ? null : index)}\n            onChange={(updatedEra) => handleEraChange(index, updatedEra)}\n            onDelete={() => handleDeleteEra(index)}\n            pressures={pressures}\n            schema={schema}\n            allEras={eras}\n          />\n        ))}\n\n        <button className=\"btn btn-add\" onClick={handleAddEra}>\n          + Add Era\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ eras = [], onChange, pressures = [], schema }", "type": "{ eras: any[]; onChange: Function; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/GeneratorModal.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/GeneratorModal.jsx", "sourceCode": "export function GeneratorModal({\n  generator,\n  onChange,\n  onClose,\n  onDelete,\n  onDuplicate,\n  schema,\n  pressures,\n  eras,\n  usageMap,\n  tagRegistry = [],\n}) {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  const tabValidation = useMemo(\n    () => computeTabValidation(generator, usageMap),\n    [generator, usageMap]\n  );\n\n  const renderTabBadge = useCallback(\n    (tabId) => {\n      return <TabValidationBadge count={tabValidation.tabErrors[tabId]} />;\n    },\n    [tabValidation.tabErrors]\n  );\n\n  const sidebarFooter = tabValidation.isOrphan ? (\n    <div className=\"orphan-badge-container\">\n      <OrphanBadge isOrphan={true} />\n    </div>\n  ) : null;\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case \"overview\":\n        return (\n          <OverviewTab\n            generator={generator}\n            onChange={onChange}\n            onDelete={onDelete}\n            onDuplicate={onDuplicate}\n          />\n        );\n      case \"applicability\":\n        return (\n          <ApplicabilityTab\n            generator={generator}\n            onChange={onChange}\n            schema={schema}\n            pressures={pressures}\n            eras={eras}\n          />\n        );\n      case \"target\":\n        return <TargetTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"variables\":\n        return <VariablesTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"creation\":\n        return (\n          <CreationTab\n            generator={generator}\n            onChange={onChange}\n            schema={schema}\n            tagRegistry={tagRegistry}\n            pressures={pressures}\n          />\n        );\n      case \"relationships\":\n        return <RelationshipsTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"effects\":\n        return (\n          <EffectsTab\n            generator={generator}\n            onChange={onChange}\n            pressures={pressures}\n            schema={schema}\n          />\n        );\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <ModalShell\n      onClose={onClose}\n      icon=\"\u2699\ufe0f\"\n      title={generator.name || generator.id}\n      disabled={generator.enabled === false}\n      tabs={TABS}\n      activeTab={activeTab}\n      onTabChange={setActiveTab}\n      renderTabBadge={renderTabBadge}\n      sidebarFooter={sidebarFooter}\n    >\n      {renderTabContent()}\n    </ModalShell>\n  );\n}", "parameters": [{"name": "{\n  generator,\n  onChange,\n  onClose,\n  onDelete,\n  onDuplicate,\n  schema,\n  pressures,\n  eras,\n  usageMap,\n  tagRegistry = [],\n}", "type": "{ generator: any; onChange: any; onClose: any; onDelete: any; onDuplicate: any; schema: any; pressures: any; eras: any; usageMap: any; tagRegistry?: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/GeneratorsEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/GeneratorsEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.generators - Array of generator configurations\n * @param {Function} props.onChange - Callback when generators change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport default function GeneratorsEditor({\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"generators:selected\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [expandedCategories, setExpandedCategories] = useState({});\n\n  // Derive selected generator from index - this ensures we always have the latest data\n  const resolvedIndex = selectedId ? generators.findIndex((g) => g.id === selectedId) : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedGenerator = selectedIndex !== null ? generators[selectedIndex] : null;\n\n  // Build entity kind info map for icons and labels\n  const entityKindInfo = useMemo(() => {\n    const info = {};\n    (schema?.entityKinds || []).forEach((ek) => {\n      info[ek.kind] = {\n        label: ek.description || ek.name || ek.kind,\n        icon: ek.icon || DEFAULT_KIND_ICONS[ek.kind] || \"\ud83d\udce6\",\n      };\n    });\n    return info;\n  }, [schema]);\n\n  // Group generators by the primary entity kind they create\n  const groupedGenerators = useMemo(() => {\n    const groups = {};\n\n    generators.forEach((generator) => {\n      // Get primary creation kind (first entity created, or target kind if no creation)\n      const createdKinds = (generator.creation || []).map((c) => c.kind).filter(Boolean);\n      const primaryKind = createdKinds[0] || generator.selection?.kind || \"uncategorized\";\n\n      if (!groups[primaryKind]) {\n        groups[primaryKind] = [];\n      }\n      groups[primaryKind].push(generator);\n    });\n\n    return groups;\n  }, [generators]);\n\n  // Get ordered list of categories\n  const categories = useMemo(() => {\n    // Order by schema entity kinds first, then any uncategorized\n    const schemaKinds = (schema?.entityKinds || []).map((ek) => ek.kind);\n    const usedKinds = Object.keys(groupedGenerators);\n\n    // Sort: schema kinds in order, then others alphabetically\n    return usedKinds.sort((a, b) => {\n      const aIdx = schemaKinds.indexOf(a);\n      const bIdx = schemaKinds.indexOf(b);\n      if (aIdx >= 0 && bIdx >= 0) return aIdx - bIdx;\n      if (aIdx >= 0) return -1;\n      if (bIdx >= 0) return 1;\n      return a.localeCompare(b);\n    });\n  }, [groupedGenerators, schema]);\n\n  // Initialize expanded state for new categories\n  useEffect(() => {\n    const needsUpdate = categories.some((cat) => expandedCategories[cat] === undefined);\n    if (!needsUpdate) return;\n    const updated = { ...expandedCategories };\n    categories.forEach((cat) => {\n      if (updated[cat] === undefined) {\n        updated[cat] = true;\n      }\n    });\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync category expansion defaults when categories change\n    setExpandedCategories(updated);\n  }, [categories, expandedCategories]);\n\n  // Restore selectedId from storage when selectionKey changes\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted selection when key changes\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  // Persist selectedId to storage\n  useEffect(() => {\n    if (!selectionKey) return;\n    if (selectedId) {\n      saveStoredValue(selectionKey, selectedId);\n    } else {\n      clearStoredValue(selectionKey);\n    }\n  }, [selectionKey, selectedId]);\n\n  // Clear invalid selectedId (during render)\n  if (selectedId && selectedIndex === null) {\n    setSelectedId(null);\n    clearStoredValue(selectionKey);\n  }\n\n  const handleGeneratorChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex < generators.length) {\n        const newGenerators = [...generators];\n        newGenerators[selectedIndex] = updated;\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (generator) => {\n      const index = generators.findIndex((g) => g.id === generator.id);\n      if (index >= 0) {\n        const newGenerators = [...generators];\n        newGenerators[index] = {\n          ...generator,\n          enabled: generator.enabled === false ? true : false,\n        };\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedGenerator &&\n      confirm(`Delete generator \"${selectedGenerator.name || selectedGenerator.id}\"?`)\n    ) {\n      const newGenerators = [...generators];\n      newGenerators.splice(selectedIndex, 1);\n      onChange(newGenerators);\n      setSelectedId(null);\n    }\n  }, [generators, onChange, selectedIndex, selectedGenerator]);\n\n  const handleAdd = useCallback(() => {\n    const newGenerator = {\n      id: `generator_${Date.now()}`,\n      name: \"New Generator\",\n      applicability: [],\n      selection: { strategy: \"by_kind\", kind: \"location\", pickStrategy: \"random\" },\n      creation: [],\n      relationships: [],\n      stateUpdates: [],\n      variables: {},\n    };\n    onChange([...generators, newGenerator]);\n    setSelectedId(newGenerator.id);\n  }, [generators, onChange]);\n\n  const handleDuplicate = useCallback(() => {\n    if (!selectedGenerator) return;\n    const duplicated = {\n      ...JSON.parse(JSON.stringify(selectedGenerator)), // Deep clone\n      id: `${selectedGenerator.id}_copy_${Date.now()}`,\n      name: `${selectedGenerator.name || selectedGenerator.id} (Copy)`,\n    };\n    onChange([...generators, duplicated]);\n    setSelectedId(duplicated.id);\n  }, [generators, onChange, selectedGenerator]);\n\n  const toggleCategoryExpand = useCallback((kind) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [kind]: !prev[kind],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (kind) => {\n      const categoryItems = groupedGenerators[kind] || [];\n      const allEnabled = categoryItems.every((g) => g.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of generators in this category\n      const categoryIds = new Set(categoryItems.map((g) => g.id));\n\n      const newGenerators = generators.map((g) => {\n        if (categoryIds.has(g.id)) {\n          return { ...g, enabled: newEnabled };\n        }\n        return g;\n      });\n      onChange(newGenerators);\n    },\n    [generators, groupedGenerators, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Generators</h1>\n        <p className=\"subtitle\">\n          Configure entity generators that populate your world. Click a generator to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((kind) => {\n        const kindInfo = entityKindInfo[kind] || {\n          label: kind.charAt(0).toUpperCase() + kind.slice(1),\n          icon: DEFAULT_KIND_ICONS[kind] || \"\ud83d\udce6\",\n        };\n        const categoryItems = groupedGenerators[kind] || [];\n        const allEnabled = categoryItems.every((g) => g.enabled !== false);\n\n        return (\n          <CategorySection\n            key={kind}\n            id={kind}\n            icon={kindInfo.icon}\n            label={`${kindInfo.label} Generators`}\n            items={categoryItems}\n            expanded={expandedCategories[kind] !== false}\n            onToggleExpand={() => toggleCategoryExpand(kind)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(kind)}\n            renderItem={(generator) => (\n              <GeneratorListCard\n                key={generator.id}\n                generator={generator}\n                onClick={() => setSelectedId(generator.id)}\n                onToggle={() => handleToggle(generator)}\n                usageMap={usageMap}\n              />\n            )}\n          />\n        );\n      })}\n\n      {/* Add Generator button */}\n      <div className=\"mt-lg\">\n        <AddCard onClick={handleAdd} label=\"Add Generator\" />\n      </div>\n\n      {selectedGenerator && (\n        <GeneratorModal\n          generator={selectedGenerator}\n          onChange={handleGeneratorChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          onDuplicate={handleDuplicate}\n          schema={schema}\n          pressures={pressures}\n          eras={eras}\n          usageMap={usageMap}\n          tagRegistry={schema.tagRegistry || []}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}", "type": "{ generators: any[]; onChange: Function; schema: any; pressures: any[]; eras: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.generators - Array of generator configurations\n * @param {Function} props.onChange - Callback when generators change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport default function GeneratorsEditor({\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"generators:selected\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [expandedCategories, setExpandedCategories] = useState({});\n\n  // Derive selected generator from index - this ensures we always have the latest data\n  const resolvedIndex = selectedId ? generators.findIndex((g) => g.id === selectedId) : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedGenerator = selectedIndex !== null ? generators[selectedIndex] : null;\n\n  // Build entity kind info map for icons and labels\n  const entityKindInfo = useMemo(() => {\n    const info = {};\n    (schema?.entityKinds || []).forEach((ek) => {\n      info[ek.kind] = {\n        label: ek.description || ek.name || ek.kind,\n        icon: ek.icon || DEFAULT_KIND_ICONS[ek.kind] || \"\ud83d\udce6\",\n      };\n    });\n    return info;\n  }, [schema]);\n\n  // Group generators by the primary entity kind they create\n  const groupedGenerators = useMemo(() => {\n    const groups = {};\n\n    generators.forEach((generator) => {\n      // Get primary creation kind (first entity created, or target kind if no creation)\n      const createdKinds = (generator.creation || []).map((c) => c.kind).filter(Boolean);\n      const primaryKind = createdKinds[0] || generator.selection?.kind || \"uncategorized\";\n\n      if (!groups[primaryKind]) {\n        groups[primaryKind] = [];\n      }\n      groups[primaryKind].push(generator);\n    });\n\n    return groups;\n  }, [generators]);\n\n  // Get ordered list of categories\n  const categories = useMemo(() => {\n    // Order by schema entity kinds first, then any uncategorized\n    const schemaKinds = (schema?.entityKinds || []).map((ek) => ek.kind);\n    const usedKinds = Object.keys(groupedGenerators);\n\n    // Sort: schema kinds in order, then others alphabetically\n    return usedKinds.sort((a, b) => {\n      const aIdx = schemaKinds.indexOf(a);\n      const bIdx = schemaKinds.indexOf(b);\n      if (aIdx >= 0 && bIdx >= 0) return aIdx - bIdx;\n      if (aIdx >= 0) return -1;\n      if (bIdx >= 0) return 1;\n      return a.localeCompare(b);\n    });\n  }, [groupedGenerators, schema]);\n\n  // Initialize expanded state for new categories\n  useEffect(() => {\n    const needsUpdate = categories.some((cat) => expandedCategories[cat] === undefined);\n    if (!needsUpdate) return;\n    const updated = { ...expandedCategories };\n    categories.forEach((cat) => {\n      if (updated[cat] === undefined) {\n        updated[cat] = true;\n      }\n    });\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync category expansion defaults when categories change\n    setExpandedCategories(updated);\n  }, [categories, expandedCategories]);\n\n  // Restore selectedId from storage when selectionKey changes\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted selection when key changes\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  // Persist selectedId to storage\n  useEffect(() => {\n    if (!selectionKey) return;\n    if (selectedId) {\n      saveStoredValue(selectionKey, selectedId);\n    } else {\n      clearStoredValue(selectionKey);\n    }\n  }, [selectionKey, selectedId]);\n\n  // Clear invalid selectedId (during render)\n  if (selectedId && selectedIndex === null) {\n    setSelectedId(null);\n    clearStoredValue(selectionKey);\n  }\n\n  const handleGeneratorChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex < generators.length) {\n        const newGenerators = [...generators];\n        newGenerators[selectedIndex] = updated;\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (generator) => {\n      const index = generators.findIndex((g) => g.id === generator.id);\n      if (index >= 0) {\n        const newGenerators = [...generators];\n        newGenerators[index] = {\n          ...generator,\n          enabled: generator.enabled === false ? true : false,\n        };\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedGenerator &&\n      confirm(`Delete generator \"${selectedGenerator.name || selectedGenerator.id}\"?`)\n    ) {\n      const newGenerators = [...generators];\n      newGenerators.splice(selectedIndex, 1);\n      onChange(newGenerators);\n      setSelectedId(null);\n    }\n  }, [generators, onChange, selectedIndex, selectedGenerator]);\n\n  const handleAdd = useCallback(() => {\n    const newGenerator = {\n      id: `generator_${Date.now()}`,\n      name: \"New Generator\",\n      applicability: [],\n      selection: { strategy: \"by_kind\", kind: \"location\", pickStrategy: \"random\" },\n      creation: [],\n      relationships: [],\n      stateUpdates: [],\n      variables: {},\n    };\n    onChange([...generators, newGenerator]);\n    setSelectedId(newGenerator.id);\n  }, [generators, onChange]);\n\n  const handleDuplicate = useCallback(() => {\n    if (!selectedGenerator) return;\n    const duplicated = {\n      ...JSON.parse(JSON.stringify(selectedGenerator)), // Deep clone\n      id: `${selectedGenerator.id}_copy_${Date.now()}`,\n      name: `${selectedGenerator.name || selectedGenerator.id} (Copy)`,\n    };\n    onChange([...generators, duplicated]);\n    setSelectedId(duplicated.id);\n  }, [generators, onChange, selectedGenerator]);\n\n  const toggleCategoryExpand = useCallback((kind) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [kind]: !prev[kind],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (kind) => {\n      const categoryItems = groupedGenerators[kind] || [];\n      const allEnabled = categoryItems.every((g) => g.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of generators in this category\n      const categoryIds = new Set(categoryItems.map((g) => g.id));\n\n      const newGenerators = generators.map((g) => {\n        if (categoryIds.has(g.id)) {\n          return { ...g, enabled: newEnabled };\n        }\n        return g;\n      });\n      onChange(newGenerators);\n    },\n    [generators, groupedGenerators, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Generators</h1>\n        <p className=\"subtitle\">\n          Configure entity generators that populate your world. Click a generator to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((kind) => {\n        const kindInfo = entityKindInfo[kind] || {\n          label: kind.charAt(0).toUpperCase() + kind.slice(1),\n          icon: DEFAULT_KIND_ICONS[kind] || \"\ud83d\udce6\",\n        };\n        const categoryItems = groupedGenerators[kind] || [];\n        const allEnabled = categoryItems.every((g) => g.enabled !== false);\n\n        return (\n          <CategorySection\n            key={kind}\n            id={kind}\n            icon={kindInfo.icon}\n            label={`${kindInfo.label} Generators`}\n            items={categoryItems}\n            expanded={expandedCategories[kind] !== false}\n            onToggleExpand={() => toggleCategoryExpand(kind)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(kind)}\n            renderItem={(generator) => (\n              <GeneratorListCard\n                key={generator.id}\n                generator={generator}\n                onClick={() => setSelectedId(generator.id)}\n                onToggle={() => handleToggle(generator)}\n                usageMap={usageMap}\n              />\n            )}\n          />\n        );\n      })}\n\n      {/* Add Generator button */}\n      <div className=\"mt-lg\">\n        <AddCard onClick={handleAdd} label=\"Add Generator\" />\n      </div>\n\n      {selectedGenerator && (\n        <GeneratorModal\n          generator={selectedGenerator}\n          onChange={handleGeneratorChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          onDuplicate={handleDuplicate}\n          schema={schema}\n          pressures={pressures}\n          eras={eras}\n          usageMap={usageMap}\n          tagRegistry={schema.tagRegistry || []}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}", "type": "{ generators: any[]; onChange: Function; schema: any; pressures: any[]; eras: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::createNewRule", "name": "createNewRule", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * createNewRule - Factory for creating new applicability rules\n */\n\n/**\n * Creates a new applicability rule with default values based on type\n * @param {string} type - The rule type\n * @param {Array} pressures - Available pressure definitions\n * @returns {Object} A new rule object with default values\n */\nexport function createNewRule(type, pressures) {\n  // Create rules with empty required fields - validation will flag them\n  // No domain-specific defaults - user must explicitly select values\n  const newRule = { type };\n  const firstPressure = (pressures || [])[0]?.id || \"\";\n\n  switch (type) {\n    case \"pressure\":\n      return { ...newRule, pressureId: firstPressure, min: 0, max: 100 };\n    case \"pressure_any_above\":\n      return { ...newRule, pressureIds: firstPressure ? [firstPressure] : [], threshold: 50 };\n    case \"pressure_compare\":\n      return { ...newRule, pressureA: firstPressure, pressureB: firstPressure, operator: \">\" };\n    case \"entity_count\":\n      return { ...newRule, kind: \"\", min: 0 };\n    case \"relationship_count\":\n      return { ...newRule, relationshipKind: \"\", direction: \"both\", min: 0 };\n    case \"relationship_exists\":\n      return { ...newRule, relationshipKind: \"\", direction: \"both\" };\n    case \"tag_exists\":\n      return { ...newRule, tag: \"\" };\n    case \"tag_absent\":\n      return { ...newRule, tag: \"\" };\n    case \"status\":\n      return { ...newRule, status: \"\" };\n    case \"prominence\":\n      return { ...newRule, min: \"recognized\" };\n    case \"time_elapsed\":\n      return { ...newRule, minTicks: 10, since: \"updated\" };\n    case \"growth_phases_complete\":\n      return { ...newRule, minPhases: 2 };\n    case \"era_match\":\n      return { ...newRule, eras: [] };\n    case \"random_chance\":\n      return { ...newRule, chance: 0.5 };\n    case \"cooldown_elapsed\":\n      return { ...newRule, cooldownTicks: 10 };\n    case \"creations_per_epoch\":\n      return { ...newRule, maxPerEpoch: 1 };\n    case \"graph_path\":\n      return { ...newRule, assert: { check: \"exists\", path: [] } };\n    case \"entity_exists\":\n      return { ...newRule, entity: \"$target\" };\n    case \"entity_has_relationship\":\n      return { ...newRule, entity: \"$target\", relationshipKind: \"\", direction: \"both\" };\n    case \"or\":\n    case \"and\":\n      return { ...newRule, conditions: [] };\n    case \"always\":\n    default:\n      return newRule;\n  }\n}", "parameters": [{"name": "type", "type": "string", "optional": false}, {"name": "pressures", "type": "any[]", "optional": false}], "returnType": "any"}, {"id": "apps/coherence-engine/webui/src/components/naming-profile-viewer/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/naming-profile-viewer/index.js", "sourceCode": "export default function NamingProfileMappingViewer({ generators = [], schema = {} }) {\n  const [showInherited, setShowInherited] = useState(false);\n\n  const { mappings, warnings } = useMemo(\n    () => analyzeNamingMappings(generators, schema),\n    [generators, schema]\n  );\n\n  // Group by generator for display\n  const groupedMappings = useMemo(() => {\n    const groups = {};\n    for (const m of mappings) {\n      if (!groups[m.generatorId]) {\n        groups[m.generatorId] = {\n          generatorId: m.generatorId,\n          generatorName: m.generatorName,\n          items: [],\n        };\n      }\n      groups[m.generatorId].items.push(m);\n    }\n    return Object.values(groups);\n  }, [mappings]);\n\n  // Filter warnings - show all by default, but can filter to just explicit cultures\n  const displayWarnings = showInherited\n    ? warnings\n    : warnings.filter(\n        (w) => w.cultureSource === \"explicit\" || w.reason === \"No matching strategy group\"\n      );\n\n  const successCount = mappings.filter((m) => m.match).length;\n  const warningCount = warnings.filter((w) => w.reason === \"No matching strategy group\").length;\n\n  if (mappings.length === 0) {\n    return (\n      <div className=\"naming-profile-container\">\n        <div className=\"naming-profile-header\">\n          <div className=\"naming-profile-title\">\n            <span>Naming Profile Mappings</span>\n          </div>\n        </div>\n        <div className=\"naming-profile-empty-state\">\n          No generators with entity creation defined. Add generators to see naming profile mappings.\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"naming-profile-container\">\n      <div className=\"naming-profile-header\">\n        <div className=\"naming-profile-title\">\n          <span>Naming Profile Mappings</span>\n        </div>\n        <div className=\"naming-profile-stats\">\n          <div className=\"naming-profile-stat-item\">\n            <span className=\"naming-profile-stat-value text-success\">{successCount}</span>\n            <span>matched</span>\n          </div>\n          <div className=\"naming-profile-stat-item\">\n            <span\n              className={`naming-profile-stat-value ${warningCount > 0 ? \"text-danger\" : \"text-muted\"}`}\n            >\n              {warningCount}\n            </span>\n            <span>missing</span>\n          </div>\n          <label className=\"cursor-pointer flex items-center gap-xs\">\n            <input\n              type=\"checkbox\"\n              checked={showInherited}\n              onChange={(e) => setShowInherited(e.target.checked)}\n            />\n            <span>Show inherited cultures</span>\n          </label>\n        </div>\n      </div>\n\n      <div className=\"naming-profile-content\">\n        {/* Warnings section */}\n        {displayWarnings.length > 0 && (\n          <div className=\"naming-profile-section\">\n            <div className=\"naming-profile-section-title\">\n              <span className=\"naming-profile-warning-icon\">Warning</span>\n              <span>Naming May Fail ({displayWarnings.length})</span>\n            </div>\n            <div className=\"naming-profile-warning-list\">\n              {displayWarnings.slice(0, 10).map((w, i) => (\n                <div\n                  key={`${w.generatorId}-${w.cultureId}-${i}`}\n                  className=\"naming-profile-warning-item\"\n                >\n                  <span className=\"naming-profile-warning-icon\">!</span>\n                  <span>\n                    <strong>{w.generatorName}</strong> creates <strong>{w.entityKind}</strong>\n                    {w.subtype && `:${w.subtype}`} for culture <strong>{w.cultureName}</strong> -{\" \"}\n                    {w.reason}\n                  </span>\n                </div>\n              ))}\n              {displayWarnings.length > 10 && (\n                <div\n                  className=\"text-muted py-md px-lg\"\n                >\n                  ... and {displayWarnings.length - 10} more\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Mappings table */}\n        <div className=\"naming-profile-section\">\n          <div className=\"naming-profile-section-title\">\n            <span>Entity Creation to Naming Profile</span>\n          </div>\n          <table className=\"naming-profile-mapping-table\">\n            <thead>\n              <tr>\n                <th className=\"naming-profile-table-header\">Generator</th>\n                <th className=\"naming-profile-table-header\">Entity Kind</th>\n                <th className=\"naming-profile-table-header\">Culture</th>\n                <th className=\"naming-profile-table-header\">Naming Profile</th>\n              </tr>\n            </thead>\n            <tbody>\n              {groupedMappings.slice(0, 20).flatMap((group) => {\n                // Filter items based on showInherited toggle\n                const filteredItems = showInherited\n                  ? group.items\n                  : group.items.filter(\n                      (m) => m.cultureSource === \"explicit\" || m.cultureSource === \"any\"\n                    );\n                // If no explicit cultures, show first inherited one as representative\n                const displayItems =\n                  filteredItems.length > 0 ? filteredItems : group.items.slice(0, 1);\n                return displayItems.map((m, idx) => (\n                  <tr\n                    key={`${m.generatorId}-${m.cultureId}-${m.entityKind}-${idx}`}\n                    className={`naming-profile-table-row ${!m.match && m.hasNamingProfile ? \"naming-profile-warning-row\" : \"\"}`}\n                  >\n                    <td className=\"naming-profile-table-cell naming-profile-generator-cell\">\n                      {idx === 0 ? m.generatorName : \"\"}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <span className=\"naming-profile-kind-badge\">{m.entityKind}</span>\n                      {m.subtype && (\n                        <span\n                          className=\"naming-profile-kind-badge naming-profile-kind-badge-transparent\"\n                        >\n                          {m.subtype}\n                        </span>\n                      )}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <div className=\"naming-profile-culture-cell\">\n                        {/* eslint-disable-next-line local/no-inline-styles -- dynamic culture color */}\n                        <span\n                          className=\"naming-profile-culture-dot\"\n                          style={{ '--npm-culture-color': m.cultureColor, backgroundColor: 'var(--npm-culture-color)' }}\n                        />\n                        <span>{m.cultureName}</span>\n                        {m.cultureSource === \"inherited\" && (\n                          <span className=\"naming-profile-badge naming-profile-badge-inherited\">\n                            inherited\n                          </span>\n                        )}\n                      </div>\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      {m.match && (\n                        <span className=\"naming-profile-badge naming-profile-badge-match\">\n                          {m.match.profileName || m.match.profileId}\n                          {m.match.groupName && ` / ${m.match.groupName}`}\n                        </span>\n                      )}\n                      {!m.match && !m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No profiles configured\n                        </span>\n                      )}\n                      {!m.match && m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No matching group\n                        </span>\n                      )}\n                    </td>\n                  </tr>\n                ));\n              })}\n            </tbody>\n          </table>\n          {groupedMappings.length > 20 && (\n            <div className=\"text-muted text-center text-xs p-md\">\n              Showing first 20 generators. Total: {groupedMappings.length}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generators = [], schema = {} }", "type": "{ generators?: any[]; schema?: {}; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/naming-profile-viewer/NamingProfileMappingViewer.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/naming-profile-viewer/NamingProfileMappingViewer.jsx", "sourceCode": "export default function NamingProfileMappingViewer({ generators = [], schema = {} }) {\n  const [showInherited, setShowInherited] = useState(false);\n\n  const { mappings, warnings } = useMemo(\n    () => analyzeNamingMappings(generators, schema),\n    [generators, schema]\n  );\n\n  // Group by generator for display\n  const groupedMappings = useMemo(() => {\n    const groups = {};\n    for (const m of mappings) {\n      if (!groups[m.generatorId]) {\n        groups[m.generatorId] = {\n          generatorId: m.generatorId,\n          generatorName: m.generatorName,\n          items: [],\n        };\n      }\n      groups[m.generatorId].items.push(m);\n    }\n    return Object.values(groups);\n  }, [mappings]);\n\n  // Filter warnings - show all by default, but can filter to just explicit cultures\n  const displayWarnings = showInherited\n    ? warnings\n    : warnings.filter(\n        (w) => w.cultureSource === \"explicit\" || w.reason === \"No matching strategy group\"\n      );\n\n  const successCount = mappings.filter((m) => m.match).length;\n  const warningCount = warnings.filter((w) => w.reason === \"No matching strategy group\").length;\n\n  if (mappings.length === 0) {\n    return (\n      <div className=\"naming-profile-container\">\n        <div className=\"naming-profile-header\">\n          <div className=\"naming-profile-title\">\n            <span>Naming Profile Mappings</span>\n          </div>\n        </div>\n        <div className=\"naming-profile-empty-state\">\n          No generators with entity creation defined. Add generators to see naming profile mappings.\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"naming-profile-container\">\n      <div className=\"naming-profile-header\">\n        <div className=\"naming-profile-title\">\n          <span>Naming Profile Mappings</span>\n        </div>\n        <div className=\"naming-profile-stats\">\n          <div className=\"naming-profile-stat-item\">\n            <span className=\"naming-profile-stat-value text-success\">{successCount}</span>\n            <span>matched</span>\n          </div>\n          <div className=\"naming-profile-stat-item\">\n            <span\n              className={`naming-profile-stat-value ${warningCount > 0 ? \"text-danger\" : \"text-muted\"}`}\n            >\n              {warningCount}\n            </span>\n            <span>missing</span>\n          </div>\n          <label className=\"cursor-pointer flex items-center gap-xs\">\n            <input\n              type=\"checkbox\"\n              checked={showInherited}\n              onChange={(e) => setShowInherited(e.target.checked)}\n            />\n            <span>Show inherited cultures</span>\n          </label>\n        </div>\n      </div>\n\n      <div className=\"naming-profile-content\">\n        {/* Warnings section */}\n        {displayWarnings.length > 0 && (\n          <div className=\"naming-profile-section\">\n            <div className=\"naming-profile-section-title\">\n              <span className=\"naming-profile-warning-icon\">Warning</span>\n              <span>Naming May Fail ({displayWarnings.length})</span>\n            </div>\n            <div className=\"naming-profile-warning-list\">\n              {displayWarnings.slice(0, 10).map((w, i) => (\n                <div\n                  key={`${w.generatorId}-${w.cultureId}-${i}`}\n                  className=\"naming-profile-warning-item\"\n                >\n                  <span className=\"naming-profile-warning-icon\">!</span>\n                  <span>\n                    <strong>{w.generatorName}</strong> creates <strong>{w.entityKind}</strong>\n                    {w.subtype && `:${w.subtype}`} for culture <strong>{w.cultureName}</strong> -{\" \"}\n                    {w.reason}\n                  </span>\n                </div>\n              ))}\n              {displayWarnings.length > 10 && (\n                <div\n                  className=\"text-muted py-md px-lg\"\n                >\n                  ... and {displayWarnings.length - 10} more\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Mappings table */}\n        <div className=\"naming-profile-section\">\n          <div className=\"naming-profile-section-title\">\n            <span>Entity Creation to Naming Profile</span>\n          </div>\n          <table className=\"naming-profile-mapping-table\">\n            <thead>\n              <tr>\n                <th className=\"naming-profile-table-header\">Generator</th>\n                <th className=\"naming-profile-table-header\">Entity Kind</th>\n                <th className=\"naming-profile-table-header\">Culture</th>\n                <th className=\"naming-profile-table-header\">Naming Profile</th>\n              </tr>\n            </thead>\n            <tbody>\n              {groupedMappings.slice(0, 20).flatMap((group) => {\n                // Filter items based on showInherited toggle\n                const filteredItems = showInherited\n                  ? group.items\n                  : group.items.filter(\n                      (m) => m.cultureSource === \"explicit\" || m.cultureSource === \"any\"\n                    );\n                // If no explicit cultures, show first inherited one as representative\n                const displayItems =\n                  filteredItems.length > 0 ? filteredItems : group.items.slice(0, 1);\n                return displayItems.map((m, idx) => (\n                  <tr\n                    key={`${m.generatorId}-${m.cultureId}-${m.entityKind}-${idx}`}\n                    className={`naming-profile-table-row ${!m.match && m.hasNamingProfile ? \"naming-profile-warning-row\" : \"\"}`}\n                  >\n                    <td className=\"naming-profile-table-cell naming-profile-generator-cell\">\n                      {idx === 0 ? m.generatorName : \"\"}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <span className=\"naming-profile-kind-badge\">{m.entityKind}</span>\n                      {m.subtype && (\n                        <span\n                          className=\"naming-profile-kind-badge naming-profile-kind-badge-transparent\"\n                        >\n                          {m.subtype}\n                        </span>\n                      )}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <div className=\"naming-profile-culture-cell\">\n                        {/* eslint-disable-next-line local/no-inline-styles -- dynamic culture color */}\n                        <span\n                          className=\"naming-profile-culture-dot\"\n                          style={{ '--npm-culture-color': m.cultureColor, backgroundColor: 'var(--npm-culture-color)' }}\n                        />\n                        <span>{m.cultureName}</span>\n                        {m.cultureSource === \"inherited\" && (\n                          <span className=\"naming-profile-badge naming-profile-badge-inherited\">\n                            inherited\n                          </span>\n                        )}\n                      </div>\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      {m.match && (\n                        <span className=\"naming-profile-badge naming-profile-badge-match\">\n                          {m.match.profileName || m.match.profileId}\n                          {m.match.groupName && ` / ${m.match.groupName}`}\n                        </span>\n                      )}\n                      {!m.match && !m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No profiles configured\n                        </span>\n                      )}\n                      {!m.match && m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No matching group\n                        </span>\n                      )}\n                    </td>\n                  </tr>\n                ));\n              })}\n            </tbody>\n          </table>\n          {groupedMappings.length > 20 && (\n            <div className=\"text-muted text-center text-xs p-md\">\n              Showing first 20 generators. Total: {groupedMappings.length}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generators = [], schema = {} }", "type": "{ generators?: any[]; schema?: {}; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/pressures/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/pressures/index.js", "sourceCode": "export default function PressuresEditor({ projectId, pressures = [], onChange, schema, usageMap }) {\n  const [expandedPressure, setExpandedPressure] = useState(null);\n  const factorModalKey = buildStorageKey(projectId, \"pressures:factorModal\");\n  const restoredRef = useRef(false);\n\n  useEffect(() => {\n    restoredRef.current = false;\n  }, [factorModalKey]);\n\n  // Restore expanded pressure from storage (one-time per modal key)\n  useEffect(() => {\n    if (restoredRef.current || !factorModalKey || pressures.length === 0) return;\n\n    const stored = loadStoredValue(factorModalKey);\n    if (stored?.pressureId) {\n      const index = pressures.findIndex((pressure) => pressure.id === stored.pressureId);\n      if (index >= 0) {\n        // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted UI expansion state\n        setExpandedPressure(index);\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    }\n    restoredRef.current = true;\n  }, [factorModalKey, pressures]);\n\n  const handlePressureChange = useCallback(\n    (index, updatedPressure) => {\n      const newPressures = [...pressures];\n      newPressures[index] = updatedPressure;\n      onChange(newPressures);\n    },\n    [pressures, onChange]\n  );\n\n  const handleDeletePressure = useCallback(\n    (index) => {\n      if (confirm(`Delete \"${pressures[index].name}\"?`)) {\n        const newPressures = pressures.filter((_, i) => i !== index);\n        onChange(newPressures);\n        if (expandedPressure === index) {\n          setExpandedPressure(null);\n        }\n      }\n    },\n    [pressures, onChange, expandedPressure]\n  );\n\n  const handleAddPressure = useCallback(() => {\n    const newPressure = {\n      id: `pressure_${Date.now()}`,\n      name: \"New Pressure\",\n      initialValue: 0,\n      homeostasis: 0.05,\n      description: \"\",\n      growth: {\n        positiveFeedback: [],\n        negativeFeedback: [],\n      },\n    };\n    onChange([...pressures, newPressure]);\n    setExpandedPressure(pressures.length);\n  }, [pressures, onChange]);\n\n  if (pressures.length === 0) {\n    return (\n      <div className=\"editor-container\">\n        <div className=\"header\">\n          <h1 className=\"title\">Pressures</h1>\n          <p className=\"subtitle\">\n            Configure environmental and social pressures that drive world evolution\n          </p>\n        </div>\n        <div className=\"empty-state\">\n          <div className=\"empty-state-icon\">\ud83c\udf21\ufe0f</div>\n          <div className=\"pe-empty-title\">\n            No pressures defined\n          </div>\n          <div className=\"pe-empty-desc\">\n            Pressures respond to world state with feedback and a pull toward equilibrium, driving\n            the narrative forward.\n          </div>\n          <button\n            className=\"btn btn-primary pe-create-btn\"\n            onClick={handleAddPressure}\n          >\n            + Create First Pressure\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Pressures</h1>\n        <p className=\"subtitle\">\n          Configure environmental and social pressures that drive world evolution. Each pressure has\n          feedback factors that make it grow or shrink based on world state plus a homeostatic pull\n          toward equilibrium.\n        </p>\n      </div>\n\n      <div className=\"list-stack\">\n        {pressures.map((pressure, index) => (\n          <PressureCard\n            key={index}\n            pressure={pressure}\n            expanded={expandedPressure === index}\n            onToggle={() => setExpandedPressure(expandedPressure === index ? null : index)}\n            onChange={(updatedPressure) => handlePressureChange(index, updatedPressure)}\n            onDelete={() => handleDeletePressure(index)}\n            schema={schema}\n            usageMap={usageMap}\n            projectId={projectId}\n          />\n        ))}\n\n        <button className=\"btn btn-add\" onClick={handleAddPressure}>\n          + Add Pressure\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ projectId, pressures = [], onChange, schema, usageMap }", "type": "{ projectId: any; pressures?: any[]; onChange: any; schema: any; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/pressures/PressuresEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/pressures/PressuresEditor.jsx", "sourceCode": "export default function PressuresEditor({ projectId, pressures = [], onChange, schema, usageMap }) {\n  const [expandedPressure, setExpandedPressure] = useState(null);\n  const factorModalKey = buildStorageKey(projectId, \"pressures:factorModal\");\n  const restoredRef = useRef(false);\n\n  useEffect(() => {\n    restoredRef.current = false;\n  }, [factorModalKey]);\n\n  // Restore expanded pressure from storage (one-time per modal key)\n  useEffect(() => {\n    if (restoredRef.current || !factorModalKey || pressures.length === 0) return;\n\n    const stored = loadStoredValue(factorModalKey);\n    if (stored?.pressureId) {\n      const index = pressures.findIndex((pressure) => pressure.id === stored.pressureId);\n      if (index >= 0) {\n        // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted UI expansion state\n        setExpandedPressure(index);\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    }\n    restoredRef.current = true;\n  }, [factorModalKey, pressures]);\n\n  const handlePressureChange = useCallback(\n    (index, updatedPressure) => {\n      const newPressures = [...pressures];\n      newPressures[index] = updatedPressure;\n      onChange(newPressures);\n    },\n    [pressures, onChange]\n  );\n\n  const handleDeletePressure = useCallback(\n    (index) => {\n      if (confirm(`Delete \"${pressures[index].name}\"?`)) {\n        const newPressures = pressures.filter((_, i) => i !== index);\n        onChange(newPressures);\n        if (expandedPressure === index) {\n          setExpandedPressure(null);\n        }\n      }\n    },\n    [pressures, onChange, expandedPressure]\n  );\n\n  const handleAddPressure = useCallback(() => {\n    const newPressure = {\n      id: `pressure_${Date.now()}`,\n      name: \"New Pressure\",\n      initialValue: 0,\n      homeostasis: 0.05,\n      description: \"\",\n      growth: {\n        positiveFeedback: [],\n        negativeFeedback: [],\n      },\n    };\n    onChange([...pressures, newPressure]);\n    setExpandedPressure(pressures.length);\n  }, [pressures, onChange]);\n\n  if (pressures.length === 0) {\n    return (\n      <div className=\"editor-container\">\n        <div className=\"header\">\n          <h1 className=\"title\">Pressures</h1>\n          <p className=\"subtitle\">\n            Configure environmental and social pressures that drive world evolution\n          </p>\n        </div>\n        <div className=\"empty-state\">\n          <div className=\"empty-state-icon\">\ud83c\udf21\ufe0f</div>\n          <div className=\"pe-empty-title\">\n            No pressures defined\n          </div>\n          <div className=\"pe-empty-desc\">\n            Pressures respond to world state with feedback and a pull toward equilibrium, driving\n            the narrative forward.\n          </div>\n          <button\n            className=\"btn btn-primary pe-create-btn\"\n            onClick={handleAddPressure}\n          >\n            + Create First Pressure\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Pressures</h1>\n        <p className=\"subtitle\">\n          Configure environmental and social pressures that drive world evolution. Each pressure has\n          feedback factors that make it grow or shrink based on world state plus a homeostatic pull\n          toward equilibrium.\n        </p>\n      </div>\n\n      <div className=\"list-stack\">\n        {pressures.map((pressure, index) => (\n          <PressureCard\n            key={index}\n            pressure={pressure}\n            expanded={expandedPressure === index}\n            onToggle={() => setExpandedPressure(expandedPressure === index ? null : index)}\n            onChange={(updatedPressure) => handlePressureChange(index, updatedPressure)}\n            onDelete={() => handleDeletePressure(index)}\n            schema={schema}\n            usageMap={usageMap}\n            projectId={projectId}\n          />\n        ))}\n\n        <button className=\"btn btn-add\" onClick={handleAddPressure}>\n          + Add Pressure\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ projectId, pressures = [], onChange, schema, usageMap }", "type": "{ projectId: any; pressures?: any[]; onChange: any; schema: any; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::getElementValidation", "name": "getElementValidation", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * Get validation status for a specific element\n */\nexport function getElementValidation(usageMap, type, id) {\n  const invalidRefs = usageMap.validation.invalidRefs.filter(\n    ref => ref.type === type && ref.id === id\n  );\n  const compatibility = usageMap.validation.compatibility.filter(\n    c => c.type === type && c.id === id\n  );\n  const isOrphan = usageMap.validation.orphans.some(\n    o => o.type === type && o.id === id\n  );\n\n  return {\n    isValid: invalidRefs.length === 0 && compatibility.length === 0,\n    invalidRefs,\n    compatibility,\n    isOrphan,\n  };\n}", "parameters": [{"name": "usageMap", "type": "any", "optional": false}, {"name": "type", "type": "any", "optional": false}, {"name": "id", "type": "any", "optional": false}], "returnType": "{ isValid: boolean; invalidRefs: any; compatibility: any; isOrphan: any; }"}, {"id": "apps/coherence-engine/webui/src/components/shared/MutationCard.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/shared/MutationCard.jsx", "sourceCode": "export function MutationCard({\n  mutation,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  entityOptions,\n  typeOptions,\n  createMutation,\n  titlePrefix,\n}) {\n  const [expanded, setExpanded] = useState(false);\n  const types = typeOptions || DEFAULT_MUTATION_TYPES;\n  const entityRefs = normalizeOptions(entityOptions);\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n  const pressureOptions = (pressures || []).map((p) => ({\n    value: p.id,\n    label: p.name || p.id,\n  }));\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const update = (field, value) => {\n    onChange({ ...mutation, [field]: value });\n  };\n\n  const updateType = (value) => {\n    if (createMutation) {\n      onChange(createMutation(value));\n      return;\n    }\n    update(\"type\", value);\n  };\n\n  const fallbackLabel =\n    types.find((t) => t.value === mutation.type)?.label ||\n    MUTATION_TYPE_META[mutation.type]?.label ||\n    mutation.type;\n  const typeMeta = MUTATION_TYPE_META[mutation.type] || { icon: \"?\", color: \"#6b7280\" };\n  const headerLabel = titlePrefix ? `${titlePrefix}: ${fallbackLabel}` : fallbackLabel;\n\n  const getSummary = () => {\n    switch (mutation.type) {\n      case \"modify_pressure\":\n        return `${mutation.pressureId || \"?\"} ${formatDelta(mutation.delta)}`;\n      case \"set_tag\": {\n        const value = mutation.value !== undefined ? ` = ${mutation.value}` : \"\";\n        return `${mutation.entity || \"?\"} tag ${mutation.tag || \"?\"}${value}`;\n      }\n      case \"remove_tag\":\n        return `${mutation.entity || \"?\"} remove ${mutation.tag || \"?\"}`;\n      case \"change_status\":\n        return `${mutation.entity || \"?\"} -> ${mutation.newStatus || \"?\"}`;\n      case \"adjust_prominence\":\n        return `${mutation.entity || \"?\"} ${formatDelta(mutation.delta)}`;\n      case \"archive_relationship\": {\n        return `${mutation.entity || \"?\"} ${mutation.relationshipKind || \"?\"} with ${mutation.with || \"?\"}`;\n      }\n      case \"archive_all_relationships\": {\n        const dirLabel =\n          mutation.direction && mutation.direction !== \"both\" ? ` (${mutation.direction})` : \"\";\n        return `${mutation.entity || \"?\"} all ${mutation.relationshipKind || \"?\"}${dirLabel}`;\n      }\n      case \"adjust_relationship_strength\":\n        return `${mutation.kind || \"?\"} ${mutation.src || \"?\"} -> ${mutation.dst || \"?\"} ${formatDelta(mutation.delta)}`;\n      case \"create_relationship\": {\n        const arrow = mutation.bidirectional ? \"<->\" : \"->\";\n        return `${mutation.kind || \"?\"} ${mutation.src || \"?\"} ${arrow} ${mutation.dst || \"?\"}`;\n      }\n      case \"update_rate_limit\":\n        return \"track execution\";\n      case \"transfer_relationship\":\n        return `${mutation.entity || \"?\"} ${mutation.relationshipKind || \"?\"} from ${mutation.from || \"?\"} to ${mutation.to || \"?\"}`;\n      case \"for_each_related\": {\n        const actionCount = (mutation.actions || []).length;\n        return `${mutation.relationship || \"?\"} (${actionCount} action${actionCount !== 1 ? \"s\" : \"\"})`;\n      }\n      case \"conditional\": {\n        const thenCount = (mutation.thenActions || []).length;\n        const elseCount = (mutation.elseActions || []).length;\n        return `then: ${thenCount}, else: ${elseCount}`;\n      }\n      default:\n        return \"\";\n    }\n  };\n\n  const summary = getSummary();\n\n  return (\n    <div className=\"condition-card\">\n      <div className={`condition-card-header ${expanded ? \"\" : \"mb-0\"}`}>\n        <div className=\"condition-card-type\">\n          {/* eslint-disable-next-line local/no-inline-styles -- dynamic type color */}\n          <div className=\"condition-card-icon\" style={{ '--mc-icon-bg': `${typeMeta.color}20`, backgroundColor: 'var(--mc-icon-bg)' }}>\n            {typeMeta.icon}\n          </div>\n          <div>\n            <div className=\"condition-card-label\">{headerLabel}</div>\n            {summary && <div className=\"condition-card-summary\">{summary}</div>}\n          </div>\n        </div>\n        <div className=\"condition-card-actions\">\n          <button className=\"btn-icon\" onClick={() => setExpanded(!expanded)}>\n            {expanded ? \"^\" : \"v\"}\n          </button>\n          {onRemove && (\n            <button className=\"btn-icon btn-icon-danger\" onClick={onRemove}>\n              x\n            </button>\n          )}\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"condition-card-fields\">\n          <div className=\"form-grid mc-fields-full\">\n            <ReferenceDropdown\n              label=\"Type\"\n              value={mutation.type}\n              onChange={updateType}\n              options={types}\n            />\n\n            {mutation.type === \"modify_pressure\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure\"\n                  value={mutation.pressureId || \"\"}\n                  onChange={(v) => update(\"pressureId\", v)}\n                  options={pressureOptions}\n                  placeholder=\"Select pressure...\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Delta\n                  <NumberInput value={mutation.delta} onChange={(v) => update(\"delta\", v ?? 0)} />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {(mutation.type === \"set_tag\" || mutation.type === \"remove_tag\") && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity\"\n                  value={mutation.entity || \"\"}\n                  onChange={(v) => update(\"entity\", v)}\n                  options={entityRefs}\n                  placeholder=\"Select entity...\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Tag\n                  <TagSelector\n                    value={mutation.tag ? [mutation.tag] : []}\n                    onChange={(tags) => update(\"tag\", tags[0] || \"\")}\n                    tagRegistry={tagRegistry}\n                    placeholder=\"Select tag...\"\n                    singleSelect\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {mutation.type === \"set_tag\" && (\n              <>\n                <div className=\"form-group\">\n                  <label htmlFor=\"value-optional\" className=\"label\">Value (optional)</label>\n                  <input id=\"value-optional\"\n                    type=\"text\"\n                    value={mutation.value !== undefined ? String(mutation.value) : \"\"}\n                    onChange={(e) => update(\"value\", parseTagValue(e.target.value))}\n                    className=\"input\"\n                    placeholder=\"true\"\n                    disabled={Boolean(mutation.valueFrom)}\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label htmlFor=\"value-source-optional\" className=\"label\">Value Source (optional)</label>\n                  <input id=\"value-source-optional\"\n                    type=\"text\"\n                    value={mutation.valueFrom || \"\"}\n                    onChange={(e) => update(\"valueFrom\", e.target.value || undefined)}\n                    className=\"input\"\n                    placeholder=\"e.g., cluster_id\"\n                  />\n                </div>\n              </>\n            )}\n\n            {mutation.type === \"change_status\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity\"\n                  value={mutation.entity || \"\"}\n                  onChange={(v) => update(\"entity\", v)}\n                  options={entityRefs}\n                  placeholder=\"Select entity...\"\n                />\n                <div className=\"form-group\">\n                  <label htmlFor=\"new-status\" className=\"label\">New Status</label>\n                  <input id=\"new-status\"\n                    type=\"text\"\n                    value={mutation.newStatus || \"\"}\n                    onChange={(e) => update(\"newStatus\", e.target.value || undefined)}\n                    className=\"input\"\n                    placeholder=\"e.g., active\"\n                  />\n                </div>\n              </>\n            )}\n\n            {mutation.type === \"adjust_prominence\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity\"\n                  value={mutation.entity || \"\"}\n                  onChange={(v) => update(\"entity\", v)}\n                  options={entityRefs}\n                  placeholder=\"Select entity...\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Delta\n                  <NumberInput\n                    value={mutation.delta}\n                    onChange={(v) => update(\"delta\", v ?? 0)}\n                    placeholder=\"e.g., 0.25 or -0.15\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {mutation.type === \"create_relationship\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Relationship Kind\"\n                  value={mutation.kind || \"\"}\n                  onChange={(v) => update(\"kind\", v)}\n                  options={relationshipKindOptions}\n                  placeholder=\"Select relationship...\"\n                />\n                <ReferenceDropdown\n                  label=\"Source\"\n                  value={mutation.src || \"\"}\n                  onChange={(v) => update(\"src\", v)}\n                  options={entityRefs}\n                  placeholder=\"Select source...\"\n                />\n                <ReferenceDropdown\n                  label=\"Destination\"\n                  value={mutation.dst || \"\"}\n                  onChange={(v) => update(\"dst\", v)}\n                  options={entityRefs}\n                  placeholder=\"Select destination...\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Strength\n                  <NumberInput\n                    value={mutation.strength}\n                    onChange={(v) => update(\"strength\", v)}\n                    min={0}\n                    max={1}\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label htmlFor=\"category-optional\" className=\"label\">Category (optional)</label>\n                  <input id=\"category-optional\"\n                    type=\"text\"\n                    value={mutation.category || \"\"}\n                    onChange={(e) => update(\"category\", e.target.value || undefined)}\n                    className=\"input\"\n                    placeholder=\"Optional\"\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"checkbox-label\">\n                    <input\n                      type=\"checkbox\"\n                      checked={mutation.bidirectional || false}\n                      onChange={(e) => update(\"bidirectional\", e.target.checked || undefined)}\n                      className=\"checkbox\"\n                    />\n                    Bidirectional\n                  </label>\n                </div>\n              </>\n            )}\n\n            {mutation.type === \"adjust_relationship_strength\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Relationship Kind\"\n                  value={mutation.kind || \"\"}\n                  onChange={(v) => update(\"kind\", v)}\n                  options={relationshipKindOptions}\n// ... (truncated)", "parameters": [{"name": "{\n  mutation,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  entityOptions,\n  typeOptions,\n  createMutation,\n  titlePrefix,\n}", "type": "{ mutation: any; onChange: any; onRemove: any; schema: any; pressures: any; entityOptions: any; typeOptions: any; createMutation: any; titlePrefix: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/shared/SelectionRuleEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/shared/SelectionRuleEditor.jsx", "sourceCode": "export function SelectionRuleEditor({\n  value,\n  onChange,\n  schema,\n  availableRefs = [],\n  showPickStrategy = true,\n  showMaxResults = true,\n  showFilters = true,\n  allowAnyKind = false,\n  showExcludeSubtypes = false,\n}) {\n  const selection = value || { strategy: \"by_kind\" };\n\n  const baseKindOptions = (schema?.entityKinds || []).map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n  const entityKindOptions = allowAnyKind\n    ? [{ value: \"any\", label: \"Any kind\" }, ...baseKindOptions]\n    : baseKindOptions;\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const getSubtypeOptions = (kind) => {\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const updateSelection = (field, fieldValue) => {\n    onChange({ ...selection, [field]: fieldValue });\n  };\n\n  const updateSelectionMultiple = (updates) => {\n    onChange({ ...selection, ...updates });\n  };\n\n  const referenceOptions = (availableRefs.length > 0 ? availableRefs : [\"$target\"]).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  return (\n    <div>\n      <div className=\"form-grid\">\n        <ReferenceDropdown\n          label=\"Selection Strategy\"\n          value={selection.strategy || \"by_kind\"}\n          onChange={(v) => updateSelection(\"strategy\", v)}\n          options={[\n            { value: \"by_kind\", label: \"By Entity Kind\" },\n            { value: \"by_preference_order\", label: \"By Subtype Preference\" },\n            { value: \"by_relationship\", label: \"By Relationship Presence\" },\n            { value: \"by_proximity\", label: \"By Proximity\" },\n            { value: \"by_prominence\", label: \"By Prominence\" },\n          ]}\n        />\n\n        {showPickStrategy && (\n          <ReferenceDropdown\n            label=\"Pick Strategy\"\n            value={selection.pickStrategy || \"random\"}\n            onChange={(v) => updateSelection(\"pickStrategy\", v)}\n            options={PICK_STRATEGIES}\n          />\n        )}\n\n        {showMaxResults && (\n          <div className=\"form-group\">\n            <label className=\"label\">Max Results\n            <NumberInput\n              value={selection.maxResults}\n              onChange={(v) => updateSelection(\"maxResults\", v)}\n              min={1}\n              integer\n              allowEmpty\n              placeholder=\"1\"\n            />\n            </label>\n          </div>\n        )}\n      </div>\n\n      <div className=\"form-grid mt-xl\">\n        <ReferenceDropdown\n          label=\"Entity Kind\"\n          value={selection.kind || \"\"}\n          onChange={(v) =>\n            updateSelectionMultiple({\n              kind: v || undefined,\n              subtypes: undefined,\n              excludeSubtypes: undefined,\n            })\n          }\n          options={entityKindOptions}\n          placeholder=\"Any kind\"\n        />\n        <div className=\"form-group\">\n          <label htmlFor=\"status-optional\" className=\"label\">Status (optional)</label>\n          <input id=\"status-optional\"\n            type=\"text\"\n            value={selection.status || \"\"}\n            onChange={(e) => updateSelection(\"status\", e.target.value || undefined)}\n            className=\"input\"\n            placeholder=\"e.g., active\"\n          />\n        </div>\n        <div className=\"form-group\">\n          <label htmlFor=\"not-status-optional\" className=\"label\">Not Status (optional)</label>\n          <input id=\"not-status-optional\"\n            type=\"text\"\n            value={selection.notStatus || \"\"}\n            onChange={(e) => updateSelection(\"notStatus\", e.target.value || undefined)}\n            className=\"input\"\n            placeholder=\"e.g., dead\"\n          />\n        </div>\n      </div>\n\n      {selection.kind && selection.kind !== \"any\" && (\n        <div className=\"mt-xl\">\n          <ChipSelect\n            label=\"Subtypes (optional)\"\n            value={selection.subtypes || []}\n            onChange={(v) => updateSelection(\"subtypes\", v.length > 0 ? v : undefined)}\n            options={getSubtypeOptions(selection.kind)}\n            placeholder=\"Any subtype\"\n          />\n        </div>\n      )}\n\n      {selection.kind && selection.kind !== \"any\" && showExcludeSubtypes && (\n        <div className=\"mt-xl\">\n          <ChipSelect\n            label=\"Exclude Subtypes (optional)\"\n            value={selection.excludeSubtypes || []}\n            onChange={(v) => updateSelection(\"excludeSubtypes\", v.length > 0 ? v : undefined)}\n            options={getSubtypeOptions(selection.kind)}\n            placeholder=\"None\"\n          />\n        </div>\n      )}\n\n      {selection.strategy === \"by_preference_order\" && (\n        <div className=\"mt-xl\">\n          <label htmlFor=\"subtype-preferences-comma-separated\" className=\"label\">Subtype Preferences (comma-separated)</label>\n          <input id=\"subtype-preferences-comma-separated\"\n            type=\"text\"\n            value={(selection.subtypePreferences || []).join(\", \")}\n            onChange={(e) => {\n              const prefs = e.target.value\n                .split(\",\")\n                .map((s) => s.trim())\n                .filter(Boolean);\n              updateSelection(\"subtypePreferences\", prefs.length > 0 ? prefs : undefined);\n            }}\n            className=\"input\"\n            placeholder=\"e.g., noble, commoner\"\n          />\n        </div>\n      )}\n\n      {selection.strategy === \"by_relationship\" && (\n        <div className=\"form-grid mt-xl\">\n          <ReferenceDropdown\n            label=\"Relationship Kind\"\n            value={selection.relationshipKind || \"\"}\n            onChange={(v) => updateSelection(\"relationshipKind\", v)}\n            options={relationshipKindOptions}\n            placeholder=\"Select relationship...\"\n          />\n          <ReferenceDropdown\n            label=\"Direction\"\n            value={selection.direction || \"both\"}\n            onChange={(v) => updateSelection(\"direction\", v)}\n            options={[\n              { value: \"both\", label: \"Both\" },\n              { value: \"src\", label: \"Source (outgoing)\" },\n              { value: \"dst\", label: \"Destination (incoming)\" },\n            ]}\n          />\n          <div className=\"form-group\">\n            <label className=\"checkbox-label\">\n              <input\n                type=\"checkbox\"\n                checked={selection.mustHave !== false}\n                onChange={(e) => updateSelection(\"mustHave\", e.target.checked)}\n                className=\"checkbox\"\n              />\n              Must Have Relationship\n            </label>\n          </div>\n        </div>\n      )}\n\n      {selection.strategy === \"by_proximity\" && (\n        <div className=\"form-grid mt-xl\">\n          <ReferenceDropdown\n            label=\"Reference Entity\"\n            value={selection.referenceEntity || \"\"}\n            onChange={(v) => updateSelection(\"referenceEntity\", v || undefined)}\n            options={referenceOptions}\n            placeholder={referenceOptions[0]?.value || \"\"}\n          />\n          <div className=\"form-group\">\n            <label className=\"label\">Max Distance\n            <NumberInput\n              value={selection.maxDistance}\n              onChange={(v) => updateSelection(\"maxDistance\", v)}\n              min={0}\n              allowEmpty\n              placeholder=\"50\"\n            />\n            </label>\n          </div>\n        </div>\n      )}\n\n      {selection.strategy === \"by_prominence\" && (\n        <div className=\"mt-xl\">\n          <ReferenceDropdown\n            label=\"Minimum Prominence\"\n            value={selection.minProminence || \"\"}\n            onChange={(v) => updateSelection(\"minProminence\", v || undefined)}\n            options={PROMINENCE_LEVELS.map((p) => ({ value: p.value, label: p.label }))}\n            placeholder=\"Any\"\n          />\n        </div>\n      )}\n\n      {showFilters && (\n        <div className=\"mt-2xl\">\n          <span className=\"label\">Selection Filters</span>\n          <div className=\"info-box-text mb-lg text-sm\">\n            Optional filters to narrow down which entities can be selected. All filters must pass.\n          </div>\n          <SelectionFiltersEditor\n            filters={selection.filters}\n            onChange={(filters) =>\n              updateSelection(\"filters\", filters.length > 0 ? filters : undefined)\n            }\n            schema={schema}\n            availableRefs={availableRefs}\n          />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  value,\n  onChange,\n  schema,\n  availableRefs = [],\n  showPickStrategy = true,\n  showMaxResults = true,\n  showFilters = true,\n  allowAnyKind = false,\n  showExcludeSubtypes = false,\n}", "type": "{ value: any; onChange: any; schema: any; availableRefs?: any[]; showPickStrategy?: boolean; showMaxResults?: boolean; showFilters?: boolean; allowAnyKind?: boolean; showExcludeSubtypes?: boolean; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/shared/VariableSelectionEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/shared/VariableSelectionEditor.jsx", "sourceCode": "export function VariableSelectionEditor({\n  value,\n  onChange,\n  schema,\n  availableRefs = [],\n  showPickStrategy = true,\n  showMaxResults = true,\n  allowPreferFilters = true,\n}) {\n  const select = value || {};\n  const selectionMode = getSelectionMode(select);\n  const isRelatedMode = selectionMode === \"related\";\n  const isPathMode = selectionMode === \"path\";\n  const fromSpec = isRelatedMode ? select.from : null;\n  const pathSpec = isPathMode ? select.from : null;\n\n  const entityKindOptions = (schema?.entityKinds || []).map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const getSubtypeOptions = (kind) => {\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const updateSelect = (field, fieldValue) => {\n    onChange({ ...select, [field]: fieldValue });\n  };\n\n  const updateSelectMultiple = (updates) => {\n    onChange({ ...select, ...updates });\n  };\n\n  const setMode = (mode) => {\n    if (mode === \"graph\") {\n      onChange({ ...select, from: \"graph\" });\n      return;\n    }\n    if (mode === \"path\") {\n      const startRef = availableRefs[0] || \"$self\";\n      onChange({\n        ...select,\n        from: {\n          path: [{ from: startRef, via: \"\", direction: \"both\" }],\n        },\n      });\n      return;\n    }\n    const relatedTo = availableRefs[0] || \"$target\";\n    onChange({\n      ...select,\n      from: { relatedTo, relationshipKind: \"\", direction: \"both\" },\n    });\n  };\n\n  const updatePathStep = (index, step) => {\n    const path = [...(pathSpec?.path || [])];\n    path[index] = step;\n    updateSelect(\"from\", { path });\n  };\n\n  const addPathStep = () => {\n    const path = [...(pathSpec?.path || [])];\n    path.push({ via: \"\", direction: \"both\" });\n    updateSelect(\"from\", { path });\n  };\n\n  const removePathStep = (index) => {\n    const path = (pathSpec?.path || []).filter((_, i) => i !== index);\n    if (path.length === 0) {\n      // Switch back to graph mode if no steps left\n      setMode(\"graph\");\n    } else {\n      updateSelect(\"from\", { path });\n    }\n  };\n\n  const updateFrom = (field, fieldValue) => {\n    const nextFrom = {\n      ...(fromSpec || {\n        relatedTo: availableRefs[0] || \"$target\",\n        relationshipKind: \"\",\n        direction: \"both\",\n      }),\n      [field]: fieldValue,\n    };\n    updateSelect(\"from\", nextFrom);\n  };\n\n  return (\n    <div>\n      <div className=\"form-grid\">\n        <ReferenceDropdown\n          label=\"Select From\"\n          value={selectionMode}\n          onChange={(v) => setMode(v)}\n          options={[\n            { value: \"graph\", label: \"Graph (by entity kind)\" },\n            { value: \"related\", label: \"Related Entities (single hop)\" },\n            { value: \"path\", label: \"Path Traversal (multi-hop)\" },\n          ]}\n        />\n\n        {selectionMode === \"graph\" && (\n          <ReferenceDropdown\n            label=\"Entity Kind\"\n            value={select.kind || \"\"}\n            onChange={(v) => updateSelectMultiple({ kind: v || undefined, subtypes: undefined })}\n            options={entityKindOptions}\n            placeholder=\"Any kind\"\n          />\n        )}\n\n        {isRelatedMode && (\n          <>\n            <ReferenceDropdown\n              label=\"Related To\"\n              value={fromSpec?.relatedTo || availableRefs[0] || \"$target\"}\n              onChange={(v) => updateFrom(\"relatedTo\", v)}\n              options={availableRefs.map((r) => ({ value: r, label: r }))}\n              placeholder=\"Select entity...\"\n            />\n            <ReferenceDropdown\n              label=\"Relationship Kind\"\n              value={fromSpec?.relationshipKind || \"\"}\n              onChange={(v) => updateFrom(\"relationshipKind\", v)}\n              options={relationshipKindOptions}\n              placeholder=\"Select relationship...\"\n            />\n            <ReferenceDropdown\n              label=\"Direction\"\n              value={fromSpec?.direction || \"both\"}\n              onChange={(v) => updateFrom(\"direction\", v)}\n              options={[\n                { value: \"both\", label: \"Both\" },\n                { value: \"src\", label: \"Source (outgoing)\" },\n                { value: \"dst\", label: \"Destination (incoming)\" },\n              ]}\n            />\n          </>\n        )}\n\n        {isPathMode && (\n          <div className=\"grid-col-full\">\n            <span className=\"label\">Path Steps</span>\n            <div className=\"info-box-text mb-lg text-sm\">\n              Multi-hop traversal from the starting entity through relationships.\n            </div>\n          </div>\n        )}\n\n        {showPickStrategy && (\n          <ReferenceDropdown\n            label=\"Pick Strategy\"\n            value={select.pickStrategy || \"\"}\n            onChange={(v) => updateSelect(\"pickStrategy\", v || undefined)}\n            options={VARIABLE_PICK_STRATEGIES}\n            placeholder=\"Select...\"\n          />\n        )}\n\n        {showMaxResults && (\n          <div className=\"form-group\">\n            <label className=\"label\">Max Results\n            <NumberInput\n              value={select.maxResults}\n              onChange={(v) => updateSelect(\"maxResults\", v)}\n              min={1}\n              integer\n              allowEmpty\n              placeholder=\"1\"\n            />\n            </label>\n          </div>\n        )}\n      </div>\n\n      {isPathMode && (\n        <div className=\"mt-xl\">\n          {(pathSpec?.path || []).map((step, index) => (\n            <div key={index} className=\"item-card mb-lg\">\n              <div className=\"item-card-header p-lg\">\n                <div className=\"item-card-icon\">\ud83d\udd17</div>\n                <div className=\"item-card-info\">\n                  <div className=\"item-card-title\">Step {index + 1}</div>\n                </div>\n                <button\n                  className=\"btn-icon btn-icon-danger\"\n                  onClick={() => removePathStep(index)}\n                  title=\"Remove step\"\n                >\n                  \u00d7\n                </button>\n              </div>\n              <div className=\"item-card-body\">\n                <div className=\"form-grid\">\n                  {index === 0 && (\n                    <ReferenceDropdown\n                      label=\"Start From\"\n                      value={step.from || availableRefs[0] || \"$self\"}\n                      onChange={(v) => updatePathStep(index, { ...step, from: v })}\n                      options={availableRefs.map((r) => ({ value: r, label: r }))}\n                      placeholder=\"Select entity...\"\n                    />\n                  )}\n                  <ReferenceDropdown\n                    label=\"Via Relationship\"\n                    value={step.via || \"\"}\n                    onChange={(v) => updatePathStep(index, { ...step, via: v })}\n                    options={relationshipKindOptions}\n                    placeholder=\"Select relationship...\"\n                  />\n                  <ReferenceDropdown\n                    label=\"Direction\"\n                    value={step.direction || \"both\"}\n                    onChange={(v) => updatePathStep(index, { ...step, direction: v })}\n                    options={[\n                      { value: \"both\", label: \"Both\" },\n                      { value: \"src\", label: \"Source (outgoing)\" },\n                      { value: \"dst\", label: \"Destination (incoming)\" },\n                    ]}\n                  />\n                  <ReferenceDropdown\n                    label=\"Target Kind (optional)\"\n                    value={step.targetKind || \"\"}\n                    onChange={(v) => updatePathStep(index, { ...step, targetKind: v || undefined })}\n                    options={entityKindOptions}\n                    placeholder=\"Any kind\"\n                  />\n                </div>\n              </div>\n            </div>\n          ))}\n          <button className=\"btn-add\" onClick={addPathStep}>\n            + Add Step\n          </button>\n        </div>\n      )}\n\n      {(isRelatedMode || isPathMode) && (\n        <div className=\"mt-xl\">\n          <ReferenceDropdown\n            label=\"Filter by Entity Kind (optional)\"\n            value={select.kind || \"\"}\n            onChange={(v) => updateSelectMultiple({ kind: v || undefined, subtypes: undefined })}\n            options={entityKindOptions}\n            placeholder=\"Any kind\"\n          />\n        </div>\n      )}\n\n      {select.kind && (\n        <div className=\"mt-xl\">\n          <ChipSelect\n            label=\"Subtypes (optional)\"\n            value={select.subtypes || []}\n            onChange={(v) => updateSelect(\"subtypes\", v.length > 0 ? v : undefined)}\n            options={getSubtypeOptions(select.kind)}\n            placeholder=\"Any subtype\"\n          />\n        </div>\n      )}\n\n      <div className=\"mt-xl\">\n        <label htmlFor=\"status-filter-optional\" className=\"label\">Status Filter (optional)</label>\n        <input id=\"status-filter-optional\"\n          type=\"text\"\n          value={select.status || \"\"}\n          onChange={(e) => updateSelect(\"status\", e.target.value || undefined)}\n          className=\"input\"\n          placeholder=\"e.g., active\"\n        />\n      </div>\n\n      <div className=\"mt-xl\">\n        <label htmlFor=\"not-status-optional\" className=\"label\">Not Status (optional)</label>\n        <input id=\"not-status-optional\"\n          type=\"text\"\n          value={select.notStatus || \"\"}\n          onChange={(e) => updateSelect(\"notStatus\", e.target.value || undefined)}\n          className=\"input\"\n          placeholder=\"e.g., dead\"\n        />\n      </div>\n\n      <div className=\"mt-2xl\">\n        <span className=\"label\">Selection Filters</span>\n        <div className=\"info-box-text mb-lg text-sm\">\n          Optional filters to narrow down which entities can be selected. All filters must pass.\n        </div>\n        <SelectionFiltersEditor\n          filters={select.filters}\n          onChange={(filters) => updateSelect(\"filters\", filters.length > 0 ? filters : undefined)}\n// ... (truncated)", "parameters": [{"name": "{\n  value,\n  onChange,\n  schema,\n  availableRefs = [],\n  showPickStrategy = true,\n  showMaxResults = true,\n  allowPreferFilters = true,\n}", "type": "{ value: any; onChange: any; schema: any; availableRefs?: any[]; showPickStrategy?: boolean; showMaxResults?: boolean; allowPreferFilters?: boolean; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/systems/constants.js::getSystemCategory", "name": "getSystemCategory", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/systems/constants.js", "sourceCode": "/**\n * Get the category for a system type\n * @param {string} systemType - The system type\n * @returns {string} The category name\n */\nexport function getSystemCategory(systemType) {\n  if (FRAMEWORK_SYSTEM_TYPES.has(systemType)) {\n    return \"framework\";\n  }\n  return systemType;\n}", "parameters": [{"name": "systemType", "type": "string", "optional": false}], "returnType": "string"}, {"id": "apps/coherence-engine/webui/src/components/systems/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/systems/index.js", "sourceCode": "export default function SystemsEditor({\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"systems:selected\");\n  const typePickerKey = buildStorageKey(projectId, \"systems:typePicker\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [showTypePicker, setShowTypePicker] = useState(\n    () => loadStoredValue(typePickerKey) === true\n  );\n\n  // Derive selectedSystem from index\n  const resolvedIndex = selectedId\n    ? systems.findIndex((system) => system.config?.id === selectedId)\n    : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedSystem = selectedIndex !== null ? systems[selectedIndex] : null;\n  const [expandedCategories, setExpandedCategories] = useState(() => {\n    // Start with all categories expanded\n    return Object.keys(SYSTEM_CATEGORIES).reduce((acc, cat) => {\n      acc[cat] = true;\n      return acc;\n    }, {});\n  });\n  const mouseDownOnOverlay = useRef(false);\n\n  const handleOverlayMouseDown = useCallback((e) => {\n    mouseDownOnOverlay.current = e.target === e.currentTarget;\n  }, []);\n\n  const handleOverlayClick = useCallback((e) => {\n    if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n      setShowTypePicker(false);\n    }\n  }, []);\n\n  // Group systems by category (framework systems grouped together)\n  const groupedSystems = useMemo(() => {\n    const groups = {};\n    systems.forEach((system) => {\n      const category = getSystemCategory(system.systemType || \"unknown\");\n      if (!groups[category]) {\n        groups[category] = [];\n      }\n      groups[category].push(system);\n    });\n    return groups;\n  }, [systems]);\n\n  // Get ordered list of categories that have systems\n  const categories = useMemo(() => {\n    const usedCategories = Object.keys(groupedSystems);\n    // Sort by defined order in SYSTEM_CATEGORIES\n    return usedCategories.sort((a, b) => {\n      const orderA = SYSTEM_CATEGORIES[a]?.order ?? 999;\n      const orderB = SYSTEM_CATEGORIES[b]?.order ?? 999;\n      return orderA - orderB;\n    });\n  }, [groupedSystems]);\n\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  useEffect(() => {\n    setShowTypePicker(loadStoredValue(typePickerKey) === true);\n  }, [typePickerKey]);\n\n  useEffect(() => {\n    if (selectionKey) {\n      if (selectedId) {\n        saveStoredValue(selectionKey, selectedId);\n      } else {\n        clearStoredValue(selectionKey);\n      }\n    }\n  }, [selectionKey, selectedId]);\n\n  useEffect(() => {\n    if (typePickerKey) {\n      if (showTypePicker) {\n        saveStoredValue(typePickerKey, true);\n      } else {\n        clearStoredValue(typePickerKey);\n      }\n    }\n  }, [typePickerKey, showTypePicker]);\n\n  useEffect(() => {\n    if (selectedId && selectedIndex === null) {\n      setSelectedId(null);\n      clearStoredValue(selectionKey);\n    }\n  }, [selectedId, selectedIndex, selectionKey]);\n\n  const handleSystemChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex >= 0 && selectedIndex < systems.length) {\n        const newSystems = [...systems];\n        newSystems[selectedIndex] = updated;\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (system) => {\n      const index = systems.findIndex((s) => s.config?.id === system.config?.id);\n      if (index >= 0) {\n        const newSystems = [...systems];\n        newSystems[index] = { ...system, enabled: system.enabled === false ? true : false };\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedSystem &&\n      confirm(`Delete system \"${selectedSystem.config?.name || selectedSystem.config?.id}\"?`)\n    ) {\n      const newSystems = systems.filter((_, i) => i !== selectedIndex);\n      onChange(newSystems);\n      setSelectedId(null);\n    }\n  }, [systems, onChange, selectedIndex, selectedSystem]);\n\n  const handleAddSystem = useCallback(\n    (type) => {\n      const needsSelection = [\n        \"graphContagion\",\n        \"connectionEvolution\",\n        \"thresholdTrigger\",\n        \"clusterFormation\",\n        \"tagDiffusion\",\n        \"planeDiffusion\",\n      ].includes(type);\n      const newSystem = {\n        systemType: type,\n        config: {\n          id: `system_${Date.now()}`,\n          name: `New ${SYSTEM_TYPES[type]?.label || type}`,\n          description: \"\",\n          ...(needsSelection ? { selection: { strategy: \"by_kind\", kind: \"any\" } } : {}),\n        },\n      };\n      onChange([...systems, newSystem]);\n      setSelectedId(newSystem.config.id);\n      setShowTypePicker(false);\n    },\n    [systems, onChange]\n  );\n\n  const toggleCategoryExpand = useCallback((type) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [type]: !prev[type],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (category) => {\n      const categoryItems = groupedSystems[category] || [];\n      const allEnabled = categoryItems.every((s) => s.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of systems in this category\n      const categoryIds = new Set(categoryItems.map((s) => s.config?.id));\n\n      const newSystems = systems.map((s) => {\n        if (categoryIds.has(s.config?.id)) {\n          return { ...s, enabled: newEnabled };\n        }\n        return s;\n      });\n      onChange(newSystems);\n    },\n    [systems, groupedSystems, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Systems</h1>\n        <p className=\"subtitle\">\n          Configure simulation systems that run during the simulation phase. Click a system to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((category) => {\n        const categoryConfig = SYSTEM_CATEGORIES[category] || { icon: \"\u2699\ufe0f\", label: category };\n        const categoryItems = groupedSystems[category] || [];\n        const allEnabled = categoryItems.every((s) => s.enabled !== false);\n\n        return (\n          <CategorySection\n            key={category}\n            id={category}\n            icon={categoryConfig.icon}\n            label={categoryConfig.label}\n            items={categoryItems}\n            expanded={expandedCategories[category] !== false}\n            onToggleExpand={() => toggleCategoryExpand(category)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(category)}\n            gridClassName=\"list-grid\"\n            renderItem={(system) => {\n              const flatIndex = systems.findIndex((s) => s.config?.id === system.config?.id);\n              return (\n                <SystemListCard\n                  key={flatIndex}\n                  system={system}\n                  onClick={() => setSelectedId(system.config.id)}\n                  onToggle={() => handleToggle(system)}\n                  usageMap={usageMap}\n                />\n              );\n            }}\n          />\n        );\n      })}\n\n      {/* Add System button */}\n      <div className=\"mt-xl\">\n        <div\n          className=\"add-card se-add-card-wrap\"\n          onClick={() => setShowTypePicker(true)}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n        >\n          <span className=\"se-add-icon\">+</span>\n          <span>Add System</span>\n        </div>\n      </div>\n\n      {showTypePicker && (\n        <div\n          className=\"modal-overlay\"\n          onMouseDown={handleOverlayMouseDown}\n          onClick={handleOverlayClick}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n        >\n          <div className=\"modal se-type-picker-modal\">\n            <div className=\"modal-header\">\n              <div className=\"modal-title\">Choose System Type</div>\n              <button className=\"close-btn\" onClick={() => setShowTypePicker(false)}>\n                \u00d7\n              </button>\n            </div>\n            <div className=\"se-type-picker-content\">\n              <div className=\"type-picker\">\n                {Object.entries(SYSTEM_TYPES).map(([type, config]) => (\n                  <div\n                    key={type}\n                    className=\"se-type-option type-option\"\n                    onClick={() => handleAddSystem(type)}\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    <div className=\"type-option-icon\">{config.icon}</div>\n                    <div className=\"type-option-label\">{config.label}</div>\n                    <div className=\"type-option-desc\">{config.desc}</div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {selectedSystem && (\n        <SystemModal\n          system={selectedSystem}\n          onChange={handleSystemChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; systems?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/systems/SystemsEditor.jsx::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/systems/SystemsEditor.jsx", "sourceCode": "export default function SystemsEditor({\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"systems:selected\");\n  const typePickerKey = buildStorageKey(projectId, \"systems:typePicker\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [showTypePicker, setShowTypePicker] = useState(\n    () => loadStoredValue(typePickerKey) === true\n  );\n\n  // Derive selectedSystem from index\n  const resolvedIndex = selectedId\n    ? systems.findIndex((system) => system.config?.id === selectedId)\n    : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedSystem = selectedIndex !== null ? systems[selectedIndex] : null;\n  const [expandedCategories, setExpandedCategories] = useState(() => {\n    // Start with all categories expanded\n    return Object.keys(SYSTEM_CATEGORIES).reduce((acc, cat) => {\n      acc[cat] = true;\n      return acc;\n    }, {});\n  });\n  const mouseDownOnOverlay = useRef(false);\n\n  const handleOverlayMouseDown = useCallback((e) => {\n    mouseDownOnOverlay.current = e.target === e.currentTarget;\n  }, []);\n\n  const handleOverlayClick = useCallback((e) => {\n    if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n      setShowTypePicker(false);\n    }\n  }, []);\n\n  // Group systems by category (framework systems grouped together)\n  const groupedSystems = useMemo(() => {\n    const groups = {};\n    systems.forEach((system) => {\n      const category = getSystemCategory(system.systemType || \"unknown\");\n      if (!groups[category]) {\n        groups[category] = [];\n      }\n      groups[category].push(system);\n    });\n    return groups;\n  }, [systems]);\n\n  // Get ordered list of categories that have systems\n  const categories = useMemo(() => {\n    const usedCategories = Object.keys(groupedSystems);\n    // Sort by defined order in SYSTEM_CATEGORIES\n    return usedCategories.sort((a, b) => {\n      const orderA = SYSTEM_CATEGORIES[a]?.order ?? 999;\n      const orderB = SYSTEM_CATEGORIES[b]?.order ?? 999;\n      return orderA - orderB;\n    });\n  }, [groupedSystems]);\n\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  useEffect(() => {\n    setShowTypePicker(loadStoredValue(typePickerKey) === true);\n  }, [typePickerKey]);\n\n  useEffect(() => {\n    if (selectionKey) {\n      if (selectedId) {\n        saveStoredValue(selectionKey, selectedId);\n      } else {\n        clearStoredValue(selectionKey);\n      }\n    }\n  }, [selectionKey, selectedId]);\n\n  useEffect(() => {\n    if (typePickerKey) {\n      if (showTypePicker) {\n        saveStoredValue(typePickerKey, true);\n      } else {\n        clearStoredValue(typePickerKey);\n      }\n    }\n  }, [typePickerKey, showTypePicker]);\n\n  useEffect(() => {\n    if (selectedId && selectedIndex === null) {\n      setSelectedId(null);\n      clearStoredValue(selectionKey);\n    }\n  }, [selectedId, selectedIndex, selectionKey]);\n\n  const handleSystemChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex >= 0 && selectedIndex < systems.length) {\n        const newSystems = [...systems];\n        newSystems[selectedIndex] = updated;\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (system) => {\n      const index = systems.findIndex((s) => s.config?.id === system.config?.id);\n      if (index >= 0) {\n        const newSystems = [...systems];\n        newSystems[index] = { ...system, enabled: system.enabled === false ? true : false };\n        onChange(newSystems);\n      }\n    },\n    [systems, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedSystem &&\n      confirm(`Delete system \"${selectedSystem.config?.name || selectedSystem.config?.id}\"?`)\n    ) {\n      const newSystems = systems.filter((_, i) => i !== selectedIndex);\n      onChange(newSystems);\n      setSelectedId(null);\n    }\n  }, [systems, onChange, selectedIndex, selectedSystem]);\n\n  const handleAddSystem = useCallback(\n    (type) => {\n      const needsSelection = [\n        \"graphContagion\",\n        \"connectionEvolution\",\n        \"thresholdTrigger\",\n        \"clusterFormation\",\n        \"tagDiffusion\",\n        \"planeDiffusion\",\n      ].includes(type);\n      const newSystem = {\n        systemType: type,\n        config: {\n          id: `system_${Date.now()}`,\n          name: `New ${SYSTEM_TYPES[type]?.label || type}`,\n          description: \"\",\n          ...(needsSelection ? { selection: { strategy: \"by_kind\", kind: \"any\" } } : {}),\n        },\n      };\n      onChange([...systems, newSystem]);\n      setSelectedId(newSystem.config.id);\n      setShowTypePicker(false);\n    },\n    [systems, onChange]\n  );\n\n  const toggleCategoryExpand = useCallback((type) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [type]: !prev[type],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (category) => {\n      const categoryItems = groupedSystems[category] || [];\n      const allEnabled = categoryItems.every((s) => s.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of systems in this category\n      const categoryIds = new Set(categoryItems.map((s) => s.config?.id));\n\n      const newSystems = systems.map((s) => {\n        if (categoryIds.has(s.config?.id)) {\n          return { ...s, enabled: newEnabled };\n        }\n        return s;\n      });\n      onChange(newSystems);\n    },\n    [systems, groupedSystems, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Systems</h1>\n        <p className=\"subtitle\">\n          Configure simulation systems that run during the simulation phase. Click a system to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((category) => {\n        const categoryConfig = SYSTEM_CATEGORIES[category] || { icon: \"\u2699\ufe0f\", label: category };\n        const categoryItems = groupedSystems[category] || [];\n        const allEnabled = categoryItems.every((s) => s.enabled !== false);\n\n        return (\n          <CategorySection\n            key={category}\n            id={category}\n            icon={categoryConfig.icon}\n            label={categoryConfig.label}\n            items={categoryItems}\n            expanded={expandedCategories[category] !== false}\n            onToggleExpand={() => toggleCategoryExpand(category)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(category)}\n            gridClassName=\"list-grid\"\n            renderItem={(system) => {\n              const flatIndex = systems.findIndex((s) => s.config?.id === system.config?.id);\n              return (\n                <SystemListCard\n                  key={flatIndex}\n                  system={system}\n                  onClick={() => setSelectedId(system.config.id)}\n                  onToggle={() => handleToggle(system)}\n                  usageMap={usageMap}\n                />\n              );\n            }}\n          />\n        );\n      })}\n\n      {/* Add System button */}\n      <div className=\"mt-xl\">\n        <div\n          className=\"add-card se-add-card-wrap\"\n          onClick={() => setShowTypePicker(true)}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n        >\n          <span className=\"se-add-icon\">+</span>\n          <span>Add System</span>\n        </div>\n      </div>\n\n      {showTypePicker && (\n        <div\n          className=\"modal-overlay\"\n          onMouseDown={handleOverlayMouseDown}\n          onClick={handleOverlayClick}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n        >\n          <div className=\"modal se-type-picker-modal\">\n            <div className=\"modal-header\">\n              <div className=\"modal-title\">Choose System Type</div>\n              <button className=\"close-btn\" onClick={() => setShowTypePicker(false)}>\n                \u00d7\n              </button>\n            </div>\n            <div className=\"se-type-picker-content\">\n              <div className=\"type-picker\">\n                {Object.entries(SYSTEM_TYPES).map(([type, config]) => (\n                  <div\n                    key={type}\n                    className=\"se-type-option type-option\"\n                    onClick={() => handleAddSystem(type)}\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    <div className=\"type-option-icon\">{config.icon}</div>\n                    <div className=\"type-option-label\">{config.label}</div>\n                    <div className=\"type-option-desc\">{config.desc}</div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {selectedSystem && (\n        <SystemModal\n          system={selectedSystem}\n          onChange={handleSystemChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  systems = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; systems?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}, {"id": "apps/coherence-engine/webui/src/components/validation/index.js::default", "name": "default", "kind": "function", "filePath": "apps/coherence-engine/webui/src/components/validation/index.js", "sourceCode": "export default function ValidationEditor({\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}) {\n  const validationResults = useMemo(\n    () => runValidations(usageMap, schema, eras, pressures, generators, systems),\n    [usageMap, schema, eras, pressures, generators, systems]\n  );\n\n  // Count orphans from usageMap for summary\n  const orphanCounts = useMemo(() => {\n    if (!usageMap?.validation?.orphans)\n      return { generators: 0, systems: 0, pressures: 0, total: 0 };\n    const orphans = usageMap.validation.orphans;\n    const generators = orphans.filter((o) => o.type === \"generator\").length;\n    const systems = orphans.filter((o) => o.type === \"system\").length;\n    const pressures = orphans.filter((o) => o.type === \"pressure\").length;\n    return { generators, systems, pressures, total: generators + systems + pressures };\n  }, [usageMap]);\n\n  const overallStatus = getOverallStatus(validationResults);\n  const totalIssues = validationResults.errors.length + validationResults.warnings.length;\n  const hasNamingProfiles = useMemo(\n    () => (schema.cultures || []).some((culture) => culture.naming?.profiles?.length),\n    [schema]\n  );\n\n  let statusModifier;\n  if (overallStatus === \"clean\") {\n    statusModifier = \"validation-status-clean\";\n  } else if (overallStatus === \"warning\") {\n    statusModifier = \"validation-status-warning\";\n  } else {\n    statusModifier = \"validation-status-error\";\n  }\n  const statusBadgeClass = `validation-status-badge ${statusModifier}`;\n\n  const handleItemClick = (itemId) => {\n    if (onNavigateToGenerator) {\n      onNavigateToGenerator(itemId);\n    }\n  };\n\n  // Count total affected items\n  const totalAffectedItems = [...validationResults.errors, ...validationResults.warnings].reduce(\n    (sum, issue) => sum + issue.affectedItems.length,\n    0\n  );\n\n  return (\n    <div className=\"validation-container\">\n      <div className=\"validation-header\">\n        <div className=\"flex-between items-start\">\n          <div>\n            <h1 className=\"validation-title\">\n              Validation\n              <span className={statusBadgeClass}>\n                {(() => {\n                  if (overallStatus === \"clean\") return \"All Clear\";\n                  const issueWord = totalIssues === 1 ? \"Issue\" : \"Issues\";\n                  return `${totalIssues} ${issueWord}`;\n                })()}\n              </span>\n            </h1>\n            <p className=\"validation-subtitle\">\n              Semantic validation: reference integrity, pressure balance, and dead code detection.\n              Structure validation runs automatically as a gate before simulation.\n            </p>\n          </div>\n          {totalIssues > 0 && (\n            <div className=\"validation-export-row\">\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsJson(validationResults)}\n                title=\"Export validation report as JSON\"\n              >\n                Export JSON\n              </button>\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsCsv(validationResults)}\n                title=\"Export validation report as CSV\"\n              >\n                Export CSV\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"validation-summary-cards validation-summary-cards-4\">\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-danger\">\n            {validationResults.errors.length}\n          </div>\n          <div className=\"validation-summary-label\">Errors</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-warning\">\n            {validationResults.warnings.length}\n          </div>\n          <div className=\"validation-summary-label\">Warnings</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div\n            className={`validation-summary-value ${orphanCounts.total > 0 ? \"text-muted\" : \"text-info\"}`}\n          >\n            {orphanCounts.total}\n          </div>\n          <div className=\"validation-summary-label\">Unused</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-info\">\n            {totalAffectedItems}\n          </div>\n          <div className=\"validation-summary-label\">Affected Items</div>\n        </div>\n      </div>\n\n      {/* Clean state */}\n      {overallStatus === \"clean\" && (\n        <div className=\"validation-clean-state\">\n          <div className=\"validation-clean-icon\">\u2713</div>\n          <div className=\"validation-clean-title\">All Validations Passed</div>\n          <div className=\"validation-clean-message\">\n            Your configuration looks good. No issues detected.\n          </div>\n        </div>\n      )}\n\n      {/* Errors section */}\n      {validationResults.errors.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u274c</span>\n              Errors\n            </div>\n            <span className=\"validation-section-count validation-status-error\">\n              {validationResults.errors.length}\n            </span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.errors.map((error) => (\n              <IssueCard key={error.id} issue={error} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Warnings section */}\n      {validationResults.warnings.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u26a0\ufe0f</span>\n              Warnings\n            </div>\n            <span className=\"validation-section-count\">{validationResults.warnings.length}</span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.warnings.map((warning) => (\n              <IssueCard key={warning.id} issue={warning} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Dependency Viewer */}\n      {usageMap && (\n        <div className=\"mb-2xl\">\n          <DependencyViewer usageMap={usageMap} />\n        </div>\n      )}\n\n      {/* Naming Profile Mappings */}\n      {hasNamingProfiles && (\n        <div className=\"mb-2xl\">\n          <NamingProfileMappingViewer generators={generators} schema={schema} />\n        </div>\n      )}\n\n      {/* Rule info */}\n      <div className=\"validation-rule-info\">\n        <div className=\"validation-rule-title\">\n          Active Validation Rules ({Object.keys(validationRules).length})\n        </div>\n        <ul className=\"validation-rule-list\">\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-danger\">\u25cf</span>\n            <strong>Reference Validation:</strong> Entity kinds (generators, pressures, systems),\n            relationship kinds (generators, pressures, systems), pressure IDs (generators, systems,\n            eras, actions), era\u2192generator/system references\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Balance Validation:</strong> Pressure sources/sinks (feedback, homeostasis,\n            generators, systems), orphan generators/systems (not in any era)\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Configuration Quality:</strong> Subtypes, statuses, cultures, tags, numeric\n            ranges\n          </li>\n        </ul>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}", "type": "{ schema?: Readonly<{ entityKinds: any[]; relationshipKinds: any[]; cultures: any[]; tagRegistry: any[]; }>; eras?: any[]; pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; usageMap?: any; onNavigateToGenerator: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element"}]