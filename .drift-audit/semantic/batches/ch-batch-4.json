[{"id": "apps/coherence-engine/webui/src/components/ValidationEditor.jsx::ValidationEditor", "name": "ValidationEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/ValidationEditor.jsx", "sourceCode": "export default function ValidationEditor({\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}) {\n  const validationResults = useMemo(\n    () => runValidations(usageMap, schema, eras, pressures, generators, systems),\n    [usageMap, schema, eras, pressures, generators, systems]\n  );\n\n  // Count orphans from usageMap for summary\n  const orphanCounts = useMemo(() => {\n    if (!usageMap?.validation?.orphans)\n      return { generators: 0, systems: 0, pressures: 0, total: 0 };\n    const orphans = usageMap.validation.orphans;\n    const generators = orphans.filter((o) => o.type === \"generator\").length;\n    const systems = orphans.filter((o) => o.type === \"system\").length;\n    const pressures = orphans.filter((o) => o.type === \"pressure\").length;\n    return { generators, systems, pressures, total: generators + systems + pressures };\n  }, [usageMap]);\n\n  const overallStatus = getOverallStatus(validationResults);\n  const totalIssues = validationResults.errors.length + validationResults.warnings.length;\n  const hasNamingProfiles = useMemo(\n    () => (schema.cultures || []).some((culture) => culture.naming?.profiles?.length),\n    [schema]\n  );\n\n  let statusModifier;\n  if (overallStatus === \"clean\") {\n    statusModifier = \"validation-status-clean\";\n  } else if (overallStatus === \"warning\") {\n    statusModifier = \"validation-status-warning\";\n  } else {\n    statusModifier = \"validation-status-error\";\n  }\n  const statusBadgeClass = `validation-status-badge ${statusModifier}`;\n\n  const handleItemClick = (itemId) => {\n    if (onNavigateToGenerator) {\n      onNavigateToGenerator(itemId);\n    }\n  };\n\n  // Count total affected items\n  const totalAffectedItems = [...validationResults.errors, ...validationResults.warnings].reduce(\n    (sum, issue) => sum + issue.affectedItems.length,\n    0\n  );\n\n  return (\n    <div className=\"validation-container\">\n      <div className=\"validation-header\">\n        <div className=\"flex-between items-start\">\n          <div>\n            <h1 className=\"validation-title\">\n              Validation\n              <span className={statusBadgeClass}>\n                {(() => {\n                  if (overallStatus === \"clean\") return \"All Clear\";\n                  const issueWord = totalIssues === 1 ? \"Issue\" : \"Issues\";\n                  return `${totalIssues} ${issueWord}`;\n                })()}\n              </span>\n            </h1>\n            <p className=\"validation-subtitle\">\n              Semantic validation: reference integrity, pressure balance, and dead code detection.\n              Structure validation runs automatically as a gate before simulation.\n            </p>\n          </div>\n          {totalIssues > 0 && (\n            <div className=\"validation-export-row\">\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsJson(validationResults)}\n                title=\"Export validation report as JSON\"\n              >\n                Export JSON\n              </button>\n              <button\n                className=\"validation-export-button\"\n                onClick={() => exportAsCsv(validationResults)}\n                title=\"Export validation report as CSV\"\n              >\n                Export CSV\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"validation-summary-cards validation-summary-cards-4\">\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-danger\">\n            {validationResults.errors.length}\n          </div>\n          <div className=\"validation-summary-label\">Errors</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-warning\">\n            {validationResults.warnings.length}\n          </div>\n          <div className=\"validation-summary-label\">Warnings</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div\n            className={`validation-summary-value ${orphanCounts.total > 0 ? \"text-muted\" : \"text-info\"}`}\n          >\n            {orphanCounts.total}\n          </div>\n          <div className=\"validation-summary-label\">Unused</div>\n        </div>\n        <div className=\"validation-summary-card\">\n          <div className=\"validation-summary-value text-info\">\n            {totalAffectedItems}\n          </div>\n          <div className=\"validation-summary-label\">Affected Items</div>\n        </div>\n      </div>\n\n      {/* Clean state */}\n      {overallStatus === \"clean\" && (\n        <div className=\"validation-clean-state\">\n          <div className=\"validation-clean-icon\">\u2713</div>\n          <div className=\"validation-clean-title\">All Validations Passed</div>\n          <div className=\"validation-clean-message\">\n            Your configuration looks good. No issues detected.\n          </div>\n        </div>\n      )}\n\n      {/* Errors section */}\n      {validationResults.errors.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u274c</span>\n              Errors\n            </div>\n            <span className=\"validation-section-count validation-status-error\">\n              {validationResults.errors.length}\n            </span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.errors.map((error) => (\n              <IssueCard key={error.id} issue={error} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Warnings section */}\n      {validationResults.warnings.length > 0 && (\n        <div className=\"validation-section\">\n          <div className=\"validation-section-header\">\n            <div className=\"validation-section-title\">\n              <span>\u26a0\ufe0f</span>\n              Warnings\n            </div>\n            <span className=\"validation-section-count\">{validationResults.warnings.length}</span>\n          </div>\n          <div className=\"validation-issue-list\">\n            {validationResults.warnings.map((warning) => (\n              <IssueCard key={warning.id} issue={warning} onItemClick={handleItemClick} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Dependency Viewer */}\n      {usageMap && (\n        <div className=\"mb-2xl\">\n          <DependencyViewer usageMap={usageMap} />\n        </div>\n      )}\n\n      {/* Naming Profile Mappings */}\n      {hasNamingProfiles && (\n        <div className=\"mb-2xl\">\n          <NamingProfileMappingViewer generators={generators} schema={schema} />\n        </div>\n      )}\n\n      {/* Rule info */}\n      <div className=\"validation-rule-info\">\n        <div className=\"validation-rule-title\">\n          Active Validation Rules ({Object.keys(validationRules).length})\n        </div>\n        <ul className=\"validation-rule-list\">\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-danger\">\u25cf</span>\n            <strong>Reference Validation:</strong> Entity kinds (generators, pressures, systems),\n            relationship kinds (generators, pressures, systems), pressure IDs (generators, systems,\n            eras, actions), era\u2192generator/system references\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Balance Validation:</strong> Pressure sources/sinks (feedback, homeostasis,\n            generators, systems), orphan generators/systems (not in any era)\n          </li>\n          <li className=\"validation-rule-item\">\n            <span className=\"validation-rule-bullet text-warning\">\u25cf</span>\n            <strong>Configuration Quality:</strong> Subtypes, statuses, cultures, tags, numeric\n            ranges\n          </li>\n        </ul>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  schema = DEFAULT_SCHEMA,\n  eras = [],\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions: _actions = [],\n  usageMap = null,\n  onNavigateToGenerator,\n}", "type": "{ schema?: Readonly<{ entityKinds: any[]; relationshipKinds: any[]; cultures: any[]; tagRegistry: any[]; }>; eras?: any[]; pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; usageMap?: any; onNavigateToGenerator: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "p", "button", "div", "IssueCard", "DependencyViewer", "NamingProfileMappingViewer", "strong"], "hookCalls": [{"name": "useMemo", "count": 3}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/actions/ActionsEditor.jsx::ActionsEditor", "name": "ActionsEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/ActionsEditor.jsx", "sourceCode": "export default function ActionsEditor({\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"actions:selected\");\n  const {\n    selectedItem: selectedAction,\n    handleItemChange: handleActionChange,\n    handleToggle,\n    handleDelete,\n    handleAdd: handleAddAction,\n    handleSelect,\n    handleClose,\n  } = useEditorState(actions, onChange, { createItem: createAction, persistKey: selectionKey });\n\n  // Collect unique pressures across all actions\n  const uniquePressures = new Set();\n  actions.forEach((action) => {\n    (action.probability?.pressureModifiers || []).forEach((mod) => {\n      if (mod.pressure) uniquePressures.add(mod.pressure);\n    });\n  });\n\n  return (\n    <div className=\"actions-editor\">\n      <div className=\"actions-header\">\n        <h1 className=\"actions-title\">Actions</h1>\n        <p className=\"actions-subtitle\">\n          Actions define what agents can do during the simulation via the universal catalyst system.\n          Click an action to edit.\n        </p>\n        <div className=\"actions-stats\">\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Total Actions</span>\n            <span className=\"actions-stat-value\">{actions.length}</span>\n          </div>\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Pressures Referenced</span>\n            <span className=\"actions-stat-value\">{uniquePressures.size}</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"actions-grid\">\n        {actions.map((action, index) => (\n          <ActionListCard\n            key={action.id}\n            action={action}\n            onClick={() => handleSelect(index)}\n            onToggle={() => handleToggle(action)}\n            usageMap={usageMap}\n          />\n        ))}\n\n        <div className=\"actions-add-card\" onClick={() => handleAddAction()} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n          <span className=\"text-2xl\">+</span>\n          <span>Add Action</span>\n        </div>\n      </div>\n\n      {selectedAction && (\n        <ActionModal\n          action={selectedAction}\n          onChange={handleActionChange}\n          onClose={handleClose}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; actions?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["h1", "p", "span", "ActionListCard", "ActionModal"], "hookCalls": [{"name": "useEditorState", "count": 1}], "customHookCalls": ["useEditorState"], "imports": [{"source": "react", "specifiers": ["React"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../shared", "specifiers": ["useEditorState"], "category": "internal"}, {"source": "../../utils/persistence", "specifiers": ["buildStorageKey"], "category": "internal"}, {"source": "./cards", "specifiers": ["ActionListCard"], "category": "internal"}, {"source": "./modals", "specifiers": ["ActionModal"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/actions/index.js::ActionsEditor", "name": "ActionsEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/actions/index.js", "sourceCode": "export default function ActionsEditor({\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"actions:selected\");\n  const {\n    selectedItem: selectedAction,\n    handleItemChange: handleActionChange,\n    handleToggle,\n    handleDelete,\n    handleAdd: handleAddAction,\n    handleSelect,\n    handleClose,\n  } = useEditorState(actions, onChange, { createItem: createAction, persistKey: selectionKey });\n\n  // Collect unique pressures across all actions\n  const uniquePressures = new Set();\n  actions.forEach((action) => {\n    (action.probability?.pressureModifiers || []).forEach((mod) => {\n      if (mod.pressure) uniquePressures.add(mod.pressure);\n    });\n  });\n\n  return (\n    <div className=\"actions-editor\">\n      <div className=\"actions-header\">\n        <h1 className=\"actions-title\">Actions</h1>\n        <p className=\"actions-subtitle\">\n          Actions define what agents can do during the simulation via the universal catalyst system.\n          Click an action to edit.\n        </p>\n        <div className=\"actions-stats\">\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Total Actions</span>\n            <span className=\"actions-stat-value\">{actions.length}</span>\n          </div>\n          <div className=\"actions-stat\">\n            <span className=\"actions-stat-label\">Pressures Referenced</span>\n            <span className=\"actions-stat-value\">{uniquePressures.size}</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"actions-grid\">\n        {actions.map((action, index) => (\n          <ActionListCard\n            key={action.id}\n            action={action}\n            onClick={() => handleSelect(index)}\n            onToggle={() => handleToggle(action)}\n            usageMap={usageMap}\n          />\n        ))}\n\n        <div className=\"actions-add-card\" onClick={() => handleAddAction()} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n          <span className=\"text-2xl\">+</span>\n          <span>Add Action</span>\n        </div>\n      </div>\n\n      {selectedAction && (\n        <ActionModal\n          action={selectedAction}\n          onChange={handleActionChange}\n          onClose={handleClose}\n          onDelete={handleDelete}\n          schema={schema}\n          pressures={pressures}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  actions = [],\n  onChange,\n  schema,\n  pressures = [],\n  usageMap,\n}", "type": "{ projectId: any; actions?: any[]; onChange: any; schema: any; pressures?: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["h1", "p", "span", "ActionListCard", "ActionModal"], "hookCalls": [{"name": "useEditorState", "count": 1}], "customHookCalls": ["useEditorState"], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/causal-loop/CausalLoopEditor.jsx::CausalLoopEditor", "name": "CausalLoopEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/causal-loop/CausalLoopEditor.jsx", "sourceCode": "export default function CausalLoopEditor({\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}) {\n  const containerRef = useRef(null);\n  const graphRef = useRef(null);\n  const [dimensions, setDimensions] = useState({ width: 800, height: 600 });\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [showLegend, setShowLegend] = useState(true);\n  const [showDisabled, setShowDisabled] = useState(true);\n  const [hoverNode, setHoverNode] = useState(null);\n\n  // Resize observer\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const updateDimensions = () => {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDimensions({\n        width: rect.width || 800,\n        height: Math.max(500, window.innerHeight - rect.top - 100),\n      });\n    };\n\n    updateDimensions();\n    const observer = new ResizeObserver(updateDimensions);\n    observer.observe(containerRef.current);\n    window.addEventListener(\"resize\", updateDimensions);\n\n    return () => {\n      observer.disconnect();\n      window.removeEventListener(\"resize\", updateDimensions);\n    };\n  }, []);\n\n  // Extract graph data\n  const {\n    nodes: graphNodes,\n    links: graphLinks,\n    warnings,\n  } = useMemo(\n    () =>\n      extractCausalGraph(pressures, generators, systems, actions, schema, showDisabled, usageMap),\n    [pressures, generators, systems, actions, schema, showDisabled, usageMap]\n  );\n  const graphData = useMemo(\n    () => ({ nodes: graphNodes, links: graphLinks }),\n    [graphNodes, graphLinks]\n  );\n\n  // Count disabled nodes for UI\n  const disabledCount = useMemo(() => {\n    const allNodes = extractCausalGraph(\n      pressures,\n      generators,\n      systems,\n      actions,\n      schema,\n      true,\n      usageMap\n    ).nodes;\n    return allNodes.filter((n) => n.isDisabled).length;\n  }, [pressures, generators, systems, actions, schema, usageMap]);\n\n  // Detect loops\n  const loops = useMemo(() => detectLoops(graphData.nodes, graphData.links), [graphData]);\n\n  const reinforcingLoops = loops.filter((l) => l.type === \"reinforcing\");\n  const balancingLoops = loops.filter((l) => l.type === \"balancing\");\n\n  // Node styling\n  const nodeCanvasObject = useCallback(\n    (node, ctx, globalScale) => {\n      const label = node.label;\n      const fontSize = Math.max(10 / globalScale, 3);\n      const abbrevFontSize = Math.max(8 / globalScale, 3);\n      const nodeRadius = Math.sqrt(node.val) * 3;\n      const isDisabled = node.isDisabled;\n\n      // Draw node circle with opacity for disabled\n      ctx.beginPath();\n      ctx.arc(node.x, node.y, nodeRadius, 0, 2 * Math.PI);\n      ctx.fillStyle = isDisabled ? `${node.color}60` : node.color;\n      ctx.fill();\n\n      // Strikethrough pattern for disabled nodes\n      if (isDisabled) {\n        ctx.strokeStyle = \"#64748b\";\n        ctx.lineWidth = 1 / globalScale;\n        ctx.setLineDash([2 / globalScale, 2 / globalScale]);\n        ctx.stroke();\n        ctx.setLineDash([]);\n      }\n\n      // Highlight selected/hovered\n      if (selectedNode === node.id || hoverNode === node.id) {\n        ctx.strokeStyle = \"#ffffff\";\n        ctx.lineWidth = 2 / globalScale;\n        ctx.stroke();\n      }\n\n      // Draw abbreviation inside node\n      ctx.font = `bold ${abbrevFontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"middle\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#0a1929\";\n      ctx.fillText(node.abbrev || \"?\", node.x, node.y);\n\n      // Draw label below node\n      ctx.font = `${fontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"top\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#e2e8f0\";\n      const displayLabel = label.length > 15 ? label.slice(0, 13) + \"...\" : label;\n      ctx.fillText(displayLabel, node.x, node.y + nodeRadius + 2);\n    },\n    [selectedNode, hoverNode]\n  );\n\n  // Link styling\n  const linkColor = useCallback((link) => {\n    return EDGE_COLORS[link.polarity] || EDGE_COLORS.neutral;\n  }, []);\n\n  const linkWidth = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? 1 : 2;\n  }, []);\n\n  const linkLineDash = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? [4, 4] : [];\n  }, []);\n\n  // Handle node click\n  const handleNodeClick = useCallback(\n    (node) => {\n      setSelectedNode(selectedNode === node.id ? null : node.id);\n    },\n    [selectedNode]\n  );\n\n  // Zoom to fit on load\n  useEffect(() => {\n    if (graphRef.current && graphData.nodes.length > 0) {\n      setTimeout(() => {\n        graphRef.current.zoomToFit(400, 60);\n      }, 500);\n    }\n  }, [graphData.nodes.length]);\n\n  const selectedNodeData = selectedNode ? graphData.nodes.find((n) => n.id === selectedNode) : null;\n\n  // Get edges for selected node\n  const selectedNodeEdges = useMemo(() => {\n    if (!selectedNode) return { incoming: [], outgoing: [] };\n    return {\n      incoming: graphData.links.filter((l) => {\n        const targetId = typeof l.target === \"object\" ? l.target.id : l.target;\n        return targetId === selectedNode;\n      }),\n      outgoing: graphData.links.filter((l) => {\n        const sourceId = typeof l.source === \"object\" ? l.source.id : l.source;\n        return sourceId === selectedNode;\n      }),\n    };\n  }, [selectedNode, graphData.links]);\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Causal Loop Diagram</h1>\n        <p className=\"subtitle\">\n          Visualize feedback loops between pressures, generators, systems, and entity kinds.\n          {loops.length > 0 && (\n            <span className=\"cl-loop-count\">\n              <span className=\"cl-loop-reinforcing\">{reinforcingLoops.length} reinforcing</span>\n              {\" / \"}\n              <span className=\"cl-loop-balancing\">{balancingLoops.length} balancing</span>\n              {\" loops detected\"}\n            </span>\n          )}\n        </p>\n      </div>\n\n      <div className=\"cl-toolbar\">\n        <button className=\"button-secondary\" onClick={() => setShowLegend(!showLegend)}>\n          {showLegend ? \"Hide\" : \"Show\"} Legend\n        </button>\n        {disabledCount > 0 && (\n          <button\n            className=\"button-secondary\"\n            onClick={() => setShowDisabled(!showDisabled)}\n            // eslint-disable-next-line local/no-inline-styles -- dynamic opacity toggle\n            style={{ opacity: showDisabled ? 1 : 0.7 }}\n          >\n            {showDisabled ? \"Hide\" : \"Show\"} Disabled ({disabledCount})\n          </button>\n        )}\n        <button className=\"button-secondary\" onClick={() => graphRef.current?.zoomToFit(400, 60)}>\n          Fit to View\n        </button>\n        <div className=\"cl-stats\">\n          <span>{graphData.nodes.length} nodes</span>\n          <span>{graphData.links.length} edges</span>\n          {warnings.length > 0 && (\n            <span className=\"cl-stats-warning\">{warnings.length} warnings</span>\n          )}\n          <span className=\"cl-stats-hint\">Scroll to zoom, drag to pan</span>\n        </div>\n      </div>\n\n      {/* Warnings */}\n      {warnings.length > 0 && (\n        <div className=\"cl-warnings-box\">\n          <div className=\"cl-warnings-title\">\n            Referential Integrity Warnings\n          </div>\n          <div className=\"cl-warnings-list\">\n            {warnings.slice(0, 5).map((w, i) => (\n              <div key={i}>{w.message}</div>\n            ))}\n            {warnings.length > 5 && (\n              <div className=\"cl-warnings-more\">\n                ...and {warnings.length - 5} more warnings\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Legend */}\n      {showLegend && (\n        <div className=\"cl-legend\">\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Nodes:</span>\n            {Object.entries(NODE_TYPES).map(([type, config]) => (\n              <span key={type} className=\"cl-legend-item\">\n                <span\n                  className=\"cl-legend-node\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per node type\n                  style={{ '--cl-node-color': config.color, backgroundColor: 'var(--cl-node-color)' }}\n                >\n                  {config.abbrev}\n                </span>\n                <span className=\"cl-legend-node-label\">{config.label}</span>\n              </span>\n            ))}\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Edges:</span>\n            <span className=\"cl-legend-item cl-edge-positive\">+ Positive</span>\n            <span className=\"cl-legend-item cl-edge-negative\">- Negative</span>\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Loops:</span>\n            <span className=\"cl-legend-item cl-loop-reinforcing\">Reinforcing (unstable)</span>\n            <span className=\"cl-legend-item cl-loop-balancing\">Balancing (stable)</span>\n          </div>\n        </div>\n      )}\n\n      {/* Graph container */}\n      <div ref={containerRef} className=\"cl-graph-container\">\n        {graphData.nodes.length === 0 ? (\n          <div className=\"cl-empty-state\">\n            <div className=\"cl-empty-icon\">&#128260;</div>\n            <div className=\"cl-empty-title\">\n              No causal relationships found\n            </div>\n            <div className=\"cl-empty-desc\">\n              Add pressures with feedback factors, generators with state updates, or systems with\n              pressure changes to see the causal loop diagram.\n            </div>\n          </div>\n        ) : (\n          <ForceGraph2D\n            ref={graphRef}\n            graphData={graphData}\n            width={dimensions.width}\n            height={dimensions.height}\n            backgroundColor=\"#0f172a\"\n            nodeCanvasObject={nodeCanvasObject}\n            nodePointerAreaPaint={(node, color, ctx) => {\n              const nodeRadius = Math.sqrt(node.val) * 3;\n              ctx.beginPath();\n              ctx.arc(node.x, node.y, nodeRadius + 5, 0, 2 * Math.PI);\n              ctx.fillStyle = color;\n              ctx.fill();\n            }}\n            linkColor={linkColor}\n            linkWidth={linkWidth}\n            linkLineDash={linkLineDash}\n            linkDirectionalArrowLength={6}\n            linkDirectionalArrowRelPos={0.9}\n            linkCurvature={0.2}\n            onNodeClick={handleNodeClick}\n            onNodeHover={(node) => setHoverNode(node?.id || null)}\n// ... (truncated)", "parameters": [{"name": "{\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}", "type": "{ pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; schema?: {}; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["h1", "span", "button", "div", "ForceGraph2D", "h3"], "hookCalls": [{"name": "useRef", "count": 2}, {"name": "useState", "count": 5}, {"name": "useEffect", "count": 2}, {"name": "useMemo", "count": 5}, {"name": "useCallback", "count": 5}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useMemo", "useState", "useRef", "useCallback", "useEffect"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "react-force-graph-2d", "specifiers": ["ForceGraph2D"], "category": "external"}, {"source": "./CausalLoopEditor.css", "specifiers": [], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/causal-loop/index.js::CausalLoopEditor", "name": "CausalLoopEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/causal-loop/index.js", "sourceCode": "export default function CausalLoopEditor({\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}) {\n  const containerRef = useRef(null);\n  const graphRef = useRef(null);\n  const [dimensions, setDimensions] = useState({ width: 800, height: 600 });\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [showLegend, setShowLegend] = useState(true);\n  const [showDisabled, setShowDisabled] = useState(true);\n  const [hoverNode, setHoverNode] = useState(null);\n\n  // Resize observer\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const updateDimensions = () => {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDimensions({\n        width: rect.width || 800,\n        height: Math.max(500, window.innerHeight - rect.top - 100),\n      });\n    };\n\n    updateDimensions();\n    const observer = new ResizeObserver(updateDimensions);\n    observer.observe(containerRef.current);\n    window.addEventListener(\"resize\", updateDimensions);\n\n    return () => {\n      observer.disconnect();\n      window.removeEventListener(\"resize\", updateDimensions);\n    };\n  }, []);\n\n  // Extract graph data\n  const {\n    nodes: graphNodes,\n    links: graphLinks,\n    warnings,\n  } = useMemo(\n    () =>\n      extractCausalGraph(pressures, generators, systems, actions, schema, showDisabled, usageMap),\n    [pressures, generators, systems, actions, schema, showDisabled, usageMap]\n  );\n  const graphData = useMemo(\n    () => ({ nodes: graphNodes, links: graphLinks }),\n    [graphNodes, graphLinks]\n  );\n\n  // Count disabled nodes for UI\n  const disabledCount = useMemo(() => {\n    const allNodes = extractCausalGraph(\n      pressures,\n      generators,\n      systems,\n      actions,\n      schema,\n      true,\n      usageMap\n    ).nodes;\n    return allNodes.filter((n) => n.isDisabled).length;\n  }, [pressures, generators, systems, actions, schema, usageMap]);\n\n  // Detect loops\n  const loops = useMemo(() => detectLoops(graphData.nodes, graphData.links), [graphData]);\n\n  const reinforcingLoops = loops.filter((l) => l.type === \"reinforcing\");\n  const balancingLoops = loops.filter((l) => l.type === \"balancing\");\n\n  // Node styling\n  const nodeCanvasObject = useCallback(\n    (node, ctx, globalScale) => {\n      const label = node.label;\n      const fontSize = Math.max(10 / globalScale, 3);\n      const abbrevFontSize = Math.max(8 / globalScale, 3);\n      const nodeRadius = Math.sqrt(node.val) * 3;\n      const isDisabled = node.isDisabled;\n\n      // Draw node circle with opacity for disabled\n      ctx.beginPath();\n      ctx.arc(node.x, node.y, nodeRadius, 0, 2 * Math.PI);\n      ctx.fillStyle = isDisabled ? `${node.color}60` : node.color;\n      ctx.fill();\n\n      // Strikethrough pattern for disabled nodes\n      if (isDisabled) {\n        ctx.strokeStyle = \"#64748b\";\n        ctx.lineWidth = 1 / globalScale;\n        ctx.setLineDash([2 / globalScale, 2 / globalScale]);\n        ctx.stroke();\n        ctx.setLineDash([]);\n      }\n\n      // Highlight selected/hovered\n      if (selectedNode === node.id || hoverNode === node.id) {\n        ctx.strokeStyle = \"#ffffff\";\n        ctx.lineWidth = 2 / globalScale;\n        ctx.stroke();\n      }\n\n      // Draw abbreviation inside node\n      ctx.font = `bold ${abbrevFontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"middle\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#0a1929\";\n      ctx.fillText(node.abbrev || \"?\", node.x, node.y);\n\n      // Draw label below node\n      ctx.font = `${fontSize}px Sans-Serif`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"top\";\n      ctx.fillStyle = isDisabled ? \"#64748b\" : \"#e2e8f0\";\n      const displayLabel = label.length > 15 ? label.slice(0, 13) + \"...\" : label;\n      ctx.fillText(displayLabel, node.x, node.y + nodeRadius + 2);\n    },\n    [selectedNode, hoverNode]\n  );\n\n  // Link styling\n  const linkColor = useCallback((link) => {\n    return EDGE_COLORS[link.polarity] || EDGE_COLORS.neutral;\n  }, []);\n\n  const linkWidth = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? 1 : 2;\n  }, []);\n\n  const linkLineDash = useCallback((link) => {\n    return link.edgeType === \"feedback\" ? [4, 4] : [];\n  }, []);\n\n  // Handle node click\n  const handleNodeClick = useCallback(\n    (node) => {\n      setSelectedNode(selectedNode === node.id ? null : node.id);\n    },\n    [selectedNode]\n  );\n\n  // Zoom to fit on load\n  useEffect(() => {\n    if (graphRef.current && graphData.nodes.length > 0) {\n      setTimeout(() => {\n        graphRef.current.zoomToFit(400, 60);\n      }, 500);\n    }\n  }, [graphData.nodes.length]);\n\n  const selectedNodeData = selectedNode ? graphData.nodes.find((n) => n.id === selectedNode) : null;\n\n  // Get edges for selected node\n  const selectedNodeEdges = useMemo(() => {\n    if (!selectedNode) return { incoming: [], outgoing: [] };\n    return {\n      incoming: graphData.links.filter((l) => {\n        const targetId = typeof l.target === \"object\" ? l.target.id : l.target;\n        return targetId === selectedNode;\n      }),\n      outgoing: graphData.links.filter((l) => {\n        const sourceId = typeof l.source === \"object\" ? l.source.id : l.source;\n        return sourceId === selectedNode;\n      }),\n    };\n  }, [selectedNode, graphData.links]);\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Causal Loop Diagram</h1>\n        <p className=\"subtitle\">\n          Visualize feedback loops between pressures, generators, systems, and entity kinds.\n          {loops.length > 0 && (\n            <span className=\"cl-loop-count\">\n              <span className=\"cl-loop-reinforcing\">{reinforcingLoops.length} reinforcing</span>\n              {\" / \"}\n              <span className=\"cl-loop-balancing\">{balancingLoops.length} balancing</span>\n              {\" loops detected\"}\n            </span>\n          )}\n        </p>\n      </div>\n\n      <div className=\"cl-toolbar\">\n        <button className=\"button-secondary\" onClick={() => setShowLegend(!showLegend)}>\n          {showLegend ? \"Hide\" : \"Show\"} Legend\n        </button>\n        {disabledCount > 0 && (\n          <button\n            className=\"button-secondary\"\n            onClick={() => setShowDisabled(!showDisabled)}\n            // eslint-disable-next-line local/no-inline-styles -- dynamic opacity toggle\n            style={{ opacity: showDisabled ? 1 : 0.7 }}\n          >\n            {showDisabled ? \"Hide\" : \"Show\"} Disabled ({disabledCount})\n          </button>\n        )}\n        <button className=\"button-secondary\" onClick={() => graphRef.current?.zoomToFit(400, 60)}>\n          Fit to View\n        </button>\n        <div className=\"cl-stats\">\n          <span>{graphData.nodes.length} nodes</span>\n          <span>{graphData.links.length} edges</span>\n          {warnings.length > 0 && (\n            <span className=\"cl-stats-warning\">{warnings.length} warnings</span>\n          )}\n          <span className=\"cl-stats-hint\">Scroll to zoom, drag to pan</span>\n        </div>\n      </div>\n\n      {/* Warnings */}\n      {warnings.length > 0 && (\n        <div className=\"cl-warnings-box\">\n          <div className=\"cl-warnings-title\">\n            Referential Integrity Warnings\n          </div>\n          <div className=\"cl-warnings-list\">\n            {warnings.slice(0, 5).map((w, i) => (\n              <div key={i}>{w.message}</div>\n            ))}\n            {warnings.length > 5 && (\n              <div className=\"cl-warnings-more\">\n                ...and {warnings.length - 5} more warnings\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Legend */}\n      {showLegend && (\n        <div className=\"cl-legend\">\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Nodes:</span>\n            {Object.entries(NODE_TYPES).map(([type, config]) => (\n              <span key={type} className=\"cl-legend-item\">\n                <span\n                  className=\"cl-legend-node\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per node type\n                  style={{ '--cl-node-color': config.color, backgroundColor: 'var(--cl-node-color)' }}\n                >\n                  {config.abbrev}\n                </span>\n                <span className=\"cl-legend-node-label\">{config.label}</span>\n              </span>\n            ))}\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Edges:</span>\n            <span className=\"cl-legend-item cl-edge-positive\">+ Positive</span>\n            <span className=\"cl-legend-item cl-edge-negative\">- Negative</span>\n          </div>\n          <div className=\"cl-legend-group\">\n            <span className=\"cl-legend-label\">Loops:</span>\n            <span className=\"cl-legend-item cl-loop-reinforcing\">Reinforcing (unstable)</span>\n            <span className=\"cl-legend-item cl-loop-balancing\">Balancing (stable)</span>\n          </div>\n        </div>\n      )}\n\n      {/* Graph container */}\n      <div ref={containerRef} className=\"cl-graph-container\">\n        {graphData.nodes.length === 0 ? (\n          <div className=\"cl-empty-state\">\n            <div className=\"cl-empty-icon\">&#128260;</div>\n            <div className=\"cl-empty-title\">\n              No causal relationships found\n            </div>\n            <div className=\"cl-empty-desc\">\n              Add pressures with feedback factors, generators with state updates, or systems with\n              pressure changes to see the causal loop diagram.\n            </div>\n          </div>\n        ) : (\n          <ForceGraph2D\n            ref={graphRef}\n            graphData={graphData}\n            width={dimensions.width}\n            height={dimensions.height}\n            backgroundColor=\"#0f172a\"\n            nodeCanvasObject={nodeCanvasObject}\n            nodePointerAreaPaint={(node, color, ctx) => {\n              const nodeRadius = Math.sqrt(node.val) * 3;\n              ctx.beginPath();\n              ctx.arc(node.x, node.y, nodeRadius + 5, 0, 2 * Math.PI);\n              ctx.fillStyle = color;\n              ctx.fill();\n            }}\n            linkColor={linkColor}\n            linkWidth={linkWidth}\n            linkLineDash={linkLineDash}\n            linkDirectionalArrowLength={6}\n            linkDirectionalArrowRelPos={0.9}\n            linkCurvature={0.2}\n            onNodeClick={handleNodeClick}\n            onNodeHover={(node) => setHoverNode(node?.id || null)}\n// ... (truncated)", "parameters": [{"name": "{\n  pressures = [],\n  generators = [],\n  systems = [],\n  actions = [],\n  schema = {},\n  usageMap,\n}", "type": "{ pressures?: any[]; generators?: any[]; systems?: any[]; actions?: any[]; schema?: {}; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["h1", "span", "button", "div", "ForceGraph2D", "h3"], "hookCalls": [{"name": "useRef", "count": 2}, {"name": "useState", "count": 5}, {"name": "useEffect", "count": 2}, {"name": "useMemo", "count": 5}, {"name": "useCallback", "count": 5}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/DependencyViewer.jsx::DependencyViewer", "name": "DependencyViewer", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/DependencyViewer.jsx", "sourceCode": "export default function DependencyViewer({ usageMap }) {\n  // Prepare entity kinds data\n  const entityKindsData = useMemo(() => {\n    if (!usageMap?.entityKinds) return [];\n    return Object.entries(usageMap.entityKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare relationship kinds data\n  const relationshipKindsData = useMemo(() => {\n    if (!usageMap?.relationshipKinds) return [];\n    return Object.entries(usageMap.relationshipKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare pressures data\n  const pressuresData = useMemo(() => {\n    if (!usageMap?.pressures) return [];\n    return Object.entries(usageMap.pressures)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare generators data\n  const generatorsData = useMemo(() => {\n    if (!usageMap?.generators) return [];\n    return Object.entries(usageMap.generators)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare systems data\n  const systemsData = useMemo(() => {\n    if (!usageMap?.systems) return [];\n    return Object.entries(usageMap.systems)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare tags data\n  const tagsData = useMemo(() => {\n    if (!usageMap?.tags) return [];\n    return Object.entries(usageMap.tags)\n      .map(([tag, usage]) => ({\n        id: tag,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  if (!usageMap) {\n    return (\n      <div className=\"dependency-viewer-container\">\n        <div className=\"dependency-empty-state\">Loading dependency data...</div>\n      </div>\n    );\n  }\n\n  const renderSchemaItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      <UsageBadges usage={item.usage} />\n    </div>\n  );\n\n  const renderEraItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      {item.eraCount > 0 ? (\n        <div className=\"dependency-used-by-list\">\n          <span className=\"dependency-badge dependency-badge-era\">\n            {item.eraCount} era{item.eraCount !== 1 ? \"s\" : \"\"}\n          </span>\n        </div>\n      ) : (\n        <span className=\"dependency-orphan-badge\">Not in any era</span>\n      )}\n    </div>\n  );\n\n  return (\n    <div className=\"dependency-viewer-container\">\n      <div className=\"dependency-viewer-header\">\n        <div className=\"dependency-viewer-title\">\n          <span>\ud83d\udd17</span>\n          <span>Dependencies</span>\n        </div>\n        <div className=\"dependency-viewer-legend\">\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-generators\" />\n            <span>Generators</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-systems\" />\n            <span>Systems</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-actions\" />\n            <span>Actions</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-eras\" />\n            <span>Eras</span>\n          </div>\n        </div>\n      </div>\n\n      <DependencySection\n        title=\"Entity Kinds\"\n        icon=\"\ud83d\udce6\"\n        items={entityKindsData}\n        renderItem={renderSchemaItem}\n        defaultExpanded={true}\n      />\n\n      <DependencySection\n        title=\"Relationship Kinds\"\n        icon=\"\ud83d\udd17\"\n        items={relationshipKindsData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection title=\"Tags\" icon=\"\ud83c\udff7\ufe0f\" items={tagsData} renderItem={renderSchemaItem} />\n\n      <DependencySection\n        title=\"Pressures\"\n        icon=\"\ud83d\udcca\"\n        items={pressuresData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection\n        title=\"Generators \u2192 Eras\"\n        icon=\"\u2728\"\n        items={generatorsData}\n        renderItem={renderEraItem}\n      />\n\n      <DependencySection\n        title=\"Systems \u2192 Eras\"\n        icon=\"\u2699\ufe0f\"\n        items={systemsData}\n        renderItem={renderEraItem}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{ usageMap }", "type": "{ usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div"], "hookCalls": [{"name": "useMemo", "count": 6}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./dependency-viewer.css", "specifiers": [], "category": "internal"}, {"source": "./components", "specifiers": ["DependencySection", "UsageBadges"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/dependency-viewer/index.js::DependencyViewer", "name": "DependencyViewer", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/dependency-viewer/index.js", "sourceCode": "export default function DependencyViewer({ usageMap }) {\n  // Prepare entity kinds data\n  const entityKindsData = useMemo(() => {\n    if (!usageMap?.entityKinds) return [];\n    return Object.entries(usageMap.entityKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare relationship kinds data\n  const relationshipKindsData = useMemo(() => {\n    if (!usageMap?.relationshipKinds) return [];\n    return Object.entries(usageMap.relationshipKinds)\n      .map(([kind, usage]) => ({\n        id: kind,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare pressures data\n  const pressuresData = useMemo(() => {\n    if (!usageMap?.pressures) return [];\n    return Object.entries(usageMap.pressures)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  // Prepare generators data\n  const generatorsData = useMemo(() => {\n    if (!usageMap?.generators) return [];\n    return Object.entries(usageMap.generators)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare systems data\n  const systemsData = useMemo(() => {\n    if (!usageMap?.systems) return [];\n    return Object.entries(usageMap.systems)\n      .map(([id, usage]) => ({\n        id,\n        usage,\n        eraCount: usage.eras?.length || 0,\n      }))\n      .sort((a, b) => b.eraCount - a.eraCount);\n  }, [usageMap]);\n\n  // Prepare tags data\n  const tagsData = useMemo(() => {\n    if (!usageMap?.tags) return [];\n    return Object.entries(usageMap.tags)\n      .map(([tag, usage]) => ({\n        id: tag,\n        usage,\n        totalUsage:\n          (usage.generators?.length || 0) +\n          (usage.systems?.length || 0) +\n          (usage.actions?.length || 0) +\n          (usage.pressures?.length || 0),\n      }))\n      .sort((a, b) => b.totalUsage - a.totalUsage);\n  }, [usageMap]);\n\n  if (!usageMap) {\n    return (\n      <div className=\"dependency-viewer-container\">\n        <div className=\"dependency-empty-state\">Loading dependency data...</div>\n      </div>\n    );\n  }\n\n  const renderSchemaItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      <UsageBadges usage={item.usage} />\n    </div>\n  );\n\n  const renderEraItem = (item) => (\n    <div key={item.id} className=\"dependency-item-row\">\n      <span className=\"dependency-item-name\">{item.id}</span>\n      {item.eraCount > 0 ? (\n        <div className=\"dependency-used-by-list\">\n          <span className=\"dependency-badge dependency-badge-era\">\n            {item.eraCount} era{item.eraCount !== 1 ? \"s\" : \"\"}\n          </span>\n        </div>\n      ) : (\n        <span className=\"dependency-orphan-badge\">Not in any era</span>\n      )}\n    </div>\n  );\n\n  return (\n    <div className=\"dependency-viewer-container\">\n      <div className=\"dependency-viewer-header\">\n        <div className=\"dependency-viewer-title\">\n          <span>\ud83d\udd17</span>\n          <span>Dependencies</span>\n        </div>\n        <div className=\"dependency-viewer-legend\">\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-generators\" />\n            <span>Generators</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-systems\" />\n            <span>Systems</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-actions\" />\n            <span>Actions</span>\n          </div>\n          <div className=\"dependency-legend-item\">\n            <div className=\"dependency-legend-dot dependency-legend-dot-eras\" />\n            <span>Eras</span>\n          </div>\n        </div>\n      </div>\n\n      <DependencySection\n        title=\"Entity Kinds\"\n        icon=\"\ud83d\udce6\"\n        items={entityKindsData}\n        renderItem={renderSchemaItem}\n        defaultExpanded={true}\n      />\n\n      <DependencySection\n        title=\"Relationship Kinds\"\n        icon=\"\ud83d\udd17\"\n        items={relationshipKindsData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection title=\"Tags\" icon=\"\ud83c\udff7\ufe0f\" items={tagsData} renderItem={renderSchemaItem} />\n\n      <DependencySection\n        title=\"Pressures\"\n        icon=\"\ud83d\udcca\"\n        items={pressuresData}\n        renderItem={renderSchemaItem}\n      />\n\n      <DependencySection\n        title=\"Generators \u2192 Eras\"\n        icon=\"\u2728\"\n        items={generatorsData}\n        renderItem={renderEraItem}\n      />\n\n      <DependencySection\n        title=\"Systems \u2192 Eras\"\n        icon=\"\u2699\ufe0f\"\n        items={systemsData}\n        renderItem={renderEraItem}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{ usageMap }", "type": "{ usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div"], "hookCalls": [{"name": "useMemo", "count": 6}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/eras/EraCard.jsx::EraCard", "name": "EraCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/EraCard.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.era - The era object\n * @param {boolean} props.expanded - Whether the card is expanded\n * @param {Function} props.onToggle - Called to toggle expansion\n * @param {Function} props.onChange - Called when era changes\n * @param {Function} props.onDelete - Called to delete the era\n * @param {Array} props.pressures - Available pressures\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.allEras - All eras for nextEra selection\n */\nexport function EraCard({\n  era,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  pressures,\n  schema,\n  allEras,\n}) {\n  const [, setHovering] = useState(false);\n\n  // Field change handler\n  const handleFieldChange = useCallback(\n    (field, value) => {\n      onChange({ ...era, [field]: value });\n    },\n    [era, onChange]\n  );\n\n  // Entry condition handlers\n  const handleAddEntryCondition = useCallback(() => {\n    const newRule = createNewRule(\"pressure\", pressures);\n    onChange({\n      ...era,\n      entryConditions: [...(era.entryConditions || []), newRule],\n    });\n  }, [era, onChange, pressures]);\n\n  const handleUpdateEntryCondition = useCallback(\n    (index, updated) => {\n      const newConditions = [...(era.entryConditions || [])];\n      newConditions[index] = updated;\n      onChange({ ...era, entryConditions: newConditions });\n    },\n    [era, onChange]\n  );\n\n  const handleRemoveEntryCondition = useCallback(\n    (index) => {\n      onChange({\n        ...era,\n        entryConditions: (era.entryConditions || []).filter((_, i) => i !== index),\n      });\n    },\n    [era, onChange]\n  );\n\n  // Exit condition handlers\n  const handleAddExitCondition = useCallback(() => {\n    const newRule = createNewRule(\"growth_phases_complete\", pressures);\n    onChange({\n      ...era,\n      exitConditions: [...(era.exitConditions || []), newRule],\n    });\n  }, [era, onChange, pressures]);\n\n  const handleUpdateExitCondition = useCallback(\n    (index, updated) => {\n      const newConditions = [...(era.exitConditions || [])];\n      newConditions[index] = updated;\n      onChange({ ...era, exitConditions: newConditions });\n    },\n    [era, onChange]\n  );\n\n  const handleRemoveExitCondition = useCallback(\n    (index) => {\n      onChange({\n        ...era,\n        exitConditions: (era.exitConditions || []).filter((_, i) => i !== index),\n      });\n    },\n    [era, onChange]\n  );\n\n  const updateEffectMutations = useCallback(\n    (key, nextMutations) => {\n      onChange({\n        ...era,\n        [key]: { ...(era[key] || {}), mutations: nextMutations },\n      });\n    },\n    [era, onChange]\n  );\n\n  // Entry effect handlers\n  const handleAddEntryEffect = useCallback(\n    (pressureId) => {\n      const existing = era.entryEffects?.mutations || [];\n      const hasExisting = existing.some(\n        (m) => m.type === \"modify_pressure\" && m.pressureId === pressureId\n      );\n      if (hasExisting) return;\n      updateEffectMutations(\"entryEffects\", [\n        ...existing,\n        { type: \"modify_pressure\", pressureId, delta: 10 },\n      ]);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleUpdateEntryEffect = useCallback(\n    (pressureId, value) => {\n      const existing = era.entryEffects?.mutations || [];\n      const next = existing.map((mutation) =>\n        mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId\n          ? { ...mutation, delta: value }\n          : mutation\n      );\n      updateEffectMutations(\"entryEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleRemoveEntryEffect = useCallback(\n    (pressureId) => {\n      const existing = era.entryEffects?.mutations || [];\n      const next = existing.filter(\n        (mutation) => !(mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId)\n      );\n      updateEffectMutations(\"entryEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  // Exit effect handlers\n  const handleAddExitEffect = useCallback(\n    (pressureId) => {\n      const existing = era.exitEffects?.mutations || [];\n      const hasExisting = existing.some(\n        (m) => m.type === \"modify_pressure\" && m.pressureId === pressureId\n      );\n      if (hasExisting) return;\n      updateEffectMutations(\"exitEffects\", [\n        ...existing,\n        { type: \"modify_pressure\", pressureId, delta: 10 },\n      ]);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleUpdateExitEffect = useCallback(\n    (pressureId, value) => {\n      const existing = era.exitEffects?.mutations || [];\n      const next = existing.map((mutation) =>\n        mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId\n          ? { ...mutation, delta: value }\n          : mutation\n      );\n      updateEffectMutations(\"exitEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleRemoveExitEffect = useCallback(\n    (pressureId) => {\n      const existing = era.exitEffects?.mutations || [];\n      const next = existing.filter(\n        (mutation) => !(mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId)\n      );\n      updateEffectMutations(\"exitEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const entryMutations = useMemo(\n    () => (era.entryEffects?.mutations || []).filter((m) => m.type === \"modify_pressure\"),\n    [era.entryEffects]\n  );\n  const exitMutations = useMemo(\n    () => (era.exitEffects?.mutations || []).filter((m) => m.type === \"modify_pressure\"),\n    [era.exitEffects]\n  );\n\n  const availablePressuresForEntry = useMemo(() => {\n    const currentIds = new Set(entryMutations.map((mutation) => mutation.pressureId));\n    return (pressures || [])\n      .filter((p) => !currentIds.has(p.id))\n      .map((p) => ({ id: p.id, name: p.name || p.id }));\n  }, [pressures, entryMutations]);\n\n  const availablePressuresForExit = useMemo(() => {\n    const currentIds = new Set(exitMutations.map((mutation) => mutation.pressureId));\n    return (pressures || [])\n      .filter((p) => !currentIds.has(p.id))\n      .map((p) => ({ id: p.id, name: p.name || p.id }));\n  }, [pressures, exitMutations]);\n\n  // Counts\n  const entryConditions = era.entryConditions || [];\n  const exitConditions = era.exitConditions || [];\n  const entryPressureChanges = entryMutations.map((mutation) => [\n    mutation.pressureId,\n    mutation.delta,\n  ]);\n  const exitPressureChanges = exitMutations.map((mutation) => [\n    mutation.pressureId,\n    mutation.delta,\n  ]);\n\n  return (\n    <div className=\"expandable-card\">\n      {/* Header */}\n      <div\n        className=\"expandable-card-header\"\n        onClick={onToggle}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onToggle(e); }}\n      >\n        <div className=\"expandable-card-left\">\n          <div className=\"expandable-card-title\">\n            <span className=\"expandable-card-name\">{era.name}</span>\n            <span className=\"expandable-card-id\">{era.id}</span>\n          </div>\n          <div className=\"expandable-card-desc\">{era.summary}</div>\n        </div>\n        <div className=\"expandable-card-stats\">\n          <div className=\"stat\">\n            <span className=\"stat-label\">Entry</span>\n            <span className=\"stat-value\">{entryConditions.length}</span>\n          </div>\n          <div className=\"stat\">\n            <span className=\"stat-label\">Exit</span>\n            <span className=\"stat-value\">{exitConditions.length}</span>\n          </div>\n          <span className={`expand-icon ${expanded ? \"open\" : \"\"}`}>\u25bc</span>\n        </div>\n      </div>\n\n      {/* Expanded Content */}\n      {expanded && (\n        <div className=\"expandable-card-content\">\n          <BasicInfoSection era={era} onFieldChange={handleFieldChange} />\n\n          {/* Two-column transitions grid: Entry (left) | Exit (right) */}\n          <TransitionsGrid\n            entryConditions={entryConditions}\n            exitConditions={exitConditions}\n            entryPressureChanges={entryPressureChanges}\n            exitPressureChanges={exitPressureChanges}\n            onUpdateEntryCondition={handleUpdateEntryCondition}\n            onRemoveEntryCondition={handleRemoveEntryCondition}\n            onAddEntryCondition={handleAddEntryCondition}\n            onUpdateExitCondition={handleUpdateExitCondition}\n            onRemoveExitCondition={handleRemoveExitCondition}\n            onAddExitCondition={handleAddExitCondition}\n            onUpdateEntryEffect={handleUpdateEntryEffect}\n            onRemoveEntryEffect={handleRemoveEntryEffect}\n            onAddEntryEffect={handleAddEntryEffect}\n            onUpdateExitEffect={handleUpdateExitEffect}\n            onRemoveExitEffect={handleRemoveExitEffect}\n            onAddExitEffect={handleAddExitEffect}\n            availablePressuresForEntry={availablePressuresForEntry}\n            availablePressuresForExit={availablePressuresForExit}\n            pressures={pressures}\n            schema={schema}\n            eras={allEras}\n          />\n\n          {/* Delete button */}\n          <div className=\"card-footer\">\n            <button className=\"btn btn-danger\" onClick={onDelete}>\n              Delete Era\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  era,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  pressures,\n  schema,\n  allEras,\n}", "type": "{ era: any; expanded: boolean; onToggle: Function; onChange: Function; onDelete: Function; pressures: any[]; schema: any; allEras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "div", "BasicInfoSection", "TransitionsGrid", "button"], "hookCalls": [{"name": "useState", "count": 1}, {"name": "useCallback", "count": 14}, {"name": "useMemo", "count": 4}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useState", "useCallback", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../generators/applicability/createNewRule", "specifiers": ["createNewRule"], "category": "internal"}, {"source": "./sections", "specifiers": ["BasicInfoSection", "TransitionsGrid"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/eras/index.js::ErasEditor", "name": "ErasEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.eras - Array of era objects\n * @param {Function} props.onChange - Called when eras change\n * @param {Array} props.pressures - Available pressures\n * @param {Object} props.schema - Domain schema\n */\nexport default function ErasEditor({ eras = [], onChange, pressures = [], schema }) {\n  const [expandedEra, setExpandedEra] = useState(null);\n\n  const handleEraChange = useCallback(\n    (index, updatedEra) => {\n      const newEras = [...eras];\n      newEras[index] = updatedEra;\n      onChange(newEras);\n    },\n    [eras, onChange]\n  );\n\n  const handleDeleteEra = useCallback(\n    (index) => {\n      if (confirm(`Delete era \"${eras[index].name}\"?`)) {\n        const newEras = eras.filter((_, i) => i !== index);\n        onChange(newEras);\n        if (expandedEra === index) {\n          setExpandedEra(null);\n        }\n      }\n    },\n    [eras, onChange, expandedEra]\n  );\n\n  const handleAddEra = useCallback(() => {\n    const newEra = {\n      id: `era_${Date.now()}`,\n      name: \"New Era\",\n      description: \"A new period in world history\",\n      templateWeights: {},\n      systemModifiers: {},\n      entryConditions: [],\n      entryEffects: { mutations: [] },\n      exitConditions: [{ type: \"growth_phases_complete\", minPhases: 2 }],\n      exitEffects: { mutations: [] },\n    };\n    onChange([...eras, newEra]);\n    setExpandedEra(eras.length);\n  }, [eras, onChange]);\n\n  if (eras.length === 0) {\n    return (\n      <div className=\"editor-container\">\n        <div className=\"header\">\n          <h1 className=\"title\">Eras</h1>\n          <p className=\"subtitle\">Define historical eras that structure world generation</p>\n        </div>\n        <div className=\"empty-state\">\n          <div className=\"empty-state-icon\">\ud83d\udd70\ufe0f</div>\n          <div className=\"empty-state-title\">No eras defined</div>\n          <div className=\"empty-state-desc\">\n            Eras control which generators and systems are active during different phases of world\n            history.\n          </div>\n          <button\n            className=\"btn btn-primary ee-create-btn\"\n            onClick={handleAddEra}\n          >\n            + Create First Era\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Eras</h1>\n        <p className=\"subtitle\">\n          Define historical eras that structure world generation. Each era controls which generators\n          and systems are active and at what strength.\n        </p>\n      </div>\n\n      <div className=\"list-stack\">\n        {eras.map((era, index) => (\n          <EraCard\n            key={era.id}\n            era={era}\n            expanded={expandedEra === index}\n            onToggle={() => setExpandedEra(expandedEra === index ? null : index)}\n            onChange={(updatedEra) => handleEraChange(index, updatedEra)}\n            onDelete={() => handleDeleteEra(index)}\n            pressures={pressures}\n            schema={schema}\n            allEras={eras}\n          />\n        ))}\n\n        <button className=\"btn btn-add\" onClick={handleAddEra}>\n          + Add Era\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ eras = [], onChange, pressures = [], schema }", "type": "{ eras: any[]; onChange: Function; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["h1", "p", "div", "button"], "hookCalls": [{"name": "useState", "count": 1}, {"name": "useCallback", "count": 3}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/eras/index.js::EraCard", "name": "EraCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/eras/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.era - The era object\n * @param {boolean} props.expanded - Whether the card is expanded\n * @param {Function} props.onToggle - Called to toggle expansion\n * @param {Function} props.onChange - Called when era changes\n * @param {Function} props.onDelete - Called to delete the era\n * @param {Array} props.pressures - Available pressures\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.allEras - All eras for nextEra selection\n */\nexport function EraCard({\n  era,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  pressures,\n  schema,\n  allEras,\n}) {\n  const [, setHovering] = useState(false);\n\n  // Field change handler\n  const handleFieldChange = useCallback(\n    (field, value) => {\n      onChange({ ...era, [field]: value });\n    },\n    [era, onChange]\n  );\n\n  // Entry condition handlers\n  const handleAddEntryCondition = useCallback(() => {\n    const newRule = createNewRule(\"pressure\", pressures);\n    onChange({\n      ...era,\n      entryConditions: [...(era.entryConditions || []), newRule],\n    });\n  }, [era, onChange, pressures]);\n\n  const handleUpdateEntryCondition = useCallback(\n    (index, updated) => {\n      const newConditions = [...(era.entryConditions || [])];\n      newConditions[index] = updated;\n      onChange({ ...era, entryConditions: newConditions });\n    },\n    [era, onChange]\n  );\n\n  const handleRemoveEntryCondition = useCallback(\n    (index) => {\n      onChange({\n        ...era,\n        entryConditions: (era.entryConditions || []).filter((_, i) => i !== index),\n      });\n    },\n    [era, onChange]\n  );\n\n  // Exit condition handlers\n  const handleAddExitCondition = useCallback(() => {\n    const newRule = createNewRule(\"growth_phases_complete\", pressures);\n    onChange({\n      ...era,\n      exitConditions: [...(era.exitConditions || []), newRule],\n    });\n  }, [era, onChange, pressures]);\n\n  const handleUpdateExitCondition = useCallback(\n    (index, updated) => {\n      const newConditions = [...(era.exitConditions || [])];\n      newConditions[index] = updated;\n      onChange({ ...era, exitConditions: newConditions });\n    },\n    [era, onChange]\n  );\n\n  const handleRemoveExitCondition = useCallback(\n    (index) => {\n      onChange({\n        ...era,\n        exitConditions: (era.exitConditions || []).filter((_, i) => i !== index),\n      });\n    },\n    [era, onChange]\n  );\n\n  const updateEffectMutations = useCallback(\n    (key, nextMutations) => {\n      onChange({\n        ...era,\n        [key]: { ...(era[key] || {}), mutations: nextMutations },\n      });\n    },\n    [era, onChange]\n  );\n\n  // Entry effect handlers\n  const handleAddEntryEffect = useCallback(\n    (pressureId) => {\n      const existing = era.entryEffects?.mutations || [];\n      const hasExisting = existing.some(\n        (m) => m.type === \"modify_pressure\" && m.pressureId === pressureId\n      );\n      if (hasExisting) return;\n      updateEffectMutations(\"entryEffects\", [\n        ...existing,\n        { type: \"modify_pressure\", pressureId, delta: 10 },\n      ]);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleUpdateEntryEffect = useCallback(\n    (pressureId, value) => {\n      const existing = era.entryEffects?.mutations || [];\n      const next = existing.map((mutation) =>\n        mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId\n          ? { ...mutation, delta: value }\n          : mutation\n      );\n      updateEffectMutations(\"entryEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleRemoveEntryEffect = useCallback(\n    (pressureId) => {\n      const existing = era.entryEffects?.mutations || [];\n      const next = existing.filter(\n        (mutation) => !(mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId)\n      );\n      updateEffectMutations(\"entryEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  // Exit effect handlers\n  const handleAddExitEffect = useCallback(\n    (pressureId) => {\n      const existing = era.exitEffects?.mutations || [];\n      const hasExisting = existing.some(\n        (m) => m.type === \"modify_pressure\" && m.pressureId === pressureId\n      );\n      if (hasExisting) return;\n      updateEffectMutations(\"exitEffects\", [\n        ...existing,\n        { type: \"modify_pressure\", pressureId, delta: 10 },\n      ]);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleUpdateExitEffect = useCallback(\n    (pressureId, value) => {\n      const existing = era.exitEffects?.mutations || [];\n      const next = existing.map((mutation) =>\n        mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId\n          ? { ...mutation, delta: value }\n          : mutation\n      );\n      updateEffectMutations(\"exitEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const handleRemoveExitEffect = useCallback(\n    (pressureId) => {\n      const existing = era.exitEffects?.mutations || [];\n      const next = existing.filter(\n        (mutation) => !(mutation.type === \"modify_pressure\" && mutation.pressureId === pressureId)\n      );\n      updateEffectMutations(\"exitEffects\", next);\n    },\n    [era, updateEffectMutations]\n  );\n\n  const entryMutations = useMemo(\n    () => (era.entryEffects?.mutations || []).filter((m) => m.type === \"modify_pressure\"),\n    [era.entryEffects]\n  );\n  const exitMutations = useMemo(\n    () => (era.exitEffects?.mutations || []).filter((m) => m.type === \"modify_pressure\"),\n    [era.exitEffects]\n  );\n\n  const availablePressuresForEntry = useMemo(() => {\n    const currentIds = new Set(entryMutations.map((mutation) => mutation.pressureId));\n    return (pressures || [])\n      .filter((p) => !currentIds.has(p.id))\n      .map((p) => ({ id: p.id, name: p.name || p.id }));\n  }, [pressures, entryMutations]);\n\n  const availablePressuresForExit = useMemo(() => {\n    const currentIds = new Set(exitMutations.map((mutation) => mutation.pressureId));\n    return (pressures || [])\n      .filter((p) => !currentIds.has(p.id))\n      .map((p) => ({ id: p.id, name: p.name || p.id }));\n  }, [pressures, exitMutations]);\n\n  // Counts\n  const entryConditions = era.entryConditions || [];\n  const exitConditions = era.exitConditions || [];\n  const entryPressureChanges = entryMutations.map((mutation) => [\n    mutation.pressureId,\n    mutation.delta,\n  ]);\n  const exitPressureChanges = exitMutations.map((mutation) => [\n    mutation.pressureId,\n    mutation.delta,\n  ]);\n\n  return (\n    <div className=\"expandable-card\">\n      {/* Header */}\n      <div\n        className=\"expandable-card-header\"\n        onClick={onToggle}\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onToggle(e); }}\n      >\n        <div className=\"expandable-card-left\">\n          <div className=\"expandable-card-title\">\n            <span className=\"expandable-card-name\">{era.name}</span>\n            <span className=\"expandable-card-id\">{era.id}</span>\n          </div>\n          <div className=\"expandable-card-desc\">{era.summary}</div>\n        </div>\n        <div className=\"expandable-card-stats\">\n          <div className=\"stat\">\n            <span className=\"stat-label\">Entry</span>\n            <span className=\"stat-value\">{entryConditions.length}</span>\n          </div>\n          <div className=\"stat\">\n            <span className=\"stat-label\">Exit</span>\n            <span className=\"stat-value\">{exitConditions.length}</span>\n          </div>\n          <span className={`expand-icon ${expanded ? \"open\" : \"\"}`}>\u25bc</span>\n        </div>\n      </div>\n\n      {/* Expanded Content */}\n      {expanded && (\n        <div className=\"expandable-card-content\">\n          <BasicInfoSection era={era} onFieldChange={handleFieldChange} />\n\n          {/* Two-column transitions grid: Entry (left) | Exit (right) */}\n          <TransitionsGrid\n            entryConditions={entryConditions}\n            exitConditions={exitConditions}\n            entryPressureChanges={entryPressureChanges}\n            exitPressureChanges={exitPressureChanges}\n            onUpdateEntryCondition={handleUpdateEntryCondition}\n            onRemoveEntryCondition={handleRemoveEntryCondition}\n            onAddEntryCondition={handleAddEntryCondition}\n            onUpdateExitCondition={handleUpdateExitCondition}\n            onRemoveExitCondition={handleRemoveExitCondition}\n            onAddExitCondition={handleAddExitCondition}\n            onUpdateEntryEffect={handleUpdateEntryEffect}\n            onRemoveEntryEffect={handleRemoveEntryEffect}\n            onAddEntryEffect={handleAddEntryEffect}\n            onUpdateExitEffect={handleUpdateExitEffect}\n            onRemoveExitEffect={handleRemoveExitEffect}\n            onAddExitEffect={handleAddExitEffect}\n            availablePressuresForEntry={availablePressuresForEntry}\n            availablePressuresForExit={availablePressuresForExit}\n            pressures={pressures}\n            schema={schema}\n            eras={allEras}\n          />\n\n          {/* Delete button */}\n          <div className=\"card-footer\">\n            <button className=\"btn btn-danger\" onClick={onDelete}>\n              Delete Era\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  era,\n  expanded,\n  onToggle,\n  onChange,\n  onDelete,\n  pressures,\n  schema,\n  allEras,\n}", "type": "{ era: any; expanded: boolean; onToggle: Function; onChange: Function; onDelete: Function; pressures: any[]; schema: any; allEras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "div", "BasicInfoSection", "TransitionsGrid", "button"], "hookCalls": [{"name": "useState", "count": 1}, {"name": "useCallback", "count": 14}, {"name": "useMemo", "count": 4}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/GeneratorModal.jsx::GeneratorModal", "name": "GeneratorModal", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/GeneratorModal.jsx", "sourceCode": "export function GeneratorModal({\n  generator,\n  onChange,\n  onClose,\n  onDelete,\n  onDuplicate,\n  schema,\n  pressures,\n  eras,\n  usageMap,\n  tagRegistry = [],\n}) {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  const tabValidation = useMemo(\n    () => computeTabValidation(generator, usageMap),\n    [generator, usageMap]\n  );\n\n  const renderTabBadge = useCallback(\n    (tabId) => {\n      return <TabValidationBadge count={tabValidation.tabErrors[tabId]} />;\n    },\n    [tabValidation.tabErrors]\n  );\n\n  const sidebarFooter = tabValidation.isOrphan ? (\n    <div className=\"orphan-badge-container\">\n      <OrphanBadge isOrphan={true} />\n    </div>\n  ) : null;\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case \"overview\":\n        return (\n          <OverviewTab\n            generator={generator}\n            onChange={onChange}\n            onDelete={onDelete}\n            onDuplicate={onDuplicate}\n          />\n        );\n      case \"applicability\":\n        return (\n          <ApplicabilityTab\n            generator={generator}\n            onChange={onChange}\n            schema={schema}\n            pressures={pressures}\n            eras={eras}\n          />\n        );\n      case \"target\":\n        return <TargetTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"variables\":\n        return <VariablesTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"creation\":\n        return (\n          <CreationTab\n            generator={generator}\n            onChange={onChange}\n            schema={schema}\n            tagRegistry={tagRegistry}\n            pressures={pressures}\n          />\n        );\n      case \"relationships\":\n        return <RelationshipsTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"effects\":\n        return (\n          <EffectsTab\n            generator={generator}\n            onChange={onChange}\n            pressures={pressures}\n            schema={schema}\n          />\n        );\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <ModalShell\n      onClose={onClose}\n      icon=\"\u2699\ufe0f\"\n      title={generator.name || generator.id}\n      disabled={generator.enabled === false}\n      tabs={TABS}\n      activeTab={activeTab}\n      onTabChange={setActiveTab}\n      renderTabBadge={renderTabBadge}\n      sidebarFooter={sidebarFooter}\n    >\n      {renderTabContent()}\n    </ModalShell>\n  );\n}", "parameters": [{"name": "{\n  generator,\n  onChange,\n  onClose,\n  onDelete,\n  onDuplicate,\n  schema,\n  pressures,\n  eras,\n  usageMap,\n  tagRegistry = [],\n}", "type": "{ generator: any; onChange: any; onClose: any; onDelete: any; onDuplicate: any; schema: any; pressures: any; eras: any; usageMap: any; tagRegistry?: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["TabValidationBadge"], "hookCalls": [{"name": "useState", "count": 1}, {"name": "useMemo", "count": 1}, {"name": "useCallback", "count": 1}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useState", "useMemo", "useCallback"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "@the-canonry/shared-components", "specifiers": ["getElementValidation"], "category": "external"}, {"source": "./constants", "specifiers": ["TABS"], "category": "internal"}, {"source": "../shared", "specifiers": ["ModalShell", "TabValidationBadge", "OrphanBadge"], "category": "internal"}, {"source": "./tabs", "specifiers": ["OverviewTab", "TargetTab", "VariablesTab", "CreationTab", "RelationshipsTab", "EffectsTab", "ApplicabilityTab"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/generators/GeneratorsEditor.jsx::GeneratorsEditor", "name": "GeneratorsEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/GeneratorsEditor.jsx", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.generators - Array of generator configurations\n * @param {Function} props.onChange - Callback when generators change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport default function GeneratorsEditor({\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"generators:selected\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [expandedCategories, setExpandedCategories] = useState({});\n\n  // Derive selected generator from index - this ensures we always have the latest data\n  const resolvedIndex = selectedId ? generators.findIndex((g) => g.id === selectedId) : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedGenerator = selectedIndex !== null ? generators[selectedIndex] : null;\n\n  // Build entity kind info map for icons and labels\n  const entityKindInfo = useMemo(() => {\n    const info = {};\n    (schema?.entityKinds || []).forEach((ek) => {\n      info[ek.kind] = {\n        label: ek.description || ek.name || ek.kind,\n        icon: ek.icon || DEFAULT_KIND_ICONS[ek.kind] || \"\ud83d\udce6\",\n      };\n    });\n    return info;\n  }, [schema]);\n\n  // Group generators by the primary entity kind they create\n  const groupedGenerators = useMemo(() => {\n    const groups = {};\n\n    generators.forEach((generator) => {\n      // Get primary creation kind (first entity created, or target kind if no creation)\n      const createdKinds = (generator.creation || []).map((c) => c.kind).filter(Boolean);\n      const primaryKind = createdKinds[0] || generator.selection?.kind || \"uncategorized\";\n\n      if (!groups[primaryKind]) {\n        groups[primaryKind] = [];\n      }\n      groups[primaryKind].push(generator);\n    });\n\n    return groups;\n  }, [generators]);\n\n  // Get ordered list of categories\n  const categories = useMemo(() => {\n    // Order by schema entity kinds first, then any uncategorized\n    const schemaKinds = (schema?.entityKinds || []).map((ek) => ek.kind);\n    const usedKinds = Object.keys(groupedGenerators);\n\n    // Sort: schema kinds in order, then others alphabetically\n    return usedKinds.sort((a, b) => {\n      const aIdx = schemaKinds.indexOf(a);\n      const bIdx = schemaKinds.indexOf(b);\n      if (aIdx >= 0 && bIdx >= 0) return aIdx - bIdx;\n      if (aIdx >= 0) return -1;\n      if (bIdx >= 0) return 1;\n      return a.localeCompare(b);\n    });\n  }, [groupedGenerators, schema]);\n\n  // Initialize expanded state for new categories\n  useEffect(() => {\n    const needsUpdate = categories.some((cat) => expandedCategories[cat] === undefined);\n    if (!needsUpdate) return;\n    const updated = { ...expandedCategories };\n    categories.forEach((cat) => {\n      if (updated[cat] === undefined) {\n        updated[cat] = true;\n      }\n    });\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync category expansion defaults when categories change\n    setExpandedCategories(updated);\n  }, [categories, expandedCategories]);\n\n  // Restore selectedId from storage when selectionKey changes\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted selection when key changes\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  // Persist selectedId to storage\n  useEffect(() => {\n    if (!selectionKey) return;\n    if (selectedId) {\n      saveStoredValue(selectionKey, selectedId);\n    } else {\n      clearStoredValue(selectionKey);\n    }\n  }, [selectionKey, selectedId]);\n\n  // Clear invalid selectedId (during render)\n  if (selectedId && selectedIndex === null) {\n    setSelectedId(null);\n    clearStoredValue(selectionKey);\n  }\n\n  const handleGeneratorChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex < generators.length) {\n        const newGenerators = [...generators];\n        newGenerators[selectedIndex] = updated;\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (generator) => {\n      const index = generators.findIndex((g) => g.id === generator.id);\n      if (index >= 0) {\n        const newGenerators = [...generators];\n        newGenerators[index] = {\n          ...generator,\n          enabled: generator.enabled === false ? true : false,\n        };\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedGenerator &&\n      confirm(`Delete generator \"${selectedGenerator.name || selectedGenerator.id}\"?`)\n    ) {\n      const newGenerators = [...generators];\n      newGenerators.splice(selectedIndex, 1);\n      onChange(newGenerators);\n      setSelectedId(null);\n    }\n  }, [generators, onChange, selectedIndex, selectedGenerator]);\n\n  const handleAdd = useCallback(() => {\n    const newGenerator = {\n      id: `generator_${Date.now()}`,\n      name: \"New Generator\",\n      applicability: [],\n      selection: { strategy: \"by_kind\", kind: \"location\", pickStrategy: \"random\" },\n      creation: [],\n      relationships: [],\n      stateUpdates: [],\n      variables: {},\n    };\n    onChange([...generators, newGenerator]);\n    setSelectedId(newGenerator.id);\n  }, [generators, onChange]);\n\n  const handleDuplicate = useCallback(() => {\n    if (!selectedGenerator) return;\n    const duplicated = {\n      ...JSON.parse(JSON.stringify(selectedGenerator)), // Deep clone\n      id: `${selectedGenerator.id}_copy_${Date.now()}`,\n      name: `${selectedGenerator.name || selectedGenerator.id} (Copy)`,\n    };\n    onChange([...generators, duplicated]);\n    setSelectedId(duplicated.id);\n  }, [generators, onChange, selectedGenerator]);\n\n  const toggleCategoryExpand = useCallback((kind) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [kind]: !prev[kind],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (kind) => {\n      const categoryItems = groupedGenerators[kind] || [];\n      const allEnabled = categoryItems.every((g) => g.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of generators in this category\n      const categoryIds = new Set(categoryItems.map((g) => g.id));\n\n      const newGenerators = generators.map((g) => {\n        if (categoryIds.has(g.id)) {\n          return { ...g, enabled: newEnabled };\n        }\n        return g;\n      });\n      onChange(newGenerators);\n    },\n    [generators, groupedGenerators, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Generators</h1>\n        <p className=\"subtitle\">\n          Configure entity generators that populate your world. Click a generator to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((kind) => {\n        const kindInfo = entityKindInfo[kind] || {\n          label: kind.charAt(0).toUpperCase() + kind.slice(1),\n          icon: DEFAULT_KIND_ICONS[kind] || \"\ud83d\udce6\",\n        };\n        const categoryItems = groupedGenerators[kind] || [];\n        const allEnabled = categoryItems.every((g) => g.enabled !== false);\n\n        return (\n          <CategorySection\n            key={kind}\n            id={kind}\n            icon={kindInfo.icon}\n            label={`${kindInfo.label} Generators`}\n            items={categoryItems}\n            expanded={expandedCategories[kind] !== false}\n            onToggleExpand={() => toggleCategoryExpand(kind)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(kind)}\n            renderItem={(generator) => (\n              <GeneratorListCard\n                key={generator.id}\n                generator={generator}\n                onClick={() => setSelectedId(generator.id)}\n                onToggle={() => handleToggle(generator)}\n                usageMap={usageMap}\n              />\n            )}\n          />\n        );\n      })}\n\n      {/* Add Generator button */}\n      <div className=\"mt-lg\">\n        <AddCard onClick={handleAdd} label=\"Add Generator\" />\n      </div>\n\n      {selectedGenerator && (\n        <GeneratorModal\n          generator={selectedGenerator}\n          onChange={handleGeneratorChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          onDuplicate={handleDuplicate}\n          schema={schema}\n          pressures={pressures}\n          eras={eras}\n          usageMap={usageMap}\n          tagRegistry={schema.tagRegistry || []}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}", "type": "{ generators: any[]; onChange: Function; schema: any; pressures: any[]; eras: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["h1", "p", "CategorySection", "AddCard", "GeneratorModal"], "hookCalls": [{"name": "useState", "count": 2}, {"name": "useMemo", "count": 3}, {"name": "useEffect", "count": 3}, {"name": "useCallback", "count": 7}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useState", "useCallback", "useMemo", "useEffect"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "../shared", "specifiers": ["CategorySection", "AddCard"], "category": "internal"}, {"source": "./GeneratorModal", "specifiers": ["GeneratorModal"], "category": "internal"}, {"source": "./cards", "specifiers": ["GeneratorListCard"], "category": "internal"}, {"source": "../../utils/persistence", "specifiers": ["buildStorageKey", "clearStoredValue", "loadStoredValue", "saveStoredValue"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::GeneratorsEditor", "name": "GeneratorsEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.generators - Array of generator configurations\n * @param {Function} props.onChange - Callback when generators change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport default function GeneratorsEditor({\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}) {\n  const selectionKey = buildStorageKey(projectId, \"generators:selected\");\n  const [selectedId, setSelectedId] = useState(() => {\n    const stored = loadStoredValue(selectionKey);\n    return typeof stored === \"string\" ? stored : null;\n  });\n  const [expandedCategories, setExpandedCategories] = useState({});\n\n  // Derive selected generator from index - this ensures we always have the latest data\n  const resolvedIndex = selectedId ? generators.findIndex((g) => g.id === selectedId) : -1;\n  const selectedIndex = resolvedIndex >= 0 ? resolvedIndex : null;\n  const selectedGenerator = selectedIndex !== null ? generators[selectedIndex] : null;\n\n  // Build entity kind info map for icons and labels\n  const entityKindInfo = useMemo(() => {\n    const info = {};\n    (schema?.entityKinds || []).forEach((ek) => {\n      info[ek.kind] = {\n        label: ek.description || ek.name || ek.kind,\n        icon: ek.icon || DEFAULT_KIND_ICONS[ek.kind] || \"\ud83d\udce6\",\n      };\n    });\n    return info;\n  }, [schema]);\n\n  // Group generators by the primary entity kind they create\n  const groupedGenerators = useMemo(() => {\n    const groups = {};\n\n    generators.forEach((generator) => {\n      // Get primary creation kind (first entity created, or target kind if no creation)\n      const createdKinds = (generator.creation || []).map((c) => c.kind).filter(Boolean);\n      const primaryKind = createdKinds[0] || generator.selection?.kind || \"uncategorized\";\n\n      if (!groups[primaryKind]) {\n        groups[primaryKind] = [];\n      }\n      groups[primaryKind].push(generator);\n    });\n\n    return groups;\n  }, [generators]);\n\n  // Get ordered list of categories\n  const categories = useMemo(() => {\n    // Order by schema entity kinds first, then any uncategorized\n    const schemaKinds = (schema?.entityKinds || []).map((ek) => ek.kind);\n    const usedKinds = Object.keys(groupedGenerators);\n\n    // Sort: schema kinds in order, then others alphabetically\n    return usedKinds.sort((a, b) => {\n      const aIdx = schemaKinds.indexOf(a);\n      const bIdx = schemaKinds.indexOf(b);\n      if (aIdx >= 0 && bIdx >= 0) return aIdx - bIdx;\n      if (aIdx >= 0) return -1;\n      if (bIdx >= 0) return 1;\n      return a.localeCompare(b);\n    });\n  }, [groupedGenerators, schema]);\n\n  // Initialize expanded state for new categories\n  useEffect(() => {\n    const needsUpdate = categories.some((cat) => expandedCategories[cat] === undefined);\n    if (!needsUpdate) return;\n    const updated = { ...expandedCategories };\n    categories.forEach((cat) => {\n      if (updated[cat] === undefined) {\n        updated[cat] = true;\n      }\n    });\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- sync category expansion defaults when categories change\n    setExpandedCategories(updated);\n  }, [categories, expandedCategories]);\n\n  // Restore selectedId from storage when selectionKey changes\n  useEffect(() => {\n    const stored = loadStoredValue(selectionKey);\n    // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted selection when key changes\n    setSelectedId(typeof stored === \"string\" ? stored : null);\n  }, [selectionKey]);\n\n  // Persist selectedId to storage\n  useEffect(() => {\n    if (!selectionKey) return;\n    if (selectedId) {\n      saveStoredValue(selectionKey, selectedId);\n    } else {\n      clearStoredValue(selectionKey);\n    }\n  }, [selectionKey, selectedId]);\n\n  // Clear invalid selectedId (during render)\n  if (selectedId && selectedIndex === null) {\n    setSelectedId(null);\n    clearStoredValue(selectionKey);\n  }\n\n  const handleGeneratorChange = useCallback(\n    (updated) => {\n      if (selectedIndex !== null && selectedIndex < generators.length) {\n        const newGenerators = [...generators];\n        newGenerators[selectedIndex] = updated;\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange, selectedIndex]\n  );\n\n  const handleToggle = useCallback(\n    (generator) => {\n      const index = generators.findIndex((g) => g.id === generator.id);\n      if (index >= 0) {\n        const newGenerators = [...generators];\n        newGenerators[index] = {\n          ...generator,\n          enabled: generator.enabled === false ? true : false,\n        };\n        onChange(newGenerators);\n      }\n    },\n    [generators, onChange]\n  );\n\n  const handleDelete = useCallback(() => {\n    if (\n      selectedIndex !== null &&\n      selectedGenerator &&\n      confirm(`Delete generator \"${selectedGenerator.name || selectedGenerator.id}\"?`)\n    ) {\n      const newGenerators = [...generators];\n      newGenerators.splice(selectedIndex, 1);\n      onChange(newGenerators);\n      setSelectedId(null);\n    }\n  }, [generators, onChange, selectedIndex, selectedGenerator]);\n\n  const handleAdd = useCallback(() => {\n    const newGenerator = {\n      id: `generator_${Date.now()}`,\n      name: \"New Generator\",\n      applicability: [],\n      selection: { strategy: \"by_kind\", kind: \"location\", pickStrategy: \"random\" },\n      creation: [],\n      relationships: [],\n      stateUpdates: [],\n      variables: {},\n    };\n    onChange([...generators, newGenerator]);\n    setSelectedId(newGenerator.id);\n  }, [generators, onChange]);\n\n  const handleDuplicate = useCallback(() => {\n    if (!selectedGenerator) return;\n    const duplicated = {\n      ...JSON.parse(JSON.stringify(selectedGenerator)), // Deep clone\n      id: `${selectedGenerator.id}_copy_${Date.now()}`,\n      name: `${selectedGenerator.name || selectedGenerator.id} (Copy)`,\n    };\n    onChange([...generators, duplicated]);\n    setSelectedId(duplicated.id);\n  }, [generators, onChange, selectedGenerator]);\n\n  const toggleCategoryExpand = useCallback((kind) => {\n    setExpandedCategories((prev) => ({\n      ...prev,\n      [kind]: !prev[kind],\n    }));\n  }, []);\n\n  const toggleAllInCategory = useCallback(\n    (kind) => {\n      const categoryItems = groupedGenerators[kind] || [];\n      const allEnabled = categoryItems.every((g) => g.enabled !== false);\n      const newEnabled = !allEnabled;\n\n      // Get IDs of generators in this category\n      const categoryIds = new Set(categoryItems.map((g) => g.id));\n\n      const newGenerators = generators.map((g) => {\n        if (categoryIds.has(g.id)) {\n          return { ...g, enabled: newEnabled };\n        }\n        return g;\n      });\n      onChange(newGenerators);\n    },\n    [generators, groupedGenerators, onChange]\n  );\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Generators</h1>\n        <p className=\"subtitle\">\n          Configure entity generators that populate your world. Click a generator to edit.\n        </p>\n      </div>\n\n      {/* Category sections */}\n      {categories.map((kind) => {\n        const kindInfo = entityKindInfo[kind] || {\n          label: kind.charAt(0).toUpperCase() + kind.slice(1),\n          icon: DEFAULT_KIND_ICONS[kind] || \"\ud83d\udce6\",\n        };\n        const categoryItems = groupedGenerators[kind] || [];\n        const allEnabled = categoryItems.every((g) => g.enabled !== false);\n\n        return (\n          <CategorySection\n            key={kind}\n            id={kind}\n            icon={kindInfo.icon}\n            label={`${kindInfo.label} Generators`}\n            items={categoryItems}\n            expanded={expandedCategories[kind] !== false}\n            onToggleExpand={() => toggleCategoryExpand(kind)}\n            allEnabled={allEnabled}\n            onToggleAll={() => toggleAllInCategory(kind)}\n            renderItem={(generator) => (\n              <GeneratorListCard\n                key={generator.id}\n                generator={generator}\n                onClick={() => setSelectedId(generator.id)}\n                onToggle={() => handleToggle(generator)}\n                usageMap={usageMap}\n              />\n            )}\n          />\n        );\n      })}\n\n      {/* Add Generator button */}\n      <div className=\"mt-lg\">\n        <AddCard onClick={handleAdd} label=\"Add Generator\" />\n      </div>\n\n      {selectedGenerator && (\n        <GeneratorModal\n          generator={selectedGenerator}\n          onChange={handleGeneratorChange}\n          onClose={() => setSelectedId(null)}\n          onDelete={handleDelete}\n          onDuplicate={handleDuplicate}\n          schema={schema}\n          pressures={pressures}\n          eras={eras}\n          usageMap={usageMap}\n          tagRegistry={schema.tagRegistry || []}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  projectId,\n  generators = [],\n  onChange,\n  schema,\n  pressures = [],\n  eras = [],\n  usageMap,\n}", "type": "{ generators: any[]; onChange: Function; schema: any; pressures: any[]; eras: any[]; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["h1", "p", "CategorySection", "AddCard", "GeneratorModal"], "hookCalls": [{"name": "useState", "count": 2}, {"name": "useMemo", "count": 3}, {"name": "useEffect", "count": 3}, {"name": "useCallback", "count": 7}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::GeneratorModal", "name": "GeneratorModal", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "export function GeneratorModal({\n  generator,\n  onChange,\n  onClose,\n  onDelete,\n  onDuplicate,\n  schema,\n  pressures,\n  eras,\n  usageMap,\n  tagRegistry = [],\n}) {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  const tabValidation = useMemo(\n    () => computeTabValidation(generator, usageMap),\n    [generator, usageMap]\n  );\n\n  const renderTabBadge = useCallback(\n    (tabId) => {\n      return <TabValidationBadge count={tabValidation.tabErrors[tabId]} />;\n    },\n    [tabValidation.tabErrors]\n  );\n\n  const sidebarFooter = tabValidation.isOrphan ? (\n    <div className=\"orphan-badge-container\">\n      <OrphanBadge isOrphan={true} />\n    </div>\n  ) : null;\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case \"overview\":\n        return (\n          <OverviewTab\n            generator={generator}\n            onChange={onChange}\n            onDelete={onDelete}\n            onDuplicate={onDuplicate}\n          />\n        );\n      case \"applicability\":\n        return (\n          <ApplicabilityTab\n            generator={generator}\n            onChange={onChange}\n            schema={schema}\n            pressures={pressures}\n            eras={eras}\n          />\n        );\n      case \"target\":\n        return <TargetTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"variables\":\n        return <VariablesTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"creation\":\n        return (\n          <CreationTab\n            generator={generator}\n            onChange={onChange}\n            schema={schema}\n            tagRegistry={tagRegistry}\n            pressures={pressures}\n          />\n        );\n      case \"relationships\":\n        return <RelationshipsTab generator={generator} onChange={onChange} schema={schema} />;\n      case \"effects\":\n        return (\n          <EffectsTab\n            generator={generator}\n            onChange={onChange}\n            pressures={pressures}\n            schema={schema}\n          />\n        );\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <ModalShell\n      onClose={onClose}\n      icon=\"\u2699\ufe0f\"\n      title={generator.name || generator.id}\n      disabled={generator.enabled === false}\n      tabs={TABS}\n      activeTab={activeTab}\n      onTabChange={setActiveTab}\n      renderTabBadge={renderTabBadge}\n      sidebarFooter={sidebarFooter}\n    >\n      {renderTabContent()}\n    </ModalShell>\n  );\n}", "parameters": [{"name": "{\n  generator,\n  onChange,\n  onClose,\n  onDelete,\n  onDuplicate,\n  schema,\n  pressures,\n  eras,\n  usageMap,\n  tagRegistry = [],\n}", "type": "{ generator: any; onChange: any; onClose: any; onDelete: any; onDuplicate: any; schema: any; pressures: any; eras: any; usageMap: any; tagRegistry?: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["TabValidationBadge"], "hookCalls": [{"name": "useState", "count": 1}, {"name": "useMemo", "count": 1}, {"name": "useCallback", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::GeneratorListCard", "name": "GeneratorListCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator to display\n * @param {Function} props.onClick - Callback when card is clicked\n * @param {Function} props.onToggle - Callback to toggle enabled state\n * @param {Object} props.usageMap - Schema usage map for validation\n */\nexport function GeneratorListCard({ generator, onClick, onToggle, usageMap }) {\n  const isEnabled = generator.enabled !== false;\n\n  const summary = useMemo(() => {\n    const creates =\n      generator.creation?.map((c) => c.kind).filter((v, i, a) => a.indexOf(v) === i) || [];\n    const rels = generator.relationships?.length || 0;\n    const effects = generator.stateUpdates?.length || 0;\n    return { creates, rels, effects };\n  }, [generator]);\n\n  // Get validation and usage info\n  const validation = useMemo(\n    () =>\n      usageMap\n        ? getElementValidation(usageMap, \"generator\", generator.id)\n        : { invalidRefs: [], isOrphan: false },\n    [usageMap, generator.id]\n  );\n\n  const eraUsage = useMemo(() => {\n    if (!usageMap?.generators?.[generator.id]) return [];\n    return usageMap.generators[generator.id].eras || [];\n  }, [usageMap, generator.id]);\n\n  const errorCount = validation.invalidRefs.length;\n  const hasErrors = errorCount > 0;\n  const isOrphan = validation.isOrphan;\n\n  return (\n    <div\n      className={`card card-clickable ${!isEnabled ? \"card-disabled\" : \"\"} ${hasErrors ? \"card-error\" : \"\"} ${isOrphan && !hasErrors ? \"card-warning\" : \"\"}`}\n      onClick={onClick}\n      role=\"button\"\n      tabIndex={0}\n      onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }}\n    >\n      <div className=\"card-header\">\n        <div>\n          <div className=\"flex items-center gap-md\">\n            <span className=\"card-title\">{generator.name || generator.id}</span>\n            <ErrorBadge count={errorCount} />\n          </div>\n          <div className=\"card-id\">{generator.id}</div>\n        </div>\n        <EnableToggle\n          enabled={isEnabled}\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggle();\n          }}\n        />\n      </div>\n\n      <div className=\"card-stats\">\n        <div className=\"card-stat\">\n          <span>\u2728</span> {generator.creation?.length || 0} creates\n        </div>\n        <div className=\"card-stat\">\n          <span>\ud83d\udd17</span> {summary.rels} rels\n        </div>\n        <div className=\"card-stat\">\n          <span>\u26a1</span> {summary.effects} effects\n        </div>\n      </div>\n\n      <div className=\"card-badges\">\n        {summary.creates.slice(0, 3).map((kind) => (\n          <span key={kind} className=\"badge badge-entity-kind\">\n            + {kind}\n          </span>\n        ))}\n      </div>\n\n      <EraBadges eras={eraUsage} />\n      {isOrphan && (\n        <div className=\"mt-md\">\n          <OrphanBadge isOrphan={isOrphan} />\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onClick, onToggle, usageMap }", "type": "{ generator: any; onClick: Function; onToggle: Function; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "ErrorBadge", "div", "EnableToggle", "EraBadges", "OrphanBadge"], "hookCalls": [{"name": "useMemo", "count": 3}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::PathStepEditor", "name": "PathStepEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.step - The path step configuration\n * @param {Function} props.onChange - Callback when step changes\n * @param {Function} props.onRemove - Callback to remove this step\n * @param {Object} props.schema - Domain schema\n * @param {number} props.stepIndex - Index of this step in the path\n */\nexport function PathStepEditor({ step, onChange, onRemove, schema, stepIndex }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKindOptions = [\n    { value: \"any\", label: \"Any kind\" },\n    ...(schema?.entityKinds || []).map((ek) => ({\n      value: ek.kind,\n      label: ek.description || ek.kind,\n    })),\n  ];\n\n  const getSubtypeOptions = (kind) => {\n    if (!kind || kind === \"any\") return [{ value: \"any\", label: \"Any subtype\" }];\n    const ek = (schema?.entityKinds || []).find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [{ value: \"any\", label: \"Any subtype\" }];\n    return [\n      { value: \"any\", label: \"Any subtype\" },\n      ...ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id })),\n    ];\n  };\n\n  const updateStep = (field, value) => {\n    onChange({ ...step, [field]: value });\n  };\n\n  return (\n    <div className=\"path-step-card\">\n      <div className=\"path-step-header\">\n        <span className=\"path-step-label\">Step {stepIndex + 1}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      <div className=\"path-step-grid\">\n        <div>\n          <label className=\"label label-micro\">Via Relationship\n          <ReferenceDropdown\n            value={step.via || \"\"}\n            onChange={(v) => updateStep(\"via\", v)}\n            options={relationshipKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Direction\n          <ReferenceDropdown\n            value={step.direction || \"any\"}\n            onChange={(v) => updateStep(\"direction\", v)}\n            options={PATH_DIRECTIONS}\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Kind\n          <ReferenceDropdown\n            value={step.targetKind}\n            onChange={(v) => updateStep(\"targetKind\", v)}\n            options={entityKindOptions}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div>\n          <label className=\"label label-micro\">Target Subtype\n          <ReferenceDropdown\n            value={step.targetSubtype}\n            onChange={(v) => updateStep(\"targetSubtype\", v)}\n            options={getSubtypeOptions(step.targetKind)}\n            placeholder=\"Select...\"\n          />\n          </label>\n        </div>\n        <div className=\"path-step-full-width\">\n          <label htmlFor=\"store-as-variable-optional\" className=\"label label-micro\">Store As Variable (optional)</label>\n          <input id=\"store-as-variable-optional\"\n            type=\"text\"\n            value={step.as || \"\"}\n            onChange={(e) => updateStep(\"as\", e.target.value)}\n            className=\"input input-micro\"\n            placeholder=\"e.g. $allies\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ step, onChange, onRemove, schema, stepIndex }", "type": "{ step: any; onChange: Function; onRemove: Function; schema: any; stepIndex: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "button", "ReferenceDropdown", "label", "input"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::PathConstraintEditor", "name": "PathConstraintEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.constraint - The path constraint configuration\n * @param {Function} props.onChange - Callback when constraint changes\n * @param {Function} props.onRemove - Callback to remove this constraint\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function PathConstraintEditor({ constraint, onChange, onRemove, schema, availableRefs }) {\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  // Gather all subtypes from all entity kinds for subtype_equals constraint\n  const allSubtypeOptions = entityKinds.flatMap((ek) =>\n    (ek.subtypes || []).map((st) => ({\n      value: st.id,\n      label: `${st.name || st.id} (${ek.kind})`,\n    }))\n  );\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateConstraint = (field, value) => {\n    onChange({ ...constraint, [field]: value || undefined });\n  };\n\n  const renderConstraintFields = () => {\n    switch (constraint.type) {\n      case \"not_self\":\n        return <span className=\"text-muted text-small\">Target cannot be the starting entity</span>;\n\n      case \"not_in\":\n      case \"in\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Set Variable\n            <ReferenceDropdown\n              value={constraint.set || \"\"}\n              onChange={(v) => updateConstraint(\"set\", v)}\n              options={refOptions}\n              placeholder=\"e.g. $allies\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"kind_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Entity Kind\n            <ReferenceDropdown\n              value={constraint.kind || \"\"}\n              onChange={(v) => updateConstraint(\"kind\", v)}\n              options={entityKindOptions}\n            />\n            </label>\n          </div>\n        );\n\n      case \"subtype_equals\":\n        return (\n          <div>\n            <label className=\"label label-micro\">Subtype\n            <ReferenceDropdown\n              value={constraint.subtype || \"\"}\n              onChange={(v) => updateConstraint(\"subtype\", v)}\n              options={allSubtypeOptions}\n              placeholder=\"Select subtype...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"constraint-fields-grid\">\n            <div>\n              <label className=\"label label-micro\">Kind\n              <ReferenceDropdown\n                value={constraint.kind || \"\"}\n                onChange={(v) => updateConstraint(\"kind\", v)}\n                options={relationshipKindOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">With\n              <ReferenceDropdown\n                value={constraint.with || \"\"}\n                onChange={(v) => updateConstraint(\"with\", v)}\n                options={refOptions}\n              />\n              </label>\n            </div>\n            <div>\n              <label className=\"label label-micro\">Direction\n              <ReferenceDropdown\n                value={constraint.direction || \"any\"}\n                onChange={(v) => updateConstraint(\"direction\", v)}\n                options={PATH_DIRECTIONS}\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  const constraintLabel =\n    PATH_CONSTRAINT_TYPES.find((c) => c.value === constraint.type)?.label || constraint.type;\n\n  return (\n    <div className=\"path-constraint-card\">\n      <div className=\"path-constraint-header\">\n        <span className=\"path-constraint-label\">{constraintLabel}</span>\n        <button onClick={onRemove} className=\"button button-remove-micro\">\n          \u00d7\n        </button>\n      </div>\n      {renderConstraintFields()}\n    </div>\n  );\n}", "parameters": [{"name": "{ constraint, onChange, onRemove, schema, availableRefs }", "type": "{ constraint: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::GraphPathEditor", "name": "GraphPathEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.assert - The path assertion configuration\n * @param {Function} props.onChange - Callback when assertion changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function GraphPathEditor({ assert, onChange, schema, availableRefs }) {\n  const [showConstraintMenu, setShowConstraintMenu] = useState(false);\n\n  const assertion = assert || { check: \"exists\", path: [] };\n\n  const updateAssertion = (field, value) => {\n    onChange({ ...assertion, [field]: value });\n  };\n\n  const addStep = () => {\n    // Create with empty required fields - validation will flag them\n    const newStep = { via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" };\n    updateAssertion(\"path\", [...(assertion.path || []), newStep]);\n  };\n\n  const updateStep = (index, updated) => {\n    const newPath = [...(assertion.path || [])];\n    newPath[index] = updated;\n    updateAssertion(\"path\", newPath);\n  };\n\n  const removeStep = (index) => {\n    updateAssertion(\n      \"path\",\n      (assertion.path || []).filter((_, i) => i !== index)\n    );\n  };\n\n  const addConstraint = (type) => {\n    const newConstraint = { type };\n    if (type === \"has_relationship\" || type === \"lacks_relationship\") {\n      newConstraint.direction = \"any\";\n    }\n    updateAssertion(\"where\", [...(assertion.where || []), newConstraint]);\n    setShowConstraintMenu(false);\n  };\n\n  const updateConstraint = (index, updated) => {\n    const newWhere = [...(assertion.where || [])];\n    newWhere[index] = updated;\n    updateAssertion(\"where\", newWhere);\n  };\n\n  const removeConstraint = (index) => {\n    const newWhere = (assertion.where || []).filter((_, i) => i !== index);\n    updateAssertion(\"where\", newWhere.length > 0 ? newWhere : undefined);\n  };\n\n  // Collect variables from path steps for constraint references\n  const pathVars = (assertion.path || []).filter((s) => s.as).map((s) => s.as);\n  const allRefs = [...(availableRefs || []), ...pathVars];\n\n  return (\n    <div className=\"graph-path-editor\">\n      {/* Check type and count */}\n      <div className=\"path-editor-grid\">\n        <div>\n          <label className=\"label label-tiny\">Check Type\n          <ReferenceDropdown\n            value={assertion.check || \"exists\"}\n            onChange={(v) => updateAssertion(\"check\", v)}\n            options={PATH_CHECK_TYPES}\n          />\n          </label>\n        </div>\n        {(assertion.check === \"count_min\" || assertion.check === \"count_max\") && (\n          <div>\n            <label className=\"label label-tiny\">Count\n            <NumberInput\n              value={assertion.count ?? 1}\n              onChange={(v) => updateAssertion(\"count\", v ?? 1)}\n              min={0}\n              integer\n              className=\"input input-compact\"\n            />\n            </label>\n          </div>\n        )}\n      </div>\n\n      {/* Path steps */}\n      <div>\n        <span className=\"label label-tiny\">Path Steps (traverse relationships)</span>\n        <div className=\"path-steps-list\">\n          {(assertion.path || []).map((step, index) => (\n            <PathStepEditor\n              key={index}\n              step={step}\n              onChange={(updated) => updateStep(index, updated)}\n              onRemove={() => removeStep(index)}\n              schema={schema}\n              stepIndex={index}\n            />\n          ))}\n          {(assertion.path || []).length < 2 && (\n            <button onClick={addStep} className=\"button button-add-step\">\n              + Add Step {(assertion.path || []).length === 0 ? \"(required)\" : \"(optional)\"}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Where constraints */}\n      <div>\n        <span className=\"label label-tiny\">Where Constraints (optional)</span>\n        <div className=\"path-constraints-list\">\n          {(assertion.where || []).map((constraint, index) => (\n            <PathConstraintEditor\n              key={index}\n              constraint={constraint}\n              onChange={(updated) => updateConstraint(index, updated)}\n              onRemove={() => removeConstraint(index)}\n              schema={schema}\n              availableRefs={allRefs}\n            />\n          ))}\n          <div className=\"relative\">\n            <button\n              onClick={() => setShowConstraintMenu(!showConstraintMenu)}\n              className=\"button button-add-constraint\"\n            >\n              + Add Constraint\n            </button>\n            {showConstraintMenu && (\n              <div className=\"dropdown-menu\">\n                {PATH_CONSTRAINT_TYPES.map(({ value, label }) => (\n                  <div\n                    key={value}\n                    onClick={() => addConstraint(value)}\n                    className=\"dropdown-menu-item\"\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    {label}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ assert, onChange, schema, availableRefs }", "type": "{ assert: any; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["ReferenceDropdown", "NumberInput", "span", "PathStepEditor", "button", "PathConstraintEditor", "div"], "hookCalls": [{"name": "useState", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::SelectionFilterCard", "name": "SelectionFilterCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.filter - The filter configuration\n * @param {Function} props.onChange - Callback when filter changes\n * @param {Function} props.onRemove - Callback to remove this filter\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFilterCard({ filter, onChange, onRemove, schema, availableRefs }) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = FILTER_TYPES[filter.type] || {\n    label: filter.type,\n    icon: \"\u2753\",\n    color: \"#6b7280\",\n  };\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const refOptions = (availableRefs || []).map((ref) => ({\n    value: ref,\n    label: ref,\n  }));\n\n  const updateFilter = (field, value) => {\n    onChange({ ...filter, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (filter.type) {\n      case \"has_tag\": {\n        const valueSuffix = filter.value !== undefined ? ` = ${filter.value}` : \"\";\n        return `${filter.tag || \"?\"}${valueSuffix}`;\n      }\n      case \"has_tags\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"lacks_tag\":\n        return filter.tag || \"tag?\";\n      case \"lacks_any_tag\":\n        return (filter.tags || []).join(\", \") || \"no tags\";\n      case \"has_culture\":\n        return filter.culture || \"culture?\";\n      case \"matches_culture\":\n        return `with ${filter.with || \"?\"}`;\n      case \"has_status\":\n        return filter.status || \"status?\";\n      case \"has_prominence\":\n        return filter.minProminence || \"prominence?\";\n      case \"has_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        const direction = filter.direction ? ` [${filter.direction}]` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}${direction}`;\n      }\n      case \"lacks_relationship\": {\n        const withLabel = filter.with ? ` with ${filter.with}` : \"\";\n        return `${filter.kind || \"?\"}${withLabel}`;\n      }\n      case \"exclude\":\n        return `${(filter.entities || []).length} excluded`;\n      case \"shares_related\":\n        return `${filter.relationshipKind || \"?\"} with ${filter.with || \"?\"}`;\n      case \"graph_path\":\n        return `graph path (${filter.assert?.check || \"exists\"})`;\n      default:\n        return \"\";\n    }\n  };\n\n  const summary = getSummary();\n\n  const renderFilterFields = () => {\n    switch (filter.type) {\n      case \"has_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"has_tags\":\n      case \"has_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">\n              {filter.type === \"has_tags\" ? \"Tags (must have ALL)\" : \"Tags (must have at least ONE)\"}\n            </label>\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n          </div>\n        );\n\n      case \"lacks_tag\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-wide\">\n              <label className=\"label label-small\">Tag\n              <TagSelector\n                value={filter.tag ? [filter.tag] : []}\n                onChange={(v) => updateFilter(\"tag\", v[0] || \"\")}\n                tagRegistry={schema?.tagRegistry || []}\n                placeholder=\"Select tag...\"\n                singleSelect\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-wide\">\n              <label htmlFor=\"value-optional\" className=\"label label-small\">Value (optional)</label>\n              <input id=\"value-optional\"\n                type=\"text\"\n                value={filter.value ?? \"\"}\n                onChange={(e) => updateFilter(\"value\", e.target.value || undefined)}\n                className=\"input input-compact\"\n                placeholder=\"Any value\"\n              />\n            </div>\n          </div>\n        );\n\n      case \"lacks_any_tag\":\n        return (\n          <div>\n            <label className=\"label label-small\">Tags (exclude if has ANY)\n            <TagSelector\n              value={filter.tags || []}\n              onChange={(v) => updateFilter(\"tags\", v)}\n              tagRegistry={schema?.tagRegistry || []}\n              placeholder=\"Select tags...\"\n            />\n            </label>\n          </div>\n        );\n\n\n      case \"has_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Culture\n            <ReferenceDropdown\n              value={filter.culture || \"\"}\n              onChange={(v) => updateFilter(\"culture\", v)}\n              options={(schema?.cultures || []).map((c) => ({\n                value: c.id,\n                label: c.name || c.id,\n              }))}\n              placeholder=\"Select culture...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"matches_culture\":\n        return (\n          <div>\n            <label className=\"label label-small\">Same Culture As\n            <ReferenceDropdown\n              value={filter.with || \"\"}\n              onChange={(v) => updateFilter(\"with\", v)}\n              options={refOptions}\n              placeholder=\"Select variable...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_status\":\n        return (\n          <div>\n            <label htmlFor=\"status\" className=\"label label-small\">Status</label>\n            <input id=\"status\"\n              type=\"text\"\n              value={filter.status || \"\"}\n              onChange={(e) => updateFilter(\"status\", e.target.value)}\n              className=\"input input-compact\"\n              placeholder=\"e.g., active, historical\"\n            />\n          </div>\n        );\n\n      case \"has_prominence\":\n        return (\n          <div>\n            <label className=\"label label-small\">Minimum Prominence\n            <ReferenceDropdown\n              value={filter.minProminence || \"\"}\n              onChange={(v) => updateFilter(\"minProminence\", v)}\n              options={PROMINENCE_LEVELS.map((p) => ({ value: p.value, label: p.label }))}\n              placeholder=\"Select prominence...\"\n            />\n            </label>\n          </div>\n        );\n\n      case \"has_relationship\":\n      case \"lacks_relationship\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Relationship Kind\n              <ReferenceDropdown\n                value={filter.kind || \"\"}\n                onChange={(v) => updateFilter(\"kind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity (optional)\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v || undefined)}\n                options={refOptions}\n                placeholder=\"Any entity\"\n              />\n              </label>\n            </div>\n            {filter.type === \"has_relationship\" && (\n              <div className=\"sfc-flex-field-tiny\">\n                <label className=\"label label-small\">Direction\n                <ReferenceDropdown\n                  value={filter.direction || \"both\"}\n                  onChange={(v) => updateFilter(\"direction\", v)}\n                  options={[\n                    { value: \"both\", label: \"Both\" },\n                    { value: \"src\", label: \"Outgoing\" },\n                    { value: \"dst\", label: \"Incoming\" },\n                  ]}\n                />\n                </label>\n              </div>\n            )}\n          </div>\n        );\n\n      case \"exclude\":\n        return (\n          <ChipSelect\n            label=\"Entities to Exclude\"\n            value={filter.entities || []}\n            onChange={(v) => updateFilter(\"entities\", v)}\n            options={refOptions}\n            placeholder=\"+ Add variable...\"\n          />\n        );\n\n      case \"shares_related\":\n        return (\n          <div className=\"filter-fields\">\n            <div className=\"sfc-flex-field-medium\">\n              <label className=\"label label-small\">Via Relationship\n              <ReferenceDropdown\n                value={filter.relationshipKind || \"\"}\n                onChange={(v) => updateFilter(\"relationshipKind\", v)}\n                options={relationshipKindOptions}\n                placeholder=\"Select kind...\"\n              />\n              </label>\n            </div>\n            <div className=\"sfc-flex-field-narrow\">\n              <label className=\"label label-small\">With Entity\n              <ReferenceDropdown\n                value={filter.with || \"\"}\n                onChange={(v) => updateFilter(\"with\", v)}\n                options={refOptions}\n                placeholder=\"Select variable...\"\n              />\n              </label>\n            </div>\n          </div>\n        );\n\n      case \"graph_path\":\n// ... (truncated)", "parameters": [{"name": "{ filter, onChange, onRemove, schema, availableRefs }", "type": "{ filter: any; onChange: Function; onRemove: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["TagSelector", "label", "input"], "hookCalls": [{"name": "useState", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::SelectionFiltersEditor", "name": "SelectionFiltersEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array} props.filters - Array of filter configurations\n * @param {Function} props.onChange - Callback when filters change\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.availableRefs - Available entity references\n */\nexport function SelectionFiltersEditor({ filters, onChange, schema, availableRefs }) {\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const containerRef = useRef(null);\n\n  // Calculate dropdown position when opening (like TagSelector)\n  useLayoutEffect(() => {\n    if (showTypeMenu && containerRef.current) {\n      const rect = containerRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  const handleAddFilter = (type) => {\n    // Create with empty required fields - validation will flag them\n    const newFilter = { type };\n    // Tag filters\n    if (type === \"has_tag\") newFilter.tag = \"\";\n    if (type === \"has_tags\") newFilter.tags = [];\n    if (type === \"has_any_tag\") newFilter.tags = [];\n    if (type === \"lacks_tag\") newFilter.tag = \"\";\n    if (type === \"lacks_any_tag\") newFilter.tags = [];\n    // Attribute filters\n    if (type === \"has_culture\") newFilter.culture = \"\";\n    if (type === \"matches_culture\") newFilter.with = \"\";\n    if (type === \"has_status\") newFilter.status = \"\";\n    if (type === \"has_prominence\") newFilter.minProminence = \"\";\n    // Relationship filters\n    if (type === \"has_relationship\") newFilter.kind = \"\";\n    if (type === \"lacks_relationship\") newFilter.kind = \"\";\n    if (type === \"shares_related\") {\n      newFilter.relationshipKind = \"\";\n      newFilter.with = \"\";\n    }\n    // Other\n    if (type === \"exclude\") newFilter.entities = [];\n    if (type === \"graph_path\")\n      newFilter.assert = {\n        check: \"\",\n        path: [{ via: \"\", direction: \"\", targetKind: \"\", targetSubtype: \"\" }],\n      };\n    onChange([...(filters || []), newFilter]);\n    setShowTypeMenu(false);\n  };\n\n  const handleUpdateFilter = (index, updated) => {\n    const newFilters = [...(filters || [])];\n    newFilters[index] = updated;\n    onChange(newFilters);\n  };\n\n  const handleRemoveFilter = (index) => {\n    onChange((filters || []).filter((_, i) => i !== index));\n  };\n\n  return (\n    <div>\n      {(filters || []).length === 0 ? (\n        <div className=\"empty-state-compact\">\n          No filters defined. Filters narrow down which entities can be selected as targets.\n        </div>\n      ) : (\n        <div className=\"condition-list\">\n          {(filters || []).map((filter, index) => (\n            <SelectionFilterCard\n              key={index}\n              filter={filter}\n              onChange={(updated) => handleUpdateFilter(index, updated)}\n              onRemove={() => handleRemoveFilter(index)}\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))}\n        </div>\n      )}\n\n      <div ref={containerRef} className=\"relative mt-lg\">\n        <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n          + Add Filter\n        </button>\n\n        {showTypeMenu && (\n          <div\n            className=\"dropdown-menu sfe-dropdown-fixed\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n            style={{ '--sfe-dd-top': `${dropdownPos.top}px`, '--sfe-dd-left': `${dropdownPos.left}px`, '--sfe-dd-width': `${dropdownPos.width}px`, top: 'var(--sfe-dd-top)', left: 'var(--sfe-dd-left)', width: 'var(--sfe-dd-width)' }}\n          >\n            {Object.entries(FILTER_TYPES).map(([type, config]) => (\n              <div key={type} onClick={() => handleAddFilter(type)} className=\"dropdown-menu-item\" role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n                <span\n                  className=\"dropdown-menu-icon\"\n                  // eslint-disable-next-line local/no-inline-styles -- dynamic color per filter type\n                  style={{ '--sfe-icon-bg': `${config.color}20`, backgroundColor: 'var(--sfe-icon-bg)' }}\n                >\n                  {config.icon}\n                </span>\n                <span className=\"dropdown-menu-label\">{config.label}</span>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ filters, onChange, schema, availableRefs }", "type": "{ filters: any[]; onChange: Function; schema: any; availableRefs: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "SelectionFilterCard", "button", "span"], "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::AddRuleButton", "name": "AddRuleButton", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Function} props.onAdd - Callback when a rule type is selected\n * @param {number} props.depth - Nesting depth (limits nested rule types at depth >= 2)\n */\nexport function AddRuleButton({ onAdd, depth = 0 }) {\n  const [showPicker, setShowPicker] = useState(false);\n\n  return (\n    <div className=\"dropdown\">\n      <button className=\"btn-add\" onClick={() => setShowPicker(!showPicker)}>\n        + Add Rule\n      </button>\n\n      {showPicker && (\n        <div className=\"dropdown-menu arb-dropdown\">\n          <div className=\"dropdown-options\">\n            {Object.entries(APPLICABILITY_TYPES)\n              .filter(([type]) => depth < 2 || (type !== \"or\" && type !== \"and\"))\n              .map(([type, config]) => (\n                <div\n                  key={type}\n                  className=\"dropdown-menu-item\"\n                  onClick={() => {\n                    onAdd(type);\n                    setShowPicker(false);\n                  }}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <div\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n                    style={{ '--arb-icon-bg': `${config.color}20`, backgroundColor: 'var(--arb-icon-bg)' }}\n                  >\n                    {config.icon}\n                  </div>\n                  <div>\n                    <div className=\"dropdown-menu-label\">{config.label}</div>\n                    <div className=\"arb-desc\">\n                      {config.desc}\n                    </div>\n                  </div>\n                </div>\n              ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ onAdd, depth = 0 }", "type": "{ onAdd: Function; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["button", "div"], "hookCalls": [{"name": "useState", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::ApplicabilityRuleCard", "name": "ApplicabilityRuleCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.rule - The rule configuration\n * @param {Function} props.onChange - Callback when rule changes\n * @param {Function} props.onRemove - Callback to remove this rule\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n * @param {number} props.depth - Nesting depth for nested rules\n */\nexport function ApplicabilityRuleCard({\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}) {\n  const [expanded, setExpanded] = useState(false);\n  const typeConfig = APPLICABILITY_TYPES[rule.type] || {};\n\n  const entityKinds = schema?.entityKinds || [];\n  const entityKindOptions = entityKinds.map((ek) => ({\n    value: ek.kind,\n    label: ek.description || ek.kind,\n  }));\n\n  const relationshipKindOptions = (schema?.relationshipKinds || []).map((rk) => ({\n    value: rk.kind,\n    label: rk.description || rk.kind,\n  }));\n\n  const tagRegistry = schema?.tagRegistry || [];\n\n  const getSubtypesForKind = (kind) => {\n    const ek = entityKinds.find((e) => e.kind === kind);\n    if (!ek?.subtypes) return [];\n    return ek.subtypes.map((st) => ({ value: st.id, label: st.name || st.id }));\n  };\n\n  const pressureOptions = (pressures || []).map((p) => ({\n    value: p.id,\n    label: p.name || p.id,\n  }));\n\n  const eraOptions = (eras || []).map((e) => ({\n    value: e.id,\n    label: e.name || e.id,\n  }));\n\n  const updateField = (field, value) => {\n    onChange({ ...rule, [field]: value });\n  };\n\n  const getSummary = () => {\n    switch (rule.type) {\n      case \"entity_count\": {\n        const kindSpec = `${rule.kind || \"?\"}${rule.subtype ? \":\" + rule.subtype : \"\"}`;\n        const minPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const maxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${kindSpec} ${minPart}${maxPart}`;\n      }\n      case \"pressure\":\n        return `${rule.pressureId || \"?\"} in [${rule.min ?? \"-\\u221E\"}, ${rule.max ?? \"\\u221E\"}]`;\n      case \"pressure_any_above\":\n        return `Any of [${rule.pressureIds?.join(\", \") || \"?\"}] > ${rule.threshold ?? \"?\"}`;\n      case \"pressure_compare\":\n        return `${rule.pressureA || \"?\"} ${rule.operator || \">\"} ${rule.pressureB || \"?\"}`;\n      case \"relationship_count\": {\n        const relMinPart = rule.min !== undefined ? `>= ${rule.min}` : \"\";\n        const relMaxPart = rule.max !== undefined ? ` <= ${rule.max}` : \"\";\n        return `${rule.relationshipKind || \"any\"} count ${relMinPart}${relMaxPart}`;\n      }\n      case \"relationship_exists\": {\n        const targetSuffix = rule.targetKind ? ` to ${rule.targetKind}` : \"\";\n        return `${rule.relationshipKind || \"?\"} exists${targetSuffix}`;\n      }\n      case \"tag_exists\":\n        return `has tag \"${rule.tag || \"?\"}\"`;\n      case \"tag_absent\":\n        return `missing tag \"${rule.tag || \"?\"}\"`;\n      case \"status\":\n        return rule.not ? `status != ${rule.status || \"?\"}` : `status = ${rule.status || \"?\"}`;\n      case \"prominence\":\n        return `prominence ${rule.min || \"?\"}-${rule.max || \"?\"}`;\n      case \"time_elapsed\":\n        return `${rule.minTicks || \"?\"} ticks since ${rule.since || \"updated\"}`;\n      case \"growth_phases_complete\": {\n        const eraSuffix = rule.eraId ? ` in ${rule.eraId}` : \"\";\n        return `${rule.minPhases ?? \"?\"} growth phases${eraSuffix}`;\n      }\n      case \"era_match\":\n        return rule.eras?.length ? rule.eras.join(\", \") : \"No eras selected\";\n      case \"random_chance\":\n        return `${Math.round((rule.chance ?? 0.5) * 100)}% chance`;\n      case \"cooldown_elapsed\":\n        return `${rule.cooldownTicks ?? \"?\"} ticks since last run`;\n      case \"creations_per_epoch\":\n        return `max ${rule.maxPerEpoch ?? \"?\"} per epoch`;\n      case \"graph_path\":\n        return `graph path (${rule.assert?.check || \"exists\"})`;\n      case \"entity_exists\":\n        return `entity ${rule.entity || \"?\"} exists`;\n      case \"entity_has_relationship\":\n        return `${rule.entity || \"?\"} has ${rule.relationshipKind || \"?\"} relationship`;\n      case \"or\":\n      case \"and\":\n        return `${rule.conditions?.length || 0} sub-rules`;\n      case \"always\":\n        return \"always\";\n      default:\n        return rule.type;\n    }\n  };\n\n  const isNested = rule.type === \"or\" || rule.type === \"and\";\n\n  return (\n    <div className=\"condition-card\">\n      <div className=\"condition-card-header\">\n        <div className=\"condition-card-type\">\n          <div\n            className=\"condition-card-icon\"\n            // eslint-disable-next-line local/no-inline-styles -- dynamic color per rule type\n            style={{ '--arc-icon-bg': `${typeConfig.color || \"#3b82f6\"}20`, backgroundColor: 'var(--arc-icon-bg)' }}\n          >\n            {typeConfig.icon || \"\ud83d\udccb\"}\n          </div>\n          <div>\n            <div className=\"condition-card-label\">{typeConfig.label || rule.type}</div>\n            <div className=\"condition-card-summary\">{getSummary()}</div>\n          </div>\n        </div>\n        <div className=\"condition-card-actions\">\n          <button className=\"btn-icon\" onClick={() => setExpanded(!expanded)}>\n            {expanded ? \"^\" : \"v\"}\n          </button>\n          <button className=\"btn-icon btn-icon-danger\" onClick={onRemove}>\n            x\n          </button>\n        </div>\n      </div>\n\n      {expanded && (\n        <div className=\"mt-lg\">\n          <div className=\"form-grid\">\n            {rule.type === \"entity_count\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Entity Kind\"\n                  value={rule.kind}\n                  onChange={(v) => {\n                    updateField(\"kind\", v);\n                    if (rule.subtype) updateField(\"subtype\", undefined);\n                  }}\n                  options={entityKindOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Subtype (optional)\"\n                  value={rule.subtype || \"\"}\n                  onChange={(v) => updateField(\"subtype\", v || undefined)}\n                  options={[{ value: \"\", label: \"Any\" }, ...getSubtypesForKind(rule.kind)]}\n                  placeholder=\"Any\"\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={0}\n                    integer\n                    allowEmpty\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure\"\n                  value={rule.pressureId}\n                  onChange={(v) => updateField(\"pressureId\", v)}\n                  options={pressureOptions}\n                />\n                <div className=\"form-group\">\n                  <label className=\"label\">Min Value\n                  <NumberInput\n                    value={rule.min}\n                    onChange={(v) => updateField(\"min\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"0\"\n                  />\n                  </label>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Max Value\n                  <NumberInput\n                    value={rule.max}\n                    onChange={(v) => updateField(\"max\", v)}\n                    min={-100}\n                    max={100}\n                    integer\n                    allowEmpty\n                    placeholder=\"100\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_any_above\" && (\n              <>\n                <div className=\"grid-col-full\">\n                  <ChipSelect\n                    label=\"Pressures\"\n                    value={rule.pressureIds || []}\n                    onChange={(v) => updateField(\"pressureIds\", v)}\n                    options={pressureOptions}\n                    placeholder=\"+ Add pressure\"\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"label\">Threshold\n                  <NumberInput\n                    value={rule.threshold}\n                    onChange={(v) => updateField(\"threshold\", v ?? 0)}\n                    min={-100}\n                    max={100}\n                    integer\n                    placeholder=\"50\"\n                  />\n                  </label>\n                </div>\n              </>\n            )}\n\n            {rule.type === \"pressure_compare\" && (\n              <>\n                <ReferenceDropdown\n                  label=\"Pressure A\"\n                  value={rule.pressureA}\n                  onChange={(v) => updateField(\"pressureA\", v)}\n                  options={pressureOptions}\n                />\n                <ReferenceDropdown\n                  label=\"Operator\"\n                  value={rule.operator || \">\"}\n                  onChange={(v) => updateField(\"operator\", v)}\n                  options={[\n                    { value: \">\", label: \">\" },\n                    { value: \">=\", label: \">=\" },\n                    { value: \"<\", label: \"<\" },\n                    { value: \"<=\", label: \"<=\" },\n                    { value: \"==\", label: \"==\" },\n                    { value: \"!=\", label: \"!=\" },\n                  ]}\n                />\n                <ReferenceDropdown\n                  label=\"Pressure B\"\n                  value={rule.pressureB}\n                  onChange={(v) => updateField(\"pressureB\", v)}\n                  options={pressureOptions}\n                />\n              </>\n            )}\n\n\n            {rule.type === \"era_match\" && (\n              <div className=\"grid-col-full\">\n                <ChipSelect\n                  label=\"Eras\"\n                  value={rule.eras || []}\n                  onChange={(v) => updateField(\"eras\", v)}\n                  options={eraOptions}\n                  placeholder=\"+ Add era\"\n                />\n              </div>\n            )}\n\n            {rule.type === \"random_chance\" && (\n              <div className=\"form-group grid-col-full\">\n                <span className=\"label\">Chance (%)</span>\n                <div className=\"flex items-center gap-lg\">\n// ... (truncated)", "parameters": [{"name": "{\n  rule,\n  onChange,\n  onRemove,\n  schema,\n  pressures,\n  eras,\n  depth = 0,\n}", "type": "{ rule: any; onChange: Function; onRemove: Function; schema: any; pressures: any[]; eras: any[]; depth: number; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "button", "ReferenceDropdown", "NumberInput", "ChipSelect", "span", "input", "label", "TagSelector", "GraphPathEditor", "ApplicabilityRuleCard", "AddRuleButton"], "hookCalls": [{"name": "useState", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::ApplicabilityTab", "name": "ApplicabilityTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Array} props.eras - Available era definitions\n */\nexport function ApplicabilityTab({ generator, onChange, schema, pressures, eras }) {\n  const rules = generator.applicability || [];\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Applicability Rules</div>\n        <div className=\"section-desc\">\n          Define when this generator is eligible to run. If no rules are defined, the generator will\n          always be eligible. Multiple top-level rules are combined with AND logic.\n        </div>\n\n        {rules.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2713</div>\n            <div className=\"empty-state-title\">No applicability rules</div>\n            <div className=\"empty-state-desc\">\n              This generator will always be eligible to run. Add rules to control when it activates.\n            </div>\n          </div>\n        ) : (\n          rules.map((rule, index) => (\n            <ApplicabilityRuleCard\n              key={index}\n              rule={rule}\n              onChange={(updated) => {\n                const newRules = [...rules];\n                newRules[index] = updated;\n                onChange({ ...generator, applicability: newRules });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, applicability: rules.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              pressures={pressures}\n              eras={eras}\n            />\n          ))\n        )}\n\n        <AddRuleButton\n          onAdd={(type) => {\n            const newRule = createNewRule(type, pressures);\n            onChange({ ...generator, applicability: [...rules, newRule] });\n          }}\n        />\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema, pressures, eras }", "type": "{ generator: any; onChange: Function; schema: any; pressures: any[]; eras: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "AddRuleButton"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::OverviewTab", "name": "OverviewTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Function} props.onDelete - Callback to delete the generator\n * @param {Function} props.onDuplicate - Callback to duplicate the generator\n */\nexport function OverviewTab({ generator, onChange, onDelete, onDuplicate }) {\n  const updateField = (field, value) => {\n    onChange({ ...generator, [field]: value });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(generator.id, (value) =>\n    updateField(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(generator.name, (value) =>\n    updateField(\"name\", value)\n  );\n\n  const summary = useMemo(() => {\n    return {\n      rules: generator.applicability?.length || 0,\n      variables: Object.keys(generator.variables || {}).length,\n      creates: generator.creation?.length || 0,\n      relationships: generator.relationships?.length || 0,\n      effects: generator.stateUpdates?.length || 0,\n    };\n  }, [generator]);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Basic Information</div>\n        <div className=\"form-grid\">\n          <div className=\"form-group\">\n            <label htmlFor=\"generator-id\" className=\"label\">Generator ID</label>\n            <input id=\"generator-id\"\n              type=\"text\"\n              value={localId}\n              onChange={(e) => setLocalId(e.target.value)}\n              onBlur={handleIdBlur}\n              className=\"input\"\n            />\n          </div>\n          <div className=\"form-group\">\n            <label htmlFor=\"display-name\" className=\"label\">Display Name</label>\n            <input id=\"display-name\"\n              type=\"text\"\n              value={localName}\n              onChange={(e) => setLocalName(e.target.value)}\n              onBlur={handleNameBlur}\n              className=\"input\"\n              placeholder=\"Optional friendly name\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-xl\">\n          <label className=\"label\">Enabled\n          <EnableToggle\n            enabled={generator.enabled !== false}\n            onChange={(enabled) => updateField(\"enabled\", enabled)}\n            label={generator.enabled !== false ? \"Generator is active\" : \"Generator is disabled\"}\n          />\n          </label>\n        </div>\n\n        <div className=\"mt-xl\">\n          <span className=\"label\">Narration Template</span>\n          <div className=\"section-desc mb-md\">\n            Syntax: {\"{$target.field}\"}, {\"{$var.field}\"}, {\"{count:kind}\"}, {\"{list:created}\"},{\" \"}\n            {\"{field|fallback}\"}.\n          </div>\n          <LocalTextArea\n            value={generator.narrationTemplate || \"\"}\n            onChange={(value) => updateField(\"narrationTemplate\", value || undefined)}\n            placeholder=\"e.g., From {$target.name}, {count:npc} new souls emerged to shape the realm.\"\n            rows={2}\n          />\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <div className=\"section-title\">Summary</div>\n        <div className=\"summary-stats-grid\">\n          {[\n            { label: \"Rules\", value: summary.rules, icon: \"\u2713\" },\n            { label: \"Variables\", value: summary.variables, icon: \"\ud83d\udce6\" },\n            { label: \"Creates\", value: summary.creates, icon: \"\u2728\" },\n            { label: \"Connects\", value: summary.relationships, icon: \"\ud83d\udd17\" },\n            { label: \"Effects\", value: summary.effects, icon: \"\u26a1\" },\n          ].map((stat) => (\n            <div key={stat.label} className=\"summary-stat\">\n              <div className=\"summary-stat-icon\">{stat.icon}</div>\n              <div className=\"summary-stat-value\">{stat.value}</div>\n              <div className=\"summary-stat-label\">{stat.label}</div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"danger-zone\">\n        <button className=\"btn btn-secondary\" onClick={onDuplicate}>\n          Duplicate Generator\n        </button>\n        <button className=\"btn btn-danger\" onClick={onDelete}>\n          Delete Generator\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, onDelete, onDuplicate }", "type": "{ generator: any; onChange: Function; onDelete: Function; onDuplicate: Function; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "label", "input", "EnableToggle", "span", "LocalTextArea", "button"], "hookCalls": [{"name": "useLocalInputState", "count": 2}, {"name": "useMemo", "count": 1}], "customHookCalls": ["useLocalInputState"], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::TargetTab", "name": "TargetTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema with entity/relationship kinds\n */\nexport function TargetTab({ generator, onChange, schema }) {\n  const selection = generator.selection || { strategy: \"by_kind\" };\n\n  // Get the kind of the first created entity for saturation limit inference\n  const firstCreatedKind = (generator.creation || [])[0]?.kind;\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Target Selection</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What is $target?</div>\n          <div className=\"info-box-text\">\n            The <code className=\"inline-code\">$target</code> is the primary entity this generator\n            operates on. It&apos;s selected from the world graph based on the rules you define here. Once\n            selected, you can reference it in creation rules (e.g., inherit culture from $target)\n            and relationships (e.g., connect new entity to $target).\n          </div>\n        </div>\n\n        <SelectionRuleEditor\n          value={selection}\n          onChange={(updated) => onChange({ ...generator, selection: updated })}\n          schema={schema}\n          availableRefs={[\"$target\", ...Object.keys(generator.variables || {})]}\n        />\n\n        {/* Saturation Limits */}\n        <div className=\"mt-2xl\">\n          <span className=\"label\">Saturation Limits</span>\n          <div className=\"info-box-text mb-lg text-sm\">\n            Limit targets based on existing relationship counts. Only targets with fewer than the\n            max count of relationships will be selected.\n          </div>\n          <SaturationLimitsEditor\n            limits={selection.saturationLimits || []}\n            onChange={(limits) =>\n              onChange({\n                ...generator,\n                selection: {\n                  ...selection,\n                  saturationLimits: limits.length > 0 ? limits : undefined,\n                },\n              })\n            }\n            schema={schema}\n            createdKind={firstCreatedKind}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "code", "SelectionRuleEditor", "span", "SaturationLimitsEditor"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::VariablesTab", "name": "VariablesTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "// ============================================================================\n// VariablesTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n */\nexport function VariablesTab({ generator, onChange, schema }) {\n  const variables = generator.variables || {};\n  const [newVarName, setNewVarName] = useState(\"\");\n  const [showAddForm, setShowAddForm] = useState(false);\n\n  // Build available refs for relationship queries (target + other vars + creation refs)\n  const buildAvailableRefs = (excludeVar) => {\n    const refs = [\"$target\"];\n    Object.keys(variables).forEach((v) => {\n      if (v !== excludeVar) refs.push(v);\n    });\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  };\n\n  const handleAddVariable = () => {\n    if (!newVarName.trim()) return;\n    // Ensure the name starts with $\n    const name = newVarName.startsWith(\"$\") ? newVarName : `$${newVarName}`;\n    // Create with empty required fields - validation will flag them\n    onChange({\n      ...generator,\n      variables: {\n        ...variables,\n        [name]: { select: { from: \"graph\", kind: \"\", pickStrategy: \"\" } },\n      },\n    });\n    setNewVarName(\"\");\n    setShowAddForm(false);\n  };\n\n  const varEntries = Object.entries(variables);\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Variables</div>\n\n        <div className=\"info-box\">\n          <div className=\"info-box-title\">What are variables?</div>\n          <div className=\"info-box-text\">\n            Variables let you select additional entities from the graph to use in creation and\n            relationships. For example, you might select a{\" \"}\n            <code className=\"inline-code\">$faction</code> to make a new NPC a member of, or an{\" \"}\n            <code className=\"inline-code\">$ability</code> for them to practice. Variables are\n            selected after <code className=\"inline-code\">$target</code> is chosen.\n          </div>\n        </div>\n\n        {varEntries.length === 0 && !showAddForm ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udce6</div>\n            <div className=\"empty-state-title\">No variables defined</div>\n            <div className=\"empty-state-desc\">\n              Add variables to select additional entities for use in creation and relationships.\n            </div>\n          </div>\n        ) : (\n          varEntries.map(([name, config]) => (\n            <VariableCard\n              key={name}\n              name={name}\n              config={config}\n              onChange={(updated) =>\n                onChange({ ...generator, variables: { ...variables, [name]: updated } })\n              }\n              onRemove={() => {\n                const newVars = { ...variables };\n                delete newVars[name];\n                onChange({ ...generator, variables: newVars });\n              }}\n              schema={schema}\n              availableRefs={buildAvailableRefs(name)}\n            />\n          ))\n        )}\n\n        {showAddForm ? (\n          <div className=\"item-card add-form\">\n            <div className=\"add-form-fields\">\n              <div className=\"flex-1\">\n                <label htmlFor=\"variable-name\" className=\"label\">Variable Name</label>\n                <input id=\"variable-name\"\n                  type=\"text\"\n                  value={newVarName}\n                  onChange={(e) => setNewVarName(e.target.value.replace(/[^a-zA-Z0-9_$]/g, \"\"))}\n                  className=\"input\"\n                  placeholder=\"$myVariable\"\n                  // eslint-disable-next-line jsx-a11y/no-autofocus\n                  autoFocus\n                />\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddVariable}\n                disabled={!newVarName.trim()}\n              >\n                Add\n              </button>\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  setShowAddForm(false);\n                  setNewVarName(\"\");\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <button className=\"btn-add\" onClick={() => setShowAddForm(true)}>\n            + Add Variable\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "code", "label", "input", "button"], "hookCalls": [{"name": "useState", "count": 2}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::CreationTab", "name": "CreationTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "// ============================================================================\n// CreationTab - Main tab component\n// ============================================================================\n\n/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n * @param {Array} props.tagRegistry - Available tags\n * @param {Function} props.onAddToRegistry - Callback to add new tag to registry\n * @param {Array} props.pressures - Available pressure definitions\n */\nexport function CreationTab({\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}) {\n  const creation = generator.creation || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    creation.forEach((c) => {\n      if (c.entityRef && !refs.includes(c.entityRef)) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, creation]);\n\n  const culturesById = useMemo(() => {\n    const map = {};\n    (schema?.cultures || []).forEach((culture) => {\n      map[culture.id] = culture;\n    });\n    return map;\n  }, [schema?.cultures]);\n\n  const cultureIds = useMemo(() => Object.keys(culturesById), [culturesById]);\n\n  const handleAdd = () => {\n    const nextNum = creation.length + 1;\n    onChange({\n      ...generator,\n      creation: [\n        ...creation,\n        { entityRef: `$entity${nextNum}`, kind: \"npc\", prominence: \"marginal\" },\n      ],\n    });\n  };\n\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Entity Creation</div>\n        <div className=\"section-desc\">\n          Define entities that this generator creates. Each entity gets a reference (like{\" \"}\n          <code className=\"inline-code\">$hero</code>) that can be used in relationships.\n        </div>\n\n        {creation.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\u2728</div>\n            <div className=\"empty-state-title\">No entities created</div>\n            <div className=\"empty-state-desc\">\n              This generator only modifies existing entities. Add creation rules to spawn new\n              entities.\n            </div>\n          </div>\n        ) : (\n          creation.map((item, index) => (\n            <CreationCard\n              key={index}\n              item={item}\n              onChange={(updated) => {\n                const newCreation = [...creation];\n                newCreation[index] = updated;\n                onChange({ ...generator, creation: newCreation });\n              }}\n              onRemove={() =>\n                onChange({ ...generator, creation: creation.filter((_, i) => i !== index) })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n              culturesById={culturesById}\n              cultureIds={cultureIds}\n              generator={generator}\n              tagRegistry={tagRegistry}\n              onAddToRegistry={onAddToRegistry}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Entity Creation\n        </button>\n      </div>\n\n      <VariantsSection\n        generator={generator}\n        onChange={onChange}\n        pressures={pressures}\n        schema={schema}\n        tagRegistry={tagRegistry}\n      />\n    </div>\n  );\n}", "parameters": [{"name": "{\n  generator,\n  onChange,\n  schema,\n  tagRegistry = [],\n  onAddToRegistry,\n  pressures = [],\n}", "type": "{ generator: any; onChange: Function; schema: any; tagRegistry: any[]; onAddToRegistry: Function; pressures: any[]; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "code", "button", "VariantsSection"], "hookCalls": [{"name": "useMemo", "count": 3}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::RelationshipsTab", "name": "RelationshipsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Object} props.schema - Domain schema\n */\nexport function RelationshipsTab({ generator, onChange, schema }) {\n  const relationships = generator.relationships || [];\n  const saturationLimits = generator.selection?.saturationLimits || [];\n\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, generator.creation]);\n\n  // Find the first created entity ref for implied relationships\n  const firstCreatedRef = useMemo(() => {\n    const creation = generator.creation || [];\n    return creation.length > 0 ? creation[0].entityRef : \"$created\";\n  }, [generator.creation]);\n\n  const handleAdd = () => {\n    onChange({\n      ...generator,\n      relationships: [\n        ...relationships,\n        {\n          kind: schema?.relationshipKinds?.[0]?.kind || \"ally_of\",\n          src: availableRefs[1] || \"$entity1\",\n          dst: \"$target\",\n          strength: 0.8,\n        },\n      ],\n    });\n  };\n\n  return (\n    <div>\n      <div className=\"section\">\n        <div className=\"section-title\">Relationships</div>\n        <div className=\"section-desc\">\n          Define relationships created between entities. Use entity references like{\" \"}\n          <code className=\"inline-code\">$target</code>, created entities like{\" \"}\n          <code className=\"inline-code\">$hero</code>, or variables like{\" \"}\n          <code className=\"inline-code\">$faction</code>.\n        </div>\n\n        {/* Implied relationships from saturation limits */}\n        {saturationLimits.length > 0 && (\n          <div className=\"mb-xl\">\n            {saturationLimits.map((limit, index) => (\n              <ImpliedRelationshipCard\n                key={`implied-${index}`}\n                saturationLimit={limit}\n                schema={schema}\n                createdEntityRef={firstCreatedRef}\n              />\n            ))}\n          </div>\n        )}\n\n        {relationships.length === 0 && saturationLimits.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\">\ud83d\udd17</div>\n            <div className=\"empty-state-title\">No relationships</div>\n            <div className=\"empty-state-desc\">\n              This generator doesn&apos;t create any relationships. Add relationships to connect\n              entities.\n            </div>\n          </div>\n        ) : (\n          relationships.map((rel, index) => (\n            <RelationshipCard\n              key={index}\n              rel={rel}\n              onChange={(updated) => {\n                const newRels = [...relationships];\n                newRels[index] = updated;\n                onChange({ ...generator, relationships: newRels });\n              }}\n              onRemove={() =>\n                onChange({\n                  ...generator,\n                  relationships: relationships.filter((_, i) => i !== index),\n                })\n              }\n              schema={schema}\n              availableRefs={availableRefs}\n            />\n          ))\n        )}\n\n        <button className=\"btn-add\" onClick={handleAdd}>\n          + Add Relationship\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, schema }", "type": "{ generator: any; onChange: Function; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["div", "code", "ImpliedRelationshipCard", "button"], "hookCalls": [{"name": "useMemo", "count": 2}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/generators/index.js::EffectsTab", "name": "EffectsTab", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/generators/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object} props.generator - The generator being edited\n * @param {Function} props.onChange - Callback when generator changes\n * @param {Array} props.pressures - Available pressure definitions\n * @param {Object} props.schema - Domain schema\n */\nexport function EffectsTab({ generator, onChange, pressures, schema }) {\n  const stateUpdates = generator.stateUpdates || [];\n  const [showTypeMenu, setShowTypeMenu] = useState(false);\n  const [dropdownPos, setDropdownPos] = useState({ top: 0, left: 0, width: 0 });\n  const addButtonRef = useRef(null);\n\n  // Build available entity references from target + variables + created entities\n  const availableRefs = useMemo(() => {\n    const refs = [\"$target\"];\n    Object.keys(generator.variables || {}).forEach((v) => refs.push(v));\n    (generator.creation || []).forEach((c) => {\n      if (c.entityRef) refs.push(c.entityRef);\n    });\n    return refs;\n  }, [generator.variables, generator.creation]);\n\n  const createMutation = (type) => {\n    let newUpdate;\n    switch (type) {\n      case \"modify_pressure\":\n        newUpdate = { type: \"modify_pressure\", pressureId: pressures?.[0]?.id || \"\", delta: 0 };\n        break;\n      case \"archive_relationship\":\n        newUpdate = {\n          type: \"archive_relationship\",\n          entity: \"$target\",\n          relationshipKind: \"\",\n          direction: \"both\",\n        };\n        break;\n      case \"change_status\":\n        newUpdate = { type: \"change_status\", entity: \"$target\", newStatus: \"\" };\n        break;\n      case \"set_tag\":\n        newUpdate = { type: \"set_tag\", entity: \"$target\", tag: \"\", value: true };\n        break;\n      case \"remove_tag\":\n        newUpdate = { type: \"remove_tag\", entity: \"$target\", tag: \"\" };\n        break;\n      case \"update_rate_limit\":\n        newUpdate = { type: \"update_rate_limit\" };\n        break;\n      default:\n        return null;\n    }\n    return newUpdate;\n  };\n\n  const addMutation = (type) => {\n    const next = createMutation(type);\n    if (!next) return;\n    onChange({ ...generator, stateUpdates: [...stateUpdates, next] });\n  };\n\n  const updateMutation = (index, updated) => {\n    const newUpdates = [...stateUpdates];\n    newUpdates[index] = updated;\n    onChange({ ...generator, stateUpdates: newUpdates });\n  };\n\n  const removeMutation = (index) => {\n    onChange({ ...generator, stateUpdates: stateUpdates.filter((_, i) => i !== index) });\n  };\n\n  const knownTypes = new Set(DEFAULT_MUTATION_TYPES.map((type) => type.value));\n  const unrecognizedUpdates = stateUpdates\n    .map((update, index) => (knownTypes.has(update.type) ? null : { update, index }))\n    .filter(Boolean);\n\n  useLayoutEffect(() => {\n    if (showTypeMenu && addButtonRef.current) {\n      const rect = addButtonRef.current.getBoundingClientRect();\n      setDropdownPos({\n        top: rect.bottom + 4,\n        left: rect.left,\n        width: Math.max(rect.width, 220),\n      });\n    }\n  }, [showTypeMenu]);\n\n  useEffect(() => {\n    if (!showTypeMenu) return;\n    const handleClickOutside = (event) => {\n      if (addButtonRef.current && !addButtonRef.current.contains(event.target)) {\n        setShowTypeMenu(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [showTypeMenu]);\n\n  return (\n    <div>\n      {/* Unrecognized Effects - shown first to draw attention */}\n      {unrecognizedUpdates.length > 0 && (\n        <div className=\"section et-unrecognized-section\">\n          <div className=\"section-title et-unrecognized-title\">\n            <span>\u26a0\ufe0f</span> Unrecognized Effects\n          </div>\n          <div className=\"section-desc mb-lg\">\n            These state updates have unrecognized types and may be from an older version. Remove\n            them to clear validation errors.\n          </div>\n\n          {unrecognizedUpdates.map((entry) => {\n            const globalIdx = entry.index;\n            const update = entry.update;\n            return (\n              <div\n                key={globalIdx}\n                className=\"item-card et-unrecognized-card\"\n              >\n                <div className=\"et-unrecognized-body\">\n                  <div className=\"et-unrecognized-layout\">\n                    <div className=\"flex-1\">\n                      <div className=\"et-unrecognized-type\">\n                        Unknown type: &quot;{update.type || \"(no type)\"}&quot;\n                      </div>\n                      <pre className=\"et-unrecognized-json\">\n                        {JSON.stringify(update, null, 2)}\n                      </pre>\n                    </div>\n                    <button\n                      className=\"btn btn-danger flex-shrink-0\"\n                      onClick={() => removeMutation(globalIdx)}\n                    >\n                      Remove\n                    </button>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      <div className=\"section\">\n        <div className=\"section-title\">\u26a1 Effects ({stateUpdates.length})</div>\n        <div className=\"section-desc\">\n          Apply state updates when this generator runs. Effects use the unified mutation library.\n        </div>\n\n        {stateUpdates.map((update, index) => {\n          if (!knownTypes.has(update.type)) return null;\n          return (\n            <MutationCard\n              key={index}\n              mutation={update}\n              onChange={(updated) => updateMutation(index, updated)}\n              onRemove={() => removeMutation(index)}\n              schema={schema}\n              pressures={pressures}\n              entityOptions={availableRefs}\n              typeOptions={DEFAULT_MUTATION_TYPES}\n              createMutation={createMutation}\n            />\n          );\n        })}\n\n        <div ref={addButtonRef} className=\"relative mt-lg\">\n          <button onClick={() => setShowTypeMenu(!showTypeMenu)} className=\"btn-add-inline\">\n            + Add Effect\n          </button>\n\n          {showTypeMenu && (\n            <div\n              className=\"dropdown-menu et-dropdown-fixed\"\n              // eslint-disable-next-line local/no-inline-styles -- dynamic position from measured DOM rect\n              style={{ '--et-dd-top': `${dropdownPos.top}px`, '--et-dd-left': `${dropdownPos.left}px`, '--et-dd-width': `${dropdownPos.width}px`, top: 'var(--et-dd-top)', left: 'var(--et-dd-left)', width: 'var(--et-dd-width)' }}\n            >\n              {MUTATION_TYPE_OPTIONS.map((opt) => (\n                <div\n                  key={opt.value}\n                  onClick={() => {\n                    addMutation(opt.value);\n                    setShowTypeMenu(false);\n                  }}\n                  className=\"dropdown-menu-item\"\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  <span\n                    className=\"dropdown-menu-icon\"\n                    // eslint-disable-next-line local/no-inline-styles -- dynamic color per mutation type\n                    style={{ '--et-icon-bg': `${opt.color}20`, backgroundColor: 'var(--et-icon-bg)' }}\n                  >\n                    {opt.icon}\n                  </span>\n                  <span className=\"dropdown-menu-label\">{opt.label}</span>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generator, onChange, pressures, schema }", "type": "{ generator: any; onChange: Function; pressures: any[]; schema: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "div", "pre", "button", "MutationCard"], "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useMemo", "count": 1}, {"name": "useLayoutEffect", "count": 1}, {"name": "useEffect", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/naming-profile-viewer/index.js::NamingProfileMappingViewer", "name": "NamingProfileMappingViewer", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/naming-profile-viewer/index.js", "sourceCode": "export default function NamingProfileMappingViewer({ generators = [], schema = {} }) {\n  const [showInherited, setShowInherited] = useState(false);\n\n  const { mappings, warnings } = useMemo(\n    () => analyzeNamingMappings(generators, schema),\n    [generators, schema]\n  );\n\n  // Group by generator for display\n  const groupedMappings = useMemo(() => {\n    const groups = {};\n    for (const m of mappings) {\n      if (!groups[m.generatorId]) {\n        groups[m.generatorId] = {\n          generatorId: m.generatorId,\n          generatorName: m.generatorName,\n          items: [],\n        };\n      }\n      groups[m.generatorId].items.push(m);\n    }\n    return Object.values(groups);\n  }, [mappings]);\n\n  // Filter warnings - show all by default, but can filter to just explicit cultures\n  const displayWarnings = showInherited\n    ? warnings\n    : warnings.filter(\n        (w) => w.cultureSource === \"explicit\" || w.reason === \"No matching strategy group\"\n      );\n\n  const successCount = mappings.filter((m) => m.match).length;\n  const warningCount = warnings.filter((w) => w.reason === \"No matching strategy group\").length;\n\n  if (mappings.length === 0) {\n    return (\n      <div className=\"naming-profile-container\">\n        <div className=\"naming-profile-header\">\n          <div className=\"naming-profile-title\">\n            <span>Naming Profile Mappings</span>\n          </div>\n        </div>\n        <div className=\"naming-profile-empty-state\">\n          No generators with entity creation defined. Add generators to see naming profile mappings.\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"naming-profile-container\">\n      <div className=\"naming-profile-header\">\n        <div className=\"naming-profile-title\">\n          <span>Naming Profile Mappings</span>\n        </div>\n        <div className=\"naming-profile-stats\">\n          <div className=\"naming-profile-stat-item\">\n            <span className=\"naming-profile-stat-value text-success\">{successCount}</span>\n            <span>matched</span>\n          </div>\n          <div className=\"naming-profile-stat-item\">\n            <span\n              className={`naming-profile-stat-value ${warningCount > 0 ? \"text-danger\" : \"text-muted\"}`}\n            >\n              {warningCount}\n            </span>\n            <span>missing</span>\n          </div>\n          <label className=\"cursor-pointer flex items-center gap-xs\">\n            <input\n              type=\"checkbox\"\n              checked={showInherited}\n              onChange={(e) => setShowInherited(e.target.checked)}\n            />\n            <span>Show inherited cultures</span>\n          </label>\n        </div>\n      </div>\n\n      <div className=\"naming-profile-content\">\n        {/* Warnings section */}\n        {displayWarnings.length > 0 && (\n          <div className=\"naming-profile-section\">\n            <div className=\"naming-profile-section-title\">\n              <span className=\"naming-profile-warning-icon\">Warning</span>\n              <span>Naming May Fail ({displayWarnings.length})</span>\n            </div>\n            <div className=\"naming-profile-warning-list\">\n              {displayWarnings.slice(0, 10).map((w, i) => (\n                <div\n                  key={`${w.generatorId}-${w.cultureId}-${i}`}\n                  className=\"naming-profile-warning-item\"\n                >\n                  <span className=\"naming-profile-warning-icon\">!</span>\n                  <span>\n                    <strong>{w.generatorName}</strong> creates <strong>{w.entityKind}</strong>\n                    {w.subtype && `:${w.subtype}`} for culture <strong>{w.cultureName}</strong> -{\" \"}\n                    {w.reason}\n                  </span>\n                </div>\n              ))}\n              {displayWarnings.length > 10 && (\n                <div\n                  className=\"text-muted py-md px-lg\"\n                >\n                  ... and {displayWarnings.length - 10} more\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Mappings table */}\n        <div className=\"naming-profile-section\">\n          <div className=\"naming-profile-section-title\">\n            <span>Entity Creation to Naming Profile</span>\n          </div>\n          <table className=\"naming-profile-mapping-table\">\n            <thead>\n              <tr>\n                <th className=\"naming-profile-table-header\">Generator</th>\n                <th className=\"naming-profile-table-header\">Entity Kind</th>\n                <th className=\"naming-profile-table-header\">Culture</th>\n                <th className=\"naming-profile-table-header\">Naming Profile</th>\n              </tr>\n            </thead>\n            <tbody>\n              {groupedMappings.slice(0, 20).flatMap((group) => {\n                // Filter items based on showInherited toggle\n                const filteredItems = showInherited\n                  ? group.items\n                  : group.items.filter(\n                      (m) => m.cultureSource === \"explicit\" || m.cultureSource === \"any\"\n                    );\n                // If no explicit cultures, show first inherited one as representative\n                const displayItems =\n                  filteredItems.length > 0 ? filteredItems : group.items.slice(0, 1);\n                return displayItems.map((m, idx) => (\n                  <tr\n                    key={`${m.generatorId}-${m.cultureId}-${m.entityKind}-${idx}`}\n                    className={`naming-profile-table-row ${!m.match && m.hasNamingProfile ? \"naming-profile-warning-row\" : \"\"}`}\n                  >\n                    <td className=\"naming-profile-table-cell naming-profile-generator-cell\">\n                      {idx === 0 ? m.generatorName : \"\"}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <span className=\"naming-profile-kind-badge\">{m.entityKind}</span>\n                      {m.subtype && (\n                        <span\n                          className=\"naming-profile-kind-badge naming-profile-kind-badge-transparent\"\n                        >\n                          {m.subtype}\n                        </span>\n                      )}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <div className=\"naming-profile-culture-cell\">\n                        {/* eslint-disable-next-line local/no-inline-styles -- dynamic culture color */}\n                        <span\n                          className=\"naming-profile-culture-dot\"\n                          style={{ '--npm-culture-color': m.cultureColor, backgroundColor: 'var(--npm-culture-color)' }}\n                        />\n                        <span>{m.cultureName}</span>\n                        {m.cultureSource === \"inherited\" && (\n                          <span className=\"naming-profile-badge naming-profile-badge-inherited\">\n                            inherited\n                          </span>\n                        )}\n                      </div>\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      {m.match && (\n                        <span className=\"naming-profile-badge naming-profile-badge-match\">\n                          {m.match.profileName || m.match.profileId}\n                          {m.match.groupName && ` / ${m.match.groupName}`}\n                        </span>\n                      )}\n                      {!m.match && !m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No profiles configured\n                        </span>\n                      )}\n                      {!m.match && m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No matching group\n                        </span>\n                      )}\n                    </td>\n                  </tr>\n                ));\n              })}\n            </tbody>\n          </table>\n          {groupedMappings.length > 20 && (\n            <div className=\"text-muted text-center text-xs p-md\">\n              Showing first 20 generators. Total: {groupedMappings.length}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generators = [], schema = {} }", "type": "{ generators?: any[]; schema?: {}; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "div"], "hookCalls": [{"name": "useState", "count": 1}, {"name": "useMemo", "count": 2}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/naming-profile-viewer/NamingProfileMappingViewer.jsx::NamingProfileMappingViewer", "name": "NamingProfileMappingViewer", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/naming-profile-viewer/NamingProfileMappingViewer.jsx", "sourceCode": "export default function NamingProfileMappingViewer({ generators = [], schema = {} }) {\n  const [showInherited, setShowInherited] = useState(false);\n\n  const { mappings, warnings } = useMemo(\n    () => analyzeNamingMappings(generators, schema),\n    [generators, schema]\n  );\n\n  // Group by generator for display\n  const groupedMappings = useMemo(() => {\n    const groups = {};\n    for (const m of mappings) {\n      if (!groups[m.generatorId]) {\n        groups[m.generatorId] = {\n          generatorId: m.generatorId,\n          generatorName: m.generatorName,\n          items: [],\n        };\n      }\n      groups[m.generatorId].items.push(m);\n    }\n    return Object.values(groups);\n  }, [mappings]);\n\n  // Filter warnings - show all by default, but can filter to just explicit cultures\n  const displayWarnings = showInherited\n    ? warnings\n    : warnings.filter(\n        (w) => w.cultureSource === \"explicit\" || w.reason === \"No matching strategy group\"\n      );\n\n  const successCount = mappings.filter((m) => m.match).length;\n  const warningCount = warnings.filter((w) => w.reason === \"No matching strategy group\").length;\n\n  if (mappings.length === 0) {\n    return (\n      <div className=\"naming-profile-container\">\n        <div className=\"naming-profile-header\">\n          <div className=\"naming-profile-title\">\n            <span>Naming Profile Mappings</span>\n          </div>\n        </div>\n        <div className=\"naming-profile-empty-state\">\n          No generators with entity creation defined. Add generators to see naming profile mappings.\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"naming-profile-container\">\n      <div className=\"naming-profile-header\">\n        <div className=\"naming-profile-title\">\n          <span>Naming Profile Mappings</span>\n        </div>\n        <div className=\"naming-profile-stats\">\n          <div className=\"naming-profile-stat-item\">\n            <span className=\"naming-profile-stat-value text-success\">{successCount}</span>\n            <span>matched</span>\n          </div>\n          <div className=\"naming-profile-stat-item\">\n            <span\n              className={`naming-profile-stat-value ${warningCount > 0 ? \"text-danger\" : \"text-muted\"}`}\n            >\n              {warningCount}\n            </span>\n            <span>missing</span>\n          </div>\n          <label className=\"cursor-pointer flex items-center gap-xs\">\n            <input\n              type=\"checkbox\"\n              checked={showInherited}\n              onChange={(e) => setShowInherited(e.target.checked)}\n            />\n            <span>Show inherited cultures</span>\n          </label>\n        </div>\n      </div>\n\n      <div className=\"naming-profile-content\">\n        {/* Warnings section */}\n        {displayWarnings.length > 0 && (\n          <div className=\"naming-profile-section\">\n            <div className=\"naming-profile-section-title\">\n              <span className=\"naming-profile-warning-icon\">Warning</span>\n              <span>Naming May Fail ({displayWarnings.length})</span>\n            </div>\n            <div className=\"naming-profile-warning-list\">\n              {displayWarnings.slice(0, 10).map((w, i) => (\n                <div\n                  key={`${w.generatorId}-${w.cultureId}-${i}`}\n                  className=\"naming-profile-warning-item\"\n                >\n                  <span className=\"naming-profile-warning-icon\">!</span>\n                  <span>\n                    <strong>{w.generatorName}</strong> creates <strong>{w.entityKind}</strong>\n                    {w.subtype && `:${w.subtype}`} for culture <strong>{w.cultureName}</strong> -{\" \"}\n                    {w.reason}\n                  </span>\n                </div>\n              ))}\n              {displayWarnings.length > 10 && (\n                <div\n                  className=\"text-muted py-md px-lg\"\n                >\n                  ... and {displayWarnings.length - 10} more\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Mappings table */}\n        <div className=\"naming-profile-section\">\n          <div className=\"naming-profile-section-title\">\n            <span>Entity Creation to Naming Profile</span>\n          </div>\n          <table className=\"naming-profile-mapping-table\">\n            <thead>\n              <tr>\n                <th className=\"naming-profile-table-header\">Generator</th>\n                <th className=\"naming-profile-table-header\">Entity Kind</th>\n                <th className=\"naming-profile-table-header\">Culture</th>\n                <th className=\"naming-profile-table-header\">Naming Profile</th>\n              </tr>\n            </thead>\n            <tbody>\n              {groupedMappings.slice(0, 20).flatMap((group) => {\n                // Filter items based on showInherited toggle\n                const filteredItems = showInherited\n                  ? group.items\n                  : group.items.filter(\n                      (m) => m.cultureSource === \"explicit\" || m.cultureSource === \"any\"\n                    );\n                // If no explicit cultures, show first inherited one as representative\n                const displayItems =\n                  filteredItems.length > 0 ? filteredItems : group.items.slice(0, 1);\n                return displayItems.map((m, idx) => (\n                  <tr\n                    key={`${m.generatorId}-${m.cultureId}-${m.entityKind}-${idx}`}\n                    className={`naming-profile-table-row ${!m.match && m.hasNamingProfile ? \"naming-profile-warning-row\" : \"\"}`}\n                  >\n                    <td className=\"naming-profile-table-cell naming-profile-generator-cell\">\n                      {idx === 0 ? m.generatorName : \"\"}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <span className=\"naming-profile-kind-badge\">{m.entityKind}</span>\n                      {m.subtype && (\n                        <span\n                          className=\"naming-profile-kind-badge naming-profile-kind-badge-transparent\"\n                        >\n                          {m.subtype}\n                        </span>\n                      )}\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      <div className=\"naming-profile-culture-cell\">\n                        {/* eslint-disable-next-line local/no-inline-styles -- dynamic culture color */}\n                        <span\n                          className=\"naming-profile-culture-dot\"\n                          style={{ '--npm-culture-color': m.cultureColor, backgroundColor: 'var(--npm-culture-color)' }}\n                        />\n                        <span>{m.cultureName}</span>\n                        {m.cultureSource === \"inherited\" && (\n                          <span className=\"naming-profile-badge naming-profile-badge-inherited\">\n                            inherited\n                          </span>\n                        )}\n                      </div>\n                    </td>\n                    <td className=\"naming-profile-table-cell\">\n                      {m.match && (\n                        <span className=\"naming-profile-badge naming-profile-badge-match\">\n                          {m.match.profileName || m.match.profileId}\n                          {m.match.groupName && ` / ${m.match.groupName}`}\n                        </span>\n                      )}\n                      {!m.match && !m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No profiles configured\n                        </span>\n                      )}\n                      {!m.match && m.hasNamingProfile && (\n                        <span className=\"naming-profile-badge naming-profile-badge-missing\">\n                          No matching group\n                        </span>\n                      )}\n                    </td>\n                  </tr>\n                ));\n              })}\n            </tbody>\n          </table>\n          {groupedMappings.length > 20 && (\n            <div className=\"text-muted text-center text-xs p-md\">\n              Showing first 20 generators. Total: {groupedMappings.length}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ generators = [], schema = {} }", "type": "{ generators?: any[]; schema?: {}; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["span", "div"], "hookCalls": [{"name": "useState", "count": 1}, {"name": "useMemo", "count": 2}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useState", "useMemo"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./naming-profile-viewer.css", "specifiers": [], "category": "internal"}, {"source": "./utils", "specifiers": ["analyzeNamingMappings"], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/pressures/index.js::PressuresEditor", "name": "PressuresEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/index.js", "sourceCode": "export default function PressuresEditor({ projectId, pressures = [], onChange, schema, usageMap }) {\n  const [expandedPressure, setExpandedPressure] = useState(null);\n  const factorModalKey = buildStorageKey(projectId, \"pressures:factorModal\");\n  const restoredRef = useRef(false);\n\n  useEffect(() => {\n    restoredRef.current = false;\n  }, [factorModalKey]);\n\n  // Restore expanded pressure from storage (one-time per modal key)\n  useEffect(() => {\n    if (restoredRef.current || !factorModalKey || pressures.length === 0) return;\n\n    const stored = loadStoredValue(factorModalKey);\n    if (stored?.pressureId) {\n      const index = pressures.findIndex((pressure) => pressure.id === stored.pressureId);\n      if (index >= 0) {\n        // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted UI expansion state\n        setExpandedPressure(index);\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    }\n    restoredRef.current = true;\n  }, [factorModalKey, pressures]);\n\n  const handlePressureChange = useCallback(\n    (index, updatedPressure) => {\n      const newPressures = [...pressures];\n      newPressures[index] = updatedPressure;\n      onChange(newPressures);\n    },\n    [pressures, onChange]\n  );\n\n  const handleDeletePressure = useCallback(\n    (index) => {\n      if (confirm(`Delete \"${pressures[index].name}\"?`)) {\n        const newPressures = pressures.filter((_, i) => i !== index);\n        onChange(newPressures);\n        if (expandedPressure === index) {\n          setExpandedPressure(null);\n        }\n      }\n    },\n    [pressures, onChange, expandedPressure]\n  );\n\n  const handleAddPressure = useCallback(() => {\n    const newPressure = {\n      id: `pressure_${Date.now()}`,\n      name: \"New Pressure\",\n      initialValue: 0,\n      homeostasis: 0.05,\n      description: \"\",\n      growth: {\n        positiveFeedback: [],\n        negativeFeedback: [],\n      },\n    };\n    onChange([...pressures, newPressure]);\n    setExpandedPressure(pressures.length);\n  }, [pressures, onChange]);\n\n  if (pressures.length === 0) {\n    return (\n      <div className=\"editor-container\">\n        <div className=\"header\">\n          <h1 className=\"title\">Pressures</h1>\n          <p className=\"subtitle\">\n            Configure environmental and social pressures that drive world evolution\n          </p>\n        </div>\n        <div className=\"empty-state\">\n          <div className=\"empty-state-icon\">\ud83c\udf21\ufe0f</div>\n          <div className=\"pe-empty-title\">\n            No pressures defined\n          </div>\n          <div className=\"pe-empty-desc\">\n            Pressures respond to world state with feedback and a pull toward equilibrium, driving\n            the narrative forward.\n          </div>\n          <button\n            className=\"btn btn-primary pe-create-btn\"\n            onClick={handleAddPressure}\n          >\n            + Create First Pressure\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Pressures</h1>\n        <p className=\"subtitle\">\n          Configure environmental and social pressures that drive world evolution. Each pressure has\n          feedback factors that make it grow or shrink based on world state plus a homeostatic pull\n          toward equilibrium.\n        </p>\n      </div>\n\n      <div className=\"list-stack\">\n        {pressures.map((pressure, index) => (\n          <PressureCard\n            key={index}\n            pressure={pressure}\n            expanded={expandedPressure === index}\n            onToggle={() => setExpandedPressure(expandedPressure === index ? null : index)}\n            onChange={(updatedPressure) => handlePressureChange(index, updatedPressure)}\n            onDelete={() => handleDeletePressure(index)}\n            schema={schema}\n            usageMap={usageMap}\n            projectId={projectId}\n          />\n        ))}\n\n        <button className=\"btn btn-add\" onClick={handleAddPressure}>\n          + Add Pressure\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ projectId, pressures = [], onChange, schema, usageMap }", "type": "{ projectId: any; pressures?: any[]; onChange: any; schema: any; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["h1", "p", "div", "button"], "hookCalls": [{"name": "useState", "count": 1}, {"name": "useRef", "count": 1}, {"name": "useEffect", "count": 2}, {"name": "useCallback", "count": 3}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/pressures/PressuresEditor.jsx::PressuresEditor", "name": "PressuresEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/pressures/PressuresEditor.jsx", "sourceCode": "export default function PressuresEditor({ projectId, pressures = [], onChange, schema, usageMap }) {\n  const [expandedPressure, setExpandedPressure] = useState(null);\n  const factorModalKey = buildStorageKey(projectId, \"pressures:factorModal\");\n  const restoredRef = useRef(false);\n\n  useEffect(() => {\n    restoredRef.current = false;\n  }, [factorModalKey]);\n\n  // Restore expanded pressure from storage (one-time per modal key)\n  useEffect(() => {\n    if (restoredRef.current || !factorModalKey || pressures.length === 0) return;\n\n    const stored = loadStoredValue(factorModalKey);\n    if (stored?.pressureId) {\n      const index = pressures.findIndex((pressure) => pressure.id === stored.pressureId);\n      if (index >= 0) {\n        // eslint-disable-next-line react-hooks/set-state-in-effect -- restore persisted UI expansion state\n        setExpandedPressure(index);\n      } else {\n        clearStoredValue(factorModalKey);\n      }\n    }\n    restoredRef.current = true;\n  }, [factorModalKey, pressures]);\n\n  const handlePressureChange = useCallback(\n    (index, updatedPressure) => {\n      const newPressures = [...pressures];\n      newPressures[index] = updatedPressure;\n      onChange(newPressures);\n    },\n    [pressures, onChange]\n  );\n\n  const handleDeletePressure = useCallback(\n    (index) => {\n      if (confirm(`Delete \"${pressures[index].name}\"?`)) {\n        const newPressures = pressures.filter((_, i) => i !== index);\n        onChange(newPressures);\n        if (expandedPressure === index) {\n          setExpandedPressure(null);\n        }\n      }\n    },\n    [pressures, onChange, expandedPressure]\n  );\n\n  const handleAddPressure = useCallback(() => {\n    const newPressure = {\n      id: `pressure_${Date.now()}`,\n      name: \"New Pressure\",\n      initialValue: 0,\n      homeostasis: 0.05,\n      description: \"\",\n      growth: {\n        positiveFeedback: [],\n        negativeFeedback: [],\n      },\n    };\n    onChange([...pressures, newPressure]);\n    setExpandedPressure(pressures.length);\n  }, [pressures, onChange]);\n\n  if (pressures.length === 0) {\n    return (\n      <div className=\"editor-container\">\n        <div className=\"header\">\n          <h1 className=\"title\">Pressures</h1>\n          <p className=\"subtitle\">\n            Configure environmental and social pressures that drive world evolution\n          </p>\n        </div>\n        <div className=\"empty-state\">\n          <div className=\"empty-state-icon\">\ud83c\udf21\ufe0f</div>\n          <div className=\"pe-empty-title\">\n            No pressures defined\n          </div>\n          <div className=\"pe-empty-desc\">\n            Pressures respond to world state with feedback and a pull toward equilibrium, driving\n            the narrative forward.\n          </div>\n          <button\n            className=\"btn btn-primary pe-create-btn\"\n            onClick={handleAddPressure}\n          >\n            + Create First Pressure\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"editor-container\">\n      <div className=\"header\">\n        <h1 className=\"title\">Pressures</h1>\n        <p className=\"subtitle\">\n          Configure environmental and social pressures that drive world evolution. Each pressure has\n          feedback factors that make it grow or shrink based on world state plus a homeostatic pull\n          toward equilibrium.\n        </p>\n      </div>\n\n      <div className=\"list-stack\">\n        {pressures.map((pressure, index) => (\n          <PressureCard\n            key={index}\n            pressure={pressure}\n            expanded={expandedPressure === index}\n            onToggle={() => setExpandedPressure(expandedPressure === index ? null : index)}\n            onChange={(updatedPressure) => handlePressureChange(index, updatedPressure)}\n            onDelete={() => handleDeletePressure(index)}\n            schema={schema}\n            usageMap={usageMap}\n            projectId={projectId}\n          />\n        ))}\n\n        <button className=\"btn btn-add\" onClick={handleAddPressure}>\n          + Add Pressure\n        </button>\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{ projectId, pressures = [], onChange, schema, usageMap }", "type": "{ projectId: any; pressures?: any[]; onChange: any; schema: any; usageMap: any; }", "optional": false}], "returnType": "import(\"/home/tsonu/src/the-canonry/node_modules/.pnpm/@types+react@19.2.14/node_modules/@types/react/jsx-runtime\").JSX.Element", "jsxLeafElements": ["h1", "p", "div", "button"], "hookCalls": [{"name": "useState", "count": 1}, {"name": "useRef", "count": 1}, {"name": "useEffect", "count": 2}, {"name": "useCallback", "count": 3}], "customHookCalls": [], "imports": [{"source": "react", "specifiers": ["React", "useState", "useCallback", "useEffect", "useRef"], "category": "framework"}, {"source": "prop-types", "specifiers": ["PropTypes"], "category": "external"}, {"source": "./cards", "specifiers": ["PressureCard"], "category": "internal"}, {"source": "../../utils/persistence", "specifiers": ["buildStorageKey", "clearStoredValue", "loadStoredValue"], "category": "internal"}, {"source": "./PressuresEditor.css", "specifiers": [], "category": "internal"}]}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::ReferenceDropdown", "name": "ReferenceDropdown", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {string} props.value - Current selected value\n * @param {Function} props.onChange - Callback when selection changes\n * @param {Array<{value: string, label?: string, meta?: string}>} props.options - Array of options\n * @param {string} [props.placeholder] - Placeholder text for empty selection\n * @param {string} [props.label] - Optional label above the dropdown\n * @param {boolean} [props.searchable] - Enable searchable popover mode (default: false)\n * @param {string} [props.className] - Additional class names\n */\nexport function ReferenceDropdown({\n  value,\n  onChange,\n  options,\n  placeholder,\n  label,\n  searchable = false,\n  className = '',\n}) {\n  const generatedId = useId();\n  // Searchable mode state\n  const [isOpen, setIsOpen] = useState(false);\n  const [search, setSearch] = useState('');\n  const containerRef = useRef(null);\n\n  // Close on outside click (searchable mode)\n  useEffect(() => {\n    if (!searchable) return;\n\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, [searchable]);\n\n  // Filter options in searchable mode\n  const filteredOptions = useMemo(() => {\n    if (!searchable || !search) return options;\n    const lower = search.toLowerCase();\n    return options.filter(\n      (opt) =>\n        opt.value.toLowerCase().includes(lower) ||\n        opt.label?.toLowerCase().includes(lower)\n    );\n  }, [options, search, searchable]);\n\n  const selectedOption = options.find((opt) => opt.value === value);\n\n  // Simple mode: render a standard <select>\n  if (!searchable) {\n    return (\n      <div className={`form-group ${className}`.trim()}>\n        {label && <label htmlFor={generatedId} className=\"label\">{label}</label>}\n        <select id={generatedId}\n          className=\"select\"\n          value={value || ''}\n          onChange={(e) => onChange(e.target.value || undefined)}\n        >\n          <option value=\"\">{placeholder || 'Select...'}</option>\n          {options.map((opt) => (\n            <option key={opt.value} value={opt.value}>\n              {opt.label || opt.value}\n            </option>\n          ))}\n        </select>\n      </div>\n    );\n  }\n\n  // Searchable mode: render popover with search\n  return (\n    <div className={`form-group ${className}`.trim()}>\n      {label && <label className=\"label\">{label}</label>}\n      <div ref={containerRef} className=\"dropdown\">\n        <div\n          className=\"dropdown-trigger\"\n          onClick={() => setIsOpen(!isOpen)}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n        >\n          <span className={selectedOption ? '' : 'dropdown-trigger-placeholder'}>\n            {selectedOption?.label ||\n              selectedOption?.value ||\n              placeholder ||\n              'Select...'}\n          </span>\n          <span className=\"dropdown-arrow\">\u25bc</span>\n        </div>\n        {isOpen && (\n          <div className=\"dropdown-menu\">\n            <div className=\"dropdown-search\">\n              <input\n                type=\"text\"\n                className=\"dropdown-search-input\"\n                placeholder=\"Search...\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n                onClick={(e) => e.stopPropagation()}\n                // eslint-disable-next-line jsx-a11y/no-autofocus\n                autoFocus\n              />\n            </div>\n            <div className=\"dropdown-options\">\n              {filteredOptions.length === 0 ? (\n                <div className=\"dropdown-empty\">No options found</div>\n              ) : (\n                filteredOptions.map((opt) => (\n                  <div\n                    key={opt.value}\n                    className={`dropdown-option ${value === opt.value ? 'dropdown-option-selected' : ''}`}\n                    onClick={() => {\n                      onChange(opt.value);\n                      setIsOpen(false);\n                      setSearch('');\n                    }}\n                    role=\"button\"\n                    tabIndex={0}\n                    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                  >\n                    <span>{opt.label || opt.value}</span>\n                    {opt.meta && (\n                      <span className=\"dropdown-option-meta\">{opt.meta}</span>\n                    )}\n                  </div>\n                ))\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  value,\n  onChange,\n  options,\n  placeholder,\n  label,\n  searchable = false,\n  className = '',\n}", "type": "{ value: string; onChange: Function; options: Array<{ value: string; label?: string; meta?: string; }>; placeholder?: string; label?: string; searchable?: boolean; className?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["label", "option"], "hookCalls": [{"name": "useId", "count": 1}, {"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useEffect", "count": 1}, {"name": "useMemo", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::ChipSelect", "name": "ChipSelect", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {string[]} props.value - Array of selected values\n * @param {Function} props.onChange - Callback when selection changes\n * @param {Array<{value: string, label?: string}>} props.options - Available options\n * @param {string} [props.placeholder] - Placeholder text when empty\n * @param {string} [props.label] - Optional label above the component\n */\nexport function ChipSelect({\n  value = [],\n  onChange,\n  options,\n  placeholder = 'Add...',\n  label,\n}) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [search, setSearch] = useState('');\n  const containerRef = useRef(null);\n  const inputRef = useRef(null);\n\n  useEffect(() => {\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const availableOptions = useMemo(() => {\n    return options.filter(opt => !value.includes(opt.value));\n  }, [options, value]);\n\n  const filteredOptions = useMemo(() => {\n    if (!search) return availableOptions;\n    const lower = search.toLowerCase();\n    return availableOptions.filter(opt =>\n      opt.value.toLowerCase().includes(lower) ||\n      opt.label?.toLowerCase().includes(lower)\n    );\n  }, [availableOptions, search]);\n\n  const handleSelect = (optValue) => {\n    onChange([...value, optValue]);\n    setSearch('');\n    inputRef.current?.focus();\n  };\n\n  const handleRemove = (optValue) => {\n    onChange(value.filter(v => v !== optValue));\n  };\n\n  const getLabel = (val) => {\n    const opt = options.find(o => o.value === val);\n    return opt?.label || val;\n  };\n\n  return (\n    <div className=\"form-group\">\n      {label && <label className=\"label\">{label}</label>}\n      <div ref={containerRef} className=\"dropdown\">\n        <div\n          className=\"chip-container chip-container-input\"\n          onClick={() => {\n            setIsOpen(true);\n            inputRef.current?.focus();\n          }}\n          role=\"button\"\n          tabIndex={0}\n          onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n        >\n          {value.map(v => (\n            <span key={v} className=\"chip\">\n              {getLabel(v)}\n              <button\n                type=\"button\"\n                className=\"chip-remove\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  handleRemove(v);\n                }}\n              >\n                \u00d7\n              </button>\n            </span>\n          ))}\n          <input\n            ref={inputRef}\n            type=\"text\"\n            placeholder={value.length === 0 ? placeholder : ''}\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            onFocus={() => setIsOpen(true)}\n            className=\"chip-input\"\n          />\n        </div>\n        {isOpen && filteredOptions.length > 0 && (\n          <div className=\"dropdown-menu\">\n            {filteredOptions.map((opt) => (\n              <div\n                key={opt.value}\n                onClick={() => handleSelect(opt.value)}\n                className=\"dropdown-item\"\n                role=\"button\"\n                tabIndex={0}\n                onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n              >\n                {opt.label || opt.value}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  value = [],\n  onChange,\n  options,\n  placeholder = 'Add...',\n  label,\n}", "type": "{ value: string[]; onChange: Function; options: Array<{ value: string; label?: string; }>; placeholder?: string; label?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["label", "button", "input", "div"], "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 2}, {"name": "useEffect", "count": 1}, {"name": "useMemo", "count": 2}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::SearchableDropdown", "name": "SearchableDropdown", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Array<{id: string, name?: string}>} props.items - Items to select from\n * @param {Function} props.onSelect - Called with item ID when selected\n * @param {string} [props.placeholder] - Placeholder text for trigger\n * @param {string} [props.emptyMessage] - Message when no items available\n * @param {string} [props.noMatchMessage] - Message when search has no matches\n * @param {boolean} [props.searchable] - Whether to show search input (default true)\n * @param {string} [props.className] - Additional class names\n */\nexport function SearchableDropdown({\n  items,\n  onSelect,\n  placeholder = 'Select...',\n  emptyMessage = 'No items available',\n  noMatchMessage = 'No matches found',\n  searchable = true,\n  className = '',\n}) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [search, setSearch] = useState('');\n  const containerRef = useRef(null);\n\n  useEffect(() => {\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const filteredItems = useMemo(() => {\n    if (!search) return items;\n    const lower = search.toLowerCase();\n    return items.filter(item =>\n      item.id.toLowerCase().includes(lower) ||\n      item.name?.toLowerCase().includes(lower)\n    );\n  }, [items, search]);\n\n  const handleSelect = (item) => {\n    onSelect(item.id);\n    setIsOpen(false);\n    setSearch('');\n  };\n\n  if (items.length === 0) {\n    return (\n      <div className={`dropdown-trigger dropdown-trigger-disabled ${className}`.trim()}>\n        <span>{emptyMessage}</span>\n      </div>\n    );\n  }\n\n  return (\n    <div ref={containerRef} className={`dropdown ${className}`.trim()}>\n      <div className=\"dropdown-trigger\" onClick={() => setIsOpen(!isOpen)} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n        <span>{placeholder}</span>\n        <span className=\"dropdown-arrow\">\u25bc</span>\n      </div>\n      {isOpen && (\n        <div className=\"dropdown-menu\">\n          {searchable && (\n            <div className=\"dropdown-search\">\n              <input\n                type=\"text\"\n                className=\"dropdown-search-input\"\n                placeholder=\"Search...\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n                onClick={(e) => e.stopPropagation()}\n                // eslint-disable-next-line jsx-a11y/no-autofocus\n                autoFocus\n              />\n            </div>\n          )}\n          <div className=\"dropdown-options\">\n            {filteredItems.length === 0 ? (\n              <div className=\"dropdown-empty\">{noMatchMessage}</div>\n            ) : (\n              filteredItems.map((item) => (\n                <div\n                  key={item.id}\n                  className=\"dropdown-option\"\n                  onClick={() => handleSelect(item)}\n                  role=\"button\"\n                  tabIndex={0}\n                  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n                >\n                  {item.name || item.id}\n                </div>\n              ))\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  items,\n  onSelect,\n  placeholder = 'Select...',\n  emptyMessage = 'No items available',\n  noMatchMessage = 'No matches found',\n  searchable = true,\n  className = '',\n}", "type": "{ items: Array<{ id: string; name?: string; }>; onSelect: Function; placeholder?: string; emptyMessage?: string; noMatchMessage?: string; searchable?: boolean; className?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["span"], "hookCalls": [{"name": "useState", "count": 2}, {"name": "useRef", "count": 1}, {"name": "useEffect", "count": 1}, {"name": "useMemo", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::LevelSelector", "name": "LevelSelector", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {number|string} props.value - Current value\n * @param {Function} props.onChange - Called when value changes\n * @param {Array<{value: number|string, label: string, color: string}>} props.levels - Level definitions\n * @param {boolean} [props.showNumeric] - Show numeric input (default false, only for numeric values)\n * @param {number} [props.min] - Minimum value for numeric input (default 0)\n * @param {number} [props.max] - Maximum value for numeric input (default 10)\n * @param {number} [props.step] - Step for numeric input (default 0.1)\n * @param {string} [props.className] - Additional class names\n */\nexport function LevelSelector({\n  value,\n  onChange,\n  levels,\n  showNumeric = false,\n  min = 0,\n  max = 10,\n  step = 0.1,\n  className = '',\n}) {\n  const [hoveredLevel, setHoveredLevel] = useState(null);\n\n  // Detect if using numeric or string mode\n  const isNumeric = typeof levels[0]?.value === 'number';\n\n  // Get level index based on value\n  const getLevelIndex = (val) => {\n    if (isNumeric) {\n      for (let i = levels.length - 1; i >= 0; i--) {\n        if (val >= levels[i].value) return i;\n      }\n      return 0;\n    } else {\n      const idx = levels.findIndex(l => l.value === val);\n      return idx >= 0 ? idx : 0;\n    }\n  };\n\n  const levelIndex = getLevelIndex(value);\n  const currentLevel = levels[levelIndex];\n  const hoverLevel = hoveredLevel !== null ? levels[hoveredLevel] : null;\n\n  // Calculate partial fill for each dot (only meaningful for numeric mode)\n  const getPartialFill = (idx) => {\n    if (!isNumeric) {\n      // String mode: full fill up to and including current level\n      return idx <= levelIndex ? 1 : 0;\n    }\n    if (idx < levelIndex) return 1;\n    if (idx > levelIndex) return 0;\n    // Current level - calculate partial based on value position\n    const levelStart = levels[idx].value;\n    const levelEnd = idx < levels.length - 1 ? levels[idx + 1].value : max;\n    const progress = (value - levelStart) / (levelEnd - levelStart);\n    return Math.max(0, Math.min(1, progress));\n  };\n\n  return (\n    <div className={`level-selector ${className}`.trim()}>\n      <div className=\"level-selector-dots\">\n        {levels.map((level, idx) => {\n          const isHovered = hoveredLevel !== null && idx <= hoveredLevel;\n          const fill = getPartialFill(idx);\n          const baseColor = isHovered ? hoverLevel.color : currentLevel.color;\n\n          return (\n            <div\n              key={idx}\n              className={`level-selector-dot ${hoveredLevel === idx ? 'level-selector-dot-active' : ''}`.trim()}\n              onClick={() => onChange(level.value)}\n              onMouseEnter={() => setHoveredLevel(idx)}\n              onMouseLeave={() => setHoveredLevel(null)}\n              title={`${level.label}`}\n              role=\"button\"\n              tabIndex={0}\n              onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n            >\n              <svg className=\"level-selector-dot-fill-svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\" aria-hidden=\"true\">\n                <rect\n                  x=\"0\"\n                  y={100 - (fill * 100)}\n                  width=\"100\"\n                  height={fill * 100}\n                  fill={baseColor}\n                />\n              </svg>\n            </div>\n          );\n        })}\n      </div>\n      {showNumeric && isNumeric && (\n        <input\n          type=\"number\"\n          className=\"level-selector-input\"\n          value={value}\n          onChange={(e) => {\n            const newVal = parseFloat(e.target.value);\n            if (!isNaN(newVal)) {\n              onChange(Math.max(min, Math.min(max, newVal)));\n            }\n          }}\n          step={step}\n          min={min}\n          max={max}\n        />\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  value,\n  onChange,\n  levels,\n  showNumeric = false,\n  min = 0,\n  max = 10,\n  step = 0.1,\n  className = '',\n}", "type": "{ value: number | string; onChange: Function; levels: Array<{ value: number | string; label: string; color: string; }>; showNumeric?: boolean; min?: number; max?: number; step?: number; className?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["rect", "input"], "hookCalls": [{"name": "useState", "count": 1}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::NumberInput", "name": "NumberInput", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {number|undefined|null} props.value - The numeric value\r\n * @param {Function} props.onChange - Called with the parsed number when valid\r\n * @param {string} [props.className] - CSS class for the input\r\n * @param {number} [props.min] - Minimum value\r\n * @param {number} [props.max] - Maximum value\r\n * @param {number|string} [props.step] - Step value for increment/decrement\r\n * @param {string} [props.placeholder] - Placeholder text\r\n * @param {boolean} [props.allowEmpty] - If true, empty string calls onChange(undefined)\r\n * @param {boolean} [props.integer] - If true, only allow integers\r\n * @param {boolean} [props.disabled] - Disable the input\r\n */\r\nexport function NumberInput({\r\n  value,\r\n  onChange,\r\n  className = 'input',\r\n  min,\r\n  max,\r\n  step: _step,\r\n  placeholder,\r\n  allowEmpty = false,\r\n  integer = false,\r\n  disabled = false,\r\n  ...rest\n}) {\n  const externalDisplayValue = formatValue(value);\n  // Internal string state for editing\n  const [localValue, setLocalValue] = useState(() => externalDisplayValue);\n  // Track focus in state so render can safely choose draft vs external value\n  const [isFocused, setIsFocused] = useState(false);\n\r\n  const parseValue = useCallback((str) => {\r\n    if (str === '' || str === '-' || str === '.' || str === '-.') {\r\n      return null; // Intermediate state, not a valid number yet\r\n    }\r\n    const parsed = integer ? parseInt(str, 10) : parseFloat(str);\r\n    if (isNaN(parsed)) return null;\r\n    return parsed;\r\n  }, [integer]);\r\n\r\n  const handleFocus = useCallback(() => {\n    setLocalValue(externalDisplayValue);\n    setIsFocused(true);\n  }, [externalDisplayValue]);\n\r\n  const handleChange = useCallback((e) => {\r\n    const newValue = e.target.value;\r\n\r\n    // Allow empty, minus sign, decimal point, or any numeric pattern\r\n    // This regex allows intermediate states like \"-\", \".\", \"-.\", \"1.\", \"-1.\"\r\n    /* eslint-disable sonarjs/slow-regex -- short user input (single number field value) */\r\n    const validPattern = integer\r\n      ? /^-?\\d*$/  // Integer: optional minus, digits only\r\n      : /^-?\\d*\\.?\\d*$/; // Float: optional minus, digits, optional decimal, more digits\r\n    /* eslint-enable sonarjs/slow-regex */\r\n\r\n    if (!validPattern.test(newValue)) {\r\n      return; // Reject invalid characters\r\n    }\r\n\r\n    setLocalValue(newValue);\r\n\r\n    // Try to parse and update parent if it's a complete valid number\r\n    const parsed = parseValue(newValue);\r\n    if (parsed !== null) {\r\n      // Apply min/max constraints\r\n      let constrained = parsed;\r\n      if (min !== undefined && constrained < min) constrained = min;\r\n      if (max !== undefined && constrained > max) constrained = max;\r\n      onChange(constrained);\r\n    } else if (allowEmpty && newValue === '') {\r\n      onChange(undefined);\r\n    }\r\n  }, [onChange, min, max, allowEmpty, integer, parseValue]);\r\n\r\n  const handleBlur = useCallback(() => {\n    setIsFocused(false);\n\n    // On blur, ensure the display value matches the actual value\n    const parsed = parseValue(localValue);\n    if (parsed !== null) {\r\n      // Apply constraints and update\r\n      let constrained = parsed;\r\n      if (min !== undefined && constrained < min) constrained = min;\r\n      if (max !== undefined && constrained > max) constrained = max;\r\n      setLocalValue(formatValue(constrained));\r\n      onChange(constrained);\r\n    } else if (allowEmpty && localValue === '') {\r\n      onChange(undefined);\r\n    } else {\r\n      // Revert to the parent's value if local is invalid\r\n      setLocalValue(externalDisplayValue);\n    }\n  }, [allowEmpty, externalDisplayValue, localValue, max, min, onChange, parseValue]);\n\r\n  return (\r\n    <input\r\n      type=\"text\"\r\n      inputMode=\"numeric\"\r\n      value={isFocused ? localValue : externalDisplayValue}\n      onChange={handleChange}\r\n      onFocus={handleFocus}\r\n      onBlur={handleBlur}\r\n      className={className}\r\n      placeholder={placeholder}\r\n      disabled={disabled}\r\n      {...rest}\r\n    />\r\n  );\r\n}", "parameters": [{"name": "{\r\n  value,\r\n  onChange,\r\n  className = 'input',\r\n  min,\r\n  max,\r\n  step: _step,\r\n  placeholder,\r\n  allowEmpty = false,\r\n  integer = false,\r\n  disabled = false,\r\n  ...rest\n}", "type": "{ value: number | undefined | null; onChange: Function; className?: string; min?: number; max?: number; step?: number | string; placeholder?: string; allowEmpty?: boolean; integer?: boolean; disabled?: boolean; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["input"], "hookCalls": [{"name": "useState", "count": 2}, {"name": "useCallback", "count": 4}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::LocalTextArea", "name": "LocalTextArea", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "export function LocalTextArea({\r\n  value,\r\n  onChange,\r\n  className = 'textarea',\n  placeholder,\n  rows,\n  ...rest\n}) {\n  const externalValue = value || '';\n  const [localValue, setLocalValue] = useState(externalValue);\n  // Track focus in state so render can safely choose between local draft vs external value\n  const [isFocused, setIsFocused] = useState(false);\n\n  const handleFocus = useCallback(() => {\n    setLocalValue(externalValue);\n    setIsFocused(true);\n  }, [externalValue]);\n\n  // Call onChange on blur if value changed\n  const handleBlur = useCallback(() => {\n    setIsFocused(false);\n    if (localValue !== externalValue) {\n      onChange(localValue);\n    }\n  }, [externalValue, localValue, onChange]);\n\n  return (\n    <textarea\n      value={isFocused ? localValue : externalValue}\n      onChange={(e) => setLocalValue(e.target.value)}\r\n      onFocus={handleFocus}\r\n      onBlur={handleBlur}\r\n      className={className}\n      placeholder={placeholder}\n      rows={rows}\n      {...rest}\n    />\n  );\n}", "parameters": [{"name": "{\r\n  value,\r\n  onChange,\r\n  className = 'textarea',\n  placeholder,\n  rows,\n  ...rest\n}", "type": "{ [x: string]: any; value: any; onChange: any; className?: string; placeholder: any; rows: any; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["textarea"], "hookCalls": [{"name": "useState", "count": 2}, {"name": "useCallback", "count": 2}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::EnableToggle", "name": "EnableToggle", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {boolean} props.enabled - Current toggle state\n * @param {Function} props.onChange - Callback when toggle changes (receives new value)\n * @param {Function} [props.onClick] - Optional raw click handler (receives event, takes priority)\n * @param {string} [props.label] - Optional label beside the toggle\n * @param {string} [props.className] - Optional additional class names\n */\nexport function EnableToggle({ enabled, onChange, onClick, label, className = '' }) {\n  const handleClick = (e) => {\n    if (onClick) {\n      onClick(e);\n    } else if (onChange) {\n      onChange(!enabled);\n    }\n  };\n\n  return (\n    <div className={`flex items-center gap-lg ${className}`.trim()}>\n      <div\n        onClick={handleClick}\n        className={`toggle ${enabled ? 'toggle-on' : ''}`}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleClick(e); }}\n      >\n        <div className=\"toggle-knob\" />\n      </div>\n      {label && (\n        <span className=\"text-md text-muted\">{label}</span>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{ enabled, onChange, onClick, label, className = '' }", "type": "{ enabled: boolean; onChange: Function; onClick?: Function; label?: string; className?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["div", "span"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::IconButton", "name": "IconButton", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {string} props.icon - Icon content (emoji or text)\r\n * @param {Function} props.onClick - Callback when button is clicked\r\n * @param {boolean} [props.danger] - Apply danger styling\r\n * @param {string} [props.title] - Tooltip text\r\n * @param {string} [props.className] - Optional additional class names\r\n */\r\nexport function IconButton({ icon, onClick, danger, title, className = '' }) {\r\n  const classes = [\r\n    'btn-icon',\r\n    danger ? 'btn-icon-danger' : '',\r\n    className,\r\n  ].filter(Boolean).join(' ');\r\n\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      className={classes}\r\n      onClick={onClick}\r\n      title={title}\r\n    >\r\n      {icon}\r\n    </button>\r\n  );\r\n}", "parameters": [{"name": "{ icon, onClick, danger, title, className = '' }", "type": "{ icon: string; onClick: Function; danger?: boolean; title?: string; className?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["button"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::InfoBox", "name": "InfoBox", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {string} [props.title] - Optional title for the info box\r\n * @param {React.ReactNode} props.children - Content of the info box\r\n * @param {string} [props.className] - Optional additional class names\r\n */\r\nexport function InfoBox({ title, children, className = '' }) {\r\n  return (\r\n    <div className={`info-box ${className}`.trim()}>\r\n      {title && <div className=\"info-box-title\">{title}</div>}\r\n      <div className=\"info-box-text\">{children}</div>\r\n    </div>\r\n  );\r\n}", "parameters": [{"name": "{ title, children, className = '' }", "type": "{ title?: string; children: React.ReactNode; className?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["div"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::SectionHeader", "name": "SectionHeader", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {string} props.title - Section title\r\n * @param {string} [props.description] - Optional description text\r\n * @param {string} [props.icon] - Optional emoji icon\r\n * @param {string} [props.count] - Optional count badge text (e.g. \"3 active / 5 total\")\r\n * @param {React.ReactNode} [props.actions] - Optional action buttons on the right\r\n * @param {string} [props.className] - Optional additional class names\r\n */\r\nexport function SectionHeader({\r\n  title,\r\n  description,\r\n  icon,\r\n  count,\r\n  actions,\r\n  className = '',\r\n}) {\r\n  return (\r\n    <>\r\n      <div className={`flex-between mb-lg ${className}`.trim()}>\r\n        <div className=\"section-title mb-0\">\r\n          {icon && <span className=\"section-title-icon\">{icon}</span>}\r\n          {title}\r\n          {count && <span className=\"badge-count\">{count}</span>}\r\n        </div>\r\n        {actions}\r\n      </div>\r\n      {description && <div className=\"section-desc\">{description}</div>}\r\n    </>\r\n  );\r\n}", "parameters": [{"name": "{\r\n  title,\r\n  description,\r\n  icon,\r\n  count,\r\n  actions,\r\n  className = '',\r\n}", "type": "{ title: string; description?: string; icon?: string; count?: string; actions?: React.ReactNode; className?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["span", "div"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::EmptyState", "name": "EmptyState", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {string} [props.icon] - Emoji icon to display\r\n * @param {string} props.title - Title text\r\n * @param {string} [props.description] - Description text\r\n * @param {React.ReactNode} [props.children] - Additional content (e.g., action button)\r\n * @param {string} [props.className] - Optional additional class names\r\n */\r\nexport function EmptyState({ icon, title, description, children, className = '' }) {\r\n  return (\r\n    <div className={`empty-state ${className}`.trim()}>\r\n      {icon && <div className=\"empty-state-icon\">{icon}</div>}\r\n      <div className=\"empty-state-title\">{title}</div>\r\n      {description && <div className=\"empty-state-desc\">{description}</div>}\r\n      {children}\r\n    </div>\r\n  );\r\n}", "parameters": [{"name": "{ icon, title, description, children, className = '' }", "type": "{ icon?: string; title: string; description?: string; children?: React.ReactNode; className?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["div"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::CategorySection", "name": "CategorySection", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {string} [props.id] - Optional category identifier\n * @param {string} props.icon - Emoji icon for the category\n * @param {string} props.label - Category label\n * @param {Array} props.items - Items in this category\n * @param {boolean} props.expanded - Whether the section is expanded\n * @param {Function} props.onToggleExpand - Callback to toggle expansion\n * @param {boolean} props.allEnabled - Whether all items are enabled\n * @param {Function} props.onToggleAll - Callback to toggle all items\n * @param {Function} props.renderItem - Render function for each item\n * @param {string} [props.gridClassName] - Custom grid class name\n * @param {string} [props.className] - Additional class names\n */\nexport function CategorySection({\n  id: _id,\n  icon,\n  label,\n  items,\n  expanded,\n  onToggleExpand,\n  allEnabled,\n  onToggleAll,\n  renderItem,\n  gridClassName = 'list-grid',\n  className = '',\n}) {\n  return (\n    <div className={`category-section ${className}`.trim()}>\n      <div className=\"category-header\" onClick={onToggleExpand} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onToggleExpand(e); }} >\n        <span className={`category-expand ${expanded ? 'category-expand-open' : ''}`}>\n          &gt;\n        </span>\n        <span className=\"category-icon\">{icon}</span>\n        <span className=\"category-title\">{label}</span>\n        <span className=\"badge-count\">{items.length}</span>\n        <button\n          className={`btn-toggle-category ${allEnabled ? 'btn-toggle-category-active' : ''}`}\n          onClick={(e) => {\n            e.stopPropagation();\n            onToggleAll();\n          }}\n        >\n          {allEnabled ? 'All On' : 'All Off'}\n        </button>\n      </div>\n      {expanded && (\n        <div className={gridClassName}>\n          {items.map(renderItem)}\n        </div>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  id: _id,\n  icon,\n  label,\n  items,\n  expanded,\n  onToggleExpand,\n  allEnabled,\n  onToggleAll,\n  renderItem,\n  gridClassName = 'list-grid',\n  className = '',\n}", "type": "{ id?: string; icon: string; label: string; items: any[]; expanded: boolean; onToggleExpand: Function; allEnabled: boolean; onToggleAll: Function; renderItem: Function; gridClassName?: string; className?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["span", "button", "div"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::AddCard", "name": "AddCard", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Function} props.onClick - Callback when card is clicked\n * @param {string} props.label - Button label (default \"Add Item\")\n * @param {string} props.className - Optional CSS class name\n */\nexport function AddCard({ onClick, label = 'Add Item', className = '' }) {\n  return (\n    <div\n      className={`add-card ${className}`.trim()}\n      onClick={onClick}\n      role=\"button\"\n      tabIndex={0}\n      onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") onClick(e); }}\n    >\n      <span className=\"add-card-icon\">+</span>\n      <span>{label}</span>\n    </div>\n  );\n}", "parameters": [{"name": "{ onClick, label = 'Add Item', className = '' }", "type": "{ onClick: Function; label: string; className: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["span"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::AddItemButton", "name": "AddItemButton", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {Function} props.onClick - Callback when button is clicked\r\n * @param {string} props.label - Button label text (default \"Add Item\")\r\n * @param {string} props.className - Optional CSS class name\r\n */\r\nexport function AddItemButton({ onClick, label = 'Add Item', className = '' }) {\r\n  return (\r\n    <button\r\n      className={`btn-add ${className}`.trim()}\r\n      onClick={onClick}\r\n    >\r\n      + {label}\r\n    </button>\r\n  );\r\n}", "parameters": [{"name": "{ onClick, label = 'Add Item', className = '' }", "type": "{ onClick: Function; label: string; className: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["button"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::ModalShell", "name": "ModalShell", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Function} props.onClose - Called when overlay or close button is clicked\n * @param {string} props.icon - Icon to show in header\n * @param {string} props.title - Modal title\n * @param {boolean} [props.disabled] - Whether to show disabled badge\n * @param {Array<{id: string, icon: string, label: string}>} [props.tabs] - Tab definitions (optional)\n * @param {string} [props.activeTab] - Currently active tab ID\n * @param {Function} [props.onTabChange] - Called when tab changes\n * @param {Function} [props.renderTabBadge] - Optional function to render badge for each tab: (tabId) => ReactNode\n * @param {React.ReactNode} [props.sidebarFooter] - Optional content to render at bottom of sidebar\n * @param {React.ReactNode} props.children - Modal content (tab content if tabs provided, otherwise full body)\n * @param {string} [props.className] - Additional class for modal container\n * @param {boolean} [props.preventOverlayClose] - Disable overlay click and Escape key close\n * @param {React.ReactNode} [props.footer] - Optional footer content\n */\nexport function ModalShell({\n  onClose,\n  icon,\n  title,\n  disabled,\n  tabs,\n  activeTab,\n  onTabChange,\n  renderTabBadge,\n  sidebarFooter,\n  children,\n  className = '',\n  preventOverlayClose = false,\n  footer,\n}) {\n  const hasTabs = tabs && tabs.length > 0;\n  const mouseDownOnOverlay = useRef(false);\n\n  // Escape key handler\n  const handleKeyDown = useCallback((e) => {\n    if (e.key === 'Escape' && !preventOverlayClose) {\n      onClose();\n    }\n  }, [onClose, preventOverlayClose]);\n\n  useEffect(() => {\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [handleKeyDown]);\n\n  // Body scroll lock\n  useEffect(() => {\n    const prev = document.body.style.overflow;\n    document.body.style.overflow = 'hidden';\n    return () => { document.body.style.overflow = prev; };\n  }, []);\n\n  const handleOverlayMouseDown = (e) => {\n    mouseDownOnOverlay.current = e.target === e.currentTarget;\n  };\n\n  const handleOverlayClick = (e) => {\n    if (!preventOverlayClose && mouseDownOnOverlay.current && e.target === e.currentTarget) {\n      onClose();\n    }\n  };\n\n  return (\n    <div className=\"modal-overlay\" onMouseDown={handleOverlayMouseDown} onClick={handleOverlayClick} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }} >\n      <div className={`modal ${className}`.trim()} onClick={(e) => e.stopPropagation()} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >\n        <div className=\"modal-header\">\n          <div className=\"modal-title\">\n            {icon && <span className=\"modal-title-icon\">{icon}</span>}\n            <span>{title}</span>\n            {disabled && <span className=\"badge badge-orphan\">Disabled</span>}\n          </div>\n          <button className=\"btn-close\" onClick={onClose}>\u00d7</button>\n        </div>\n        <div className=\"modal-body\">\n          {hasTabs ? (\n            <>\n              <div className=\"modal-sidebar\">\n                {tabs.map((tab) => (\n                  <button\n                    key={tab.id}\n                    className={`btn-tab ${activeTab === tab.id ? 'btn-tab-active' : ''}`}\n                    onClick={() => onTabChange?.(tab.id)}\n                  >\n                    <span className=\"btn-tab-icon\">{tab.icon}</span>\n                    <span>{tab.label}</span>\n                    {renderTabBadge?.(tab.id)}\n                  </button>\n                ))}\n                {sidebarFooter}\n              </div>\n              <div className=\"modal-content\">{children}</div>\n            </>\n          ) : (\n            children\n          )}\n        </div>\n        {footer && <div className=\"modal-footer\">{footer}</div>}\n      </div>\n    </div>\n  );\n}", "parameters": [{"name": "{\n  onClose,\n  icon,\n  title,\n  disabled,\n  tabs,\n  activeTab,\n  onTabChange,\n  renderTabBadge,\n  sidebarFooter,\n  children,\n  className = '',\n  preventOverlayClose = false,\n  footer,\n}", "type": "{ onClose: Function; icon: string; title: string; disabled?: boolean; tabs?: Array<{ id: string; icon: string; label: string; }>; activeTab?: string; onTabChange?: Function; renderTabBadge?: Function; sidebarFooter?: React.ReactNode; children: React.ReactNode; className?: string; preventOverlayClose?: boolean; footer?: React.ReactNode; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["span", "button", "div"], "hookCalls": [{"name": "useRef", "count": 1}, {"name": "useCallback", "count": 1}, {"name": "useEffect", "count": 2}], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::ItemRow", "name": "ItemRow", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {string} props.name - Display name\r\n * @param {boolean} [props.muted] - Apply muted styling to name\r\n * @param {Function} [props.onRemove] - Called when remove button clicked\r\n * @param {string} [props.removeTitle] - Tooltip for remove button\r\n * @param {React.ReactNode} props.children - Controls to render between name and remove\r\n * @param {string} [props.className] - Additional class names\r\n */\r\nexport function ItemRow({\r\n  name,\r\n  muted,\r\n  onRemove,\r\n  removeTitle = 'Remove',\r\n  children,\r\n  className = '',\r\n}) {\r\n  return (\r\n    <div className={`item-row ${className}`.trim()}>\r\n      <span className={`item-row-name ${muted ? 'item-row-name-muted' : ''}`}>\r\n        {name}\r\n      </span>\r\n      {children}\r\n      {onRemove && (\r\n        <button\r\n          className=\"item-row-remove\"\r\n          onClick={onRemove}\r\n          title={removeTitle}\r\n        >\r\n          \u00d7\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n}", "parameters": [{"name": "{\r\n  name,\r\n  muted,\r\n  onRemove,\r\n  removeTitle = 'Remove',\r\n  children,\r\n  className = '',\r\n}", "type": "{ name: string; muted?: boolean; onRemove?: Function; removeTitle?: string; children: React.ReactNode; className?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["span", "button"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::PressureChangesEditor", "name": "PressureChangesEditor", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\n * @param {Object} props\n * @param {Object<string, number>} props.value - Map of pressure ID to delta value\n * @param {Function} props.onChange - Called when values change\n * @param {Array<{id: string, name?: string}>} props.pressures - Available pressure definitions\n * @param {string} [props.label] - Optional custom label (default: \"Pressure Changes\")\n * @param {string} [props.className] - Additional class names\n */\nexport function PressureChangesEditor({\n  value = {},\n  onChange,\n  pressures,\n  label = 'Pressure Changes',\n  className = '',\n}) {\n  const entries = Object.entries(value);\n\n  const addPressure = (pressureId) => {\n    if (pressureId && !(pressureId in value)) {\n      onChange({ ...value, [pressureId]: 0 });\n    }\n  };\n\n  const updateDelta = (pressureId, delta) => {\n    onChange({ ...value, [pressureId]: parseInt(delta) || 0 });\n  };\n\n  const removePressure = (pressureId) => {\n    const newValue = { ...value };\n    delete newValue[pressureId];\n    onChange(newValue);\n  };\n\n  const availablePressures = (pressures || []).filter((p) => !(p.id in value));\n\n  return (\n    <div className={`form-group mb-xl ${className}`.trim()}>\n      <label className=\"label\">{label}</label>\n      <div className=\"flex flex-col gap-md\">\n        {entries.map(([pressureId, delta]) => (\n          <div key={pressureId} className=\"item-row\">\n            <span className=\"item-row-name\">{pressureId}</span>\n            <input\n              type=\"number\"\n              className=\"input pressure-changes-delta-input\"\n              value={delta}\n              onChange={(e) => updateDelta(pressureId, e.target.value)}\n            />\n            <button\n              className=\"btn-icon btn-icon-danger\"\n              onClick={() => removePressure(pressureId)}\n            >\n              \u00d7\n            </button>\n          </div>\n        ))}\n      </div>\n      {availablePressures.length > 0 && (\n        <select\n          className=\"select mt-md pressure-changes-add-select\"\n          value=\"\"\n          onChange={(e) => addPressure(e.target.value)}\n        >\n          <option value=\"\">+ Add pressure change...</option>\n          {availablePressures.map((p) => (\n            <option key={p.id} value={p.id}>\n              {p.name || p.id}\n            </option>\n          ))}\n        </select>\n      )}\n    </div>\n  );\n}", "parameters": [{"name": "{\n  value = {},\n  onChange,\n  pressures,\n  label = 'Pressure Changes',\n  className = '',\n}", "type": "{ value: {    [x: string]: number;}; onChange: Function; pressures: Array<{ id: string; name?: string; }>; label?: string; className?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["label", "span", "input", "button", "option"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::ErrorBadge", "name": "ErrorBadge", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * Badge for showing error counts\r\n * @param {Object} props\r\n * @param {number} props.count - Number of errors\r\n * @param {string} [props.className] - Additional class names\r\n */\r\nexport function ErrorBadge({ count, className = '' }) {\r\n  if (!count) return null;\r\n  return (\r\n    <span className={`badge badge-validation badge-error ${className}`.trim()}>\r\n      {count} error{count !== 1 ? 's' : ''}\r\n    </span>\r\n  );\r\n}", "parameters": [{"name": "{ count, className = '' }", "type": "{ count: number; className?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["span"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::OrphanBadge", "name": "OrphanBadge", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * Badge for showing orphan status (not in any era)\r\n * @param {Object} props\r\n * @param {boolean} props.isOrphan - Whether the item is orphaned\r\n * @param {string} [props.className] - Additional class names\r\n */\r\nexport function OrphanBadge({ isOrphan, className = '' }) {\r\n  if (!isOrphan) return null;\r\n  return (\r\n    <span className={`badge badge-validation badge-orphan ${className}`.trim()}>\r\n      Not in any era\r\n    </span>\r\n  );\r\n}", "parameters": [{"name": "{ isOrphan, className = '' }", "type": "{ isOrphan: boolean; className?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["span"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::TabValidationBadge", "name": "TabValidationBadge", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * Badge for showing validation count in tabs\r\n * @param {Object} props\r\n * @param {number} props.count - Number of validation issues\r\n * @param {string} [props.className] - Additional class names\r\n */\r\nexport function TabValidationBadge({ count, className = '' }) {\r\n  if (!count) return null;\r\n  return (\r\n    <span className={`badge badge-validation badge-error ${className}`.trim()}>\r\n      {count}\r\n    </span>\r\n  );\r\n}", "parameters": [{"name": "{ count, className = '' }", "type": "{ count: number; className?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["span"], "hookCalls": [], "customHookCalls": [], "imports": []}, {"id": "apps/coherence-engine/webui/src/components/shared/index.js::EraBadges", "name": "EraBadges", "kind": "component", "filePath": "apps/coherence-engine/webui/src/components/shared/index.js", "sourceCode": "/**\r\n * @param {Object} props\r\n * @param {Array} props.eras - Array of era objects with id and name\r\n * @param {number} props.maxVisible - Maximum number of badges to show (default 3)\r\n * @param {string} [props.className] - Additional class names\r\n */\r\nexport function EraBadges({ eras = [], maxVisible = 3, className = '' }) {\n  if (!eras.length) return null;\r\n\r\n  const visible = eras.slice(0, maxVisible);\r\n  const remaining = eras.length - maxVisible;\r\n\r\n  return (\r\n    <div className={`chip-container mt-md ${className}`.trim()}>\r\n      {visible.map((era) => (\r\n        <span key={era.id} className=\"badge badge-era\">\n          <span className=\"badge-era-icon\">{ERA_ICON}</span> {era.name || era.id}\n        </span>\n      ))}\n      {remaining > 0 && (\n        <span className=\"badge badge-era badge-era-remaining\">\n          +{remaining} more\n        </span>\n      )}\n    </div>\r\n  );\r\n}", "parameters": [{"name": "{ eras = [], maxVisible = 3, className = '' }", "type": "{ eras: any[]; maxVisible: number; className?: string; }", "optional": false}], "returnType": "any", "jsxLeafElements": ["span"], "hookCalls": [], "customHookCalls": [], "imports": []}]