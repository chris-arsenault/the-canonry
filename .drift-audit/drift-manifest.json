{
  "generated": "2026-02-25T13:00:00Z",
  "project_root": "/home/tsonu/src/the-canonry",
  "project_name": "penguin-tales",
  "summary": {
    "total_drift_areas": 7,
    "total_files_affected": 810,
    "high_impact": 2,
    "medium_impact": 4,
    "low_impact": 1
  },
  "areas": [
    {
      "id": "dependency-generation-split",
      "name": "Dependency Generation Split",
      "description": "React 19.0/Vite 6.4/TS 5.7 vs React 19.2/Vite 7.2/TS 5.9 split between archivist+chronicler and all other apps",
      "impact": "HIGH",
      "total_files": 810,
      "variants": [
        {
          "name": "established-stack",
          "description": "React 19.0.0, Vite 6.4.1, @vitejs/plugin-react 4.5.0, @module-federation/vite 1.1.0",
          "file_count": 7,
          "files": [
            "apps/lore-weave/webui/package.json",
            "apps/illuminator/webui/package.json",
            "apps/canonry/webui/package.json",
            "apps/coherence-engine/webui/package.json",
            "apps/cosmographer/webui/package.json",
            "apps/name-forge/webui/package.json",
            "apps/viewer/webui/package.json"
          ],
          "sample_file": "apps/illuminator/webui/package.json"
        },
        {
          "name": "next-gen-stack",
          "description": "React 19.2.0, Vite 7.2.4, @vitejs/plugin-react 5.1.1, @module-federation/vite 1.3.1, TS ~5.9.3",
          "file_count": 2,
          "files": [
            "apps/archivist/webui/package.json",
            "apps/chronicler/webui/package.json"
          ],
          "sample_file": "apps/archivist/webui/package.json"
        }
      ],
      "analysis": "Archivist and chronicler were created more recently with newer dependencies. In an MFE architecture with shared React singletons, version mismatches create risk of subtle runtime incompatibilities. The Vite major version split means different plugin APIs and build behavior.",
      "recommendation": "Upgrade all apps to archivist/chronicler versions (React 19.2, Vite 7, TS 5.9). This is more work upfront but avoids maintaining two dependency generations and a second migration later.",
      "status": "pending"
    },
    {
      "id": "module-federation-build-config",
      "name": "Module Federation & Build Config Divergence",
      "description": "Vite config format (.js vs .ts), MF plugin versions, minify strategy, and port numbering differ between the two app generations",
      "impact": "HIGH",
      "total_files": 9,
      "variants": [
        {
          "name": "vite6-mfe-config",
          "description": "JavaScript vite.config.js, @module-federation/vite ^1.1.0, minify: false, ports 5000-5006",
          "file_count": 7,
          "files": [
            "apps/illuminator/webui/vite.config.js",
            "apps/coherence-engine/webui/vite.config.js",
            "apps/canonry/webui/vite.config.js",
            "apps/name-forge/webui/vite.config.js",
            "apps/cosmographer/webui/vite.config.js",
            "apps/lore-weave/webui/vite.config.js",
            "apps/viewer/webui/vite.config.js"
          ],
          "sample_file": "apps/illuminator/webui/vite.config.js"
        },
        {
          "name": "vite7-mfe-config",
          "description": "TypeScript vite.config.ts, @module-federation/vite ^1.3.1, minify: true, explicit path aliases for @penguin-tales/* packages",
          "file_count": 2,
          "files": [
            "apps/archivist/webui/vite.config.ts",
            "apps/chronicler/webui/vite.config.ts"
          ],
          "sample_file": "apps/archivist/webui/vite.config.ts"
        }
      ],
      "analysis": "The minify split means different build outputs. TypeScript configs are more robust. Two copies of the MF plugin exist in node_modules due to the Vite version split. This is tightly coupled to the dependency generation split -- resolving area #1 would largely resolve this.",
      "recommendation": "After upgrading to Vite 7, standardize on TypeScript vite.config.ts and consistent minify/port settings across all apps.",
      "status": "pending"
    },
    {
      "id": "state-management-architecture",
      "name": "State Management Architecture",
      "description": "Four distinct state management patterns across apps: Zustand+Dexie+Repository, controlled components, hooks+useState, and worker state machines",
      "impact": "MEDIUM",
      "total_files": 60,
      "variants": [
        {
          "name": "zustand-dexie-repository",
          "description": "14+ Zustand stores with nav/cache split, repository layer for Dexie CRUD, selector files for computed state, hooks for worker communication",
          "file_count": 30,
          "files": [
            "apps/illuminator/webui/src/lib/db/entityStore.ts",
            "apps/illuminator/webui/src/lib/db/entityRepository.ts",
            "apps/illuminator/webui/src/lib/db/entitySelectors.ts",
            "apps/illuminator/webui/src/lib/db/chronicleStore.ts",
            "apps/illuminator/webui/src/lib/db/chronicleRepository.ts",
            "apps/illuminator/webui/src/lib/db/modalStore.ts",
            "apps/illuminator/webui/src/lib/db/illuminatorConfigStore.ts"
          ],
          "sample_file": "apps/illuminator/webui/src/lib/db/entityStore.ts"
        },
        {
          "name": "controlled-component",
          "description": "Zero internal state. All state passed as props from parent, updates via callbacks. MFE remote is a pure controlled component.",
          "file_count": 10,
          "files": [
            "apps/cosmographer/webui/src/CosmographerRemote.jsx",
            "apps/coherence-engine/webui/src/CoherenceEngineRemote.jsx",
            "apps/name-forge/webui/src/NameForgeRemote.jsx"
          ],
          "sample_file": "apps/cosmographer/webui/src/CosmographerRemote.jsx"
        },
        {
          "name": "hooks-plus-usestate",
          "description": "Custom hooks encapsulate data loading, return { data, loading, error }. Use shared Zustand stores from packages (narrative-store, image-store) but no app-level zustand.",
          "file_count": 15,
          "files": [
            "apps/chronicler/webui/src/hooks/useWorldDataLoader.ts",
            "apps/archivist/webui/src/ArchivistRemote.tsx",
            "apps/viewer/webui/src/useBundleLoader.js"
          ],
          "sample_file": "apps/chronicler/webui/src/hooks/useWorldDataLoader.ts"
        },
        {
          "name": "worker-state-machine",
          "description": "Single useSimulationWorker hook manages all state as a state machine. Worker communication via postMessage. No external state library.",
          "file_count": 5,
          "files": [
            "apps/lore-weave/webui/src/hooks/useSimulationWorker.ts"
          ],
          "sample_file": "apps/lore-weave/webui/src/hooks/useSimulationWorker.ts"
        }
      ],
      "analysis": "Most of this variation is intentional and appropriate. Controlled components make sense for embedded editing MFEs. The worker state machine fits lore-weave's single-concern design. The main question is whether chronicler/archivist should adopt a lighter version of illuminator's repository pattern as they grow, or stay with hooks.",
      "recommendation": "Synchronize zustand versions across all apps (5.0.2 -> 5.0.11). The architectural differences are largely justified by app complexity and don't need forced convergence.",
      "status": "in_progress",
      "progress_notes": "Illuminator's Zustand+Dexie+Repository pattern refined: IlluminatorRemote decomposed into 17 files, children now read from stores directly (ADR-002) instead of receiving store-available values as props. Workflow state grouped into domain objects (ADR-003). Config store expanded to serve as canonical read path for project-level configuration."
    },
    {
      "id": "file-extension-conventions",
      "name": "File Extension Conventions (JSX vs TSX)",
      "description": "6 apps use pure JSX, 2 apps use pure TSX, 1 app (illuminator) is hybrid with both",
      "impact": "MEDIUM",
      "total_files": 810,
      "variants": [
        {
          "name": "pure-jsx",
          "description": "All component files use .jsx extension. No TypeScript in component files.",
          "file_count": 254,
          "files": [
            "apps/name-forge/webui/src/",
            "apps/coherence-engine/webui/src/",
            "apps/lore-weave/webui/src/",
            "apps/canonry/webui/src/",
            "apps/cosmographer/webui/src/",
            "apps/viewer/webui/src/"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/generators/GeneratorModal.jsx"
        },
        {
          "name": "pure-tsx",
          "description": "All component files use .tsx extension with full TypeScript type annotations.",
          "file_count": 68,
          "files": [
            "apps/archivist/webui/src/",
            "apps/chronicler/webui/src/"
          ],
          "sample_file": "apps/archivist/webui/src/components/EntityDetail.tsx"
        },
        {
          "name": "hybrid-jsx-tsx",
          "description": "Mix of 67 JSX and 38 TSX files coexisting. Newer files tend to be TSX, older files remain JSX.",
          "file_count": 105,
          "files": [
            "apps/illuminator/webui/src/"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChroniclePanel.jsx"
        }
      ],
      "analysis": "The JSX/TSX split mirrors the dependency generation split. Archivist and chronicler (newer apps) chose TSX from the start. Illuminator's hybrid state suggests gradual organic migration rather than a deliberate choice. Converting JSX to TSX is mechanical but time-consuming (254 files).",
      "recommendation": "Adopt TSX for all new files. Consider batch-converting illuminator's remaining JSX files to TSX since it's already partially migrated. Full monorepo conversion is optional and low-priority.",
      "status": "pending"
    },
    {
      "id": "eslint-config-fragmentation",
      "name": "ESLint Configuration Fragmentation",
      "description": "Root eslint.config.js provides base rules, but 3 apps have local overrides with divergent plugin versions and additional rules",
      "impact": "MEDIUM",
      "total_files": 9,
      "variants": [
        {
          "name": "root-inherited",
          "description": "No local eslint config. All rules from root eslint.config.js.",
          "file_count": 6,
          "files": [
            "apps/illuminator/",
            "apps/canonry/",
            "apps/cosmographer/",
            "apps/lore-weave/",
            "apps/coherence-engine/",
            "apps/viewer/"
          ],
          "sample_file": "eslint.config.js"
        },
        {
          "name": "local-with-perf-rules",
          "description": "Own eslint.config.js with eslint-plugin-react-perf (not in root). eslint-plugin-react-hooks ^7.0.1, eslint-plugin-react-refresh ^0.4.24.",
          "file_count": 2,
          "files": [
            "apps/archivist/webui/eslint.config.js",
            "apps/chronicler/webui/eslint.config.js"
          ],
          "sample_file": "apps/archivist/webui/eslint.config.js"
        },
        {
          "name": "local-with-old-plugins",
          "description": "Own eslint.config.js with eslint-plugin-react-hooks ^5.2.0 (root uses ^7.0.1). Two major versions behind.",
          "file_count": 1,
          "files": [
            "apps/name-forge/webui/eslint.config.js"
          ],
          "sample_file": "apps/name-forge/webui/eslint.config.js"
        }
      ],
      "analysis": "Name-forge's react-hooks 5.x vs root's 7.x is a concrete gap that may cause missed lint violations. Archivist/chronicler's react-perf plugin is a reasonable addition that could benefit all apps. The root config was recently set up on the linting branch; some apps predate it.",
      "recommendation": "Update name-forge to react-hooks ^7.0.1. Add eslint-plugin-react-perf to root config. Remove local eslint configs from archivist/chronicler/name-forge in favor of root.",
      "status": "in_progress",
      "progress_notes": "Root eslint.config.js strengthened: added sonarjs, complexity/max-lines limits, jsx-a11y, custom local/max-jsx-props rule (threshold 12). All apps that inherit from root (6 of 9) now get consistent enforcement. Local configs for archivist/chronicler/name-forge still diverge."
    },
    {
      "id": "typescript-config-divergence",
      "name": "TypeScript Configuration Divergence",
      "description": "Different module resolution strategies and compilation targets across packages and apps",
      "impact": "MEDIUM",
      "total_files": 8,
      "variants": [
        {
          "name": "bundler-resolution",
          "description": "module: ESNext, moduleResolution: bundler, target: ES2022. Correct for Vite-bundled apps.",
          "file_count": 3,
          "files": [
            "apps/archivist/webui/tsconfig.app.json",
            "apps/chronicler/webui/tsconfig.app.json",
            "apps/lore-weave/tsconfig.json"
          ],
          "sample_file": "apps/archivist/webui/tsconfig.app.json"
        },
        {
          "name": "node16-resolution",
          "description": "module: Node16, moduleResolution: Node16. Designed for Node.js execution, not web bundles.",
          "file_count": 1,
          "files": [
            "apps/name-forge/tsconfig.json"
          ],
          "sample_file": "apps/name-forge/tsconfig.json"
        },
        {
          "name": "nodenext-resolution",
          "description": "module: NodeNext, moduleResolution: NodeNext. Similar to Node16 with future features.",
          "file_count": 1,
          "files": [
            "apps/cosmographer/tsconfig.json"
          ],
          "sample_file": "apps/cosmographer/tsconfig.json"
        },
        {
          "name": "outdated-target",
          "description": "target: ES2020, TypeScript 5.3.0. Two years behind the rest of the codebase.",
          "file_count": 1,
          "files": [
            "packages/world-schema/tsconfig.json"
          ],
          "sample_file": "packages/world-schema/tsconfig.json"
        }
      ],
      "analysis": "All apps are bundled by Vite, so 'bundler' resolution is correct. Node16/NodeNext may work but can affect import path resolution. World-schema on ES2020/TS 5.3 limits available TypeScript features in the foundational type package. Since world-schema is type-only (no runtime code), the target matters less, but the TS version limits language features in type definitions.",
      "recommendation": "Standardize all packages and apps on module: ESNext, moduleResolution: bundler, target: ES2022, TypeScript ^5.9.3.",
      "status": "pending"
    },
    {
      "id": "legacy-dsl-v1-package",
      "name": "Legacy DSL v1 Package",
      "description": "canonry-dsl (v1) is disabled behind USE_CANON_DSL=false flag but still in the codebase. canonry-dsl-v2 is the production implementation.",
      "impact": "LOW",
      "total_files": 2,
      "variants": [
        {
          "name": "dsl-v2-production",
          "description": "14,422 lines compile.ts + 6,617 lines serialize.ts. Supports illuminator blocks, text validation, extended field semantics. Used by scripts/conduit.js.",
          "file_count": 1,
          "files": [
            "packages/canonry-dsl-v2/src/compile.ts",
            "packages/canonry-dsl-v2/src/serialize.ts",
            "packages/canonry-dsl-v2/src/parser.ts",
            "packages/canonry-dsl-v2/src/grammar.ts"
          ],
          "sample_file": "packages/canonry-dsl-v2/src/compile.ts"
        },
        {
          "name": "dsl-v1-legacy",
          "description": "12,519 lines compile.ts + 6,371 lines serialize.ts. Missing illuminator support, text validation, extended fields. Gated behind USE_CANON_DSL=false.",
          "file_count": 1,
          "files": [
            "packages/canonry-dsl/src/compile.ts",
            "packages/canonry-dsl/src/serialize.ts",
            "packages/canonry-dsl/src/parser.ts",
            "packages/canonry-dsl/src/grammar.ts"
          ],
          "sample_file": "packages/canonry-dsl/src/compile.ts"
        }
      ],
      "analysis": "Both packages export identical APIs (drop-in replacement). v1 is never executed in production (USE_CANON_DSL=false). Removing v1 eliminates ~19,000 lines of dead code. The canonry/webui package.json still lists @canonry/dsl as a dependency.",
      "recommendation": "Delete packages/canonry-dsl entirely. Remove the USE_CANON_DSL flag and @canonry/dsl dependency from canonry/webui. Quick win, zero risk.",
      "status": "pending"
    }
  ]
}
