{
  "version": "1.0",
  "generated": "2026-02-28T17:18:15.720061",
  "summary": {
    "total_drift_areas": 68,
    "total_files_affected": 438,
    "high_impact": 8,
    "medium_impact": 25,
    "low_impact": 35,
    "by_type": {
      "behavioral": 32,
      "structural": 7,
      "semantic": 4,
      "css": 25
    },
    "evidence_coverage": {
      "high": 38,
      "medium": 5,
      "low": 25
    }
  },
  "areas": [
    {
      "id": "textarea-commit-pattern",
      "name": "Textarea State Commit Pattern Inconsistency",
      "type": "behavioral",
      "domain": "Form Validation & Input Behavior",
      "description": "The shared component library provides LocalTextArea (blur-commit with focus-tracking to prevent cursor jumping), but illuminator uses raw <textarea> elements with ad-hoc local state in 11 files while only 4 files adopt LocalTextArea. Coherence-engine has near-perfect adoption (10+ files). The ad-hoc implementations in illuminator lack the focus-tracking guard that LocalTextArea provides, making them vulnerable to parent re-render disruption during editing.",
      "impact": "MEDIUM",
      "total_files": 26,
      "variants": [
        {
          "name": "shared-local-textarea",
          "description": "Uses LocalTextArea from shared-components \u2014 maintains local draft, syncs on blur only if changed, tracks isFocused to prevent parent re-renders from overwriting user input",
          "file_count": 14,
          "files": [
            "apps/coherence-engine/webui/src/components/actions/tabs/OverviewTab.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/OverviewTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/ClusterFormationTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/GraphContagionTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/ConnectionEvolutionTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/ThresholdTriggerTab.jsx",
            "apps/coherence-engine/webui/src/components/eras/sections/BasicInfoSection.jsx",
            "apps/illuminator/webui/src/components/ConfigPanel.jsx",
            "apps/illuminator/webui/src/components/WorldContextEditor.jsx",
            "apps/illuminator/webui/src/components/EntityGuidanceEditor.jsx",
            "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/LexemesTab.jsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ConfigPanel.jsx",
          "code_excerpts": [
            {
              "file": "packages/shared-components/src/components/LocalTextArea.jsx",
              "start_line": 37,
              "end_line": 66,
              "snippet": "const externalValue = value || '';\nconst [localValue, setLocalValue] = useState(externalValue);\nconst [isFocused, setIsFocused] = useState(false);\n\nconst handleFocus = useCallback(() => {\n  setLocalValue(externalValue);\n  setIsFocused(true);\n}, [externalValue]);\n\nconst handleBlur = useCallback(() => {\n  setIsFocused(false);\n  if (localValue !== externalValue) {\n    onChange(localValue);\n  }\n}, [externalValue, localValue, onChange]);\n\nreturn (\n  <textarea\n    value={isFocused ? localValue : externalValue}\n    onChange={(e) => setLocalValue(e.target.value)}\n    onFocus={handleFocus}\n    onBlur={handleBlur}\n    ...\n  />\n);"
            }
          ],
          "implementation_details": "Uses isFocused state to switch between local draft (during editing) and external value (when not focused). Syncs draft from external on focus, commits on blur only if changed. Prevents parent re-renders from overwriting user input mid-keystroke."
        },
        {
          "name": "ad-hoc-textarea-with-blur-commit",
          "description": "Raw <textarea> with manual local state and onBlur handler \u2014 functionally similar to LocalTextArea but hand-rolled without the isFocused guard pattern",
          "file_count": 3,
          "files": [
            "apps/illuminator/webui/src/components/EntityDetailView.tsx:323-357",
            "apps/illuminator/webui/src/components/preprint/TreeNodeRenderer.tsx:53",
            "apps/coherence-engine/webui/src/components/pressures/cards/PressureCard.jsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/EntityDetailView.tsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/EntityDetailView.tsx",
              "start_line": 322,
              "end_line": 357,
              "snippet": "const [editingSummary, setEditingSummary] = useState(false);\nconst [summaryDraft, setSummaryDraft] = useState(\"\");\n\nconst startEditSummary = useCallback(() => {\n  setSummaryDraft(entity.summary || \"\");\n  setEditingSummary(true);\n}, [entity.summary]);\n\nconst saveSummary = useCallback(() => {\n  const trimmed = summaryDraft.trim();\n  if (trimmed && trimmed !== entity.summary) {\n    void handleUpdateSummary(entity.id, trimmed);\n  }\n  setEditingSummary(false);\n}, [handleUpdateSummary, summaryDraft, entity.summary, entity.id]);\n\n// Usage:\n<textarea\n  value={summaryDraft}\n  onChange={(e) => setSummaryDraft(e.target.value)}\n  onKeyDown={(e) => {\n    if (e.key === \"Enter\" && (e.ctrlKey || e.metaKey)) saveSummary();\n    if (e.key === \"Escape\") cancelSummary();\n  }}\n  onBlur={saveSummary}\n/>"
            }
          ],
          "implementation_details": "Manually tracks editingSummary/summaryDraft state pairs. Commits on blur with trim validation. Also supports Ctrl+Enter to commit and Escape to cancel \u2014 extra keyboard behaviors not present in LocalTextArea. Lacks isFocused guard so parent re-renders during editing could reset the textarea value."
        },
        {
          "name": "ad-hoc-textarea-immediate-commit",
          "description": "Raw <textarea> with onChange directly updating parent state on every keystroke \u2014 no local draft, no blur-commit",
          "file_count": 9,
          "files": [
            "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
            "apps/illuminator/webui/src/components/EraNarrativeModal.jsx",
            "apps/illuminator/webui/src/components/HistorianConfigEditor.jsx",
            "apps/illuminator/webui/src/components/DynamicsGenerationModal.jsx",
            "apps/illuminator/webui/src/components/BackportConfigModal.jsx",
            "apps/illuminator/webui/src/components/HistorianReviewModal.jsx",
            "apps/illuminator/webui/src/components/ActivityPanel.jsx",
            "apps/illuminator/webui/src/components/ChronicleWizard/steps/GenerateStep.tsx",
            "apps/illuminator/webui/src/components/chronicle-workspace/VersionsTab.jsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
              "start_line": 278,
              "end_line": 288,
              "snippet": "<label htmlFor=\"name\" className=\"cem-label\">Name *</label>\n<input id=\"name\"\n  type=\"text\"\n  value={nameInput}\n  onChange={(e) => setNameInput(e.target.value)}\n  placeholder=\"Entity name\"\n  className=\"illuminator-select cem-full-width-box\"\n  autoFocus\n/>"
            }
          ],
          "implementation_details": "State lives in a modal-local useState. Every keystroke calls setState directly. This works because the state is local to the modal (no external parent to cause re-renders), but it means there is no consistent commit pattern across the app. Some textareas blur-commit, some immediate-commit, with no architectural guidance on when to use which."
        }
      ],
      "behavior_matrix": {
        "coherence-engine OverviewTabs": {
          "component": "LocalTextArea",
          "commit_timing": "blur",
          "focus_guard": true,
          "trim_validation": false,
          "keyboard_shortcuts": false
        },
        "illuminator ConfigPanel/WorldContextEditor": {
          "component": "LocalTextArea",
          "commit_timing": "blur",
          "focus_guard": true,
          "trim_validation": false,
          "keyboard_shortcuts": false
        },
        "illuminator EntityDetailView": {
          "component": "raw <textarea>",
          "commit_timing": "blur + Ctrl+Enter",
          "focus_guard": false,
          "trim_validation": true,
          "keyboard_shortcuts": "Ctrl+Enter commit, Escape cancel"
        },
        "illuminator CreateEntityModal": {
          "component": "raw <textarea>/<input>",
          "commit_timing": "immediate (onChange)",
          "focus_guard": false,
          "trim_validation": "on submit only",
          "keyboard_shortcuts": false
        },
        "illuminator EraNarrativeModal": {
          "component": "raw <textarea>",
          "commit_timing": "immediate (onChange)",
          "focus_guard": false,
          "trim_validation": false,
          "keyboard_shortcuts": false
        }
      },
      "missing_behavior_complexity": {
        "focus_guard_on_ad_hoc_textareas": "trivial \u2014 replace raw <textarea> with LocalTextArea import (~1 line change per instance)",
        "keyboard_shortcuts_on_LocalTextArea": "moderate \u2014 LocalTextArea would need optional onKeyDown prop or a wrapper component to support Ctrl+Enter and Escape"
      },
      "analysis": "This is genuine drift, not intentional variation. The shared LocalTextArea exists precisely to solve cursor-jumping and parent-re-render problems, yet 12 of 26 textarea uses bypass it. The ad-hoc implementations in illuminator's modals (CreateEntityModal, EraNarrativeModal, etc.) work correctly only because modal-local state doesn't cause external re-renders \u2014 but this is accidental safety, not by design. EntityDetailView's custom implementation adds valuable keyboard shortcuts (Ctrl+Enter, Escape) that LocalTextArea lacks, suggesting the shared component needs enhancement rather than wholesale replacement. The user-visible impact is subtle: cursor jumping and lost keystrokes could occur in ad-hoc textareas if parent components begin re-rendering more frequently (e.g., from real-time collaboration or autosave). Recommended target: enhance LocalTextArea with optional onCommit (for Ctrl+Enter), onCancel (for Escape), and trimOnCommit props, then migrate all 12 ad-hoc instances.",
      "recommendation": "Enhance LocalTextArea({ onCommit?: () => void, onCancel?: () => void, trimOnCommit?: boolean }) and migrate all raw <textarea> uses in illuminator to use it.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "forms"
    },
    {
      "id": "number-input-adoption",
      "name": "NumberInput Shared Component Adoption Gap",
      "type": "behavioral",
      "domain": "Form Validation & Input Behavior",
      "description": "The shared NumberInput component handles edge cases (negative numbers, intermediate states like '-' and '.', min/max constraints, blur-commit with revert on invalid) and is heavily adopted in coherence-engine (23 files), name-forge, lore-weave, and cosmographer. However, illuminator uses 0 NumberInput instances and instead has 12+ raw <input type=\"number\"> elements that lack intermediate state handling and use immediate onChange with parseFloat/parseInt.",
      "impact": "LOW",
      "total_files": 8,
      "variants": [
        {
          "name": "shared-number-input",
          "description": "Uses NumberInput from shared-components \u2014 renders as <input type=\"text\" inputMode=\"numeric\">, maintains internal string state during editing, parses on blur, handles '-', '.', and '-.' intermediate states, applies min/max constraints",
          "file_count": 30,
          "files": [
            "apps/coherence-engine/webui/src/components/systems/tabs/FrameworkSystemTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/PlaneDiffusionTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/ConnectionEvolutionTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/GraphContagionTab.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
            "apps/lore-weave/webui/src/components/runner/ParameterForm.jsx",
            "apps/lore-weave/webui/src/components/targets/EntityTargets.jsx",
            "apps/name-forge/webui/src/components/generator/GenerateTab.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/profile/StrategyGroupEditor.jsx",
            "apps/cosmographer/webui/src/components/RelationshipEditor/index.jsx"
          ],
          "sample_file": "apps/lore-weave/webui/src/components/runner/ParameterForm.jsx",
          "code_excerpts": [
            {
              "file": "packages/shared-components/src/components/NumberInput.jsx",
              "start_line": 46,
              "end_line": 94,
              "snippet": "const [localValue, setLocalValue] = useState(() => externalDisplayValue);\nconst [isFocused, setIsFocused] = useState(false);\n\nconst parseValue = useCallback((str) => {\n  if (str === '' || str === '-' || str === '.' || str === '-.') {\n    return null; // Intermediate state, not valid yet\n  }\n  const parsed = integer ? parseInt(str, 10) : parseFloat(str);\n  if (isNaN(parsed)) return null;\n  return parsed;\n}, [integer]);\n\nconst handleChange = useCallback((e) => {\n  const newValue = e.target.value;\n  const validPattern = integer ? /^-?\\d*$/ : /^-?\\d*\\.?\\d*$/;\n  if (!validPattern.test(newValue)) return; // Reject invalid chars\n  setLocalValue(newValue);\n  const parsed = parseValue(newValue);\n  if (parsed !== null) {\n    let constrained = parsed;\n    if (min !== undefined && constrained < min) constrained = min;\n    if (max !== undefined && constrained > max) constrained = max;\n    onChange(constrained);\n  }\n}, [...]);"
            }
          ],
          "implementation_details": "Renders as type=\"text\" with inputMode=\"numeric\" to avoid browser native number input quirks. Validates input character-by-character with regex. Allows intermediate states ('-', '.') without rejecting them. Applies min/max constraints both on change and on blur. Reverts to parent value on blur if input is invalid. Uses isFocused guard like LocalTextArea."
        },
        {
          "name": "raw-html-number-input",
          "description": "Raw <input type=\"number\"> with immediate onChange calling parseFloat/parseInt \u2014 no intermediate state handling, no blur-commit, browser-native spinner controls",
          "file_count": 8,
          "files": [
            "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx:605-703",
            "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
            "apps/illuminator/webui/src/components/ChronologyModal.jsx",
            "apps/illuminator/webui/src/components/WorldContextEditor.jsx",
            "apps/illuminator/webui/src/components/LLMCallConfigPanel.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/PhonemeWeightGrid.jsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx",
              "start_line": 604,
              "end_line": 616,
              "snippet": "<input type=\"number\" min=\"100\" step=\"100\"\n  value={formData.wordCountMin}\n  onChange={e => handleChange(\"wordCountMin\", e.target.value)}\n  className=\"illuminator-input style-editor-input-sm\" />\n<span>\u2013</span>\n<input type=\"number\" min=\"100\" step=\"100\"\n  value={formData.wordCountMax}\n  onChange={e => handleChange(\"wordCountMax\", e.target.value)}\n  className=\"illuminator-input style-editor-input-sm\" />\n\n<input type=\"number\" min=\"1\" max=\"20\"\n  value={formData.sceneCountMin}\n  onChange={e => handleChange(\"sceneCountMin\", e.target.value)}\n  className=\"illuminator-input style-editor-input-xs\" />"
            },
            {
              "file": "apps/illuminator/webui/src/components/LLMCallConfigPanel.jsx",
              "start_line": 126,
              "end_line": 131,
              "snippet": "const handleTemperatureChange = (e) => {\n  const newTemperature = parseFloat(e.target.value);\n  if (Number.isNaN(newTemperature)) return;\n  onUpdate(callType, buildUpdatePayload({ temperature: newTemperature }));\n};"
            }
          ],
          "implementation_details": "Uses browser-native <input type=\"number\"> which shows spinner controls and has inconsistent behavior across browsers (especially for negative numbers and decimal entry). onChange passes raw e.target.value string to parent \u2014 some handlers parse immediately (LLMCallConfigPanel), some pass the string directly to state (StyleLibraryEditor). No intermediate state handling."
        }
      ],
      "behavior_matrix": {
        "coherence-engine (all numeric fields)": {
          "component": "NumberInput",
          "input_type": "text + inputMode=numeric",
          "intermediate_state_handling": true,
          "min_max_constraints": true,
          "blur_commit": true,
          "focus_guard": true
        },
        "lore-weave ParameterForm": {
          "component": "NumberInput",
          "input_type": "text + inputMode=numeric",
          "intermediate_state_handling": true,
          "min_max_constraints": true,
          "blur_commit": true,
          "focus_guard": true
        },
        "name-forge GenerateTab": {
          "component": "NumberInput",
          "input_type": "text + inputMode=numeric",
          "intermediate_state_handling": true,
          "min_max_constraints": true,
          "blur_commit": true,
          "focus_guard": true
        },
        "illuminator StyleLibraryEditor": {
          "component": "raw <input type=\"number\">",
          "input_type": "number (browser-native)",
          "intermediate_state_handling": false,
          "min_max_constraints": "browser-native only",
          "blur_commit": false,
          "focus_guard": false
        },
        "illuminator LLMCallConfigPanel": {
          "component": "raw <select> for most, parseFloat for temperature",
          "input_type": "select + number",
          "intermediate_state_handling": false,
          "min_max_constraints": "select options constrain",
          "blur_commit": false,
          "focus_guard": false
        },
        "name-forge PhonemeWeightGrid": {
          "component": "raw <input type=\"number\"> with onBlur",
          "input_type": "number (browser-native)",
          "intermediate_state_handling": false,
          "min_max_constraints": "manual on blur",
          "blur_commit": true,
          "focus_guard": false
        }
      },
      "missing_behavior_complexity": {
        "migrate_illuminator_to_NumberInput": "trivial \u2014 swap <input type=\"number\"> for <NumberInput>, adjust onChange signature (~2 lines per instance, 12 instances)",
        "migrate_PhonemeWeightGrid": "trivial \u2014 same swap, remove manual parse logic"
      },
      "analysis": "This is drift from incomplete adoption rather than intentional variation. The illuminator app was likely built or significantly expanded after the shared NumberInput existed, and developers used the more familiar <input type=\"number\"> pattern. The LLMCallConfigPanel is a borderline case \u2014 it uses <select> elements for most fields (model, thinking budget, max tokens) which is appropriate, but the temperature field uses a raw number input with parseFloat. The StyleLibraryEditor's 6 raw number inputs handle word counts and scene counts where the browser-native spinner is arguably adequate, but the inconsistency with the rest of the monorepo creates maintenance burden and visual inconsistency (native spinner vs no spinner). PhonemeWeightGrid in name-forge is the only outlier in an otherwise well-adopted app. User-visible impact is low \u2014 the main issue is that native <input type=\"number\"> blocks typing '-' on some browsers and has inconsistent step behavior.",
      "recommendation": "Migrate all raw <input type=\"number\"> to NumberInput across illuminator (12 instances in 5 files) and name-forge's PhonemeWeightGrid (1 instance).",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "forms"
    },
    {
      "id": "text-input-blur-commit-hook",
      "name": "useLocalInputState Hook Adoption Gap",
      "type": "behavioral",
      "domain": "Form Validation & Input Behavior",
      "description": "The useLocalInputState hook provides blur-commit behavior for text inputs to prevent cursor jumping. It is well-adopted in coherence-engine (4 files, used for ID and name fields) but completely unused in illuminator, name-forge, cosmographer, and other apps \u2014 even where the same cursor-jumping problem exists.",
      "impact": "LOW",
      "total_files": 4,
      "variants": [
        {
          "name": "shared-useLocalInputState",
          "description": "Uses the shared hook: [localValue, setLocalValue, handleBlur] = useLocalInputState(externalValue, onUpdate)",
          "file_count": 4,
          "files": [
            "apps/coherence-engine/webui/src/components/actions/tabs/OverviewTab.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/OverviewTab.jsx",
            "apps/coherence-engine/webui/src/components/pressures/cards/PressureCard.jsx"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
          "code_excerpts": [
            {
              "file": "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
              "start_line": 21,
              "end_line": 50,
              "snippet": "const [localId, setLocalId, handleIdBlur] = useLocalInputState(generator.id, (value) =>\n  updateField(\"id\", value)\n);\nconst [localName, setLocalName, handleNameBlur] = useLocalInputState(generator.name, (value) =>\n  updateField(\"name\", value)\n);\n\n// Usage:\n<input id=\"generator-id\"\n  type=\"text\"\n  value={localId}\n  onChange={(e) => setLocalId(e.target.value)}\n  onBlur={handleIdBlur}\n  className=\"input\"\n/>"
            }
          ],
          "implementation_details": "Hook manages local state copy, syncs from external via useEffect, commits on blur only if value changed. Canonical pattern for text inputs bound to parent/store state. Prevents cursor jumping caused by React re-rendering the input with the old external value between keystrokes."
        },
        {
          "name": "direct-state-binding",
          "description": "Text inputs bound directly to parent state via onChange \u2014 no local draft, susceptible to cursor jumping if parent re-renders frequently",
          "file_count": 20,
          "files": [
            "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
            "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx",
            "apps/illuminator/webui/src/components/WorldContextEditor.jsx",
            "apps/illuminator/webui/src/components/ChronologyModal.jsx",
            "apps/illuminator/webui/src/components/EntityRenameModal.tsx",
            "apps/cosmographer/webui/src/components/EntityEditor/index.jsx",
            "apps/cosmographer/webui/src/components/AxisRegistry/index.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/DomainTab.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/GrammarsTab.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/CopyGrammarModal.jsx",
            "apps/canonry/webui/src/components/SchemaEditor/EntityKindEditor.jsx",
            "apps/canonry/webui/src/components/SchemaEditor/RelationshipKindEditor.jsx",
            "apps/canonry/webui/src/components/SchemaEditor/CultureEditor.jsx",
            "apps/archivist/webui/src/components/FilterPanel.tsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx",
              "start_line": 107,
              "end_line": 148,
              "snippet": "const handleChange = (field, value) => {\n  setFormData(prev => ({\n    ...prev,\n    [field]: value\n  }));\n};\n\n// Usage:\n<input id=\"name\" type=\"text\"\n  value={formData.name}\n  onChange={e => handleChange(\"name\", e.target.value)}\n  className=\"illuminator-input\"\n  placeholder=\"e.g., Oil Painting\"\n  autoFocus />"
            }
          ],
          "implementation_details": "State is local to modal (useState), so cursor jumping is not a problem here. But the same pattern is used in components where state lives in a Zustand store or is passed as props, where cursor jumping can occur. No consistent rule for when to use useLocalInputState vs direct binding."
        }
      ],
      "behavior_matrix": {
        "coherence-engine (ID/name fields)": {
          "pattern": "useLocalInputState hook",
          "cursor_jump_safe": true,
          "commit_timing": "blur"
        },
        "illuminator modals": {
          "pattern": "modal-local useState + direct onChange",
          "cursor_jump_safe": "accidentally (local state)",
          "commit_timing": "immediate"
        },
        "illuminator store-bound fields": {
          "pattern": "direct onChange to store",
          "cursor_jump_safe": false,
          "commit_timing": "immediate"
        },
        "canonry SchemaEditor": {
          "pattern": "custom TagIdInput with local state + onBlur",
          "cursor_jump_safe": true,
          "commit_timing": "blur with validation"
        }
      },
      "missing_behavior_complexity": {
        "adopt_in_illuminator_store_bound": "trivial \u2014 import hook and wrap existing inputs (~3 lines per input)",
        "adopt_in_canonry_schema_editors": "trivial \u2014 replace custom local state pattern with hook"
      },
      "analysis": "This is partial drift. In illuminator, many text inputs are modal-local (CreateEntityModal, StyleLibraryEditor) where cursor jumping cannot occur because state is local. In those cases, useLocalInputState is unnecessary overhead. However, components like WorldContextEditor and ConfigPanel use LocalTextArea (which internally has the same blur-commit pattern) for textareas but use direct binding for their text inputs \u2014 an inconsistency within the same component. The coherence-engine's consistent use of useLocalInputState for ID/name fields is the right pattern for store-bound inputs. The canonry SchemaEditor's TagIdInput independently reimplements the same hook logic with additional validation (checking for duplicate IDs), suggesting the hook could benefit from an optional validator parameter. User impact is low because most direct-bound inputs are in modals where the state is local anyway.",
      "recommendation": "Document when to use useLocalInputState (store-bound inputs) vs direct binding (modal-local state). Optionally add a validate parameter to the hook for the TagIdInput use case.",
      "evidence_quality": "medium",
      "status": "pending",
      "source_domain": "forms"
    },
    {
      "id": "debounce-autosave-patterns",
      "name": "Inconsistent Debounce/Autosave Implementation",
      "type": "behavioral",
      "domain": "Form Validation & Input Behavior",
      "description": "Three distinct autosave/debounce patterns exist: (1) canonry App.jsx has 6 identical useEffect blocks with 300ms setTimeout for persistence, (2) name-forge ProfileModal and GrammarsTab use 1000ms setTimeout with ref-based last-saved tracking, and (3) illuminator uses no debounce \u2014 changes propagate immediately or are blur-committed. All debounce implementations are hand-rolled with useRef + setTimeout; no shared utility exists.",
      "impact": "LOW",
      "total_files": 8,
      "variants": [
        {
          "name": "300ms-persistence-debounce",
          "description": "Canonry App.jsx pattern: useEffect watches state, sets 300ms setTimeout to persist, clears on cleanup. Six identical blocks for six different config sections.",
          "file_count": 1,
          "files": [
            "apps/canonry/webui/src/App.jsx:1266-1323"
          ],
          "sample_file": "apps/canonry/webui/src/App.jsx",
          "code_excerpts": [
            {
              "file": "apps/canonry/webui/src/App.jsx",
              "start_line": 1266,
              "end_line": 1282,
              "snippet": "// Persist world context when it changes (for Illuminator)\nuseEffect(() => {\n  if (!currentProject?.id) return;\n  if (!worldContext) return;\n  const timeoutId = setTimeout(() => {\n    saveWorldContext(currentProject.id, worldContext);\n  }, 300);\n  return () => clearTimeout(timeoutId);\n}, [currentProject?.id, worldContext]);\n\n// Persist entity guidance when it changes (for Illuminator)\nuseEffect(() => {\n  if (!currentProject?.id) return;\n  if (!entityGuidance) return;\n  const timeoutId = setTimeout(() => {\n    saveEntityGuidance(currentProject.id, entityGuidance);\n  }, 300);\n  return () => clearTimeout(timeoutId);\n}, [currentProject?.id, entityGuidance]);"
            }
          ],
          "implementation_details": "Six copy-pasted useEffect blocks in App.jsx, each watching a different state variable (worldContext, entityGuidance, cultureIdentities, enrichmentConfig, styleSelection, historianConfig). All use 300ms delay. Debounce is achieved by cleanup function clearing the timeout when state changes again before the 300ms elapses. No ref-based deduplication."
        },
        {
          "name": "1000ms-autosave-with-ref-tracking",
          "description": "Name-forge pattern: useEffect watches state, compares JSON.stringify against lastSavedRef, sets 1000ms setTimeout via autosaveTimeoutRef. More robust deduplication than the canonry pattern.",
          "file_count": 2,
          "files": [
            "apps/name-forge/webui/src/components/workspace/tabs/profile/ProfileModal.jsx:39-60",
            "apps/name-forge/webui/src/components/workspace/tabs/GrammarsTab.jsx:46-66"
          ],
          "sample_file": "apps/name-forge/webui/src/components/workspace/tabs/profile/ProfileModal.jsx",
          "code_excerpts": [
            {
              "file": "apps/name-forge/webui/src/components/workspace/tabs/profile/ProfileModal.jsx",
              "start_line": 39,
              "end_line": 60,
              "snippet": "useEffect(() => {\n  if (!editedProfile) return;\n\n  const profileStr = JSON.stringify(editedProfile);\n  if (profileStr === lastSavedRef.current) return; // Skip if unchanged\n\n  if (autosaveTimeoutRef.current) {\n    clearTimeout(autosaveTimeoutRef.current);\n  }\n\n  autosaveTimeoutRef.current = setTimeout(() => {\n    handleSave(editedProfile);\n    lastSavedRef.current = profileStr;\n  }, 1000);\n\n  return () => {\n    if (autosaveTimeoutRef.current) {\n      clearTimeout(autosaveTimeoutRef.current);\n    }\n  };\n}, [editedProfile]);"
            }
          ],
          "implementation_details": "Uses JSON.stringify comparison against lastSavedRef to skip unnecessary saves. Uses autosaveTimeoutRef for manual timeout management. 1000ms delay (3x longer than canonry). More robust but more boilerplate than the canonry pattern."
        },
        {
          "name": "no-debounce-immediate-commit",
          "description": "Coherence-engine and most of illuminator: changes propagate immediately to parent state or store on every onChange/onBlur. No debounce layer.",
          "file_count": 40,
          "files": [
            "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/OverviewTab.jsx",
            "apps/illuminator/webui/src/components/EntityDetailView.tsx",
            "apps/illuminator/webui/src/components/WorldContextEditor.jsx"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
          "code_excerpts": [
            {
              "file": "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
              "start_line": 17,
              "end_line": 19,
              "snippet": "const updateField = (field, value) => {\n  onChange({ ...generator, [field]: value });\n};"
            }
          ],
          "implementation_details": "Every field change immediately calls the parent onChange with a new object. Parent is responsible for any persistence debouncing. This is the simplest pattern and works well when the parent handles persistence separately (as in coherence-engine where canonry App.jsx does the debounced persistence)."
        }
      ],
      "behavior_matrix": {
        "canonry App.jsx (persistence layer)": {
          "debounce_delay": "300ms",
          "dedup_strategy": "useEffect cleanup",
          "implementation": "6 copy-pasted useEffect blocks",
          "scope": "top-level config persistence"
        },
        "name-forge ProfileModal": {
          "debounce_delay": "1000ms",
          "dedup_strategy": "JSON.stringify comparison + ref",
          "implementation": "manual useRef + setTimeout",
          "scope": "modal-level autosave"
        },
        "name-forge GrammarsTab": {
          "debounce_delay": "1000ms",
          "dedup_strategy": "JSON.stringify comparison + ref",
          "implementation": "manual useRef + setTimeout",
          "scope": "tab-level autosave"
        },
        "coherence-engine / illuminator (components)": {
          "debounce_delay": "none",
          "dedup_strategy": "n/a",
          "implementation": "immediate propagation",
          "scope": "field-level"
        }
      },
      "missing_behavior_complexity": {
        "shared_useDebouncedSave_hook": "moderate \u2014 extract a reusable hook: useDebouncedSave(value, saveFn, delay, { compareWith?: ref }). Would replace 8 copy-pasted useEffect blocks across 3 files."
      },
      "analysis": "The 300ms vs 1000ms debounce delay is likely intentional \u2014 canonry persists config that feeds into other apps and should be fast, while name-forge autosaves complex grammar structures where a longer delay reduces write frequency. The real drift is in implementation: canonry has 6 identical copy-pasted useEffect blocks that should be a single parametric hook, and name-forge's two autosave implementations are also copy-pasted. A shared useDebouncedSave hook would eliminate ~60 lines of duplicated code. The absence of debounce in coherence-engine components is not drift \u2014 those components propagate changes upward and rely on canonry's App.jsx persistence layer for debouncing. User-visible impact is minimal since the debounce behavior works correctly everywhere; this is primarily a DRY concern.",
      "recommendation": "Extract a shared useDebouncedSave(value, saveFn, delay) hook into shared-components. Parametrize delay (300ms for persistence, 1000ms for complex editors). Replace the 6 identical useEffect blocks in App.jsx and 2 in name-forge.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "forms"
    },
    {
      "id": "validation-display-patterns",
      "name": "Validation Error Display Pattern Divergence",
      "type": "behavioral",
      "domain": "Form Validation & Input Behavior",
      "description": "Four distinct validation display patterns exist across the monorepo: (1) ValidationPopover in canonry \u2014 compact stay-open popover with auto-fix capability, (2) ValidationPanel in lore-weave \u2014 full-page panel with error/warning separation, (3) ErrorBadge/TabValidationBadge in coherence-engine \u2014 inline count badges on cards and tabs, (4) inline error divs in name-forge and cosmographer. Each was built independently with different ErrorCard components, different CSS class prefixes, and different levels of detail shown.",
      "impact": "MEDIUM",
      "total_files": 15,
      "variants": [
        {
          "name": "validation-popover",
          "description": "Compact button + stay-open popover showing top 5 errors with path, message, expected value, and optional auto-fix for additional properties. Used in canonry toolbar.",
          "file_count": 1,
          "files": [
            "apps/canonry/webui/src/components/ValidationPopover.jsx"
          ],
          "sample_file": "apps/canonry/webui/src/components/ValidationPopover.jsx",
          "code_excerpts": [
            {
              "file": "apps/canonry/webui/src/components/ValidationPopover.jsx",
              "start_line": 15,
              "end_line": 51,
              "snippet": "function ErrorCard({ error, isWarning, onRemoveProperty }) {\n  const headerClassName = isWarning ? \"vp-warning-header\" : \"vp-error-header\";\n  const isAdditionalPropError = error.expected?.startsWith(\"no additional property:\");\n  const additionalProp = isAdditionalPropError\n    ? error.expected.replace(\"no additional property: \", \"\").trim()\n    : null;\n  return (\n    <div className=\"vp-error-card\">\n      <div className={headerClassName}>\n        <div className=\"vp-error-path\">{error.path}</div>\n        <div className=\"vp-error-message\">{error.message}</div>\n      </div>\n      <div className=\"vp-error-body\">\n        <div className=\"vp-error-row\">\n          <span className=\"vp-error-label\">Expected:</span>\n          <code className=\"vp-error-value\">{error.expected}</code>\n        </div>\n        {isAdditionalPropError && onRemoveProperty && (\n          <button className=\"vp-remove-button\"\n            onClick={() => onRemoveProperty(error.path, additionalProp)}>\n            Remove \"{additionalProp}\"\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}"
            }
          ],
          "implementation_details": "Features: error/warning color-coding, path breadcrumb, expected value, auto-fix button for 'additional properties' errors, 'View all in Validation tab' link, limited to 5 items with overflow count. CSS prefix: vp-. Unique feature: auto-fix capability for schema validation errors."
        },
        {
          "name": "validation-panel-full-page",
          "description": "Full-page validation panel with separate error and warning sections, each with its own card component. Used in lore-weave config validation before simulation.",
          "file_count": 1,
          "files": [
            "apps/lore-weave/webui/src/components/validation/ValidationPanel.jsx"
          ],
          "sample_file": "apps/lore-weave/webui/src/components/validation/ValidationPanel.jsx",
          "code_excerpts": [
            {
              "file": "apps/lore-weave/webui/src/components/validation/ValidationPanel.jsx",
              "start_line": 10,
              "end_line": 54,
              "snippet": "function ErrorCard({ error }) {\n  return (\n    <div className=\"validation-panel-error-card\">\n      <div className=\"validation-panel-error-header\">\n        <div className=\"validation-panel-error-path\">{error.path}</div>\n        <div className=\"validation-panel-error-message\">{error.message}</div>\n      </div>\n      <div className=\"validation-panel-error-body\">\n        <div className=\"validation-panel-error-row\">\n          <span className=\"validation-panel-error-label\">Expected:</span>\n          <code className=\"validation-panel-error-value\">{error.expected}</code>\n        </div>\n        <div className=\"validation-panel-error-row\">\n          <span className=\"validation-panel-error-label\">Got:</span>\n          <code className=\"validation-panel-error-value\">{JSON.stringify(error.value)}</code>\n        </div>\n        {error.suggestion && (\n          <div className=\"validation-panel-suggestion\">\n            <div className=\"validation-panel-suggestion-label\">Suggestion</div>\n            <div className=\"validation-panel-suggestion-text\">{error.suggestion}</div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction WarningCard({ warning }) {\n  return (\n    <div className=\"validation-panel-warning-card\">\n      ...\n    </div>\n  );\n}"
            }
          ],
          "implementation_details": "Features: separate ErrorCard and WarningCard components, shows 'Got' value (which Popover doesn't), shows 'Suggestion' text, full-page layout. CSS prefix: validation-panel-. Structurally very similar to ValidationPopover's ErrorCard but with different CSS classes and the additional 'Got' field."
        },
        {
          "name": "badge-based-validation",
          "description": "Shared ErrorBadge, OrphanBadge, and TabValidationBadge components showing error counts as colored badges on list cards and tab headers.",
          "file_count": 10,
          "files": [
            "packages/shared-components/src/components/ValidationBadge.jsx",
            "apps/coherence-engine/webui/src/components/generators/cards/GeneratorListCard.jsx",
            "apps/coherence-engine/webui/src/components/actions/cards/ActionListCard.jsx",
            "apps/coherence-engine/webui/src/components/systems/cards/SystemListCard.jsx",
            "apps/coherence-engine/webui/src/components/pressures/cards/PressureCard.jsx",
            "apps/coherence-engine/webui/src/components/generators/GeneratorModal.jsx"
          ],
          "sample_file": "packages/shared-components/src/components/ValidationBadge.jsx",
          "code_excerpts": [
            {
              "file": "packages/shared-components/src/components/ValidationBadge.jsx",
              "start_line": 14,
              "end_line": 51,
              "snippet": "export function ErrorBadge({ count, className = '' }) {\n  if (!count) return null;\n  return (\n    <span className={`badge badge-validation badge-error ${className}`.trim()}>\n      {count} error{count !== 1 ? 's' : ''}\n    </span>\n  );\n}\n\nexport function OrphanBadge({ isOrphan, className = '' }) {\n  if (!isOrphan) return null;\n  return (\n    <span className={`badge badge-validation badge-orphan ${className}`.trim()}>\n      Not in any era\n    </span>\n  );\n}\n\nexport function TabValidationBadge({ count, className = '' }) {\n  if (!count) return null;\n  return (\n    <span className={`badge badge-validation badge-error ${className}`.trim()}>\n      {count}\n    </span>\n  );\n}"
            }
          ],
          "implementation_details": "Simple count-based badges for list views and tab headers. No error details, no drill-down \u2014 just a count to draw attention. Used alongside getElementValidation() utility. CSS: badge badge-validation badge-error."
        },
        {
          "name": "inline-error-div",
          "description": "Simple inline <div> with error class, shown conditionally below the trigger element. Ad-hoc implementations in name-forge and cosmographer.",
          "file_count": 3,
          "files": [
            "apps/name-forge/webui/src/components/generator/GenerateTab.jsx:369",
            "apps/cosmographer/webui/src/components/EntityEditor/index.jsx:242-245"
          ],
          "sample_file": "apps/name-forge/webui/src/components/generator/GenerateTab.jsx",
          "code_excerpts": [
            {
              "file": "apps/name-forge/webui/src/components/generator/GenerateTab.jsx",
              "start_line": 369,
              "end_line": 369,
              "snippet": "{error && <div className=\"error mt-md\">{error}</div>}"
            },
            {
              "file": "apps/cosmographer/webui/src/components/EntityEditor/index.jsx",
              "start_line": 242,
              "end_line": 245,
              "snippet": "{generateError && (\n  <div className=\"ee-generate-error\">{generateError}</div>\n)}"
            }
          ],
          "implementation_details": "Simplest pattern: conditionally render a div with an error message. Different CSS class names across apps. No structured error object \u2014 just a string message. Appropriate for operation errors (generation failures) rather than field validation."
        }
      ],
      "behavior_matrix": {
        "canonry ValidationPopover": {
          "display_type": "stay-open popover",
          "error_fields": "path, message, expected, suggestion",
          "auto_fix": true,
          "max_items": 5,
          "css_prefix": "vp-"
        },
        "lore-weave ValidationPanel": {
          "display_type": "full-page panel",
          "error_fields": "path, message, expected, got, suggestion",
          "auto_fix": false,
          "max_items": "unlimited",
          "css_prefix": "validation-panel-"
        },
        "coherence-engine badges": {
          "display_type": "inline badge on card/tab",
          "error_fields": "count only",
          "auto_fix": false,
          "max_items": "n/a (count)",
          "css_prefix": "badge badge-validation"
        },
        "name-forge/cosmographer inline": {
          "display_type": "inline div below trigger",
          "error_fields": "message string only",
          "auto_fix": false,
          "max_items": 1,
          "css_prefix": "error / ee-generate-error"
        }
      },
      "missing_behavior_complexity": {
        "shared_ErrorCard_component": "moderate \u2014 extract a shared ErrorCard with configurable fields (path, message, expected, got, suggestion, auto-fix callback). Would unify ValidationPopover and ValidationPanel's near-identical ErrorCard implementations.",
        "shared_inline_error_component": "trivial \u2014 standardize the inline error div pattern with a shared component and consistent CSS class"
      },
      "analysis": "This is partially intentional, partially drift. The ValidationPopover (compact, stays open for reference) and ValidationPanel (full-page, comprehensive) serve genuinely different UX needs and should remain separate components. However, their internal ErrorCard components are near-identical \u2014 both show path + message + expected + suggestion, but with different CSS prefixes and one shows 'Got' while the other doesn't. Extracting a shared ErrorCard would reduce 60+ lines of duplication. The badge-based pattern in coherence-engine serves a different purpose (summary counts in lists) and is appropriate as-is. The inline error divs in name-forge/cosmographer are for operation errors (not validation), so the inconsistent CSS classes are minor. User-visible impact is moderate: users editing configs in canonry see a different validation UX than users viewing validation in lore-weave, despite the same underlying validation engine producing the errors.",
      "recommendation": "Extract a shared ErrorCard({ error, isWarning, showGot?, onAutoFix? }) component. Keep ValidationPopover and ValidationPanel as separate containers but have them both use the shared ErrorCard. Standardize inline error display with a shared InlineError component.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "forms"
    },
    {
      "id": "required-field-indicators",
      "name": "Inconsistent Required Field Indication",
      "type": "behavioral",
      "domain": "Form Validation & Input Behavior",
      "description": "Required field indication is inconsistent: some forms use asterisk (*) in labels (StyleLibraryEditor 'Name *', 'Prompt Fragment *'; CreateEntityModal 'Name *'), most forms show no required indicator at all, and no forms use HTML required attributes or aria-required. Validation of required fields happens at submit time via disabled button state rather than inline feedback.",
      "impact": "LOW",
      "total_files": 4,
      "variants": [
        {
          "name": "asterisk-in-label",
          "description": "Required fields marked with ' *' suffix in the label text, plus disabled submit button when required fields are empty",
          "file_count": 2,
          "files": [
            "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx:144-174",
            "apps/illuminator/webui/src/components/CreateEntityModal.tsx:278"
          ],
          "sample_file": "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx",
              "start_line": 143,
              "end_line": 174,
              "snippet": "<div className=\"illuminator-form-group\">\n  <label htmlFor=\"name\" className=\"illuminator-label\">Name *</label>\n  <input id=\"name\" type=\"text\"\n    value={formData.name}\n    onChange={e => handleChange(\"name\", e.target.value)}\n    className=\"illuminator-input\"\n    placeholder=\"e.g., Oil Painting\"\n    autoFocus />\n</div>\n\n<div className=\"illuminator-form-group\">\n  <label className=\"illuminator-label\">Prompt Fragment *\n  <LocalTextArea value={formData.promptFragment}\n    onChange={value => handleChange(\"promptFragment\", value)}\n    className=\"illuminator-textarea\" rows={3} />\n  </label>\n</div>\n\n...\n<button type=\"submit\" disabled={!isValid}\n  className=\"illuminator-btn illuminator-btn-primary\">\n  {isNew ? \"Add Style\" : \"Save Changes\"}\n</button>"
            }
          ],
          "implementation_details": "Asterisk (*) appended to label text. isValid computed from trim() checks on required fields. Submit button disabled when !isValid. No inline error messages \u2014 user only sees disabled button as feedback. No aria-required attribute on inputs."
        },
        {
          "name": "no-indicator",
          "description": "Required fields exist (form won't submit without them) but no visual indicator distinguishes required from optional fields",
          "file_count": 20,
          "files": [
            "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/OverviewTab.jsx",
            "apps/coherence-engine/webui/src/components/actions/tabs/OverviewTab.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/DomainTab.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/LexemesTab.jsx",
            "apps/cosmographer/webui/src/components/EntityEditor/index.jsx",
            "apps/canonry/webui/src/components/SchemaEditor/EntityKindEditor.jsx"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
          "code_excerpts": [
            {
              "file": "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
              "start_line": 43,
              "end_line": 50,
              "snippet": "<div className=\"form-group\">\n  <label htmlFor=\"generator-id\" className=\"label\">Generator ID</label>\n  <input id=\"generator-id\"\n    type=\"text\"\n    value={localId}\n    onChange={(e) => setLocalId(e.target.value)}\n    onBlur={handleIdBlur}\n    className=\"input\"\n  />"
            }
          ],
          "implementation_details": "Generator ID and Name are de facto required (the generator won't work without them) but no visual indicator tells the user this. The coherence-engine's auto-save-on-blur pattern means there's no submit button to disable, so empty fields silently persist as empty strings."
        }
      ],
      "behavior_matrix": {
        "illuminator StyleLibraryEditor": {
          "indicator": "asterisk (*) in label text",
          "validation_timing": "on submit (disabled button)",
          "html_required": false,
          "aria_required": false
        },
        "illuminator CreateEntityModal": {
          "indicator": "asterisk (*) on Name only",
          "validation_timing": "on submit (disabled button)",
          "html_required": false,
          "aria_required": false
        },
        "coherence-engine OverviewTabs": {
          "indicator": "none",
          "validation_timing": "none (auto-save on blur)",
          "html_required": false,
          "aria_required": false
        },
        "name-forge DomainTab": {
          "indicator": "none",
          "validation_timing": "on save button click",
          "html_required": false,
          "aria_required": false
        }
      },
      "missing_behavior_complexity": {
        "consistent_asterisk_pattern": "trivial \u2014 add ' *' to label text for all required fields (~1 char per field)",
        "aria_required_attributes": "trivial \u2014 add aria-required=\"true\" to required inputs (~1 prop per input)"
      },
      "analysis": "This is likely unintentional inconsistency rather than deliberate design choice. The illuminator modals were built with more polish (labeled required fields, disabled submit buttons) while the coherence-engine editor tabs were built for power users who understand which fields are required from context. The absence of HTML required attributes and aria-required across all apps is a consistent gap \u2014 neither the asterisk variant nor the no-indicator variant addresses accessibility. User-visible impact is low for this domain-expert tooling, but it's a standard UX best practice that would improve discoverability. The coherence-engine auto-save pattern creates a unique challenge: there's no submit step where validation could block, so empty required fields silently persist.",
      "recommendation": "Standardize on asterisk (*) for required labels across all form-like interfaces. Add aria-required=\"true\" to all required inputs. For coherence-engine's auto-save pattern, consider a visual cue (e.g., red border) when a required field is empty.",
      "evidence_quality": "medium",
      "status": "pending",
      "source_domain": "forms"
    },
    {
      "id": "form-submission-patterns",
      "name": "Form Submission Pattern Inconsistency",
      "type": "behavioral",
      "domain": "Form Validation & Input Behavior",
      "description": "Forms are submitted through three different mechanisms: (1) HTML <form onSubmit> with e.preventDefault() in illuminator's StyleLibraryEditor (supports Enter-to-submit), (2) button onClick handlers in most modals (CreateEntityModal, DomainTab, LexemesTab), (3) implicit auto-save on blur with no explicit submit in coherence-engine. The HTML form pattern supports Enter-to-submit and proper form semantics; the onClick pattern does not.",
      "impact": "LOW",
      "total_files": 15,
      "variants": [
        {
          "name": "html-form-onsubmit",
          "description": "Proper <form> element with onSubmit handler, e.preventDefault(), type=\"submit\" button. Supports Enter-to-submit keyboard behavior.",
          "file_count": 2,
          "files": [
            "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx:142-178"
          ],
          "sample_file": "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx",
              "start_line": 113,
              "end_line": 142,
              "snippet": "const handleSubmit = e => {\n  e.preventDefault();\n  const result = {\n    id: isNew ? generateStyleId(type) : formData.id,\n    name: formData.name.trim(),\n    promptFragment: formData.promptFragment.trim()\n  };\n  if (formData.description.trim()) {\n    result.description = formData.description.trim();\n  }\n  onSave(result, isNew);\n};\n\n<form onSubmit={handleSubmit} className=\"illuminator-modal-body\">\n  ...\n  <button type=\"submit\" disabled={!isValid}\n    className=\"illuminator-btn illuminator-btn-primary\">\n    {isNew ? \"Add Style\" : \"Save Changes\"}\n  </button>\n</form>"
            }
          ],
          "implementation_details": "Proper HTML form semantics: <form onSubmit> wraps all inputs, type=\"submit\" on primary button, type=\"button\" on cancel. Supports Enter-to-submit in any text field. Trim validation on submit. disabled={!isValid} prevents empty submissions."
        },
        {
          "name": "button-onclick-handler",
          "description": "No <form> element \u2014 modal content uses button with onClick handler for submission. No Enter-to-submit support.",
          "file_count": 10,
          "files": [
            "apps/illuminator/webui/src/components/CreateEntityModal.tsx:164",
            "apps/name-forge/webui/src/components/workspace/tabs/DomainTab.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/LexemesTab.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/CopyGrammarModal.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/CopyLexemeModal.jsx",
            "apps/illuminator/webui/src/components/ChronologyModal.jsx",
            "apps/illuminator/webui/src/components/EntityRenameModal.tsx",
            "apps/illuminator/webui/src/components/DynamicsGenerationModal.jsx",
            "apps/illuminator/webui/src/components/BackportConfigModal.jsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
              "start_line": 161,
              "end_line": 183,
              "snippet": "const canSubmit = effectiveName.trim().length > 0 && kind;\n\nconst handleSubmit = useCallback(() => {\n  if (!canSubmit) return;\n  const entity = {\n    kind,\n    subtype,\n    name: effectiveName.trim(),\n    culture,\n    status,\n    prominence,\n    description,\n    tags,\n    coordinates: editEntity?.coordinates || { x: 0, y: 0, z: 0 },\n  };\n  onSubmit(entity);\n}, [...]);\n\n// Button (not inside a <form>):\n<button onClick={handleSubmit} disabled={!canSubmit}\n  className=\"illuminator-btn illuminator-btn-primary\">\n  {submitLabel}\n</button>"
            }
          ],
          "implementation_details": "No <form> element. Primary action button uses onClick instead of type=\"submit\". canSubmit guards the button's disabled state. Trim validation happens in the handler. Enter-to-submit is NOT supported."
        },
        {
          "name": "implicit-autosave-no-submit",
          "description": "No submit action at all \u2014 changes auto-save on blur (useLocalInputState) or immediately on change. No explicit save/submit button.",
          "file_count": 30,
          "files": [
            "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/OverviewTab.jsx",
            "apps/coherence-engine/webui/src/components/actions/tabs/OverviewTab.jsx",
            "apps/coherence-engine/webui/src/components/pressures/cards/PressureCard.jsx"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
          "code_excerpts": [
            {
              "file": "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
              "start_line": 16,
              "end_line": 26,
              "snippet": "export function OverviewTab({ generator, onChange, onDelete, onDuplicate }) {\n  const updateField = (field, value) => {\n    onChange({ ...generator, [field]: value });\n  };\n\n  const [localId, setLocalId, handleIdBlur] = useLocalInputState(generator.id, (value) =>\n    updateField(\"id\", value)\n  );\n  const [localName, setLocalName, handleNameBlur] = useLocalInputState(generator.name, (value) =>\n    updateField(\"name\", value)\n  );"
            }
          ],
          "implementation_details": "No form element, no submit button. Every field change propagates immediately or on blur. Parent component persists changes through the debounced-save pipeline. This is the coherence-engine's deliberate architectural choice \u2014 all editing is live."
        }
      ],
      "behavior_matrix": {
        "illuminator StyleLibraryEditor": {
          "mechanism": "<form onSubmit>",
          "enter_to_submit": true,
          "explicit_save_button": true,
          "form_semantics": true
        },
        "illuminator CreateEntityModal": {
          "mechanism": "button onClick",
          "enter_to_submit": false,
          "explicit_save_button": true,
          "form_semantics": false
        },
        "coherence-engine editors": {
          "mechanism": "auto-save on blur/change",
          "enter_to_submit": "n/a",
          "explicit_save_button": false,
          "form_semantics": false
        },
        "name-forge modals": {
          "mechanism": "button onClick or 1000ms autosave",
          "enter_to_submit": false,
          "explicit_save_button": "mixed",
          "form_semantics": false
        }
      },
      "missing_behavior_complexity": {
        "wrap_modals_in_form": "trivial \u2014 wrap modal content in <form onSubmit>, change primary button to type=\"submit\" (~3 lines per modal)",
        "enter_to_submit_without_form": "trivial \u2014 add onKeyDown handler checking for Enter key on the modal container"
      },
      "analysis": "This is mostly intentional variation with some drift. The coherence-engine's auto-save pattern is a deliberate architectural choice \u2014 its editor UI is designed for continuous editing without explicit save points. The illuminator modals that use button onClick instead of <form onSubmit> are drift from the StyleLibraryEditor's better pattern. The lack of Enter-to-submit in most modals (CreateEntityModal, EntityRenameModal, etc.) is a minor UX gap \u2014 users filling out a modal with a single text field (like EntityRenameModal) expect Enter to submit. User-visible impact is low but noticeable for keyboard-heavy users. The fix is straightforward: wrap modal body in <form> and use type=\"submit\" on the primary button.",
      "recommendation": "For modals with explicit submit actions, wrap content in <form onSubmit> and use type=\"submit\" on primary buttons to enable Enter-to-submit. Leave coherence-engine's auto-save pattern as-is \u2014 it's intentionally formless.",
      "evidence_quality": "medium",
      "status": "pending",
      "source_domain": "forms"
    },
    {
      "id": "modal-dialog-role-semantics",
      "name": "Modal Overlay ARIA Role Semantics",
      "type": "behavioral",
      "domain": "Keyboard & Accessibility Patterns",
      "description": "Modal overlays across the codebase use role=\"button\" on the backdrop div instead of role=\"dialog\" with aria-modal=\"true\". Only one component in the entire codebase (ImageLightbox.tsx in chronicler) uses the correct role=\"dialog\" + aria-modal pattern. The remaining ~20+ modal overlays all use role=\"button\" on both the backdrop and the inner content div (which has e.stopPropagation()), making them semantically incorrect. Screen readers will announce these as buttons rather than dialogs.",
      "impact": "MEDIUM",
      "total_files": 22,
      "variants": [
        {
          "name": "role-dialog-with-aria-modal",
          "description": "Correct semantic: role=\"dialog\" + aria-modal=\"true\" + aria-label on the overlay container. The only implementation in the entire codebase that follows ARIA dialog pattern.",
          "file_count": 1,
          "files": [
            "apps/chronicler/webui/src/components/ImageLightbox.tsx:56-64"
          ],
          "sample_file": "apps/chronicler/webui/src/components/ImageLightbox.tsx",
          "code_excerpts": [
            {
              "file": "apps/chronicler/webui/src/components/ImageLightbox.tsx",
              "start_line": 56,
              "end_line": 64,
              "snippet": "<div\n  className={styles.overlay}\n  onMouseDown={handleOverlayMouseDown}\n  onClick={handleOverlayClick}\n  role=\"dialog\"\n  aria-modal=\"true\"\n  aria-label={title || \"Image viewer\"}\n  tabIndex={0}\n  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n>"
            }
          ],
          "implementation_details": "Uses role=\"dialog\" with aria-modal=\"true\" and aria-label. Has escape key handler via global useEffect listener and scroll lock with previous-value preservation. This is the only ARIA-correct dialog in the codebase."
        },
        {
          "name": "role-button-on-overlay",
          "description": "Semantically incorrect: role=\"button\" on the modal overlay backdrop, plus role=\"button\" on the inner content div (which only exists for e.stopPropagation()). Screen readers announce these as nested buttons.",
          "file_count": 21,
          "files": [
            "packages/shared-components/src/components/ModalShell.jsx:76-77",
            "apps/illuminator/webui/src/components/ImageModal.jsx:197-204",
            "apps/illuminator/webui/src/components/ChronicleWizard/ChronicleWizard.tsx",
            "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
            "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx",
            "apps/illuminator/webui/src/components/ImageSettingsDrawer.tsx",
            "apps/illuminator/webui/src/components/ActivityPanel.jsx",
            "apps/illuminator/webui/src/components/preprint/ContentTreeView.tsx",
            "apps/cosmographer/webui/src/components/SemanticPlane/index.jsx",
            "apps/cosmographer/webui/src/components/AxisRegistry/index.jsx",
            "apps/cosmographer/webui/src/components/RelationshipEditor/index.jsx",
            "apps/canonry/webui/src/App.jsx",
            "apps/canonry/webui/src/components/HelpModal.jsx",
            "apps/lore-weave/webui/src/components/DebugSettingsModal.jsx",
            "apps/archivist/webui/src/components/RelationshipStoryModal.tsx",
            "apps/coherence-engine/webui/src/components/pressures/modals/FactorEditorModal.jsx",
            "apps/illuminator/webui/src/components/QuickCheckModal.jsx",
            "apps/illuminator/webui/src/components/ChronologyModal.jsx",
            "apps/illuminator/webui/src/components/EraNarrativeModal.jsx",
            "apps/illuminator/webui/src/components/EntityRenameModal.tsx",
            "apps/name-forge/webui/src/components/optimizer/ResultsModal.jsx"
          ],
          "sample_file": "packages/shared-components/src/components/ModalShell.jsx",
          "code_excerpts": [
            {
              "file": "packages/shared-components/src/components/ModalShell.jsx",
              "start_line": 76,
              "end_line": 77,
              "snippet": "<div className=\"modal-overlay\" onMouseDown={handleOverlayMouseDown} onClick={handleOverlayClick} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }} >\n  <div className={`modal ${className}`.trim()} onClick={(e) => e.stopPropagation()} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >"
            },
            {
              "file": "apps/illuminator/webui/src/components/ImageModal.jsx",
              "start_line": 197,
              "end_line": 204,
              "snippet": "<div className=\"imod-overlay\" onMouseDown={handleOverlayMouseDown} onClick={handleOverlayClick} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }} >\n  <div className={`imod-header ...`} onClick={(e) => e.stopPropagation()} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }} >"
            }
          ],
          "implementation_details": "Every modal that uses ModalShell inherits this pattern. Additionally, many custom modals that bypass ModalShell also manually replicate role=\"button\" on overlays. The inner content div receives role=\"button\" + e.stopPropagation() which is semantically wrong \u2014 it's not a button, it's a dialog container."
        }
      ],
      "behavior_matrix": {
        "ModalShell (shared)": {
          "overlay_role": "role=\"button\" (incorrect)",
          "content_role": "role=\"button\" (incorrect)",
          "aria_modal": false,
          "aria_label": false
        },
        "ImageLightbox (chronicler)": {
          "overlay_role": "role=\"dialog\" (correct)",
          "content_role": "N/A (content inside dialog)",
          "aria_modal": true,
          "aria_label": "aria-label={title || 'Image viewer'}"
        },
        "ImageModal (illuminator)": {
          "overlay_role": "role=\"button\" (incorrect)",
          "content_role": "role=\"button\" (incorrect)",
          "aria_modal": false,
          "aria_label": false
        }
      },
      "missing_behavior_complexity": {
        "role_dialog_on_overlay": "trivial \u2014 change role=\"button\" to role=\"dialog\" + add aria-modal=\"true\" on ModalShell (1 file fix propagates to ~10 consumers)",
        "aria_label_on_modals": "trivial \u2014 add aria-label={title} prop pass-through in ModalShell, already has title prop",
        "remove_role_button_from_inner_div": "trivial \u2014 remove role/tabIndex/onKeyDown from inner content div, replace with role=\"document\" or remove entirely"
      },
      "analysis": "This is clear drift, not intentional variation. ImageLightbox in chronicler was likely written by someone aware of ARIA dialog semantics, while ModalShell and all other modals use role=\"button\" as a mechanical lint-fix for clickable divs without considering the semantic meaning. The user-visible impact is that screen readers announce modal overlays as \"button\" instead of \"dialog\", breaking the modal mental model for assistive technology users. The fix should target ModalShell first (role=\"dialog\" + aria-modal=\"true\" + aria-label={title}), which would propagate to ~10 consumers. Custom modals should follow suit. The inner content div should have its role=\"button\" removed entirely.",
      "recommendation": "Update ModalShell overlay to use role=\"dialog\" aria-modal=\"true\" aria-label={title}. Remove role/tabIndex/onKeyDown from the inner content div. Add an eslint rule against role=\"button\" on elements with modal-overlay CSS classes.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "keyboard-a11y"
    },
    {
      "id": "toggle-switch-semantics",
      "name": "Toggle/Switch ARIA Semantics",
      "type": "behavioral",
      "domain": "Keyboard & Accessibility Patterns",
      "description": "The shared EnableToggle component uses role=\"button\" instead of role=\"switch\" with aria-checked. This means screen readers cannot communicate the on/off state of toggles \u2014 users only hear \"button\" with no indication of the current value. Zero files in the codebase use role=\"switch\" or aria-checked anywhere. The toggle's visual state (CSS class toggle-on) is invisible to assistive technology.",
      "impact": "MEDIUM",
      "total_files": 5,
      "variants": [
        {
          "name": "role-button-toggle",
          "description": "Toggle uses role=\"button\" without aria-checked. Screen readers announce it as a generic button with no state information.",
          "file_count": 5,
          "files": [
            "packages/shared-components/src/components/EnableToggle.jsx:27-35",
            "apps/coherence-engine/webui/src/components/generators/cards/GeneratorListCard.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/cards/SystemListCard.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/OverviewTab.jsx"
          ],
          "sample_file": "packages/shared-components/src/components/EnableToggle.jsx",
          "code_excerpts": [
            {
              "file": "packages/shared-components/src/components/EnableToggle.jsx",
              "start_line": 27,
              "end_line": 35,
              "snippet": "<div\n  onClick={handleClick}\n  className={`toggle ${enabled ? 'toggle-on' : ''}`}\n  role=\"button\"\n  tabIndex={0}\n  onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleClick(e); }}\n>\n  <div className=\"toggle-knob\" />\n</div>"
            }
          ],
          "implementation_details": "The EnableToggle shared component renders a visual toggle (sliding knob) but uses role=\"button\" instead of role=\"switch\". The enabled prop controls the CSS class toggle-on for visual styling but is never communicated to assistive technology via aria-checked. All 4 call sites in coherence-engine inherit this limitation."
        }
      ],
      "behavior_matrix": {
        "EnableToggle (shared)": {
          "role": "role=\"button\" (should be role=\"switch\")",
          "aria_checked": false,
          "keyboard_activation": "Enter/Space via onKeyDown",
          "visual_state": "CSS class toggle-on"
        }
      },
      "missing_behavior_complexity": {
        "role_switch": "trivial \u2014 change role=\"button\" to role=\"switch\" (1 line in 1 file)",
        "aria_checked": "trivial \u2014 add aria-checked={enabled} (1 line in 1 file)"
      },
      "analysis": "This is not drift (there's only one implementation) but rather a missing accessibility pattern on the canonical shared component. The EnableToggle visually communicates a binary state via a sliding knob, which is the classic switch pattern. Using role=\"button\" means screen readers announce it generically as \"button\" with no state indication, rather than \"switch, on\" or \"switch, off\". The fix is a 2-line change to the shared component (role=\"switch\" + aria-checked={enabled}), which propagates to all consumers automatically.",
      "recommendation": "Change EnableToggle to use role=\"switch\" aria-checked={enabled}. Also add an aria-label prop defaulting to the existing label text if provided.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "keyboard-a11y"
    },
    {
      "id": "collapsible-section-aria-expanded",
      "name": "Collapsible Section aria-expanded Consistency",
      "type": "behavioral",
      "domain": "Keyboard & Accessibility Patterns",
      "description": "56 files implement expand/collapse patterns (via expanded/setExpanded state, ExpandableCard component, or custom expand icons). Only 1 file (WikiNav.tsx in chronicler) uses aria-expanded on the toggle button to communicate the expanded state to assistive technology. The remaining 55 files, including the shared ExpandableCard component, visually show expanded/collapsed state (via arrow icon rotation) but never communicate it to screen readers.",
      "impact": "MEDIUM",
      "total_files": 56,
      "variants": [
        {
          "name": "aria-expanded-on-button",
          "description": "Correct pattern: native <button> elements with aria-expanded={boolean} communicating collapsed/expanded state to assistive technology.",
          "file_count": 1,
          "files": [
            "apps/chronicler/webui/src/components/WikiNav.tsx:191-195",
            "apps/chronicler/webui/src/components/WikiNav.tsx:231-235",
            "apps/chronicler/webui/src/components/WikiNav.tsx:400-404"
          ],
          "sample_file": "apps/chronicler/webui/src/components/WikiNav.tsx",
          "code_excerpts": [
            {
              "file": "apps/chronicler/webui/src/components/WikiNav.tsx",
              "start_line": 191,
              "end_line": 196,
              "snippet": "<button\n  className={styles.sectionTitleCollapsible}\n  onClick={() => setLoreExpanded(!loreExpanded)}\n  aria-expanded={loreExpanded}\n>\n  <span className={styles.collapseIcon}>{loreExpanded ? \"\u25bc\" : \"\u25b6\"}</span>"
            }
          ],
          "implementation_details": "WikiNav uses native <button> elements with aria-expanded for its 3 collapsible sections (Lore, era groups, Appendices). This is the only file in the entire codebase that communicates collapsed/expanded state to assistive technology."
        },
        {
          "name": "visual-only-expand-via-shared-component",
          "description": "ExpandableCard shared component: uses a clickable div with role=\"button\" and a rotated arrow icon to indicate state. No aria-expanded attribute. All consumers (~20+ files) inherit this limitation.",
          "file_count": 20,
          "files": [
            "packages/shared-components/src/components/ExpandableCard.jsx:40-41",
            "apps/coherence-engine/webui/src/components/generators/GeneratorsEditor.jsx",
            "apps/coherence-engine/webui/src/components/systems/SystemsEditor.jsx",
            "apps/coherence-engine/webui/src/components/pressures/PressuresEditor.jsx",
            "apps/coherence-engine/webui/src/components/eras/ErasEditor.jsx",
            "apps/coherence-engine/webui/src/components/validation/cards/IssueCard.jsx",
            "apps/coherence-engine/webui/src/components/dependency-viewer/components/DependencySection.jsx",
            "apps/canonry/webui/src/components/SchemaEditor/EntityKindEditor.jsx",
            "apps/canonry/webui/src/components/SchemaEditor/RelationshipKindEditor.jsx",
            "apps/canonry/webui/src/components/SchemaEditor/CultureEditor.jsx",
            "apps/canonry/webui/src/components/SchemaEditor/TagRegistryEditor.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/DomainTab.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/GrammarsTab.jsx",
            "apps/illuminator/webui/src/components/EntityDetailView.tsx",
            "apps/illuminator/webui/src/components/HistorianMarginNotes.jsx",
            "apps/illuminator/webui/src/components/CoveragePanel.jsx",
            "apps/illuminator/webui/src/components/EntityCoveragePanel.jsx",
            "apps/illuminator/webui/src/components/CohesionReportViewer.jsx",
            "apps/archivist/webui/src/components/DiscoveryStory.tsx",
            "apps/archivist/webui/src/components/TimelineControl.tsx"
          ],
          "sample_file": "packages/shared-components/src/components/ExpandableCard.jsx",
          "code_excerpts": [
            {
              "file": "packages/shared-components/src/components/ExpandableCard.jsx",
              "start_line": 40,
              "end_line": 55,
              "snippet": "<div className={`expandable-card ${className}`.trim()}>\n  <div className=\"expandable-card-header\" onClick={handleToggle} role=\"button\" tabIndex={0} onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleToggle(); }} >\n    <div className=\"expandable-card-left\">\n      <span className={`expand-icon ${expanded ? 'expand-icon-expanded' : 'expand-icon-collapsed'}`}>\u25b6</span>\n      <div className=\"expandable-card-title\">\n        <span className=\"expandable-card-name\">{title}</span>\n        {subtitle && <span className=\"expandable-card-id\">{subtitle}</span>}\n      </div>\n    </div>\n    {actions && <div className=\"expandable-card-actions\">{actions}</div>}\n  </div>\n  {expanded && <div className=\"expandable-card-content\">{children}</div>}\n</div>"
            }
          ],
          "implementation_details": "The ExpandableCard shared component has role=\"button\" and tabIndex={0} on the header div, plus a rotated arrow icon to show state visually. But it lacks aria-expanded={expanded}. All consumers (~20 files across coherence-engine, canonry, name-forge, illuminator, archivist) inherit this limitation."
        },
        {
          "name": "visual-only-expand-custom",
          "description": "Custom expand/collapse implementations (not using ExpandableCard) that visually show state via arrow icons or toggle buttons but lack aria-expanded.",
          "file_count": 35,
          "files": [
            "apps/illuminator/webui/src/components/WorldContextEditor.jsx",
            "apps/illuminator/webui/src/components/EventsPanel.jsx",
            "apps/illuminator/webui/src/components/ImageModal.jsx",
            "apps/illuminator/webui/src/components/ImagePickerModal.jsx",
            "apps/illuminator/webui/src/components/ChronicleReviewPanel.jsx",
            "apps/illuminator/webui/src/components/CorpusFindReplace.tsx",
            "apps/illuminator/webui/src/components/DescriptionMotifWeaver.tsx",
            "apps/illuminator/webui/src/components/TraitPaletteSection.tsx",
            "apps/illuminator/webui/src/components/ChronologyModal.jsx",
            "apps/illuminator/webui/src/components/SummaryRevisionModal.jsx",
            "apps/illuminator/webui/src/components/EntityRenameModal.tsx",
            "apps/illuminator/webui/src/components/HistorianEditionComparison.tsx",
            "apps/illuminator/webui/src/components/chronicle-workspace/ContentTab.jsx",
            "apps/illuminator/webui/src/components/chronicle-workspace/ReferenceTab.jsx",
            "apps/illuminator/webui/src/components/BackrefImageEditor.jsx",
            "apps/illuminator/webui/src/components/EnrichmentQueue.jsx",
            "apps/lore-weave/webui/src/components/dashboard/LogStream.jsx",
            "apps/lore-weave/webui/src/components/dashboard/TemplateUsage.jsx",
            "apps/cosmographer/webui/src/components/CultureEditor/index.jsx",
            "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityRuleCard.jsx",
            "apps/coherence-engine/webui/src/components/generators/filters/SelectionFilterCard.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/RelationshipsTab.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/VariablesTab.jsx",
            "apps/coherence-engine/webui/src/components/pressures/cards/PressureCard.jsx",
            "apps/coherence-engine/webui/src/components/shared/MutationCard.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/ConnectionEvolutionTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/ThresholdTriggerTab.jsx",
            "apps/coherence-engine/webui/src/components/actions/tabs/VariablesTab.jsx",
            "apps/coherence-engine/webui/src/components/eras/EraCard.jsx",
            "apps/name-forge/webui/src/components/optimizer/OptimizerWorkshop.jsx",
            "apps/name-forge/webui/src/components/optimizer/ResultsModal.jsx",
            "apps/chronicler/webui/src/components/EntityTimeline.tsx",
            "apps/archivist/webui/src/components/EntityDetail.tsx",
            "apps/illuminator/webui/src/components/HistorianConfigEditor.jsx"
          ],
          "sample_file": "apps/lore-weave/webui/src/components/dashboard/TemplateUsage.jsx",
          "code_excerpts": [
            {
              "file": "apps/lore-weave/webui/src/components/dashboard/TemplateUsage.jsx",
              "start_line": 0,
              "end_line": 0,
              "snippet": "// Typical custom expand pattern across the codebase:\n<div className=\"section-header\" onClick={() => setExpanded(!expanded)} role=\"button\" tabIndex={0} onKeyDown={...}>\n  <span className={expanded ? 'expand-icon-expanded' : 'expand-icon-collapsed'}>\u25b6</span>\n  <span>Section Title</span>\n</div>\n{expanded && <div className=\"section-content\">...</div>}"
            }
          ],
          "implementation_details": "35+ files implement custom expand/collapse without using ExpandableCard. All use visual indicators (arrow rotation, text change) but none include aria-expanded. Many use role=\"button\" + tabIndex={0} for keyboard access."
        }
      ],
      "behavior_matrix": {
        "WikiNav (chronicler)": {
          "element": "native <button>",
          "aria_expanded": true,
          "visual_indicator": "text change (\u25bc/\u25b6)",
          "keyboard": "native button (Enter/Space)"
        },
        "ExpandableCard (shared)": {
          "element": "div with role=\"button\"",
          "aria_expanded": false,
          "visual_indicator": "\u25b6 icon with CSS rotation",
          "keyboard": "Enter/Space via onKeyDown"
        },
        "Custom expand patterns (35 files)": {
          "element": "div with role=\"button\" or native button",
          "aria_expanded": false,
          "visual_indicator": "\u25b6/\u25bc text or icon",
          "keyboard": "Enter/Space via onKeyDown"
        }
      },
      "missing_behavior_complexity": {
        "aria_expanded_on_ExpandableCard": "trivial \u2014 add aria-expanded={expanded} to the header div in ExpandableCard (1 line, propagates to ~20 consumers)",
        "aria_expanded_on_custom_sections": "moderate \u2014 35 individual files need aria-expanded added to their expand toggle element; no shared abstraction to fix"
      },
      "analysis": "This is clear drift. WikiNav in chronicler correctly implements aria-expanded on collapsible sections, while all other 55 files across every app omit it. The shared ExpandableCard component is the highest-leverage fix point \u2014 adding aria-expanded={expanded} to its header div would immediately fix ~20 consumers. The remaining 35 custom implementations would need individual fixes. The user-visible impact is that screen reader users cannot determine whether a section is collapsed or expanded \u2014 they can activate the toggle but have no feedback about the resulting state. This is a W3C ARIA authoring practices requirement for disclosure widgets.",
      "recommendation": "Add aria-expanded={expanded} to ExpandableCard header div \u2014 this is a 1-line fix propagating to ~20 consumers. For custom implementations, consider extracting a useExpandable hook or converting them to use ExpandableCard. Add an eslint rule: any element with expand-icon or expand/collapse CSS classes must have aria-expanded.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "keyboard-a11y"
    },
    {
      "id": "search-keyboard-navigation-duplication",
      "name": "Search Keyboard Navigation Duplication",
      "type": "behavioral",
      "domain": "Keyboard & Accessibility Patterns",
      "description": "Two search components implement nearly identical arrow-key navigation (ArrowUp/ArrowDown to move selection, Enter to select, Escape to close) but with different code structures and subtly different Escape behavior. HeaderSearch (viewer) extracts this into a reusable useKeyboardNavigation hook, while WikiSearch (chronicler) duplicates the same logic inline. Their Escape behaviors also diverge: HeaderSearch clears the query and closes; WikiSearch closes the dropdown but preserves the query text.",
      "impact": "LOW",
      "total_files": 2,
      "variants": [
        {
          "name": "extracted-hook-escape-clears",
          "description": "Arrow-key navigation extracted into a useKeyboardNavigation custom hook. Escape clears the search query and closes the dropdown.",
          "file_count": 1,
          "files": [
            "apps/viewer/webui/src/HeaderSearch.jsx:92-117"
          ],
          "sample_file": "apps/viewer/webui/src/HeaderSearch.jsx",
          "code_excerpts": [
            {
              "file": "apps/viewer/webui/src/HeaderSearch.jsx",
              "start_line": 92,
              "end_line": 117,
              "snippet": "function useKeyboardNavigation(results, selectedIndex, setSelectedIndex, onSelect) {\n  return useCallback(\n    (e) => {\n      if (results.length === 0) return;\n      switch (e.key) {\n        case \"ArrowDown\":\n          e.preventDefault();\n          setSelectedIndex((i) => Math.min(i + 1, results.length - 1));\n          break;\n        case \"ArrowUp\":\n          e.preventDefault();\n          setSelectedIndex((i) => Math.max(i - 1, 0));\n          break;\n        case \"Enter\":\n          e.preventDefault();\n          if (results[selectedIndex]) onSelect(results[selectedIndex].item.id);\n          break;\n        case \"Escape\":\n          onSelect(null);\n          break;\n      }\n    },\n    [results, selectedIndex, setSelectedIndex, onSelect]\n  );\n}"
            }
          ],
          "implementation_details": "Extracts keyboard navigation into a reusable useKeyboardNavigation hook that returns a useCallback handler. Escape calls onSelect(null) which triggers full close + query clear in the parent's handleSelect callback. The hook is generic enough to be reused."
        },
        {
          "name": "inline-handler-escape-preserves-query",
          "description": "Arrow-key navigation implemented as an inline handleKeyDown function. Escape closes the dropdown but preserves the search query text in the input.",
          "file_count": 1,
          "files": [
            "apps/chronicler/webui/src/components/WikiSearch.tsx:55-79"
          ],
          "sample_file": "apps/chronicler/webui/src/components/WikiSearch.tsx",
          "code_excerpts": [
            {
              "file": "apps/chronicler/webui/src/components/WikiSearch.tsx",
              "start_line": 55,
              "end_line": 79,
              "snippet": "const handleKeyDown = (e: React.KeyboardEvent) => {\n  if (!isOpen || results.length === 0) return;\n  switch (e.key) {\n    case \"ArrowDown\":\n      e.preventDefault();\n      setSelectedIndex((i) => Math.min(i + 1, results.length - 1));\n      break;\n    case \"ArrowUp\":\n      e.preventDefault();\n      setSelectedIndex((i) => Math.max(i - 1, 0));\n      break;\n    case \"Enter\":\n      e.preventDefault();\n      if (results[selectedIndex]) {\n        onSelect(results[selectedIndex].item.id);\n        setIsOpen(false);\n        onQueryChange(\"\");\n      }\n      break;\n    case \"Escape\":\n      setIsOpen(false);\n      break;\n  }\n};"
            }
          ],
          "implementation_details": "Inline handleKeyDown function, not wrapped in useCallback. Escape only calls setIsOpen(false) \u2014 the query text remains in the input. The early return guard (!isOpen || results.length === 0) means Escape does nothing when there are no results, unlike HeaderSearch which always handles Escape."
        }
      ],
      "behavior_matrix": {
        "HeaderSearch (viewer)": {
          "code_structure": "useKeyboardNavigation custom hook + useCallback",
          "arrow_keys": "ArrowUp/ArrowDown with Math.min/max bounds",
          "enter": "onSelect(results[selectedIndex].item.id)",
          "escape": "onSelect(null) \u2014 clears query + closes",
          "guard": "results.length === 0 early return"
        },
        "WikiSearch (chronicler)": {
          "code_structure": "inline handleKeyDown function, no useCallback",
          "arrow_keys": "ArrowUp/ArrowDown with Math.min/max bounds",
          "enter": "onSelect(...) + setIsOpen(false) + onQueryChange('')",
          "escape": "setIsOpen(false) only \u2014 query preserved",
          "guard": "!isOpen || results.length === 0 early return"
        }
      },
      "missing_behavior_complexity": {
        "shared_hook": "moderate \u2014 extract useKeyboardNavigation to shared-components or a shared hooks package, decide on canonical Escape behavior (clear vs preserve), update both consumers"
      },
      "analysis": "This is structural duplication with a subtle behavioral divergence. The arrow-key navigation logic is identical between the two files, differing only in code organization (extracted hook vs inline) and Escape behavior (clear-all vs close-only). The Escape behavior difference may be intentional \u2014 HeaderSearch is a global search bar where clearing on Escape makes sense, while WikiSearch is a sidebar search where preserving the query lets users refine. However, the code duplication is unnecessary since the shared hook could accept a configuration parameter for Escape behavior. The user-visible impact is minor (slightly different Escape semantics in two search inputs), but consolidating the code would prevent future divergence.",
      "recommendation": "Move useKeyboardNavigation from HeaderSearch to shared-components with an onEscape callback parameter. WikiSearch and HeaderSearch can each pass their preferred Escape behavior.",
      "evidence_quality": "high",
      "status": "completed",
      "source_domain": "keyboard-a11y"
    },
    {
      "id": "scroll-lock-overflow-restore",
      "name": "Body Scroll Lock Restore Pattern Inconsistency",
      "type": "behavioral",
      "domain": "Keyboard & Accessibility Patterns",
      "description": "Components that lock body scroll (overflow: hidden) on mount use two different restore strategies: (A) restore to empty string '' \u2014 used by ImageModal and ChronicleWizard, and (B) save previous overflow value and restore it \u2014 used by ModalShell and ImageLightbox. Pattern A can clobber a previous overflow setting if modals are stacked.",
      "impact": "LOW",
      "total_files": 4,
      "variants": [
        {
          "name": "restore-to-empty-string",
          "description": "Sets document.body.style.overflow = 'hidden' on mount, restores to '' on cleanup. Does not preserve any previous overflow value.",
          "file_count": 2,
          "files": [
            "apps/illuminator/webui/src/components/ImageModal.jsx:179-190",
            "apps/illuminator/webui/src/components/ChronicleWizard/ChronicleWizard.tsx:158-174"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ImageModal.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/ImageModal.jsx",
              "start_line": 179,
              "end_line": 190,
              "snippet": "useEffect(() => {\n  if (isOpen) {\n    document.addEventListener(\"keydown\", handleKeyDown);\n    document.body.style.overflow = \"hidden\";\n  }\n  return () => {\n    document.removeEventListener(\"keydown\", handleKeyDown);\n    document.body.style.overflow = \"\";\n  };\n}, [isOpen, handleKeyDown]);"
            },
            {
              "file": "apps/illuminator/webui/src/components/ChronicleWizard/ChronicleWizard.tsx",
              "start_line": 158,
              "end_line": 174,
              "snippet": "useEffect(() => {\n  if (!isOpen) return;\n  const handleKeyDown = (e: KeyboardEvent) => {\n    if (e.key === \"Escape\") { handleClose(); }\n  };\n  document.addEventListener(\"keydown\", handleKeyDown);\n  document.body.style.overflow = \"hidden\";\n  return () => {\n    document.removeEventListener(\"keydown\", handleKeyDown);\n    document.body.style.overflow = \"\";\n  };\n}, [isOpen, handleClose]);"
            }
          ],
          "implementation_details": "Both files set overflow to '' on cleanup instead of restoring the saved previous value. This is incorrect if the page already had overflow: hidden or overflow: auto before the modal opened."
        },
        {
          "name": "save-and-restore-previous",
          "description": "Saves document.body.style.overflow before setting hidden, restores the saved value on cleanup.",
          "file_count": 2,
          "files": [
            "packages/shared-components/src/components/ModalShell.jsx:59-63",
            "apps/chronicler/webui/src/components/ImageLightbox.tsx:41-49"
          ],
          "sample_file": "apps/chronicler/webui/src/components/ImageLightbox.tsx",
          "code_excerpts": [
            {
              "file": "apps/chronicler/webui/src/components/ImageLightbox.tsx",
              "start_line": 41,
              "end_line": 49,
              "snippet": "useEffect(() => {\n  if (!isOpen) return undefined;\n  document.addEventListener(\"keydown\", handleKeyDown);\n  const previousOverflow = document.body.style.overflow;\n  document.body.style.overflow = \"hidden\";\n  return () => {\n    document.removeEventListener(\"keydown\", handleKeyDown);\n    document.body.style.overflow = previousOverflow;\n  };\n}, [isOpen, handleKeyDown]);"
            },
            {
              "file": "packages/shared-components/src/components/ModalShell.jsx",
              "start_line": 59,
              "end_line": 63,
              "snippet": "useEffect(() => {\n  const prev = document.body.style.overflow;\n  document.body.style.overflow = 'hidden';\n  return () => { document.body.style.overflow = prev; };\n}, []);"
            }
          ],
          "implementation_details": "ModalShell and ImageLightbox both correctly save the previous overflow value and restore it on cleanup. ModalShell uses a simpler form (runs once on mount), while ImageLightbox guards on isOpen."
        }
      ],
      "behavior_matrix": {
        "ModalShell (shared)": {
          "scroll_lock": true,
          "restore_strategy": "save previous, restore on cleanup (correct)"
        },
        "ImageModal (illuminator)": {
          "scroll_lock": true,
          "restore_strategy": "restore to empty string (incorrect for nested modals)"
        },
        "ChronicleWizard (illuminator)": {
          "scroll_lock": true,
          "restore_strategy": "restore to empty string (incorrect for nested modals)"
        },
        "ImageLightbox (chronicler)": {
          "scroll_lock": true,
          "restore_strategy": "save previous, restore on cleanup (correct)"
        }
      },
      "missing_behavior_complexity": {
        "fix_restore_pattern": "trivial \u2014 save previousOverflow before setting hidden, restore it in cleanup (2-line change per file)"
      },
      "analysis": "ModalShell and ImageLightbox correctly save and restore the previous overflow value, while ImageModal and ChronicleWizard (which bypass ModalShell and implement their own scroll lock) blindly restore to empty string. This is drift caused by ad-hoc reimplementation \u2014 when these components built their own modal infrastructure, they didn't copy the correct save/restore pattern from ModalShell. The user-visible impact is low in practice because modals are rarely stacked in this app, but the pattern is technically incorrect and could cause scroll jumping if body had a non-default overflow value. The fix is trivial: save previousOverflow before setting hidden.\n\nAlso noted by behavioral audit: This is a subtle but real UX bug that manifests when modals are stacked. The codebase does support modal stacking (e.g., QuickCheckModal can trigger CreateEntityModal, and ChronicleWizard has sub-modals), so the incorrect restoration pattern can produce visible artifacts. ModalShell and ImageLightbox correctly preserve the previous value; the four illuminator custom modals use the reset-to-empty pattern. Since ModalShell already has the correct behavior, migration eliminates this bug automatically. For any remaining custom modals, the fix is a one-line change: capture `const prev = document.body.style.overflow` before setting to 'hidden'.",
      "recommendation": "Update ImageModal and ChronicleWizard to save/restore previous overflow value, matching the ModalShell and ImageLightbox pattern. Consider extracting a useScrollLock hook to shared-components to prevent future drift.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "keyboard-a11y",
      "merged_from": [
        "modal-scroll-lock-restoration"
      ]
    },
    {
      "id": "listbox-option-role-incomplete",
      "name": "Incomplete Listbox/Option ARIA Pattern",
      "type": "behavioral",
      "domain": "Keyboard & Accessibility Patterns",
      "description": "ChroniclePanel's entity suggestion dropdown uses role=\"option\" on items but lacks a parent role=\"listbox\" container, tabIndex on options, and keyboard navigation. The SearchableDropdown shared component has a similar dropdown pattern but uses role=\"button\" on options instead. Neither implements the ARIA listbox pattern correctly.",
      "impact": "LOW",
      "total_files": 3,
      "variants": [
        {
          "name": "role-option-without-listbox",
          "description": "Uses role=\"option\" on suggestion items but lacks the required parent role=\"listbox\" container. No tabIndex or keyboard navigation on option elements.",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChroniclePanel.jsx:2036-2041"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
              "start_line": 2036,
              "end_line": 2041,
              "snippet": "{showEntitySuggestions && entitySuggestions.length > 0 && <div className=\"chron-filter-bar-suggestions\">\n  {entitySuggestions.map(entity => <div key={entity.id} role=\"option\" onMouseDown={e => {\n    e.preventDefault();\n    setEntitySearchQuery(entity.name || \"\");\n    setEntitySearchSelectedId(entity.id);\n  }}>"
            }
          ],
          "implementation_details": "The suggestions container div has no role=\"listbox\", which is required when children use role=\"option\". Options use onMouseDown (not onClick) with no tabIndex or keyboard navigation. Screen readers will see orphaned role=\"option\" elements outside a listbox context."
        },
        {
          "name": "role-button-on-dropdown-options",
          "description": "SearchableDropdown and ChipSelect shared components use role=\"button\" + tabIndex={0} + onKeyDown on each dropdown option. Not semantically ideal (should be listbox/option) but at least keyboard accessible.",
          "file_count": 2,
          "files": [
            "packages/shared-components/src/components/SearchableDropdown.jsx:93-104",
            "packages/shared-components/src/components/ChipSelect.jsx:109-119"
          ],
          "sample_file": "packages/shared-components/src/components/SearchableDropdown.jsx",
          "code_excerpts": [
            {
              "file": "packages/shared-components/src/components/SearchableDropdown.jsx",
              "start_line": 93,
              "end_line": 104,
              "snippet": "filteredItems.map((item) => (\n  <div\n    key={item.id}\n    className=\"dropdown-option\"\n    onClick={() => handleSelect(item)}\n    role=\"button\"\n    tabIndex={0}\n    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click(); }}\n  >\n    {item.name || item.id}\n  </div>\n))"
            }
          ],
          "implementation_details": "Uses role=\"button\" on each option (not role=\"option\"), with keyboard activation via Enter/Space. No arrow-key navigation between options \u2014 users must Tab through each option individually. No Escape key to close the dropdown."
        }
      ],
      "behavior_matrix": {
        "ChroniclePanel entity suggestions": {
          "container_role": "none (should be listbox)",
          "option_role": "role=\"option\" (correct role, wrong context)",
          "keyboard_nav": "none",
          "tabIndex": "none",
          "close_on_escape": false
        },
        "SearchableDropdown (shared)": {
          "container_role": "none (should be listbox)",
          "option_role": "role=\"button\" (should be option)",
          "keyboard_nav": "Tab only (no arrow keys)",
          "tabIndex": "tabIndex={0} on each option",
          "close_on_escape": false
        },
        "ChipSelect (shared)": {
          "container_role": "none (should be listbox)",
          "option_role": "role=\"button\" (should be option)",
          "keyboard_nav": "Tab only (no arrow keys)",
          "tabIndex": "tabIndex={0} on each option",
          "close_on_escape": false
        }
      },
      "missing_behavior_complexity": {
        "listbox_pattern": "moderate \u2014 add role=\"listbox\" to container, role=\"option\" to items, aria-activedescendant on the input, and arrow-key navigation handler",
        "escape_to_close": "trivial \u2014 add Escape key handler in the dropdown's keydown listener"
      },
      "analysis": "This is drift between two components that serve the same purpose (suggestion/option selection) but implement ARIA differently. ChroniclePanel uses the semantically correct role=\"option\" but in the wrong structural context (no parent listbox), while SearchableDropdown uses role=\"button\" which is keyboard-accessible but not semantically correct for a selection list. Neither supports arrow-key navigation between options or Escape to close. The correct ARIA pattern for a dropdown is role=\"listbox\" on the container with role=\"option\" on each item, aria-activedescendant pointing to the focused option, and ArrowUp/ArrowDown to navigate. The user-visible impact is that keyboard-only users must Tab through every option in SearchableDropdown (no arrow-key shortcuts), and screen reader users get confused by orphaned role=\"option\" in ChroniclePanel.",
      "recommendation": "Implement the ARIA combobox/listbox pattern on SearchableDropdown: role=\"listbox\" on options container, role=\"option\" on items, arrow-key navigation, Escape to close. Then have ChroniclePanel use SearchableDropdown or replicate the same pattern.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "keyboard-a11y"
    },
    {
      "id": "aria-label-sparse-usage",
      "name": "Sparse and Inconsistent aria-label Usage",
      "type": "behavioral",
      "domain": "Keyboard & Accessibility Patterns",
      "description": "Only 5 files in the entire codebase use aria-label, all in chronicler and illuminator apps. Zero files use aria-describedby, aria-haspopup, aria-pressed, aria-selected, or aria-live. Icon-only buttons (close \u00d7, expand \u25b6, sidebar <, >, add +) across the codebase lack aria-label, making them inaccessible to screen readers.",
      "impact": "LOW",
      "total_files": 5,
      "variants": [
        {
          "name": "aria-label-present",
          "description": "Components that include aria-label on interactive elements, providing screen reader context.",
          "file_count": 5,
          "files": [
            "apps/chronicler/webui/src/components/WikiNav.tsx:159",
            "apps/chronicler/webui/src/components/WikiExplorer.tsx:687",
            "apps/chronicler/webui/src/components/WikiExplorer.tsx:1052",
            "apps/chronicler/webui/src/components/ImageLightbox.tsx:62",
            "apps/illuminator/webui/src/components/CoveragePanel.jsx:426"
          ],
          "sample_file": "apps/chronicler/webui/src/components/WikiNav.tsx",
          "code_excerpts": [
            {
              "file": "apps/chronicler/webui/src/components/WikiNav.tsx",
              "start_line": 156,
              "end_line": 162,
              "snippet": "<button\n  onClick={onCloseDrawer}\n  className={styles.drawerClose}\n  aria-label=\"Close navigation\"\n>\n  \u00d7\n</button>"
            },
            {
              "file": "apps/chronicler/webui/src/components/ImageLightbox.tsx",
              "start_line": 60,
              "end_line": 64,
              "snippet": "role=\"dialog\"\naria-modal=\"true\"\naria-label={title || \"Image viewer\"}\ntabIndex={0}"
            }
          ],
          "implementation_details": "The chronicler app is the only one with consistent aria-label usage (4 out of 5 occurrences). All are on native <button> elements or dialog containers. This suggests the chronicler app was built with more accessibility awareness than other apps."
        },
        {
          "name": "aria-label-absent-icon-buttons",
          "description": "Icon-only buttons (\u00d7, +, \u25b6, <, >) that lack aria-label. Screen readers will announce them as just 'button' or read the raw Unicode character.",
          "file_count": 50,
          "files": [
            "packages/shared-components/src/components/ModalShell.jsx:84",
            "packages/shared-components/src/components/AddCard.jsx:17-24",
            "apps/illuminator/webui/src/components/ImageModal.jsx:207",
            "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/EffectsTab.jsx",
            "apps/canonry/webui/src/components/SchemaEditor/EntityKindEditor.jsx"
          ],
          "sample_file": "packages/shared-components/src/components/ModalShell.jsx",
          "code_excerpts": [
            {
              "file": "packages/shared-components/src/components/ModalShell.jsx",
              "start_line": 84,
              "end_line": 84,
              "snippet": "<button className=\"btn-close\" onClick={onClose}>\u00d7</button>"
            }
          ],
          "implementation_details": "The ModalShell close button renders just '\u00d7' with no aria-label. Screen readers announce this as 'times button' or 'multiplication sign button'. This is inherited by every modal using ModalShell (~10+ files). Similarly, AddCard renders '+' without aria-label."
        }
      ],
      "behavior_matrix": {
        "chronicler app": {
          "aria_label_on_icon_buttons": "yes (WikiNav close button, WikiExplorer buttons)",
          "aria_label_on_dialogs": "yes (ImageLightbox)",
          "aria_describedby": false,
          "aria_live": false
        },
        "illuminator app": {
          "aria_label_on_icon_buttons": "1 instance (CoveragePanel checkbox)",
          "aria_label_on_dialogs": false,
          "aria_describedby": false,
          "aria_live": false
        },
        "all other apps": {
          "aria_label_on_icon_buttons": false,
          "aria_label_on_dialogs": false,
          "aria_describedby": false,
          "aria_live": false
        }
      },
      "missing_behavior_complexity": {
        "aria_label_on_ModalShell_close": "trivial \u2014 add aria-label=\"Close\" to the btn-close button (1 line in 1 file, propagates to ~10+ consumers)",
        "aria_label_on_AddCard": "trivial \u2014 add aria-label={label} to the div (1 line in 1 file)",
        "aria_label_on_icon_buttons_everywhere": "moderate \u2014 requires auditing all icon-only buttons across the codebase and adding labels individually"
      },
      "analysis": "The chronicler app demonstrates good aria-label practices (4 out of 5 codebase-wide usages), while all other apps have virtually zero aria-label usage. This is partially drift (chronicler vs others) and partially a baseline accessibility gap. The highest-leverage fix is adding aria-label to ModalShell's close button, which propagates to all consumers. The absence of aria-describedby, aria-live, and aria-haspopup across the entire codebase suggests these attributes weren't part of the development culture. This is acceptable for an internal tool but becomes a real barrier if the chronicler (public-facing wiki) needs to meet WCAG standards.",
      "recommendation": "Add aria-label=\"Close\" to ModalShell btn-close button. Add aria-label=\"Close\" prop pass-through for custom close buttons. For the chronicler app specifically, audit all interactive elements for aria-label as it may have public-facing accessibility requirements.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "keyboard-a11y"
    },
    {
      "id": "loading-indicator-patterns",
      "name": "Loading Indicator Inconsistency",
      "type": "behavioral",
      "domain": "Loading & Error State Patterns",
      "description": "Loading states are communicated to users via at least 5 distinct visual patterns across apps: plain text, CSS-animated spinners, emoji icons with structured cards, Unicode symbols with animation, and Suspense fallback divs. There is no shared loading indicator component despite the shared-components package existing.",
      "impact": "MEDIUM",
      "total_files": 16,
      "variants": [
        {
          "name": "suspense-text-fallback",
          "description": "React Suspense with plain text 'Loading {ModuleName}...' in a styled div. Used consistently across all 7 MFE host wrappers in Canonry.",
          "file_count": 8,
          "files": [
            "apps/canonry/webui/src/remotes/IlluminatorHost.jsx:33-35",
            "apps/canonry/webui/src/remotes/ArchivistHost.jsx",
            "apps/canonry/webui/src/remotes/ChroniclerHost.jsx",
            "apps/canonry/webui/src/remotes/CoherenceEngineHost.jsx",
            "apps/canonry/webui/src/remotes/CosmographerHost.jsx",
            "apps/canonry/webui/src/remotes/LoreWeaveHost.jsx",
            "apps/canonry/webui/src/remotes/NameForgeHost.jsx",
            "apps/canonry/webui/src/components/TracePopover.jsx:43"
          ],
          "sample_file": "apps/canonry/webui/src/remotes/IlluminatorHost.jsx",
          "code_excerpts": [
            {
              "file": "apps/canonry/webui/src/remotes/IlluminatorHost.jsx",
              "start_line": 18,
              "end_line": 35,
              "snippet": "const styles = {\n  loading: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: \"100%\",\n    color: colors.textMuted,\n    fontSize: typography.sizeLg,\n    fontFamily: typography.fontFamily\n  }\n};\nconst loadingFallback = React.createElement(\"div\", {\n  style: styles.loading\n}, \"Loading Illuminator...\");"
            }
          ],
          "implementation_details": "Inline style object with flexbox centering. Each host duplicates identical style definition with only the module name changing. No spinner animation, just static text."
        },
        {
          "name": "emoji-icon-structured-card",
          "description": "Full-screen centered card with emoji icon + title + descriptive message. Used for data-loading states in Archivist and Chronicler.",
          "file_count": 2,
          "files": [
            "apps/archivist/webui/src/ArchivistRemote.tsx:69-78",
            "apps/chronicler/webui/src/components/ChroniclerStatusScreen.tsx:13-21"
          ],
          "sample_file": "apps/archivist/webui/src/ArchivistRemote.tsx",
          "code_excerpts": [
            {
              "file": "apps/archivist/webui/src/ArchivistRemote.tsx",
              "start_line": 69,
              "end_line": 78,
              "snippet": "if (effectiveLoading) {\n  return (\n    <div className=\"archivist-empty-state\">\n      <div className=\"archivist-state-content\">\n        <div className=\"archivist-state-icon\">\u231b</div>\n        <div className=\"archivist-state-title\">Loading World Data</div>\n        <div className=\"archivist-state-message\">Reading from local storage\u2026</div>\n      </div>\n    </div>\n  );\n}"
            },
            {
              "file": "apps/chronicler/webui/src/components/ChroniclerStatusScreen.tsx",
              "start_line": 13,
              "end_line": 21,
              "snippet": "if (loading) {\n  return (\n    <div className={styles.container}>\n      <div className={styles.content}>\n        <div className={styles.title}>Loading World Data</div>\n        <div className={styles.detail}>Reading from local storage...</div>\n      </div>\n    </div>\n  );\n}"
            }
          ],
          "implementation_details": "Both display identical text ('Loading World Data' / 'Reading from local storage') but Archivist uses global CSS classes with emoji icon while Chronicler uses CSS modules without icon. Same user-facing purpose, different implementations."
        },
        {
          "name": "css-animated-spinner",
          "description": "CSS-only spinner via empty element with animation class. Used in Illuminator for inline operation feedback.",
          "file_count": 3,
          "files": [
            "apps/illuminator/webui/src/components/chronicle-workspace/ChronicleWorkspace.jsx:731",
            "apps/illuminator/webui/src/components/ChroniclePanel.jsx:2362",
            "apps/canonry/webui/src/App.jsx:2204"
          ],
          "sample_file": "apps/illuminator/webui/src/components/chronicle-workspace/ChronicleWorkspace.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/chronicle-workspace/ChronicleWorkspace.jsx",
              "start_line": 731,
              "end_line": 732,
              "snippet": "<span className=\"cw-spinner\" />\n\"Generating title candidates...\""
            },
            {
              "file": "apps/canonry/webui/src/App.jsx",
              "start_line": 2203,
              "end_line": 2205,
              "snippet": "<div className=\"modal-spinner\" aria-hidden=\"true\" />\n<div>\n  <div className=\"modal-status-title\">Building viewer bundle</div>"
            }
          ],
          "implementation_details": "Each spinner uses a different CSS class name (cw-spinner, chron-detail-spinner, modal-spinner) with presumably similar CSS animation definitions. No shared spinner component."
        },
        {
          "name": "unicode-symbol-spinner",
          "description": "Unicode refresh symbol (\u21bb) with CSS rotation animation class for refresh operations.",
          "file_count": 1,
          "files": [
            "apps/chronicler/webui/src/components/WikiNav.tsx:466"
          ],
          "sample_file": "apps/chronicler/webui/src/components/WikiNav.tsx",
          "code_excerpts": [
            {
              "file": "apps/chronicler/webui/src/components/WikiNav.tsx",
              "start_line": 466,
              "end_line": 467,
              "snippet": "<span className={styles.refreshSpinner}>\u21bb</span>\n\"Refreshing...\""
            }
          ],
          "implementation_details": "Uses CSS module class with a unicode character rather than a CSS-only animation element. Different approach from the empty-element spinner used elsewhere."
        },
        {
          "name": "plain-text-only",
          "description": "Simple text like 'Loading...', 'Calculating...', or 'Loading pages...' with no visual indicator.",
          "file_count": 5,
          "files": [
            "apps/canonry/webui/src/App.jsx:2174",
            "apps/illuminator/webui/src/components/StaticPagesPanel.jsx:112",
            "apps/illuminator/webui/src/components/preprint/StatsView.tsx:65",
            "apps/illuminator/webui/src/components/EntityCoveragePanel.jsx:2168",
            "apps/archivist/webui/src/components/WorldExplorer.tsx:124"
          ],
          "sample_file": "apps/canonry/webui/src/App.jsx",
          "code_excerpts": [
            {
              "file": "apps/canonry/webui/src/App.jsx",
              "start_line": 2171,
              "end_line": 2175,
              "snippet": "if (loading) {\n  return <div className=\"canonry-app-loading\">\n    <div className=\"inline-extracted-3\">Loading...</div>\n  </div>;\n}"
            },
            {
              "file": "apps/archivist/webui/src/components/WorldExplorer.tsx",
              "start_line": 124,
              "end_line": 124,
              "snippet": "const loadingFallback = useMemo(() => <div className=\"world-loading\">Loading view\u2026</div>, []);"
            }
          ],
          "implementation_details": "Bare text strings with varied wording and no spinner animation, icon, or structured card layout. Text varies: 'Loading...', 'Loading pages...', 'Loading view\u2026', 'Calculating...'. Button text changes used in StatsView and EntityCoveragePanel."
        }
      ],
      "behavior_matrix": {
        "Canonry MFE Hosts (7 files)": {
          "technique": "Suspense fallback with inline-styled centered text",
          "visual_indicator": "text only",
          "animation": false,
          "icon": false,
          "structured_card": false,
          "spinner_element": false
        },
        "Canonry App.jsx": {
          "technique": "Conditional render with CSS class",
          "visual_indicator": "text only ('Loading...')",
          "animation": false,
          "icon": false,
          "structured_card": false,
          "spinner_element": false
        },
        "Canonry Export Modal": {
          "technique": "CSS-animated empty div spinner + status title + subtitle",
          "visual_indicator": "CSS spinner + text",
          "animation": true,
          "icon": false,
          "structured_card": true,
          "spinner_element": true
        },
        "ArchivistRemote": {
          "technique": "Conditional render with emoji icon + title + message card",
          "visual_indicator": "emoji icon (\u231b) + structured text",
          "animation": false,
          "icon": true,
          "structured_card": true,
          "spinner_element": false
        },
        "ChroniclerStatusScreen": {
          "technique": "Conditional render with CSS module title + detail (no icon for loading)",
          "visual_indicator": "text only (title + detail)",
          "animation": false,
          "icon": false,
          "structured_card": true,
          "spinner_element": false
        },
        "Illuminator ChronicleWorkspace": {
          "technique": "Inline CSS-animated spinner element + text",
          "visual_indicator": "CSS spinner",
          "animation": true,
          "icon": false,
          "structured_card": false,
          "spinner_element": true
        },
        "Illuminator ChroniclePanel": {
          "technique": "Inline CSS-animated spinner element",
          "visual_indicator": "CSS spinner",
          "animation": true,
          "icon": false,
          "structured_card": false,
          "spinner_element": true
        },
        "Chronicler WikiNav": {
          "technique": "Unicode symbol (\u21bb) with CSS rotation animation class",
          "visual_indicator": "rotating unicode symbol + text",
          "animation": true,
          "icon": false,
          "structured_card": false,
          "spinner_element": false
        },
        "Archivist WorldExplorer": {
          "technique": "Suspense fallback with simple text div",
          "visual_indicator": "text only ('Loading view\u2026')",
          "animation": false,
          "icon": false,
          "structured_card": false,
          "spinner_element": false
        }
      },
      "missing_behavior_complexity": {
        "shared_loading_component": "moderate \u2014 need a shared <LoadingIndicator /> that supports spinner, text-only, and full-screen card variants",
        "consistent_spinner_animation": "trivial \u2014 extract shared CSS animation keyframes into shared-components"
      },
      "analysis": "This is genuine behavioral drift, not intentional variation. The MFE host loading pattern is consistent within its scope (all 7 hosts follow the same Suspense + text pattern), but the per-app data loading states have diverged significantly. Archivist and Chronicler both load world data from storage with identical user-facing text ('Loading World Data' / 'Reading from local storage') but use completely different implementations \u2014 one with emoji icons and global CSS, the other with CSS modules and no icon. The Illuminator uses CSS-animated spinner elements with component-specific class names (cw-spinner, chron-detail-spinner), each presumably defining their own @keyframes. The user-visible impact is moderate: users moving between apps experience different loading presentations for equivalent operations. A shared <LoadingIndicator variant='spinner|text|card' /> component in shared-components would unify these patterns while supporting the distinct use cases (inline spinner for operations, full-screen card for initial data loads).",
      "recommendation": "Create a shared <LoadingIndicator> component in packages/shared-components with variants: 'spinner' (CSS-animated empty element), 'text' (simple loading text), and 'card' (icon + title + message). Extract the spinner CSS animation into shared-components. Adopt shared component across all apps.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "loading-errors"
    },
    {
      "id": "error-display-patterns",
      "name": "Error Display Pattern Divergence",
      "type": "behavioral",
      "domain": "Loading & Error State Patterns",
      "description": "Errors are displayed to users via at least 5 distinct presentation patterns: bare CSS class divs, component-prefixed error classes, full-screen state cards, toast notifications, and inline status text. No shared error display component exists despite 40+ files displaying errors.",
      "impact": "HIGH",
      "total_files": 42,
      "variants": [
        {
          "name": "bare-css-class-error-div",
          "description": "Simple <div className='error'>{error}</div> with optional utility margin classes. Used across Name Forge for all inline error display.",
          "file_count": 8,
          "files": [
            "apps/name-forge/webui/src/components/generator/GenerateTab.jsx:369",
            "apps/name-forge/webui/src/components/workspace/EntityWorkspace.jsx:121",
            "apps/name-forge/webui/src/components/workspace/tabs/LexemesTab.jsx:236",
            "apps/name-forge/webui/src/components/workspace/tabs/LexemesTab.jsx:428",
            "apps/name-forge/webui/src/components/workspace/tabs/LexemesTab.jsx:625",
            "apps/name-forge/webui/src/components/workspace/tabs/profile/TestPanel.jsx:34",
            "apps/name-forge/webui/src/components/sidebar/CultureSidebar.jsx:98",
            "apps/name-forge/webui/src/components/workspace/tabs/GrammarsTab.jsx:876-877"
          ],
          "sample_file": "apps/name-forge/webui/src/components/generator/GenerateTab.jsx",
          "code_excerpts": [
            {
              "file": "apps/name-forge/webui/src/components/generator/GenerateTab.jsx",
              "start_line": 369,
              "end_line": 369,
              "snippet": "{error && <div className=\"error mt-md\">{error}</div>}"
            },
            {
              "file": "apps/name-forge/webui/src/components/workspace/tabs/profile/tabs/TestTab.jsx",
              "start_line": 61,
              "end_line": 61,
              "snippet": "{testError && <div className=\"error-box\">{testError}</div>}"
            }
          ],
          "implementation_details": "Uses generic 'error' CSS class with utility margins (mt-md, mb-md, text-small). One file in the same app uses a different 'error-box' class, showing intra-app drift. Error messages are raw strings set via setError(err.message) in catch blocks."
        },
        {
          "name": "component-prefixed-error-class",
          "description": "Each component defines its own prefixed error CSS class (e.g., imod-error, dgm-failed, hrm-failed-message, srm-error, cip-error-message). No shared pattern.",
          "file_count": 18,
          "files": [
            "apps/illuminator/webui/src/components/ImageModal.jsx:220-222",
            "apps/illuminator/webui/src/components/DynamicsGenerationModal.jsx:165",
            "apps/illuminator/webui/src/components/HistorianReviewModal.jsx:245",
            "apps/illuminator/webui/src/components/SummaryRevisionModal.jsx:402",
            "apps/illuminator/webui/src/components/ChronicleImagePanel.tsx:700",
            "apps/illuminator/webui/src/components/DescriptionMotifWeaver.tsx:729",
            "apps/illuminator/webui/src/components/CoverImageControls.jsx:25",
            "apps/illuminator/webui/src/components/CorpusFindReplace.tsx:1303",
            "apps/illuminator/webui/src/components/CorpusFindReplace.tsx:1374",
            "apps/illuminator/webui/src/components/ChronologyModal.jsx:296",
            "apps/illuminator/webui/src/components/EraNarrativeModal.jsx:544",
            "apps/illuminator/webui/src/components/ActivityPanel.jsx:228",
            "apps/illuminator/webui/src/components/ProgressPanel.jsx:107-112",
            "apps/illuminator/webui/src/components/TraitPaletteSection.tsx:403-407",
            "apps/illuminator/webui/src/components/BulkOperationShell.jsx:174",
            "apps/illuminator/webui/src/components/preprint/ExportView.tsx:463",
            "apps/illuminator/webui/src/components/ChronicleWizard/steps/RoleAssignmentStep.tsx:307-309",
            "apps/lore-weave/webui/src/components/validation/ValidationPanel.jsx:15"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ImageModal.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/ImageModal.jsx",
              "start_line": 220,
              "end_line": 223,
              "snippet": "<div className=\"imod-error\">\n  <div className=\"imod-error-title\">Image not available</div>\n  <div className=\"imod-error-detail\">{error || \"Image not found in storage\"}</div>\n</div>"
            },
            {
              "file": "apps/illuminator/webui/src/components/DynamicsGenerationModal.jsx",
              "start_line": 165,
              "end_line": 165,
              "snippet": "{isFailed && <div className=\"dgm-failed\">{run.error || \"Generation failed\"}</div>}"
            },
            {
              "file": "apps/illuminator/webui/src/components/ProgressPanel.jsx",
              "start_line": 107,
              "end_line": 112,
              "snippet": "<div className=\"pp-error-list\">\n  {errorTasks.map(task => <div key={task.id} className=\"pp-error-item\">\n    <div className=\"pp-error-item-name\">{task.entityName} - {task.type}</div>\n    <div className=\"pp-error-item-message\">{task.error || \"Unknown error\"}</div>\n  </div>)}\n</div>"
            }
          ],
          "implementation_details": "Illuminator follows BEM-like naming with component prefix (imod-, dgm-, hrm-, srm-, cip-, pp-, ap-, etc.) but each component independently defines its error styling. Some use title+detail structure, others just show the error string. Error fallback text varies: 'Unknown error', 'Generation failed', 'Image not found in storage'. CorpusFindReplace even has two different error classes (cfr-error-banner and cfr-error-inline) within the same component for different positions."
        },
        {
          "name": "full-screen-state-card",
          "description": "Full-screen centered card with icon + title + error message, used for fatal/blocking errors during initial data load.",
          "file_count": 3,
          "files": [
            "apps/viewer/webui/src/StatusScreen.jsx:17-43",
            "apps/archivist/webui/src/ArchivistRemote.tsx:81-91",
            "apps/chronicler/webui/src/components/ChroniclerStatusScreen.tsx:24-33"
          ],
          "sample_file": "apps/viewer/webui/src/StatusScreen.jsx",
          "code_excerpts": [
            {
              "file": "apps/viewer/webui/src/StatusScreen.jsx",
              "start_line": 17,
              "end_line": 43,
              "snippet": "if (status === \"error\") {\n  return (\n    <div className=\"app\">\n      <div className=\"state-screen\">\n        <div className=\"state-card\">\n          <div className=\"state-title state-error\">Bundle unavailable</div>\n          <div className=\"state-detail\">{error?.message || \"Failed to load the viewer bundle.\"}</div>\n          <div className=\"state-detail\">Expected at: {bundleRequestUrl}</div>\n          <div className=\"state-actions\">\n            <button className=\"button\" onClick={onRetry}>Retry</button>\n            <button className=\"button secondary\" onClick={() => window.location.reload()}>Reload page</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}"
            },
            {
              "file": "apps/archivist/webui/src/ArchivistRemote.tsx",
              "start_line": 81,
              "end_line": 91,
              "snippet": "if (effectiveLoadError) {\n  return (\n    <div className=\"archivist-error-state\">\n      <div className=\"archivist-state-content\">\n        <div className=\"archivist-state-icon\">\u274c</div>\n        <div className=\"archivist-state-title\">World data unavailable</div>\n        <div className=\"archivist-state-message\">{effectiveLoadError}</div>\n      </div>\n    </div>\n  );\n}"
            },
            {
              "file": "apps/chronicler/webui/src/components/ChroniclerStatusScreen.tsx",
              "start_line": 24,
              "end_line": 33,
              "snippet": "if (loadError) {\n  return (\n    <div className={styles.container}>\n      <div className={styles.content}>\n        <div className={styles.icon}>&#x2756;</div>\n        <div className={styles.title}>World Data Unavailable</div>\n        <div className={styles.detail}>{loadError}</div>\n      </div>\n    </div>\n  );\n}"
            }
          ],
          "implementation_details": "Three apps that load world data all show full-screen error cards but each uses different CSS classes (state-card vs archivist-error-state vs CSS modules), different icon approaches (none vs emoji vs HTML entity), and different title text ('Bundle unavailable' vs 'World data unavailable' vs 'World Data Unavailable'). Viewer includes retry actions, Archivist and Chronicler do not."
        },
        {
          "name": "toast-notification-error",
          "description": "Dismissable toast banner with conditional success/error styling based on result object.",
          "file_count": 3,
          "files": [
            "apps/illuminator/webui/src/components/ChroniclePanel.jsx:2483-2497",
            "apps/illuminator/webui/src/components/ChroniclePanel.jsx:2532-2544",
            "apps/illuminator/webui/src/components/ChroniclePanel.jsx:2547-2558"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
              "start_line": 2483,
              "end_line": 2497,
              "snippet": "{eraSummaryRefreshResult && <div className={`chron-toast ${eraSummaryRefreshResult.success ? \"chron-toast-success\" : \"chron-toast-error\"}`} onClick={() => setEraSummaryRefreshResult(null)}>\n  {eraSummaryRefreshResult.success\n    ? (eraSummaryRefreshResult.error\n      ? `Error: ${eraSummaryRefreshResult.error}`\n      : `Updated ${eraSummaryRefreshResult.updated ?? 0} era summaries`)\n    : `Error: ${eraSummaryRefreshResult.error}`}\n</div>}"
            }
          ],
          "implementation_details": "Ad-hoc toast pattern within ChroniclePanel only. Uses chron-toast / chron-toast-success / chron-toast-error classes. Three separate result state variables (eraSummaryRefreshResult, resetBackportResult, reconcileBackportResult) each rendered with identical toast markup. Dismissable via onClick. No shared toast component or notification system."
        },
        {
          "name": "sync-status-inline",
          "description": "Inline status message with conditional error/success CSS class, used for data synchronization feedback.",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/IlluminatorTabContent.jsx:250-255"
          ],
          "sample_file": "apps/illuminator/webui/src/components/IlluminatorTabContent.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/IlluminatorTabContent.jsx",
              "start_line": 250,
              "end_line": 255,
              "snippet": "{props.dataSyncStatus && (\n  <div className={`itc-sync-status ${props.dataSyncStatus.type === \"error\" ? \"itc-sync-status-error\" : \"itc-sync-status-success\"}`}>\n    {props.dataSyncStatus.message}\n  </div>\n)}"
            }
          ],
          "implementation_details": "Conditional CSS class applied based on a dataSyncStatus.type field. This is a status object pattern { type: 'error' | 'success', message: string } unique to this component."
        },
        {
          "name": "global-error-banner",
          "description": "Global error banner rendered at the app root level showing any unhandled error state.",
          "file_count": 1,
          "files": [
            "apps/canonry/webui/src/App.jsx:2187-2189"
          ],
          "sample_file": "apps/canonry/webui/src/App.jsx",
          "code_excerpts": [
            {
              "file": "apps/canonry/webui/src/App.jsx",
              "start_line": 2187,
              "end_line": 2189,
              "snippet": "{error && <div className=\"inline-extracted-6\">\n  Error: {error}\n</div>}"
            }
          ],
          "implementation_details": "Simple conditional render of error state variable at root level. Uses an extracted inline style class. No dismiss mechanism, no retry, just displays the raw error text prefixed with 'Error: '."
        }
      ],
      "behavior_matrix": {
        "Name Forge (8 files)": {
          "display_pattern": "bare <div className='error'> with utility margins",
          "error_structure": "raw string",
          "dismiss_mechanism": false,
          "retry_action": false,
          "fallback_text": false,
          "icon": false
        },
        "Illuminator modals (8 files)": {
          "display_pattern": "component-prefixed error class (dgm-failed, hrm-failed-message, etc.)",
          "error_structure": "raw string with || fallback",
          "dismiss_mechanism": false,
          "retry_action": "varies per component",
          "fallback_text": "yes \u2014 'Generation failed', 'Unknown error', etc.",
          "icon": false
        },
        "Illuminator lists (4 files)": {
          "display_pattern": "component-prefixed error classes (pp-error-item, ap-error-detail)",
          "error_structure": "per-task error in list",
          "dismiss_mechanism": false,
          "retry_action": "per-item retry",
          "fallback_text": "yes \u2014 'Unknown error'",
          "icon": "status icons (\u2717)"
        },
        "Illuminator toasts (3 instances)": {
          "display_pattern": "chron-toast with success/error class variant",
          "error_structure": "result object with .success and .error",
          "dismiss_mechanism": "onClick dismisses",
          "retry_action": false,
          "fallback_text": false,
          "icon": false
        },
        "Viewer StatusScreen": {
          "display_pattern": "full-screen state-card with title + detail + actions",
          "error_structure": "error?.message with fallback string",
          "dismiss_mechanism": false,
          "retry_action": "Retry + Reload page buttons",
          "fallback_text": "yes \u2014 'Failed to load the viewer bundle.'",
          "icon": false
        },
        "Archivist": {
          "display_pattern": "full-screen card with emoji icon + title + message",
          "error_structure": "string from catch block",
          "dismiss_mechanism": false,
          "retry_action": false,
          "fallback_text": "yes \u2014 'Failed to load world data from Dexie.'",
          "icon": "emoji (\u274c)"
        },
        "Chronicler": {
          "display_pattern": "CSS module full-screen with HTML entity icon + title + detail",
          "error_structure": "string prop",
          "dismiss_mechanism": false,
          "retry_action": false,
          "fallback_text": false,
          "icon": "HTML entity (\u2756)"
        },
        "Canonry App": {
          "display_pattern": "global error banner at root",
          "error_structure": "raw string prefixed with 'Error: '",
          "dismiss_mechanism": false,
          "retry_action": false,
          "fallback_text": false,
          "icon": false
        }
      },
      "missing_behavior_complexity": {
        "shared_error_display_component": "moderate \u2014 need <ErrorDisplay variant='inline|banner|card|toast' /> supporting dismiss, retry, and icon options",
        "consistent_error_fallback_text": "trivial \u2014 standardize fallback strings like 'An unexpected error occurred'",
        "dismiss_mechanism_for_inline_errors": "trivial \u2014 add onClick dismiss or auto-clear timeout (~3 lines per component)"
      },
      "analysis": "This is the highest-impact behavioral drift finding. The same user-visible concern \u2014 'something went wrong, here's what' \u2014 is implemented 6 different ways. Name Forge uses bare CSS classes; Illuminator uses component-prefixed classes with varying structure; the data-loading apps (Viewer, Archivist, Chronicler) each independently implement full-screen error cards with different class naming, icon approaches, and retry capabilities. The ChroniclePanel invents an ad-hoc toast pattern for operation results. The user-visible impact is high: error presentation is visually inconsistent across apps, error recovery varies (some have retry buttons, most don't), and error fallback text is unstandardized. A shared <ErrorDisplay> component in shared-components with variants for inline, banner, card, and toast would eliminate most drift. The ErrorBoundary shared component already exists for render crashes \u2014 extending the shared component library with an ErrorDisplay for operational errors is a natural next step.",
      "recommendation": "Create shared <ErrorDisplay variant='inline|banner|card|toast'> in packages/shared-components. Props: message (string), title (optional string), icon (optional), onRetry (optional callback), onDismiss (optional callback), fallbackMessage (default: 'An unexpected error occurred'). Migrate Name Forge's bare 'error' class usage first (most files, simplest migration), then Illuminator's component-prefixed patterns.",
      "evidence_quality": "high",
      "status": "completed",
      "source_domain": "loading-errors"
    },
    {
      "id": "empty-state-patterns",
      "name": "Empty State Presentation Inconsistency",
      "type": "behavioral",
      "domain": "Loading & Error State Patterns",
      "description": "Empty states are presented via at least 4 patterns: a structured CSS component (icon + title + desc + CTA) in Coherence Engine, app-prefixed structured cards in Archivist, simple text messages in Illuminator, and 'empty-state-compact' one-liners. Only Coherence Engine has a dedicated empty-state CSS file.",
      "impact": "MEDIUM",
      "total_files": 22,
      "variants": [
        {
          "name": "structured-empty-state-component",
          "description": "Dedicated empty-state CSS with icon + title + description + optional CTA button. Used consistently within Coherence Engine.",
          "file_count": 9,
          "files": [
            "apps/coherence-engine/webui/src/components/pressures/PressuresEditor.jsx:84-99",
            "apps/coherence-engine/webui/src/components/generators/tabs/VariablesTab.jsx:194-200",
            "apps/coherence-engine/webui/src/components/generators/tabs/RelationshipsTab.jsx:380-384",
            "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx:1586-1590",
            "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx:1698-1702",
            "apps/coherence-engine/webui/src/components/actions/tabs/VariablesTab.jsx:191-194",
            "apps/coherence-engine/webui/src/styles/components/empty-state.css",
            "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityTab.jsx:31-36",
            "apps/coherence-engine/webui/src/components/generators/filters/SelectionFiltersEditor.jsx:91-93"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/pressures/PressuresEditor.jsx",
          "code_excerpts": [
            {
              "file": "apps/coherence-engine/webui/src/components/pressures/PressuresEditor.jsx",
              "start_line": 84,
              "end_line": 99,
              "snippet": "<div className=\"empty-state\">\n  <div className=\"empty-state-icon\">\ud83c\udf21\ufe0f</div>\n  <div className=\"pe-empty-title\">No pressures defined</div>\n  <div className=\"pe-empty-desc\">Pressures respond to world state with feedback and a pull toward equilibrium, driving the narrative forward.</div>\n  <button className=\"btn btn-primary pe-create-btn\" onClick={handleAddPressure}>+ Create First Pressure</button>\n</div>"
            },
            {
              "file": "apps/coherence-engine/webui/src/styles/components/empty-state.css",
              "start_line": 5,
              "end_line": 33,
              "snippet": ".empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: var(--spacing-4xl);\n  color: var(--color-text-dim);\n  text-align: center;\n}\n.empty-state-icon { font-size: 48px; margin-bottom: var(--spacing-xl); opacity: 0.5; }\n.empty-state-title { font-size: var(--font-size-2xl); font-weight: var(--font-weight-medium); margin-bottom: var(--spacing-md); color: var(--color-text); }\n.empty-state-desc { font-size: var(--font-size-lg); color: var(--color-text-muted); max-width: 400px; margin-bottom: var(--spacing-2xl); }"
            }
          ],
          "implementation_details": "Coherence Engine has a dedicated empty-state.css with well-structured classes. Uses emoji icons (\ud83d\udce6, \ud83d\udd17, \u26a1, \u2728, \ud83c\udf21\ufe0f) with consistent structure. Some files use the shared empty-state-title/desc classes while others mix in component-prefixed classes (pe-empty-title). Also has 'empty-state-compact' variant for smaller inline contexts."
        },
        {
          "name": "app-prefixed-state-card",
          "description": "Full-screen centered card with app-specific CSS class prefix (archivist-empty-state, archivist-state-content, etc.).",
          "file_count": 2,
          "files": [
            "apps/archivist/webui/src/ArchivistRemote.tsx:93-105",
            "apps/archivist/webui/src/ArchivistRemote.tsx:69-78"
          ],
          "sample_file": "apps/archivist/webui/src/ArchivistRemote.tsx",
          "code_excerpts": [
            {
              "file": "apps/archivist/webui/src/ArchivistRemote.tsx",
              "start_line": 93,
              "end_line": 105,
              "snippet": "if (!effectiveWorldData) {\n  return (\n    <div className=\"archivist-empty-state\">\n      <div className=\"archivist-state-content\">\n        <div className=\"archivist-state-icon\">\ud83d\udcdc</div>\n        <div className=\"archivist-state-title\">No World Data</div>\n        <div className=\"archivist-state-message\">Run a simulation in Lore Weave and click \"View in Archivist\" to explore your world.</div>\n      </div>\n    </div>\n  );\n}"
            }
          ],
          "implementation_details": "Same structural pattern as Coherence Engine (icon + title + message) but with entirely different CSS class names. Uses emoji icons but with app-specific class prefix 'archivist-'. Also uses archivist-empty-state for the loading state container, conflating loading and empty semantically."
        },
        {
          "name": "simple-text-message",
          "description": "Single text string in a component-prefixed div, with no icon, title structure, or CTA.",
          "file_count": 8,
          "files": [
            "apps/illuminator/webui/src/components/ActivityPanel.jsx:240-244",
            "apps/illuminator/webui/src/components/EnrichmentQueue.jsx:290-291",
            "apps/illuminator/webui/src/components/QuickCheckModal.jsx:161",
            "apps/illuminator/webui/src/components/QuickCheckModal.jsx:269",
            "apps/illuminator/webui/src/components/SummaryRevisionModal.jsx:440",
            "apps/cosmographer/webui/src/components/EntityEditor/index.jsx:176-178",
            "apps/cosmographer/webui/src/components/CultureEditor/index.jsx:185-187",
            "apps/cosmographer/webui/src/components/RelationshipEditor/index.jsx:114-116"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ActivityPanel.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/ActivityPanel.jsx",
              "start_line": 240,
              "end_line": 244,
              "snippet": "{queue.length === 0 && <div className=\"illuminator-card\">\n  <div className=\"ap-empty-state\">\n    No activity yet. Queue some enrichment tasks from the Entities tab.\n  </div>\n</div>}"
            },
            {
              "file": "apps/cosmographer/webui/src/components/CultureEditor/index.jsx",
              "start_line": 185,
              "end_line": 187,
              "snippet": "<div className=\"ce-placeholder\">\n  No cultures defined yet. Add cultures in the Enumerist tab first.\n</div>"
            }
          ],
          "implementation_details": "Plain text message with guidance on what to do. Uses component-prefixed class names (ap-empty-state, eq-empty, ce-placeholder). No icon, no structural hierarchy, no CTA button. Cosmographer editors include cross-reference guidance ('Add cultures in the Enumerist tab first')."
        },
        {
          "name": "remote-placeholder-component",
          "description": "Dedicated RemotePlaceholder component shown when an MFE module is unavailable \u2014 effectively an empty/unavailable state for remote modules.",
          "file_count": 7,
          "files": [
            "apps/canonry/webui/src/remotes/RemotePlaceholder.jsx",
            "apps/canonry/webui/src/remotes/IlluminatorHost.jsx:15-17",
            "apps/canonry/webui/src/remotes/ArchivistHost.jsx",
            "apps/canonry/webui/src/remotes/ChroniclerHost.jsx",
            "apps/canonry/webui/src/remotes/CoherenceEngineHost.jsx",
            "apps/canonry/webui/src/remotes/CosmographerHost.jsx",
            "apps/canonry/webui/src/remotes/LoreWeaveHost.jsx"
          ],
          "sample_file": "apps/canonry/webui/src/remotes/RemotePlaceholder.jsx",
          "code_excerpts": [
            {
              "file": "apps/canonry/webui/src/remotes/RemotePlaceholder.jsx",
              "start_line": 9,
              "end_line": 20,
              "snippet": "export default function RemotePlaceholder({ name, instructions }) {\n  return (\n    <div className=\"rph-container\">\n      <div className=\"rph-icon\">\ud83d\udd0c</div>\n      <div className=\"rph-title\">{name} Not Connected</div>\n      <div className=\"rph-message\">The {name} module is not currently running. Start it to enable this feature.</div>\n      {instructions && <div className=\"rph-instructions\">{instructions}</div>}\n    </div>\n  );\n}"
            }
          ],
          "implementation_details": "A reusable component but only used within MFE host wrappers. Same structural pattern as Coherence Engine empty states (icon + title + message) but with rph- prefix classes. This is the closest thing to a shared empty state component but it's purpose-specific to MFE unavailability."
        }
      ],
      "behavior_matrix": {
        "Coherence Engine (9 files)": {
          "structure": "icon + title + desc + optional CTA",
          "css_approach": "dedicated empty-state.css with shared classes",
          "icon_type": "emoji (\ud83d\udce6, \ud83d\udd17, \u26a1, \u2728, \ud83c\udf21\ufe0f)",
          "has_cta": "some (Create First Pressure, etc.)",
          "compact_variant": "yes (empty-state-compact)"
        },
        "Archivist (2 files)": {
          "structure": "icon + title + message",
          "css_approach": "app-prefixed classes (archivist-empty-state)",
          "icon_type": "emoji (\ud83d\udcdc)",
          "has_cta": false,
          "compact_variant": false
        },
        "Illuminator (5 files)": {
          "structure": "text message only",
          "css_approach": "component-prefixed classes (ap-empty-state)",
          "icon_type": false,
          "has_cta": false,
          "compact_variant": false
        },
        "Cosmographer (3 files)": {
          "structure": "text message with guidance",
          "css_approach": "component-prefixed classes (ce-placeholder)",
          "icon_type": false,
          "has_cta": false,
          "compact_variant": false
        },
        "Canonry Remotes (7 files)": {
          "structure": "icon + title + message + optional instructions",
          "css_approach": "rph- prefixed classes",
          "icon_type": "emoji (\ud83d\udd0c)",
          "has_cta": false,
          "compact_variant": false
        }
      },
      "missing_behavior_complexity": {
        "shared_empty_state_component": "moderate \u2014 extract Coherence Engine's empty-state CSS into shared-components and create <EmptyState icon title description cta /> component",
        "consistent_empty_state_adoption": "trivial per file \u2014 replace text-only empty states with shared component calls (~3-5 lines each)"
      },
      "analysis": "This is behavioral drift with one app (Coherence Engine) having established a solid canonical pattern that other apps have not adopted. The Coherence Engine's empty-state.css is well-structured with icon + title + description + CTA and even has a compact variant \u2014 this is clearly the most mature implementation. Archivist independently arrived at the same structural pattern but with different class names. Illuminator and Cosmographer use simpler text-only approaches. The RemotePlaceholder component also follows the icon + title + message pattern but is isolated to MFE hosts. The user-visible impact is moderate: empty states look different across apps, some providing helpful guidance (Coherence Engine's CTA buttons, Cosmographer's cross-references) while others just show terse messages. The canonical pattern already exists in Coherence Engine \u2014 it just needs to be extracted to shared-components and adopted.",
      "recommendation": "Extract Coherence Engine's empty-state.css and pattern into a shared <EmptyState icon? title description cta?> component in packages/shared-components. Support variants: 'full' (icon + title + desc + CTA) and 'compact' (inline text). Migrate Archivist and Illuminator to use the shared component.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "loading-errors"
    },
    {
      "id": "error-recovery-retry-patterns",
      "name": "Inconsistent Error Recovery Mechanisms",
      "type": "behavioral",
      "domain": "Loading & Error State Patterns",
      "description": "Error recovery ranges from comprehensive (Retry + Reload buttons in Viewer) to nonexistent (most error displays offer no recovery action). The shared ErrorBoundary has a retry mechanism, but operational errors in most components lack any recovery path.",
      "impact": "MEDIUM",
      "total_files": 12,
      "variants": [
        {
          "name": "retry-plus-reload",
          "description": "Dedicated Retry button plus Reload page button for fatal load errors.",
          "file_count": 1,
          "files": [
            "apps/viewer/webui/src/StatusScreen.jsx:27-38"
          ],
          "sample_file": "apps/viewer/webui/src/StatusScreen.jsx",
          "code_excerpts": [
            {
              "file": "apps/viewer/webui/src/StatusScreen.jsx",
              "start_line": 27,
              "end_line": 38,
              "snippet": "<div className=\"state-actions\">\n  <button className=\"button\" onClick={onRetry} type=\"button\">Retry</button>\n  <button className=\"button secondary\" onClick={() => window.location.reload()} type=\"button\">Reload page</button>\n</div>"
            }
          ],
          "implementation_details": "Two recovery options: a callback-based Retry (re-attempts the load) and a full page reload. Structured in a state-actions div. Only component offering both options."
        },
        {
          "name": "per-task-retry-button",
          "description": "Individual Retry button shown next to each failed task in a list, re-queuing that specific task.",
          "file_count": 3,
          "files": [
            "apps/illuminator/webui/src/components/ActivityPanel.jsx:107-109",
            "apps/illuminator/webui/src/components/EnrichmentQueue.jsx:89-91",
            "apps/illuminator/webui/src/components/EntityBrowser.jsx:271-277"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ActivityPanel.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/ActivityPanel.jsx",
              "start_line": 107,
              "end_line": 109,
              "snippet": "{item.status === \"error\" && onRetry && <button onClick={() => onRetry(item.id)} className=\"illuminator-button-link ap-task-action\">Retry</button>}"
            },
            {
              "file": "apps/illuminator/webui/src/components/EnrichmentQueue.jsx",
              "start_line": 89,
              "end_line": 92,
              "snippet": "{(task.status === \"queued\" || task.status === \"error\") && (\n  <button onClick={() => onRunTask(task.id)} className=\"eq-task-run-btn\">\n    {task.status === \"error\" ? \"Retry\" : \"Run\"}\n  </button>\n)}"
            }
          ],
          "implementation_details": "ActivityPanel uses onRetry callback prop with illuminator-button-link class. EnrichmentQueue uses conditional text ('Retry' vs 'Run') on the same button. EntityBrowser has separate retry buttons for each task type (description, thesis, image). All within Illuminator app only."
        },
        {
          "name": "retry-with-feedback",
          "description": "Retry button that includes user feedback text field, allowing the user to steer the retry attempt.",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/DynamicsGenerationModal.jsx:196-203"
          ],
          "sample_file": "apps/illuminator/webui/src/components/DynamicsGenerationModal.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/DynamicsGenerationModal.jsx",
              "start_line": 196,
              "end_line": 203,
              "snippet": "{(isReviewable || isFailed) && (\n  <button onClick={handleSubmitFeedback} disabled={!feedback.trim()} className=\"illuminator-button illuminator-button-secondary dgm-action-btn\">\n    {isFailed ? \"Retry with Feedback\" : \"Refine\"}\n  </button>\n)}"
            }
          ],
          "implementation_details": "Unique LLM-oriented retry pattern: shows a textarea for feedback and a 'Retry with Feedback' button. This is intentionally different from simple retries as it supports iterative generation workflows."
        },
        {
          "name": "error-boundary-retry",
          "description": "Shared ErrorBoundary component resets error state to retry rendering.",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/components/ErrorBoundary.jsx:22-24"
          ],
          "sample_file": "packages/shared-components/src/components/ErrorBoundary.jsx",
          "code_excerpts": [
            {
              "file": "packages/shared-components/src/components/ErrorBoundary.jsx",
              "start_line": 22,
              "end_line": 42,
              "snippet": "handleRetry = () => {\n  this.setState({ error: null });\n};\n...\n<button className=\"error-boundary-retry\" onClick={this.handleRetry}>Retry</button>"
            }
          ],
          "implementation_details": "Resets component error state to null, causing React to re-render children. Simple but effective for render errors. Used in all 7 MFE host wrappers."
        },
        {
          "name": "no-recovery-action",
          "description": "Error is displayed but no retry, dismiss, or recovery mechanism is offered.",
          "file_count": 30,
          "files": [
            "apps/name-forge/webui/src/components/generator/GenerateTab.jsx:369",
            "apps/name-forge/webui/src/components/workspace/tabs/LexemesTab.jsx:236",
            "apps/archivist/webui/src/ArchivistRemote.tsx:81-91",
            "apps/chronicler/webui/src/components/ChroniclerStatusScreen.tsx:24-33",
            "apps/illuminator/webui/src/components/ImageModal.jsx:220-222",
            "apps/illuminator/webui/src/components/HistorianReviewModal.jsx:245",
            "apps/illuminator/webui/src/components/ChronicleImagePanel.tsx:700",
            "apps/illuminator/webui/src/components/DescriptionMotifWeaver.tsx:729",
            "apps/illuminator/webui/src/components/CoverImageControls.jsx:25",
            "apps/illuminator/webui/src/components/CorpusFindReplace.tsx:1303"
          ],
          "sample_file": "apps/name-forge/webui/src/components/generator/GenerateTab.jsx",
          "code_excerpts": [
            {
              "file": "apps/name-forge/webui/src/components/generator/GenerateTab.jsx",
              "start_line": 107,
              "end_line": 110,
              "snippet": "const handleGenerate = async () => {\n  setError(null);\n  setGenerating(true);\n  try { ... } catch (err) { setError(err.message); }"
            },
            {
              "file": "apps/archivist/webui/src/ArchivistRemote.tsx",
              "start_line": 81,
              "end_line": 91,
              "snippet": "if (effectiveLoadError) {\n  return (\n    <div className=\"archivist-error-state\">\n      <div className=\"archivist-state-content\">\n        <div className=\"archivist-state-icon\">\u274c</div>\n        <div className=\"archivist-state-title\">World data unavailable</div>\n        <div className=\"archivist-state-message\">{effectiveLoadError}</div>\n      </div>\n    </div>\n  );\n}"
            }
          ],
          "implementation_details": "The majority pattern: errors are caught, stored in state, and displayed to the user, but with no mechanism to retry the failed operation. In Name Forge, the error clears on the next manual generate attempt. In Archivist and Chronicler, data load errors leave the user stranded with no recovery path \u2014 they must reload the page manually."
        }
      ],
      "behavior_matrix": {
        "Viewer StatusScreen": {
          "retry_mechanism": "Retry callback + Reload page button",
          "recovery_path": "two options: re-attempt or full reload",
          "auto_clear": false
        },
        "shared ErrorBoundary": {
          "retry_mechanism": "Reset error state to null, re-render children",
          "recovery_path": "single Retry button",
          "auto_clear": false
        },
        "Illuminator task lists": {
          "retry_mechanism": "Per-task Retry button calls onRetry(taskId)",
          "recovery_path": "re-queue individual failed task",
          "auto_clear": false
        },
        "Illuminator DynamicsModal": {
          "retry_mechanism": "Retry with Feedback textarea + button",
          "recovery_path": "re-generate with user feedback",
          "auto_clear": false
        },
        "Name Forge (all)": {
          "retry_mechanism": "none \u2014 error clears on next manual action",
          "recovery_path": "implicit via re-running the action",
          "auto_clear": "on next action"
        },
        "Archivist error state": {
          "retry_mechanism": "none",
          "recovery_path": "none \u2014 user must reload page",
          "auto_clear": false
        },
        "Chronicler error state": {
          "retry_mechanism": "none",
          "recovery_path": "none \u2014 user must reload page",
          "auto_clear": false
        },
        "Illuminator modals (most)": {
          "retry_mechanism": "none",
          "recovery_path": "close and re-open modal",
          "auto_clear": false
        }
      },
      "missing_behavior_complexity": {
        "archivist_retry_button": "trivial \u2014 add onRetry callback to trigger re-load from storage (~5 lines)",
        "chronicler_retry_button": "trivial \u2014 add onRetry callback to trigger re-load (~5 lines)",
        "name_forge_retry_button": "trivial \u2014 add explicit Retry button next to error display (~3 lines)",
        "illuminator_modal_retry": "moderate \u2014 most modals need to re-invoke the LLM operation, requiring stored parameters"
      },
      "analysis": "This drift represents a genuine gap in user experience. Data-loading apps (Archivist, Chronicler) display error cards that dead-end the user \u2014 the only recovery is a manual page reload, which isn't even suggested. Meanwhile, the Viewer StatusScreen provides both Retry and Reload buttons for the exact same type of operation (loading data from storage). The Illuminator's task-based retry is well-implemented but isolated to its queue system. Name Forge errors clear implicitly on the next action, which is a reasonable UX for form-based operations but still lacks an explicit 'try again' affordance. The shared ErrorBoundary already demonstrates the retry pattern \u2014 extending this principle to operational errors is straightforward. The 'Retry with Feedback' variant in DynamicsGenerationModal is intentionally different (LLM iteration) and should remain distinct.",
      "recommendation": "Add retry callbacks to Archivist and Chronicler data-loading error states (highest impact, simplest fix). Standardize that all full-screen error cards include at minimum a Retry button. Consider a shared <ErrorCard title message onRetry? onReload?> that enforces this pattern. Leave LLM-specific retry variants (Retry with Feedback) as intentional variation.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "loading-errors"
    },
    {
      "id": "error-boundary-adoption",
      "name": "ErrorBoundary Usage Gap",
      "type": "behavioral",
      "domain": "Loading & Error State Patterns",
      "description": "The shared ErrorBoundary component is used at MFE host boundaries only (7 files). No app uses ErrorBoundary internally around complex components that could crash (3D views, chart renderers, etc.), leaving unhandled render errors to propagate to the MFE-level boundary with a generic message.",
      "impact": "LOW",
      "total_files": 7,
      "variants": [
        {
          "name": "mfe-host-boundary-only",
          "description": "ErrorBoundary wraps the Suspense-loaded remote module in each MFE host. This is the only usage pattern.",
          "file_count": 7,
          "files": [
            "apps/canonry/webui/src/remotes/IlluminatorHost.jsx:57",
            "apps/canonry/webui/src/remotes/ArchivistHost.jsx",
            "apps/canonry/webui/src/remotes/ChroniclerHost.jsx",
            "apps/canonry/webui/src/remotes/CoherenceEngineHost.jsx",
            "apps/canonry/webui/src/remotes/CosmographerHost.jsx",
            "apps/canonry/webui/src/remotes/LoreWeaveHost.jsx",
            "apps/canonry/webui/src/remotes/NameForgeHost.jsx"
          ],
          "sample_file": "apps/canonry/webui/src/remotes/IlluminatorHost.jsx",
          "code_excerpts": [
            {
              "file": "apps/canonry/webui/src/remotes/IlluminatorHost.jsx",
              "start_line": 56,
              "end_line": 62,
              "snippet": "return <div className=\"inline-extracted-1\">\n  <ErrorBoundary title=\"Illuminator encountered an error\">\n    <Suspense fallback={loadingFallback}>\n      <IlluminatorRemote ... />\n    </Suspense>\n  </ErrorBoundary>\n</div>;"
            }
          ],
          "implementation_details": "Consistent pattern across all 7 hosts: ErrorBoundary wraps Suspense wrapping the lazy-loaded remote. Each host provides a custom title prop ('Illuminator encountered an error', etc.). The ErrorBoundary shows generic 'Something went wrong' with the error.message and a Retry button."
        },
        {
          "name": "no-internal-boundaries",
          "description": "No ErrorBoundary usage inside any app around crash-prone components (3D renderers, canvas-based views, complex parsers).",
          "file_count": 0,
          "files": [],
          "sample_file": "apps/archivist/webui/src/components/WorldExplorer.tsx",
          "code_excerpts": [
            {
              "file": "apps/archivist/webui/src/components/WorldExplorer.tsx",
              "start_line": 145,
              "end_line": 179,
              "snippet": "<Suspense fallback={loadingFallback}>\n  {viewMode === \"graph3d\" && (\n    <GraphView3D key={`3d-view-${edgeMetric}`} data={filteredData} ... />\n  )}\n  {viewMode === \"graph2d\" && (\n    <GraphView key={`2d-view-${edgeMetric}`} data={filteredData} ... />\n  )}\n</Suspense>\n// Note: No ErrorBoundary around 3D views that use WebGL"
            }
          ],
          "implementation_details": "Archivist's WorldExplorer lazy-loads GraphView3D and GraphView (WebGL-based 3D renderers) but only wraps them in Suspense, not ErrorBoundary. A WebGL crash would propagate to the MFE-level boundary, crashing the entire Archivist view rather than just the graph. Similar gap exists for other complex components."
        }
      ],
      "behavior_matrix": {
        "MFE Host wrappers (7 files)": {
          "error_boundary": "yes \u2014 wraps entire remote module",
          "custom_title": "yes \u2014 per-module title",
          "granularity": "whole-app level"
        },
        "Archivist 3D views": {
          "error_boundary": "none \u2014 only Suspense",
          "custom_title": "N/A",
          "granularity": "N/A"
        },
        "Lore Weave dashboard": {
          "error_boundary": "none",
          "custom_title": "N/A",
          "granularity": "N/A"
        },
        "Canonry TracePopover": {
          "error_boundary": "none \u2014 lazy loads mermaid",
          "custom_title": "N/A",
          "granularity": "N/A"
        }
      },
      "missing_behavior_complexity": {
        "archivist_3d_boundary": "trivial \u2014 wrap GraphView3D/GraphView in <ErrorBoundary title='Graph view error'> (~3 lines)",
        "trace_popover_boundary": "trivial \u2014 wrap lazy-loaded mermaid in ErrorBoundary (~3 lines)",
        "general_internal_boundaries": "trivial per component \u2014 identify crash-prone components and wrap each"
      },
      "analysis": "This is a relatively low-impact gap because the MFE-level ErrorBoundary does catch crashes \u2014 the issue is granularity, not coverage. When a 3D renderer crashes in Archivist, the entire Archivist module shows 'Archivist encountered an error' instead of just the graph view showing an error while the filter panel remains usable. This is likely an oversight rather than a design decision. The fix is straightforward: add ErrorBoundary around known crash-prone components (3D views, complex parsers, lazy-loaded heavy libraries like mermaid). The shared ErrorBoundary component already supports this via its title and className props.",
      "recommendation": "Add ErrorBoundary around crash-prone components: Archivist's GraphView3D/GraphView/TimelineView3D, Canonry's TracePopover lazy-loaded mermaid. Low priority \u2014 the MFE boundary already provides a safety net.",
      "evidence_quality": "medium",
      "status": "pending",
      "source_domain": "loading-errors"
    },
    {
      "id": "progress-display-inconsistency",
      "name": "Progress Display Pattern Divergence",
      "type": "behavioral",
      "domain": "Loading & Error State Patterns",
      "description": "Two apps (Lore Weave, Illuminator) have progress display for long-running operations but use completely different component structures, stats layouts, and CSS variable conventions despite serving the same purpose.",
      "impact": "LOW",
      "total_files": 4,
      "variants": [
        {
          "name": "lore-weave-progress",
          "description": "Horizontal overview bar: StatusBadge + progress bar + tick/epoch text + entity/relationship counts.",
          "file_count": 2,
          "files": [
            "apps/lore-weave/webui/src/components/dashboard/ProgressOverview.jsx:10-75",
            "apps/lore-weave/webui/src/components/dashboard/StatusBadge.jsx"
          ],
          "sample_file": "apps/lore-weave/webui/src/components/dashboard/ProgressOverview.jsx",
          "code_excerpts": [
            {
              "file": "apps/lore-weave/webui/src/components/dashboard/ProgressOverview.jsx",
              "start_line": 49,
              "end_line": 73,
              "snippet": "<div className=\"lw-overview-bar\">\n  <StatusBadge status={status} />\n  <div className=\"lw-progress-section\">\n    <div className=\"lw-progress-bar\">\n      <div className=\"lw-progress-fill po-progress-fill\" style={{ '--po-progress-width': `${percent}%` }} />\n    </div>\n    <div className=\"lw-progress-text\">\n      <span>Tick {progress.tick} / {progress.maxTicks} \u2022 Epoch {progress.epoch} / {progress.totalEpochs}</span>\n      <span>{Math.round(percent)}%</span>\n    </div>\n  </div>\n  <div className=\"lw-stats-row\">\n    <div className=\"lw-stat-item\"><div className=\"lw-stat-value\">{progress.entityCount.toLocaleString()}</div><div className=\"lw-stat-label\">Entities</div></div>\n    <div className=\"lw-stat-item\"><div className=\"lw-stat-value\">{progress.relationshipCount.toLocaleString()}</div><div className=\"lw-stat-label\">Relations</div></div>\n  </div>\n</div>"
            }
          ],
          "implementation_details": "Uses CSS custom property '--po-progress-width' for bar width. Horizontal single-bar layout with StatusBadge component. Shows domain-specific counters (entities, relationships). Progress calculation based on epochs completed. 'Waiting to start...' when no progress data."
        },
        {
          "name": "illuminator-progress",
          "description": "Vertical card layout: progress bar + completed/total header + 4-cell stats grid + error log + completion message.",
          "file_count": 2,
          "files": [
            "apps/illuminator/webui/src/components/ProgressPanel.jsx:14-129",
            "apps/illuminator/webui/src/components/ActivityPanel.jsx:131-285"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ProgressPanel.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/ProgressPanel.jsx",
              "start_line": 56,
              "end_line": 99,
              "snippet": "<div className=\"pp-progress-section\">\n  <div className=\"pp-progress-header\">\n    <span className=\"pp-progress-completed\">{progress.completed} / {progress.total} tasks</span>\n    <span className=\"pp-progress-percent\">{progressPercent}%</span>\n  </div>\n  <div className=\"illuminator-progress\">\n    <div className=\"illuminator-progress-bar\" style={{ \"--pp-bar-width\": `${progressPercent}%` }} />\n  </div>\n</div>\n...\n<div className=\"pp-stats-grid\">\n  <div className=\"pp-stat-card\"><div className=\"pp-stat-value\">{completedTasks.length}</div><div className=\"pp-stat-label pp-stat-label-completed\">Completed</div></div>\n  <div className=\"pp-stat-card\"><div className=\"pp-stat-value\">{runningTasks.length}</div><div className=\"pp-stat-label pp-stat-label-running\">Running</div></div>\n  <div className=\"pp-stat-card\"><div className=\"pp-stat-value\">{pendingTasks.length}</div><div className=\"pp-stat-label pp-stat-label-pending\">Pending</div></div>\n  <div className=\"pp-stat-card\"><div className=\"pp-stat-value\">{errorTasks.length}</div><div className=\"pp-stat-label pp-stat-label-errors\">Errors</div></div>\n</div>"
            }
          ],
          "implementation_details": "Uses CSS custom property '--pp-bar-width' for bar width (same technique, different variable name). Vertical card layout with multiple sections. Shows task-based counters (completed/running/pending/errors) in a 4-cell grid. Includes inline error log and completion celebration. ActivityPanel shows separate view with per-task status rows using status icon system (\u25f7 \u25d0 \u2713 \u2717)."
        }
      ],
      "behavior_matrix": {
        "Lore Weave ProgressOverview": {
          "layout": "horizontal single bar",
          "css_variable": "--po-progress-width",
          "counters": "entities + relationships (domain-specific)",
          "error_display": "none in progress view",
          "controls": "separate RunControls component",
          "completion_state": "100% bar fill"
        },
        "Illuminator ProgressPanel": {
          "layout": "vertical multi-section card",
          "css_variable": "--pp-bar-width",
          "counters": "completed/running/pending/errors (4-cell grid)",
          "error_display": "inline error log with task name + message",
          "controls": "Start/Pause/Resume/Abort buttons in header",
          "completion_state": "sparkle icon + 'Enrichment Complete!' + task count summary"
        },
        "Illuminator ActivityPanel": {
          "layout": "vertical multi-section with task rows",
          "css_variable": "N/A (no bar)",
          "counters": "queued/running/completed/errors stats row",
          "error_display": "per-task error detail below task row",
          "controls": "Cancel All + Clear Completed in header",
          "completion_state": "N/A (continuous queue)"
        }
      },
      "missing_behavior_complexity": {
        "shared_progress_bar": "moderate \u2014 could extract a shared <ProgressBar value={percent} /> component, but layout contexts differ significantly",
        "css_variable_standardization": "trivial \u2014 rename to consistent --progress-width"
      },
      "analysis": "This is partially intentional variation: Lore Weave tracks simulation progress (epochs, entity counts) while Illuminator tracks queue progress (tasks completed/failed). The domains genuinely differ. However, the progress bar implementation is duplicated \u2014 both use the same CSS custom property technique with different variable names (--po-progress-width vs --pp-bar-width). A shared <ProgressBar> component could handle the visual bar while each app provides its own surrounding context. The stats grid patterns also differ (2-column domain stats vs 4-cell task status grid) but these serve different purposes. This is low priority because only 2 apps have progress display and their domains differ substantially.",
      "recommendation": "Extract a shared <ProgressBar percent={number} /> component to shared-components with standardized CSS. Keep the surrounding layout and stats grid app-specific, as they serve genuinely different domains. Low priority.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "loading-errors"
    },
    {
      "id": "modal-close-behavior",
      "name": "Modal Close Behavior Consistency",
      "type": "behavioral",
      "domain": "Modal/Dialog Interaction Consistency",
      "description": "Modals across the codebase implement overlay-click-to-close with three distinct patterns: ModalShell's canonical mouseDown guard, ad-hoc mouseDown guard reimplementations, and raw onClick on overlay (bug-prone). Several modals lack overlay close entirely.",
      "impact": "MEDIUM",
      "total_files": 18,
      "variants": [
        {
          "name": "modalshell-canonical",
          "description": "Uses ModalShell shared component which provides mouseDown guard overlay close, Escape key close, body scroll lock, and close button \u2014 all from a single component import",
          "file_count": 12,
          "files": [
            "packages/shared-components/src/components/ModalShell.jsx",
            "apps/name-forge/webui/src/components/modals/ConditionsModal.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/CopyGrammarModal.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/CopyLexemeModal.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/profile/ProfileModal.jsx",
            "apps/illuminator/webui/src/components/EntityLinkPicker.jsx",
            "apps/illuminator/webui/src/components/HistoryCompressionPreviewModal.jsx",
            "apps/illuminator/webui/src/components/ImageRefPicker.jsx",
            "apps/illuminator/webui/src/components/RevisionFilterModal.jsx",
            "apps/illuminator/webui/src/components/ToneAssignmentPreviewModal.jsx",
            "apps/coherence-engine/webui/src/components/systems/SystemModal.jsx",
            "apps/coherence-engine/webui/src/components/actions/modals/ActionModal.jsx",
            "apps/coherence-engine/webui/src/components/generators/GeneratorModal.jsx"
          ],
          "sample_file": "packages/shared-components/src/components/ModalShell.jsx",
          "code_excerpts": [
            {
              "file": "packages/shared-components/src/components/ModalShell.jsx",
              "start_line": 46,
              "end_line": 73,
              "snippet": "// Escape key handler\nconst handleKeyDown = useCallback((e) => {\n  if (e.key === 'Escape' && !preventOverlayClose) {\n    onClose();\n  }\n}, [onClose, preventOverlayClose]);\n\nuseEffect(() => {\n  document.addEventListener('keydown', handleKeyDown);\n  return () => document.removeEventListener('keydown', handleKeyDown);\n}, [handleKeyDown]);\n\n// Body scroll lock\nuseEffect(() => {\n  const prev = document.body.style.overflow;\n  document.body.style.overflow = 'hidden';\n  return () => { document.body.style.overflow = prev; };\n}, []);\n\nconst handleOverlayMouseDown = (e) => {\n  mouseDownOnOverlay.current = e.target === e.currentTarget;\n};\n\nconst handleOverlayClick = (e) => {\n  if (!preventOverlayClose && mouseDownOnOverlay.current && e.target === e.currentTarget) {\n    onClose();\n  }\n};"
            }
          ],
          "implementation_details": "ModalShell provides mouseDown guard (prevents text-selection-drag from triggering close), Escape key via document keydown listener (respects preventOverlayClose prop), body scroll lock on mount/unmount (preserves previous overflow value), close button in header, and role/tabIndex ARIA attributes on overlay."
        },
        {
          "name": "ad-hoc-mousedown-guard-full",
          "description": "Reimplements ModalShell's mouseDown guard overlay close, Escape key close, and body scroll lock manually \u2014 identical behavior but duplicated code",
          "file_count": 5,
          "files": [
            "apps/illuminator/webui/src/components/ImageModal.jsx",
            "apps/illuminator/webui/src/components/ImagePickerModal.jsx",
            "apps/illuminator/webui/src/components/ChronicleImagePicker.jsx",
            "apps/illuminator/webui/src/components/ChronicleWizard/ChronicleWizard.tsx",
            "apps/chronicler/webui/src/components/ImageLightbox.tsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ImageModal.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/ImageModal.jsx",
              "start_line": 159,
              "end_line": 190,
              "snippet": "const handleOverlayMouseDown = (e) => {\n  mouseDownOnOverlay.current = e.target === e.currentTarget;\n};\n\nconst handleOverlayClick = (e) => {\n  if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n    onClose();\n  }\n};\n\n// Close on escape key\nconst handleKeyDown = useCallback(\n  (e) => {\n    if (e.key === \"Escape\") {\n      onClose();\n    }\n  },\n  [onClose]\n);\n\nuseEffect(() => {\n  if (isOpen) {\n    document.addEventListener(\"keydown\", handleKeyDown);\n    document.body.style.overflow = \"hidden\";\n  }\n  return () => {\n    document.removeEventListener(\"keydown\", handleKeyDown);\n    document.body.style.overflow = \"\";\n  };\n}, [isOpen, handleKeyDown]);"
            },
            {
              "file": "apps/chronicler/webui/src/components/ImageLightbox.tsx",
              "start_line": 20,
              "end_line": 50,
              "snippet": "const mouseDownOnOverlay = useRef(false);\n\nconst handleOverlayMouseDown = (e: MouseEvent<HTMLDivElement>) => {\n  mouseDownOnOverlay.current = e.target === e.currentTarget;\n};\n\nconst handleOverlayClick = (e: MouseEvent<HTMLDivElement>) => {\n  if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n    onClose();\n  }\n};\n\nconst handleKeyDown = useCallback(\n  (e: KeyboardEvent) => {\n    if (e.key === \"Escape\") {\n      onClose();\n    }\n  },\n  [onClose]\n);\n\nuseEffect(() => {\n  if (!isOpen) return undefined;\n  document.addEventListener(\"keydown\", handleKeyDown);\n  const previousOverflow = document.body.style.overflow;\n  document.body.style.overflow = \"hidden\";\n  return () => {\n    document.removeEventListener(\"keydown\", handleKeyDown);\n    document.body.style.overflow = previousOverflow;\n  };\n}, [isOpen, handleKeyDown]);"
            }
          ],
          "implementation_details": "These modals manually reimplement the exact same mouseDown guard, Escape key listener, and scroll lock that ModalShell provides. ImageLightbox preserves previousOverflow (matches ModalShell), while ImageModal/ImagePickerModal/ChronicleImagePicker/ChronicleWizard reset to empty string. These are structurally identical to ModalShell but cannot benefit from centralized fixes or enhancements. Note: ImageModal has a unique full-viewport layout with floating header, sidebar, and hint text that may justify a specialized component rather than ModalShell, but the interaction behaviors are still duplicated."
        },
        {
          "name": "ad-hoc-mousedown-guard-partial",
          "description": "Implements mouseDown guard overlay close and close button, but lacks Escape key handler and body scroll lock",
          "file_count": 4,
          "files": [
            "apps/canonry/webui/src/components/HelpModal.jsx",
            "apps/archivist/webui/src/components/RelationshipStoryModal.tsx",
            "apps/coherence-engine/webui/src/components/pressures/modals/FactorEditorModal.jsx",
            "apps/lore-weave/webui/src/components/DebugSettingsModal.jsx"
          ],
          "sample_file": "apps/canonry/webui/src/components/HelpModal.jsx",
          "code_excerpts": [
            {
              "file": "apps/canonry/webui/src/components/HelpModal.jsx",
              "start_line": 183,
              "end_line": 206,
              "snippet": "const mouseDownOnOverlay = useRef(false);\n\nconst handleOverlayMouseDown = (e) => {\n  mouseDownOnOverlay.current = e.target === e.currentTarget;\n};\n\nconst handleOverlayClick = (e) => {\n  if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n    onClose();\n  }\n};\n\nreturn (\n  <div\n    className=\"modal-overlay\"\n    onMouseDown={handleOverlayMouseDown}\n    onClick={handleOverlayClick}\n    role=\"button\"\n    tabIndex={0}\n    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n  >"
            },
            {
              "file": "apps/archivist/webui/src/components/RelationshipStoryModal.tsx",
              "start_line": 17,
              "end_line": 44,
              "snippet": "const mouseDownOnOverlay = useRef(false);\n\nconst handleOverlayMouseDown = (e: React.MouseEvent) => {\n  mouseDownOnOverlay.current = e.target === e.currentTarget;\n};\n\nconst handleOverlayClick = (e: React.MouseEvent) => {\n  if (mouseDownOnOverlay.current && e.target === e.currentTarget) {\n    onClose();\n  }\n};\n\nreturn (\n  <div\n    className=\"relationship-story-overlay\"\n    onMouseDown={handleOverlayMouseDown}\n    onClick={handleOverlayClick}\n    role=\"button\"\n    tabIndex={0}\n    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n  >"
            }
          ],
          "implementation_details": "These modals have overlay close with the mouseDown guard (preventing accidental text-selection dismissal) and a close button, but they lack Escape key handling and body scroll lock. HelpModal and FactorEditorModal use modal-overlay CSS from shared styles. RelationshipStoryModal uses its own relationship-story-overlay CSS. DebugSettingsModal uses lw-modal-overlay. All four would gain Escape+scroll-lock for free by migrating to ModalShell."
        },
        {
          "name": "simple-onclick-overlay",
          "description": "Uses bare onClick on overlay \u2014 no mouseDown guard, so text-selection drag from inside the modal triggers accidental close. Missing Escape and scroll lock.",
          "file_count": 2,
          "files": [
            "apps/illuminator/webui/src/components/QuickCheckModal.jsx",
            "apps/name-forge/webui/src/components/optimizer/ResultsModal.jsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/QuickCheckModal.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/QuickCheckModal.jsx",
              "start_line": 239,
              "end_line": 243,
              "snippet": "return <div className=\"qcm-overlay\" onClick={e => {\n  if (e.target === e.currentTarget) onClose();\n}} role=\"button\" tabIndex={0} onKeyDown={e => {\n  if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click();\n}}>"
            },
            {
              "file": "apps/name-forge/webui/src/components/optimizer/ResultsModal.jsx",
              "start_line": 70,
              "end_line": 73,
              "snippet": "return <div className=\"optimizer-modal-overlay\" onClick={e => {\n  if (e.target === e.currentTarget && !optimizing) onClose();\n}} role=\"button\" tabIndex={0} onKeyDown={e => {\n  if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click();"
            }
          ],
          "implementation_details": "Both modals use a simple onClick handler with e.target === e.currentTarget guard, but lack the mouseDown guard. This means if a user starts a mouse-down inside the modal (e.g., selecting text) and releases on the overlay, the modal closes \u2014 a known UX bug. Neither has Escape key handling or body scroll lock. QuickCheckModal has its own qcm-overlay CSS; ResultsModal uses optimizer-modal-overlay CSS. ResultsModal additionally guards against close during optimizing state."
        },
        {
          "name": "no-overlay-close",
          "description": "Modal uses a fixed backdrop but has no overlay click handler, no Escape key handler, and no scroll lock \u2014 only closable via explicit buttons",
          "file_count": 2,
          "files": [
            "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
            "apps/illuminator/webui/src/components/BulkOperationShell.jsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
              "start_line": 224,
              "end_line": 230,
              "snippet": "return (\n  <div className=\"cem-backdrop\">\n    <div className=\"cem-card\">\n      {/* Header */}\n      <div className=\"cem-header\">\n        <h2 className=\"cem-title\">{title}</h2>"
            },
            {
              "file": "apps/illuminator/webui/src/components/BulkOperationShell.jsx",
              "start_line": 77,
              "end_line": 80,
              "snippet": "return <div className=\"bulk-overlay\">\n    <div className=\"bulk-dialog\" style={{\n    \"--bulk-dialog-width\": isConfirming ? confirmWidth : processWidth\n  }}>"
            }
          ],
          "implementation_details": "CreateEntityModal renders a cem-backdrop div with no click handler \u2014 the modal can only be closed via the Cancel or Create/Save footer buttons. This may be partially intentional (form data loss prevention), but there is no Escape key handler either, which is inconsistent with all other modals. BulkOperationShell intentionally omits overlay close to prevent accidental interruption of long-running bulk operations \u2014 this IS intentional behavior. However, BulkOperationShell also lacks Escape handling even during the confirming phase where closing would be safe."
        },
        {
          "name": "inline-modal-in-parent",
          "description": "Modal markup is inlined directly in a parent component rather than extracted into a dedicated modal component, using mouseDown guard overlay close but no Escape or scroll lock",
          "file_count": 1,
          "files": [
            "apps/canonry/webui/src/components/ProjectManager.jsx"
          ],
          "sample_file": "apps/canonry/webui/src/components/ProjectManager.jsx",
          "code_excerpts": [
            {
              "file": "apps/canonry/webui/src/components/ProjectManager.jsx",
              "start_line": 264,
              "end_line": 301,
              "snippet": "{showNewModal && (\n  <div\n    className=\"modal-overlay\"\n    onMouseDown={handleOverlayMouseDown}\n    onClick={handleOverlayClick}\n    role=\"button\"\n    tabIndex={0}\n    onKeyDown={(e) => { if (e.key === \"Enter\" || e.key === \" \") handleOverlayClick(e); }}\n  >\n    <div className=\"modal modal-simple\">\n      <div className=\"modal-header\">\n        <div className=\"modal-title\">Create New Project</div>\n        <button className=\"btn-close\" onClick={() => setShowNewModal(false)}>\u00d7</button>\n      </div>\n      <div className=\"modal-body\">\n        <input ... autoFocus onKeyDown={(e) => e.key === \"Enter\" && handleCreate()} />\n        <div className=\"modal-actions\">\n          <button onClick={() => setShowNewModal(false)}>Cancel</button>\n          <button onClick={handleCreate}>Create</button>\n        </div>\n      </div>\n    </div>\n  </div>\n)}"
            }
          ],
          "implementation_details": "The Create New Project modal is inlined directly inside ProjectManager.jsx rather than extracted into its own component. It uses the shared modal-overlay class and mouseDown guard (defined in the parent component's scope), but lacks Escape key handling and body scroll lock. The input has autoFocus which is good, but pressing Escape while typing does nothing. Uses the shared modal/modal-header/modal-body CSS classes so it looks consistent, but the interaction behavior is incomplete compared to ModalShell."
        }
      ],
      "behavior_matrix": {
        "ModalShell (canonical)": {
          "overlay_close": "mouseDown guard: e.target === e.currentTarget (handleOverlayMouseDown + handleOverlayClick)",
          "escape_close": "document.addEventListener('keydown') \u2014 respects preventOverlayClose prop",
          "scroll_lock": "document.body.style.overflow = 'hidden' on mount, restore previous on unmount",
          "close_button": "btn-close in modal-header",
          "focus_trap": false,
          "aria_role": "role='button' tabIndex={0} on overlay"
        },
        "ImageModal (illuminator)": {
          "overlay_close": "mouseDown guard: identical to ModalShell",
          "escape_close": "useCallback + document.addEventListener('keydown')",
          "scroll_lock": "body.style.overflow = 'hidden' \u2014 resets to empty string (not previous value)",
          "close_button": "Close (Esc) button in floating header",
          "focus_trap": false,
          "aria_role": "role='button' tabIndex={0} on overlay"
        },
        "ImagePickerModal (illuminator)": {
          "overlay_close": "mouseDown guard: identical to ModalShell",
          "escape_close": "useEffect + document.addEventListener('keydown')",
          "scroll_lock": "body.style.overflow = 'hidden' \u2014 resets to empty string",
          "close_button": "illuminator-modal-close \u00d7 button",
          "focus_trap": false,
          "aria_role": "role='button' tabIndex={0} on overlay"
        },
        "ChronicleImagePicker (illuminator)": {
          "overlay_close": "mouseDown guard: identical to ModalShell",
          "escape_close": "useEffect + document.addEventListener('keydown')",
          "scroll_lock": "body.style.overflow = 'hidden' \u2014 resets to empty string",
          "close_button": "illuminator-modal-close \u00d7 button",
          "focus_trap": false,
          "aria_role": "role='button' tabIndex={0} on overlay"
        },
        "ChronicleWizard (illuminator)": {
          "overlay_close": "mouseDown guard: identical to ModalShell",
          "escape_close": "useEffect + document.addEventListener('keydown') \u2014 calls handleClose (resets wizard state)",
          "scroll_lock": "body.style.overflow = 'hidden' \u2014 resets to empty string",
          "close_button": "close button in wizard UI",
          "focus_trap": false,
          "aria_role": "role='button' tabIndex={0} on overlay"
        },
        "ImageLightbox (chronicler)": {
          "overlay_close": "mouseDown guard: identical to ModalShell",
          "escape_close": "useCallback + document.addEventListener('keydown')",
          "scroll_lock": "body.style.overflow = 'hidden' \u2014 preserves and restores previousOverflow (best practice)",
          "close_button": "Close button (CSS module styles.closeButton)",
          "focus_trap": false,
          "aria_role": "role='dialog' aria-modal='true' aria-label (most accessible \u2014 unique in codebase)"
        },
        "HelpModal (canonry)": {
          "overlay_close": "mouseDown guard: identical to ModalShell",
          "escape_close": false,
          "scroll_lock": false,
          "close_button": "btn-close \u00d7 in modal-header",
          "focus_trap": false,
          "aria_role": "role='button' tabIndex={0} on overlay"
        },
        "RelationshipStoryModal (archivist)": {
          "overlay_close": "mouseDown guard: identical to ModalShell",
          "escape_close": false,
          "scroll_lock": false,
          "close_button": "relationship-story-close \u00d7 button",
          "focus_trap": false,
          "aria_role": "role='button' tabIndex={0} on overlay"
        },
        "FactorEditorModal (coherence-engine)": {
          "overlay_close": "mouseDown guard: identical to ModalShell \u2014 uses modal-overlay class",
          "escape_close": false,
          "scroll_lock": false,
          "close_button": "btn-close \u00d7 in modal-header",
          "focus_trap": false,
          "aria_role": "role='button' tabIndex={0} on overlay"
        },
        "DebugSettingsModal (lore-weave)": {
          "overlay_close": "mouseDown guard: identical to ModalShell \u2014 uses lw-modal-overlay class",
          "escape_close": false,
          "scroll_lock": false,
          "close_button": "close button in header",
          "focus_trap": false,
          "aria_role": "role='button' tabIndex={0} on overlay"
        },
        "QuickCheckModal (illuminator)": {
          "overlay_close": "simple onClick with e.target === e.currentTarget (BUG: drag-from-modal triggers close)",
          "escape_close": false,
          "scroll_lock": false,
          "close_button": "qcm-close-btn \u00d7 and footer Dismiss button",
          "focus_trap": false,
          "aria_role": "role='button' tabIndex={0} on overlay"
        },
        "ResultsModal (name-forge)": {
          "overlay_close": "simple onClick with e.target === e.currentTarget (BUG: drag triggers close) \u2014 guards against close during optimizing",
          "escape_close": false,
          "scroll_lock": false,
          "close_button": "close button in header",
          "focus_trap": false,
          "aria_role": "role='button' tabIndex={0} on overlay"
        },
        "CreateEntityModal (illuminator)": {
          "overlay_close": false,
          "escape_close": false,
          "scroll_lock": false,
          "close_button": "Cancel and Create/Save buttons in footer only",
          "focus_trap": false,
          "aria_role": "none \u2014 bare cem-backdrop div"
        },
        "BulkOperationShell (illuminator)": {
          "overlay_close": "false (intentional \u2014 prevents accidental interruption of bulk operations)",
          "escape_close": false,
          "scroll_lock": false,
          "close_button": "Cancel/Close button in footer",
          "focus_trap": false,
          "aria_role": "none \u2014 bare bulk-overlay div"
        },
        "ProjectManager inline modal (canonry)": {
          "overlay_close": "mouseDown guard: identical to ModalShell \u2014 uses modal-overlay class",
          "escape_close": false,
          "scroll_lock": false,
          "close_button": "btn-close \u00d7 in modal-header + Cancel button",
          "focus_trap": false,
          "aria_role": "role='button' tabIndex={0} on overlay"
        }
      },
      "missing_behavior_complexity": {
        "escape_key_all_missing": "trivial \u2014 add useEffect with document keydown listener for e.key === 'Escape' (~5 lines). Even easier: migrate to ModalShell to get it for free.",
        "scroll_lock_all_missing": "trivial \u2014 add useEffect with body.style.overflow = 'hidden' on mount (~4 lines). Even easier: migrate to ModalShell.",
        "focus_trap": "moderate \u2014 needs tabIndex management, focus-on-first-focusable logic, or focus-trap library. No modal in the codebase currently implements this. ModalShell should add it as a centralized enhancement.",
        "aria_dialog_role": "trivial \u2014 ImageLightbox is the only modal using role='dialog' aria-modal='true'. All others use role='button' on overlay, which is semantically incorrect for a dialog."
      },
      "analysis": "The codebase has a clear canonical pattern (ModalShell) that provides overlay close with mouseDown guard, Escape key, scroll lock, and close button \u2014 but only 12 of ~18 distinct modal components use it. The remaining 6+ custom modals are drift: they manually reimplement some subset of the same behaviors. Five modals (ImageModal, ImagePickerModal, ChronicleImagePicker, ChronicleWizard, ImageLightbox) fully reimplement all behaviors \u2014 pure code duplication with minor scroll-lock restoration differences. Four modals (HelpModal, RelationshipStoryModal, FactorEditorModal, DebugSettingsModal) plus ProjectManager's inline modal implement overlay close but miss Escape and scroll lock \u2014 these create inconsistent UX where some modals respond to Escape and others don't. Two modals (QuickCheckModal, ResultsModal) have a bug-prone simple onClick pattern that triggers accidental close on text-selection drag. CreateEntityModal intentionally omits overlay close (form data protection) which is reasonable, but still lacks Escape. BulkOperationShell intentionally blocks all dismissal during processing, which is appropriate. The recommended path is: (1) migrate HelpModal, RelationshipStoryModal, FactorEditorModal, DebugSettingsModal, ProjectManager modal, QuickCheckModal, and ResultsModal to ModalShell; (2) for full-viewport modals like ImageModal and ImageLightbox, either extract a LightboxShell variant of ModalShell or add a 'fullscreen' mode; (3) add Escape-to-close to CreateEntityModal (perhaps with unsaved-changes confirmation); (4) add Escape-to-cancel in BulkOperationShell's confirming phase.\n\nAlso noted by behavioral audit: This is a codebase-wide accessibility issue rather than drift between modals \u2014 nearly every modal has the same incorrect ARIA pattern. The role='button' was likely added as a quick fix for jsx-a11y/click-events-have-key-events lint rule. The correct solution is role='dialog' aria-modal='true' on the overlay, with aria-label or aria-labelledby pointing to the title. The modal container should not have role='button' at all. Since ModalShell is the canonical component, fixing the ARIA in ModalShell propagates to all 12 consumers automatically. ImageLightbox already demonstrates the correct pattern and can serve as the reference implementation. This is a medium-impact finding because it affects screen reader usability for all dialogs.",
      "recommendation": "Migrate all standard modals to ModalShell. For non-standard layouts: (a) Add ModalShell variant or 'fullscreen' className for ImageModal/ImageLightbox; (b) QuickCheckModal and ResultsModal should migrate to ModalShell immediately \u2014 their onClick bug is user-visible; (c) Add role='dialog' aria-modal='true' to ModalShell (currently only ImageLightbox has correct ARIA); (d) ModalShell should preserve previous overflow value (ImageLightbox pattern) instead of resetting to empty string.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "modals",
      "merged_from": [
        "modal-aria-role-inconsistency"
      ]
    },
    {
      "id": "modal-overlay-css-variants",
      "name": "Modal Overlay CSS Class Proliferation",
      "type": "behavioral",
      "domain": "Modal/Dialog Interaction Consistency",
      "description": "Modal overlays across the codebase use 8+ different CSS class names for what is fundamentally the same visual pattern (fixed position, dark semi-transparent background, centered flex container). Each carries its own styling definition rather than reusing the canonical .modal-overlay class.",
      "impact": "LOW",
      "total_files": 18,
      "variants": [
        {
          "name": "modal-overlay-shared",
          "description": "Uses the canonical .modal-overlay class from shared-components CSS, adopted by ModalShell users and some ad-hoc modals",
          "file_count": 8,
          "files": [
            "packages/shared-components/src/styles/components/modal.css",
            "apps/canonry/webui/src/components/HelpModal.jsx",
            "apps/canonry/webui/src/components/ProjectManager.jsx",
            "apps/coherence-engine/webui/src/components/pressures/modals/FactorEditorModal.jsx",
            "apps/coherence-engine/webui/src/components/systems/SystemModal.jsx",
            "apps/coherence-engine/webui/src/components/actions/modals/ActionModal.jsx",
            "apps/coherence-engine/webui/src/components/generators/GeneratorModal.jsx",
            "apps/name-forge/webui/src/components/modals/ConditionsModal.jsx"
          ],
          "sample_file": "packages/shared-components/src/styles/components/modal.css",
          "code_excerpts": [
            {
              "file": "packages/shared-components/src/styles/components/modal.css",
              "start_line": 1,
              "end_line": 8,
              "snippet": ".modal-overlay {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}"
            }
          ],
          "implementation_details": "Canonical CSS class used by ModalShell and all modals that import shared-components styles. Provides fixed positioning, dark overlay at 50% opacity, flexbox centering, z-index 1000."
        },
        {
          "name": "app-specific-overlay-classes",
          "description": "Each custom modal invents its own overlay class name with nearly identical CSS",
          "file_count": 8,
          "files": [
            "apps/illuminator/webui/src/components/ImageModal.jsx (imod-overlay)",
            "apps/illuminator/webui/src/components/ImagePickerModal.jsx (illuminator-modal-overlay)",
            "apps/illuminator/webui/src/components/ChronicleImagePicker.jsx (illuminator-modal-overlay)",
            "apps/illuminator/webui/src/components/QuickCheckModal.jsx (qcm-overlay)",
            "apps/illuminator/webui/src/components/CreateEntityModal.tsx (cem-backdrop)",
            "apps/illuminator/webui/src/components/BulkOperationShell.jsx (bulk-overlay)",
            "apps/archivist/webui/src/components/RelationshipStoryModal.tsx (relationship-story-overlay)",
            "apps/lore-weave/webui/src/components/DebugSettingsModal.jsx (lw-modal-overlay)"
          ],
          "sample_file": "apps/illuminator/webui/src/components/BulkOperationShell.css",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/BulkOperationShell.css",
              "start_line": 4,
              "end_line": 12,
              "snippet": ".bulk-overlay {\n  position: fixed;\n  inset: 0;\n  background: rgb(0 0 0 / 50%);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n}"
            }
          ],
          "implementation_details": "Eight different class names that all define the same visual pattern: position: fixed; inset: 0; semi-transparent black background; flexbox centering. The only meaningful differences are z-index (bulk-overlay uses 10000 to layer above other modals, others use 1000) and cem-backdrop uses 60% opacity instead of 50%. ResultsModal uses optimizer-modal-overlay and ImageLightbox uses CSS modules \u2014 adding 2 more variants for a total of 10."
        }
      ],
      "behavior_matrix": {
        ".modal-overlay (shared)": {
          "z_index": "1000",
          "background_opacity": "0.5"
        },
        ".imod-overlay": {
          "z_index": "1000",
          "background_opacity": "~0.5"
        },
        ".qcm-overlay": {
          "z_index": "1000",
          "background_opacity": "~0.5"
        },
        ".cem-backdrop": {
          "z_index": "1000",
          "background_opacity": "0.6"
        },
        ".bulk-overlay": {
          "z_index": "10000",
          "background_opacity": "0.5"
        },
        ".relationship-story-overlay": {
          "z_index": "1000",
          "background_opacity": "~0.5"
        },
        ".lw-modal-overlay": {
          "z_index": "1000",
          "background_opacity": "~0.5"
        },
        ".illuminator-modal-overlay": {
          "z_index": "1000",
          "background_opacity": "~0.5"
        },
        ".optimizer-modal-overlay": {
          "z_index": "1000",
          "background_opacity": "~0.5"
        },
        "styles.overlay (CSS module)": {
          "z_index": "1000",
          "background_opacity": "~0.5"
        }
      },
      "missing_behavior_complexity": {
        "unify_overlay_classes": "trivial \u2014 modals migrated to ModalShell automatically use .modal-overlay. For non-ModalShell modals, replace custom overlay class with .modal-overlay import."
      },
      "analysis": "This is structural drift \u2014 all 10 overlay class variants produce nearly identical visual results (fixed positioning, dark semi-transparent background, centered child). The one meaningful difference is z-index: BulkOperationShell uses z-index 10000 because it needs to layer above other modals, and CreateEntityModal uses 60% opacity instead of 50%. The proliferation of class names creates maintenance burden: if the design team changes the overlay style (e.g., blur instead of opacity), it must be updated in 10 places. Migrating to ModalShell solves this for most cases. For exceptions (BulkOperationShell's stacking, ImageModal's full-viewport layout), the overlay div could still use .modal-overlay with a z-index override.",
      "recommendation": "Migration to ModalShell eliminates this for standard modals. For non-ModalShell modals, compose with .modal-overlay class plus modifier classes (e.g., .modal-overlay--high-z for bulk operations). Consider a z-index scale in CSS custom properties.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "modals"
    },
    {
      "id": "success-failure-feedback-mechanisms",
      "name": "Success/Failure Feedback Mechanisms",
      "type": "behavioral",
      "domain": "Notification & Feedback Patterns",
      "description": "After async operations complete (save, sync, rename, bulk ops), different apps and components provide feedback through vastly different mechanisms: fixed-position toast (ChroniclePanel), inline error div with dismiss button (NameForge EntityWorkspace), inline error text (CorpusFindReplace), styled error box (SimulationRunner), snapshotStatus state object (Canonry AWS), or console.error only. No shared toast/notification system exists.",
      "impact": "MEDIUM",
      "total_files": 25,
      "variants": [
        {
          "name": "ad-hoc-fixed-toast-chronicle",
          "description": "Fixed-position toast notifications built inline in ChroniclePanel JSX. Each toast type has its own useState + onClick-to-dismiss + close button. Positioned bottom-right with z-index 1001. Uses chron-toast / chron-toast-success / chron-toast-error classes. Five separate toast instances copy-pasted with identical structure but different state variables.",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChroniclePanel.jsx:2483-2558"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
              "start_line": 2483,
              "end_line": 2497,
              "snippet": "{eraSummaryRefreshResult && <div className={`chron-toast ${eraSummaryRefreshResult.success ? \"chron-toast-success\" : \"chron-toast-error\"}`} onClick={() => setEraSummaryRefreshResult(null)} role=\"button\" tabIndex={0} onKeyDown={e => {\n  if (e.key === \"Enter\" || e.key === \" \") e.currentTarget.click();\n}}>\n  <span>{(() => {\n    if (!eraSummaryRefreshResult.success) return `Error: ${eraSummaryRefreshResult.error}`;\n    if (eraSummaryRefreshResult.count > 0) {\n      const plural = eraSummaryRefreshResult.count !== 1 ? \"s\" : \"\";\n      return `Updated era summaries in ${eraSummaryRefreshResult.count} chronicle${plural}`;\n    }\n    return \"All chronicle era summaries are already up to date\";\n  })()}</span>\n  <button className=\"chron-toast-close\">&times;</button>\n</div>}"
            },
            {
              "file": "apps/illuminator/webui/src/components/ChroniclePanel.css",
              "start_line": 663,
              "end_line": 691,
              "snippet": ".chron-toast {\n  position: fixed;\n  bottom: 24px;\n  right: 24px;\n  color: white;\n  padding: 16px 24px;\n  border-radius: 8px;\n  box-shadow: 0 8px 24px rgb(0 0 0 / 20%);\n  z-index: 1001;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n.chron-toast-success { background: rgb(16 185 129 / 95%); }\n.chron-toast-error { background: rgb(239 68 68 / 95%); }"
            }
          ],
          "implementation_details": "Five separate useState hooks (eraSummaryRefreshResult, temporalCheckResult, bulkSummaryResult, resetBackportResult, reconcileBackportResult) each drive an identical toast template. No auto-dismiss timer. User must click to dismiss. No shared toast component or store."
        },
        {
          "name": "inline-error-with-dismiss-button",
          "description": "Error state shown as an inline div with a 'Dismiss' button, positioned inside the component's header area. Uses generic .error CSS class. Pattern used in NameForge EntityWorkspace and CultureSidebar.",
          "file_count": 3,
          "files": [
            "apps/name-forge/webui/src/components/workspace/EntityWorkspace.jsx:120-127",
            "apps/name-forge/webui/src/components/sidebar/CultureSidebar.jsx:14-55",
            "apps/name-forge/webui/src/components/workspace/tabs/LexemesTab.jsx:105-136"
          ],
          "sample_file": "apps/name-forge/webui/src/components/workspace/EntityWorkspace.jsx",
          "code_excerpts": [
            {
              "file": "apps/name-forge/webui/src/components/workspace/EntityWorkspace.jsx",
              "start_line": 120,
              "end_line": 127,
              "snippet": "{error && (\n  <div className=\"error mt-sm\">\n    {error}\n    <button className=\"secondary ml-sm\" onClick={() => setError(null)}>\n      Dismiss\n    </button>\n  </div>\n)}"
            },
            {
              "file": "apps/name-forge/webui/src/App.css",
              "start_line": 582,
              "end_line": 590,
              "snippet": ".error {\n  background: rgb(239 68 68 / 15%);\n  color: #fca5a5;\n  padding: var(--space-md);\n  border-radius: 4px;\n  margin-bottom: var(--space-md);\n  border: 1px solid rgb(239 68 68 / 30%);\n  font-size: var(--text-sm);\n}"
            }
          ],
          "implementation_details": "Local useState for error string. Set by validation or catch blocks, cleared by user click. Rendered inline in component header. Uses NameForge's global .error class. No auto-dismiss."
        },
        {
          "name": "styled-error-box-loreweave",
          "description": "Dedicated .lw-error-box CSS class for error display in SimulationRunner. Shows error message + phase context inline. No dismiss button \u2014 persists until next run.",
          "file_count": 1,
          "files": [
            "apps/lore-weave/webui/src/components/runner/SimulationRunner.jsx:566-571"
          ],
          "sample_file": "apps/lore-weave/webui/src/components/runner/SimulationRunner.jsx",
          "code_excerpts": [
            {
              "file": "apps/lore-weave/webui/src/components/runner/SimulationRunner.jsx",
              "start_line": 566,
              "end_line": 571,
              "snippet": "{simState.error && (\n  <div className=\"lw-error-box\">\n    <strong>Error:</strong> {simState.error.message}\n    {simState.error.phase && <span> (during {simState.error.phase})</span>}\n  </div>\n)}"
            },
            {
              "file": "apps/lore-weave/webui/src/App.css",
              "start_line": 973,
              "end_line": 981,
              "snippet": ".lw-error-box {\n  background-color: rgb(239 68 68 / 10%);\n  border: 1px solid rgb(239 68 68 / 30%);\n  border-radius: var(--lw-radius-lg);\n  padding: var(--lw-space-lg);\n  margin-bottom: var(--lw-space-xl);\n  color: var(--lw-danger);\n  font-size: var(--lw-text-lg);\n}"
            }
          ],
          "implementation_details": "Error comes from simState.error (worker hook state), not a local useState. Includes phase context. No dismiss mechanism. Disappears when simulation is restarted."
        },
        {
          "name": "cfr-error-banner-inline",
          "description": "CorpusFindReplace uses two different error display variants within the same component: .cfr-error-banner (styled box in preview phase) and .cfr-error-inline (plain text in generating phase). Both are component-scoped CSS.",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/CorpusFindReplace.tsx:1303,1374"
          ],
          "sample_file": "apps/illuminator/webui/src/components/CorpusFindReplace.tsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/CorpusFindReplace.tsx",
              "start_line": 1303,
              "end_line": 1303,
              "snippet": "{error && <div className=\"cfr-error-banner\">{error}</div>}"
            },
            {
              "file": "apps/illuminator/webui/src/components/CorpusFindReplace.css",
              "start_line": 348,
              "end_line": 362,
              "snippet": ".cfr-error-banner {\n  margin-bottom: 12px;\n  padding: 8px 14px;\n  background: rgb(239 68 68 / 10%);\n  border-radius: 6px;\n  border: 1px solid rgb(239 68 68 / 30%);\n  font-size: 11px;\n  color: #ef4444;\n}\n.cfr-error-inline {\n  margin-top: 12px;\n  font-size: 12px;\n  color: #ef4444;\n}"
            }
          ],
          "implementation_details": "Same component uses two CSS-only variants for error display depending on the current phase. No dismiss button in either. Error cleared on operation reset via setError(null)."
        },
        {
          "name": "canonry-status-state-object",
          "description": "Canonry AWS operations use a status state object { state: 'idle'|'working'|'error', detail: string } in the Zustand store. Status is rendered inline with conditional CSS class toggling (canonry-snapshot-detail-error vs canonry-snapshot-detail-default).",
          "file_count": 2,
          "files": [
            "apps/canonry/webui/src/App.jsx:2416-2418",
            "apps/canonry/webui/src/stores/useCanonryAwsStore.js:39,56"
          ],
          "sample_file": "apps/canonry/webui/src/App.jsx",
          "code_excerpts": [
            {
              "file": "apps/canonry/webui/src/App.jsx",
              "start_line": 2416,
              "end_line": 2418,
              "snippet": "{snapshotStatus.detail && <div className={snapshotStatus.state === \"error\" ? \"canonry-snapshot-detail canonry-snapshot-detail-error\" : \"canonry-snapshot-detail canonry-snapshot-detail-default\"}>\n  {snapshotStatus.detail}\n</div>}"
            },
            {
              "file": "apps/canonry/webui/src/stores/useCanonryAwsStore.js",
              "start_line": 39,
              "end_line": 56,
              "snippet": "status: { state: \"idle\", detail: \"\" },\nsyncProgress: { phase: \"idle\", processed: 0, total: 0, uploaded: 0 },\nsnapshotStatus: { state: \"idle\", detail: \"\" },"
            }
          ],
          "implementation_details": "Uses a structured state object in Zustand store rather than a simple error string. State machine semantics (idle/working/error). Rendered inline with ternary className. No dismiss mechanism \u2014 overwritten by next operation."
        },
        {
          "name": "canonry-global-error-banner",
          "description": "Canonry App renders a global error banner at the bottom of the page using the project storage error state. Unstyled inline class (inline-extracted-6 from a previous CSS extraction).",
          "file_count": 1,
          "files": [
            "apps/canonry/webui/src/App.jsx:2187-2189"
          ],
          "sample_file": "apps/canonry/webui/src/App.jsx",
          "code_excerpts": [
            {
              "file": "apps/canonry/webui/src/App.jsx",
              "start_line": 2187,
              "end_line": 2189,
              "snippet": "{error && <div className=\"inline-extracted-6\">\n  Error: {error}\n</div>}"
            }
          ],
          "implementation_details": "Project-level error from useProjectStorage hook displayed as fixed-position banner near footer. No dismiss button. Error persists until cleared by a successful operation. Uses a generated class name from inline style extraction."
        },
        {
          "name": "window-confirm-for-destructive-actions",
          "description": "Destructive confirmation uses native window.confirm() dialogs across all apps. Used for deletions, overwrites, and data imports. 15+ instances across canonry, illuminator, cosmographer, and name-forge.",
          "file_count": 6,
          "files": [
            "apps/canonry/webui/src/components/SlotSelector.jsx:30,58,65,221,330",
            "apps/canonry/webui/src/App.jsx:847",
            "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx:804-814",
            "apps/illuminator/webui/src/components/StoragePanel.jsx:190,221",
            "apps/illuminator/webui/src/hooks/useDataSync.js:53,59",
            "apps/name-forge/webui/src/components/workspace/tabs/DomainTab.jsx:94"
          ],
          "sample_file": "apps/illuminator/webui/src/hooks/useDataSync.js",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/hooks/useDataSync.js",
              "start_line": 53,
              "end_line": 63,
              "snippet": "const ok = window.confirm(\n  `Hard state run ID (${hardRunId}) does not match this slot's run (${slotRecord.simulationRunId}). Importing will switch this slot to the hard state run. Continue?`\n);\nif (!ok) return { cancelled: true };\n...\nconst ok = window.confirm(\n  \"Overwrite will replace ALL Dexie entities, events, and relationships for this run with hard state. This can delete local enrichment. Continue?\"\n);\nif (!ok) return { cancelled: true };"
            },
            {
              "file": "apps/canonry/webui/src/components/SlotSelector.jsx",
              "start_line": 30,
              "end_line": 30,
              "snippet": "<button onClick={() => { if (window.confirm(\"Clear scratch data? This cannot be undone.\")) { onClearSlot(0); setShowDropdown(false); } }} title=\"Clear scratch data\">x</button>"
            }
          ],
          "implementation_details": "Universally uses native browser confirm() for destructive action confirmation. Consistent across all apps. Inline in JSX onClick handlers or in hook functions. No custom confirmation modal (except BulkOperationShell's confirming phase, which serves a different purpose)."
        }
      ],
      "behavior_matrix": {
        "ChroniclePanel (toast)": {
          "mechanism": "fixed-position toast, bottom-right, z-index 1001",
          "success_feedback": "green toast with result count text",
          "failure_feedback": "red toast with error message",
          "auto_dismiss": false,
          "user_dismissable": "click anywhere on toast or x button",
          "placement": "fixed bottom-right overlay"
        },
        "NameForge EntityWorkspace": {
          "mechanism": "inline div with dismiss button in component header",
          "success_feedback": "none (silent)",
          "failure_feedback": "inline .error div with Dismiss button",
          "auto_dismiss": false,
          "user_dismissable": "click Dismiss button",
          "placement": "inline in workspace header"
        },
        "SimulationRunner": {
          "mechanism": "inline .lw-error-box div, persists until next run",
          "success_feedback": "dashboard shows complete status + score",
          "failure_feedback": "inline red error box with phase context",
          "auto_dismiss": false,
          "user_dismissable": "no \u2014 cleared on next run",
          "placement": "inline above simulation card"
        },
        "CorpusFindReplace": {
          "mechanism": "two different inline error styles in same component",
          "success_feedback": "result count shown in phase UI",
          "failure_feedback": ".cfr-error-banner (styled) or .cfr-error-inline (plain text)",
          "auto_dismiss": false,
          "user_dismissable": "no \u2014 cleared on reset/retry",
          "placement": "inline in component body"
        },
        "Canonry AWS snapshot": {
          "mechanism": "Zustand state object { state, detail } with inline class toggle",
          "success_feedback": "detail text with default styling",
          "failure_feedback": "detail text with error styling",
          "auto_dismiss": false,
          "user_dismissable": "no \u2014 overwritten by next operation",
          "placement": "inline in AWS settings panel"
        },
        "Canonry App (global)": {
          "mechanism": "inline div near footer from useProjectStorage error state",
          "success_feedback": "none",
          "failure_feedback": "inline 'Error: {message}' text",
          "auto_dismiss": false,
          "user_dismissable": "no explicit dismiss",
          "placement": "near page footer"
        },
        "Destructive actions (all apps)": {
          "mechanism": "native window.confirm() dialog",
          "success_feedback": "operation proceeds silently",
          "failure_feedback": "operation not performed (silent cancel)",
          "auto_dismiss": "n/a",
          "user_dismissable": "n/a \u2014 modal dialog",
          "placement": "browser-native centered modal"
        }
      },
      "missing_behavior_complexity": {
        "shared_toast_component": "moderate \u2014 needs a Zustand store + fixed-position renderer component + auto-dismiss timer. ChroniclePanel's 5 toast instances would collapse to ~5 one-liner calls.",
        "auto_dismiss_timers": "trivial \u2014 add setTimeout in toast show handler (~3 lines per toast, or built into shared component)",
        "success_feedback_for_silent_ops": "moderate \u2014 NameForge and Canonry operations that succeed silently could surface a transient success toast, but requires deciding which operations warrant feedback"
      },
      "analysis": "This is genuine behavioral drift, not intentional variation. The ChroniclePanel has grown 5 copy-pasted toast instances because no shared toast system exists. Every other component that needs feedback has independently invented its own pattern \u2014 inline divs with ad-hoc CSS classes, Zustand state objects, or no feedback at all. The visual inconsistency is notable: ChroniclePanel shows floating green/red toasts, while NameForge shows red inline banners, while SimulationRunner shows a styled error box, while Canonry shows plain text. Success feedback is especially inconsistent \u2014 ChroniclePanel is the only component that provides positive feedback, while other apps silently succeed. A shared ToastNotification component backed by a Zustand store would unify the floating toast pattern, and the 5 ChroniclePanel toasts would each become a single store call. The target API would be something like: useToast().show({ message, variant: 'success'|'error', autoDismissMs?: number }).",
      "recommendation": "Create a shared toast notification store + renderer in packages/shared-components. API: useToastStore.getState().show({ message: string, variant: 'success' | 'error' | 'info', autoDismissMs?: number }). Renderer: <ToastContainer /> mounted once in each app shell. Migrate ChroniclePanel's 5 toasts first (highest duplication). Leave inline error displays as-is for form validation (inline errors near the relevant field are appropriate UX for validation), but async operation results should use the shared toast.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "notifications"
    },
    {
      "id": "error-boundary-coverage",
      "name": "Error Boundary Coverage",
      "type": "behavioral",
      "domain": "Notification & Feedback Patterns",
      "description": "A shared ErrorBoundary component exists in packages/shared-components but its adoption and error display style varies. The ErrorBoundary shows a generic recovery UI with retry button. Meanwhile, some apps have custom error states (Chronicler WikiExplorer, Archivist) with different visual treatments. The boundary between 'use ErrorBoundary' and 'handle error inline' is inconsistent.",
      "impact": "LOW",
      "total_files": 5,
      "variants": [
        {
          "name": "shared-error-boundary",
          "description": "ErrorBoundary from shared-components. Class component with getDerivedStateFromError, retry button, configurable title. Generic recovery UI.",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/components/ErrorBoundary.jsx:1-57"
          ],
          "sample_file": "packages/shared-components/src/components/ErrorBoundary.jsx",
          "code_excerpts": [
            {
              "file": "packages/shared-components/src/components/ErrorBoundary.jsx",
              "start_line": 12,
              "end_line": 48,
              "snippet": "export class ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { error: null };\n  }\n  static getDerivedStateFromError(error) {\n    return { error };\n  }\n  handleRetry = () => {\n    this.setState({ error: null });\n  };\n  render() {\n    if (this.state.error) {\n      return (\n        <div className={`error-boundary ${this.props.className || \"\"}`.trim()}>\n          <div className=\"error-boundary-icon\">!</div>\n          <div className=\"error-boundary-title\">\n            {this.props.title || \"Something went wrong\"}\n          </div>\n          <div className=\"error-boundary-message\">\n            {this.state.error.message || \"An unexpected error occurred.\"}\n          </div>\n          <button className=\"error-boundary-retry\" onClick={this.handleRetry}>\n            Retry\n          </button>\n        </div>\n      );\n    }\n    return this.props.children;\n  }\n}"
            }
          ],
          "implementation_details": "Generic error boundary for MFE remote entry points. Shows '!' icon, title, error message, and retry button. Used to wrap module federation remotes so one module's crash doesn't take down the host."
        },
        {
          "name": "chronicler-custom-error-state",
          "description": "WikiExplorer has its own custom error display with styled error card, title, details, and a fix steps list. Uses CSS modules (styles.errorContainer, etc.) \u2014 completely separate from ErrorBoundary.",
          "file_count": 1,
          "files": [
            "apps/chronicler/webui/src/components/WikiExplorer.tsx:639-643"
          ],
          "sample_file": "apps/chronicler/webui/src/components/WikiExplorer.tsx",
          "code_excerpts": [
            {
              "file": "apps/chronicler/webui/src/components/WikiExplorer.tsx",
              "start_line": 639,
              "end_line": 643,
              "snippet": "<div className={styles.errorContainer}>\n  <div className={styles.errorCard}>\n    <h2 className={styles.errorTitle}>{dataError.message}</h2>\n    <p className={styles.errorDetails}>{dataError.details}</p>\n    <div className={styles.errorFix}>"
            }
          ],
          "implementation_details": "Custom error state specific to data loading failures. Shows a rich error card with message, details, and fix steps. This is data-fetch error handling, not a render crash boundary \u2014 different concern than ErrorBoundary."
        },
        {
          "name": "archivist-error-state",
          "description": "Archivist has custom error state displays using archivist-error-state CSS class for loading and initialization errors.",
          "file_count": 1,
          "files": [
            "apps/archivist/webui/src/ArchivistRemote.tsx:83,109"
          ],
          "sample_file": "apps/archivist/webui/src/ArchivistRemote.tsx",
          "code_excerpts": [
            {
              "file": "apps/archivist/webui/src/ArchivistRemote.tsx",
              "start_line": 83,
              "end_line": 83,
              "snippet": "<div className=\"archivist-error-state\">"
            }
          ],
          "implementation_details": "Custom error state for initialization/loading failures. Separate visual treatment from shared ErrorBoundary."
        }
      ],
      "behavior_matrix": {
        "shared ErrorBoundary": {
          "trigger": "React render error (getDerivedStateFromError)",
          "display": "generic card: ! icon + title + message + Retry button",
          "styling": "error-boundary CSS classes",
          "recovery": "retry button resets error state"
        },
        "WikiExplorer error state": {
          "trigger": "data fetch error (conditional render on dataError)",
          "display": "rich card: title + details + fix steps list",
          "styling": "CSS modules (styles.errorContainer)",
          "recovery": "fix steps guide user to resolve"
        },
        "Archivist error state": {
          "trigger": "initialization/loading error",
          "display": "error state div",
          "styling": "archivist-error-state class",
          "recovery": "not specified"
        }
      },
      "missing_behavior_complexity": {},
      "analysis": "This is largely intentional variation rather than drift. ErrorBoundary serves as a crash guard for render errors \u2014 a fundamentally different concern from data-fetch error states. WikiExplorer's custom error card with fix steps is appropriate UX for data loading failures that the user can resolve. Archivist's custom error state similarly handles initialization failures. The only genuine drift is in visual consistency of error displays across apps, but since each app has its own CSS namespace and these error states serve different purposes, unification is low-value. The shared ErrorBoundary is correctly used for its intended purpose (MFE crash recovery).",
      "recommendation": "No action needed. ErrorBoundary is correctly scoped to render crashes. Data-fetch and initialization error states are a separate concern and each app's custom treatment is appropriate. If visual consistency of error states becomes important, consider a shared ErrorState component for data-fetch errors, but this is low priority.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "notifications"
    },
    {
      "id": "console-error-without-ui-feedback",
      "name": "Console-Only Error Logging Without UI Feedback",
      "type": "behavioral",
      "domain": "Notification & Feedback Patterns",
      "description": "92 console.warn/console.error calls exist in UI component files (JSX/TSX). Many of these are in catch blocks for operations that silently fail from the user's perspective \u2014 the operation fails, a console.error is logged, but no UI feedback is shown. This is especially common in ChroniclePanel (24 instances), Canonry App.jsx (17 instances), and StoragePanel (6 instances).",
      "impact": "MEDIUM",
      "total_files": 30,
      "variants": [
        {
          "name": "console-error-with-ui-fallback",
          "description": "Some components log to console AND surface the error to the user via setError or a toast. This is the correct pattern.",
          "file_count": 8,
          "files": [
            "apps/illuminator/webui/src/components/CorpusFindReplace.tsx",
            "apps/illuminator/webui/src/components/DescriptionMotifWeaver.tsx",
            "apps/canonry/webui/src/storage/useProjectStorage.js"
          ],
          "sample_file": "apps/illuminator/webui/src/components/CorpusFindReplace.tsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/CorpusFindReplace.tsx",
              "start_line": 755,
              "end_line": 758,
              "snippet": "} catch (err) {\n  setError(`Failed to dispatch batch ${bi + 1}: ${err}`);\n  setPhase(\"preview\");\n  return;\n}"
            }
          ],
          "implementation_details": "Error is caught, surfaced to user via setError(), and the component transitions to a recoverable phase. Console may also be logged but the user is informed."
        },
        {
          "name": "console-error-only-silent",
          "description": "Components log errors to console but do not surface them to the user. The operation silently fails. Common in image loading, entity operations, and storage interactions.",
          "file_count": 20,
          "files": [
            "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
            "apps/illuminator/webui/src/components/StoragePanel.jsx",
            "apps/illuminator/webui/src/components/ImagePickerModal.jsx",
            "apps/illuminator/webui/src/components/StaticPagesPanel.jsx",
            "apps/canonry/webui/src/App.jsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
              "start_line": 0,
              "end_line": 0,
              "snippet": "// Representative pattern (24 instances in this file):\ncatch (err) {\n  console.error(\"Failed to do X:\", err);\n  // No UI feedback \u2014 user sees nothing\n}"
            }
          ],
          "implementation_details": "Error is caught and logged to console only. No state update, no toast, no inline error display. The user's action appears to do nothing. They would need to open browser devtools to understand what happened."
        }
      ],
      "behavior_matrix": {
        "Pattern A: console + UI feedback": {
          "console_log": true,
          "user_visible": true,
          "recovery_guidance": "error message explains what failed",
          "files_count": "~8 files"
        },
        "Pattern B: console only": {
          "console_log": true,
          "user_visible": false,
          "recovery_guidance": "none \u2014 user must check devtools",
          "files_count": "~20 files (92 total instances in JSX/TSX)"
        }
      },
      "missing_behavior_complexity": {
        "surface_errors_to_ui": "trivial per-instance (add setError or toast call) but moderate in aggregate \u2014 92 instances across 30 files need individual assessment of whether the error is user-actionable"
      },
      "analysis": "This is the most impactful feedback gap in the codebase. Many console.error calls in catch blocks represent real user-visible failures (image load failures, entity save failures, chronicle operations) that silently fail from the user's perspective. Some console.error calls are appropriate (background preloading that doesn't affect the user), but a significant portion represent operations the user explicitly triggered where failure should be communicated. The lack of a shared toast system (finding B1) makes this worse \u2014 adding UI feedback today means each component needs its own error display mechanism, which discourages developers from adding it. A shared toast system would make it trivial to replace console.error(msg) with showToast({ message: msg, variant: 'error' }) for user-initiated operations.",
      "recommendation": "After implementing the shared toast system from finding B1, audit all console.error/console.warn calls in UI components and classify each as: (a) user-initiated operation failure -> add toast, (b) background/passive failure -> leave as console, (c) developer debug info -> leave as console. Focus first on ChroniclePanel (24 instances) and StoragePanel (6 instances) as highest-impact targets.",
      "evidence_quality": "medium",
      "status": "pending",
      "source_domain": "notifications"
    },
    {
      "id": "modal-shell-adoption",
      "name": "ModalShell Adoption Gap",
      "type": "behavioral",
      "domain": "Shared Component Adoption",
      "description": "The shared ModalShell component provides overlay click-to-close (mouseDown guard), Escape key handling, body scroll lock, header with close button, and optional tabs. However, only 12 of ~34 modal files across the project use it. The remaining 22 modals reimplement the overlay/backdrop pattern ad-hoc with inconsistent behavior.",
      "impact": "MEDIUM",
      "total_files": 34,
      "variants": [
        {
          "name": "uses-modal-shell",
          "description": "Imports and uses the shared ModalShell component, getting overlay close, Escape key, scroll lock, and consistent styling for free.",
          "file_count": 12,
          "files": [
            "apps/name-forge/webui/src/components/modals/ConditionsModal.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/CopyGrammarModal.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/profile/ProfileModal.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/CopyLexemeModal.jsx",
            "apps/illuminator/webui/src/components/RevisionFilterModal.jsx",
            "apps/illuminator/webui/src/components/ImageRefPicker.jsx",
            "apps/illuminator/webui/src/components/ToneAssignmentPreviewModal.jsx",
            "apps/illuminator/webui/src/components/EntityLinkPicker.jsx",
            "apps/illuminator/webui/src/components/HistoryCompressionPreviewModal.jsx",
            "apps/coherence-engine/webui/src/components/generators/GeneratorModal.jsx",
            "apps/coherence-engine/webui/src/components/actions/ActionModal.jsx",
            "apps/coherence-engine/webui/src/components/systems/SystemModal.jsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/RevisionFilterModal.jsx",
          "code_excerpts": [
            {
              "file": "packages/shared-components/src/components/ModalShell.jsx",
              "start_line": 42,
              "end_line": 77,
              "snippet": "// Canonical ModalShell: overlay mouseDown guard, Escape key, scroll lock\nconst handleKeyDown = useCallback((e) => {\n  if (e.key === 'Escape' && !preventOverlayClose) onClose();\n}, [onClose, preventOverlayClose]);\n\nuseEffect(() => {\n  document.addEventListener('keydown', handleKeyDown);\n  return () => document.removeEventListener('keydown', handleKeyDown);\n}, [handleKeyDown]);\n\nuseEffect(() => {\n  const prev = document.body.style.overflow;\n  document.body.style.overflow = 'hidden';\n  return () => { document.body.style.overflow = prev; };\n}, []);\n\nconst handleOverlayMouseDown = (e) => {\n  mouseDownOnOverlay.current = e.target === e.currentTarget;\n};\nconst handleOverlayClick = (e) => {\n  if (!preventOverlayClose && mouseDownOnOverlay.current && e.target === e.currentTarget) onClose();\n};"
            }
          ],
          "implementation_details": "ModalShell provides: overlay mouseDown guard (prevents drag-from-modal close), Escape key listener via useEffect, body scroll lock on mount, preventOverlayClose prop, header with icon/title/close button, optional tabbed sidebar, optional footer."
        },
        {
          "name": "ad-hoc-custom-backdrop",
          "description": "Implements a custom position:fixed overlay with per-component CSS. Some copy the mouseDown guard pattern, some use simple onClick, some have no overlay close at all. None have Escape key or scroll lock.",
          "file_count": 22,
          "files": [
            "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
            "apps/illuminator/webui/src/components/EntityRenameModal.tsx",
            "apps/illuminator/webui/src/components/BackportConfigModal.jsx",
            "apps/illuminator/webui/src/components/BulkHistorianModal.jsx",
            "apps/illuminator/webui/src/components/ImagePickerModal.jsx",
            "apps/illuminator/webui/src/components/BulkBackportModal.jsx",
            "apps/illuminator/webui/src/components/BulkChronicleAnnotationModal.jsx",
            "apps/illuminator/webui/src/components/BulkEraNarrativeModal.jsx",
            "apps/illuminator/webui/src/components/ChronologyModal.jsx",
            "apps/illuminator/webui/src/components/DynamicsGenerationModal.jsx",
            "apps/illuminator/webui/src/components/EraNarrativeModal.jsx",
            "apps/illuminator/webui/src/components/HistorianReviewModal.jsx",
            "apps/illuminator/webui/src/components/InterleavedAnnotationModal.jsx",
            "apps/illuminator/webui/src/components/ImageModal.jsx",
            "apps/illuminator/webui/src/components/QuickCheckModal.jsx",
            "apps/illuminator/webui/src/components/SummaryRevisionModal.jsx",
            "apps/archivist/webui/src/components/RelationshipStoryModal.tsx",
            "apps/canonry/webui/src/components/HelpModal.jsx",
            "apps/lore-weave/webui/src/components/DebugSettingsModal.jsx",
            "apps/coherence-engine/webui/src/components/pressures/modals/FactorEditorModal.jsx",
            "apps/name-forge/webui/src/components/optimizer/ResultsModal.jsx",
            "apps/illuminator/webui/src/components/StyleSelector.jsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
              "start_line": 225,
              "end_line": 236,
              "snippet": "// Ad-hoc backdrop: custom CSS, no Escape key, no scroll lock\n<div className=\"cem-backdrop\">\n  <div className=\"cem-card\">\n    <div className=\"cem-header\">\n      <h2 className=\"cem-title\">{title}</h2>\n    </div>\n    <div className=\"cem-body\">..."
            },
            {
              "file": "apps/illuminator/webui/src/components/CreateEntityModal.css",
              "start_line": 1,
              "end_line": 11,
              "snippet": ".cem-backdrop {\n  position: fixed;\n  inset: 0;\n  z-index: 1000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(0, 0, 0, 0.6);\n}"
            },
            {
              "file": "apps/archivist/webui/src/components/RelationshipStoryModal.tsx",
              "start_line": 17,
              "end_line": 27,
              "snippet": "// Archivist ad-hoc modal: has mouseDown guard, no Escape, no scroll lock\nconst mouseDownOnOverlay = useRef(false);\nconst handleOverlayMouseDown = (e: React.MouseEvent) => {\n  mouseDownOnOverlay.current = e.target === e.currentTarget;\n};\nconst handleOverlayClick = (e: React.MouseEvent) => {\n  if (mouseDownOnOverlay.current && e.target === e.currentTarget) onClose();\n};"
            },
            {
              "file": "apps/archivist/webui/src/components/RelationshipStoryModal.css",
              "start_line": 1,
              "end_line": 12,
              "snippet": ".relationship-story-overlay {\n  position: fixed;\n  inset: 0;\n  background: rgb(0 0 0 / 75%);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: var(--z-modal);\n  padding: var(--spacing-2xl);\n}"
            }
          ],
          "implementation_details": "Each modal reinvents the overlay pattern with its own CSS class names (cem-backdrop, relationship-story-overlay, modal-overlay), its own z-index (1000, var(--z-modal)), its own background opacity (0.6, 0.7, 0.75), and inconsistent close behaviors. Some have mouseDown guard copied from ModalShell, others use simple onClick, and CreateEntityModal has no overlay close at all."
        }
      ],
      "behavior_matrix": {
        "ModalShell (shared)": {
          "overlay_close": "mouseDown guard + currentTarget check",
          "escape_close": "useEffect keydown listener",
          "scroll_lock": "overflow:hidden on body mount",
          "close_button": "btn-close in header",
          "preventable": "preventOverlayClose prop"
        },
        "CreateEntityModal (illuminator)": {
          "overlay_close": false,
          "escape_close": false,
          "scroll_lock": false,
          "close_button": "custom cem-cancel button in footer",
          "preventable": "N/A"
        },
        "RelationshipStoryModal (archivist)": {
          "overlay_close": "mouseDown guard (duplicated pattern)",
          "escape_close": false,
          "scroll_lock": false,
          "close_button": "custom relationship-story-close button",
          "preventable": "N/A"
        },
        "HelpModal (canonry)": {
          "overlay_close": "mouseDown guard (duplicated pattern)",
          "escape_close": false,
          "scroll_lock": false,
          "close_button": "btn-close in header",
          "preventable": "N/A"
        }
      },
      "missing_behavior_complexity": {
        "migration_to_ModalShell": "moderate \u2014 each ad-hoc modal needs its header/body restructured to fit ModalShell's slot pattern; some bulk-operation modals with progress UI may need the preventOverlayClose prop"
      },
      "analysis": "This is genuine drift, not intentional variation. The shared ModalShell already has every behavior (overlay close, Escape, scroll lock, preventOverlayClose for bulk operations) that these ad-hoc modals would need. The illuminator app is the worst offender with 17 of 22 ad-hoc modals \u2014 it appears that earlier modals predated ModalShell and newer ones imported it, creating a mixed state. The archivist modal copies the mouseDown guard logic verbatim but doesn't use ModalShell, which is the classic 'partial adoption' drift pattern. Unifying to ModalShell would eliminate ~22 custom CSS backdrop implementations and bring consistent Escape key + scroll lock behavior to all modals.",
      "recommendation": "Migrate all 22 ad-hoc modals to use ModalShell. For bulk-operation modals that shouldn't close on accidental click, use the existing preventOverlayClose prop. Each migration is straightforward: wrap content in <ModalShell onClose={onClose} title={title}> and delete the custom backdrop CSS.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "shared-components"
    },
    {
      "id": "raw-select-vs-shared-dropdowns",
      "name": "Raw <select> Elements vs Shared Dropdown Components",
      "type": "behavioral",
      "domain": "Shared Component Adoption",
      "description": "The shared library provides SearchableDropdown (popover with search), ReferenceDropdown (native select or searchable mode), and ChipSelect (multi-select with chips). However, 124 raw <select> elements exist across 50+ files in 8 apps. SearchableDropdown has zero direct imports outside shared-components. ReferenceDropdown is used only in coherence-engine (8 files). The vast majority of dropdowns are plain HTML <select> elements with no search, no consistent styling, and no shared behavior.",
      "impact": "LOW",
      "total_files": 50,
      "variants": [
        {
          "name": "shared-reference-dropdown",
          "description": "Uses the shared ReferenceDropdown component, which can render as a native select (simple mode) or searchable popover.",
          "file_count": 8,
          "files": [
            "apps/coherence-engine/webui/src/components/systems/tabs/TagDiffusionTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/GraphContagionTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/ConnectionEvolutionTab.jsx",
            "apps/coherence-engine/webui/src/components/shared/MutationCard.jsx",
            "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityRuleCard.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx",
            "apps/coherence-engine/webui/src/components/generators/filters/SelectionFilterCard.jsx",
            "apps/coherence-engine/webui/src/components/pressures/modals/FactorEditorModal.jsx"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx",
          "code_excerpts": [],
          "implementation_details": "ReferenceDropdown used exclusively in coherence-engine for schema-reference dropdowns (entity kinds, relationship kinds, etc). No other app imports it."
        },
        {
          "name": "raw-html-select-illuminator",
          "description": "Plain HTML <select> elements with 'illuminator-select' CSS class. The illuminator app alone has 72 raw selects across 30 files \u2014 this is the largest concentration.",
          "file_count": 30,
          "files": [
            "apps/illuminator/webui/src/components/EntityBrowser.jsx",
            "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
            "apps/illuminator/webui/src/components/preprint/ExportView.tsx",
            "apps/illuminator/webui/src/components/StyleSelector.jsx",
            "apps/illuminator/webui/src/components/LLMCallConfigPanel.jsx",
            "apps/illuminator/webui/src/components/ChronicleImagePanel.tsx",
            "apps/illuminator/webui/src/components/EventsPanel.jsx",
            "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
            "apps/illuminator/webui/src/components/EnrichmentQueue.jsx",
            "apps/illuminator/webui/src/components/ImagePickerModal.jsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/EntityBrowser.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/EntityBrowser.jsx",
              "start_line": 1320,
              "end_line": 1344,
              "snippet": "// EntityBrowser: 7 raw <select> elements for filtering\n<select\n  value={filters.kind}\n  onChange={(e) => setFilters((prev) => ({ ...prev, kind: e.target.value }))}\n  className=\"illuminator-select\"\n>\n  <option value=\"all\">All Kinds</option>\n  {filterOptions.kinds.map((kind) => (\n    <option key={kind} value={kind}>{kind}</option>\n  ))}\n</select>\n\n<select\n  value={filters.prominence}\n  onChange={(e) => setFilters((prev) => ({ ...prev, prominence: e.target.value }))}\n  className=\"illuminator-select\"\n>\n  <option value=\"all\">All Prominence</option>\n  {PROMINENCE_ORDER.map((p) => (\n    <option key={p} value={p}>{p}</option>\n  ))}\n</select>"
            },
            {
              "file": "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
              "start_line": 244,
              "end_line": 272,
              "snippet": "// CreateEntityModal: 6 raw <select> elements for entity creation\n<select id=\"kind\"\n  value={kind}\n  onChange={(e) => handleKindChange(e.target.value)}\n  className=\"illuminator-select cem-full-width\"\n>\n  {entityKinds.map((k) => (\n    <option key={k.kind} value={k.kind}>\n      {k.description || k.kind}\n    </option>\n  ))}\n</select>"
            }
          ],
          "implementation_details": "All illuminator selects use the same 'illuminator-select' CSS class and the same onChange -> setState pattern. No search capability, no shared styling beyond the CSS class. Lists like entity kinds and cultures could benefit from searchable dropdowns when the domain grows large."
        },
        {
          "name": "raw-html-select-other-apps",
          "description": "Plain HTML <select> elements in other apps using various CSS classes: cosmographer (14 selects in 3 files), name-forge (17 selects in 8 files), canonry (12 selects in 3 files).",
          "file_count": 20,
          "files": [
            "apps/cosmographer/webui/src/components/EntityEditor/index.jsx",
            "apps/cosmographer/webui/src/components/SemanticPlane/index.jsx",
            "apps/cosmographer/webui/src/components/RelationshipEditor/index.jsx",
            "apps/name-forge/webui/src/components/generator/GenerateTab.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/DomainTab.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/LexemesTab.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/GrammarsTab.jsx",
            "apps/canonry/webui/src/components/SchemaEditor/EntityKindEditor.jsx",
            "apps/canonry/webui/src/components/SchemaEditor/TagRegistryEditor.jsx",
            "apps/canonry/webui/src/components/SchemaEditor/RelationshipKindEditor.jsx"
          ],
          "sample_file": "apps/cosmographer/webui/src/components/EntityEditor/index.jsx",
          "code_excerpts": [],
          "implementation_details": "Each app uses its own CSS class for selects (cosmographer: various, name-forge: standard HTML, canonry: shared form styles). None use the shared SearchableDropdown or ReferenceDropdown components."
        }
      ],
      "behavior_matrix": {
        "SearchableDropdown (shared)": {
          "search_filter": "yes \u2014 text input filters items by id/name",
          "popover_dropdown": true,
          "keyboard_nav": false,
          "usage_count": "0 direct imports outside shared-components"
        },
        "ReferenceDropdown (shared)": {
          "search_filter": "optional \u2014 supports simple (native) and searchable mode",
          "popover_dropdown": "optional",
          "keyboard_nav": false,
          "usage_count": "8 files, all in coherence-engine"
        },
        "Raw <select> (illuminator)": {
          "search_filter": false,
          "popover_dropdown": false,
          "keyboard_nav": "native browser behavior",
          "usage_count": "72 instances in 30 files"
        },
        "Raw <select> (all other apps)": {
          "search_filter": false,
          "popover_dropdown": false,
          "keyboard_nav": "native browser behavior",
          "usage_count": "52 instances in 20+ files"
        }
      },
      "missing_behavior_complexity": {
        "migration_to_shared_dropdown": "significant \u2014 124 raw selects is a large volume; many have dependent option lists (e.g., subtypes depend on selected kind), optgroups, or 'All X' sentinel values that SearchableDropdown/ReferenceDropdown don't currently support well"
      },
      "analysis": "This is partially drift and partially a gap in the shared component library's ergonomics. The shared SearchableDropdown has zero adoption despite being exported \u2014 this strongly suggests it doesn't fit the use cases (most selects have fewer than 20 options and don't need search). The shared ReferenceDropdown is adopted in coherence-engine but nowhere else, indicating it solves a coherence-engine-specific problem (schema references). The raw <select> pattern works fine for small option lists and is the browser-native form control \u2014 replacing all 124 instances would be massive effort for marginal UX gain. The real opportunity is not blanket replacement but rather targeted adoption: entity kind/culture dropdowns that could have 50+ options in large worlds would benefit from searchable behavior. This is more 'untapped potential' than 'harmful drift'.",
      "recommendation": "Do not attempt blanket replacement. Instead: (1) For filter bars with many selects (EntityBrowser, EntityCoveragePanel), consider a dedicated FilterBar shared component that standardizes the filter-select pattern. (2) For entity kind/culture selects that may grow large, adopt ReferenceDropdown in searchable mode. (3) Improve SearchableDropdown to support sentinel values ('All X') and dependent options to make adoption more attractive.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "shared-components"
    },
    {
      "id": "multi-select-chip-adoption",
      "name": "ChipSelect vs Ad-Hoc Multi-Select Patterns",
      "type": "behavioral",
      "domain": "Shared Component Adoption",
      "description": "The shared ChipSelect component provides multi-select with searchable dropdown and chip display. However, name-forge has an ad-hoc MultiSelectPills component that reimplements multi-select with a different UI pattern (pill buttons instead of chips). The MultiSelectPills file even contains a TODO comment acknowledging it should use ChipSelect.",
      "impact": "LOW",
      "total_files": 5,
      "variants": [
        {
          "name": "shared-chip-select",
          "description": "Uses the shared ChipSelect component from shared-components for multi-select with chips.",
          "file_count": 4,
          "files": [
            "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityRuleCard.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx",
            "apps/coherence-engine/webui/src/components/generators/filters/SelectionFilterCard.jsx",
            "apps/coherence-engine/webui/src/components/pressures/modals/FactorEditorModal.jsx"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx",
          "code_excerpts": [],
          "implementation_details": "ChipSelect used exclusively in coherence-engine for multi-selecting entity kinds, subtypes, cultures, and tags."
        },
        {
          "name": "ad-hoc-multi-select-pills",
          "description": "Custom MultiSelectPills component in name-forge using pill buttons instead of chips/dropdown. Contains explicit TODO to replace with ChipSelect.",
          "file_count": 3,
          "files": [
            "apps/name-forge/webui/src/components/workspace/tabs/profile/MultiSelectPills.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/profile/StrategyGroupEditor.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/profile/tabs/SingleGroupTab.jsx"
          ],
          "sample_file": "apps/name-forge/webui/src/components/workspace/tabs/profile/MultiSelectPills.jsx",
          "code_excerpts": [
            {
              "file": "apps/name-forge/webui/src/components/workspace/tabs/profile/MultiSelectPills.jsx",
              "start_line": 1,
              "end_line": 49,
              "snippet": "/**\n * Multi-select pills component for selecting multiple options\n * Note: Consider replacing with ChipSelect from shared-components in future\n */\nexport default function MultiSelectPills({ options, selected, onChange, allLabel = \"All\" }) {\n  const isAllSelected = selected.length === 0 || (selected.length === 1 && selected[0] === \"*\");\n  const handleToggle = (value) => {\n    if (value === \"*\") {\n      onChange([]);\n    } else {\n      const newSelected = selected.filter((s) => s !== \"*\");\n      if (newSelected.includes(value)) {\n        const filtered = newSelected.filter((s) => s !== value);\n        onChange(filtered.length === 0 ? [] : filtered);\n      } else {\n        onChange([...newSelected, value]);\n      }\n    }\n  };\n  return (\n    <div className=\"flex flex-wrap gap-xs\">\n      <button type=\"button\" onClick={() => handleToggle(\"*\")}\n        className={`pill-button ${isAllSelected ? \"selected-gold\" : \"\"}`}>\n        {allLabel}\n      </button>\n      {options.map((opt) => {\n        const isSelected = !isAllSelected && selected.includes(opt);\n        return (\n          <button key={opt} type=\"button\" onClick={() => handleToggle(opt)}\n            className={`pill-button ${isSelected ? \"selected-green\" : \"\"}`}>\n            {opt}\n          </button>\n        );\n      })}\n    </div>\n  );\n}"
            }
          ],
          "implementation_details": "MultiSelectPills uses an 'All' wildcard button pattern and toggle pill buttons instead of a dropdown with chips. The UX is different from ChipSelect (always-visible pills vs dropdown selection) which may be intentional for small option sets. The component explicitly flags itself as a ChipSelect replacement candidate."
        }
      ],
      "behavior_matrix": {
        "ChipSelect (shared)": {
          "selection_ui": "searchable dropdown with chip display",
          "all_option": false,
          "always_visible": "only selected chips are visible",
          "search": true
        },
        "MultiSelectPills (name-forge)": {
          "selection_ui": "always-visible pill buttons",
          "all_option": "yes \u2014 '*' wildcard with gold highlight",
          "always_visible": "all options always visible as buttons",
          "search": false
        }
      },
      "missing_behavior_complexity": {
        "replace_with_chip_select": "trivial \u2014 ChipSelect API is compatible; main consideration is whether always-visible pills are a better UX for small option sets (entity kinds, prominence levels)"
      },
      "analysis": "This is acknowledged drift \u2014 the component itself contains a TODO comment ('Consider replacing with ChipSelect from shared-components in future'). The MultiSelectPills component provides a different UX paradigm (always-visible pill buttons) that may actually be superior for very small option sets (5-10 items) where a dropdown adds unnecessary interaction cost. ChipSelect's dropdown pattern is better for larger sets. Rather than a direct replacement, the shared library could benefit from a PillSelect variant or ChipSelect could gain an 'inline' mode that renders all options as toggleable pills when the option count is below a threshold.",
      "recommendation": "Either (a) replace MultiSelectPills with ChipSelect if the dropdown UX is acceptable for name-forge's use case, or (b) add an 'inline' mode to ChipSelect that renders all options as toggleable pills when count is small. The 'All' wildcard pattern should be supported either way.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "shared-components"
    },
    {
      "id": "empty-state-adoption",
      "name": "EmptyState Component Adoption Gap",
      "type": "behavioral",
      "domain": "Shared Component Adoption",
      "description": "The shared EmptyState component provides a consistent icon + title + description pattern. However, only 3 files import it (2 in coherence-engine, 1 in illuminator). Meanwhile, 41 files across 8 apps render ad-hoc empty states using the same CSS class names ('empty-state', 'empty-state-icon', 'empty-state-title', 'empty-state-desc') or app-specific variants \u2014 matching the shared component's HTML structure exactly but without importing it.",
      "impact": "LOW",
      "total_files": 41,
      "variants": [
        {
          "name": "imports-shared-empty-state",
          "description": "Imports and uses the shared EmptyState component from @the-canonry/shared-components.",
          "file_count": 3,
          "files": [
            "apps/coherence-engine/webui/src/components/eras/sections/ConditionsSection.jsx",
            "apps/coherence-engine/webui/src/components/eras/sections/EffectsSection.jsx",
            "apps/illuminator/webui/src/IlluminatorRemote.jsx"
          ],
          "sample_file": "apps/illuminator/webui/src/IlluminatorRemote.jsx",
          "code_excerpts": [],
          "implementation_details": "These files import and use <EmptyState icon='...' title='...' description='...' /> as intended."
        },
        {
          "name": "ad-hoc-matching-structure",
          "description": "Renders the exact same HTML structure as EmptyState (div.empty-state > div.empty-state-icon + div.empty-state-title + div.empty-state-desc) but inline in JSX instead of importing the component.",
          "file_count": 12,
          "files": [
            "apps/coherence-engine/webui/src/components/generators/tabs/VariablesTab.jsx",
            "apps/coherence-engine/webui/src/components/actions/tabs/VariablesTab.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/RelationshipsTab.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx",
            "apps/coherence-engine/webui/src/components/generators/applicability/ApplicabilityTab.jsx",
            "apps/coherence-engine/webui/src/components/generators/filters/SelectionFiltersEditor.jsx",
            "apps/coherence-engine/webui/src/components/pressures/PressuresEditor.jsx",
            "apps/coherence-engine/webui/src/components/dependency-viewer/DependencyViewer.jsx",
            "apps/coherence-engine/webui/src/components/causal-loop/CausalLoopEditor.jsx",
            "apps/cosmographer/webui/src/components/AxisRegistry/index.jsx",
            "apps/cosmographer/webui/src/components/EntityEditor/index.jsx",
            "apps/cosmographer/webui/src/components/CultureEditor/index.jsx"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/generators/tabs/VariablesTab.jsx",
          "code_excerpts": [
            {
              "file": "apps/coherence-engine/webui/src/components/generators/tabs/VariablesTab.jsx",
              "start_line": 193,
              "end_line": 201,
              "snippet": "// Ad-hoc: identical HTML structure to shared EmptyState but inline\n{varEntries.length === 0 && !showAddForm ? (\n  <div className=\"empty-state\">\n    <div className=\"empty-state-icon\">\ud83d\udce6</div>\n    <div className=\"empty-state-title\">No variables defined</div>\n    <div className=\"empty-state-desc\">\n      Add variables to select additional entities for use in creation and relationships.\n    </div>\n  </div>\n) : ("
            },
            {
              "file": "apps/coherence-engine/webui/src/components/generators/tabs/RelationshipsTab.jsx",
              "start_line": 379,
              "end_line": 387,
              "snippet": "// Same ad-hoc pattern with different icon and text\n{relationships.length === 0 && saturationLimits.length === 0 ? (\n  <div className=\"empty-state\">\n    <div className=\"empty-state-icon\">\ud83d\udd17</div>\n    <div className=\"empty-state-title\">No relationships</div>\n    <div className=\"empty-state-desc\">\n      This generator doesn't create any relationships. Add relationships to connect entities.\n    </div>\n  </div>\n) : ("
            }
          ],
          "implementation_details": "These files render the exact same DOM structure as the shared EmptyState component but do so inline. The CSS classes match because they import the shared styles. This is the easiest migration \u2014 a simple import + JSX replacement with no behavior change."
        },
        {
          "name": "ad-hoc-custom-css-class",
          "description": "Custom empty state implementations using app-specific CSS classes and different HTML structures.",
          "file_count": 26,
          "files": [
            "apps/lore-weave/webui/src/components/results/ResultsViewer.jsx",
            "apps/lore-weave/webui/src/components/dashboard/EpochTimeline.jsx",
            "apps/lore-weave/webui/src/components/dashboard/FinalDiagnostics.jsx",
            "apps/lore-weave/webui/src/components/dashboard/PopulationMetrics.jsx",
            "apps/lore-weave/webui/src/components/dashboard/TemplateUsage.jsx",
            "apps/lore-weave/webui/src/components/targets/DistributionTargetsEditor.jsx",
            "apps/lore-weave/webui/src/components/validation/ValidationPanel.jsx",
            "apps/lore-weave/webui/src/components/config/ConfigurationSummary.jsx",
            "apps/illuminator/webui/src/components/ActivityPanel.jsx",
            "apps/illuminator/webui/src/components/ChronicleImagePanel.tsx",
            "apps/illuminator/webui/src/components/ResultsPanel.jsx",
            "apps/illuminator/webui/src/components/PrePrintPanel.tsx",
            "apps/cosmographer/webui/src/components/SemanticPlane/index.jsx",
            "apps/cosmographer/webui/src/components/RelationshipEditor/index.jsx",
            "apps/name-forge/webui/src/NameForgeRemote.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/DomainTab.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/GrammarsTab.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/LexemesTab.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/profile/ProfileTab.jsx",
            "apps/name-forge/webui/src/components/workspace/tabs/profile/tabs/GroupsTab.jsx",
            "apps/canonry/webui/src/components/ProjectManager.jsx",
            "apps/archivist/webui/src/ArchivistRemote.tsx",
            "apps/coherence-engine/webui/src/components/naming-profile-viewer/NamingProfileMappingViewer.jsx",
            "apps/coherence-engine/webui/src/components/actions/tabs/ActorTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/ThresholdTriggerTab.jsx",
            "apps/coherence-engine/webui/src/components/eras/ErasEditor.jsx"
          ],
          "sample_file": "apps/lore-weave/webui/src/components/results/ResultsViewer.jsx",
          "code_excerpts": [
            {
              "file": "apps/lore-weave/webui/src/components/results/ResultsViewer.jsx",
              "start_line": 48,
              "end_line": 63,
              "snippet": "// Lore-weave: custom empty state with app-specific CSS classes and action button\n{!results && (\n  <div className=\"lw-container\">\n    <div className=\"lw-empty-state rv-empty-state\">\n      <div className=\"lw-empty-icon\"></div>\n      <div className=\"lw-empty-title\">No Results Yet</div>\n      <div className=\"lw-empty-text\">\n        Run a simulation to see the generated world history here.\n      </div>\n      <button className=\"lw-btn lw-btn-primary\" onClick={onNewRun}>\n        Go to Run\n      </button>\n    </div>\n  </div>\n)}"
            },
            {
              "file": "apps/cosmographer/webui/src/components/SemanticPlane/index.jsx",
              "start_line": 625,
              "end_line": 629,
              "snippet": "// Cosmographer: minimal warning-style empty state\n{axisDefinitions.length === 0 && (\n  <div className=\"sp-no-axes-warning\">\n    No axes defined. Create axes in the Axis Registry first.\n  </div>\n)}"
            }
          ],
          "implementation_details": "These files use app-specific CSS class prefixes (lw-empty-state, sp-no-axes-warning, etc.) and varying HTML structures. Some include action buttons (ResultsViewer's 'Go to Run'), some are minimal text-only warnings. The shared EmptyState component supports children for action buttons, so most of these could migrate."
        }
      ],
      "behavior_matrix": {
        "EmptyState (shared)": {
          "structure": "div.empty-state > icon + title + desc + children",
          "supports_action_button": "yes, via children prop",
          "usage_count": "3 files"
        },
        "Ad-hoc matching structure": {
          "structure": "same div.empty-state > icon + title + desc (inline JSX)",
          "supports_action_button": "no (would need custom addition)",
          "usage_count": "12 files"
        },
        "Ad-hoc custom CSS": {
          "structure": "various (lw-empty-state, sp-no-axes-warning, etc.)",
          "supports_action_button": "varies",
          "usage_count": "26 files"
        }
      },
      "missing_behavior_complexity": {
        "migrate_matching_structure": "trivial \u2014 import EmptyState and replace inline JSX with <EmptyState icon='...' title='...' description='...' />; no behavior change",
        "migrate_custom_css": "moderate \u2014 need to replace app-specific CSS classes with shared empty-state classes and restructure HTML to match EmptyState's slot pattern; some need className prop for custom styling"
      },
      "analysis": "This is clear drift with a simple root cause: the shared EmptyState component was created after many of these ad-hoc empty states were already written, and adoption never caught up. The 12 files using identical CSS class names (empty-state, empty-state-icon, empty-state-title, empty-state-desc) are the most obvious candidates \u2014 they already use the shared CSS but render the HTML inline instead of importing the component. These migrations are mechanical and risk-free. The 26 files with custom CSS classes are a larger effort but still straightforward since EmptyState supports className for custom styling and children for action buttons.",
      "recommendation": "Phase 1: Migrate the 12 files that already use matching CSS classes \u2014 this is a find-and-replace level change. Phase 2: Migrate the 26 files with custom CSS, starting with coherence-engine (most files) and lore-weave (custom lw-empty-state pattern used consistently).",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "shared-components"
    },
    {
      "id": "enable-toggle-vs-checkbox",
      "name": "EnableToggle vs Raw Checkbox Adoption",
      "type": "behavioral",
      "domain": "Shared Component Adoption",
      "description": "The shared EnableToggle component provides a styled toggle switch with label, keyboard accessibility, and consistent styling. However, 83 raw <input type='checkbox'> elements exist across 7 apps. EnableToggle is only imported in 4 files in coherence-engine. Most checkboxes are wrapped in bare <label> elements with per-app CSS classes.",
      "impact": "LOW",
      "total_files": 30,
      "variants": [
        {
          "name": "shared-enable-toggle",
          "description": "Uses the shared EnableToggle component with styled toggle switch, keyboard support, and label.",
          "file_count": 4,
          "files": [
            "apps/coherence-engine/webui/src/components/generators/cards/GeneratorListCard.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
            "apps/coherence-engine/webui/src/components/systems/cards/SystemListCard.jsx",
            "apps/coherence-engine/webui/src/components/systems/tabs/OverviewTab.jsx"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/generators/tabs/OverviewTab.jsx",
          "code_excerpts": [
            {
              "file": "packages/shared-components/src/components/EnableToggle.jsx",
              "start_line": 16,
              "end_line": 41,
              "snippet": "// Canonical EnableToggle: styled toggle switch with keyboard support\nexport function EnableToggle({ enabled, onChange, onClick, label, className = '' }) {\n  const handleClick = (e) => {\n    if (onClick) onClick(e);\n    else if (onChange) onChange(!enabled);\n  };\n  return (\n    <div className={`flex items-center gap-lg ${className}`.trim()}>\n      <div onClick={handleClick}\n        className={`toggle ${enabled ? 'toggle-on' : ''}`}\n        role=\"button\" tabIndex={0}\n        onKeyDown={(e) => { if (e.key === 'Enter' || e.key === ' ') handleClick(e); }}>\n        <div className=\"toggle-knob\" />\n      </div>\n      {label && <span className=\"text-md text-muted\">{label}</span>}\n    </div>\n  );\n}"
            }
          ],
          "implementation_details": "EnableToggle renders a visual toggle switch (not a native checkbox). Used for enable/disable toggles on generators and systems in coherence-engine."
        },
        {
          "name": "raw-checkbox-label-pattern",
          "description": "Raw <input type='checkbox'> wrapped in <label> with app-specific CSS classes. Most common in illuminator (39 instances) and coherence-engine (21 instances).",
          "file_count": 26,
          "files": [
            "apps/illuminator/webui/src/components/EntityCoveragePanel.jsx",
            "apps/illuminator/webui/src/components/EntityBrowser.jsx",
            "apps/illuminator/webui/src/components/BackportConfigModal.jsx",
            "apps/coherence-engine/webui/src/components/weight-matrix/WeightMatrixEditor.jsx",
            "apps/archivist/webui/src/components/FilterPanel.tsx",
            "apps/chronicler/webui/src/components/EntityTimeline.tsx",
            "apps/canonry/webui/src/App.jsx",
            "apps/name-forge/webui/src/components/generator/GenerateTab.jsx",
            "apps/lore-weave/webui/src/components/runner/ParameterForm.jsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/EntityCoveragePanel.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/EntityCoveragePanel.jsx",
              "start_line": 797,
              "end_line": 801,
              "snippet": "// Ad-hoc checkbox: bare input in label with app-specific CSS\n<label className=\"ecp-checkbox-label\">\n  <input type=\"checkbox\" checked={descOnly} onChange={e => setDescOnly(e.target.checked)} />\n  Has description\n</label>"
            },
            {
              "file": "apps/illuminator/webui/src/components/EntityBrowser.jsx",
              "start_line": 1385,
              "end_line": 1392,
              "snippet": "// Another ad-hoc checkbox in a filter bar\n<label className=\"eb-hide-completed-label\">\n  <input\n    type=\"checkbox\"\n    checked={hideCompleted}\n    onChange={(e) => setHideCompleted(e.target.checked)}\n  />\n  Hide completed\n</label>"
            }
          ],
          "implementation_details": "Raw checkboxes use the browser's native checkbox appearance and are styled per-app (ecp-checkbox-label, eb-hide-completed-label, filter-checkbox-label, etc.). They serve as boolean filters in toolbars, which is a different UX role from EnableToggle's enable/disable toggle switch."
        }
      ],
      "behavior_matrix": {
        "EnableToggle (shared)": {
          "visual_style": "custom toggle switch (knob slides)",
          "keyboard_support": "Enter and Space via onKeyDown",
          "label": "optional label prop",
          "semantic_role": "enable/disable toggle",
          "usage": "4 files in coherence-engine"
        },
        "Raw checkbox (ad-hoc)": {
          "visual_style": "native browser checkbox",
          "keyboard_support": "native (Space to toggle)",
          "label": "<label> wrapper with per-app CSS class",
          "semantic_role": "filter checkbox in toolbar",
          "usage": "83 instances across 7 apps"
        }
      },
      "missing_behavior_complexity": {
        "replace_all_with_toggle": "significant and possibly wrong \u2014 many checkboxes serve as filter options in toolbars where native checkbox appearance is conventional; replacing all with toggle switches would change the visual language. Only enable/disable semantics benefit from the toggle pattern."
      },
      "analysis": "This is partially intentional variation rather than pure drift. The EnableToggle component renders a toggle switch (sliding knob) designed for 'enable/disable' semantics \u2014 turning a generator on/off, enabling a system. The raw checkboxes mostly serve as filter options in toolbars ('Hide completed', 'Has description', 'Show prominence-only events') where the native checkbox is the conventional UI pattern. Replacing filter checkboxes with toggle switches would be a UX regression. The real gap is that there's no shared FilterCheckbox component to standardize the label + checkbox + styling pattern used in filter bars across apps. Each app reinvents the label-wrapping and CSS classes independently.",
      "recommendation": "Do not replace filter checkboxes with EnableToggle \u2014 these serve different semantic purposes. Instead, consider creating a shared FilterCheckbox component that standardizes the label-wrapper pattern used in filter bars. EnableToggle should continue to be used for enable/disable toggles, and its adoption in other apps (illuminator, name-forge) for generator/system enable controls should be encouraged.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "shared-components"
    },
    {
      "id": "typescript-javascript-migration-state",
      "name": "TypeScript/JavaScript Migration State",
      "type": "structural",
      "description": "The monorepo has 824 source files split roughly 50/50 between TypeScript (424 .ts/.tsx) and JavaScript (392 .js/.jsx), but the distribution is wildly inconsistent across apps. Some apps are fully TypeScript, some fully JavaScript, some have clean separation by directory, and one (illuminator) has .ts and .js files interleaved in the same directories. The shared-components package \u2014 consumed by every MFE \u2014 is 100% JavaScript with PropTypes instead of TypeScript interfaces.",
      "impact": "HIGH",
      "total_files": 824,
      "variants": [
        {
          "name": "fully-typescript",
          "description": "Apps written entirely or nearly entirely in TypeScript/TSX. All components use TypeScript interfaces for props, import type {} syntax for type-only imports, and have tsconfig.json with project references. archivist has 21 .ts/.tsx files and 1 .js file; chronicler has 23 .ts/.tsx and 1 .js file; world-schema has 20 .ts and 0 .js.",
          "file_count": 65,
          "files": [
            "apps/archivist/webui/src/ArchivistRemote.tsx",
            "apps/archivist/webui/src/components/EntityDetail.tsx",
            "apps/archivist/webui/src/types/world.ts",
            "apps/chronicler/webui/src/ChroniclerRemote.tsx",
            "apps/chronicler/webui/src/components/WikiExplorer.tsx",
            "apps/chronicler/webui/src/hooks/useWorldDataLoader.ts",
            "packages/world-schema/src/index.ts"
          ],
          "sample_file": "apps/archivist/webui/src/components/EntityDetail.tsx",
          "code_excerpts": [
            {
              "file": "apps/archivist/webui/src/components/EntityDetail.tsx",
              "start_line": 1,
              "end_line": 24,
              "snippet": "import React, { useState, useCallback } from \"react\";\nimport type {\n  WorldState,\n  LoreData,\n  DescriptionLore,\n  RelationshipBackstoryLore,\n  ChainLinkLore,\n  DiscoveryEventLore,\n  Region,\n} from \"../types/world.ts\";\nimport {\n  getEntityById,\n  getRelatedEntities,\n  getRelationships,\n  getTagsArray,\n} from \"../utils/dataTransform.ts\";\nimport { useImageUrl } from \"@the-canonry/image-store\";\nimport LoreSection from \"./LoreSection.tsx\";\nimport RelationshipStoryModal from \"./RelationshipStoryModal.tsx\";\nimport ChainLinkSection from \"./ChainLinkSection.tsx\";\nimport DiscoveryStory from \"./DiscoveryStory.tsx\";\nimport \"./EntityDetail.css\";\n\ninterface EntityDetailProps {"
            }
          ],
          "implementation_details": "These apps have full tsconfig.json with project references (tsconfig.app.json + tsconfig.node.json), use explicit .tsx/.ts file extensions in local imports, define TypeScript interfaces for all component props, and use 'import type {}' for type-only imports. They represent the target state of the migration. archivist and chronicler are the newest apps in the monorepo and were built with TypeScript from the start."
        },
        {
          "name": "library-typescript-webui-javascript",
          "description": "Apps with a clean directory-level split: the core library (lib/) is written in strict TypeScript, while the web UI (webui/) is written entirely in JavaScript/JSX. lore-weave has 87 .ts in lib/ and 28 .jsx in webui/; name-forge has 36 .ts in lib/ and 28 .jsx in webui/; cosmographer has 16 .ts in lib/ and 8 .jsx in webui/. One exception: lore-weave has a single .ts hook (useSimulationWorker.ts) that bridges the worker/UI type boundary.",
          "file_count": 203,
          "files": [
            "apps/lore-weave/lib/engine/worldEngine.ts",
            "apps/lore-weave/lib/engine/templateInterpreter.ts",
            "apps/lore-weave/webui/src/LoreWeaveRemote.jsx",
            "apps/lore-weave/webui/src/hooks/useSimulationWorker.ts",
            "apps/name-forge/lib/generate.ts",
            "apps/name-forge/webui/src/lib/browser-generator.js",
            "apps/cosmographer/lib/generator/index.ts",
            "apps/cosmographer/webui/src/CosmographerRemote.jsx"
          ],
          "sample_file": "apps/name-forge/webui/src/lib/browser-generator.js",
          "code_excerpts": [
            {
              "file": "apps/name-forge/webui/src/lib/browser-generator.js",
              "start_line": 1,
              "end_line": 15,
              "snippet": "/**\n * Browser-compatible name generator\n *\n * Thin wrapper around the name-forge lib.\n */\n\nimport { generate, generateFromDomain, previewGrammar } from '@lib/generate.js';\nimport { setMarkovBaseUrl } from '@lib/markov-loader.js';\n\n// Configure base URL for Markov models in browser\nsetMarkovBaseUrl(`${import.meta.env.BASE_URL}markov-models`);\n\nfunction toNameForgeCulture(culture) {\n  if (!culture) return null;\n  const naming = culture.naming || {};"
            }
          ],
          "implementation_details": "The TypeScript library code uses strict mode ('strict': true in tsconfig.json) with full type annotations, while the JavaScript UI code has no type annotations, no JSDoc @ts-check directives, and no tsconfig.json for the webui directory (name-forge, cosmographer). lore-weave's webui/ does have a tsconfig with 'allowJs: true' but the JS files contain zero type annotations. This split is semi-intentional \u2014 the library is the 'important' code \u2014 but means UI bugs from type errors go undetected."
        },
        {
          "name": "mixed-typescript-javascript-same-directories",
          "description": "Illuminator is the most complex app (272 files) and has .ts and .js files interleaved in the same directories. The hooks/ directory alone contains 13 .js hooks and 19 .ts hooks side by side. Components/ has 37 .tsx files mixed with 67 .jsx files. The tsconfig uses 'strict: false' and 'allowJs: true' to permit this coexistence. The .ts files use full type imports and interface definitions; the .js files have zero type annotations.",
          "file_count": 272,
          "files": [
            "apps/illuminator/webui/src/hooks/useApiKeys.js",
            "apps/illuminator/webui/src/hooks/useBackportFlow.js",
            "apps/illuminator/webui/src/hooks/useHistorianCallbacks.js",
            "apps/illuminator/webui/src/hooks/useConfigSync.js",
            "apps/illuminator/webui/src/hooks/useBulkBackport.ts",
            "apps/illuminator/webui/src/hooks/useChronicleActions.ts",
            "apps/illuminator/webui/src/hooks/useEraNarrative.ts",
            "apps/illuminator/webui/src/hooks/useEntityCrud.ts",
            "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
            "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
            "apps/illuminator/webui/src/lib/db/entityStore.ts",
            "apps/illuminator/webui/src/lib/db/chronicleStore.ts"
          ],
          "sample_file": "apps/illuminator/webui/src/hooks/useApiKeys.js",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/hooks/useApiKeys.js",
              "start_line": 1,
              "end_line": 12,
              "snippet": "import { useState, useEffect } from \"react\";\n\nfunction readPersistedFlag(key) {\n  try {\n    return localStorage.getItem(key) === \"true\";\n  } catch {\n    return false;\n  }\n}\n\nfunction readPersistedApiKey(keyName) {\n  try {"
            },
            {
              "file": "apps/illuminator/webui/src/hooks/useChronicleActions.ts",
              "start_line": 9,
              "end_line": 25,
              "snippet": "import { useCallback } from \"react\";\nimport type { ChronicleGenerationContext, ChronicleSampling } from \"../lib/chronicleTypes\";\nimport type { EnrichmentType, ChronicleStep } from \"../lib/enrichmentTypes\";\nimport { getEnqueue } from \"../lib/db/enrichmentQueueBridge\";\nimport { useChronicleStore } from \"../lib/db/chronicleStore\";\nimport type { ChronicleRecord } from \"../lib/db/chronicleRepository\";\n\nexport interface ChronicleMetadata {\n  chronicleId: string;\n  title?: string;\n  format: \"story\" | \"document\";\n  generationSampling: ChronicleSampling;\n  roleAssignments: Array<{\n    role: string;\n    entityId: string;\n    entityName: string;\n    entityKind: string;"
            }
          ],
          "implementation_details": "The illuminator app has 153 .ts files and 82 .js files in its webui directory. The lib/db/ subdirectory is fully TypeScript (Dexie stores, type definitions), while the hooks/ directory is 40% JS and 60% TS. The .js hooks were written alongside .ts hooks \u2014 both patterns coexist without any migration deadline. tsconfig.app.json has 'strict: false' and 'allowJs: true', meaning TypeScript provides essentially no safety guarantees in this app. New code is being added in both extensions."
        },
        {
          "name": "fully-javascript-no-tsconfig",
          "description": "canonry (47 files) and coherence-engine (115 files) are 100% JavaScript with no tsconfig.json, no JSDoc type annotations, and no plans for TypeScript migration. Both are significant apps with complex component trees.",
          "file_count": 162,
          "files": [
            "apps/canonry/webui/src/App.jsx",
            "apps/canonry/webui/src/stores/useCanonryUiStore.js",
            "apps/canonry/webui/src/storage/worldStore.js",
            "apps/coherence-engine/webui/src/CoherenceEngineRemote.jsx",
            "apps/coherence-engine/webui/src/components/ActionsEditor.jsx",
            "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/ActionsEditor.jsx",
          "code_excerpts": [
            {
              "file": "apps/coherence-engine/webui/src/components/ActionsEditor.jsx",
              "start_line": 1,
              "end_line": 5,
              "snippet": "/**\n * ActionsEditor - Re-exports from modular actions/ folder\n */\n\nexport { default } from \"./actions\";"
            }
          ],
          "implementation_details": "canonry is the shell/host MFE that orchestrates all other apps. coherence-engine is the validation and configuration editor \u2014 the second-largest webui by file count (115 files). Neither has any TypeScript tooling configured. These apps use PropTypes for runtime type checking where it's used at all. Given that coherence-engine directly manipulates schema.json configuration consumed by typed TypeScript libraries (lore-weave, name-forge), the lack of compile-time type safety creates a gap where invalid configuration can be authored without detection."
        },
        {
          "name": "shared-components-javascript-with-proptypes",
          "description": "The shared-components package (37 files) is 100% JavaScript using PropTypes for runtime type validation. This package is consumed by every MFE app via @the-canonry/shared-components. It provides foundational UI components (ModalShell, FormGroup, TagSelector, etc.) without TypeScript declarations, forcing consuming TypeScript apps to use it without type safety.",
          "file_count": 37,
          "files": [
            "packages/shared-components/src/index.js",
            "packages/shared-components/src/TagSelector.jsx",
            "packages/shared-components/src/components/ModalShell.jsx",
            "packages/shared-components/src/components/FormGroup.jsx",
            "packages/shared-components/src/components/EmptyState.jsx"
          ],
          "sample_file": "packages/shared-components/src/index.js",
          "code_excerpts": [
            {
              "file": "packages/shared-components/src/index.js",
              "start_line": 1,
              "end_line": 15,
              "snippet": "/**\n * Shared Components for Canonry MFEs\n *\n * Re-exports UI components, form components, hooks, and utilities\n * that can be shared across all micro-frontends.\n *\n * CSS styles are available via: import '@the-canonry/shared-components/styles'\n */\n\n// Canonry-specific components\nexport { default as TagSelector } from './TagSelector.jsx';\n\n// Badge components\nexport { ToolUsageBadges } from './components/badges';\nexport { DetailUsageBadges } from './components/badges';"
            }
          ],
          "implementation_details": "shared-components is the cross-cutting dependency consumed by archivist, chronicler, illuminator, coherence-engine, and canonry. It uses PropTypes (import PropTypes from 'prop-types') instead of TypeScript interfaces. There are no .d.ts declaration files. TypeScript-consuming apps (archivist, chronicler) must rely on Vite's implicit 'any' for these imports. This is the highest-impact gap because it's the shared foundation layer \u2014 migrating it to TypeScript would immediately benefit all consuming apps."
        }
      ],
      "analysis": "The monorepo exhibits five distinct TypeScript adoption states across nine apps, with no single migration trajectory. The divergence appears evolutionary rather than intentional: the oldest apps (canonry, coherence-engine) were written in JavaScript before TypeScript was adopted; library-focused apps (lore-weave, name-forge) typed their core code but left UIs untyped; the newest apps (archivist, chronicler) were built in TypeScript from the start; and illuminator is mid-migration with both extensions coexisting in the same directories under 'strict: false'. The critical structural issue is that shared-components \u2014 the universal dependency \u2014 remains in JavaScript with PropTypes, creating a type safety gap at the foundation layer. Convergence would mean: (1) migrating shared-components to TypeScript first, (2) adding tsconfig.json to canonry and coherence-engine, (3) enabling 'strict: true' in illuminator and converting remaining .js files, (4) adding tsconfig to webui dirs in lore-weave/name-forge/cosmographer.",
      "recommendation": "Start with shared-components: convert its 37 files to .tsx with TypeScript interfaces replacing PropTypes. This immediately benefits all consuming TS apps. Then add tsconfig.json (with allowJs: true, strict: false as a first step) to canonry and coherence-engine. For illuminator, enforce a rule that new files must be .ts/.tsx and incrementally convert the 13 remaining .js hooks.",
      "evidence_quality": "high",
      "status": "completed",
      "source_domain": "structural"
    },
    {
      "id": "component-organization-pattern",
      "name": "Component Directory Organization",
      "type": "structural",
      "description": "MFE apps use three fundamentally different patterns for organizing component files within webui/src/components/: flat single-file components, deeply nested feature directories with barrel index exports, and a hybrid approach. This affects import ergonomics, code discoverability, and the mechanics of adding new components.",
      "impact": "MEDIUM",
      "total_files": 500,
      "variants": [
        {
          "name": "flat-single-file-components",
          "description": "All component files live at the top level of components/ with no subdirectories. Each component is a single PascalCase file with a co-located .css file. archivist has 30 top-level files and 0 subdirectories; canonry has 14 files and 1 subdirectory (SchemaEditor); chronicler has 20 files and 0 subdirectories.",
          "file_count": 64,
          "files": [
            "apps/archivist/webui/src/components/EntityDetail.tsx",
            "apps/archivist/webui/src/components/GraphView.tsx",
            "apps/archivist/webui/src/components/FilterPanel.tsx",
            "apps/chronicler/webui/src/components/WikiExplorer.tsx",
            "apps/chronicler/webui/src/components/WikiPage.tsx",
            "apps/canonry/webui/src/components/HelpModal.jsx"
          ],
          "sample_file": "apps/archivist/webui/src/components/EntityDetail.tsx",
          "code_excerpts": [
            {
              "file": "apps/archivist/webui/src/components/EntityDetail.tsx",
              "start_line": 1,
              "end_line": 10,
              "snippet": "import React, { useState, useCallback } from \"react\";\nimport type {\n  WorldState,\n  LoreData,\n  DescriptionLore,\n  RelationshipBackstoryLore,\n  ChainLinkLore,\n  DiscoveryEventLore,\n  Region,\n} from \"../types/world.ts\";"
            }
          ],
          "implementation_details": "Components are single PascalCase-named files (EntityDetail.tsx, GraphView.tsx) with co-located PascalCase.css files. No barrel index.js files. No subdirectory grouping. Components import each other via relative paths (import LoreSection from './LoreSection.tsx'). This pattern is simple and discoverable but becomes unwieldy as component count grows \u2014 archivist has 30 files in a single flat directory."
        },
        {
          "name": "deeply-nested-feature-directories-with-barrel-exports",
          "description": "Components are organized into feature directories (actions/, generators/, eras/, pressures/, systems/, validation/) each with subdirectories (cards/, tabs/, modals/, shared/) and barrel index.js re-exports at every level. coherence-engine has 11 top-level subdirectories, 28 nested directories total, and 28 barrel index.js files. name-forge uses a similar pattern with 7 top-level feature directories.",
          "file_count": 200,
          "files": [
            "apps/coherence-engine/webui/src/components/actions/index.js",
            "apps/coherence-engine/webui/src/components/actions/cards/index.js",
            "apps/coherence-engine/webui/src/components/actions/modals/index.js",
            "apps/coherence-engine/webui/src/components/generators/index.js",
            "apps/coherence-engine/webui/src/components/generators/tabs/index.js",
            "apps/name-forge/webui/src/components/generator/index.js",
            "apps/name-forge/webui/src/components/workspace/index.js",
            "apps/lore-weave/webui/src/components/dashboard/index.js"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/actions/index.js",
          "code_excerpts": [
            {
              "file": "apps/coherence-engine/webui/src/components/actions/index.js",
              "start_line": 1,
              "end_line": 8,
              "snippet": "/**\n * ActionsEditor module\n *\n * Main entry point - only exports the main component.\n * Internal modules (cards, modals, shared, tabs) are used internally.\n */\n\nexport { default, ActionsEditor } from \"./ActionsEditor\";"
            }
          ],
          "implementation_details": "Each feature has a hierarchical structure: feature/index.js (barrel re-export) \u2192 feature/FeatureEditor.jsx (main component) \u2192 feature/cards/ (card sub-components), feature/tabs/ (tab sub-components), feature/modals/ (modal sub-components). Every directory has an index.js barrel. Consumers import via the feature barrel: import { ActionsEditor } from './components/actions'. This pattern provides excellent encapsulation but requires maintaining 28+ barrel files. Only coherence-engine fully commits to this pattern; lore-weave and name-forge use it partially."
        },
        {
          "name": "flat-with-massive-file-count",
          "description": "illuminator has 128 top-level component files and only 3 subdirectories (ChronicleWizard/, plus 2 others). This is the flat pattern pushed to its limit \u2014 a single directory with 128 files, each a component plus its CSS file.",
          "file_count": 128,
          "files": [
            "apps/illuminator/webui/src/components/ActivityPanel.jsx",
            "apps/illuminator/webui/src/components/BackportConfigModal.jsx",
            "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
            "apps/illuminator/webui/src/components/EntityBrowser.jsx",
            "apps/illuminator/webui/src/components/EntityDetailView.jsx",
            "apps/illuminator/webui/src/components/CreateEntityModal.tsx",
            "apps/illuminator/webui/src/components/CorpusFindReplace.tsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
              "start_line": 1,
              "end_line": 8,
              "snippet": "/**\n * ChroniclePanel - Chronicle navigation, generation controls, and detail view.\n *\n * A single-panel layout that shows a filterable sidebar of chronicles\n * (organized by era) alongside a detail area for the selected chronicle.\n * Generation, deletion, backport, and image-generation controls are\n * integrated directly into the detail view.\n */"
            }
          ],
          "implementation_details": "This is the flat pattern from archivist/chronicler but at 128 files \u2014 making the components/ directory extremely dense. The ChroniclePanel.jsx alone is 2621 lines. Files are sorted alphabetically by OS but there is no logical grouping. Finding related components (e.g., all chronicle-related components) requires knowing their naming prefix (Chronicle*, BulkChronicle*, etc.) rather than navigating a directory tree. This suggests the app outgrew the flat pattern without being restructured."
        },
        {
          "name": "directory-per-component-with-barrel",
          "description": "cosmographer wraps each component in its own PascalCase directory with an index.jsx barrel. Components are imported via the directory name rather than the file name. 5 top-level directories, 0 top-level files.",
          "file_count": 15,
          "files": [
            "apps/cosmographer/webui/src/components/AxisRegistry/index.jsx",
            "apps/cosmographer/webui/src/components/CultureEditor/index.jsx",
            "apps/cosmographer/webui/src/components/EntityEditor/index.jsx",
            "apps/cosmographer/webui/src/components/RelationshipEditor/index.jsx",
            "apps/cosmographer/webui/src/components/SemanticPlane/index.jsx"
          ],
          "sample_file": "apps/cosmographer/webui/src/components/AxisRegistry/index.jsx",
          "code_excerpts": [
            {
              "file": "apps/cosmographer/webui/src/components/AxisRegistry/index.jsx",
              "start_line": 1,
              "end_line": 1,
              "snippet": "// (barrel export from AxisRegistry directory)"
            }
          ],
          "implementation_details": "Each top-level component gets its own PascalCase directory (AxisRegistry/, CultureEditor/, etc.) with an index.jsx barrel export. Sub-components and CSS live inside the directory. This is the 'one directory per component' pattern common in larger React apps. Only cosmographer uses this pattern in the monorepo."
        }
      ],
      "analysis": "The component organization divergence correlates roughly with app size and age. Smaller/newer apps (archivist: 30 files, chronicler: 20 files) use a flat pattern that works well at their scale. coherence-engine (115 files) uses deep nesting with barrels, which provides good encapsulation but requires maintaining many index.js files. illuminator (128+ top-level files) has outgrown its flat structure \u2014 128 files in a single directory is hard to navigate. cosmographer uses directory-per-component, which is standard in the React ecosystem but unique in this monorepo. The lack of a consistent convention means developers switching between apps must learn different component location patterns each time.",
      "recommendation": "Adopt a two-tier convention: flat for apps with <30 components (archivist, canonry, chronicler, cosmographer), feature-directory with barrel exports for larger apps (coherence-engine, illuminator, name-forge, lore-weave). The immediate win is restructuring illuminator's 128-file flat directory into feature groups (chronicle/, entity/, historian/, backport/, etc.).",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "structural"
    },
    {
      "id": "css-architecture-and-scoping",
      "name": "CSS Architecture and Scoping Strategy",
      "type": "structural",
      "description": "Three fundamentally different CSS architectures coexist across the MFEs: standard co-located CSS with manual prefix namespacing (7 apps), CSS Modules with automatic scoping (1 app), and a centralized design system directory with reusable component styles (1 app). Class naming conventions also diverge \u2014 some use full component names (.entity-detail-header), others use 2-3 letter abbreviations (.edv-meta-row, .chron-card), and CSS Modules use generic semantic names (.container, .heading).",
      "impact": "MEDIUM",
      "total_files": 215,
      "variants": [
        {
          "name": "co-located-css-with-manual-prefix-namespacing",
          "description": "Each component has a co-located PascalCase.css file imported directly. Class names are manually namespaced using a component-specific prefix to avoid global collisions. illuminator uses 2-4 letter abbreviations (.chron-*, .edv-*, .abm-*); archivist uses full names (.entity-detail-*) or short abbreviations (.ed-*). 7 apps (archivist, canonry, cosmographer, illuminator, lore-weave, name-forge, viewer) use this pattern.",
          "file_count": 158,
          "files": [
            "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
            "apps/illuminator/webui/src/components/EntityDetailView.jsx",
            "apps/archivist/webui/src/components/EntityDetail.css",
            "apps/canonry/webui/src/components/HelpModal.css",
            "apps/lore-weave/webui/src/components/dashboard/trace/SimulationTraceVisx.jsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/ChroniclePanel.jsx",
              "start_line": 1,
              "end_line": 5,
              "snippet": "/* CSS classes use .chron-* prefix for namespace isolation */\n.chron-card { ... }\n.chron-card-default { ... }\n.chron-card-selected { ... }\n.chron-card-title-row { ... }"
            },
            {
              "file": "apps/archivist/webui/src/components/EntityDetail.css",
              "start_line": 1,
              "end_line": 5,
              "snippet": "/* Full component name prefix */\n.entity-detail { ... }\n.entity-detail-header { ... }\n.entity-detail-name { ... }\n/* But also abbreviated: */ .ed-culture-badge { ... }"
            }
          ],
          "implementation_details": "The most common pattern (7 of 9 apps). Each component imports its CSS directly: import './ChroniclePanel.css'. Classes use a component-derived prefix to avoid global namespace collisions. The prefix convention is inconsistent: illuminator abbreviates heavily (.chron- for ChroniclePanel, .edv- for EntityDetailView, .abm- for ActivityBrowserModal), while archivist mixes full names (.entity-detail-) with abbreviations (.ed-). Some files even mix both conventions internally. This pattern provides zero compile-time scoping guarantees \u2014 a typo in a class name silently fails."
        },
        {
          "name": "css-modules-scoped",
          "description": "chronicler uses CSS Modules (.module.css files) that provide automatic compile-time class name scoping. CSS classes use short semantic names (.container, .heading, .controls) because the module loader adds unique suffixes. A shared variables.css file in styles/ provides design tokens.",
          "file_count": 12,
          "files": [
            "apps/chronicler/webui/src/components/ChronicleIndex.module.css",
            "apps/chronicler/webui/src/components/WikiExplorer.module.css",
            "apps/chronicler/webui/src/components/WikiNav.module.css",
            "apps/chronicler/webui/src/components/EntityTimeline.module.css",
            "apps/chronicler/webui/src/styles/variables.css"
          ],
          "sample_file": "apps/chronicler/webui/src/components/ChronicleIndex.module.css",
          "code_excerpts": [
            {
              "file": "apps/chronicler/webui/src/components/ChronicleIndex.module.css",
              "start_line": 1,
              "end_line": 6,
              "snippet": "/* CSS Modules \u2014 short semantic names, scoped automatically */\n.container { ... }\n.heading { ... }\n.description { ... }\n.description-row { ... }\n.controls { ... }"
            }
          ],
          "implementation_details": "chronicler is the only app using CSS Modules. Components import styles as an object: import styles from './ChronicleIndex.module.css', then reference classes as styles.container, styles.heading etc. Vite compiles these to unique class names at build time, eliminating namespace collision risk entirely. The styles/variables.css file provides shared CSS custom properties (--color-bg-primary, --color-accent, etc.) imported globally. This is the most modern CSS architecture in the monorepo but is isolated to one app."
        },
        {
          "name": "centralized-design-system-directory",
          "description": "coherence-engine has a styles/ directory containing 17 CSS files organized as a mini design system: theme.css (tokens), base.css (reset), utilities.css (helpers), and 14 reusable component style files (button.css, form.css, badge.css, modal.css, card.css, etc.). These shared styles are imported via a single entry point (styles/index.css) while component-specific CSS still lives co-located with components.",
          "file_count": 45,
          "files": [
            "apps/coherence-engine/webui/src/styles/index.css",
            "apps/coherence-engine/webui/src/styles/theme.css",
            "apps/coherence-engine/webui/src/styles/base.css",
            "apps/coherence-engine/webui/src/styles/utilities.css",
            "apps/coherence-engine/webui/src/styles/components/button.css",
            "apps/coherence-engine/webui/src/styles/components/form.css",
            "apps/coherence-engine/webui/src/styles/components/badge.css",
            "apps/coherence-engine/webui/src/styles/components/modal.css",
            "apps/coherence-engine/webui/src/components/generators/tabs/CreationTab.jsx"
          ],
          "sample_file": "apps/coherence-engine/webui/src/styles/components/button.css",
          "code_excerpts": [
            {
              "file": "apps/coherence-engine/webui/src/styles/components/button.css",
              "start_line": 1,
              "end_line": 10,
              "snippet": "/* Reusable button styles \u2014 used across all coherence-engine components */\n.btn { /* base */ }\n.btn-primary { ... }\n.btn-secondary { ... }\n.btn-danger { ... }\n.btn-icon { ... }\n.btn-add { ... }\n.btn-close { ... }\n.btn-tab { ... }\n.btn-tab-active { ... }"
            }
          ],
          "implementation_details": "coherence-engine's styles/ directory is a locally-scoped design system with 14 reusable component style files (button, form, badge, modal, card, section, toggle, dropdown, etc.). The entry point styles/index.css imports all shared styles. Individual components import their own CSS on top. This provides a consistent visual language within coherence-engine but the styles are NOT shared with other apps. Other apps (illuminator, archivist) independently reinvent .btn, .badge, .form-group equivalents in their component CSS files. This is the root of cross-app visual inconsistency."
        }
      ],
      "analysis": "The CSS architecture drift creates two problems: (1) within-app scoping risk (co-located CSS has no compile-time scoping, relying on manual prefix conventions that are applied inconsistently), and (2) cross-app visual inconsistency (each app independently defines button, badge, form, and modal styles with no shared design tokens). coherence-engine's centralized design system is the most mature approach but is siloed. chronicler's CSS Modules are the most technically sound for scoping but are also isolated. The shared-components package provides some cross-app components (ModalShell, FormGroup, EmptyState) but their CSS is in yet another format (co-located .css in packages/shared-components/src/styles/). Convergence would require choosing: CSS Modules everywhere (safest, most modern), or extending the shared-components design system to cover all apps.",
      "recommendation": "The pragmatic convergence path: (1) Extract coherence-engine's styles/theme.css and base.css into shared-components as the shared design token layer. (2) Adopt CSS Modules as the canonical scoping strategy for new components (chronicler's pattern). (3) Add a stylelint rule enforcing .module.css for new files. Migrating existing co-located CSS is low-priority since the manual prefix convention works adequately for existing code.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "structural"
    },
    {
      "id": "vite-path-alias-configuration",
      "name": "Vite Path Alias Configuration Patterns",
      "type": "structural",
      "description": "Apps use four different Vite resolve.alias patterns to reference shared code: @lib pointing to ../lib (3 apps), @the-canonry/* pointing to package source (2 apps), @name-forge pointing to another app's source (1 app), @chronicler pointing to another app's source (1 app), and no aliases at all (3 apps). This creates inconsistent import ergonomics and hidden cross-app coupling.",
      "impact": "MEDIUM",
      "total_files": 9,
      "variants": [
        {
          "name": "lib-alias-to-sibling-directory",
          "description": "lore-weave, name-forge, and illuminator configure @lib as an alias to their sibling ../lib directory. This lets webui code import from the core library using @lib/module instead of relative paths like ../../lib/module.",
          "file_count": 3,
          "files": [
            "apps/lore-weave/webui/vite.config.js",
            "apps/name-forge/webui/vite.config.js",
            "apps/illuminator/webui/vite.config.js"
          ],
          "sample_file": "apps/name-forge/webui/vite.config.js",
          "code_excerpts": [
            {
              "file": "apps/name-forge/webui/vite.config.js",
              "start_line": 25,
              "end_line": 29,
              "snippet": "resolve: {\n  alias: {\n    '@lib': resolve(__dirname, '../lib'),\n  },\n},"
            }
          ],
          "implementation_details": "The @lib alias simplifies imports from the core library when the webui is deeply nested. Usage: import { generate } from '@lib/generate.js'. However, this alias is only configured in Vite \u2014 TypeScript apps also need a paths entry in tsconfig.json, and not all apps have both. The alias means @lib refers to a different actual directory in each app (lore-weave's lib/ vs name-forge's lib/ vs illuminator's lib/), which can be confusing in a monorepo context."
        },
        {
          "name": "package-source-alias",
          "description": "archivist and chronicler alias @the-canonry/world-store to the package's TypeScript source (../../../packages/world-store/src/index.ts) rather than its built output. This bypasses the package's build step and imports source directly.",
          "file_count": 2,
          "files": [
            "apps/archivist/webui/vite.config.ts",
            "apps/chronicler/webui/vite.config.ts"
          ],
          "sample_file": "apps/archivist/webui/vite.config.ts",
          "code_excerpts": [
            {
              "file": "apps/archivist/webui/vite.config.ts",
              "start_line": 23,
              "end_line": 30,
              "snippet": "resolve: {\n  alias: {\n    '@the-canonry/world-store': path.resolve(\n      __dirname,\n      '../../../packages/world-store/src/index.ts'\n    ),\n  },\n},"
            }
          ],
          "implementation_details": "By aliasing to the package's TypeScript source rather than its compiled output, these apps get live type checking and avoid needing to rebuild the package during development. However, this creates an implicit dependency on the package's internal file structure \u2014 if world-store reorganizes its src/ directory, these aliases break. Other apps that consume world-store (via module federation's shared config) rely on the compiled package instead."
        },
        {
          "name": "cross-app-source-alias",
          "description": "viewer aliases @chronicler to apps/chronicler/webui/src, importing directly from another app's source code. cosmographer aliases @name-forge to apps/name-forge/lib, importing from another app's library code. These create tight coupling between apps that bypasses the module federation boundary.",
          "file_count": 2,
          "files": [
            "apps/viewer/webui/vite.config.js",
            "apps/cosmographer/webui/vite.config.js"
          ],
          "sample_file": "apps/viewer/webui/vite.config.js",
          "code_excerpts": [
            {
              "file": "apps/viewer/webui/vite.config.js",
              "start_line": 7,
              "end_line": 10,
              "snippet": "resolve: {\n  alias: {\n    \"@chronicler\": resolve(__dirname, \"../../chronicler/webui/src\"),\n  },\n},"
            }
          ],
          "implementation_details": "These aliases create direct source-level coupling between apps, bypassing the Module Federation boundary that normally isolates MFEs. viewer imports ChroniclerRemote.tsx directly from chronicler's source rather than loading it as a federated remote. cosmographer imports name-forge's library functions directly. This means these apps cannot be deployed independently \u2014 they require the other app's source to be present at build time. This is the most architecturally problematic alias pattern."
        },
        {
          "name": "no-aliases",
          "description": "canonry, coherence-engine, and (partially) cosmographer have no resolve.alias configuration, using only bare package names or relative imports.",
          "file_count": 3,
          "files": [
            "apps/canonry/webui/vite.config.js",
            "apps/coherence-engine/webui/vite.config.js"
          ],
          "sample_file": "apps/canonry/webui/vite.config.js",
          "code_excerpts": [
            {
              "file": "apps/canonry/webui/vite.config.js",
              "start_line": 1,
              "end_line": 5,
              "snippet": "import { defineConfig } from 'vite';\nimport react from '@vitejs/plugin-react';\nimport { federation } from '@module-federation/vite';\nimport { federationOnWarn, sharedDeps } from '../../../config/federation.js';"
            }
          ],
          "implementation_details": "These apps rely entirely on standard module resolution (node_modules, relative paths, or module federation remotes). This is the simplest approach \u2014 no alias configuration to maintain, no hidden path mappings. canonry as the shell/host loads all MFE remotes via module federation, so it doesn't need source-level aliases."
        }
      ],
      "analysis": "The four alias patterns reflect different development ergonomics preferences and different levels of inter-app coupling. The @lib alias (3 apps) is a reasonable convenience for apps with a lib/webui split. The @the-canonry/world-store source alias (2 apps) optimizes for development speed but creates fragile source-path dependencies. The cross-app source aliases (viewer \u2192 chronicler, cosmographer \u2192 name-forge) are the most concerning because they break the MFE isolation boundary \u2014 these apps cannot be built independently. The 'no alias' pattern (3 apps) is the simplest and most portable. Convergence means standardizing on one alias convention and eliminating cross-app source coupling.\n\nAlso noted by structural audit: This drift is a minor symptom of the larger TypeScript migration state. The vite configs are functionally identical regardless of extension \u2014 they import the same federation config, use the same plugin setup, and expose the same federation remotes. The TypeScript versions provide slightly better IDE autocomplete for the config shape but this is a marginal benefit for a file that changes rarely. This would resolve naturally as part of a broader TypeScript migration.",
      "recommendation": "Eliminate cross-app source aliases first: viewer should load chronicler via module federation (or the chronicler components it needs should be extracted to a shared package). cosmographer should consume name-forge as a package dependency rather than aliasing to its source. For the @lib alias, standardize: either all lib-having apps use it or none do. The @the-canonry/world-store source alias is acceptable during development but should be documented as a dev-only optimization.",
      "evidence_quality": "high",
      "status": "completed",
      "source_domain": "structural",
      "merged_from": [
        "vite-config-language-mismatch"
      ]
    },
    {
      "id": "import-extension-conventions",
      "name": "Import Path Extension Conventions",
      "type": "structural",
      "description": "TypeScript apps use two different conventions for local import extensions: archivist includes explicit .tsx/.ts extensions in import paths (import LoreSection from './LoreSection.tsx'), while chronicler, illuminator, and all JavaScript apps omit extensions (import ChroniclePanel from './ChroniclePanel'). This creates inconsistency in how files reference each other across the monorepo.",
      "impact": "LOW",
      "total_files": 65,
      "variants": [
        {
          "name": "explicit-tsx-ts-extensions",
          "description": "archivist consistently includes .tsx and .ts extensions in local imports. Every component and utility import specifies the full file extension.",
          "file_count": 21,
          "files": [
            "apps/archivist/webui/src/components/EntityDetail.tsx",
            "apps/archivist/webui/src/components/GraphView.tsx",
            "apps/archivist/webui/src/ArchivistRemote.tsx"
          ],
          "sample_file": "apps/archivist/webui/src/components/EntityDetail.tsx",
          "code_excerpts": [
            {
              "file": "apps/archivist/webui/src/components/EntityDetail.tsx",
              "start_line": 10,
              "end_line": 21,
              "snippet": "import type {\n  WorldState,\n  LoreData,\n} from \"../types/world.ts\";\nimport {\n  getEntityById,\n  getRelatedEntities,\n} from \"../utils/dataTransform.ts\";\nimport LoreSection from \"./LoreSection.tsx\";\nimport RelationshipStoryModal from \"./RelationshipStoryModal.tsx\";\nimport ChainLinkSection from \"./ChainLinkSection.tsx\";\nimport DiscoveryStory from \"./DiscoveryStory.tsx\";"
            }
          ],
          "implementation_details": "Archivist uses explicit .tsx/.ts extensions on every local import. This matches Node.js ESM resolution rules (which require extensions) and is forward-compatible with TypeScript's 'nodenext' module resolution. However, it's unique in this monorepo \u2014 no other app follows this convention. It creates visual noise in import statements and means copying imports between apps requires adding or removing extensions."
        },
        {
          "name": "extensionless-imports",
          "description": "All other apps (chronicler, illuminator, coherence-engine, canonry, etc.) omit file extensions in local imports, relying on Vite's module resolution to find the correct file.",
          "file_count": 803,
          "files": [
            "apps/illuminator/webui/src/hooks/useChronicleActions.ts",
            "apps/coherence-engine/webui/src/components/actions/index.js",
            "apps/canonry/webui/src/App.jsx",
            "apps/chronicler/webui/src/hooks/useWorldDataLoader.ts"
          ],
          "sample_file": "apps/illuminator/webui/src/hooks/useChronicleActions.ts",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/hooks/useChronicleActions.ts",
              "start_line": 9,
              "end_line": 14,
              "snippet": "import { useCallback } from \"react\";\nimport type { ChronicleGenerationContext, ChronicleSampling } from \"../lib/chronicleTypes\";\nimport type { EnrichmentType, ChronicleStep } from \"../lib/enrichmentTypes\";\nimport { getEnqueue } from \"../lib/db/enrichmentQueueBridge\";\nimport { useChronicleStore } from \"../lib/db/chronicleStore\";\nimport type { ChronicleRecord } from \"../lib/db/chronicleRepository\";"
            }
          ],
          "implementation_details": "The vast majority of imports across all apps omit file extensions. Vite resolves these by trying .ts, .tsx, .js, .jsx in order. This is the conventional approach in Vite/webpack projects and is consistent with the broader React ecosystem. The tradeoff is that it relies on bundler-specific resolution and wouldn't work under strict Node.js ESM rules."
        }
      ],
      "analysis": "This is a minor but noticeable inconsistency. archivist's explicit extensions are technically more correct for ESM compatibility, but they're unique in this monorepo and create friction when developers copy-paste imports between apps. The extensionless convention is overwhelmingly dominant (803 of 824 files). This drift likely occurred because archivist was scaffolded with a different template or by a developer who preferred explicit extensions. It's a cosmetic issue that doesn't affect runtime behavior (Vite handles both correctly) but contributes to visual inconsistency across apps.",
      "recommendation": "Low priority. If addressed, standardize on extensionless imports (the dominant convention) and remove .tsx/.ts extensions from archivist's imports. This is a quick find-and-replace task but shouldn't block other work.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "structural"
    },
    {
      "id": "test-infrastructure-coverage",
      "name": "Test Infrastructure Absence in WebUI Apps",
      "type": "structural",
      "description": "Only 2 of 9 apps (lore-weave, name-forge) have vitest configuration files, and even those have zero test files (.test.* or .spec.*). No webui app has any test infrastructure. The monorepo has 824 source files and 0 test files. This is a structural gap rather than drift between variants, but it means there is no testable pattern to standardize on.",
      "impact": "LOW",
      "total_files": 0,
      "variants": [
        {
          "name": "vitest-configured-no-tests",
          "description": "lore-weave and name-forge have vitest.config.ts files and vitest in devDependencies, indicating test infrastructure was set up but no test files exist. These are the core library apps with TypeScript code that would most benefit from testing.",
          "file_count": 2,
          "files": [
            "apps/lore-weave/vitest.config.ts",
            "apps/name-forge/vitest.config.ts"
          ],
          "sample_file": "apps/lore-weave/vitest.config.ts",
          "code_excerpts": [
            {
              "file": "apps/lore-weave/vitest.config.ts",
              "start_line": 1,
              "end_line": 1,
              "snippet": "// vitest.config.ts exists with coverage configuration"
            }
          ],
          "implementation_details": "Both apps include @vitest/coverage-v8 and @vitest/ui in devDependencies and have vitest.config.ts files. package.json has 'test' scripts configured. But find across the entire monorepo returns 0 .test.* or .spec.* files. The test infrastructure is scaffolded but unused."
        },
        {
          "name": "no-test-infrastructure",
          "description": "7 apps (archivist, canonry, chronicler, coherence-engine, cosmographer, illuminator, viewer) have no vitest configuration, no test runner, and no test files. Their webui directories contain only source code and CSS.",
          "file_count": 7,
          "files": [
            "apps/archivist/webui/package.json",
            "apps/canonry/webui/package.json",
            "apps/coherence-engine/webui/package.json"
          ],
          "sample_file": "apps/archivist/webui/package.json",
          "code_excerpts": [],
          "implementation_details": "No test-related devDependencies (vitest, jest, testing-library, etc.) in any webui app package.json. No __tests__ directories, no .test.* files, no .spec.* files. The monorepo's root package.json has a 'test' script that runs 'turbo run test', but this finds nothing to run in most apps."
        }
      ],
      "analysis": "The complete absence of tests is notable but is less 'drift' (inconsistency between implementations) and more a 'gap' (missing infrastructure entirely). The two library-focused apps set up vitest but never wrote tests, suggesting testing was intended but deprioritized. For a monorepo with 824 source files, zero tests means all validation is manual. This is flagged as structural context rather than a high-priority drift finding \u2014 the user almost certainly knows about this already.",
      "recommendation": "If testing becomes a priority, start with the core libraries (lore-weave/lib, name-forge/lib) which already have vitest configured. For webui apps, add @testing-library/react and vitest to the shared config and create a standard test file convention (ComponentName.test.tsx co-located with the component).",
      "evidence_quality": "high",
      "status": "completed",
      "source_domain": "structural"
    },
    {
      "id": "webui-src-directory-structure",
      "name": "WebUI Source Directory Organization",
      "type": "structural",
      "description": "The webui/src/ directories across MFE apps use different subdirectory conventions for organizing non-component code. Some use hooks/, some use lib/, some use stores/, some use storage/, some use utils/, some use types/, some use workers/, some use styles/ \u2014 with no consistent convention for which directories exist or what they contain. This means developers must learn a different organizational model for each app.",
      "impact": "MEDIUM",
      "total_files": 824,
      "variants": [
        {
          "name": "hooks-lib-types-pattern",
          "description": "illuminator and chronicler organize non-component code into hooks/ (React hooks), lib/ (business logic, types, utilities), and optionally types/ and workers/. illuminator has hooks/ (32 files), lib/ (with db/, chronicle/, preprint/ subdirectories), and workers/. chronicler has hooks/ (2 files), lib/ (wikiBuilder, chronicleStorage), types/, and styles/.",
          "file_count": 350,
          "files": [
            "apps/illuminator/webui/src/hooks/",
            "apps/illuminator/webui/src/lib/",
            "apps/illuminator/webui/src/workers/",
            "apps/chronicler/webui/src/hooks/",
            "apps/chronicler/webui/src/lib/",
            "apps/chronicler/webui/src/types/",
            "apps/chronicler/webui/src/styles/"
          ],
          "sample_file": "apps/illuminator/webui/src/hooks/useChronicleActions.ts",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/hooks/useChronicleActions.ts",
              "start_line": 1,
              "end_line": 7,
              "snippet": "/**\n * useChronicleActions - Thin hook for enqueue-dependent chronicle actions.\n *\n * Receives onEnqueue from props (the enrichment queue system) and provides\n * action functions that read chronicle data from the Zustand store imperatively.\n * This separation keeps the store free of prop-dependent closures.\n */"
            }
          ],
          "implementation_details": "The hooks/lib split provides clear separation between React-specific code (hooks with useState/useCallback) and pure business logic (lib with classes, utilities, data access). illuminator is the most developed example: hooks/ contains 32 custom hooks, lib/db/ contains Dexie database and Zustand stores, lib/chronicle/ contains chronicle generation logic, workers/ contains web worker tasks. chronicler follows the same pattern at smaller scale."
        },
        {
          "name": "stores-storage-pattern",
          "description": "canonry splits state management into two sibling directories: stores/ (Zustand reactive stores) and storage/ (IndexedDB data access). It also has lib/ for utilities and aws/ for deployment.",
          "file_count": 47,
          "files": [
            "apps/canonry/webui/src/stores/useCanonryAwsStore.js",
            "apps/canonry/webui/src/stores/useCanonryUiStore.js",
            "apps/canonry/webui/src/storage/worldStore.js",
            "apps/canonry/webui/src/storage/runStore.js",
            "apps/canonry/webui/src/lib/"
          ],
          "sample_file": "apps/canonry/webui/src/stores/useCanonryUiStore.js",
          "code_excerpts": [
            {
              "file": "apps/canonry/webui/src/stores/useCanonryUiStore.js",
              "start_line": 1,
              "end_line": 5,
              "snippet": "import { create } from \"zustand\";\nimport { subscribeWithSelector } from \"zustand/middleware\";\n\nconst initial = { /* ... */ };\n\nexport const useCanonryUiStore = create("
            }
          ],
          "implementation_details": "canonry's stores/ directory contains Zustand stores (reactive, synchronous UI state), while storage/ contains IndexedDB access functions (async, persistent domain data). This separation makes sense conceptually but the naming is confusing \u2014 'stores' and 'storage' are near-synonyms. No other app uses this dual-directory pattern. canonry also has lib/ (utilities), aws/ (deployment config), and remotes/ (MFE loading), adding more unique directories."
        },
        {
          "name": "minimal-flat-pattern",
          "description": "archivist, cosmographer, lore-weave, and name-forge have minimal subdirectory structure. archivist has types/ and utils/ alongside components/. cosmographer has just components/. lore-weave has components/ and hooks/. name-forge has components/ and lib/.",
          "file_count": 150,
          "files": [
            "apps/archivist/webui/src/types/",
            "apps/archivist/webui/src/utils/",
            "apps/archivist/webui/src/components/",
            "apps/lore-weave/webui/src/components/",
            "apps/lore-weave/webui/src/hooks/"
          ],
          "sample_file": "apps/archivist/webui/src/ArchivistRemote.tsx",
          "code_excerpts": [
            {
              "file": "apps/archivist/webui/src/ArchivistRemote.tsx",
              "start_line": 1,
              "end_line": 6,
              "snippet": "import React, { useEffect, useMemo, useState } from \"react\";\nimport \"./index.css\";\nimport WorldExplorer from \"./components/WorldExplorer.tsx\";\nimport type { WorldState } from \"./types/world.ts\";\nimport { validateWorldData } from \"./utils/schemaValidation.ts\";\nimport { buildWorldStateForSlot } from \"@the-canonry/world-store\";"
            }
          ],
          "implementation_details": "These apps keep it simple: components/ for React components, and one or two utility directories. archivist uses types/ (TypeScript type definitions) and utils/ (data transformation utilities). The naming is conventional and easily understood. This pattern works well for smaller apps but provides less guidance for where new non-component code should go."
        },
        {
          "name": "styles-utils-only-pattern",
          "description": "coherence-engine has a unique structure: components/ (with deep feature nesting), styles/ (centralized design system), and utils/ (shared utilities). No hooks/, no lib/, no types/.",
          "file_count": 115,
          "files": [
            "apps/coherence-engine/webui/src/components/",
            "apps/coherence-engine/webui/src/styles/",
            "apps/coherence-engine/webui/src/utils/"
          ],
          "sample_file": "apps/coherence-engine/webui/src/CoherenceEngineRemote.jsx",
          "code_excerpts": [
            {
              "file": "apps/coherence-engine/webui/src/CoherenceEngineRemote.jsx",
              "start_line": 1,
              "end_line": 5,
              "snippet": "import React, { useMemo } from \"react\";\nimport PropTypes from \"prop-types\";\nimport \"@the-canonry/shared-components/styles\";\nimport { ErasEditor } from \"./components/eras\";\n"
            }
          ],
          "implementation_details": "coherence-engine puts all React logic in deeply-nested feature directories under components/, shared CSS in styles/, and JavaScript utilities in utils/. It has no hooks/ directory \u2014 hooks are inline within components or don't exist (this app uses prop drilling). It has no types/ directory because it's pure JavaScript. The deep nesting under components/ (28 directories) is unusual and specific to coherence-engine's feature-module architecture."
        }
      ],
      "analysis": "Each app has evolved its own directory structure organically based on its complexity and development history. The core issue isn't that any single pattern is wrong \u2014 they're all reasonable for their app's size and needs \u2014 but that there's no shared convention. A developer working across apps must mentally switch between 'hooks/ + lib/' (illuminator), 'stores/ + storage/' (canonry), 'types/ + utils/' (archivist), and 'styles/ + utils/' (coherence-engine) organizational models. The nomenclature is also inconsistent: utility functions live in utils/ (archivist, coherence-engine), lib/ (canonry, name-forge, chronicler), or are spread across hooks/ and components/ (lore-weave). Convergence means establishing a reference directory structure for new apps and gradually aligning existing apps during major refactors.",
      "recommendation": "Define a canonical webui/src/ structure in a pattern doc: components/ (React components), hooks/ (React hooks), lib/ (business logic, data access, non-React utilities), types/ (TypeScript type definitions), styles/ (shared/global CSS). This aligns with the illuminator/chronicler pattern which is the most complete. Rename canonry's stores/ and storage/ to align (Zustand stores could live in lib/stores/). Don't force-migrate immediately \u2014 adopt for new code and align during feature work.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "structural"
    },
    {
      "id": "bulk-modal-shell-adoption",
      "name": "BulkOperationShell Adoption Consistency",
      "type": "behavioral",
      "domain": "Multi-Step Workflow Consistency",
      "description": "Three of the eight bulk operation modals (BulkEraNarrativeModal, InterleavedAnnotationModal, CorpusFindReplace) bypass BulkOperationShell entirely, duplicating its overlay, header, minimize-to-pill, footer, and phase-detection patterns inline. The remaining five (BulkHistorianModal, BulkBackportModal, BulkChronicleAnnotationModal, BulkToneRankingModal, BulkFactCoverageModal) properly compose through the shared shell.",
      "impact": "MEDIUM",
      "total_files": 8,
      "variants": [
        {
          "name": "shell-composed",
          "description": "Modal composes through BulkOperationShell, which handles overlay, header, pill lifecycle, footer buttons, and phase detection. Modal only provides body content.",
          "file_count": 5,
          "files": [
            "apps/illuminator/webui/src/components/BulkHistorianModal.jsx",
            "apps/illuminator/webui/src/components/BulkBackportModal.jsx",
            "apps/illuminator/webui/src/components/BulkChronicleAnnotationModal.jsx",
            "apps/illuminator/webui/src/components/BulkToneRankingModal.jsx",
            "apps/illuminator/webui/src/components/BulkFactCoverageModal.jsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/BulkHistorianModal.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/BulkHistorianModal.jsx",
              "start_line": 51,
              "end_line": 56,
              "snippet": "return <BulkOperationShell pillId=\"bulk-historian\" title={title} progress={progress}\n  onConfirm={onConfirm} onCancel={onCancel} onClose={onClose}\n  confirmLabel={progress ? getConfirmLabel(progress) : \"\"}\n  statusText={progress ? getStatusText(progress) : \"\"}\n  pillStatusText={progress ? getPillText(progress) : \"\"}>"
            }
          ],
          "implementation_details": "Delegates all structural concerns (overlay div, dialog width switching, header with minimize button and status, footer with confirm/cancel/close buttons, pill lifecycle via floatingPillStore) to BulkOperationShell. Modal only renders phase-specific body content as children."
        },
        {
          "name": "inline-overlay-and-pill",
          "description": "Modal renders its own overlay, header, footer, minimize button, pill lifecycle, and progress bar \u2014 duplicating BulkOperationShell's concerns.",
          "file_count": 3,
          "files": [
            "apps/illuminator/webui/src/components/BulkEraNarrativeModal.jsx",
            "apps/illuminator/webui/src/components/InterleavedAnnotationModal.jsx",
            "apps/illuminator/webui/src/components/CorpusFindReplace.tsx"
          ],
          "sample_file": "apps/illuminator/webui/src/components/BulkEraNarrativeModal.jsx",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/components/BulkEraNarrativeModal.jsx",
              "start_line": 191,
              "end_line": 213,
              "snippet": "return <div className=\"benm-overlay\">\n  <div className=\"benm-modal\" style={{ \"--benm-modal-width\": isConfirming ? \"540px\" : \"560px\" }}>\n    <div className=\"benm-header\">\n      <div className=\"benm-header-row\">\n        <h2 className=\"benm-title\">Bulk Era Narrative</h2>\n        <div className=\"benm-header-actions\">\n          {!isConfirming && <button onClick={() => useFloatingPillStore.getState().minimize({\n            id: PILL_ID, label: \"Bulk Era Narrative\",\n            statusText: ..., statusColor: ..., tabId: \"chronicle\"\n          })} className=\"illuminator-button benm-minimize-btn\">...</button>}\n          <span className=\"benm-status-label\" style={{ \"--benm-status-color\": statusColor }}>...</span>"
            },
            {
              "file": "apps/illuminator/webui/src/components/InterleavedAnnotationModal.jsx",
              "start_line": 44,
              "end_line": 65,
              "snippet": "return <div className=\"iam-overlay\">\n  <div className=\"iam-dialog\" style={{ \"--iam-dialog-width\": isConfirming ? \"560px\" : \"480px\" }}>\n    <div className=\"iam-header\">\n      <div className=\"iam-header-row\">\n        <h2 className=\"iam-title\">Interleaved Annotation</h2>\n        <div className=\"iam-header-actions\">\n          {!isConfirming && <button onClick={() => useFloatingPillStore.getState().minimize({\n            id: PILL_ID, label: \"Interleaved Annotation\",\n            statusText: ..., statusColor: ...\n          })} className=\"illuminator-button iam-minimize-btn\">...</button>}"
            }
          ],
          "implementation_details": "Each modal manually implements: overlay div, dialog with CSS custom property width, header row with title + minimize button + status span, footer with confirm/cancel/close buttons, plus useEffect hooks for pill update and pill cleanup when idle. All of this is identical to what BulkOperationShell provides. BulkEraNarrativeModal also has its own progress bar, terminal message divs, and cost display instead of using BulkProgressBar, BulkTerminalMessage, and BulkCost."
        }
      ],
      "behavior_matrix": {
        "BulkHistorianModal": {
          "uses_shell": "yes \u2014 <BulkOperationShell pillId=\"bulk-historian\">",
          "uses_shared_progress_bar": "yes \u2014 <BulkProgressBar>",
          "uses_shared_terminal": "yes \u2014 <BulkTerminalMessage>",
          "uses_shared_failed_list": "yes \u2014 <BulkFailedList>",
          "uses_shared_cost": "yes \u2014 <BulkCost>"
        },
        "BulkBackportModal": {
          "uses_shell": "yes \u2014 <BulkOperationShell pillId=\"bulk-backport\">",
          "uses_shared_progress_bar": "no \u2014 custom bbm-progress-* classes with own progress bar",
          "uses_shared_terminal": "yes \u2014 <BulkTerminalMessage>",
          "uses_shared_failed_list": "no \u2014 no failed items list (chronicle-level failure only)",
          "uses_shared_cost": "yes \u2014 <BulkCost>"
        },
        "BulkChronicleAnnotationModal": {
          "uses_shell": "yes \u2014 <BulkOperationShell pillId=\"bulk-chronicle-annotation\">",
          "uses_shared_progress_bar": "yes \u2014 <BulkProgressBar>",
          "uses_shared_terminal": "yes \u2014 <BulkTerminalMessage>",
          "uses_shared_failed_list": "yes \u2014 <BulkFailedList>",
          "uses_shared_cost": "yes \u2014 <BulkCost>"
        },
        "BulkToneRankingModal": {
          "uses_shell": "yes \u2014 <BulkOperationShell pillId=\"bulk-tone-ranking\">",
          "uses_shared_progress_bar": "yes \u2014 <BulkProgressBar>",
          "uses_shared_terminal": "yes \u2014 <BulkTerminalMessage>",
          "uses_shared_failed_list": "no \u2014 single LLM call, no per-item failures",
          "uses_shared_cost": "yes \u2014 <BulkCost>"
        },
        "BulkFactCoverageModal": {
          "uses_shell": "yes \u2014 <BulkOperationShell pillId=\"bulk-fact-coverage\">",
          "uses_shared_progress_bar": "yes \u2014 <BulkProgressBar>",
          "uses_shared_terminal": "yes \u2014 <BulkTerminalMessage>",
          "uses_shared_failed_list": "yes \u2014 <BulkFailedList>",
          "uses_shared_cost": "yes \u2014 <BulkCost>"
        },
        "BulkEraNarrativeModal": {
          "uses_shell": "no \u2014 inline benm-overlay, benm-modal, benm-header, benm-footer",
          "uses_shared_progress_bar": "no \u2014 custom benm-progress-* classes",
          "uses_shared_terminal": "no \u2014 custom benm-terminal-msg divs",
          "uses_shared_failed_list": "no \u2014 no failed items list",
          "uses_shared_cost": "no \u2014 custom benm-stats div"
        },
        "InterleavedAnnotationModal": {
          "uses_shell": "no \u2014 inline iam-overlay, iam-dialog, iam-header, iam-footer",
          "uses_shared_progress_bar": "no \u2014 custom iam-progress-* classes",
          "uses_shared_terminal": "no \u2014 custom iam-terminal-* divs",
          "uses_shared_failed_list": "no \u2014 custom iam-failed-section div",
          "uses_shared_cost": "no \u2014 custom iam-cost div"
        }
      },
      "missing_behavior_complexity": {
        "BulkEraNarrativeModal_shell_adoption": "moderate \u2014 needs to restructure JSX to pass body as children to BulkOperationShell. The streaming step progress UI (threads/generate/edit with live word counts) is unique to this modal and stays as custom body content. The overlay, header, footer, and pill lifecycle are straightforward to delegate.",
        "InterleavedAnnotationModal_shell_adoption": "moderate \u2014 same restructuring as above. The work-item list with chronicle/entity interleaving is unique body content that stays custom. Shell handles the wrapper.",
        "BulkBackportModal_shared_progress_bar": "trivial \u2014 currently uses custom bbm-progress-* classes; could switch to <BulkProgressBar> with minor CSS adjustment"
      },
      "analysis": "This is genuine drift, not intentional variation. BulkEraNarrativeModal and InterleavedAnnotationModal were likely developed after BulkOperationShell was created but before its API was stabilized to handle their needs. Both modals duplicate the exact same overlay/dialog/header/minimize/footer/pill lifecycle pattern, just with different CSS prefixes (benm-*, iam-*). The user-visible impact is subtle but real: the three non-shell modals have slightly different minimize button placement, different status color computation (inline style vs CSS class), and different dialog width values. Unification target: extend BulkOperationShell to accept the streaming step progress and interleaved work list as children, then migrate BulkEraNarrativeModal and InterleavedAnnotationModal to compose through it.\n\nAlso noted by behavioral audit: This is likely intentional variation rather than drift. Era narrative generation is a uniquely long-running operation (3 LLM calls per era, potentially 10+ minutes per era) that benefits from detailed progress feedback. Other bulk operations (historian annotation, backport, etc.) complete individual items in seconds, making streaming text display less valuable. The era narrative modal was purpose-built to show this level of detail because of the operation's duration and complexity. However, the fact that the streaming infrastructure (useThinkingStore) exists and could theoretically be wired into other modals means this could be considered a progressive enhancement opportunity rather than drift to fix.\n\nAlso noted by behavioral audit: The progress feedback landscape is mostly well-structured thanks to BulkOperationShell unifying 7 bulk modals in Illuminator. The drift is minor: EraNarrativeModal and InterleavedAnnotationModal directly use FloatingPillStore instead of routing through BulkOperationShell, duplicating pill lifecycle management. EraNarrativeModal's deviation is arguably intentional \u2014 it has a multi-step workflow (outline -> build -> assemble -> review) that doesn't map to BulkOperationShell's linear batch model. InterleavedAnnotationModal's deviation is less justified. SimulationRunner's dashboard-based approach is appropriately specialized for streaming simulation data. The main actionable drift is the Canonry export spinner, which could benefit from progress feedback but is a different app entirely.",
      "recommendation": "Migrate BulkEraNarrativeModal and InterleavedAnnotationModal to compose through BulkOperationShell. The shell already supports custom body content via children, custom widths via confirmWidth/processWidth, and custom pill text via pillStatusText. The only missing capability is the streaming step progress display (unique to era narratives) \u2014 this stays as body content inside the shell.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "workflows",
      "merged_from": [
        "streaming-progress-display",
        "progress-feedback-during-async-ops"
      ]
    },
    {
      "id": "bulk-store-architecture",
      "name": "State Management Pattern for Bulk Operations",
      "type": "behavioral",
      "domain": "Multi-Step Workflow Consistency",
      "description": "Bulk operations use two incompatible state management patterns: React hooks with useState/useRef (useBulkHistorian, useBulkBackport) vs Zustand stores with module-level flags (bulkEraNarrativeStore, bulkChronicleAnnotationStore, interleavedAnnotationStore). The Zustand pattern survives tab switches; the hook pattern does not.",
      "impact": "MEDIUM",
      "total_files": 5,
      "variants": [
        {
          "name": "react-hook-with-refs",
          "description": "State managed by useState inside a custom hook. Module-level cancelledRef and activeRef survive unmounts, but progress state is lost on tab switch because useState is destroyed.",
          "file_count": 2,
          "files": [
            "apps/illuminator/webui/src/hooks/useBulkHistorian.ts",
            "apps/illuminator/webui/src/hooks/useBulkBackport.ts"
          ],
          "sample_file": "apps/illuminator/webui/src/hooks/useBulkHistorian.ts",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/hooks/useBulkHistorian.ts",
              "start_line": 102,
              "end_line": 120,
              "snippet": "export function useBulkHistorian(deps: {\n  buildReviewContext: ...\n  applyReviewNotes: ...\n  reloadEntities: ...\n  getEntityNav: ...\n}): UseBulkHistorianReturn {\n  const [progress, setProgress] = useState<BulkHistorianProgress>(IDLE_PROGRESS);\n  const cancelledRef = useRef(false);\n  const activeRef = useRef(false);\n  const depsRef = useRef(deps);\n  const scanRef = useRef<{ operation; tone; entities; reEdition? } | null>(null);"
            }
          ],
          "implementation_details": "Uses useState for progress, useRef for cancellation/active flags and scan data. The async processing loop is a fire-and-forget IIFE inside confirmBulkHistorian that calls setProgress. If the component unmounts mid-run (tab switch), the async loop continues but setProgress becomes a no-op on the unmounted component \u2014 the user loses visibility into progress."
        },
        {
          "name": "zustand-with-module-flags",
          "description": "State managed by Zustand store with module-level activeFlag, cancelledFlag, and scanData variables. Progress survives tab switches because the Zustand store persists globally.",
          "file_count": 3,
          "files": [
            "apps/illuminator/webui/src/lib/db/bulkEraNarrativeStore.ts",
            "apps/illuminator/webui/src/lib/db/bulkChronicleAnnotationStore.ts",
            "apps/illuminator/webui/src/lib/db/interleavedAnnotationStore.ts"
          ],
          "sample_file": "apps/illuminator/webui/src/lib/db/bulkEraNarrativeStore.ts",
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/lib/db/bulkEraNarrativeStore.ts",
              "start_line": 72,
              "end_line": 83,
              "snippet": "// Module-level flags (survive component unmounts)\nlet activeFlag = false;\nlet cancelledFlag = false;\nlet scanData: {\n  eras: BulkEraNarrativeEraSummary[];\n  tone: EraNarrativeTone;\n  projectId: string;\n  simulationRunId: string;\n  eraTemporalInfo: EraTemporalEntry[];\n  chronicleItems: ChronicleNavItem[];\n  narrativeWeightMap: Record<string, string>;\n} | null = null;"
            },
            {
              "file": "apps/illuminator/webui/src/lib/db/bulkChronicleAnnotationStore.ts",
              "start_line": 63,
              "end_line": 71,
              "snippet": "// Module-level flags (survive component unmounts)\nlet activeFlag = false;\nlet cancelledFlag = false;\nlet scanData: {\n  operation: \"run\" | \"clear\";\n  chronicles: BulkAnnotationChronicleSummary[];\n} | null = null;"
            }
          ],
          "implementation_details": "Module-level flags (activeFlag, cancelledFlag, scanData) are declared outside the store for the async loop to reference. The store's set() function updates Zustand state from the async loop. Since Zustand state is global, the modal can unmount and remount (tab switch) and still show current progress. The async loop itself runs independently of React lifecycle."
        }
      ],
      "behavior_matrix": {
        "useBulkHistorian": {
          "state_management": "useState + useRef",
          "survives_tab_switch": "no \u2014 progress lost, async loop becomes invisible",
          "cancellation_mechanism": "cancelledRef.current = true",
          "scan_data_storage": "scanRef (useRef)",
          "active_guard": "activeRef.current"
        },
        "useBulkBackport": {
          "state_management": "useState + useRef",
          "survives_tab_switch": "no \u2014 progress lost, async loop becomes invisible",
          "cancellation_mechanism": "cancelledRef.current = true",
          "scan_data_storage": "scanRef (useRef)",
          "active_guard": "activeRef.current"
        },
        "bulkChronicleAnnotationStore": {
          "state_management": "Zustand + module-level flags",
          "survives_tab_switch": "yes \u2014 Zustand store persists",
          "cancellation_mechanism": "cancelledFlag = true (module-level)",
          "scan_data_storage": "scanData (module-level let)",
          "active_guard": "activeFlag (module-level let)"
        },
        "bulkEraNarrativeStore": {
          "state_management": "Zustand + module-level flags",
          "survives_tab_switch": "yes \u2014 Zustand store persists",
          "cancellation_mechanism": "cancelledFlag = true (module-level)",
          "scan_data_storage": "scanData (module-level let)",
          "active_guard": "activeFlag (module-level let)"
        },
        "interleavedAnnotationStore": {
          "state_management": "Zustand + module-level flags",
          "survives_tab_switch": "yes \u2014 Zustand store persists",
          "cancellation_mechanism": "cancelledFlag = true (module-level)",
          "scan_data_storage": "scanData (module-level let)",
          "active_guard": "activeFlag (module-level let)"
        }
      },
      "missing_behavior_complexity": {
        "useBulkHistorian_to_zustand": "moderate \u2014 requires extracting the buildReviewContext/applyReviewNotes/reloadEntities/getEntityNav deps from React hook closures into a store initialization pattern (similar to how bulkEraNarrativeStore accesses useChronicleStore.getState()). The async processing loop itself would be unchanged.",
        "useBulkBackport_to_zustand": "moderate \u2014 same pattern. The assembleContextForChronicle, applyPatches, getEligibleChronicleIds deps need to be passed into the store at prepare time rather than captured via useRef."
      },
      "analysis": "This is genuine drift. The Zustand stores (bulkChronicleAnnotationStore, bulkEraNarrativeStore, interleavedAnnotationStore) were written later and intentionally chose the module-flag + Zustand pattern to fix the tab-switch problem that affects the earlier hook-based implementations. The comments in bulkChronicleAnnotationStore explicitly say 'State lives in Zustand so it survives component unmounts during tab switches. Same pattern as toneRankingStore.' The user-visible impact is significant: if a user starts a bulk historian operation and switches to a different tab, the progress display disappears and cannot be recovered without waiting for the floating pill to update. The Zustand-based operations maintain full progress visibility across tab switches.\n\nAlso noted by behavioral audit: This is mostly cosmetic drift. All five implementations follow the same prepare/confirm/cancel lifecycle, but the method names diverge (prepareBulkHistorian vs prepareBulk vs prepareAnnotation vs prepareInterleaved). The Zustand stores have an additional close method that the hooks lack \u2014 this is a functional gap since the hooks have no way to dismiss terminal state without parent involvement. The impact on users is nil (these are internal APIs), but the inconsistency makes it harder for developers to work across bulk operations. A shared interface type (e.g., BulkOperationLifecycle<TProgress>) would clarify the contract.\n\nAlso noted by behavioral audit: This is intentional variation, not drift. The simulation worker in lore-weave is a fundamentally different kind of workflow from the bulk LLM-powered operations in illuminator. The simulation is a pausable, steppable computational task with explicit validation and finalization phases \u2014 concepts that don't apply to sequential LLM calls. The five bulk operations are perfectly consistent with each other, which is the important finding. The simulation worker's different status set is appropriate for its domain. The one minor inconsistency is 'error' vs 'failed' \u2014 these mean the same thing but use different names. This is worth noting but not worth unifying since they're in different apps.\n\nAlso noted by behavioral audit: This is a mix of drift and intentional variation. BulkHistorian, BulkChronicleAnnotation, BulkFactCoverage, and InterleavedAnnotation correctly implement collect-and-continue with per-item failure tracking \u2014 this is the dominant pattern (4 of 7). BulkEraNarrative deviates by stopping on the first era failure rather than collecting failures and continuing. This is likely unintentional since it handles the same kind of sequential LLM-powered processing as the other bulk operations. BulkBackport's chronicle-level-only tracking is reasonable given its batch structure but inconsistent with the per-entity tracking in other modals. BulkToneRanking's all-or-nothing approach is appropriate for its single-call nature. No bulk operation supports retry of failed items \u2014 this is a consistent gap across all implementations.",
      "recommendation": "Migrate useBulkHistorian and useBulkBackport to Zustand stores with module-level flags, matching the pattern established by bulkChronicleAnnotationStore. This requires passing the dep callbacks (buildReviewContext, applyPatches, etc.) into the store at prepare time rather than capturing them in React closures.",
      "evidence_quality": "high",
      "status": "pending",
      "source_domain": "workflows",
      "merged_from": [
        "workflow-phase-lifecycle",
        "progress-status-union",
        "bulk-error-recovery"
      ]
    },
    {
      "id": "semantic-cluster-001",
      "name": "IndexedDB read operations \u2014 query illuminator DB for chronicles, entities, events, static pages, era narratives by simulation run or project ID",
      "type": "semantic",
      "description": [
        "opens illuminator DB via openIlluminatorDb()",
        "creates readonly transaction on target store",
        "queries by index (simulationRunId or projectId)",
        "filters/sorts results in onsuccess callback",
        "closes DB in finally block"
      ],
      "impact": "HIGH",
      "total_files": 19,
      "variants": [
        {
          "name": "canonry-raw-idb-reads",
          "description": "Raw IndexedDB API with manual transaction, Promise wrapper, and try/finally db.close()",
          "file_count": 10,
          "files": [
            "apps/canonry/webui/src/storage/chronicleStorage.js",
            "apps/canonry/webui/src/storage/entityStorage.js",
            "apps/canonry/webui/src/storage/eventStorage.js",
            "apps/canonry/webui/src/storage/imageStorage.js",
            "apps/canonry/webui/src/storage/staticPageStorage.js",
            "apps/canonry/webui/src/storage/eraNarrativeStorage.js",
            "apps/canonry/webui/src/storage/worldStore.js"
          ],
          "code_excerpts": [
            {
              "file": "apps/canonry/webui/src/storage/chronicleStorage.js",
              "start_line": 15,
              "end_line": 37,
              "snippet": "export async function getCompletedChroniclesForSimulation(simulationRunId) {\n  if (!simulationRunId) return [];\n  try {\n    const db = await openIlluminatorDb();\n    try {\n      return await new Promise((resolve, reject) => {\n        const tx = db.transaction(CHRONICLE_STORE_NAME, \"readonly\");\n        const store = tx.objectStore(CHRONICLE_STORE_NAME);\n        const index = store.index(\"simulationRunId\");\n        const request = index.getAll(IDBKeyRange.only(simulationRunId));\n        request.onsuccess = () => resolve(filterCompleted(request.result || []));\n        request.onerror = () => reject(request.error);\n      });\n    } finally {\n      db.close();\n    }\n  } catch (err) {\n    console.error(\"[chronicleStorage] Failed:\", err);\n    return [];\n  }\n}"
            }
          ],
          "implementation_details": "Each function manually opens the DB, creates a readonly transaction, queries an index, wraps in a new Promise with onsuccess/onerror handlers, and closes in a finally block. This boilerplate is repeated identically 10+ times."
        },
        {
          "name": "chronicler-raw-idb-reads",
          "description": "Same raw IDB pattern as canonry but in TypeScript with type annotations",
          "file_count": 4,
          "files": [
            "apps/chronicler/webui/src/lib/chronicleStorage.ts",
            "apps/chronicler/webui/src/lib/eraNarrativeStorage.ts",
            "apps/chronicler/webui/src/lib/staticPageStorage.ts"
          ],
          "code_excerpts": [
            {
              "file": "apps/chronicler/webui/src/lib/chronicleStorage.ts",
              "start_line": 109,
              "end_line": 140,
              "snippet": "export async function getCompletedChroniclesForSimulation(\n  simulationRunId: string\n): Promise<ChronicleRecord[]> {\n  if (!simulationRunId) return [];\n  try {\n    const db = await openIlluminatorDb();\n    try {\n      return await new Promise((resolve, reject) => {\n        const tx = db.transaction(CHRONICLE_STORE_NAME, \"readonly\");\n        const store = tx.objectStore(CHRONICLE_STORE_NAME);\n        const index = store.index(\"simulationRunId\");\n        const request = index.getAll(IDBKeyRange.only(simulationRunId));\n        request.onsuccess = () => { /* filter + sort */ };\n        request.onerror = () => reject(request.error);\n      });\n    } finally { db.close(); }\n  } catch (err) { return []; }\n}"
            }
          ],
          "implementation_details": "Identical pattern to canonry but with TypeScript types. Both apps import openIlluminatorDb from @the-canonry/world-store, proving they already depend on the shared package \u2014 they just don't use its helpers."
        },
        {
          "name": "world-store-generic-helpers",
          "description": "Generic getRecord/getAllByIndex helpers that encapsulate the IDB boilerplate",
          "file_count": 1,
          "files": [
            "packages/world-store/src/index.ts"
          ],
          "code_excerpts": [
            {
              "file": "packages/world-store/src/index.ts",
              "start_line": 190,
              "end_line": 200,
              "snippet": "export async function getChronicles(simulationRunId: string): Promise<ChronicleRecord[]> {\n  const db = await openIlluminatorDb();\n  const records = await getAllByIndex<ChronicleRecord>(\n    db,\n    CHRONICLES_STORE,\n    'simulationRunId',\n    simulationRunId,\n  );\n  db.close();\n  return records;\n}"
            }
          ],
          "implementation_details": "world-store already solved the duplication with generic getRecord<T> and getAllByIndex<T> helpers. Each query function is a thin typed wrapper. Canonry and chronicler should use these instead of hand-rolling raw IDB."
        }
      ],
      "semantic_role": "IndexedDB read operations \u2014 query illuminator DB for chronicles, entities, events, static pages, era narratives by simulation run or project ID",
      "consolidation_assessment": "world-store already contains generic helpers (getRecord, getAllByIndex) that could replace all raw IDB boilerplate in canonry/storage and chronicler/lib. The challenge is that canonry/chronicler have additional filtering/projection logic that would need to be parameterized.",
      "analysis": "Verdict: DUPLICATE, Confidence: 0.95, Complexity: MEDIUM",
      "recommendation": "world-store already contains generic helpers (getRecord, getAllByIndex) that could replace all raw IDB boilerplate in canonry/storage and chronicler/lib. The challenge is that canonry/chronicler have additional filtering/projection logic that would need to be parameterized.",
      "status": "pending",
      "evidence_quality": "high",
      "implementation_details": "Three independent implementations of the same 'open illuminator DB \u2192 query by index \u2192 close' pattern: (1) canonry/storage uses raw IndexedDB API with Promise wrappers, (2) chronicler/lib uses identical raw IDB API but in TypeScript, (3) world-store uses generic getRecord/getAllByIndex helpers. The world-store already contains the consolidated solution but canonry and chronicler don't use it."
    },
    {
      "id": "semantic-cluster-004",
      "name": "IndexedDB write/mutation operations \u2014 persist world data, import bundles, manage simulation slots across canonry storage and illuminator repository layers",
      "type": "semantic",
      "description": [
        "opens illuminator DB via openIlluminatorDb()",
        "creates readwrite transactions",
        "puts/deletes records in IDB stores",
        "closes DB after operation"
      ],
      "impact": "MEDIUM",
      "total_files": 9,
      "variants": [
        {
          "name": "canonry-raw-idb-writes",
          "description": "Raw IDB API for bulk import operations (importChronicles, importEntities, importNarrativeEvents, importStaticPages)",
          "file_count": 5,
          "files": [
            "apps/canonry/webui/src/storage/chronicleStorage.js",
            "apps/canonry/webui/src/storage/entityStorage.js",
            "apps/canonry/webui/src/storage/eventStorage.js",
            "apps/canonry/webui/src/storage/staticPageStorage.js"
          ],
          "code_excerpts": [
            {
              "file": "apps/canonry/webui/src/storage/chronicleStorage.js",
              "start_line": 71,
              "end_line": 80,
              "snippet": "export async function importChronicles(projectId, chronicles, options = {}) {\n  if (!projectId || !Array.isArray(chronicles) || chronicles.length === 0) {\n    return { imported: 0, overwritten: 0, skipped: 0 };\n  }\n  const db = await openIlluminatorDb();\n  const { simulationRunId } = options;\n  let imported = 0, overwritten = 0, skipped = 0;\n  // ... raw IDB readwrite transaction + put() loop\n}"
            }
          ],
          "implementation_details": "Each import function opens the DB, creates a readwrite transaction, loops through records with individual put() calls, tracks import/overwrite/skip counts, closes DB in finally."
        },
        {
          "name": "canonry-slot-management",
          "description": "Slot lifecycle management (save/load/clear) using both canonry-runs and illuminator databases",
          "file_count": 2,
          "files": [
            "apps/canonry/webui/src/storage/worldStore.js",
            "apps/canonry/webui/src/storage/runStore.js"
          ],
          "code_excerpts": [
            {
              "file": "packages/world-store/src/index.ts",
              "start_line": 130,
              "end_line": 138,
              "snippet": "export async function getSlotRecord(\n  projectId: string,\n  slotIndex: number,\n): Promise<SimulationSlotRecord | null> {\n  const db = await openIlluminatorDb();\n  const record = await getRecord<SimulationSlotRecord>(db, SLOTS_STORE, [projectId, slotIndex]);\n  db.close();\n  return record;\n}"
            }
          ],
          "implementation_details": "Canonry worldStore.js has save/load/clear operations that access a SEPARATE 'canonry-runs' database for slot metadata, while world-store provides getSlotRecord() for the 'illuminator' database's simulationSlots store. Two databases, two access patterns."
        },
        {
          "name": "illuminator-dexie-writes",
          "description": "Dexie ORM CRUD for enrichment workflows (seedEntities, patchEntitiesFromHardState, bulkPut, delete)",
          "file_count": 8,
          "files": [
            "apps/illuminator/webui/src/lib/db/entityRepository.ts",
            "apps/illuminator/webui/src/lib/db/eventRepository.ts",
            "apps/illuminator/webui/src/lib/db/chronicleRepository.ts",
            "apps/illuminator/webui/src/lib/db/relationshipRepository.ts",
            "apps/illuminator/webui/src/lib/db/schemaRepository.ts",
            "apps/illuminator/webui/src/lib/db/coordinateStateRepository.ts",
            "apps/illuminator/webui/src/lib/db/staticPageRepository.ts",
            "apps/illuminator/webui/src/lib/db/slotRepository.ts"
          ],
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/lib/db/entityRepository.ts",
              "start_line": 31,
              "end_line": 40,
              "snippet": "export async function seedEntities(\n  simulationRunId: string,\n  entities: WorldEntity[]\n): Promise<void> {\n  const records: PersistedEntity[] = entities.map((e) => ({\n    ...e,\n    simulationRunId,\n  }));\n  await db.entities.bulkPut(records);\n}"
            }
          ],
          "implementation_details": "Uses Dexie ORM for typed table access (db.entities.bulkPut, db.entities.where().equals()). Richer than raw IDB but only works within the illuminator app."
        }
      ],
      "semantic_role": "IndexedDB write/mutation operations \u2014 persist world data, import bundles, manage simulation slots across canonry storage and illuminator repository layers",
      "consolidation_assessment": "The write paths are more heterogeneous than the reads (cluster-001). Canonry's import functions handle bulk seeding from bundles, while illuminator's repositories handle per-record CRUD during enrichment workflows. Consolidation would require establishing world-store as the canonical write layer and migrating both apps, but the slot management and import logic are app-specific enough to resist full unification.",
      "analysis": "Verdict: OVERLAPPING, Confidence: 0.85, Complexity: HIGH\n\nAlso noted by semantic audit: Verdict: OVERLAPPING, Confidence: 0.88, Complexity: HIGH",
      "recommendation": "The write paths are more heterogeneous than the reads (cluster-001). Canonry's import functions handle bulk seeding from bundles, while illuminator's repositories handle per-record CRUD during enrichment workflows. Consolidation would require establishing world-store as the canonical write layer and migrating both apps, but the slot management and import logic are app-specific enough to resist full unification.",
      "status": "pending",
      "evidence_quality": "high",
      "implementation_details": "Write operations for the illuminator database are scattered across three access layers: (1) canonry/storage has import functions using raw IDB API for bulk data ingestion, (2) illuminator repos use Dexie ORM for enrichment CRUD, (3) world-store has generic raw IDB helpers but lacks write functions. Additionally, canonry manages simulation slots through a separate 'canonry-runs' database, while world-store accesses slots via the 'illuminator' database's simulationSlots store.",
      "merged_from": [
        "semantic-cluster-006"
      ]
    },
    {
      "id": "semantic-cluster-009",
      "name": "Prefixed ID generation \u2014 produce unique IDs in the format prefix_timestamp_uuid-slice for database records",
      "type": "semantic",
      "description": [
        "uses Date.now() for timestamp component",
        "uses crypto.randomUUID().slice() for random component",
        "returns template string: prefix_timestamp_random"
      ],
      "impact": "HIGH",
      "total_files": 7,
      "variants": [
        {
          "name": "illuminator-prefixed-id-generators",
          "description": "Seven near-identical functions using prefix_timestamp_uuid-slice pattern",
          "file_count": 7,
          "files": [
            "apps/illuminator/webui/src/lib/db/costRepository.ts",
            "apps/illuminator/webui/src/lib/db/dynamicsRepository.ts",
            "apps/illuminator/webui/src/lib/db/eraNarrativeRepository.ts",
            "apps/illuminator/webui/src/lib/db/historianRepository.ts",
            "apps/illuminator/webui/src/lib/db/staticPageRepository.ts",
            "apps/illuminator/webui/src/lib/db/summaryRevisionRepository.ts"
          ],
          "code_excerpts": [
            {
              "file": "apps/illuminator/webui/src/lib/db/dynamicsRepository.ts",
              "start_line": 10,
              "end_line": 12,
              "snippet": "export function generateRunId(): string {\n  return `dynrun_${Date.now()}_${crypto.randomUUID().slice(0, 8)}`;\n}"
            },
            {
              "file": "apps/illuminator/webui/src/lib/db/costRepository.ts",
              "start_line": 16,
              "end_line": 18,
              "snippet": "export function generateCostId(): string {\n  return `cost_${Date.now()}_${crypto.randomUUID().slice(0, 9)}`;\n}"
            },
            {
              "file": "apps/illuminator/webui/src/lib/db/eraNarrativeRepository.ts",
              "start_line": 15,
              "end_line": 17,
              "snippet": "export function generateEraNarrativeId(): string {\n  return `eranarr_${Date.now()}_${crypto.randomUUID().slice(0, 8)}`;\n}"
            },
            {
              "file": "apps/illuminator/webui/src/lib/db/historianRepository.ts",
              "start_line": 10,
              "end_line": 12,
              "snippet": "export function generateHistorianRunId(): string {\n  return `histrun_${Date.now()}_${crypto.randomUUID().slice(0, 8)}`;\n}"
            }
          ],
          "implementation_details": "Every function is: return `${PREFIX}_${Date.now()}_${crypto.randomUUID().slice(0, N)}`. Prefixes: cost_, dynrun_, eranarr_, enver_, histrun_, static_, revrun_. Slice lengths: 6, 8, or 9."
        },
        {
          "name": "lore-weave-event-id",
          "description": "Event ID generator with crypto.randomUUID fallback",
          "file_count": 1,
          "files": [
            "apps/lore-weave/lib/core/idGeneration.ts"
          ],
          "code_excerpts": [
            {
              "file": "apps/lore-weave/lib/core/idGeneration.ts",
              "start_line": 18,
              "end_line": 24,
              "snippet": "export function generateEventId(): string {\n  const cryptoObj = (globalThis as { crypto?: ... }).crypto;\n  if (cryptoObj?.randomUUID) {\n    return `event_${cryptoObj.randomUUID()}`;\n  }\n  return `event_${Date.now()}_${eventCounter++}`;\n}"
            }
          ],
          "implementation_details": "Same concept as illuminator generators but with a Node.js fallback (crypto.randomUUID may not exist in older Node). Uses full UUID instead of a slice."
        }
      ],
      "semantic_role": "Prefixed ID generation \u2014 produce unique IDs in the format prefix_timestamp_uuid-slice for database records",
      "consolidation_assessment": "All 7 illuminator functions are trivially identical: prefix_${Date.now()}_${crypto.randomUUID().slice(0, N)}. A single generatePrefixedId(prefix, sliceLength?) utility replaces all of them.",
      "analysis": "Verdict: DUPLICATE, Confidence: 0.98, Complexity: LOW",
      "recommendation": "All 7 illuminator functions are trivially identical: prefix_${Date.now()}_${crypto.randomUUID().slice(0, N)}. A single generatePrefixedId(prefix, sliceLength?) utility replaces all of them.",
      "status": "completed",
      "evidence_quality": "high",
      "implementation_details": "Seven illuminator repository files each define a trivially identical ID generation function: `prefix_${Date.now()}_${crypto.randomUUID().slice(0, N)}`. The only differences are the prefix string and UUID slice length (6-9 chars). A single generatePrefixedId(prefix, sliceLength?) utility would replace all seven."
    },
    {
      "id": "css-css-cluster-001",
      "name": "CSS Duplication: BulkBackportModal.css, BulkEraNarrativeModal.css, BulkHistorianModal.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.44). Shared custom properties: --border-color, --text-muted",
      "impact": "LOW",
      "total_files": 23,
      "variants": [
        {
          "name": "BulkBackportModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/BulkBackportModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/BulkBackportModal.css"
        },
        {
          "name": "BulkEraNarrativeModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/BulkEraNarrativeModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/BulkEraNarrativeModal.css"
        },
        {
          "name": "BulkHistorianModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/BulkHistorianModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/BulkHistorianModal.css"
        },
        {
          "name": "BulkOperationShell.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/BulkOperationShell.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/BulkOperationShell.css"
        },
        {
          "name": "ChroniclePanel.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChroniclePanel.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChroniclePanel.css"
        },
        {
          "name": "ChroniclePlanEditor.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChroniclePlanEditor.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChroniclePlanEditor.css"
        },
        {
          "name": "NarrativeTimeline.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChronicleWizard/visualizations/NarrativeTimeline.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChronicleWizard/visualizations/NarrativeTimeline.css"
        },
        {
          "name": "ChronologyModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChronologyModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChronologyModal.css"
        },
        {
          "name": "CreateEntityModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/CreateEntityModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/CreateEntityModal.css"
        },
        {
          "name": "DynamicsGenerationModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/DynamicsGenerationModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/DynamicsGenerationModal.css"
        },
        {
          "name": "EntityRenameModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/EntityRenameModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/EntityRenameModal.css"
        },
        {
          "name": "EraNarrativeModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/EraNarrativeModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/EraNarrativeModal.css"
        },
        {
          "name": "EraNarrativeViewer.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/EraNarrativeViewer.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/EraNarrativeViewer.css"
        },
        {
          "name": "HistorianConfigEditor.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/HistorianConfigEditor.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/HistorianConfigEditor.css"
        },
        {
          "name": "HistorianReviewModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/HistorianReviewModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/HistorianReviewModal.css"
        },
        {
          "name": "HistoryCompressionPreviewModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/HistoryCompressionPreviewModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/HistoryCompressionPreviewModal.css"
        },
        {
          "name": "InterleavedAnnotationModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/InterleavedAnnotationModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/InterleavedAnnotationModal.css"
        },
        {
          "name": "QuickCheckModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/QuickCheckModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/QuickCheckModal.css"
        },
        {
          "name": "SummaryRevisionModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/SummaryRevisionModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/SummaryRevisionModal.css"
        },
        {
          "name": "ThinkingViewer.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ThinkingViewer.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ThinkingViewer.css"
        },
        {
          "name": "ToneAssignmentPreviewModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ToneAssignmentPreviewModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ToneAssignmentPreviewModal.css"
        },
        {
          "name": "ChronicleWorkspace.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/chronicle-workspace/ChronicleWorkspace.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/chronicle-workspace/ChronicleWorkspace.css"
        },
        {
          "name": "ChronicleSeedViewer.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/components/ChronicleSeedViewer.css"
          ],
          "sample_file": "packages/shared-components/src/components/ChronicleSeedViewer.css"
        }
      ],
      "linked_components": [
        "apps/illuminator/webui/src/components/BulkBackportModal.jsx::default",
        "apps/illuminator/webui/src/components/BulkEraNarrativeModal.jsx::default",
        "apps/illuminator/webui/src/components/BulkHistorianModal.jsx::default",
        "apps/illuminator/webui/src/components/BulkOperationShell.jsx::BulkCost",
        "apps/illuminator/webui/src/components/BulkOperationShell.jsx::BulkFailedList",
        "apps/illuminator/webui/src/components/BulkOperationShell.jsx::BulkProgressBar",
        "apps/illuminator/webui/src/components/BulkOperationShell.jsx::BulkTerminalMessage",
        "apps/illuminator/webui/src/components/BulkOperationShell.jsx::default",
        "apps/illuminator/webui/src/components/ChroniclePanel.jsx::default",
        "apps/illuminator/webui/src/components/ChroniclePlanEditor.jsx::default",
        "apps/illuminator/webui/src/components/ChronicleWizard/visualizations/NarrativeTimeline.tsx::default",
        "apps/illuminator/webui/src/components/ChronologyModal.jsx::default",
        "apps/illuminator/webui/src/components/CreateEntityModal.tsx::default",
        "apps/illuminator/webui/src/components/DynamicsGenerationModal.jsx::default",
        "apps/illuminator/webui/src/components/EntityRenameModal.tsx::default",
        "apps/illuminator/webui/src/components/EraNarrativeModal.jsx::default",
        "apps/illuminator/webui/src/components/EraNarrativeViewer.tsx::default",
        "apps/illuminator/webui/src/components/HistorianConfigEditor.jsx::default",
        "apps/illuminator/webui/src/components/HistorianReviewModal.jsx::default",
        "apps/illuminator/webui/src/components/HistoryCompressionPreviewModal.jsx::default",
        "apps/illuminator/webui/src/components/InterleavedAnnotationModal.jsx::default",
        "apps/illuminator/webui/src/components/QuickCheckModal.jsx::default",
        "apps/illuminator/webui/src/components/SummaryRevisionModal.jsx::default",
        "apps/illuminator/webui/src/components/ThinkingViewer.tsx::ThinkingViewer",
        "apps/illuminator/webui/src/components/ToneAssignmentPreviewModal.jsx::default",
        "apps/illuminator/webui/src/components/chronicle-workspace/ChronicleWorkspace.jsx::default",
        "packages/shared-components/src/components/ChronicleSeedViewer.jsx::ExpandableSeedSection",
        "packages/shared-components/src/components/ChronicleSeedViewer.jsx::SeedModal",
        "packages/shared-components/src/components/ChronicleSeedViewer.jsx::default"
      ],
      "shared_custom_properties": [
        "--border-color",
        "--text-muted"
      ],
      "analysis": "Avg similarity: 0.44, spread: 2 dirs, linked to 29 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-002",
      "name": "CSS Duplication: ActivityPanel.css, BackportConfigModal.css, ChronicleImagePanel.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.44). Shared custom properties: --text-muted",
      "impact": "LOW",
      "total_files": 20,
      "variants": [
        {
          "name": "ActivityPanel.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ActivityPanel.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ActivityPanel.css"
        },
        {
          "name": "BackportConfigModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/BackportConfigModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/BackportConfigModal.css"
        },
        {
          "name": "ChronicleImagePanel.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChronicleImagePanel.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChronicleImagePanel.css"
        },
        {
          "name": "ChronicleReviewPanel.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChronicleReviewPanel.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChronicleReviewPanel.css"
        },
        {
          "name": "CohesionReportViewer.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/CohesionReportViewer.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/CohesionReportViewer.css"
        },
        {
          "name": "CorpusFindReplace.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/CorpusFindReplace.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/CorpusFindReplace.css"
        },
        {
          "name": "CoverImageControls.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/CoverImageControls.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/CoverImageControls.css"
        },
        {
          "name": "DescriptionMotifWeaver.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/DescriptionMotifWeaver.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/DescriptionMotifWeaver.css"
        },
        {
          "name": "EntityCoveragePanel.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/EntityCoveragePanel.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/EntityCoveragePanel.css"
        },
        {
          "name": "EventsPanel.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/EventsPanel.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/EventsPanel.css"
        },
        {
          "name": "HistorianMarginNotes.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/HistorianMarginNotes.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/HistorianMarginNotes.css"
        },
        {
          "name": "ProgressPanel.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ProgressPanel.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ProgressPanel.css"
        },
        {
          "name": "RevisionFilterModal.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/RevisionFilterModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/RevisionFilterModal.css"
        },
        {
          "name": "ContentTab.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/chronicle-workspace/ContentTab.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/chronicle-workspace/ContentTab.css"
        },
        {
          "name": "EnrichmentTab.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/chronicle-workspace/EnrichmentTab.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/chronicle-workspace/EnrichmentTab.css"
        },
        {
          "name": "HistorianTab.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/chronicle-workspace/HistorianTab.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/chronicle-workspace/HistorianTab.css"
        },
        {
          "name": "ImagesTab.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/chronicle-workspace/ImagesTab.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/chronicle-workspace/ImagesTab.css"
        },
        {
          "name": "PipelineTab.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/chronicle-workspace/PipelineTab.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/chronicle-workspace/PipelineTab.css"
        },
        {
          "name": "ReferenceTab.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/chronicle-workspace/ReferenceTab.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/chronicle-workspace/ReferenceTab.css"
        },
        {
          "name": "VersionsTab.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/chronicle-workspace/VersionsTab.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/chronicle-workspace/VersionsTab.css"
        }
      ],
      "linked_components": [
        "apps/illuminator/webui/src/components/ActivityPanel.jsx::default",
        "apps/illuminator/webui/src/components/BackportConfigModal.jsx::default",
        "apps/illuminator/webui/src/components/ChronicleImagePanel.tsx::default",
        "apps/illuminator/webui/src/components/ChronicleReviewPanel.jsx::default",
        "apps/illuminator/webui/src/components/CohesionReportViewer.jsx::default",
        "apps/illuminator/webui/src/components/CorpusFindReplace.tsx::default",
        "apps/illuminator/webui/src/components/CoverImageControls.jsx::CoverImageControls",
        "apps/illuminator/webui/src/components/CoverImageControls.jsx::CoverImagePreview",
        "apps/illuminator/webui/src/components/DescriptionMotifWeaver.tsx::default",
        "apps/illuminator/webui/src/components/EntityCoveragePanel.jsx::default",
        "apps/illuminator/webui/src/components/EventsPanel.jsx::default",
        "apps/illuminator/webui/src/components/HistorianMarginNotes.jsx::default",
        "apps/illuminator/webui/src/components/ProgressPanel.jsx::default",
        "apps/illuminator/webui/src/components/RevisionFilterModal.jsx::default",
        "apps/illuminator/webui/src/components/chronicle-workspace/ContentTab.jsx::default",
        "apps/illuminator/webui/src/components/chronicle-workspace/EnrichmentTab.jsx::default",
        "apps/illuminator/webui/src/components/chronicle-workspace/HistorianTab.jsx::default",
        "apps/illuminator/webui/src/components/chronicle-workspace/ImagesTab.jsx::default",
        "apps/illuminator/webui/src/components/chronicle-workspace/PipelineTab.jsx::default",
        "apps/illuminator/webui/src/components/chronicle-workspace/ReferenceTab.jsx::default",
        "apps/illuminator/webui/src/components/chronicle-workspace/VersionsTab.jsx::default"
      ],
      "shared_custom_properties": [
        "--text-muted"
      ],
      "analysis": "Avg similarity: 0.44, spread: 1 dirs, linked to 21 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-003",
      "name": "CSS Duplication: BackrefImageEditor.css, ChronicleImagePicker.css, EntryPointStep.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.43). Shared custom properties: --text-muted",
      "impact": "LOW",
      "total_files": 17,
      "variants": [
        {
          "name": "BackrefImageEditor.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/BackrefImageEditor.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/BackrefImageEditor.css"
        },
        {
          "name": "ChronicleImagePicker.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChronicleImagePicker.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChronicleImagePicker.css"
        },
        {
          "name": "EntryPointStep.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChronicleWizard/steps/EntryPointStep.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChronicleWizard/steps/EntryPointStep.css"
        },
        {
          "name": "EventResolutionStep.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChronicleWizard/steps/EventResolutionStep.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChronicleWizard/steps/EventResolutionStep.css"
        },
        {
          "name": "GenerateStep.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChronicleWizard/steps/GenerateStep.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChronicleWizard/steps/GenerateStep.css"
        },
        {
          "name": "RoleAssignmentStep.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChronicleWizard/steps/RoleAssignmentStep.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChronicleWizard/steps/RoleAssignmentStep.css"
        },
        {
          "name": "StyleStep.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChronicleWizard/steps/StyleStep.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChronicleWizard/steps/StyleStep.css"
        },
        {
          "name": "EnrichmentQueue.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/EnrichmentQueue.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/EnrichmentQueue.css"
        },
        {
          "name": "EntityBrowser.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/EntityBrowser.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/EntityBrowser.css"
        },
        {
          "name": "EntityDetailView.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/EntityDetailView.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/EntityDetailView.css"
        },
        {
          "name": "ImagePickerModal.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ImagePickerModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ImagePickerModal.css"
        },
        {
          "name": "ImageSettingsDrawer.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ImageSettingsDrawer.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ImageSettingsDrawer.css"
        },
        {
          "name": "ResultsPanel.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ResultsPanel.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ResultsPanel.css"
        },
        {
          "name": "StoragePanel.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/StoragePanel.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/StoragePanel.css"
        },
        {
          "name": "StyleLibraryEditor.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/StyleLibraryEditor.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/StyleLibraryEditor.css"
        },
        {
          "name": "TraitPaletteSection.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/TraitPaletteSection.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/TraitPaletteSection.css"
        },
        {
          "name": "WorldContextEditor.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/WorldContextEditor.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/WorldContextEditor.css"
        }
      ],
      "linked_components": [
        "apps/illuminator/webui/src/components/BackrefImageEditor.jsx::default",
        "apps/illuminator/webui/src/components/ChronicleImagePicker.jsx::default",
        "apps/illuminator/webui/src/components/ChronicleWizard/steps/EntryPointStep.tsx::default",
        "apps/illuminator/webui/src/components/ChronicleWizard/steps/EventResolutionStep.tsx::default",
        "apps/illuminator/webui/src/components/ChronicleWizard/steps/GenerateStep.tsx::default",
        "apps/illuminator/webui/src/components/ChronicleWizard/steps/RoleAssignmentStep.tsx::default",
        "apps/illuminator/webui/src/components/ChronicleWizard/steps/StyleStep.tsx::default",
        "apps/illuminator/webui/src/components/EnrichmentQueue.jsx::default",
        "apps/illuminator/webui/src/components/EntityBrowser.jsx::default",
        "apps/illuminator/webui/src/components/EntityDetailView.tsx::default",
        "apps/illuminator/webui/src/components/ImagePickerModal.jsx::default",
        "apps/illuminator/webui/src/components/ImageSettingsDrawer.tsx::ImageSettingsSummary",
        "apps/illuminator/webui/src/components/ImageSettingsDrawer.tsx::ImageSettingsTrigger",
        "apps/illuminator/webui/src/components/ImageSettingsDrawer.tsx::default",
        "apps/illuminator/webui/src/components/ResultsPanel.jsx::default",
        "apps/illuminator/webui/src/components/StoragePanel.jsx::default",
        "apps/illuminator/webui/src/components/StyleLibraryEditor.jsx::default",
        "apps/illuminator/webui/src/components/TraitPaletteSection.tsx::default",
        "apps/illuminator/webui/src/components/WorldContextEditor.jsx::default"
      ],
      "shared_custom_properties": [
        "--text-muted"
      ],
      "analysis": "Avg similarity: 0.43, spread: 1 dirs, linked to 19 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-004",
      "name": "CSS Duplication: dependency-viewer.css, naming-profile-viewer.css, validation.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.46). Shared custom properties: --color-bg-card, --color-border, --color-border-light, --color-text, --color-text-dim",
      "impact": "LOW",
      "total_files": 7,
      "variants": [
        {
          "name": "dependency-viewer.css",
          "description": "CSS file with 46% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/coherence-engine/webui/src/components/dependency-viewer/dependency-viewer.css"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/dependency-viewer/dependency-viewer.css"
        },
        {
          "name": "naming-profile-viewer.css",
          "description": "CSS file with 46% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/coherence-engine/webui/src/components/naming-profile-viewer/naming-profile-viewer.css"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/naming-profile-viewer/naming-profile-viewer.css"
        },
        {
          "name": "validation.css",
          "description": "CSS file with 46% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/coherence-engine/webui/src/components/validation/validation.css"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/validation/validation.css"
        },
        {
          "name": "card.css",
          "description": "CSS file with 46% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/coherence-engine/webui/src/styles/components/card.css"
          ],
          "sample_file": "apps/coherence-engine/webui/src/styles/components/card.css"
        },
        {
          "name": "editor.css",
          "description": "CSS file with 46% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/coherence-engine/webui/src/styles/components/editor.css"
          ],
          "sample_file": "apps/coherence-engine/webui/src/styles/components/editor.css"
        },
        {
          "name": "card.css",
          "description": "CSS file with 46% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/styles/components/card.css"
          ],
          "sample_file": "packages/shared-components/src/styles/components/card.css"
        },
        {
          "name": "editor.css",
          "description": "CSS file with 46% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/styles/components/editor.css"
          ],
          "sample_file": "packages/shared-components/src/styles/components/editor.css"
        }
      ],
      "linked_components": [
        "apps/coherence-engine/webui/src/components/dependency-viewer/DependencyViewer.jsx::DependencyViewer",
        "apps/coherence-engine/webui/src/components/dependency-viewer/DependencyViewer.jsx::default",
        "apps/coherence-engine/webui/src/components/dependency-viewer/components/DependencySection.jsx::DependencySection",
        "apps/coherence-engine/webui/src/components/naming-profile-viewer/NamingProfileMappingViewer.jsx::NamingProfileMappingViewer",
        "apps/coherence-engine/webui/src/components/naming-profile-viewer/NamingProfileMappingViewer.jsx::default",
        "apps/coherence-engine/webui/src/components/validation/ValidationEditor.jsx::ValidationEditor",
        "apps/coherence-engine/webui/src/components/validation/ValidationEditor.jsx::default",
        "apps/coherence-engine/webui/src/components/validation/ValidationEditor.jsx::getValidationStatus",
        "apps/coherence-engine/webui/src/components/validation/cards/IssueCard.jsx::IssueCard"
      ],
      "shared_custom_properties": [
        "--color-bg-card",
        "--color-border",
        "--color-border-light",
        "--color-text",
        "--color-text-dim",
        "--color-text-muted",
        "--font-size-lg",
        "--font-size-sm",
        "--font-size-xs",
        "--font-weight-medium",
        "--font-weight-semibold",
        "--radius-sm",
        "--spacing-lg",
        "--spacing-md",
        "--spacing-sm",
        "--spacing-xl",
        "--transition-fast"
      ],
      "analysis": "Avg similarity: 0.46, spread: 2 dirs, linked to 9 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-005",
      "name": "CSS Duplication: index.css, utilities.css, utilities.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.65). Shared custom properties: --font-size-base, --font-size-xl, --spacing-2xl, --spacing-md, --spacing-xl",
      "impact": "MEDIUM",
      "total_files": 3,
      "variants": [
        {
          "name": "index.css",
          "description": "CSS file with 65% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/archivist/webui/src/index.css"
          ],
          "sample_file": "apps/archivist/webui/src/index.css"
        },
        {
          "name": "utilities.css",
          "description": "CSS file with 65% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/coherence-engine/webui/src/styles/utilities.css"
          ],
          "sample_file": "apps/coherence-engine/webui/src/styles/utilities.css"
        },
        {
          "name": "utilities.css",
          "description": "CSS file with 65% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/styles/utilities.css"
          ],
          "sample_file": "packages/shared-components/src/styles/utilities.css"
        }
      ],
      "linked_components": [
        "apps/archivist/webui/src/ArchivistRemote.tsx::ArchivistRemoteProps",
        "apps/archivist/webui/src/ArchivistRemote.tsx::default"
      ],
      "shared_custom_properties": [
        "--font-size-base",
        "--font-size-xl",
        "--spacing-2xl",
        "--spacing-md",
        "--spacing-xl"
      ],
      "analysis": "Avg similarity: 0.65, spread: 3 dirs, linked to 2 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "pending"
    },
    {
      "id": "css-css-cluster-006",
      "name": "CSS Duplication: WikiSearch.module.css, dropdown.css, dropdown.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.53). Shared custom properties: --color-accent, --color-border, --font-size-sm, --font-size-xs, --radius-md",
      "impact": "MEDIUM",
      "total_files": 3,
      "variants": [
        {
          "name": "WikiSearch.module.css",
          "description": "CSS file with 53% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/chronicler/webui/src/components/WikiSearch.module.css"
          ],
          "sample_file": "apps/chronicler/webui/src/components/WikiSearch.module.css"
        },
        {
          "name": "dropdown.css",
          "description": "CSS file with 53% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/coherence-engine/webui/src/styles/components/dropdown.css"
          ],
          "sample_file": "apps/coherence-engine/webui/src/styles/components/dropdown.css"
        },
        {
          "name": "dropdown.css",
          "description": "CSS file with 53% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/styles/components/dropdown.css"
          ],
          "sample_file": "packages/shared-components/src/styles/components/dropdown.css"
        }
      ],
      "linked_components": [
        "apps/chronicler/webui/src/components/WikiSearch.tsx::default"
      ],
      "shared_custom_properties": [
        "--color-accent",
        "--color-border",
        "--font-size-sm",
        "--font-size-xs",
        "--radius-md",
        "--spacing-xs",
        "--transition-fast",
        "--z-dropdown"
      ],
      "analysis": "Avg similarity: 0.53, spread: 3 dirs, linked to 1 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-007",
      "name": "CSS Duplication: level-selector.css, level-selector.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.86). Shared custom properties: --color-accent, --color-bg-card, --color-border, --color-text, --font-size-md",
      "impact": "HIGH",
      "total_files": 2,
      "variants": [
        {
          "name": "level-selector.css",
          "description": "CSS file with 86% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/coherence-engine/webui/src/styles/components/level-selector.css"
          ],
          "sample_file": "apps/coherence-engine/webui/src/styles/components/level-selector.css"
        },
        {
          "name": "level-selector.css",
          "description": "CSS file with 86% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/styles/components/level-selector.css"
          ],
          "sample_file": "packages/shared-components/src/styles/components/level-selector.css"
        }
      ],
      "linked_components": [],
      "shared_custom_properties": [
        "--color-accent",
        "--color-bg-card",
        "--color-border",
        "--color-text",
        "--font-size-md",
        "--font-weight-medium",
        "--radius-full",
        "--radius-md",
        "--spacing-md",
        "--spacing-xs",
        "--transition-fast"
      ],
      "analysis": "Avg similarity: 0.86, spread: 2 dirs, linked to 0 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-008",
      "name": "CSS Duplication: form.css, form.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.79). Shared custom properties: --color-accent, --color-bg-card, --color-bg-dark, --color-border, --color-border-light",
      "impact": "HIGH",
      "total_files": 2,
      "variants": [
        {
          "name": "form.css",
          "description": "CSS file with 79% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/coherence-engine/webui/src/styles/components/form.css"
          ],
          "sample_file": "apps/coherence-engine/webui/src/styles/components/form.css"
        },
        {
          "name": "form.css",
          "description": "CSS file with 79% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/styles/components/form.css"
          ],
          "sample_file": "packages/shared-components/src/styles/components/form.css"
        }
      ],
      "linked_components": [],
      "shared_custom_properties": [
        "--color-accent",
        "--color-bg-card",
        "--color-bg-dark",
        "--color-border",
        "--color-border-light",
        "--color-danger",
        "--color-text",
        "--color-text-dim",
        "--color-text-muted",
        "--color-warning",
        "--font-size-base",
        "--font-size-lg",
        "--font-size-sm",
        "--font-size-xs",
        "--font-weight-medium",
        "--font-weight-semibold",
        "--radius-md",
        "--radius-pill",
        "--spacing-lg",
        "--spacing-md",
        "--spacing-sm",
        "--spacing-xl",
        "--spacing-xs",
        "--transition-fast"
      ],
      "analysis": "Avg similarity: 0.79, spread: 2 dirs, linked to 0 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-009",
      "name": "CSS Duplication: section.css, section.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.79). Shared custom properties: --color-accent, --color-bg-card, --color-border, --color-border-light, --color-text",
      "impact": "HIGH",
      "total_files": 2,
      "variants": [
        {
          "name": "section.css",
          "description": "CSS file with 79% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/coherence-engine/webui/src/styles/components/section.css"
          ],
          "sample_file": "apps/coherence-engine/webui/src/styles/components/section.css"
        },
        {
          "name": "section.css",
          "description": "CSS file with 79% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/styles/components/section.css"
          ],
          "sample_file": "packages/shared-components/src/styles/components/section.css"
        }
      ],
      "linked_components": [],
      "shared_custom_properties": [
        "--color-accent",
        "--color-bg-card",
        "--color-border",
        "--color-border-light",
        "--color-text",
        "--color-text-dim",
        "--color-text-muted",
        "--font-size-2xl",
        "--font-size-base",
        "--font-size-lg",
        "--font-size-md",
        "--font-size-sm",
        "--font-size-xl",
        "--font-weight-semibold",
        "--line-height-normal",
        "--radius-lg",
        "--radius-pill",
        "--spacing-2xl",
        "--spacing-lg",
        "--spacing-md",
        "--spacing-xl",
        "--spacing-xs",
        "--transition-fast",
        "--transition-normal"
      ],
      "analysis": "Avg similarity: 0.79, spread: 2 dirs, linked to 0 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-010",
      "name": "CSS Duplication: badge.css, badge.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.69). Shared custom properties: --color-bg-dark, --color-danger, --color-gray, --color-success, --color-text-dim",
      "impact": "MEDIUM",
      "total_files": 2,
      "variants": [
        {
          "name": "badge.css",
          "description": "CSS file with 69% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/coherence-engine/webui/src/styles/components/badge.css"
          ],
          "sample_file": "apps/coherence-engine/webui/src/styles/components/badge.css"
        },
        {
          "name": "badge.css",
          "description": "CSS file with 69% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/styles/components/badge.css"
          ],
          "sample_file": "packages/shared-components/src/styles/components/badge.css"
        }
      ],
      "linked_components": [],
      "shared_custom_properties": [
        "--color-bg-dark",
        "--color-danger",
        "--color-gray",
        "--color-success",
        "--color-text-dim",
        "--color-warning",
        "--font-size-xs",
        "--font-weight-medium",
        "--font-weight-semibold",
        "--radius-sm",
        "--spacing-md",
        "--spacing-xs"
      ],
      "analysis": "Avg similarity: 0.69, spread: 2 dirs, linked to 0 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "pending"
    },
    {
      "id": "css-css-cluster-011",
      "name": "CSS Duplication: CoherenceEngineRemote.css, CosmographerRemote.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.66)",
      "impact": "MEDIUM",
      "total_files": 2,
      "variants": [
        {
          "name": "CoherenceEngineRemote.css",
          "description": "CSS file with 66% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/coherence-engine/webui/src/CoherenceEngineRemote.css"
          ],
          "sample_file": "apps/coherence-engine/webui/src/CoherenceEngineRemote.css"
        },
        {
          "name": "CosmographerRemote.css",
          "description": "CSS file with 66% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/cosmographer/webui/src/CosmographerRemote.css"
          ],
          "sample_file": "apps/cosmographer/webui/src/CosmographerRemote.css"
        }
      ],
      "linked_components": [
        "apps/coherence-engine/webui/src/CoherenceEngineRemote.jsx::default",
        "apps/cosmographer/webui/src/CosmographerRemote.jsx::default"
      ],
      "shared_custom_properties": [],
      "analysis": "Avg similarity: 0.66, spread: 2 dirs, linked to 2 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-012",
      "name": "CSS Duplication: BulkChronicleAnnotationModal.css, ConfigPanel.css, CostsPanel.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.42). Shared custom properties: --text-muted",
      "impact": "LOW",
      "total_files": 5,
      "variants": [
        {
          "name": "BulkChronicleAnnotationModal.css",
          "description": "CSS file with 42% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/BulkChronicleAnnotationModal.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/BulkChronicleAnnotationModal.css"
        },
        {
          "name": "ConfigPanel.css",
          "description": "CSS file with 42% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ConfigPanel.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ConfigPanel.css"
        },
        {
          "name": "CostsPanel.css",
          "description": "CSS file with 42% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/CostsPanel.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/CostsPanel.css"
        },
        {
          "name": "IlluminatorTabContent.css",
          "description": "CSS file with 42% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/IlluminatorTabContent.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/IlluminatorTabContent.css"
        },
        {
          "name": "StyleSelector.css",
          "description": "CSS file with 42% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/StyleSelector.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/StyleSelector.css"
        }
      ],
      "linked_components": [
        "apps/illuminator/webui/src/components/BulkChronicleAnnotationModal.jsx::default",
        "apps/illuminator/webui/src/components/ConfigPanel.jsx::default",
        "apps/illuminator/webui/src/components/CostsPanel.jsx::default",
        "apps/illuminator/webui/src/components/IlluminatorTabContent.jsx::default",
        "apps/illuminator/webui/src/components/StyleSelector.jsx::NONE_ID",
        "apps/illuminator/webui/src/components/StyleSelector.jsx::RANDOM_ID",
        "apps/illuminator/webui/src/components/StyleSelector.jsx::default",
        "apps/illuminator/webui/src/components/StyleSelector.jsx::resolveStyleSelection"
      ],
      "shared_custom_properties": [
        "--text-muted"
      ],
      "analysis": "Avg similarity: 0.42, spread: 1 dirs, linked to 8 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-013",
      "name": "CSS Duplication: VariablesTab.css, ThresholdTriggerTab.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.95). Shared custom properties: --spacing-md",
      "impact": "HIGH",
      "total_files": 2,
      "variants": [
        {
          "name": "VariablesTab.css",
          "description": "CSS file with 95% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/coherence-engine/webui/src/components/actions/tabs/VariablesTab.css"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/actions/tabs/VariablesTab.css"
        },
        {
          "name": "ThresholdTriggerTab.css",
          "description": "CSS file with 95% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/coherence-engine/webui/src/components/systems/tabs/ThresholdTriggerTab.css"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/systems/tabs/ThresholdTriggerTab.css"
        }
      ],
      "linked_components": [
        "apps/coherence-engine/webui/src/components/actions/tabs/VariablesTab.jsx::VariablesTab",
        "apps/coherence-engine/webui/src/components/actions/tabs/VariablesTab.jsx::default",
        "apps/coherence-engine/webui/src/components/systems/tabs/ThresholdTriggerTab.jsx::ThresholdTriggerTab"
      ],
      "shared_custom_properties": [
        "--spacing-md"
      ],
      "analysis": "Avg similarity: 0.95, spread: 1 dirs, linked to 3 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-014",
      "name": "CSS Duplication: App.css, App.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.47). Shared custom properties: --bg-primary, --bg-secondary, --bg-sidebar, --bg-tertiary, --border-color",
      "impact": "LOW",
      "total_files": 2,
      "variants": [
        {
          "name": "App.css",
          "description": "CSS file with 47% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/App.css"
          ],
          "sample_file": "apps/illuminator/webui/src/App.css"
        },
        {
          "name": "App.css",
          "description": "CSS file with 47% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/name-forge/webui/src/App.css"
          ],
          "sample_file": "apps/name-forge/webui/src/App.css"
        }
      ],
      "linked_components": [
        "apps/illuminator/webui/src/IlluminatorRemote.jsx::default",
        "apps/name-forge/webui/src/NameForgeRemote.jsx::default"
      ],
      "shared_custom_properties": [
        "--bg-primary",
        "--bg-secondary",
        "--bg-sidebar",
        "--bg-tertiary",
        "--border-color",
        "--card-bg",
        "--card-border",
        "--danger",
        "--font-mono",
        "--input-bg",
        "--space-lg",
        "--space-md",
        "--space-sm",
        "--space-xl",
        "--space-xs",
        "--text-base",
        "--text-color",
        "--text-lg",
        "--text-md",
        "--text-muted",
        "--text-secondary",
        "--text-sm",
        "--text-xl",
        "--text-xs"
      ],
      "analysis": "Avg similarity: 0.47, spread: 2 dirs, linked to 2 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-015",
      "name": "CSS Duplication: GraphView.css, GraphView3D.css, TimelineView3D.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.57)",
      "impact": "MEDIUM",
      "total_files": 3,
      "variants": [
        {
          "name": "GraphView.css",
          "description": "CSS file with 57% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/archivist/webui/src/components/GraphView.css"
          ],
          "sample_file": "apps/archivist/webui/src/components/GraphView.css"
        },
        {
          "name": "GraphView3D.css",
          "description": "CSS file with 57% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/archivist/webui/src/components/GraphView3D.css"
          ],
          "sample_file": "apps/archivist/webui/src/components/GraphView3D.css"
        },
        {
          "name": "TimelineView3D.css",
          "description": "CSS file with 57% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/archivist/webui/src/components/TimelineView3D.css"
          ],
          "sample_file": "apps/archivist/webui/src/components/TimelineView3D.css"
        }
      ],
      "linked_components": [
        "apps/archivist/webui/src/components/GraphView.tsx::default",
        "apps/archivist/webui/src/components/GraphView3D.tsx::EdgeMetric",
        "apps/archivist/webui/src/components/GraphView3D.tsx::default",
        "apps/archivist/webui/src/components/TimelineView3D.tsx::EdgeMetric",
        "apps/archivist/webui/src/components/TimelineView3D.tsx::default"
      ],
      "shared_custom_properties": [],
      "analysis": "Avg similarity: 0.57, spread: 1 dirs, linked to 5 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-016",
      "name": "CSS Duplication: ChainLinkSection.css, DiscoveryStory.css, EraNarrative.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.42). Shared custom properties: --font-serif, --font-size-base, --font-size-lg, --font-size-sm, --font-weight-bold",
      "impact": "LOW",
      "total_files": 4,
      "variants": [
        {
          "name": "ChainLinkSection.css",
          "description": "CSS file with 42% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/archivist/webui/src/components/ChainLinkSection.css"
          ],
          "sample_file": "apps/archivist/webui/src/components/ChainLinkSection.css"
        },
        {
          "name": "DiscoveryStory.css",
          "description": "CSS file with 42% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/archivist/webui/src/components/DiscoveryStory.css"
          ],
          "sample_file": "apps/archivist/webui/src/components/DiscoveryStory.css"
        },
        {
          "name": "EraNarrative.css",
          "description": "CSS file with 42% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/archivist/webui/src/components/EraNarrative.css"
          ],
          "sample_file": "apps/archivist/webui/src/components/EraNarrative.css"
        },
        {
          "name": "LoreSection.css",
          "description": "CSS file with 42% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/archivist/webui/src/components/LoreSection.css"
          ],
          "sample_file": "apps/archivist/webui/src/components/LoreSection.css"
        }
      ],
      "linked_components": [
        "apps/archivist/webui/src/components/ChainLinkSection.tsx::default",
        "apps/archivist/webui/src/components/DiscoveryStory.tsx::default",
        "apps/archivist/webui/src/components/EraNarrative.tsx::default",
        "apps/archivist/webui/src/components/LoreSection.tsx::default"
      ],
      "shared_custom_properties": [
        "--font-serif",
        "--font-size-base",
        "--font-size-lg",
        "--font-size-sm",
        "--font-weight-bold",
        "--radius-lg",
        "--spacing-md",
        "--spacing-xl"
      ],
      "analysis": "Avg similarity: 0.42, spread: 1 dirs, linked to 4 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-017",
      "name": "CSS Duplication: WeightMatrixEditor.css, CoverageMatrix.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.40)",
      "impact": "LOW",
      "total_files": 2,
      "variants": [
        {
          "name": "WeightMatrixEditor.css",
          "description": "CSS file with 40% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/coherence-engine/webui/src/components/weight-matrix/WeightMatrixEditor.css"
          ],
          "sample_file": "apps/coherence-engine/webui/src/components/weight-matrix/WeightMatrixEditor.css"
        },
        {
          "name": "CoverageMatrix.css",
          "description": "CSS file with 40% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/components/CoverageMatrix/CoverageMatrix.css"
          ],
          "sample_file": "packages/shared-components/src/components/CoverageMatrix/CoverageMatrix.css"
        }
      ],
      "linked_components": [
        "apps/coherence-engine/webui/src/components/weight-matrix/WeightMatrixEditor.jsx::default",
        "packages/shared-components/src/components/CoverageMatrix/CoverageMatrix.jsx::default"
      ],
      "shared_custom_properties": [],
      "analysis": "Avg similarity: 0.40, spread: 2 dirs, linked to 2 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-018",
      "name": "CSS Duplication: HistorianEditionComparison.css, ChronicleVersionSelector.css, WorkspaceHeader.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.48). Shared custom properties: --bg-tertiary, --border-color, --text-secondary",
      "impact": "LOW",
      "total_files": 3,
      "variants": [
        {
          "name": "HistorianEditionComparison.css",
          "description": "CSS file with 48% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/HistorianEditionComparison.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/HistorianEditionComparison.css"
        },
        {
          "name": "ChronicleVersionSelector.css",
          "description": "CSS file with 48% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/chronicle-workspace/ChronicleVersionSelector.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/chronicle-workspace/ChronicleVersionSelector.css"
        },
        {
          "name": "WorkspaceHeader.css",
          "description": "CSS file with 48% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/chronicle-workspace/WorkspaceHeader.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/chronicle-workspace/WorkspaceHeader.css"
        }
      ],
      "linked_components": [
        "apps/illuminator/webui/src/components/HistorianEditionComparison.tsx::default",
        "apps/illuminator/webui/src/components/chronicle-workspace/ChronicleVersionSelector.jsx::default",
        "apps/illuminator/webui/src/components/chronicle-workspace/WorkspaceHeader.jsx::default"
      ],
      "shared_custom_properties": [
        "--bg-tertiary",
        "--border-color",
        "--text-secondary"
      ],
      "analysis": "Avg similarity: 0.48, spread: 1 dirs, linked to 3 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-019",
      "name": "CSS Duplication: EpochTimeline.css, FinalDiagnostics.css, PopulationMetrics.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.44). Shared custom properties: --lw-text-muted",
      "impact": "LOW",
      "total_files": 3,
      "variants": [
        {
          "name": "EpochTimeline.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/lore-weave/webui/src/components/dashboard/EpochTimeline.css"
          ],
          "sample_file": "apps/lore-weave/webui/src/components/dashboard/EpochTimeline.css"
        },
        {
          "name": "FinalDiagnostics.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/lore-weave/webui/src/components/dashboard/FinalDiagnostics.css"
          ],
          "sample_file": "apps/lore-weave/webui/src/components/dashboard/FinalDiagnostics.css"
        },
        {
          "name": "PopulationMetrics.css",
          "description": "CSS file with 44% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/lore-weave/webui/src/components/dashboard/PopulationMetrics.css"
          ],
          "sample_file": "apps/lore-weave/webui/src/components/dashboard/PopulationMetrics.css"
        }
      ],
      "linked_components": [
        "apps/lore-weave/webui/src/components/dashboard/EpochTimeline.jsx::default",
        "apps/lore-weave/webui/src/components/dashboard/FinalDiagnostics.jsx::default",
        "apps/lore-weave/webui/src/components/dashboard/PopulationMetrics.jsx::default"
      ],
      "shared_custom_properties": [
        "--lw-text-muted"
      ],
      "analysis": "Avg similarity: 0.44, spread: 1 dirs, linked to 3 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-020",
      "name": "CSS Duplication: AxisRegistry.css, RelationshipEditor.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.46)",
      "impact": "LOW",
      "total_files": 2,
      "variants": [
        {
          "name": "AxisRegistry.css",
          "description": "CSS file with 46% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/cosmographer/webui/src/components/AxisRegistry/AxisRegistry.css"
          ],
          "sample_file": "apps/cosmographer/webui/src/components/AxisRegistry/AxisRegistry.css"
        },
        {
          "name": "RelationshipEditor.css",
          "description": "CSS file with 46% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/cosmographer/webui/src/components/RelationshipEditor/RelationshipEditor.css"
          ],
          "sample_file": "apps/cosmographer/webui/src/components/RelationshipEditor/RelationshipEditor.css"
        }
      ],
      "linked_components": [
        "apps/cosmographer/webui/src/components/AxisRegistry/index.jsx::default",
        "apps/cosmographer/webui/src/components/RelationshipEditor/index.jsx::default"
      ],
      "shared_custom_properties": [],
      "analysis": "Avg similarity: 0.46, spread: 1 dirs, linked to 2 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-021",
      "name": "CSS Duplication: EnsembleConstellation.css, TimelineBrush.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.43)",
      "impact": "LOW",
      "total_files": 2,
      "variants": [
        {
          "name": "EnsembleConstellation.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChronicleWizard/visualizations/EnsembleConstellation.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChronicleWizard/visualizations/EnsembleConstellation.css"
        },
        {
          "name": "TimelineBrush.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/illuminator/webui/src/components/ChronicleWizard/visualizations/TimelineBrush.css"
          ],
          "sample_file": "apps/illuminator/webui/src/components/ChronicleWizard/visualizations/TimelineBrush.css"
        }
      ],
      "linked_components": [
        "apps/illuminator/webui/src/components/ChronicleWizard/visualizations/EnsembleConstellation.tsx::default",
        "apps/illuminator/webui/src/components/ChronicleWizard/visualizations/TimelineBrush.tsx::default"
      ],
      "shared_custom_properties": [],
      "analysis": "Avg similarity: 0.43, spread: 1 dirs, linked to 2 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-022",
      "name": "CSS Duplication: RelationshipKindEditor.css, TagRegistryEditor.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.43)",
      "impact": "LOW",
      "total_files": 2,
      "variants": [
        {
          "name": "RelationshipKindEditor.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/canonry/webui/src/components/SchemaEditor/RelationshipKindEditor.css"
          ],
          "sample_file": "apps/canonry/webui/src/components/SchemaEditor/RelationshipKindEditor.css"
        },
        {
          "name": "TagRegistryEditor.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/canonry/webui/src/components/SchemaEditor/TagRegistryEditor.css"
          ],
          "sample_file": "apps/canonry/webui/src/components/SchemaEditor/TagRegistryEditor.css"
        }
      ],
      "linked_components": [
        "apps/canonry/webui/src/components/SchemaEditor/RelationshipKindEditor.jsx::default",
        "apps/canonry/webui/src/components/SchemaEditor/TagRegistryEditor.jsx::default"
      ],
      "shared_custom_properties": [],
      "analysis": "Avg similarity: 0.43, spread: 1 dirs, linked to 2 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-023",
      "name": "CSS Duplication: empty-state.css, error-boundary.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.43). Shared custom properties: --color-text, --color-text-dim, --color-text-muted, --font-size-2xl, --font-weight-medium",
      "impact": "LOW",
      "total_files": 2,
      "variants": [
        {
          "name": "empty-state.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/styles/components/empty-state.css"
          ],
          "sample_file": "packages/shared-components/src/styles/components/empty-state.css"
        },
        {
          "name": "error-boundary.css",
          "description": "CSS file with 43% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/styles/components/error-boundary.css"
          ],
          "sample_file": "packages/shared-components/src/styles/components/error-boundary.css"
        }
      ],
      "linked_components": [],
      "shared_custom_properties": [
        "--color-text",
        "--color-text-dim",
        "--color-text-muted",
        "--font-size-2xl",
        "--font-weight-medium",
        "--spacing-2xl",
        "--spacing-4xl",
        "--spacing-md",
        "--spacing-xl"
      ],
      "analysis": "Avg similarity: 0.43, spread: 1 dirs, linked to 0 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-024",
      "name": "CSS Duplication: actions.css, toggle.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.41). Shared custom properties: --color-success, --color-text-muted, --radius-full, --spacing-lg, --transition-normal",
      "impact": "LOW",
      "total_files": 2,
      "variants": [
        {
          "name": "actions.css",
          "description": "CSS file with 41% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/styles/components/actions.css"
          ],
          "sample_file": "packages/shared-components/src/styles/components/actions.css"
        },
        {
          "name": "toggle.css",
          "description": "CSS file with 41% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "packages/shared-components/src/styles/components/toggle.css"
          ],
          "sample_file": "packages/shared-components/src/styles/components/toggle.css"
        }
      ],
      "linked_components": [],
      "shared_custom_properties": [
        "--color-success",
        "--color-text-muted",
        "--radius-full",
        "--spacing-lg",
        "--transition-normal"
      ],
      "analysis": "Avg similarity: 0.41, spread: 1 dirs, linked to 0 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "completed"
    },
    {
      "id": "css-css-cluster-025",
      "name": "CSS Duplication: EntityDetail.css, FilterPanel.css",
      "type": "css",
      "description": "CSS files with similar style rules (avg similarity: 0.40). Shared custom properties: --color-bg-blue-20, --color-bg-dark-20, --color-bg-dark-40, --color-blue-300, --color-blue-400",
      "impact": "LOW",
      "total_files": 2,
      "variants": [
        {
          "name": "EntityDetail.css",
          "description": "CSS file with 40% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/archivist/webui/src/components/EntityDetail.css"
          ],
          "sample_file": "apps/archivist/webui/src/components/EntityDetail.css"
        },
        {
          "name": "FilterPanel.css",
          "description": "CSS file with 40% avg similarity to cluster",
          "file_count": 1,
          "files": [
            "apps/archivist/webui/src/components/FilterPanel.css"
          ],
          "sample_file": "apps/archivist/webui/src/components/FilterPanel.css"
        }
      ],
      "linked_components": [
        "apps/archivist/webui/src/components/EntityDetail.tsx::default",
        "apps/archivist/webui/src/components/FilterPanel.tsx::EdgeMetric",
        "apps/archivist/webui/src/components/FilterPanel.tsx::ViewMode",
        "apps/archivist/webui/src/components/FilterPanel.tsx::default"
      ],
      "shared_custom_properties": [
        "--color-bg-blue-20",
        "--color-bg-dark-20",
        "--color-bg-dark-40",
        "--color-blue-300",
        "--color-blue-400",
        "--color-blue-500",
        "--color-border",
        "--color-border-light",
        "--color-border-strong",
        "--color-gray-400",
        "--color-text-primary",
        "--font-mono",
        "--font-size-base",
        "--font-size-lg",
        "--font-size-sm",
        "--font-size-xl",
        "--font-size-xs",
        "--font-weight-medium",
        "--font-weight-semibold",
        "--gradient-bg-panel",
        "--radius-2xl",
        "--radius-lg",
        "--radius-md",
        "--radius-xl",
        "--shadow-xl",
        "--spacing-2xl",
        "--spacing-lg",
        "--spacing-md",
        "--spacing-sm",
        "--spacing-xl",
        "--spacing-xs",
        "--transition-normal"
      ],
      "analysis": "Avg similarity: 0.40, spread: 1 dirs, linked to 4 components",
      "recommendation": "Review for consolidation into shared CSS modules or design tokens.",
      "status": "pending"
    }
  ]
}
